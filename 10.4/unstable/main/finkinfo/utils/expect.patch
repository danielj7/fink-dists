diff -up expect-5.43/Dbg.c.tcl8.5 expect-5.43/Dbg.c
--- expect-5.43/Dbg.c.tcl8.5	2002-03-23 05:11:54.000000000 +0100
+++ expect-5.43/Dbg.c	2008-09-25 12:25:40.000000000 +0200
@@ -10,6 +10,7 @@ would appreciate credit if this program 
 
 #include <stdio.h>
 
+#include "expect_cf.h"
 #include "tcldbgcf.h"
 #if 0
 /* tclInt.h drags in stdlib.  By claiming no-stdlib, force it to drag in */
diff -up expect-5.43/exp_inter.c.tcl8.5 expect-5.43/exp_inter.c
--- expect-5.43/exp_inter.c.tcl8.5	2004-08-18 04:03:00.000000000 +0200
+++ expect-5.43/exp_inter.c	2008-09-25 12:25:40.000000000 +0200
@@ -36,6 +36,7 @@ would appreciate credit if this program 
 #include <ctype.h>
 
 #include "tcl.h"
+#include "tclInt.h"
 #include "string.h"
 
 #include "exp_tty_in.h"
diff -up expect-5.43/exp_command.c_old expect-5.43/exp_command.c
--- expect-5.43/exp_command.c_old	2009-02-10 16:23:48.000000000 +0100
+++ expect-5.43/exp_command.c	2009-02-10 16:31:38.000000000 +0100
@@ -2311,12 +2311,11 @@ Tcl_Obj *CONST objv[];	/* Argument objec
 	/* Historical note: we used "close"  long before there was a */
 	/* Tcl builtin by the same name. */
 
-	Tcl_CmdInfo info;
+	Tcl_CmdInfo* close_info;
 	Tcl_ResetResult(interp);
-	if (0 == Tcl_GetCommandInfo(interp,"close",&info)) {
-	    info.clientData = 0;
-	}
-	return(Tcl_CloseObjCmd(info.clientData,interp,objc_orig,objv_orig));
+
+	close_info = (Tcl_CmdInfo*) Tcl_GetAssocData (interp, EXP_CMDINFO_CLOSE, NULL);
+	return(close_info->objProc(close_info->objClientData,interp,objc,objv));
     }
 
     if (chanName) {
@@ -2961,7 +2960,10 @@ Tcl_Obj *CONST objv[];
     /* if successful (i.e., TCL_RETURN is returned) */
     /* modify the result, so that we will handle it specially */
 
-    int result = Tcl_ReturnObjCmd(clientData,interp,objc,objv);
+    Tcl_CmdInfo* return_info = (Tcl_CmdInfo*)
+    Tcl_GetAssocData (interp, EXP_CMDINFO_RETURN, NULL);
+
+    int result = return_info->objProc(return_info->objClientData,interp,objc,objv);
     if (result == TCL_RETURN)
         result = EXP_TCL_RETURN;
     return result;
diff -up expect-5.43/exp_command.h_old expect-5.43/exp_command.h
--- expect-5.43/exp_command.h_old	2009-02-10 17:33:19.000000000 +0100
+++ expect-5.43/exp_command.h	2009-02-10 17:33:46.000000000 +0100
@@ -326,3 +326,6 @@ EXTERN ExpState *	expDevttyGet _ANSI_ARG
 /* generic functions that really should be provided by Tcl */
 EXTERN int		expSizeGet _ANSI_ARGS_((ExpState *));
 EXTERN int		expSizeZero _ANSI_ARGS_((ExpState *));
+
+#define EXP_CMDINFO_CLOSE  "expect/cmdinfo/close"
+#define EXP_CMDINFO_RETURN "expect/cmdinfo/return"
