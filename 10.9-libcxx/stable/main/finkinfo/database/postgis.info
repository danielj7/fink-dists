Info2: <<
Package: postgis%type_pkg[postgresql]
Version: 1.5.3
Revision: 35
Description: PostgreSQL geographic object support
# variant 9.1: gdal-pgsql
Type: postgresql (9.1 9.2)
License: BSD
Maintainer: Benjamin Reed <postgis@fink.raccoonfink.com>

Depends: <<
	libgeos3.3.8-shlibs (>= 3.3.8-1),
	libiconv,
	libxml2-shlibs (>= 2.9.1-1),
	postgresql%type_pkg[postgresql]-shlibs,
	proj-shlibs
<<
BuildDepends: <<
	dblatex,
	fink (>= 0.30.0),
	fink-package-precedence,
	imagemagick,
	jts,
	libgeos3.3.8 (>= 3.3.8-1),
	libiconv-dev,
	libxml2 (>= 2.9.1-1),
	libxslt-bin,
	postgresql%type_pkg[postgresql]-dev (>= 1:0-0),
	postgresql-java (>= %type_raw[postgresql]-31),
	proj,
	system-java (>= 1.5-1)
<<
GCC: 4.0

Source: http://download.osgeo.org/postgis/source/postgis-%v.tar.gz
Source-MD5: 05a61df5e1b78bf51c9ce98bea5526fc
PatchFile: postgis.patch
PatchFile-MD5: 39b03a612df98b87b4bbb8e134355baf
PatchFile2: postgis_10579_10612.patch
PatchFile2-MD5: a1022a011ce772b7d616be737176f634
PatchScript: <<
	patch -p1 < %{PatchFile}
	patch -p3 < %{PatchFile2}
	# fix some HTML errors that block javadoc build
	perl -pi -e 's/(\@author Markus Schaber )<(markus.schaber\@logix-tt.com)>/\1&lt;\2&gt;/' java/jdbc/src/org/postgis/*.java java/jdbc/src/org/postgis/binary/*.java
<<

SetCPPFLAGS: -DHAVE_OPTRESET -fno-common
NoSetCPPFLAGS: true
SetCC: cc -MD
SetCXX: c++ -MD
UseMaxBuildJobs: false
ConfigureParams: <<
	--with-pgconfig=%p/opt/postgresql-%type_raw[postgresql]/bin/pg_config \
	--with-geosconfig=%p/opt/libgeos3.3.8/bin/geos-config \
	--with-projdir=%p \
	--with-xml2config=%p/bin/xml2-config \
	--with-libiconv=%p
<<
CompileScript: <<
	#!/bin/sh -ev
	SQL_CPP="gcc -E"
	export lt_cv_sys_max_cmd_len=65536
	export JAVA_HOME="/System/Library/Frameworks/JavaVM.framework/Versions/1.5/Home"
	export PATH="/System/Library/Frameworks/JavaVM.framework/Versions/1.5/Home/bin:$PATH"
	
	./configure %c
	
	make SQL_CPP="$SQL_CPP"
	pushd java/jdbc
	make
	popd
	fink-package-precedence --depfile-ext='\.d' --no-libs .
<<

InstallScript: <<
	make install DESTDIR=%d datadir=%p/share/doc/%N
<<
DocFiles: COPYING CREDITS ChangeLog NEWS README* TODO
SplitOff: <<
	Package: %N-java
	Depends: <<
		jts,
		postgresql-java (>= %type_raw[postgresql]-31)
	<<
	JarFiles: java/jdbc/postgis.jar java/pljava/postgis_pljava.jar
<<

PostInstScript: <<
for file in pgsql2shp shp2pgsql; do
	%p/sbin/update-alternatives --install "%p/bin/$file" "$file" "%p/opt/postgresql-%type_raw[postgresql]/bin/$file" %type_pkg[postgresql]
done

cat <<EOF
Note: This package does not do anything until you add it's schema to
your database!

If this is the first time you're using PostGIS in a particular database,
you must install the schema like so:

sudo %p/bin/pgsql.sh-%type_raw[postgresql] start
sudo -u postgres %p/opt/postgresql-%type_raw[postgresql]/bin/psql -f %p/share/doc/%N/contrib/postgis-1.5/postgis.sql -d <your_spatial_database>

If you are upgrading your database from a previous PostGIS version, you
need to upgrade the schema like so:

sudo %p/bin/pgsql.sh-%type_raw[postgresql] start
sudo -u postgres %p/opt/postgresql-%type_raw[postgresql]/bin/psql -f %p/share/doc/%N/contrib/postgis-1.5/postgis_upgrade_XX_to_15.sql -d <your_spatial_database>

EOF
<<
PreRmScript: <<
if [ "$1" != "upgrade" ]; then
	for file in pgsql2shp shp2pgsql; do
		%p/sbin/update-alternatives --remove "$file" "%p/bin/$file-%type_raw[postgresql]"
	done
fi
<<

Homepage: http://postgis.refractions.net/
DescDetail: <<
PostGIS adds support for geographic objects to the PostgreSQL
object-relational database.  In effect, PostGIS "spatially enables" the
PostgreSQL server, allowing it to be used as a backend spatial database for
geographic information systems (GIS), much like ESRI's SDE or Oracle's Spatial
extension.  PostGIS follows the OpenGIS "Simple Features Specification for
SQL" and has been certified as compliant with the "Types and Functions"
profile.
<<
DescUsage: <<
Note: This package does not do anything until you add it's schema to
your database!

If this is the first time you're using PostGIS in a particular database,
you must install the schema like so:

	sudo %p/bin/pgsql.sh-%type_raw[postgresql] start
	sudo -u postgres %p/opt/postgresql-%type_raw[postgresql]/bin/psql \
		-f %p/share/doc/%N/contrib/postgis-1.5/postgis.sql \
		-d <your_spatial_database>

If you are upgrading your database from a previous PostGIS version, you
need to upgrade the schema like so:

	sudo %p/bin/pgsql.sh-%type_raw[postgresql] start
	sudo -u postgres %p/opt/postgresql-%type_raw[postgresql]/bin/psql \
		-f %p/share/doc/%N/contrib/postgis-1.5/postgis_upgrade_XX_to_15.sql \
		-d <your_spatial_database>
<<

DescPackaging: <<
	Includes upstream patch (from newer %v) to spport JDK7. See:
	https://trac.osgeo.org/postgis/attachment/ticket/1960/JDK7SimpleCompatibility.patch

	Includes upstream patchsets (10579 and 10612) for pg9.2. See:
	https://trac.osgeo.org/postgis/ticket/1995
<<
<<
