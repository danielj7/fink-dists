Info4: <<
Package: kdelibs4-%type_pkg[kde]
Version: 4.2.3
Revision: 1
Description: KDE4 - essential libraries
Type: kde (x11 mac)
License: GPL/LGPL
Maintainer: Benjamin Reed <kdelibs4@fink.racoonfink.com>

Depends: <<
	%N-shlibs (= %v-%r),
	aspell,
	dbus (>= 1.2.12-1),
	default-icon-theme (>= 0.5-2),
	hspell,
	shared-mime-info (>= 0.51-1)
<<
BuildDepends: <<
	aspell-dev,
	automoc-%type_pkg[kde] (>= 0.9.89-0),
	avahi-dev,
	bzip2-dev,
	cmake (>= 2.6.3-1),
	cups-dev,
	dbus-dev (>= 1.2.12-1),
	enchant1-dev,
	expat1,
	fink (>= 0.28.0-1),
	freetype219 (>= 2.3.7-7),
	gettext-tools,
	giflib,
	hspell,
	kde4-buildenv (>= 4.2.3-1),
	libgettext3-dev,
	libidn,
	libjasper.1,
	libjpeg,
	libpng3,
	libtiff,
	libxml2,
	libxslt,
	openexr-dev,
	pcre (>= 7.6-1),
	pkgconfig (>= 0.22-3),
	qt4-%type_pkg[kde] (>= 4.5.0-5),
	shared-mime-info (>= 0.51-1),
	soprano-%type_pkg[kde]-dev (>= 2.2.3-2),
	strigi-dev (>= 0.6.3-1),
	(%type_pkg[kde] = x11) x11-dev,
	system-openssl-dev,
	xmkmf
<<
BuildConflicts: gamin-dev
GCC: 4.0

Source: mirror:kde:stable/%v/src/kdelibs-%v.tar.bz2
Source-MD5: 73f76b0521dff7d9aaf1057499624a8d
SourceDirectory: kdelibs-%v
PatchScript: sed -e 's,@KDEPREFIX@,%p,g' -e 's,@KDETYPE@,%type_pkg[kde],g' %{PatchFile} | patch -p1
PatchFile: kdelibs4.patch
PatchFile-MD5: 0c6a1883b6c6c1f9291e7ee3ab084185

CompileScript: <<
#!/bin/sh -ev

	export KDE4_PREFIX="%p" KDE4_TYPE="%type_pkg[kde]"
	. %p/sbin/kde4-buildenv.sh

	mkdir -p build
	pushd build
		cmake $KDE4_CMAKE_ARGS -DSHARE_INSTALL_PREFIX:PATH=%p/lib/%type_pkg[kde]/share ..
		make
	popd
<<

InstallScript: <<
#!/bin/sh -ev

	pushd build
		make -j1 install/fast DESTDIR="%d"
	popd

	mv %i/lib/%type_pkg[kde]/etc %i/etc
	mv %i/etc/xdg/menus/applications.menu %i/etc/xdg/menus/%type_pkg[kde]-applications.menu
	install -c -m 755 kde4-postinst.sh %i/lib/%type_pkg[kde]/bin/

	install -d -m 755 %i/lib/%type_pkg[kde]/etc
	cat <<END >%i/lib/%type_pkg[kde]/etc/kde4rc
[Directories]
prefixes=%p/lib/%type_pkg[kde],%p/lib/qt4-%type_pkg[kde],%p,/usr
END
<<
DocFiles: COPYING COPYING.LIB INSTALL
SplitOff: <<
	Package: %N-shlibs
	Description: KDE4 - essential shared libraries
	Depends: <<
		aspell-shlibs,
		bzip2-shlibs,
		dbus-shlibs (>= 1.2.12-1),
		enchant1-shlibs,
		giflib-shlibs,
		libavahi-client3-shlibs,
		libgettext3-shlibs,
		libidn-shlibs (>= 0.5.1-1),
		libjasper.1-shlibs,
		libjpeg-shlibs,
		libpng3-shlibs (>= 1.2.8-1),
		libtiff-shlibs,
		libxml2-shlibs (>= 2.6.32-1),
		libxslt-shlibs (>= 1.0.27-1),
		macosx (>= 10.4.3-1),
		pcre-shlibs (>= 7.6-1),
		qt4-%type_pkg[kde]-designer-shlibs (>= 4.5.0-5),
		qt4-%type_pkg[kde]-gui-shlibs (>= 4.5.0-5),
		soprano-%type_pkg[kde]-shlibs (>= 2.2.3-2),
		strigi-shlibs (>= 0.6.3-1),
		xdg-base
	<<
	Replaces: %N (<< 4.2.2-4)
	Recommends: %N (>= %v-%r)
	Files: <<
		lib/%type_pkg[kde]/etc/kde4rc
		lib/%type_pkg[kde]/lib/kde4/*.so
		lib/%type_pkg[kde]/lib/kde4/libexec
		lib/%type_pkg[kde]/lib/kde4/plugins
		lib/%type_pkg[kde]/lib/libkde3support.4*.dylib
		lib/%type_pkg[kde]/lib/libkdecore.5*.dylib
		lib/%type_pkg[kde]/lib/libkdefakes.5*.dylib
		lib/%type_pkg[kde]/lib/libkdesu.5*.dylib
		lib/%type_pkg[kde]/lib/libkdeui.5*.dylib
		lib/%type_pkg[kde]/lib/libkdnssd.4*.dylib
		lib/%type_pkg[kde]/lib/libkfile.4*.dylib
		lib/%type_pkg[kde]/lib/libkhtml.5*.dylib
		lib/%type_pkg[kde]/lib/libkimproxy.4*.dylib
		lib/%type_pkg[kde]/lib/libkio.5*.dylib
		lib/%type_pkg[kde]/lib/libkjs.4*.dylib
		lib/%type_pkg[kde]/lib/libkjsapi.4*.dylib
		lib/%type_pkg[kde]/lib/libkjsembed.4*.dylib
		lib/%type_pkg[kde]/lib/libkmediaplayer.4*.dylib
		lib/%type_pkg[kde]/lib/libknewstuff2.4*.dylib
		lib/%type_pkg[kde]/lib/libknotifyconfig.4*.dylib
		lib/%type_pkg[kde]/lib/libkntlm.4*.dylib
		lib/%type_pkg[kde]/lib/libkparts.4*.dylib
		lib/%type_pkg[kde]/lib/libkpty.4*.dylib
		lib/%type_pkg[kde]/lib/libkrosscore.4*.dylib
		lib/%type_pkg[kde]/lib/libkrossqtsplugin.4*.dylib
		lib/%type_pkg[kde]/lib/libkrossui.4*.dylib
		lib/%type_pkg[kde]/lib/libktexteditor.4*.dylib
		lib/%type_pkg[kde]/lib/libkunittest.4*.dylib
		lib/%type_pkg[kde]/lib/libkutils.4*.dylib
		lib/%type_pkg[kde]/lib/libnepomuk.4*.dylib
		lib/%type_pkg[kde]/lib/libplasma.3*.dylib
		lib/%type_pkg[kde]/lib/libsolid.4*.dylib
		lib/%type_pkg[kde]/lib/libthreadweaver.4*.dylib
	<<
	Shlibs: <<
		%p/lib/%type_pkg[kde]/lib/libkde3support.4.dylib         4.0.0 %n (>= 4.1.0-1)
		%p/lib/%type_pkg[kde]/lib/libkdecore.5.dylib             5.0.0 %n (>= 4.1.0-1)
		%p/lib/%type_pkg[kde]/lib/libkdefakes.5.dylib            5.0.0 %n (>= 4.1.0-1)
		%p/lib/%type_pkg[kde]/lib/libkdesu.5.dylib               5.0.0 %n (>= 4.1.0-1)
		%p/lib/%type_pkg[kde]/lib/libkdeui.5.dylib               5.0.0 %n (>= 4.1.0-1)
		%p/lib/%type_pkg[kde]/lib/libkdnssd.4.dylib              4.0.0 %n (>= 4.1.0-1)
		%p/lib/%type_pkg[kde]/lib/libkfile.4.dylib               4.0.0 %n (>= 4.1.0-1)
		%p/lib/%type_pkg[kde]/lib/libkhtml.5.dylib               5.0.0 %n (>= 4.1.0-1)
		%p/lib/%type_pkg[kde]/lib/libkimproxy.4.dylib            4.0.0 %n (>= 4.1.0-1)
		%p/lib/%type_pkg[kde]/lib/libkio.5.dylib                 5.0.0 %n (>= 4.1.0-1)
		%p/lib/%type_pkg[kde]/lib/libkjs.4.dylib                 4.0.0 %n (>= 4.1.0-1)
		%p/lib/%type_pkg[kde]/lib/libkjsapi.4.dylib              4.0.0 %n (>= 4.1.0-1)
		%p/lib/%type_pkg[kde]/lib/libkjsembed.4.dylib            4.0.0 %n (>= 4.1.0-1)
		%p/lib/%type_pkg[kde]/lib/libkmediaplayer.4.dylib        4.0.0 %n (>= 4.1.0-1)
		%p/lib/%type_pkg[kde]/lib/libknewstuff2.4.dylib          4.0.0 %n (>= 4.1.0-1)
		%p/lib/%type_pkg[kde]/lib/libknotifyconfig.4.dylib       4.0.0 %n (>= 4.1.0-1)
		%p/lib/%type_pkg[kde]/lib/libkntlm.4.dylib               4.0.0 %n (>= 4.1.0-1)
		%p/lib/%type_pkg[kde]/lib/libkparts.4.dylib              4.0.0 %n (>= 4.1.0-1)
		%p/lib/%type_pkg[kde]/lib/libkpty.4.dylib                4.0.0 %n (>= 4.1.0-1)
		%p/lib/%type_pkg[kde]/lib/libkrosscore.4.dylib           4.0.0 %n (>= 4.1.0-1)
		%p/lib/%type_pkg[kde]/lib/libkrossqtsplugin.4.dylib      4.0.0 %n (>= 4.2.0-1)
		%p/lib/%type_pkg[kde]/lib/libkrossui.4.dylib             4.0.0 %n (>= 4.1.0-1)
		%p/lib/%type_pkg[kde]/lib/libktexteditor.4.dylib         4.0.0 %n (>= 4.1.0-1)
		%p/lib/%type_pkg[kde]/lib/libkunittest.4.dylib           4.0.0 %n (>= 4.1.0-1)
		%p/lib/%type_pkg[kde]/lib/libkutils.4.dylib              4.0.0 %n (>= 4.1.0-1)
		%p/lib/%type_pkg[kde]/lib/libnepomuk.4.dylib             4.0.0 %n (>= 4.1.0-1)
		%p/lib/%type_pkg[kde]/lib/libplasma.3.dylib              3.0.0 %n (>= 4.2.0-1)
		%p/lib/%type_pkg[kde]/lib/libsolid.4.dylib               4.0.0 %n (>= 4.1.0-1)
		%p/lib/%type_pkg[kde]/lib/libthreadweaver.4.dylib        4.0.0 %n (>= 4.1.0-1)
	<<
	ConfFiles: %p/lib/%type_pkg[kde]/etc/kde4rc
<<
SplitOff2: <<
	Package: %N-dev
	Description: KDE4 - essential development libraries and headers
	Depends: <<
		%N (= %v-%r),
		xmkmf
	<<
	BuildDependsOnly: true
	Files: <<
		lib/%type_pkg[kde]/include
		lib/%type_pkg[kde]/lib/libkde3support.dylib
		lib/%type_pkg[kde]/lib/libkdecore.dylib
		lib/%type_pkg[kde]/lib/libkdefakes.dylib
		lib/%type_pkg[kde]/lib/libkdesu.dylib
		lib/%type_pkg[kde]/lib/libkdeui.dylib
		lib/%type_pkg[kde]/lib/libkdnssd.dylib
		lib/%type_pkg[kde]/lib/libkfile.dylib
		lib/%type_pkg[kde]/lib/libkhtml.dylib
		lib/%type_pkg[kde]/lib/libkimproxy.dylib
		lib/%type_pkg[kde]/lib/libkio.dylib
		lib/%type_pkg[kde]/lib/libkjs.dylib
		lib/%type_pkg[kde]/lib/libkjsapi.dylib
		lib/%type_pkg[kde]/lib/libkjsembed.dylib
		lib/%type_pkg[kde]/lib/libkmediaplayer.dylib
		lib/%type_pkg[kde]/lib/libknewstuff2.dylib
		lib/%type_pkg[kde]/lib/libknotifyconfig.dylib
		lib/%type_pkg[kde]/lib/libkntlm.dylib
		lib/%type_pkg[kde]/lib/libkparts.dylib
		lib/%type_pkg[kde]/lib/libkpty.dylib
		lib/%type_pkg[kde]/lib/libkrosscore.dylib
		lib/%type_pkg[kde]/lib/libkrossqtsplugin.dylib
		lib/%type_pkg[kde]/lib/libkrossui.dylib
		lib/%type_pkg[kde]/lib/libktexteditor.dylib
		lib/%type_pkg[kde]/lib/libkunittest.dylib
		lib/%type_pkg[kde]/lib/libkutils.dylib
		lib/%type_pkg[kde]/lib/libnepomuk.dylib
		lib/%type_pkg[kde]/lib/libplasma.dylib
		lib/%type_pkg[kde]/lib/libsolid.dylib
		lib/%type_pkg[kde]/lib/libthreadweaver.dylib
		lib/%type_pkg[kde]/share/apps/cmake
	<<
<<
Shlibs: <<
	!%p/lib/%type_pkg[kde]/lib/libkdeinit4_kbuildsycoca4.dylib
	!%p/lib/%type_pkg[kde]/lib/libkdeinit4_kconf_update.dylib
	!%p/lib/%type_pkg[kde]/lib/libkdeinit4_kded4.dylib
	!%p/lib/%type_pkg[kde]/lib/libkdeinit4_kio_http_cache_cleaner.dylib
	!%p/lib/%type_pkg[kde]/lib/libkdeinit4_klauncher.dylib
<<

PostInstScript: <<
if [ -e "%p/etc/xdg/menus/applications.menu" ] && [ ! -L "%p/etc/xdg/menus/applications.menu" ]; then
	mv "%p/etc/xdg/menus/applications.menu" "%p/etc/xdg/menus/applications.menu.bak"
fi
case %type_pkg[kde] in
	mac)
		LEVEL=50
		;;
	x11)
		LEVEL=40
		;;
esac
update-alternatives --install "%p/etc/xdg/menus/applications.menu" "applications.menu" "%p/etc/xdg/menus/%type_pkg[kde]-applications.menu" $LEVEL
%p/lib/%type_pkg[kde]/bin/kde4-postinst.sh >/dev/null 2>&1 || :
<<
PostRmScript: <<
if [ -e "%p/etc/xdg/menus/applications.menu" ] && [ ! -L "%p/etc/xdg/menus/applications.menu" ]; then
	mv "%p/etc/xdg/menus/applications.menu" "%p/etc/xdg/menus/applications.menu.bak"
fi
update-alternatives --remove "applications.menu" "%p/etc/xdg/menus/%type_pkg[kde]-applications.menu"
<<

DescDetail: Libraries for the K Desktop Environment.
<<

