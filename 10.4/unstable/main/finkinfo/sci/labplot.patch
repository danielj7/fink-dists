diff -Nurd -x'*~' LabPlot-1.6.0.2.orig/acinclude.m4 LabPlot-1.6.0.2/acinclude.m4
--- LabPlot-1.6.0.2.orig/acinclude.m4	2008-03-31 04:40:10.000000000 -0400
+++ LabPlot-1.6.0.2/acinclude.m4	2010-08-21 10:32:14.000000000 -0400
@@ -2468,7 +2468,7 @@
 AC_DEFUN([AC_FIND_JPEG],
 [
 dnl first look for libraries
-KDE_FIND_JPEG_HELPER(6b, 6b,
+KDE_FIND_JPEG_HELPER(,,
    KDE_FIND_JPEG_HELPER(normal, [],
     [
        LIBJPEG=
diff -Nurd -x'*~' LabPlot-1.6.0.2.orig/configure.in LabPlot-1.6.0.2/configure.in
--- LabPlot-1.6.0.2.orig/configure.in	2008-03-31 04:40:10.000000000 -0400
+++ LabPlot-1.6.0.2/configure.in	2010-08-22 15:04:51.000000000 -0400
@@ -10,6 +10,7 @@
 AC_DEFINE(LVERSION,"1.6.0",[LabPlot version])
 AC_DEFINE(LVERSION_DATE,["Dec 17, 2007"],[LabPlot release date])
 
+LT_INIT
 KDE_SET_PREFIX
 
 dnl AM_CONFIG_HEADER(config.h)
@@ -228,43 +229,23 @@
 
 ############# IMAGEMAGICK #################################
 
-MAGICK_LDFLAGS=
-MAGICK_INCFLAGS=
+# the following because first PKG_CHECK_MODULES might be skipped
+PKG_PROG_PKG_CONFIG
 
 AC_ARG_ENABLE(ImageMagick,AC_HELP_STRING([--enable-ImageMagick],[use ImageMagick (default=auto)]),
 	[USE_IMAGEMAGICK="$enableval"])
 
 if test "$USE_IMAGEMAGICK" != no; then
-AC_CHECK_PROG(MAGICK,Magick++-config,yes,no)
-if test "$MAGICK" = yes; then
-	AC_LANG_PUSH(C++)
-	AC_CHECK_HEADER(magick/api.h,MAGICK_H=yes,MAGICK_H=no)
-	AC_LANG_POP(C++)
-	if test "$MAGICK_H" = yes; then
-		# AC_CHECK_HEADER a C++ headers !
-		AC_LANG_PUSH(C++)
-		AC_CHECK_HEADER(Magick++.h,MAGICKPP_H=yes,MAGICKPP_H=no)
-		AC_LANG_POP(C++)
-		if test "$MAGICKPP_H" = yes; then
-			AC_CHECK_LIB(bz2,BZ2_bzopen,BZ=yes,BZ=no)
-			if test "$BZ" = yes; then
-	  			MAGICK_LDFLAGS='`Magick++-config --ldflags --libs`'
-  				MAGICK_INCFLAGS='`Magick++-config --cppflags`'
-    				AC_DEFINE(HAVE_MAGICK,1,[use Magick])
-			fi
-		fi
+	PKG_CHECK_MODULES([MAGICK], [Magick++],[MAGICK="yes"],[MAGICK="no"])
+	if test "$MAGICK" = "yes"; then
+		AC_DEFINE(HAVE_MAGICK,1,[use Magick])
 	else
-	MAGICKPP_H="-"
+		if test "$USE_IMAGEMAGICK" = "yes"; then
+			AC_ERROR([Explicit --enable-ImageMagick request but required Magick++ module not found])
+		fi
 	fi
 else
-	MAGICK_H="-"
-	MAGICKPP_H="-"
-fi
-else
 	MAGICK="X"
-	MAGICK_H="X"
-	MAGICKPP_H="X"
-	BZ="X"
 fi
 
 ############# QSA ###################################
@@ -473,8 +454,13 @@
 	AC_CHECK_HEADER(kexidb/driver.h,KEXIDB_H=yes,KEXIDB_H="no")
 	AC_LANG_POP(C++)
 	if test "$KEXIDB_H" = yes; then
+		if test -n "$KEXIDB_DIR"; then
 		KEXIDB_LDFLAGS="-L$KEXIDB_DIR/lib -L$KEXIDB_DIR/lib64 -lkexidb -lkexidbparser"
 		KEXIDB_INCFLAGS="-I$KEXIDB_DIR -I$KEXIDB_DIR/include -I$KDEDIR/include/kexidb -I$KEXIDB_DIR/include/kexidb"
+		else
+		KEXIDB_LDFLAGS="-lkexidb -lkexidbparser"
+		KEXIDB_INCFLAGS="-I$KDEDIR/include/kexidb -I$KEXIDB_DIR/include/kexidb"
+		fi
 		AC_DEFINE(HAVE_KEXIDB,1,[use the KexiDB library])
 	fi
 else
@@ -580,8 +566,6 @@
 AC_ARG_ENABLE(system-liborigin,AC_HELP_STRING([--enable-system-liborigin],[use the system liborigin library (default=auto)]),
 [USE_SYSTEM_LIBORIGIN="$enableval"])
 
-LIBORIGIN_INCFLAGS=""
-LIBORIGIN_LDFLAGS=""
 
 if test "$USE_SYSTEM_LIBORIGIN" != no; then
 	AC_CHECK_LIB(origin,main,LIBORIGIN=yes,LIBORIGIN=no)
@@ -600,7 +584,6 @@
 EOF
 			${CXX} -c liborigin-test.cpp
 			if test $? -eq 0; then
-				LIBORIGIN_LDFLAGS="-lorigin"
 				LIBORIGIN="yes"
 			else
 				LIBORIGIN="using included version."
@@ -614,10 +597,7 @@
 	fi
 fi
 
-if test "$LIBORIGIN" != yes; then
-	LIBORIGIN_LDFLAGS="../liborigin-20070926/OPJFile.cpp"
-	LIBORIGIN_INCFLAGS="-I../liborigin-20070926"
-fi
+AM_CONDITIONAL([USE_SYSTEM_LIBORIGIN], [test "x$LIBORIGIN" = "xyes"])
 
 #################### QHULL ###############################################
 AC_ARG_ENABLE(qhull,AC_HELP_STRING([--enable-qhull],[use the qhull library (default=auto)]),
@@ -643,8 +623,6 @@
 AC_SUBST(FFTW_LDFLAGS)
 AC_SUBST(FFTW3_LDFLAGS)
 AC_SUBST(JASPER_LDFLAGS)
-AC_SUBST(MAGICK_LDFLAGS)
-AC_SUBST(MAGICK_INCFLAGS)
 AC_SUBST(QSA_LDFLAGS)
 AC_SUBST(NETCDF_LDFLAGS)
 AC_SUBST(NETCDF_INCFLAGS)
@@ -663,8 +641,6 @@
 AC_SUBST(KEXIDB_INCFLAGS)
 AC_SUBST(R_LDFLAGS)
 AC_SUBST(R_INCFLAGS)
-AC_SUBST(LIBORIGIN_INCFLAGS)
-AC_SUBST(LIBORIGIN_LDFLAGS)
 AC_SUBST(QHULL_DIR)
 AC_SUBST(HDF5_LDFLAGS)
 
@@ -749,10 +725,7 @@
 ps2pdf :		$PS2PDF	(used dynamical)
 texvc :			$TEXVC	(used dynamical)
 ocaml :			$OCAML
-ImageMagick++ :		$MAGICK
-ImageMagick-devel :	$MAGICK_H
-ImageMagick++-devel :	$MAGICKPP_H
-bzip2-devel :		$BZ
+ImageMagick++ (pc):	$MAGICK
 fftw3 :			$FFTW3
 fftw3 devel :		$FFTW3_H
 fftw3 threads :		$FFTW3_THREADS
diff -Nurd -x'*~' LabPlot-1.6.0.2.orig/src/Makefile.am LabPlot-1.6.0.2/src/Makefile.am
--- LabPlot-1.6.0.2.orig/src/Makefile.am	2008-03-31 04:38:30.000000000 -0400
+++ LabPlot-1.6.0.2/src/Makefile.am	2010-08-22 15:05:40.000000000 -0400
@@ -23,19 +23,27 @@
 ProjectDialog.cc PruneListDialog.cc PstoEditDialog.cc Rect.cc RegressionListDialog.cc RichTextWidget.cc RInterface.cc \
 SeasonalListDialog.cc SmoothListDialog.cc Spreadsheet.cc SpreadsheetPropertiesDialog.cc SpreadsheetValuesDialog.cc \
 Style.cc SummaryRListDialog.cc Symbol.cc TestsRListDialog.cc TitleDialog.cc WaveletListDialog.cc Worksheet.cc \
-WorksheetDialog.cc WrapperFactory.cc
+WorksheetDialog.cc WrapperFactory.cc $(LIBORIGIN_SOURCES)
+
+if USE_SYSTEM_LIBORIGIN
+LIBORIGIN_LDFLAGS=-lorigin
+else
+LIBORIGIN_SOURCES=../liborigin-20070926/OPJFile.cpp
+LIBORIGIN_INCFLAGS=-I../liborigin-20070926
+endif
 
 # 04-07-06 : removed -lstdc++
-LabPlot_LDFLAGS = $(LIB_KDEUI) $(GSL_LDFLAGS) $(JASPER_LDFLAGS) \
-$(MAGICK_LDFLAGS) $(FFTW_LDFLAGS) $(FFTW3_LDFLAGS) $(QSA_LDFLAGS) \
+LabPlot_LDADD = libLabPlot.la ../cephes/libLabPlotcephes.la \
+$(LIB_KDEUI) $(GSL_LDFLAGS) $(JASPER_LDFLAGS) \
+$(MAGICK_LIBS) $(FFTW_LDFLAGS) $(FFTW3_LDFLAGS) $(QSA_LDFLAGS) \
 $(NETCDF_LDFLAGS) $(CDF_LDFLAGS) $(AUDIOFILE_LDFLAGS) $(GL_LDFLAGS) $(QWT3D_LDFLAGS) $(KEXIDB_LDFLAGS) \
--lkdeprint -lkparts $(all_libraries) $(LIBUNDO_LDFLAGS) $(TIFF_LDFLAGS) $(R_LDFLAGS) $(HDF5_LDFLAGS)
-LabPlot_LDADD = libLabPlot.la ../cephes/libLabPlotcephes.la $(LIBORIGIN_LDFLAGS)
-libLabPlot_la_LDFLAGS = $(LabPlot_LDFLAGS) -version-info 7:0:6 -module $(LIBORIGIN_LDFLAGS)
-libLabPlot_la_LIBADD = ../cephes/libLabPlotcephes.la
+-lkdeprint -lkparts $(all_libraries) $(LIBUNDO_LDFLAGS) $(TIFF_LDFLAGS) $(R_LDFLAGS) $(HDF5_LDFLAGS) \
+$(LIB_QT) $(LIB_KDECORE)
+libLabPlot_la_LDFLAGS = $(LabPlot_LDFLAGS) -version-info 7:0:6
+libLabPlot_la_LIBADD = ../cephes/libLabPlotcephes.la $(LIBORIGIN_LDFLAGS)
 
 # $(FFTW_INCFLAGS) $(GSL_INCFLAGS)
-INCLUDES = $(MAGICK_INCFLAGS) $(NETCDF_INCFLAGS) $(LIBORIGIN_INCFLAGS) \
+INCLUDES = $(LIBORIGIN_INCFLAGS) $(MAGICK_CFLAGS) $(NETCDF_INCFLAGS) \
 $(CDF_INCFLAGS) $(AUDIOFILE_INCFLAGS) $(QWT3D_INCFLAGS) $(KEXIDB_INCFLAGS) $(R_INCFLAGS) $(all_includes)
 
 METASOURCES = AUTO
@@ -50,15 +58,8 @@
 rc_DATA = LabPlotui.rc
 
 install-data-local:
-	rm -rf $(DESTDIR)$(kde_bindir)/labplot
-	if ! test -e $(DESTDIR)/$(kde_bindir)/labplot; then \
-		ln -fs LabPlot $(DESTDIR)$(kde_bindir)/labplot; \
-	fi
 
 uninstall-local:
-	rm -f $(DESTDIR)$(kde_appsdir)/Applications/LabPlot.desktop
-	rm -f $(DESTDIR)$(kde_appsdir)/Applications/labplot.desktop
-	rm -rf $(DESTDIR)$(kde_bindir)/labplot
 
 mimedir = $(kde_mimedir)/application
 mime_DATA = x-lpl.desktop x-lml.desktop
diff -Nurd -x'*~' LabPlot-1.6.0.2.orig/src/constants.h LabPlot-1.6.0.2/src/constants.h
--- LabPlot-1.6.0.2.orig/src/constants.h	2008-03-31 04:38:30.000000000 -0400
+++ LabPlot-1.6.0.2/src/constants.h	2010-08-21 17:56:26.000000000 -0400
@@ -220,7 +220,9 @@
 	{"stokes_cgs",GSL_CONST_CGSM_STOKES},
 	{"f_cgs",GSL_CONST_CGSM_FARADAY},
 	{"e_cgs",GSL_CONST_CGSM_ELECTRON_CHARGE},
+/*	not available in gsl 1.13
 	{"gauss_cgs",GSL_CONST_CGSM_GAUSS},
+*/
 	{"stilb_cgs",GSL_CONST_CGSM_STILB},
 	{"lumen_cgs",GSL_CONST_CGSM_LUMEN},
 	{"lux_cgs",GSL_CONST_CGSM_LUX},
