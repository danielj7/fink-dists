Package: distcc
Version: 2.0.1
Revision: 1
Depends: popt-shlibs
Suggests: ccache
BuildDepends: popt
BuildDependsOnly: true
Maintainer: Benjamin Reed <ranger@befunk.com>
Patch: %f.patch
Source: http://%n.samba.org/ftp/%n/%n-%v.tar.bz2
Source-MD5: ffa89d1ce43b317fc67038c08200b9bc
ConfigureParams: --mandir=%p/share/man --infodir=%p/share/info
SetCPPFLAGS: -no-cpp-precomp -I%p/include
SetLDFLAGS: -L%p/lib
CompileScript: <<
#!/bin/sh
  unset DISTCC_HOSTS
  unset CCACHE_PREFIX
  ./configure %c
  make
<<
InstallScript: <<
#!/bin/sh
  install -d -m 755 %i/bin
  make install DESTDIR=%d
  install -d -m 755 %i/etc
  cat <<END > %i/etc/distcc.conf
# note that for distcc to work, you will need to set
# MAKEFLAGS=-j<n> (where "n" is the number of hosts
# listening with distccd or higher)
#
# To do this, uncomment the MAKEFLAGS line in
# %p/etc/profile.d/distcc.csh or
# %p/etc/profile.d/distcc.sh (depending on your shell)

# the hosts to use when compiling
DISTCC_HOSTS='localhost'

# whether to give more verbose output
DISTCC_VERBOSE=0

# the full path of a log file to log to
# DISTCC_LOG=LOGFILE

# disable tcp corks (see manual for details)
DISTCC_TCP_CORK=1
END

  install -d -m 755 %i/etc/profile.d
  cat <<END > %i/etc/profile.d/distcc.sh
# export MAKEFLAGS='-j4'

#### DO NOT EDIT BELOW HERE ####
grep -q -E '^ *DISTCC_HOSTS' %p/etc/distcc.conf    && export DISTCC_HOSTS=\`grep DISTCC_HOSTS %p/etc/distcc.conf | grep -v '^ *#' | tr -d \'\" | cut -d= -f2\`
grep -q -E '^ *DISTCC_VERBOSE' %p/etc/distcc.conf  && export DISTCC_VERBOSE=\`grep DISTCC_VERBOSE %p/etc/distcc.conf | grep -v '^ *#' | tr -d \'\" | cut -d= -f2\`
grep -q -E '^ *DISTCC_LOG' %p/etc/distcc.conf      && export DISTCC_LOG=\`grep DISTCC_LOG %p/etc/distcc.conf | grep -v '^ *#' | tr -d \'\" | cut -d= -f2\`
grep -q -E '^ *DISTCC_TCP_CORK' %p/etc/distcc.conf && export DISTCC_TCP_CORK=\`grep DISTCC_TCP_CORK %p/etc/distcc.conf | grep -v '^ *#' | tr -d \'\" | cut -d= -f2\`
END
  cat <<END > %i/etc/profile.d/distcc.csh
# setenv MAKEFLAGS '-j4'

#### DO NOT EDIT BELOW HERE ####
grep -q -E '^ *DISTCC_HOSTS' %p/etc/distcc.conf    && setenv DISTCC_HOSTS \`grep DISTCC_HOSTS %p/etc/distcc.conf | grep -v '^ *#' | tr -d \'\" | cut -d= -f2\`
grep -q -E '^ *DISTCC_VERBOSE' %p/etc/distcc.conf  && setenv DISTCC_VERBOSE \`grep DISTCC_VERBOSE %p/etc/distcc.conf | grep -v '^ *#' | tr -d \'\" | cut -d= -f2\`
grep -q -E '^ *DISTCC_LOG' %p/etc/distcc.conf      && setenv DISTCC_LOG \`grep DISTCC_LOG %p/etc/distcc.conf | grep -v '^ *#' | tr -d \'\" | cut -d= -f2\`
grep -q -E '^ *DISTCC_TCP_CORK' %p/etc/distcc.conf && setenv DISTCC_TCP_CORK \`grep DISTCC_TCP_CORK %p/etc/distcc.conf | grep -v '^ *#' | tr -d \'\" | cut -d= -f2\`
END

 chmod 755 %i/etc/profile.d/*
<<
SplitOff: <<
  Package: %N-default
  Depends: %N (>= %v-%r), ccache (>= 2.2), ccache-default (>= 2.2)
  Description: Enable distcc+ccache by default
  DocFiles: COPYING*
  RuntimeVars: <<
    CCACHE_PREFIX: distcc
  <<
<<
ConfFiles: %p/etc/distcc.conf
DocFiles: AUTHORS COPYING* DEPENDENCIES INSTALL *NEWS README
Description: Distributed compilation tool
DescDetail: <<
distcc is a program to distribute compilation of C or C++ code
across several machines on a network. distcc should always
generate the same results as a local compile, is simple to
install and use, and is often two or more times faster than a
local compile.
<<
DescUsage: <<
To use distcc, you must set the DISTCC_HOSTS environment variable
to a list of hosts that have the distcc daemon running.  See the
distcc manpage for details on how to use distcc as your compiler.

To use distcc by default, in conjunction with ccache, install the
distcc-default package.
<<
Homepage: http://distcc.samba.org/
License: GPL
