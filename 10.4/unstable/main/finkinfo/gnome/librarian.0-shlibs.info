Package: librarian.0-shlibs
Version: 0.6.0
Revision: 1002

Source: http://rarian.freedesktop.org/Releases/rarian-%v.tar.bz2
Source-MD5: 23772a3b0f882d13c86dd9fa67bb21bf

PatchFile: %n.patch
PatchFile-MD5: 8cdc873b1c7017abf5f45fe780309374
BuildDepends: fink (>= 0.24.12-1)
Depends: xdg-base
GCC: 4.0

ConfigureParams: --disable-dependency-tracking --disable-skdb-update --libdir=%p/lib/librarian.0

InstallScript: <<
	make install DESTDIR=%d

	mv %i/lib/librarian.0/pkgconfig %i/lib
	perl -pi -e 's,libdir=.*,libdir=%p/lib,' %i/lib/pkgconfig/rarian.pc
	ln -s librarian.0/librarian.{a,dylib,la} %i/lib
<<
DocFiles: AUTHORS COPYING* ChangeLog NEWS README TODO

Shlibs: %p/lib/librarian.0/librarian.0.dylib 1.0.0 %n (>= 0.5.6-1)

SplitOff: <<
	Package: librarian.0-dev
	Depends: %N (= %v-%r), rarian (= %v-%r)
	BuildDependsOnly: true
	Files: <<
		include
		lib/librarian.{a,dylib,la}
		lib/librarian.0/librarian.{a,dylib,la}
		lib/pkgconfig
		share/help
		share/librarian/manual
	<<
	DocFiles: AUTHORS COPYING* ChangeLog NEWS README TODO
<<
SplitOff2: <<
	Package: rarian-compat
	Depends: rarian (= %v-%r)
	Replaces: scrollkeeper
	Files: bin/scrollkeeper*
	InstallScript: mkdir -p %i/var/lib/scrollkeeper
	DocFiles: AUTHORS COPYING* ChangeLog NEWS README TODO
	DescUsage: <<
		This package reimplements the old "scrollkeeper"
		package using rarian.
	<<

	PostInstScript: <<
		case "$1" in
			configure)
				scrollkeeper-update -q
				;;
		esac
	<<
	PostRmScript: <<
		case "$1" in
			abort-install|purge|remove)
				rm -rf %p/var/lib/scrollkeeper/*
				;;
		esac
	<<
<<
SplitOff3: <<
	Package: rarian
	Depends: %N (= %v-%r), libxslt-bin
	Files: <<
		bin
		share/librarian
	<<
	DocFiles: AUTHORS COPYING* ChangeLog NEWS README TODO
<<

DescPackaging: <<
	Upstream doesn't understand API versioning. Fake a fink idea
	of libversion by placing it in a subdir and link it back from
	lib/ so other packages won't have to worry about this mess.
	See: https://bugs.freedesktop.org/show_bug.cgi?id=11988

	Import patches from gentoo portage package:
		rarian-0.6.0-posix-getopt.patch
		rarian-0.6.0-reg-return.patch
	posix-getopt avoids needing rarian:Depends:getoptbin

	Needs Depends:docbook-dtd somewhere?
<<
DescUsage: <<
 For fink packager:
  If your package installs .omf file(s), be sure to follow these rules:

  1. Remove following line (usually in omf-install/Makefile.in), which
     will modify files in %p directly.

     -scrollkeeper-update -p $(scrollkeeper_localstate_dir)

     Modern packages may support a --disable-scrollkeeper flag instead
     (pass via ConfigureParams).

  2. Add dependency on rarian-compat.

     Depends: ..., rarian-compat

     You can specify "scrollkeeper" instead, but that package is
     deprecated and des nothing except install "rarian-compat".

  3. Add PostInstScript and PostRmScript.

     PostInstScript: <<
       if [ configure = "$1" ]; then
         scrollkeeper-update -q
       fi
     <<
     PostRmScript: <<  
       if [ remove != "$1" ]; then
         scrollkeeper-update -q
       fi
     <<

  The scrollkeeper-* commands are now in rarian-compat and are
  actually implemented by the rarian system. Eventually rarian will
  not need the scrollkeeper-update call, fink packages will be able to
  eliminate these PostInstScript and PostRmScript fragments and the
  Depends:scrollkeeper, so not worth updating them to use the
  underlying rarian commands vs scrollkeeper-update.
<<
Description: Helpfile/documentation system
License: GPL
Homepage: http://rarian.freedesktop.org
Maintainer: Daniel Macks <dmacks@netspace.org>
