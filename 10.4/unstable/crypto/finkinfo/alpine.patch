diff -Naur alpine-2.00.orig/imap/Makefile alpine-2.00/imap/Makefile
--- alpine-2.00.orig/imap/Makefile	2009-07-25 18:19:58.000000000 -0700
+++ alpine-2.00/imap/Makefile	2009-07-26 11:01:36.000000000 -0700
@@ -416,9 +416,11 @@
 
 oxp:	an
 	$(TOUCH) ip6
+	MAC_OSX_KLUDGE=$(shell if [ -e $(SDKROOT)/usr/include/pam ]; then echo "-DMAC_OSX_KLUDGE=1"; fi)
+
 	$(BUILD) BUILDTYPE=osx IP=$(IP6) EXTRAAUTHENTICATORS="$(EXTRAAUTHENTICATORS) gss" \
 	PASSWDTYPE=pam \
-	EXTRACFLAGS="$(EXTRACFLAGS) -DMAC_OSX_KLUDGE=1" \
+	EXTRACFLAGS="$(EXTRACFLAGS) $(MAC_OSX_KLUDGE)" \
 	SPECIALS="SSLINCLUDE=/usr/include/openssl SSLLIB=/usr/lib SSLCERTS=/System/Library/OpenSSL/certs SSLKEYS=/System/Library/OpenSSL/private GSSINCLUDE=/usr/include GSSLIB=/usr/lib PAMDLFLAGS=-lpam"
 
 osx:	osxok an
