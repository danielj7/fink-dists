Package: nexus
Version: 1.5.0
Revision: 1
BuildDepends: fink (>= 0.28.0-1)
Depends: daemonic, system-java (>= 1.5-1)
Source: http://%n.sonatype.org/downloads/%n-webapp-%v-bundle.tar.gz
Source-MD5: 0ac5537c6b8ad753a85b19cc5f7a6f48
SourceDirectory: %n-webapp-%v
PatchFile: %n.patch
PatchFile-MD5: 2c5c72685009da9ae53803f032f9e997
Type: java(1.5)
ConfFiles: <<
	%p/lib/nexus/conf/classworlds.conf
	%p/lib/nexus/conf/jetty.xml
	%p/lib/nexus/conf/plexus.properties
	%p/lib/nexus/conf/plexus.xml
	%p/lib/nexus/conf/wrapper.conf
	%p/lib/nexus/runtime/apps/nexus/conf/ehcache.xml
	%p/lib/nexus/runtime/apps/nexus/conf/log4j.properties
<<
PatchScript: sed -e 's,@FINKPREFIX@,%p,g' %{PatchFile} | patch -p1
CompileScript: echo "none needed"
InstallScript: <<
#!/bin/sh -ex

	install -d -m 755 "%i/bin" "%i/etc" "%i/lib/nexus" "%i/var/log/nexus" "%i/var/run/nexus"

	rsync -avr ./ %i/lib/nexus/

	ln -sf "%p/lib/nexus/conf" "%i/etc/nexus"

	ln -sf "%p/var/log/nexus" "%i/lib/nexus/logs"
	rm -rf "%i/lib/nexus/logs"

	cat <<END >"%i/bin/nexus"
#!/bin/sh

echo "- running nexus as 'nobody'"
sudo -u nobody "%p/lib/nexus/bin/jsw/macosx-universal-32/nexus" "\$@"
END
	chmod 755 "%i/bin/nexus"
<<

PostInstScript: <<
	chown -R nobody "%p/var/log/nexus" "%p/var/run/nexus"
	daemonic install %N
<<
PreRmScript: <<
	if [ $1 != "upgrade" ]; then
		daemonic remove "%N" || true
		"%p/bin/%N" stop || true
	fi
<<
DaemonicFile: <<
<service>
	<description>Maven Repository Manager</description>
	<message>Nexus Maven Repository Manager</message>

	<daemon name="nexus">
		<executable background="no">%p/bin/nexus</executable>
		<parameters>start</parameters>
		<pidfile>%p/lib/nexus/bin/jsw/macosx-universal-32/nexus-webapp.pid</pidfile>
	</daemon>

</service>
<<
DocFiles: *.txt
Homepage: http://nexus.sonatype.org/
Maintainer: Benjamin Reed <nexus@fink.racoonfink.com>
Description: Maven repository manager
DescDetail: <<
Nexus manages software "artifacts" required for development, deployment, and
provisioning.  If you develop software, Nexus can help you share those
artifacts with other developers and end-users.

Maven's central repository has always served as a great convenience for users
of Maven, but it has always been recommended to maintain your own repositories
to ensure stability within your organization.  Nexus greatly simplifies the
maintenance of your own internal repositories and access to external
repositories.  With Nexus you can completely control access to, and deployment
of, every artifact in your organization from a single location.  Now you can
setup a Maven Repository in just minutes with Nexus.
<<
DescUsage: <<
To start the Nexus repository manager, just run "%p/bin/nexus start".  It will
ask for your password so that it can run as the 'nobody' user.

Then, point your browser at:

  http://localhost:8081/nexus

The default administrator user is "admin" with password "admin123".
<<
License: GPL
