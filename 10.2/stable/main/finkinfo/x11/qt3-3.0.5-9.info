Package: qt3
Version: 3.0.5
Revision: 9
GCC: 3.1
Source: mirror:sourceforge:fink/qt-x11-free-%v.tar.bz2
SourceDirectory: qt-%v
Description: Cross-Platform GUI application framework
Depends: dlcompat (>= 20020929), libgl, freetype2-shlibs (>= 2.0.8), libpng-shlibs (>= 1.0.12), libjpeg-shlibs (>= 6b), %N-shlibs (>= %v-%r)
Suggests: libpng, libjpeg, freetype2
BuildDepends: fink (>= 0.10.0), freetype2 (>= 2.0.8), libpng (>= 1.0.12), libjpeg (>= 6b), dlcompat (>= 20020929), dlcompat-dev
Replaces: qt, qt2, %N-doc
Conflicts: qt, qt2
SetLDFLAGS: -L.
BuildDependsOnly: true
SourceDirectory: qt-x11-free-%v
PatchScript: sed 's|@PREFIX@|%p|g' <%a/%f.patch | patch -p1
CompileScript: <<
#!/bin/sh
 export QTDIR=`pwd`
 export DYLD_LIBRARY_PATH="$QTDIR/lib:%p/lib:$DYLD_LIBRARY_PATH"
 export PATH="$QTDIR/bin:$PATH"
 export QMAKESPEC=$QTDIR/mkspecs/darwin-g++
 echo "yes" | ./configure \
	-prefix %p \
	-bindir %p/bin \
	-docdir %p/share/doc/%n/html \
	-datadir %p/share/qt \
	-headerdir %p/include \
	-libdir %p/lib \
	-plugindir %p/lib/qt-plugins \
	-system-zlib \
	-system-libpng \
	-system-libjpeg \
	-qt-gif \
	-plugin-imgfmt-png \
	-qt-imgfmt-png \
	-plugin-imgfmt-jpeg \
	-qt-imgfmt-jpeg \
	-plugin-imgfmt-mng \
	-qt-imgfmt-mng \
	-no-g++-exceptions \
	-stl \
	-thread \
	-shared \
	-sm \
	-xft \
	-xrender \
	-xkb \
	-xinerama \
	-buildkey qt3-jaguar \
	-platform darwin-g++ \
	-xplatform darwin-g++ \
	`cat /tmp/qt-build-options`

 make -j4 INSTALLPREFIX=%p
<<
InstallScript: <<
#!/bin/sh
 mkdir -p %i/share/qt
 export QTDIR=`pwd`
 export DYLD_LIBRARY_PATH="$QTDIR/lib:%p/lib:$DYLD_LIBRARY_PATH"
 export PATH="$QTDIR/bin:$PATH"
 export QMAKESPEC=$QTDIR/mkspecs/darwin-g++
 make -j4 install INSTALL_ROOT=%d INSTALLPREFIX=%p
 pushd lib
 gnutar -cf - lib* | ( cd %i/lib; gnutar -xf -)
 popd
 mkdir -p %i/etc/profile.d
 install -m 755 qt.sh %i/etc/profile.d/
 install -m 755 qt.csh %i/etc/profile.d/
 mv %i/bin/assistant.app/Contents/MacOS/assistant %i/bin
 mv %i/bin/designer.app/Contents/MacOS/designer %i/bin
 mv %i/bin/linguist.app/Contents/MacOS/linguist %i/bin
 mv %i/bin/qtconfig.app/Contents/MacOS/qtconfig %i/bin
 rm -rf %i/bin/assistant.app
 rm -rf %i/bin/designer.app
 rm -rf %i/bin/linguist.app
 rm -rf %i/bin/qtconfig.app
 pushd %i/lib
 ln -s libqt-mt.3.0.5.dylib libqt-mt.3.0.4.dylib
 popd
<<
SplitOff: <<
  Package: %N-shlibs
  Suggests: %N-bin
  Replaces: qt-shlibs, qt
  Conflicts: qt-shlibs, qt
  DocFiles: LICENSE.GPL LICENSE.QPL README.QT README 
  Depends: libjpeg-shlibs, libpng-shlibs, freetype2-shlibs, dlcompat, x11
  Files: <<
    lib/libqt-mt.*.dylib
    lib/libeditor.*.dylib
    lib/libqui.*.dylib
    lib/qt-plugins/
  <<
<<
SplitOff2: <<
  Package: %N-doc
  Replaces: qt-doc, qt2, qt
  Conflicts: qt-doc, qt2, qt
  Depends: %N-shlibs (>= %v-%r)
  DocFiles: LICENSE.GPL LICENSE.QPL
  Files: <<
    share/doc/%N/html/
  <<
<<
SplitOff3: <<
  Package: %N-bin
  Conflicts: qt-bin, qt2, qt
  Replaces: qt-bin, qt2, qt
  Depends: %N (>= %v-%r)
  DocFiles: LICENSE.GPL LICENSE.QPL
  Files: <<
    bin/assistant
    bin/designer
    bin/linguist
    bin/lrelease
    bin/lupdate
    bin/qm2ts
  <<
<<
DocFiles: LICENSE.GPL LICENSE.QPL
DescPort: <<
Uses a custom configure script. Patch adds config files to build
under Darwin, identifies OS as FreeBSD to prevent building of QtMac stuff
(which is not available in the free version).

unixmake.cpp patched so QMAKE_INCDIR, QMAKE_LIBDIR put at end of INCPATH 
(instead of beginning).  This prevents old qt headers and libs 
(installed in %p/include and and %p/lib) from being used.

Added -no-g++-exceptions to configure line to speed qt up.

Note that as of 3.0.4-1, compatibility_version and current_version are
being set correctly.  If you have anything built against a qt3 package
older than 3.0.4-1, they will probably need to be rebuilt.

Also note that in 3.0.5, TrollTech broke binary compatibility for QT
plugins, so you may need to recompile some qt applications.
<<
License: GPL
Maintainer: Benjamin Reed <ranger@befunk.com>
Homepage: http://www.trolltech.com/
