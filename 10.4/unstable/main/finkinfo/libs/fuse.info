Package: fuse
Version: 0.1.7
Revision: 1
Source: http://dev.kublai.com/macfuse-%v.tar.gz
Source-MD5: a71745a8b8f9afe3391e64848ebcd84d
Source2: mirror:sourceforge:%n/%n-2.6.1.tar.gz
Source2-MD5: 13e1873086a1d7a95f470bbc7428c528

PatchScript: <<
sed -i.bak -e 's,/Library/Extensions/,%p/lib/%n/,' fusefs/load/load_fusefs.c
sed -i.bak -e 's,/Library/Extensions/,%p/lib/%n/,' \
  -e 's,/System/Library/Filesystems/,%p/lib/%n/,' \
  libfuse/fuse-2.6.1-macosx.patch
cd ../fuse-2.6.1 && patch -p1 < ../macfuse-%v/libfuse/fuse-2.6.1-macosx.patch
sed -i.bak -e 's, -pthread,,' -e'/Cflags:/s,64,64 -D__FreeBSD__=10,' \
  ../fuse-2.6.1/fuse.pc.in
sed -i.bak -e 's,-pthread,,' ../fuse-2.6.1/configure
<<
CompileScript: <<
#!/bin/sh -ev
if test "%m" = "powerpc"; then ARCHS=ppc; else ARCHS=i386; fi
cd fusefs
xcodebuild -alltargets SDKROOT= ARCHS=$ARCHS
cd ../../fuse-2.6.1
CFLAGS="-D__FreeBSD__=10 -O -g" ./configure --prefix=%p --disable-dependency-tracking
make
<<
InstallScript: <<
mkdir -p %i/lib/%n
cp -R fusefs/build/Release/fusefs.kext %i/lib/%n
cp fusefs/build/Release/load_fusefs %i/lib/%n/fusefs.kext/Contents/Resources/
# TODO: figure out how to install this in /System/Library/Filesystems
cp fusefs/build/Release/mount_fusefs fusefs/fusefs.fs/
cp -R fusefs/fusefs.fs %i/lib/%n
cd ../fuse-2.6.1 && make install DESTDIR=%d
<<
PreRmScript: /sbin/kextunload %p/lib/fuse/fusefs.kext || true
PostInstScript: <<
chown -R root:wheel %p/lib/%n/fusefs.kext
#chown -R root:wheel /System/Library/Filesystems/fusefs.fs
chmod u+s %p/lib/%n/fusefs.kext/Contents/Resources/load_fusefs
<<
DocFiles: COPYING HOWTO

SplitOff: <<
  Package: fuse-dev
  Depends: fuse-shlibs (= %v-%r), pkgconfig
  Replaces: fuse (<< 0.1.0b006-3)
  BuildDependsOnly: True
  DocFiles: COPYING
  Files: <<
    include 
    lib/libfuse.dylib lib/libfuse.a lib/libfuse.la
    lib/libulockmgr.dylib lib/libulockmgr.a lib/libulockmgr.la
    lib/pkgconfig
  <<
  Description: Filesystem in Userspace (development resources)
  DescDetail: <<
    These are the header and library files required for building FUSE filesystems.
  <<
<<

SplitOff2: <<
  Package: fuse-shlibs
  Depends: fuse (= %v-%r)
  Replaces: fuse (<< 0.1.0b006-3)
  DocFiles: COPYING
  Files: <<
    lib/libfuse.0.dylib
    lib/libulockmgr.1.dylib
  <<
  Shlibs: <<
    %p/lib/libfuse.0.dylib 1.0.0 fuse (>= 0.1.0b006-1)
    %p/lib/libulockmgr.1.dylib 2.0.0 fuse (>= 0.1.0b006-1)
  <<
<<

Description: Filesystem in Userspace
DescDetail: <<
This is MacFUSE, a port of FUSE (filesystem in userspace) for OS X.
FUSE makes it possible to add new file systems just by running a regular,
unprivileged program. For example, the sshfs FUSE client allows you to
mount a remote server's filesystem without any requirement other than
SSH access (sshfs is packaged separately).
<<
License: BSD
Homepage: http://fuse.sourceforge.net/
Maintainer: Brendan Cully <bcully@users.sourceforge.net>
