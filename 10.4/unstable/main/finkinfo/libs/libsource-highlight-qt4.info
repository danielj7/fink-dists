Info2:<<
Package: libsource-highlight-qt4%type_pkg[qt]
Version: 0.1
Revision: 1
Type: qt (mac x11)
Description: Qt highlighting lib with source-highlight
DescDetail: <<
	Source-highlight-qt is a library for performing syntax highlighting
	in Qt documents by relying on GNU Source-Highlight library.
<<
License: GPL3
Homepage: http://srchiliteqt.sourceforge.net/
Maintainer: Daniel Johnson <daniel@daniel-johnson.org>

Source: mirror:sourceforge:srchiliteqt/source-highlight-qt-%v.tar.gz
Source-MD5: 2204d7d8185aa786171b0ec9cda904af

BuildDepends: <<
	boost1.35.nopython,
	libiconv-dev,
	libpng3,
	libsource-highlight (>= 3.1-1),
	pkgconfig,
	qt4-%type_pkg[qt] (>= 4.5.0-1),
	( %type_pkg[qt] = x11 ) expat1,
	( %type_pkg[qt] = x11 ) fontconfig2-dev,
	( %type_pkg[qt] = x11 ) freetype219,
	( %type_pkg[qt] = x11 ) glib2-dev,
	( %type_pkg[qt] = x11 ) libgettext3-dev,
	( %type_pkg[qt] = x11 ) x11-dev
<<
Depends: %N-shlibs (= %v-%r)
BuildDependsOnly: true
Conflicts: libsource-highlight-qt4mac, libsource-highlight-qt4x11
Replaces: libsource-highlight-qt4mac, libsource-highlight-qt4x11

PatchScript: <<
	perl -pi -e 's,^Libs:.*$,Libs: -L${libdir} -lsource-highlight-qt4,' source-highlight-qt4.pc.in
	perl -pi -e 's,^Cflags:.*$,Cflags: -I${includedir},' source-highlight-qt4.pc.in
<<

CompileScript: <<
	#!/bin/bash -ev
	# This bit enables stripping unused libs on 10.5 and later.
	let version=`uname -r | cut -f 1 -d .`
	if [ $version -ge 9 ]; then
		export LDFLAGS="$LDFLAGS -Wl,-dead_strip_dylibs"
	fi

	%{default_script}
<<

ConfigureParams: --disable-static --disable-dependency-tracking --enable-qt4 --with-qt=%p/lib/qt4-%type_pkg[qt]/bin --libdir=%p/lib/qt4-%type_pkg[qt]/lib

InfoTest: TestScript: make check || exit 2

InstallScript: <<
	make install DESTDIR=%d
	mv %i/share/doc/source-highlight-qt %i/share/doc/%N
	mv %i/lib/qt4-%type_pkg[qt]/lib/pkgconfig %i/lib
	#No need for dependency_libs in .la files if not building static libs
	perl -pi -e "s/dependency_libs=.*$/dependency_libs=''/" %i/lib/qt4-%type_pkg[qt]/lib/*.la
	perl -pi -e "s/inherited_linker_flags=.*$/inherited_linker_flags=''/" %i/lib/qt4-%type_pkg[qt]/lib/*.la
<<

DocFiles: AUTHORS ChangeLog COPYING NEWS README TODO.txt
InfoDocs: source-highlight-qt.info

SplitOff: <<
	Package: %N-shlibs
	
	Depends: <<
		libiconv,
		libpng3-shlibs,
		libsource-highlight-shlibs (>= 3.1-1),
		qt4-%type_pkg[qt]-core-shlibs (>= 4.5.0-1),
		qt4-%type_pkg[qt]-gui-shlibs (>= 4.5.0-1),
		( %type_pkg[qt] = x11 ) expat1-shlibs,
		( %type_pkg[qt] = x11 ) freetype219-shlibs,
		( %type_pkg[qt] = x11 ) glib2-shlibs,
		( %type_pkg[qt] = x11 ) libgettext3-shlibs,
		( %type_pkg[qt] = x11 ) x11-shlibs
	<<
	
	Files: lib/qt4-%type_pkg[qt]/lib/%{Ni}.*.dylib
	Shlibs: %p/lib/qt4-%type_pkg[qt]/lib/%{Ni}.1.dylib 2.0.0 %n (>= 0.1-1)
	DocFiles: AUTHORS ChangeLog COPYING NEWS README TODO.txt
<<
<<
