Package: cargo
Version: 0.15.0
Revision: 2

License: BSD
Homepage: https://github.com/rust-lang/cargo
Maintainer: Brendan Cully <fink@brendan.cully.org>

BuildDepends: rustc, cmake, openssl100-dev
Depends: rustc, openssl100-shlibs

Source: https://github.com/rust-lang/%n/archive/%v.tar.gz
Source-MD5: bfd60ee63635ca0fbaa482947142267d
SourceRename: %n-%v.tar.gz

Source2: https://static.rust-lang.org/cargo-dist/2016-03-21/cargo-nightly-x86_64-apple-darwin.tar.gz
Source2-MD5: bf3a8ff918ec4e82b41d5b27600500c6

Source3: https://github.com/rust-lang/rust-installer/archive/4915c7532533319939c18033c62db875717a4d84.zip
Source3-MD5: 340c8dc12dabc8df5af50bcc58ad1875

Source4: https://bitbucket.org/brendan/fink-cargo/downloads/%n-%v-deps.tar.gz
Source4-MD5: fa20611bff1f6499be840db9fbf2a8d9

CompileScript: <<
#!/bin/sh -ex
./configure --disable-debug --disable-cross-tests --cargo=$PWD/../cargo-nightly-x86_64-apple-darwin/cargo/bin/cargo
mv ../rust-installer-4915c7532533319939c18033c62db875717a4d84/* src/rust-installer
mkdir -p .cargo
mv ../vendor .
echo '[registry]' > .cargo/config
echo "index = \"file://$PWD/vendor/index\"" >> .cargo/config
echo '{"dl": "file://'$PWD'/vendor/cache", "api": "https://crates.io/"}' > vendor/index/config.json
(cd vendor/index && git commit -m update .) && true
cat .cargo/config
cat vendor/index/config.json
make VERBOSE=1 CARGOFLAGS=--no-default-features
<<

# Need to capture more dependencies to build test suite
#InfoTest: <<
#  TestScript: <<
#    target/x86_64-apple-darwin/release/cargo test
#  <<
#<<

InstallScript: <<
make CFG_PREFIX=%p DESTDIR=%d install
rm -r %i/lib/rustlib
<<

DocFiles: LICENSE-APACHE LICENSE-MIT LICENSE-THIRD-PARTY README.md

Description: The Rust package manager
DescDetail: <<
Cargo downloads your Rust project's dependencies and compiles your project.

Learn more at http://doc.crates.io/
<<
DescPackaging: <<
The deps are assembled using debian/bootstrap.py and debian/cargo-vendor-pack.py
from the Debian packaging in
https://anonscm.debian.org/git/pkg-rust/cargo.git (branch debian/sid).
They have been adjusted to handle cargo dynamic deps like cfg(windows) in toml.

From within the cargo source tree:

git clone git://github.com/rust-lang/crates.io-index.git /tmp/crates.io-index
path/to/bootstrap.py --no-clone --crate-index /tmp/crates.io-index --download \
    --target x86_64-apple-darwin --target-dir deps
path/to/cargo-vendor-pack.py
tar cpSzf cargo-%v-deps.tar.gz vendor

There seems to be a bug in cargo that requires that the deps include optional
features, so the tarball is larger than it should be.
<<
