Package: firefox
Version: 1.0.7
Revision: 3
Description: Lightweight browser from mozilla.org
License: OSI-Approved
Maintainer: Hanspeter Niederstrasser <nieder@users.sourceforge.net>
Depends: <<
	%N-shlibs (>= %v-%r),
	libpng3-shlibs,
	libjpeg-shlibs,
	glib2-shlibs (>= 2.4.0-1),
	atk1-shlibs (>=1.6.0-1),
	pango1-xft2 (>= 1.4.0-1),
	gtk+2,
	orbit-shlibs,
	libiconv,
	x11,
	libgettext3-shlibs,
	libidl2-shlibs,
	pkgconfig
<<
BuildDepends: <<
	libpng3,
	libjpeg,
	glib2-dev (>= 2.4.0-1),
	atk1 (>=1.6.0-1),
	pango1-xft2-dev (>= 1.4.0-1),
	gtk+2-dev,
	orbit-dev,
	libiconv-dev,
	x11-dev,
	libgettext3-dev,
	libidl2
<<
Source: http://ftp.mozilla.org/pub/mozilla.org/%n/releases/%v/source/%n-%v-source.tar.bz2
SourceDirectory: mozilla
Source-MD5: 5704a8c36de84b408e069afb0c5bc1df
PatchScript: sed 's|@PREFIX@|%p|g' <%a/%n.patch | patch -p1
GCC: 3.3
CompileScript: <<
./configure %c
make -w
<<
InstallScript: <<
#!/bin/sh

make install DESTDIR=%d

# Install NSS headers.
/bin/cp -R -L dist/public/nss %i/include/firefox/nss

# These folders are redundant.
for f in %i/lib/firefox/chrome/*.jar; do
  rm -rf ${f/.jar/}
done

# Install the GNOME .desktop launcher.
install -d -m 755 %i/share/applications
install -c -m 644 fink/applications/* %i/share/applications/

# install the Fink specific prefs file
install -c -m 644 fink/prefs.js %i/lib/firefox/defaults/pref/fink.js
<<
DocFiles: LEGAL LICENSE README.txt
SplitOff: <<
  Package: %N-dev
  Depends: %N (>= %v-%r), libidl2-shlibs, pkgconfig
  Conflicts: mozilla-dev
  BuildDependsOnly: true
  Description: Lightweight browser from mozilla.org
  DocFiles: LEGAL LICENSE README.txt
  Files: bin/firefox-config include lib/pkgconfig lib/firefox/xp* share/aclocal share/idl
<<
SplitOff2: <<
  Package: %N-shlibs
  Depends: gtk+2
  Description: Lightweight browser from mozilla.org
  DocFiles: LEGAL LICENSE README.txt
  Files: lib/firefox/lib*.dylib
  Shlibs: <<
    %p/lib/firefox/libgkgfx.dylib 1.0.0 %n (>= 0.10.1-4)
    %p/lib/firefox/libgtkembedmoz.dylib 1.0.0 %n (>= 0.10.1-4)
    %p/lib/firefox/libgtkxtbin.dylib 1.0.0 %n (>= 0.10.1-4)
    %p/lib/firefox/libjsj.dylib 1.0.0 %n (>= 0.10.1-4)
    %p/lib/firefox/libmozjs.dylib 1.0.0 %n (>= 0.10.1-4)
    %p/lib/firefox/libnspr4.dylib 1.0.0 %n (>= 0.10.1-4)
    %p/lib/firefox/libnss3.dylib 1.0.0 %n (>= 0.10.1-4)
    %p/lib/firefox/libnssckbi.dylib 1.0.0 %n (>= 1.0.6-2)
    %p/lib/firefox/libplc4.dylib 1.0.0 %n (>= 0.10.1-4)
    %p/lib/firefox/libplds4.dylib 1.0.0 %n (>= 0.10.1-4)
    %p/lib/firefox/libsmime3.dylib 1.0.0 %n (>= 0.10.1-4)
    %p/lib/firefox/libsoftokn3.dylib 1.0.0 %n (>= 0.10.1-4)
    %p/lib/firefox/libssl3.dylib 1.0.0 %n (>= 0.10.1-4)
    %p/lib/firefox/libxlibrgb.dylib 1.0.0 %n (>= 0.10.1-4)
    %p/lib/firefox/libxpcom.dylib 1.0.0 %n (>= 0.10.1-4)
    %p/lib/firefox/libxpcom_compat.dylib 1.0.0 %n (>= 0.10.1-4)
    %p/lib/firefox/libxpistub.dylib 1.0.0 %n (>= 0.10.1-4)
  <<
<<
PostInstScript: <<
# register the default chrome and extensions into the browser database
  if [ configure = "$1" ]; then
     MOZILLA_FIVE_HOME=%p/lib/firefox
     export DYLD_LIBRARY_PATH=$MOZILLA_FIVE_HOME
     sudo -H %p/bin/firefox -register || true
  fi
<<
PreRmScript: <<
# If removing, clear out those leftovers that were created by registering
  if [ upgrade != "$1" ]; then
    MOZILLA_FIVE_HOME=%p/lib/firefox
    rm -f ${MOZILLA_FIVE_HOME}/chrome/*.rdf
    rm -rf ${MOZILLA_FIVE_HOME}/chrome/overlayinfo
    rm -f ${MOZILLA_FIVE_HOME}/components/*.dat
    rm -f ${MOZILLA_FIVE_HOME}/components.ini
    rm -rf ${MOZILLA_FIVE_HOME}/extensions
  fi
<<
#PostRmScript: <<
# If upgrading, clear out the registered chrome files from the previous
# version.  Not necessary since format is identical.
#  if [ upgrade = "$1" ]; then
#    MOZILLA_FIVE_HOME=%p/lib/firefox
#    rm -rf ${MOZILLA_FIVE_HOME}/chrome/overlayinfo
#    rm -f ${MOZILLA_FIVE_HOME}/chrome/*.rdf
#    rm -f ${MOZILLA_FIVE_HOME}/components.ini
#    rm -f ${MOZILLA_FIVE_HOME}/components/*.dat
#  fi
#<<
Homepage: http://www.mozilla.org/products/firefox/
DescDetail: <<
Firefox is a free, open-source web browser for Windows, Linux and 
MacOS X and is based on the Mozilla codebase. It is small, fast and easy 
to use, and offers many advantages over Internet Explorer, such as the 
ability to block pop-up windows.
<<
DescUsage: <<
firefox

There is an unresolved issue in upgrading from 1.0 to 1.0.x that leads
to a bus error on start.  If you get this crash on start, erase the file
"~/.mozilla/firefox/randomstring.default/xpti.dat".  Then restart 
Firefoxand everything should work.  You do NOT need to erase your 
entire profile.
<<
#DescPackaging: <<
#<<
DescPort: <<
GTK+2 build of the Mozilla Firefox browser for Mac OS X/X11.  Compiled 
without built-in support for GNOME (except for an app launcher button).

Patch includes fix for bug #257773, which allows building on OS X/X11
w/out the need for setting missing LDFLAGS.

Building with freetype2 is disabled because of incompatabilities with
Xorg X11 (Apple's X11 and Xfree4.4 work though).  FF1.1 should already
have fixed this in the trunk.

ac_add_options --enable-macos-target=10.3 in patch file (.mozconfig) is 
for the minimum OS version that this will compile in.
<<
