
--- xine-lib-1.1.2/configure	2006-07-09 10:51:14.000000000 -0400
+++ xine-lib-1.1.2-patched/configure	2006-07-15 10:54:01.000000000 -0400
@@ -33088,8 +33088,8 @@
         ac_have_xv_static="yes"
         XV_LIB="$xv_path/$XV_LIB"
         ;;
-      x*.so)
-        XV_LIB=`echo $XV_LIB | sed 's/^lib/-l/; s/\.so$//'`
+      x*.dylib)
+        XV_LIB=`echo $XV_LIB | sed 's/^lib/-l/; s/\.dylib$//'`
         ;;
       *)
         { { echo "$as_me:$LINENO: error: sorry, I don't know about $XV_LIB" >&5
@@ -52649,7 +52649,7 @@
         k7cpu="i686"
     fi
 
-                        CFLAGS="-O3 -pipe -fomit-frame-pointer $f_af $f_al $f_aj $m_wm $m_psb -fexpensive-optimizations $f_si -ffast-math $INLINE_FUNCTIONS $CFLAGS"
+                        CFLAGS="-Os -pipe -fno-strict-aliasing -ffast-math $INLINE_FUNCTIONS -no-cpp-precomp -D_INTL_REDIRECT_MACROS $CFLAGS"
 
             DEBUG_CFLAGS="-O $DEBUG_CFLAGS"
 
@@ -52805,7 +52805,7 @@
 enable_armv4l="no"
 
 case "$host_or_hostalias" in
-  i?86-* | k?-* | athlon-* | pentium*-)
+  i?86-*-linux* | k?-* | athlon-* | pentium*-)
 
 cat >>confdefs.h <<_ACEOF
 #define ARCH_X86
@@ -52838,7 +52838,7 @@
 
     enable_ffmmx="yes"
     ;;
-  *darwin*)
+  *-darwin*)
     HOST_OS_DARWIN=1
 
 cat >>confdefs.h <<_ACEOF
@@ -52848,14 +52848,22 @@
 
         AS="$CC"
 
-cat >>confdefs.h <<_ACEOF
+case "$host_or_hostalias" in
+	i?86-*-darwin*)
+		cat >>confdefs.h <<_ACEOF
+#define FPM_INTEL
+#define ARCH_X86
+_ACEOF
+		;;
+	powerpc-*-darwin*)
+		cat >>confdefs.h <<_ACEOF
 #define FPM_PPC
+#define ARCH_PPC
 _ACEOF
+		;;
+esac
 
 
-cat >>confdefs.h <<_ACEOF
-#define ARCH_PPC
-_ACEOF
 
 
     OBJC=${CC:-gcc}
--- xine-lib-1.1.2/misc/cdda_server.c	2006-07-09 10:37:05.000000000 -0400
+++ xine-lib-1.1.2-patched/misc/cdda_server.c	2006-07-15 10:33:12.000000000 -0400
@@ -335,7 +335,9 @@
 
   /* dlopening libdvdcss */
 
-#ifndef _MSC_VER
+#if defined(__APPLE__)
+  dvdcss_library = dlopen("libdvdcss.2.dylib", RTLD_LAZY);
+#elif !defined(_MSC_VER)
   dvdcss_library = dlopen("libdvdcss.so.2", RTLD_LAZY);
 #else
   dvdcss_library = dlopen("libdvdcss.dll", RTLD_LAZY);
@@ -371,7 +373,7 @@
       dvdcss_library = NULL;
     } else if(!dvd_open  || !dvd_close || !dvd_title || !dvd_seek
 	      || !dvd_read || !dvd_error || !dvdcss_version) {
-      fprintf(stderr,  "libdvdread: Missing symbols in libdvdcss.so.2, "
+      fprintf(stderr,  "libdvdread: Missing symbols in libdvdcss, "
 	      "this shouldn't happen !\n");
       dlclose(dvdcss_library);
     }
--- xine-lib-1.1.2/src/input/input_dvd.c	2006-07-09 10:37:35.000000000 -0400
+++ xine-lib-1.1.2-patched/src/input/input_dvd.c	2006-07-15 10:33:12.000000000 -0400
@@ -1784,7 +1784,11 @@
 					       "DVD drive, which you intend to use for playing DVDs."),
 					     10, device_change_cb, (void *)this);
   
+#ifdef __APPLE__
+  if ((dvdcss = dlopen("libdvdcss.2.dylib", RTLD_LAZY)) != NULL) {
+#else
   if ((dvdcss = dlopen("libdvdcss.so.2", RTLD_LAZY)) != NULL) {
+#endif
     /* we have found libdvdcss, enable the specific config options */
     char *raw_device;
     static char *decrypt_modes[] = { "key", "disc", "title", NULL };
--- xine-lib-1.1.2/src/input/libdvdnav/bswap.h	2003-05-26 19:11:44.000000000 -0400
+++ xine-lib-1.1.2-patched/src/input/libdvdnav/bswap.h	2006-07-15 10:33:12.000000000 -0400
@@ -41,6 +41,12 @@
 #define B2N_32(x) x = bswap_32(x)
 #define B2N_64(x) x = bswap_64(x)
 
+#elif defined(__APPLE__)
+#include <libkern/OSByteOrder.h>
+#define B2N_16(x) x = OSSwapBigToHostInt16(x)
+#define B2N_32(x) x = OSSwapBigToHostInt32(x)
+#define B2N_64(x) x = OSSwapBigToHostInt64(x)
+
 #elif defined(__NetBSD__)
 #include <sys/endian.h>
 #define B2N_16(x) BE16TOH(x)
--- xine-lib-1.1.2/src/input/libdvdnav/dvd_input.c	2006-07-09 10:37:37.000000000 -0400
+++ xine-lib-1.1.2-patched/src/input/libdvdnav/dvd_input.c	2006-07-15 10:33:12.000000000 -0400
@@ -364,7 +364,9 @@
 #else
   /* dlopening libdvdcss */
 
-#ifndef WIN32
+#ifdef __APPLE__
+  dvdcss_library = dlopen("libdvdcss.2.dylib", RTLD_LAZY);
+#elif !defined(WIN32)
   dvdcss_library = dlopen("libdvdcss.so.2", RTLD_LAZY);
 #else
   dvdcss_library = dlopen("libdvdcss.dll", RTLD_LAZY);
@@ -400,7 +402,7 @@
       dvdcss_library = NULL;
     } else if(!DVDcss_open  || !DVDcss_close || !DVDcss_title || !DVDcss_seek
 	      || !DVDcss_read || !DVDcss_error || !dvdcss_version) {
-      fprintf(stderr,  "libdvdread: Missing symbols in libdvdcss.so.2, "
+      fprintf(stderr,  "libdvdread: Missing symbols in libdvdcss, "
 	      "this shouldn't happen !\n");
       dlclose(dvdcss_library);
     }
--- xine-lib-1.1.2/src/post/planar/eq.c	2006-07-09 10:40:08.000000000 -0400
+++ xine-lib-1.1.2-patched/src/post/planar/eq.c	2006-07-15 10:33:12.000000000 -0400
@@ -27,6 +27,7 @@
 #include "post.h"
 #include "xineutils.h"
 #include <pthread.h>
+#undef ARCH_X86
 
 
 #if defined(ARCH_X86) || defined(ARCH_X86_64)
--- xine-lib-1.1.2/src/post/planar/eq2.c	2006-07-09 10:40:08.000000000 -0400
+++ xine-lib-1.1.2-patched/src/post/planar/eq2.c	2006-07-15 10:33:12.000000000 -0400
@@ -32,6 +32,7 @@
 #include "xineutils.h"
 #include <math.h>
 #include <pthread.h>
+#undef ARCH_X86
 
 
 /* Per channel parameters */
