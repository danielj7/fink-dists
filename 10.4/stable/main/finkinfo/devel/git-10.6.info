Info2:<<
Package: git
Version: 1.7.9.2
Revision: 1+10.6
Type: pm 5.10.0
Distribution: 10.6

Depends: <<
	error-pm,
	expat1-shlibs,
	libcurl4-shlibs (>= 7.21.4-1),
	libgettext8-shlibs,
	libiconv,
	libintl-pm%type_pkg[pm],
	libpcre1-shlibs
<<
BuildDepends: <<
	expat1,
	fink (>= 0.24.12),
	gettext-tools,
	libcurl4 (>= 7.21.4-1),
	libgettext8-dev,
	libiconv-dev,
	libpcre1,
	system-openssl-dev
<<
Replaces: git-core, git-cvsimport (<< 1.7.2.3-1002), git-archimport (<< 1.7.2.3-1002), git-svn (<< 1.7.2.3-1002)
Conflicts: git-cvsimport (<< 1.7.2.3-1002), git-archimport (<< 1.7.2.3-1002), git-svn (<< 1.7.2.3-1002)

# Tarballs moved to googlecode.com while kernel.org recovers from hacking.

# Source: mirror:custom:/software/scm/git/git-%v.tar.bz2
# Source-MD5: d1e00772cc9dc6c571999feb9e8771ab
# Source2: mirror:custom:/software/scm/git/git-htmldocs-%v.tar.bz2
# Source2-MD5: f698e0abbf1555582e30320930391c59
# Source2ExtractDir: doc
# Source3: mirror:custom:/software/scm/git/git-manpages-%v.tar.bz2
# Source3-MD5: cae559424a62507cb2c15252d85a158e

Source: http://git-core.googlecode.com/files/git-%v.tar.gz
Source-MD5: f2f0fc821ab074862c4a96de3f4cefbe
Source2: http://git-core.googlecode.com/files/git-htmldocs-%v.tar.gz
Source2-MD5: c79c74645306c6dfcd6790afc91391c3
Source2ExtractDir: doc
Source3: http://git-core.googlecode.com/files/git-manpages-%v.tar.gz
Source3-MD5: 5cbad0fe26ca4d15007c7b3a8bc2fa1b

PatchFile: %n.patch
PatchFile-MD5: 7281756a22898c7fc02e386135ea15db
PatchScript: <<
	#!/bin/bash -ev
	%{default_script}
	# Fix up paths in documentation to point to %p.
	perl -pi -e 's,/usr/(share|bin)/git,%p/\1/git,g; s,/usr/libexec,%p/lib,g' ../man1/* ../doc/*
	# Setting these variables in 'config.mak' lets Makefile import them
	# automatically instead of always manually passing them to make.
	cat >> config.mak << EOF
NO_FINK=1
NO_DARWIN_PORTS=1
NO_SVN_TESTS=1
GITWEB_CONFIG_SYSTEM=%p/gitweb.conf
CC_LD_DYNPATH=-L
AR=ar
htmldir=share/doc/git
NO_CROSS_DIRECTORY_HARDLINKS=1
EOF
	perl -pi -e 's/\"\$PERL\"/\$PERL/' git-instaweb.sh
<<

# Test suite hangs now when using multiple processes. :(
UseMaxBuildJobs: false

# Let configure do the work of setting up the environment instead of
# patching and passing things manually to make.
SetCPPFLAGS: -I%p/lib/system-openssl/include
SetLDFLAGS: -L%p/lib/system-openssl/lib -L%p/lib -Wl,-dead_strip_dylibs
# Darwin needs no special flags for pthreads, so set flags to ' ' because
# "-pthreads" causes problems for gcc-4.0.
ConfigureParams: <<
	--libexecdir='${exec_prefix}/lib' \
	--enable-pthreads=' ' \
	--without-python \
	--with-tcltk='/usr/bin/wish' \
	--with-openssl='%p/lib/system-openssl' \
	--with-libpcre=%p
<<

CompileScript: <<
	#!/bin/bash -ev
	let version=`uname -r | cut -f 1 -d .`
	if [ $version -eq 10 ]; then
		./configure --with-perl='/usr/bin/arch -%m perl5.10.0' %c
	elif [ $version -eq 11 ]; then
		./configure --with-perl='/usr/bin/arch -%m perl5.12' %c
	else 
		./configure --with-perl='/usr/bin/perl' %c
	fi
	make
<<

InfoTest: <<
# 	TestDepends: <<
# 		libwww-pm%type_pkg[pm],
# 		svn-swig-pm%type_pkg[pm],
# 		term-readkey-pm%type_pkg[pm]
# 	<<

	TestScript: <<
		#!/bin/bash -ev
		
		# This hackery is needed to get svn tests working with multi-arch perl.
		let version=`uname -r | cut -f 1 -d .`
		if [ $version -eq 10 ]; then
			cat > myperl << EOF
#!/bin/sh
exec /usr/bin/arch -%m perl5.10.0 "\$@"
EOF
			chmod +x myperl; PERL_PATH=`pwd`/myperl
		elif [ $version -eq 11 ]; then
			cat > myperl << EOF
#!/bin/sh
exec /usr/bin/arch -%m perl5.12 "\$@"
EOF
			chmod +x myperl; PERL_PATH=`pwd`/myperl
		else
			PERL_PATH=/usr/bin/perl
		fi

		if [ $UID = 0 ]; then
			# Some tests fail when run as root.
			GIT_SKIP_TESTS='t0001.25 t0004.2 t0004.3 t0004.4 t0004.5 t0070.3 t1004.13 t3700.21 t3700.22 t3700.23 t3700.24 t3700.25 t4201.2 t5302 t6000.3 t7300.26 t7403' make -k test PERL_PATH="$PERL_PATH" || exit 2
		else
			GIT_SKIP_TESTS="t4201.2 t5302 t6000.3 t7403" make -k test PERL_PATH="$PERL_PATH" || exit 2
		fi
	<<
	TestSuiteSize: large
<<

InstallScript: <<
	make install DESTDIR=%d
	
	mkdir -p %i/share/man %i/share/doc
	cp -R ../man* %i/share/man
	cp -R ../doc %i/share/doc/%n
	mkdir -p %i/share/emacs/site-lisp
	cp contrib/emacs/*.el %i/share/emacs/site-lisp
	mkdir -p %i/etc/bash_completion.d
	cp contrib/completion/git-completion.bash %i/etc/bash_completion.d/
	
	# These go in separate packages.
	rm %i/lib/git-core/git-cvsimport
	rm %i/share/doc/%n/git-cvsimport.*
	rm %i/share/man/man1/git-cvsimport.1
	rm %i/lib/git-core/git-archimport
	rm %i/share/doc/%n/git-archimport.*
	rm %i/share/man/man1/git-archimport.1
	rm %i/lib/git-core/git-svn
	rm %i/share/doc/%n/git-svn.*
	rm %i/share/man/man1/git-svn.1
	rm %i/lib/git-core/git-send-email
	rm %i/share/doc/%n/git-send-email.*
	rm %i/share/man/man1/git-send-email.1
<<

UpdatePOD: true
DocFiles: COPYING README contrib

Description: Distributed version control system
DescDetail: <<
Git is an open source, distributed version control system designed to
handle everything from small to very large projects with speed and
efficiency.

Every Git clone is a full-fledged repository with complete history and
full revision tracking capabilities, not dependent on network access or
a central server. Branching and merging are fast and easy to do.
<<
DescPackaging: <<
Patched Makefile to use symlinks instead of hard links since it causes
problems if %p is a symlink to a different volume.

Previously maintained by Brendan Cully <brendan@finkproject.org>
<<
License: GPL
Homepage: http://git-scm.com/
Maintainer: Daniel Johnson <daniel@daniel-johnson.org>
CustomMirror: <<
	Primary: http://www.kernel.org/pub
	asi-CN: http://www.cn.kernel.org/pub
	asi-IN: http://www.in.kernel.org/pub
	asi-JP: http://www.jp.kernel.org/pub
	asi-KR: http://www.kr.kernel.org/pub
	asi-MY: http://www.my.kernel.org/pub
	asi-SG: http://www.sg.kernel.org/pub
	asi-TW: http://www.tw.kernel.org/pub
	aus-AU: http://www.au.kernel.org/pub
	aus-NZ: http://www.nz.kernel.org/pub
	eur-BA: http://www.ba.kernel.org/pub
	eur-BE: http://www.be.kernel.org/pub
	eur-BG: http://www.bg.kernel.org/pub
	eur-CH: http://www.ch.kernel.org/pub
	eur-CZ: http://www.cz.kernel.org/pub
	eur-DE: http://www.de.kernel.org/pub
	eur-DK: http://www.dk.kernel.org/pub
	eur-EE: http://www.ee.kernel.org/pub
	eur-ES: http://www.es.kernel.org/pub
	eur-FI: http://www.fi.kernel.org/pub
	eur-FR: http://www.fr.kernel.org/pub
	eur-GR: http://www.gr.kernel.org/pub
	eur-HR: http://www.hr.kernel.org/pub
	eur-HU: http://www.hu.kernel.org/pub
	eur-IE: http://www.ie.kernel.org/pub
	eur-IL: http://www.il.kernel.org/pub
	eur-IS: http://www.is.kernel.org/pub
	eur-IT: http://www.it.kernel.org/pub
	eur-LI: http://www.li.kernel.org/pub
	eur-LT: http://www.lt.kernel.org/pub
	eur-LU: http://www.lu.kernel.org/pub
	eur-LV: http://www.lv.kernel.org/pub
	eur-MD: http://www.md.kernel.org/pub
	eur-MK: http://www.mk.kernel.org/pub
	eur-NL: http://www.nl.kernel.org/pub
	eur-NO: http://www.no.kernel.org/pub
	eur-PL: http://www.pl.kernel.org/pub
	eur-PT: http://www.pt.kernel.org/pub
	eur-RO: http://www.ro.kernel.org/pub
	eur-RU: http://www.ru.kernel.org/pub
	eur-SE: http://www.se.kernel.org/pub
	eur-SI: http://www.si.kernel.org/pub
	eur-SK: http://www.sk.kernel.org/pub
	eur-TR: ftp://ftp.tr.kernel.org/pub
	eur-UA: http://www.ua.kernel.org/pub
	eur-UK: http://www.uk.kernel.org/pub
	nam-CA: http://www.ca.kernel.org/pub
	nam-MX: http://www.mx.kernel.org/pub
	nam-US: http://www.us.kernel.org/pub
	sam-AR: http://www.ar.kernel.org/pub
	sam-BR: http://www.br.kernel.org/pub
	sam-CL: http://www.cl.kernel.org/pub
	sam-VE: http://www.ve.kernel.org/pub
<<
<<
