Package: openmcl
Version: 0.14.2.040914
Revision: 1
Description: ANSI Common Lisp implementation
License: LGPL
Maintainer: Lars Rosengreen <lars@margay.org>


Depends: gnupg | gnupg-idea | gnupg-testing


Source: http://www.margay.org/fink/%n-cvs-%v.tar.bz2
Source2: ftp://clozure.com/pub/%n-darwinppc-bin-0.14.2-p1.tar.gz
Source3: ftp://clozure.com/pub/%n-darwin-interfaces-040505.tar.gz

Source-MD5:  192b405923015aed8a73be24a4ff321b
Source2-MD5: a984baf2c55293baac14314d61c203b0
Source3-MD5: b66cda4edbf5e18baa54dae060e30f37

SourceDirectory: ccl


PatchScript: <<
  #! /bin/sh -ev
  cd level-1
  sed -e 's/\(defparameter \*openmcl-suffix\* \)"[a-zA-Z0-9]*"/\1"040914"/' -e 's/\[-~a~\]/\[\-~a~\]/' version.lisp > version.lisp.new
  mv version.lisp.new version.lisp
<<


CompileScript: <<
  cd lisp-kernel/darwin ; make
  echo '(ccl::xload-level-0 :force)' | ./dppccl --batch
  echo '(ccl::compile-ccl)' | ./dppccl --batch
  echo '(ccl::save-application "dppccl.image")' | ./dppccl --batch --image-name ppc-boot.image

  # asdf-install
  echo "(require \"asdf\")(load \"tools/asdf-install/asdf-install.asd\")(asdf:oos 'asdf:compile-op 'asdf-install)" | ./dppccl --batch
<<


InstallScript: <<
  find %b -type d -name CVS -depth -exec rm -rf {} \;
  find %b -type f -name .cvsignore -exec rm -f {} \;
  install -m 755 -d %i/bin
  echo '#! /bin/sh' >> %i/bin/%n
  echo 'CCL_DEFAULT_DIRECTORY=%p/lib/%n/ccl exec %p/lib/%n/ccl/dppccl $@' >> %i/bin/%n
  chmod +x %i/bin/%n
  install -m 755 -d %i/lib/%n/ccl

  install -m 755 dppccl %i/lib/%n/ccl
  install -m 644 dppccl.image %i/lib/%n/ccl
  
  install -m 755 -d %i/lib/%n/ccl/tools
  install -m 644 tools/*.dfsl %i/lib/%n/ccl/tools
  
  cp -Rp darwin-headers %i/lib/%n/ccl
  cp -Rp examples %i/lib/%n/ccl
  cp -Rp OpenMCL.app %i/lib/%n/ccl
  cp -Rp library %i/lib/%n/ccl

#  find tools/asdf-install -type f -name "*.lisp" -exec rm -f {} \;
  cp -Rp tools/asdf-install %i/lib/%n/ccl/tools
<<


DocFiles: LGPL LICENSE ChangeLog

Homepage: http://openmcl.clozure.com/

DescDetail: <<
A free ANSI Common Lisp implementation for the Macintosh with several advanced
features including native (POSIX) threading, support for most of the MOP,
and an elegant interface to Objective-C/Cocoa.
<< 

DescPackaging: <<
Derived from the DarwinPorts package for OpenMCL originally created by
Gregory Wright

This package roughly tracks the ccl-14 stable CVS tree.  

OpenMCL.app is not a normal application.  It is part of OpenMCL's
support for Cocoa, and needs to go in %p/lib/%n/ccl.

A binary of the latest point release is used for bootstrapping.  

The sed stuff in PatchScript is there to get the date of the CVS
snapshot into ccl:*openmcl-version*
<<
