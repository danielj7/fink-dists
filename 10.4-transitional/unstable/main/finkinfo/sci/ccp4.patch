diff -ruN ccp4-6.0-orig/ccp4i/etc/configure.def.dist ccp4-6.0/ccp4i/etc/configure.def.dist
--- ccp4-6.0-orig/ccp4i/etc/configure.def.dist	2005-09-09 02:39:28.000000000 -0700
+++ ccp4-6.0/ccp4i/etc/configure.def.dist	2006-02-20 19:31:23.000000000 -0800
@@ -54,8 +54,8 @@
 MESSAGE                   _text				""
 BLT_LIBRARY               _text                     ""
 MENU_LENGTH               _positiveint              25
-HYPERTEXT_VIEWER          _text                     netscape
-START_NETSCAPE	          _text			    netscape
+HYPERTEXT_VIEWER          _text                     Safari  
+START_NETSCAPE	          _text			    open    
 O_MAPMAN                  _text                     mapman
 MAPMAN_MAXSIZE		  _positiveint		    4194304
 QUANTA_MBKALL             _text                     mbkall
diff -ruN ccp4-6.0-orig/ccp4i/etc/osx_ccp4_mail ccp4-6.0/ccp4i/etc/osx_ccp4_mail
--- ccp4-6.0-orig/ccp4i/etc/osx_ccp4_mail	1969-12-31 16:00:00.000000000 -0800
+++ ccp4-6.0/ccp4i/etc/osx_ccp4_mail	2006-02-20 19:31:57.000000000 -0800
@@ -0,0 +1,164 @@
+#!/usr/bin/perl
+# Drop-in replacement for /usr/bin/mail that uses Mail.app (via an
+# applescript) rather than sendmail to send mail.  Unlike /usr/bin/mail,
+# you can't use it for reading mail.
+#
+# usage: mail [<options>] <recipients>
+#     options:
+#         -v           be verbose
+#         -g           activate Mail.app to approve the message
+#         -F <from>    specify the From: address
+#         -b <bcc>     specify Bcc: recipients in a comma-separated list
+#         -c <cc>      specify Cc: recipients in a comma-separated list
+#         -s <subject> specify the message subject
+#
+# The body of the message is read from standard input.
+#
+# Author: Nathaniel Nystrom <nystrom@cs.cornell.edu>
+# This software is in the public domain.
+#
+# Version 1.0,   21 Aug 2003 -- initial version
+# Version 1.0.1, 22 Aug 2003 -- fixes some quoting problems
+# Version 1.0.2, 23 Aug 2003 -- removed -R <reply-to> option; |reply to|
+#                               is a property of _incoming_ messages
+# Version 1.0.3, 17 Sep 2003 -- fixed escaping of \ in message body;
+#                               escape the subject too
+
+use strict;
+$|++;
+
+my ($verbose, $gui);
+my ($from, @to, @cc, @bcc, $subject, $body);
+my $prog;
+($prog = $0) =~ s|.*/||;
+
+while (@ARGV) {
+    my $arg = shift @ARGV;
+
+    if ($arg eq '-v') {
+        $verbose++;
+    }
+    elsif ($arg eq '-g') {
+        $gui++;
+    }
+    elsif ($arg eq '-F') {
+        $from = shift @ARGV || &usage("missing sender");
+    }
+    elsif ($arg eq '-i' || $arg eq '-l' || $arg eq '-n') {
+        # ignore; for /usr/bin/mail compatibility
+    }
+    elsif ($arg eq '-N' || $arg eq '-f' || $arg eq '-u') {
+        &usage("invalid option $arg; $prog cannot be used for reading mail");
+    }
+    elsif ($arg eq '-s') {
+        $subject = shift @ARGV || &usage("missing subject");
+    }
+    elsif ($arg eq '-c') {
+        my $list = shift @ARGV || &usage("missing Cc list");
+        @cc = split /\s*,\s*/, $list;
+    }
+    elsif ($arg eq '-b') {
+        my $list = shift @ARGV || &usage("missing Bcc list");
+        @bcc = split /\s*,\s*/, $list;
+    }
+    elsif ($arg =~ /^-/) {
+        &usage("invalid option $arg");
+    }
+    else {
+        @to = ($arg, @ARGV);
+        last;
+    }
+}
+
+&usage("missing recipients") unless @to;
+
+unless (defined $subject) {
+    print "Subject: ";
+    $subject = <STDIN> || '';
+    chomp $subject;
+}
+
+$body = '';
+
+while (<STDIN>) {
+    $body .= $_;
+}
+
+$body = &escape($body);
+$subject = &escape($subject);
+
+my $script = <<"EOS";
+tell application "Mail"
+    set newMessage to make new outgoing message
+    tell newMessage
+        set subject to "$subject"
+        set content to "$body"
+EOS
+
+for (@to)  { $script .= &recipient('to', $_); }
+for (@cc)  { $script .= &recipient('cc', $_); }
+for (@bcc) { $script .= &recipient('bcc', $_); }
+
+my $visible = $gui ? "true" : "false";
+my $activate = $gui ? "activate" : "send newMessage";
+my $fromln = $from ? "set sender to \"$from\"" : "";
+
+$script .= <<"EOS";
+        $fromln
+        set visible to $visible
+    end tell
+    $activate
+end tell
+EOS
+
+if ($verbose >= 1) {
+    print "From: $from\n" if $from;
+    print "To: ", join(',', @to), "\n" if @to;
+    print "Cc: ", join(',', @cc), "\n" if @cc;
+    print "Bcc: ", join(',', @bcc), "\n" if @bcc;
+
+    if ($verbose >= 2) {
+        print "Script >>>\n";
+        print $script;
+        print "<<<\n";
+        print "\n";
+        print $body;
+    }
+}
+
+open(SCRIPT, "| osascript > /dev/null") || die "Couldn't fork osascript: $!\n";
+print SCRIPT $script;
+close SCRIPT;
+
+exit 0;
+
+sub escape {
+    my $x = shift;
+    $x =~ s/\\/\\\\/gm;
+    $x =~ s/"/\\"/gm;
+    $x =~ s/\n/\\n/gm;
+    $x;
+}
+
+sub recipient {
+    my ($type,$addr) = @_;
+    return <<"EOS"
+        make new $type recipient at end of $type recipients with properties {address: "$addr"}
+EOS
+}
+
+sub usage {
+    my $error = shift;
+    print STDERR "Error: $error\n" if $error;
+    print STDERR <<"EOS";
+usage: $prog [<options>] <recipients>
+    options:
+        -v           be verbose
+        -g           activate Mail.app to approve the message
+        -F <from>    specify the From: address
+        -b <bcc>     specify Bcc: recipients in a comma-separated list
+        -c <cc>      specify Cc: recipients in a comma-separated list
+        -s <subject> specify the message subject
+EOS
+    exit 1;
+}
diff -ruN ccp4-6.0-orig/ccp4i/src/local.tcl ccp4-6.0/ccp4i/src/local.tcl
--- ccp4-6.0-orig/ccp4i/src/local.tcl	2005-11-09 05:35:14.000000000 -0800
+++ ccp4-6.0/ccp4i/src/local.tcl	2006-02-20 19:32:31.000000000 -0800
@@ -34,7 +34,7 @@
 #d_arg mail_address Mail addressee
 
 return [expr {1 - [catch \
-   "exec Mail -s \"$subject\" $mail_address < $tmp_file"  ]}]
+   "exec osx_ccp4_mail  -s \"$subject\" $mail_address < $tmp_file"  ]}]
 }
 
 #d_index_title Interaction with Netscape
diff -ruN ccp4-6.0-orig/configure ccp4-6.0/configure
--- ccp4-6.0-orig/configure	2006-02-08 08:28:03.000000000 -0800
+++ ccp4-6.0/configure	2006-02-21 07:54:22.000000000 -0800
@@ -2090,7 +2090,7 @@
   XMKMF="IMAKECPP=/usr/bin/cpp xmkmf"
   if test "$shared_lib" = yes; then
     SHARED_LIB_CFLAGS=${SHARED_LIB_CFLAGS:-'-fPIC -fno-common'}
-    SHARE_LIB='${CXX} -dynamiclib -flat_namespace -undefined suppress ${SHARED_LIB_CFLAGS} -install_name libmmdb.dylib -all_load libmmdb.a -o libmmdb.dylib; ${CC} -dynamiclib -flat_namespace -undefined suppress ${SHARED_LIB_CFLAGS} -install_name libccp4c.dylib -all_load libccp4c.a  -o libccp4c.dylib'
+    SHARE_LIB='${CXX} -dynamiclib -flat_namespace -undefined suppress ${SHARED_LIB_CFLAGS} -install_name ${RPATH}/libmmdb.dylib -all_load libmmdb.a -o libmmdb.dylib; ${CC} -dynamiclib -flat_namespace -undefined suppress ${SHARED_LIB_CFLAGS} -install_name ${RPATH}/libccp4c.dylib -all_load libccp4c.a  -o libccp4c.dylib'
     SHARE_INST='${INSTALL_DATA} `pwd`/libmmdb.dylib ${libdir}/libmmdb.dylib; ${INSTALL_DATA} `pwd`/libccp4c.dylib ${libdir}/libccp4c.dylib'
   fi     
 #need -lcc_dynamic to get restFP and saveFP for g77 3.4 under darwin 7
@@ -4051,19 +4051,19 @@
  ;
 }
 _ACEOF
-     if test $FC = g77 && $FC -v conftest.f -o conftest 2>&1 | grep '3.1' >/dev/null ; then
+#     if test $FC = g77 && $FC -v conftest.f -o conftest 2>&1 | grep '3.1' >/dev/null ; then
     echo "configure --disable-shared --libdir=${libdir}"
     ( touch /tmp/$$.cache_file 2>/dev/null && \
       cat /dev/null > /tmp/$$.cache_file && \
       ./configure --disable-shared --libdir=${libdir} --cache-file=/tmp/$$.cache_file ) || \
       ./configure --disable-shared --libdir=${libdir}
-     else
-   echo "configure $xopts --libdir=${libdir}"
-    ( touch /tmp/$$.cache_file 2>/dev/null && \
-      cat /dev/null > /tmp/$$.cache_file && \
-      ./configure $xopts --libdir=${libdir} --cache-file=/tmp/$$.cache_file ) || \
-      ./configure $xopts --libdir=${libdir}
-     fi
+#     else
+#   echo "configure $xopts --libdir=${libdir}"
+#    ( touch /tmp/$$.cache_file 2>/dev/null && \
+#      cat /dev/null > /tmp/$$.cache_file && \
+#      ./configure $xopts --libdir=${libdir} --cache-file=/tmp/$$.cache_file ) || \
+#      ./configure $xopts --libdir=${libdir}
+ #    fi
     ;;
   Darwin_ibm_compilers )
     echo "configure --disable-shared --libdir=${libdir}"
diff -ruN ccp4-6.0-orig/etc/xloggraph ccp4-6.0/etc/xloggraph
--- ccp4-6.0-orig/etc/xloggraph	1969-12-31 16:00:00.000000000 -0800
+++ ccp4-6.0/etc/xloggraph	2006-02-20 19:30:27.000000000 -0800
@@ -0,0 +1,6 @@
+#!/bin/zsh
+export XUSERFILESEARCHPATH=$CLIB/X11/app-defaults/XCCPJiffy
+xloggraph.exe "$@" &
+export XUSERFILESEARCHPATH=""
+print "Plot button sends pdf to Preview.  Print or save pdf in Preview window."
+exit 0
diff -ruN ccp4-6.0-orig/etc/xplot84 ccp4-6.0/etc/xplot84
--- ccp4-6.0-orig/etc/xplot84	1969-12-31 16:00:00.000000000 -0800
+++ ccp4-6.0/etc/xplot84	2006-02-20 19:23:53.000000000 -0800
@@ -0,0 +1,6 @@
+#!/bin/zsh
+export XUSERFILESEARCHPATH=$CLIB/X11/app-defaults/XCCPJiffy
+xplot84driver.exe "$@" &
+export XUSERFILESEARCHPATH=""
+print "Plot button sends pdf to Preview.  Print or save pdf in Preview window."
+exit 0
diff -ruN ccp4-6.0-orig/etc/xplot84driver ccp4-6.0/etc/xplot84driver
--- ccp4-6.0-orig/etc/xplot84driver	1969-12-31 16:00:00.000000000 -0800
+++ ccp4-6.0/etc/xplot84driver	2006-02-20 19:23:53.000000000 -0800
@@ -0,0 +1,6 @@
+#!/bin/zsh
+export XUSERFILESEARCHPATH=$CLIB/X11/app-defaults/XCCPJiffy
+xplot84driver.exe "$@" &
+export XUSERFILESEARCHPATH=""
+print "Plot button sends pdf to Preview.  Print or save pdf in Preview window."
+exit 0
diff -ruN ccp4-6.0-orig/include/ccp4.setup-bash ccp4-6.0/include/ccp4.setup-bash
--- ccp4-6.0-orig/include/ccp4.setup-bash	2006-02-03 06:13:28.000000000 -0800
+++ ccp4-6.0/include/ccp4.setup-bash	2006-02-20 19:26:10.000000000 -0800
@@ -3,7 +3,7 @@
 # Actually, the aliases can't work asis in ksh.  Should use builtins instead
 # and not worry about ease of keeping in step with the csh one.
 
-# $Id: ccp4.setup-bash,v 1.72 2006/02/03 14:13:28 pjx Exp $
+# $Id: ccp4.setup-bash,v 1.67 2005/09/22 08:40:51 mdw Exp $
 
 # This file is site specific and may also contain machine-specifics.  The CCP4
 # administrator will have to edit this file and then have anyone who wants to
@@ -360,14 +360,3 @@
 
   unset alias  # clean up
 fi             # ksh test
-
-# Set-up cctbx environment
-test -r $CCP4/lib/cctbx/cctbx_build/setpaths.sh && . $CCP4/lib/cctbx/cctbx_build/setpaths.sh
-
-# Set-up phaser environment
-if ( test -d $CCP4/src/phaser) ; then
-  phaser_mtype=`$CCP4/src/phaser/bin/machine_type`
-  phaser_version=`grep PHASER_VERSION $CCP4/src/phaser/conf/version | awk '{print $3}'`
-  phaser_setup_file="${CCP4}/src/phaser/phaser-${phaser_version}/build/${phaser_mtype}/setpaths.sh"
-  test -r $phaser_setup_file && . $phaser_setup_file
-fi
diff -ruN ccp4-6.0-orig/include/ccp4.setup-dist ccp4-6.0/include/ccp4.setup-dist
--- ccp4-6.0-orig/include/ccp4.setup-dist	2006-02-03 06:13:28.000000000 -0800
+++ ccp4-6.0/include/ccp4.setup-dist	2006-02-20 19:26:10.000000000 -0800
@@ -1,7 +1,7 @@
 #!/bin/csh
 # CCP4 setup file for C-shell (or tcsh) users.  -*- shell-script -*-
 
-# $Id: ccp4.setup-dist,v 1.84 2006/02/03 14:13:28 pjx Exp $
+# $Id: ccp4.setup-dist,v 1.77 2005/09/22 08:40:52 mdw Exp $
 
 # This file is site specific and may also contain machine-specifics.  The CCP4
 # administrator will have to edit this file and then have anyone who wants to
@@ -107,7 +107,7 @@
     setenv CBIN      $CCP4/bin		
     setenv CLIB      $CCP4/lib	
 
-    setenv CCP4_BROWSER  netscape             
+    setenv CCP4_BROWSER  open            
 
     if (${?MANPATH}) then
       if ($ccp4_first_in_path) then
@@ -181,52 +181,6 @@
 #
 #  setenv BINSORT_MEM     8388608
 
-# LD_LIBRARY_PATH specifies where to find dynamic libraries (e.g. libccp4.so)
-# at runtime
-if (${?LD_LIBRARY_PATH}) then
-  if ($ccp4_first_in_path) then
-    setenv LD_LIBRARY_PATH ${CLIB}:${LD_LIBRARY_PATH}
-  else
-    setenv LD_LIBRARY_PATH ${LD_LIBRARY_PATH}:${CLIB}
-  endif
-else
-  setenv LD_LIBRARY_PATH ${CLIB}
-endif
-
-# DYLD_LIBRARY_PATH specifies where to find dynamic libraries (e.g. libccp4.dylib)
-# at runtime (used on Mac OS X)
-if (${?DYLD_LIBRARY_PATH}) then
-  if ($ccp4_first_in_path) then
-    setenv DYLD_LIBRARY_PATH ${CLIB}:${DYLD_LIBRARY_PATH}
-  else
-    setenv DYLD_LIBRARY_PATH ${DYLD_LIBRARY_PATH}:${CLIB}
-  endif
-else
-  setenv DYLD_LIBRARY_PATH ${CLIB}
-endif
-
-### XAPPLRESDIR ###
-
-# If you want to use xloggraph/xplot84driver, you need to get the application
-# defaults picked up somehow.  As distributed, the file can't just live in an
-# application defaults directory since it requires reading by xrdb to sort out
-# the differences for monochrome displays.  At Daresbury a version of the file
-# assuming a monochrome display is kept in the directory
-# $CCP4_LIB/X11/app-defaults and this is picked up through the
-# XUSERFILESEARCHPATH environment variable.  That means you only see black and
-# white on a colour display.  Alternatively you might make sure that it is
-# read by xrdb on startup of the X Windows system or delegate the
-# responsibility to users to run it.  There are disadvantages to putting an
-# invocation of xrdb in here, one being that the correct value of DISPLAY may
-# not be set at the time this file is read.  Thus edit this part as
-# appropriate.  (SunOS will normally want to use /usr/openwin or $OPENWINHOME
-# instead of /usr; others may want /usr/local/lib or somw such):
-if ($?XUSERFILESEARCHPATH) then
-  setenv XUSERFILESEARCHPATH $CCP4_LIB/X11/app-defaults/%N:$XUSERFILESEARCHPATH
-else
-  setenv XUSERFILESEARCHPATH $CCP4_LIB/X11/app-defaults/%N:/usr/lib/X11/app-defaults
-endif
-
 ### TRAPPFE ###
 # TRAPFPE is set to ensure (in collaboration with -lfpe) an abort on floating
 # point exceptions under IRIX.  It shouldn't cause harm on other systems, but
@@ -348,14 +302,3 @@
   alias lgnoms 'pushd $CCP4_MASTER/laue/gnom/src>/dev/null'
   alias lbin   'pushd $CBIN>/dev/null'
 #
-
-# Set-up cctbx environment
-if (-e $CCP4/lib/cctbx/cctbx_build/setpaths.csh) source $CCP4/lib/cctbx/cctbx_build/setpaths.csh
-
-# Set-up phaser environment
-if (-d $CCP4/src/phaser) then
-  set phaser_mtype = `$CCP4/src/phaser/bin/machine_type`
-  set phaser_version = `grep PHASER_VERSION $CCP4/src/phaser/conf/version | awk '{print $3}'`
-  set phaser_setup_file = "${CCP4}/src/phaser/phaser-${phaser_version}/build/${phaser_mtype}/setpaths.csh"
-  if (-e $phaser_setup_file) source $phaser_setup_file
-endif
diff -ruN ccp4-6.0-orig/include/ccp4.setup-sh ccp4-6.0/include/ccp4.setup-sh
--- ccp4-6.0-orig/include/ccp4.setup-sh	2006-02-03 06:13:28.000000000 -0800
+++ ccp4-6.0/include/ccp4.setup-sh	2006-02-20 19:26:10.000000000 -0800
@@ -5,7 +5,7 @@
 # can't work asis in ksh.  Should use builtins instead and not worry about
 # ease of keeping in step with the csh one.
 
-# $Id: ccp4.setup-sh,v 1.12 2006/02/03 14:13:28 pjx Exp $
+# $Id: ccp4.setup-sh,v 1.7 2005/09/09 13:52:45 pjx Exp $
 
 # This file is site specific and may also contain machine-specifics.  The CCP4
 # administrator will have to edit this file and then have anyone who wants to
@@ -91,7 +91,8 @@
     export CBIN=$CCP4/bin		
     export CLIB=$CCP4/lib	
 
-    export CCP4_BROWSER=safari             
+    CCP4_BROWSER=""
+    export CCP4_BROWSER="open"            
     export MANPATH=$CCP4/man:$MANPATH           # edit this if necessary
     export MCTYPE=unix 			# (only for Laue)
 #     ;;
@@ -133,40 +134,6 @@
 #
 #  export BINSORT_MEM=8388608
 
-# LD_LIBRARY_PATH specifies where to find dynamic libraries (e.g. libccp4.so)
-# at runtime
-if test "LD_LIBRARY_PATH"; then
-  export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:$CLIB
-else
-  export LD_LIBRARY_PATH=$CLIB
-fi
-# DYLD_LIBRARY_PATH specifies where to find dynamic libraries
-# (e.g. libccp4.dylib) at runtime
-if test "DYLD_LIBRARY_PATH"; then
-  export DYLD_LIBRARY_PATH=$DYLD_LIBRARY_PATH:$CLIB
-else
-  export DYLD_LIBRARY_PATH=$CLIB
-fi
-
-### XAPPLRESDIR ###
-
-# If you want to use xloggraph/xplot84driver, you need to get the application
-# defaults picked up somehow.  As distributed, the file can't just live in an
-# application defaults directory since it requires reading by xrdb to sort out
-# the differences for monochrome displays.  At Daresbury a version of the file
-# assuming a monochrome display is kept in the directory
-# $CCP4_LIB/X11/app-defaults and this is picked up through the
-# XUSERFILESEARCHPATH environment variable.  That means you only see black and
-# white on a colour display.  Alternatively you might make sure that it is
-# read by xrdb on startup of the X Windows system or delegate the
-# responsibility to users to run it.  There are disadvantages to putting an
-# invocation of xrdb in here, one being that the correct value of DISPLAY may
-# not be set at the time this file is read.  Thus edit this part as
-# appropriate.  (SunOS will normally want to use /usr/openwin or $OPENWINHOME
-# instead of /usr; others may want /usr/local/lib or somw such):
-
-export XAPPLRESDIR=/sw/etc/app-defaults/
-
 ### TRAPPFE ###
 # TRAPFPE is set to ensure (in collaboration with -lfpe) an abort on floating
 # point exceptions under IRIX.  It shouldn't cause harm on other systems, but
@@ -280,14 +247,3 @@
   alias lgnom='pushd $CCP4_MASTER/laue/gnom>/dev/null'
   alias lgnoms='pushd $CCP4_MASTER/laue/gnom/src>/dev/null'
   alias lbin='pushd $CBIN>/dev/null'
-
-# Set-up cctbx environment
-test -r $CCP4/lib/cctbx/cctbx_build/setpaths.sh && . $CCP4/lib/cctbx/cctbx_build/setpaths.sh
-
-# Set-up phaser environment
-if ( test -d $CCP4/src/phaser) ; then
-  phaser_mtype=`$CCP4/src/phaser/bin/machine_type`
-  phaser_version=`grep PHASER_VERSION $CCP4/src/phaser/conf/version | awk '{print $3}'`
-  phaser_setup_file="${CCP4}/src/phaser/phaser-${phaser_version}/build/${phaser_mtype}/setpaths.sh"
-  test -r $phaser_setup_file && . $phaser_setup_file
-fi
diff -ruN ccp4-6.0-orig/include/ccp4.setup-zsh ccp4-6.0/include/ccp4.setup-zsh
--- ccp4-6.0-orig/include/ccp4.setup-zsh	2006-02-03 06:13:28.000000000 -0800
+++ ccp4-6.0/include/ccp4.setup-zsh	2006-02-20 19:26:10.000000000 -0800
@@ -18,7 +18,7 @@
 
 # Also contains a few zsh-specific functions and command-completions
 
-# $Id: ccp4.setup-zsh,v 1.12 2006/02/03 14:13:28 pjx Exp $
+# $Id: ccp4.setup-zsh,v 1.7 2005/09/22 08:40:52 mdw Exp $
 
 # This file is site specific and may also contain machine-specifics.  The CCP4
 # administrator will have to edit this file and then have anyone who wants to
@@ -122,6 +122,7 @@
 
     
     if [[ $(uname) = Darwin ]]; then
+        CCP4_BROWSER=""
         export CCP4_BROWSER=open            # open in OS X default browser
     elif [[ $(uname) = Linux ]];then
         export  CCP4_BROWSER=konqueror 
@@ -175,66 +176,6 @@
 #  export BINSORT_MEM=8388608
 
 
-# If installed via fink, skip this bit:
-
-if [[ -z $SWPREFIX ]];then
-  if [[ -d /sw/bin/fink-virtual-pkgs ]];then
-    SWPREFIX=$(dirname $(dirname $(which /sw/bin/fink-virtual-pkgs)))
-  fi
-fi
-
-if [[ -z $SWPREFIX || $CCP4_MASTER != $SWPREFIX/share/xtal ]];then 
-    
-    # LD_LIBRARY_PATH specifies where to find dynamic libraries (e.g. libccp4.so)
-    # at runtime
-    
-    if test "$LD_LIBRARY_PATH"; then
-      if [[ $ccp4_first_in_path == 1 ]]; then
-        export LD_LIBRARY_PATH=$CLIB:$LD_LIBRARY_PATH
-      else
-        export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:$CLIB
-      fi
-    else
-      export LD_LIBRARY_PATH=$CLIB
-    fi
-    # DYLD_LIBRARY_PATH specifies where to find dynamic libraries
-    # (e.g. libccp4.dylib) at runtime
-    if test "$DYLD_LIBRARY_PATH"; then
-      if [[ $ccp4_first_in_path == 1 ]]; then
-        export DYLD_LIBRARY_PATH=$CLIB:$DYLD_LIBRARY_PATH
-      else
-        export DYLD_LIBRARY_PATH=$DYLD_LIBRARY_PATH:$CLIB
-      fi
-    else
-      export DYLD_LIBRARY_PATH=$CLIB
-    fi
-    
-    ### XAPPLRESDIR ###
-    
-    # If you want to use xloggraph/xplot84driver, you need to get the application
-    # defaults picked up somehow.  As distributed, the file can't just live in an
-    # application defaults directory since it requires reading by xrdb to sort out
-    # the differences for monochrome displays.  At Daresbury a version of the file
-    # assuming a monochrome display is kept in the directory
-    # $CCP4_LIB/X11/app-defaults and this is picked up through the
-    # XUSERFILESEARCHPATH environment variable.  That means you only see black and
-    # white on a colour display.  Alternatively you might make sure that it is
-    # read by xrdb on startup of the X Windows system or delegate the
-    # responsibility to users to run it.  There are disadvantages to putting an
-    # invocation of xrdb in here, one being that the correct value of DISPLAY may
-    # not be set at the time this file is read.  Thus edit this part as
-    # appropriate.  (SunOS will normally want to use /usr/openwin or $OPENWINHOME
-    # instead of /usr; others may want /usr/local/lib or somw such):
-
-    if [[ -n "$XUSERFILESEARCHPATH" ]]; then
-        XUSERFILESEARCHPATH=$CCP4_LIB/X11/app-defaults/%N:$XUSERFILESEARCHPATH
-    else
-        XUSERFILESEARCHPATH=$CCP4_LIB/X11/app-defaults/%N:/usr/lib/X11/app-defaults
-    fi
-
-    export XUSERFILESEARCHPATH
-    
-fi
 
 ### TRAPPFE ###
 # TRAPFPE is set to ensure (in collaboration with -lfpe) an abort on floating
@@ -383,16 +324,6 @@
     typeset -U manpath
     typeset -U classpath
      
-# Set-up cctbx environment
-test -r $CCP4/lib/cctbx/cctbx_build/setpaths.sh && . $CCP4/lib/cctbx/cctbx_build/setpaths.sh
  
-# Set-up phaser environment
-if ( test -d $CCP4/src/phaser) ; then
-  phaser_mtype=`$CCP4/src/phaser/bin/machine_type`
-  phaser_version=`grep PHASER_VERSION $CCP4/src/phaser/conf/version | awk '{print $3}'`
-  phaser_setup_file="${CCP4}/src/phaser/phaser-${phaser_version}/build/${phaser_mtype}/setpaths.sh"
-  test -r $phaser_setup_file && . $phaser_setup_file
-fi
-
 
 
diff -ruN ccp4-6.0-orig/lib/ccif/configure ccp4-6.0/lib/ccif/configure
--- ccp4-6.0-orig/lib/ccif/configure	2005-05-10 09:15:15.000000000 -0700
+++ ccp4-6.0/lib/ccif/configure	2006-02-20 22:08:03.000000000 -0800
@@ -1874,7 +1874,7 @@
            SHARED_LIB_PATH='DYLD_LIBRARY_PATH=`pwd`'
          fi
          SHARED_LIB_CMD=' $(LD) -dylib -dynamic -flat_namespace \\\
-                          -undefined suppress -dylib_install_name $(SHARED_LIB_NAME) \\\
+                          -undefined suppress -dylib_install_name ${RPATH}/$(SHARED_LIB_NAME) \\\
                           -all_load $L \\\
                           -o $(SHARED_LIB_NAME) -ldylib1.o'
          SHARED_LIB_EXPORTS_CMD=''
@@ -1892,7 +1892,7 @@
          fi
          SHARED_LIB_CMD='$(CC) $(SHARED_LIB_CFLAGS) -dynamiclib -flat_namespace \\\
                                -undefined suppress -install_name \\\
-                                $(SHARED_LIB_NAME) \\\
+                                ${RPATH}/$(SHARED_LIB_NAME) \\\
                                -all_load $L \\\
                                -o $(SHARED_LIB_NAME)'
          SHARED_LIB_EXPORTS_CMD=''
diff -ruN ccp4-6.0-orig/lib/cctbx/ccp4_build ccp4-6.0/lib/cctbx/ccp4_build
--- ccp4-6.0-orig/lib/cctbx/ccp4_build	2005-11-02 04:47:27.000000000 -0800
+++ ccp4-6.0/lib/cctbx/ccp4_build	2006-02-22 08:57:32.000000000 -0800
@@ -1,53 +1,5 @@
-#! /bin/sh
+#! /bin/sh -ef
 
-usage='echo "Usage: ccp4_build [--help] [--libdir=DIR]" '
-
-if ( eval test -d cctbx_build || eval mkdir cctbx_build ) ; then :
-else
-  eval echo "! No directory cctbx_build and can\'t create it."
-  exit 1
-fi
-
-cctbxopts="--command_version_suffix=ccp4-6.0 --build=release"
-for arg
-do
-
-    case $arg in
-
-    -help | --help | -h | help)
-      eval $usage; exit 0;;
-
-    -libdir=* | --libdir=* | --libdi=* | --libd=* | --lib=* | --li=* | --l=*)
-      libdir=`echo $arg | sed 's/[-a-z_]*=//'` ; break;;
-
-    # all other arguments passed to cctbx build
-    *)
-      cctbxopts="$cctbxopts $arg" ;;
-
-    esac
-
-done
-
-if ( eval test -z \"\$CCP4\" ) ; then
-  echo "! Please set CCP4 environment, e.g. source ccp4.setup "
-  exit 1
-else true; fi
-
-libdir=${libdir:-$CCP4_LIB}
-
-echo "Changing directory to cctbx_build"
-cd cctbx_build
-
-echo "Running libtbx/configure.py"
-python ../cctbx_sources/libtbx/configure.py $cctbxopts ccp4io=${CCP4} mmtbx
-
-echo "Running setpaths.sh"
-. ./setpaths.sh
-
-echo "Building cctbx"
-libtbx.scons .
-
-# sunos 32 vs 64
-# use of sunos compilers
-# installation ??
+echo "Skipping final build of cctbx"
+echo "Install fink's cctbx package if you need this"
 
diff -ruN ccp4-6.0-orig/lib/cctbx/ccp4_build-original ccp4-6.0/lib/cctbx/ccp4_build-original
--- ccp4-6.0-orig/lib/cctbx/ccp4_build-original	1969-12-31 16:00:00.000000000 -0800
+++ ccp4-6.0/lib/cctbx/ccp4_build-original	2006-02-22 08:55:41.000000000 -0800
@@ -0,0 +1,53 @@
+#! /bin/sh
+
+usage='echo "Usage: ccp4_build [--help] [--libdir=DIR]" '
+
+if ( eval test -d cctbx_build || eval mkdir cctbx_build ) ; then :
+else
+  eval echo "! No directory cctbx_build and can\'t create it."
+  exit 1
+fi
+
+cctbxopts="--command_version_suffix=ccp4-6.0 --build=release"
+for arg
+do
+
+    case $arg in
+
+    -help | --help | -h | help)
+      eval $usage; exit 0;;
+
+    -libdir=* | --libdir=* | --libdi=* | --libd=* | --lib=* | --li=* | --l=*)
+      libdir=`echo $arg | sed 's/[-a-z_]*=//'` ; break;;
+
+    # all other arguments passed to cctbx build
+    *)
+      cctbxopts="$cctbxopts $arg" ;;
+
+    esac
+
+done
+
+if ( eval test -z \"\$CCP4\" ) ; then
+  echo "! Please set CCP4 environment, e.g. source ccp4.setup "
+  exit 1
+else true; fi
+
+libdir=${libdir:-$CCP4_LIB}
+
+echo "Changing directory to cctbx_build"
+cd cctbx_build
+
+echo "Running libtbx/configure.py"
+python ../cctbx_sources/libtbx/configure.py $cctbxopts ccp4io=${CCP4} mmtbx
+
+echo "Running setpaths.sh"
+. ./setpaths.sh
+
+echo "Building cctbx"
+libtbx.scons .
+
+# sunos 32 vs 64
+# use of sunos compilers
+# installation ??
+
diff -ruN ccp4-6.0-orig/lib/cctbx/cctbx_install_script.csh ccp4-6.0/lib/cctbx/cctbx_install_script.csh
--- ccp4-6.0-orig/lib/cctbx/cctbx_install_script.csh	2005-11-08 09:06:57.000000000 -0800
+++ ccp4-6.0/lib/cctbx/cctbx_install_script.csh	2006-02-21 08:13:32.000000000 -0800
@@ -29,7 +29,7 @@
 set build_mode=release
 
 if ("`uname`" == "Darwin") then
-  set python_exe="/Library/Frameworks/Python.framework/Versions/2.3/bin/python"
+  set python_exe="/System/Library/Frameworks/Python.framework/Versions/Current/bin/python"
   if (! -x "$python_exe") then
     set python_exe="/System$python_exe"
   endif
