diff -uNr libgpod-0.4.2/src/db-parse-context.c libgpod-0.4.2-new/src/db-parse-context.c
--- libgpod-0.4.2/src/db-parse-context.c	2006-10-02 09:52:47.000000000 -0400
+++ libgpod-0.4.2-new/src/db-parse-context.c	2007-02-05 22:15:47.000000000 -0500
@@ -23,9 +23,9 @@
  */
 
 
+#include <sys/types.h>
 #include <sys/mman.h>
 #include <sys/stat.h>
-#include <sys/types.h>
 #include <errno.h>
 #include <fcntl.h>
 #include <string.h>
diff -uNr libgpod-0.4.2/src/itdb_itunesdb.c libgpod-0.4.2-new/src/itdb_itunesdb.c
--- libgpod-0.4.2/src/itdb_itunesdb.c	2007-01-14 09:28:37.000000000 -0500
+++ libgpod-0.4.2-new/src/itdb_itunesdb.c	2007-02-05 22:18:28.000000000 -0500
@@ -4638,6 +4638,18 @@
 }
 
 
+    gboolean haystack (gchar *filetype, gchar **desclist)
+    {
+	gchar **dlp;
+	if (!filetype || !desclist) return FALSE;
+	for (dlp=desclist; *dlp; ++dlp)
+	{
+	    if (strstr (filetype, *dlp)) return TRUE;
+	}
+	return FALSE;
+}
+
+
 /**
  * itdb_shuffle_write_file:
  * @itdb: the #Itdb_iTunesDB to write to disk
@@ -4652,18 +4664,6 @@
 gboolean itdb_shuffle_write_file (Itdb_iTunesDB *itdb,
 				  const gchar *filename, GError **error)
 {
-    auto gboolean haystack (gchar *filetype, gchar **desclist);
-    gboolean haystack (gchar *filetype, gchar **desclist)
-    {
-	gchar **dlp;
-	if (!filetype || !desclist) return FALSE;
-	for (dlp=desclist; *dlp; ++dlp)
-	{
-	    if (strstr (filetype, *dlp)) return TRUE;
-	}
-	return FALSE;
-    }
-
     FExport *fexp;
     GList *gl;
     WContents *cts;
diff -uNr libgpod-0.4.2/src/itdb_track.c libgpod-0.4.2-new/src/itdb_track.c
--- libgpod-0.4.2/src/itdb_track.c	2007-01-14 10:15:50.000000000 -0500
+++ libgpod-0.4.2-new/src/itdb_track.c	2007-02-05 22:15:47.000000000 -0500
@@ -69,20 +69,11 @@
     return track;
 }
 
+extern gboolean haystack (gchar *filetype, gchar **desclist);
+
 /* Attempt to set some of the unknowns to reasonable defaults */
 static void itdb_track_set_defaults (Itdb_Track *tr)
 {
-    auto gboolean haystack (gchar *filetype, gchar **desclist);
-    gboolean haystack (gchar *filetype, gchar **desclist)
-    {
-	gchar **dlp;
-	if (!filetype || !desclist) return FALSE;
-	for (dlp=desclist; *dlp; ++dlp)
-	{
-	    if (strstr (filetype, *dlp)) return TRUE;
-	}
-	return FALSE;
-    }
 
     gchar *mp3_desc[] = {"MPEG", "MP3", "mpeg", "mp3", NULL};
     gchar *mp4_desc[] = {"AAC", "MP4", "aac", "mp4", NULL};
