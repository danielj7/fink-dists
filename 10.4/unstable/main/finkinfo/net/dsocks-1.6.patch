diff -urN dsocks/Makefile dsocks.patched/Makefile
--- dsocks/Makefile	2005-07-14 09:17:49.000000000 -0400
+++ dsocks.patched/Makefile	2008-08-15 14:47:36.000000000 -0400
@@ -13,7 +13,7 @@
 OSXFLAGS	= -nostdlib -flat_namespace -fno-common -undefined suppress
 CFLAGS		+= $(OSXFLAGS)
 # XXX - hack around missing LDFLAGS in bsd.lib.mk target
-LDADD		= $(OSXFLAGS)
+LDADD		= $(OSXFLAGS) -install_name $(LIBDIR)/libdsocks.1.dylib
 SHLIB_MAJOR	= 1
 .endif
 
diff -urN dsocks/dsocks-torify.sh dsocks.patched/dsocks-torify.sh
--- dsocks/dsocks-torify.sh	2005-07-14 11:02:19.000000000 -0500
+++ dsocks.patched/dsocks-torify.sh	2006-01-31 11:59:02.000000000 -0600
@@ -7,8 +7,9 @@
 # you probably want to run tor-dns-proxy.py also...
 
 # for MacOS X...
-#LIBDSOCKS=/usr/local/lib/libdsocks.dylib
-#DYLD_INSERT_LIBRARIES=$LIBDSOCKS DYLD_FORCE_FLAT_NAMESPACE=1 exec "$@"
+LIBDSOCKS=@PREFIX@/lib/libdsocks.dylib
+DYLD_INSERT_LIBRARIES=$LIBDSOCKS DYLD_FORCE_FLAT_NAMESPACE=1 exec "$@"
 
-LIBDSOCKS=/usr/local/lib/libdsocks.so.1.0
-LD_PRELOAD=$LIBDSOCKS exec "$@"
+# for BSD
+#LIBDSOCKS=/usr/local/lib/libdsocks.so.1.0
+#LD_PRELOAD=$LIBDSOCKS exec "$@"
diff -urN dsocks/dsocks.sh dsocks.patched/dsocks.sh
--- dsocks/dsocks.sh	2005-07-14 08:48:32.000000000 -0500
+++ dsocks.patched/dsocks.sh	2006-01-31 11:58:08.000000000 -0600
@@ -8,8 +8,9 @@
 #export LOCALDOMAIN="int.example.com"
 
 # for MacOS X...
-#LIBDSOCKS=/usr/local/lib/libdsocks.dylib
-#DYLD_INSERT_LIBRARIES=$LIBDSOCKS DYLD_FORCE_FLAT_NAMESPACE=1 exec "$@"
+LIBDSOCKS=@PREFIX@/lib/libdsocks.dylib
+DYLD_INSERT_LIBRARIES=$LIBDSOCKS DYLD_FORCE_FLAT_NAMESPACE=1 exec "$@"
 
-LIBDSOCKS=/usr/local/lib/libdsocks.so.1.0
-LD_PRELOAD=$LIBDSOCKS exec "$@"
+# for BSD
+#LIBDSOCKS=/usr/local/lib/libdsocks.so.1.0
+#LD_PRELOAD=$LIBDSOCKS exec "$@"
