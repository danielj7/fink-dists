Package: system-xfree86
Version: 4.2
Revision: 1
Provides: x11, rman, libgl
Conflicts: x11, system-libgl
Replaces: system-libgl
Type: bundle
Description: Placeholder package for manually installed XFree86
DescDetail: <<
Install this package if you have XFree86 4.2.0 installed manually. It
will check whether the installation is okay and provide the 'x11'
virtual package.

Because XFree86 now has OpenGL support built-in, you will probably
want to also install system-libgl to make those known to Fink.
<<
#
PreInstScript: <<

echo

# check for Xtools
if [ -d /usr/X11R6/lib/tenon ]; then
  echo "It looks like you have Xtools installed, not XFree86. You should install"
  echo "the system-xtools package instead. There are some subtle differences"
  echo "between the two. If you installed XFree86 on top of Xtools, you may want"
  echo "to wipe it out and do a clean install of XFree86 to avoid some potential"
  echo "problems."
  echo
  echo "Press Return to continue."
  read
  exit 1
fi

# check for needed files
missing=
mcount=0
for file in bin/xterm bin/xrdb bin/rman \
	    lib/libX11.dylib lib/libXpm.dylib lib/libXaw.dylib \
	    include/X11/Xlib.h ; do
  if [ ! -f "/usr/X11R6/$file" ]; then
    missing="$missing /usr/X11R6/$file"
    mcount=$(($mcount+1))
  fi
done
if test "$mcount" -ge 7; then
  echo "You don't have XFree86 installed. Install the xfree86-base package instead"
  echo "or install a recent XFree86 version manually and retry installing the"
  echo "system-xfree86 package."
  echo
  echo "Press Return to continue."
  read
  exit 1
fi
# ugh, we've gotta be tricky for this to turn out right
XF_VERSION=`sh -c '/usr/X11R6/bin/XDarwin -version 2>&1' | grep "4.2"`
if test -z "$XF_VERSION"; then
  echo "Your XFree86 installation is not version 4.2 or higher.  Please install"
  echo "XFree86 4.2.0 or later or consider installing the xfree86-base package."
  echo 
  echo "Press Return to continue."
  read
  exit 1
fi
if test -n "$missing"; then
  echo "Your XFree86 installation is incomplete. The following files are missing:"
  echo "$missing"
  echo "You may have an old version without shared libraries. That is not sufficient"
  echo "to run downloaded binary packages. Please install XFree86 4.2.0 or later"
  echo "manually or consider installing the xfree86-base package."
  echo
  echo "Press Return to continue."
  read
  exit 1
fi

echo "Valid XFree86 installation detected."
echo

# check imake config files for 10.1 flags
if grep 'undefined suppress' /usr/X11R6/lib/X11/config/darwinLib.rules >/dev/null 2>&1; then
  if ! grep 'flat_namespace' /usr/X11R6/lib/X11/config/darwinLib.rules >/dev/null 2>&1; then
    echo "Adding Mac OS X 10.1 compatibility option to imake configuration file"
    echo "/usr/X11R6/lib/X11/config/darwinLib.rules ..."
    sed 's/-undefined suppress/-flat_namespace -undefined suppress/g' </usr/X11R6/lib/X11/config/darwinLib.rules >/usr/X11R6/lib/X11/config/darwinLib.rules.tmp
    mv -f /usr/X11R6/lib/X11/config/darwinLib.rules.tmp /usr/X11R6/lib/X11/config/darwinLib.rules
    echo
  fi
fi

<<
Maintainer: None <fink-devel@lists.sourceforge.net>
