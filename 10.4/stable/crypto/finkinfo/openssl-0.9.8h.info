Package: openssl
Version: 0.9.8h
Revision: 2
Depends: %N098-shlibs (= %v-%r), pkgconfig
Conflicts: openssl097
Replaces: openssl097
Source: mirror:custom:source/openssl-%v.tar.gz
CustomMirror: <<
  Primary:   http://www.openssl.org/
  Secondary: http://www.planetmirror.com/pub/openssl/
<<
Source-MD5: 7d3d41dafc76cf2fcb5559963b5783b3

PatchScript: <<
  perl util/perlpath.pl /usr/bin
  perl -pi -e 's,LIBDEPS,SHARED_LDFLAGS=-bundle $&,' engines/Makefile
<<
NoSetMAKEFLAGS: true
SetMAKEFLAGS: -j1
CompileScript: <<
  #!/bin/sh -ev
  if [ "%m" = "powerpc" ]
  then
    PERL=/usr/bin/perl ./Configure shared darwin-ppc-cc --prefix=%p --openssldir=%p/etc/ssl zlib-dynamic --with-krb5-dir=/usr
  else
    if [ "%m" = "i386" ]
    then
      PERL=/usr/bin/perl ./Configure shared darwin-i386-cc --prefix=%p --openssldir=%p/etc/ssl zlib-dynamic --with-krb5-dir=/usr
    else
      PERL=/usr/bin/perl ./Configure shared darwin64-x86_64-cc --prefix=%p --openssldir=%p/etc/ssl zlib-dynamic --with-krb5-dir=/usr
    fi
  fi
  make
<<
InfoTest: <<
TestScript: make test || exit 2
<<
InstallScript: <<
 make install INSTALL_PREFIX=%d MANDIR=%p/share/man
 mv %i/share/man/man3/md5.3 %i/share/man/man3/md5.3.%N098
<<
SplitOff: <<
  Package: %N098-shlibs
  Files: lib/libcrypto.0.9.8.dylib lib/libssl.0.9.8.dylib lib/engines
  Shlibs: <<
    %p/lib/libcrypto.0.9.8.dylib 0.9.8 %n (>= 0.9.8-1)
    %p/lib/libssl.0.9.8.dylib 0.9.8 %n (>= 0.9.8-1)
  <<
  DocFiles: README LICENSE CHANGES FAQ NEWS
<<
SplitOff2: <<
  Package: %N098-dev
  Depends: %N098-shlibs (= %v-%r)
  DescPackaging: <<
    Uses pkgconfig, but there are no pkgconfig-related dependencies.
  <<
  Conflicts: libmd (<= 0.3-2), openssl-dev, openssl097-dev
  Replaces: openssl-dev, openssl097-dev, openssl, openssl097, openssl098
  BuildDependsOnly: True
  Files: include lib share/man/man3 share/man/man5 share/man/man7
  DocFiles: README LICENSE CHANGES FAQ NEWS
  PostInstScript: <<
   update-alternatives --install %p/share/man/man3/md5.3 md5.3  %p/share/man/man3/md5.3.%N098 60
  <<
  PreRmScript: <<
   if [ $1 != "upgrade" ]; then
    update-alternatives --remove md5.3 %p/share/man/man3/md5.3.%N098
   fi
  <<
<<
DocFiles: README LICENSE CHANGES FAQ NEWS
ConfFiles: %p/etc/ssl/openssl.cnf
#
Description: Secure Sockets Layer and Crypto Library
DescDetail: <<
OpenSSL is a free implementation of the Secure Sockets Layer (SSL)
and Transport Layer Security (TLS) protocols. It includes command line
utilities to manager certificates and a separate library implementing
common cryptograhic algorithms.
<<
DescPort: <<
Older versions of the openssl package used to use a compatibility version of
0.9.6.  To stay compatbile with those, we build dylibs with that compatibility
version.  This works since the old version luckily also hardcoded 0.9.6 into
the library install_name.

For the new version of the libs, we use an install_name following the one used
by Apple's version of openssl (and unlike the default openssl wants to build),
that is, libssl.0.9.dylib.

We have to apply a small trick to get it to link against its own static libs
instead of the system's ssl dylibs.

Patch Configure: i386 is little-endian
<<
DescPackaging: <<
monipol, 2009-09-06:
 OpenSSL has problems with the installation of man pages on case-insensitive
 filesystems. Even though there is a filecase option in the Makefile that is
 used on Windows, it doesn't seem to be correct. For the moment I'm not dealing
 with this problem in order to commit the x86_64 fix as soon as possible.
<<
License: OSI-Approved
Homepage: http://www.openssl.org/
Maintainer: Monic Polynomial <monipol@users.sourceforge.net>
