diff -ru gd-2.0.1/Makefile gd-2.0.1-patched/Makefile
--- gd-2.0.1/Makefile	Tue Apr  3 16:44:41 2001
+++ gd-2.0.1-patched/Makefile	Sat Mar 16 21:37:41 2002
@@ -1,10 +1,12 @@
 #Depending on your system and the libraries and features you have
 #and want, you WILL need to modify this Makefile!
 
+PREFIX=/usr/local
+
 #If you do not have gcc, change the setting for COMPILER, but you must
 #use an ANSI standard C compiler (NOT the old SunOS 4.1.3 cc
 #compiler; get gcc if you are still using that). 
-COMPILER=gcc
+COMPILER=cc
 
 #If the ar command fails on your system, consult the ar manpage
 #for your system. 
@@ -14,7 +16,7 @@
 #Remove -DHAVE_LIBFREETYPE if you can live without FreeType text.
 #Add -DHAVE_XPM if you have X and xpm installed and you want that feature.
 
-CFLAGS=-g -DHAVE_LIBPNG -DHAVE_LIBJPEG -DHAVE_LIBFREETYPE
+CFLAGS=-g -DHAVE_LIBPNG -DHAVE_LIBJPEG -DHAVE_LIBFREETYPE -DHAVE_XPM
 
 #PLEASE NOTE: YOU MAY HAVE TO JUGGLE THE ORDER OF THE LIBRARIES.
 #Some systems are very picky about link order. They don't all agree
@@ -23,33 +25,33 @@
 #Best for most users. If you don't have FreeType, remove -lfreetype.
 #Add -lxpm if you need XPM support.
 
-LIBS=-lgd -lpng -lz -ljpeg -lfreetype -lm
+LIBS=-lgd -lpng -lz -ljpeg -lfreetype -lm -lXpm
 
 #Typical install locations for freetype 2.0, zlib, xpm, libjpeg 
 #and libpng header files. If yours are somewhere else, change this. 
 #-I. is important to ensure that the version of gd you are installing 
 #is used, and not an older release in your directory tree somewhere.
 
-INCLUDEDIRS=-I. -I/usr/include/freetype2 -I/usr/include/X11 -I/usr/X11R6/include/X11 -I/usr/local/include 
+INCLUDEDIRS=-I. -I$(PREFIX)/include/freetype2 -I/usr/X11R6/include -I/usr/X11R6/include/X11 -I$(PREFIX)/include 
 
 #Typical install locations for freetype, zlib, xpm and libpng libraries.
 #If yours are somewhere else, other than a standard location
 #such as /lib or /usr/lib, then change this. This line shouldn't hurt 
 #if you don't actually have some of the optional libraries and directories.
-LIBDIRS=-L/usr/local/lib -L/usr/lib/X11 -L/usr/X11R6/lib
+LIBDIRS=-L. -L$(PREFIX)/lib -L/usr/X11R6/lib
 
-#Location where libgd.so should be installed by "make install".
+#Location where libgd.dylib should be installed by "make install".
 #THIS MUST BE ONE OF YOUR STANDARD SHARED LIBRARY LOCATIONS, unless
 #you add a new directory to your LD_LIBRARY_PATH environment setting.
-#Otherwise applications will NOT find libgd.so and will produce an 
+#Otherwise applications will NOT find libgd.dylib and will produce an 
 #error.  
-INSTALL_LIB=/usr/lib
+INSTALL_LIB=$(DESTDIR)$(PREFIX)/lib
 
 #Location where .h files should be installed by "make install".
-INSTALL_INCLUDE=/usr/include
+INSTALL_INCLUDE=$(DESTDIR)$(PREFIX)/include
 
 #Location where useful non-test programs should be installed by "make install".
-INSTALL_BIN=/usr/local/bin
+INSTALL_BIN=$(DESTDIR)$(PREFIX)/bin
 
 #
 #
@@ -87,7 +89,7 @@
 
 test: $(TEST_PROGRAMS)
 
-install: libgd.so.${VERSION} $(BIN_PROGRAMS)
+install: libgd.${VERSION}.dylib $(BIN_PROGRAMS)
 	sh ./install-item 755 pngtogd $(INSTALL_BIN)/pngtogd
 	sh ./install-item 755 pngtogd2 $(INSTALL_BIN)/pngtogd2
 	sh ./install-item 755 gdtopng $(INSTALL_BIN)/gdtopng
@@ -152,17 +154,25 @@
 #problem, this target also installs the library so that applications can
 #actually find it.
 
-libgd.so.${VERSION}: ${LIBOBJS}
-	-rm -f libgd.so.${VERSION} 2>/dev/null
-	ld -shared -o libgd.so.${VERSION} ${LIBOBJS}
-	sh ./install-item 644 libgd.so.${VERSION} \
-		$(INSTALL_LIB)/libgd.so.${VERSION}
-	-rm $(INSTALL_LIB)/libgd.so.${MAJOR_VERSION} 2>/dev/null
-	ln -s $(INSTALL_LIB)/libgd.so.${VERSION} \
-		$(INSTALL_LIB)/libgd.so.${MAJOR_VERSION}	
-	-rm $(INSTALL_LIB)/libgd.so 2>/dev/null
-	ln -s $(INSTALL_LIB)/libgd.so.${VERSION} \
-		$(INSTALL_LIB)/libgd.so	
+libgd.${VERSION}.dylib: ${LIBOBJS}
+	-rm -f libgd.${VERSION}.dylib 2>/dev/null
+	$(COMPILER) -dynamiclib -o libgd.${VERSION}.dylib \
+              -install_name $(PREFIX)/lib/libgd.${MAJOR_VERSION}.dylib \
+              -compatibility_version ${VERSION} \
+              -current_version ${VERSION} \
+              -L$(PREFIX)/lib -L/usr/X11R6/lib \
+              -lpng -lz -ljpeg -lfreetype -lm -lXpm \
+              ${LIBOBJS}
+	-rm -f libgd.dylib 2>/dev/null
+	ln -s libgd.${VERSION}.dylib libgd.dylib
+	sh ./install-item 644 libgd.${VERSION}.dylib \
+		$(INSTALL_LIB)/libgd.${VERSION}.dylib
+	-rm $(INSTALL_LIB)/libgd.${MAJOR_VERSION}.dylib 2>/dev/null
+	ln -s $(PREFIX)/lib/libgd.${VERSION}.dylib \
+		$(INSTALL_LIB)/libgd.${MAJOR_VERSION}.dylib	
+	-rm $(INSTALL_LIB)/libgd.dylib 2>/dev/null
+	ln -s $(PREFIX)/lib/libgd.${VERSION}.dylib \
+		$(INSTALL_LIB)/libgd.dylib	
 
 #Static library, if you really need one for some reason.
 libgd.a: ${LIBOBJS}
diff -ru gd-2.0.1/gdcache.h gd-2.0.1-patched/gdcache.h
--- gd-2.0.1/gdcache.h	Tue Apr  3 16:44:42 2001
+++ gd-2.0.1-patched/gdcache.h	Sat Mar 16 20:15:06 2002
@@ -40,7 +40,9 @@
 /* header                                                */
 /*********************************************************/
 
+#ifndef __APPLE__
 #include <malloc.h>
+#endif
 #ifndef NULL
 #define NULL (void *)0
 #endif
