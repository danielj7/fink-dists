diff -Naur advancemenu-2.3.4/advance/advance.mak advancemenu-2.3.4.patched/advance/advance.mak
--- advancemenu-2.3.4/advance/advance.mak	Wed May 12 14:39:32 2004
+++ advancemenu-2.3.4.patched/advance/advance.mak	Tue May 25 01:38:29 2004
@@ -279,22 +279,22 @@
 pkgdocdir = $(docdir)/advance
 
 installdirs:
-	-$(INSTALL_DATA_DIR) $(pkgdir)
-	-$(INSTALL_DATA_DIR) $(pkgdocdir)
-	-$(INSTALL_MAN_DIR) $(mandir)/man1
+	-$(INSTALL_DATA_DIR) $(DESTDIR)$(pkgdir)
+	-$(INSTALL_DATA_DIR) $(DESTDIR)$(pkgdocdir)
+	-$(INSTALL_MAN_DIR) $(DESTDIR)$(mandir)/man1
 ifneq ($(wildcard $(EMUSRC)),)
-	-$(INSTALL_DATA_DIR) $(pkgdir)/rom
-	-$(INSTALL_DATA_DIR) $(pkgdir)/sample
-	-$(INSTALL_DATA_DIR) $(pkgdir)/artwork
-	-$(INSTALL_DATA_DIR) $(pkgdir)/image
-	-$(INSTALL_DATA_DIR) $(pkgdir)/crc
+	-$(INSTALL_DATA_DIR) $(DESTDIR)$(pkgdir)/rom
+	-$(INSTALL_DATA_DIR) $(DESTDIR)$(pkgdir)/sample
+	-$(INSTALL_DATA_DIR) $(DESTDIR)$(pkgdir)/artwork
+	-$(INSTALL_DATA_DIR) $(DESTDIR)$(pkgdir)/image
+	-$(INSTALL_DATA_DIR) $(DESTDIR)$(pkgdir)/crc
 endif
 
 install-data: $(INSTALL_DATAFILES)
 ifdef INSTALL_DATAFILES
 	@for i in $(INSTALL_DATAFILES); do \
-		echo "$(INSTALL_DATA) $$i $(pkgdir)"; \
-		$(INSTALL_DATA) $$i $(pkgdir); \
+		echo "$(INSTALL_DATA) $$i $(DESTDIR)$(pkgdir)"; \
+		$(INSTALL_DATA) $$i $(DESTDIR)$(pkgdir); \
 	done
 endif
 
@@ -307,8 +307,8 @@
 
 install-bin: $(INSTALL_BINFILES)
 	@for i in $(INSTALL_BINFILES); do \
-		echo "$(INSTALL_PROGRAM) $$i $(bindir)"; \
-		$(INSTALL_PROGRAM) $$i $(bindir); \
+		echo "$(INSTALL_PROGRAM) $$i $(DESTDIR)$(bindir)"; \
+		$(INSTALL_PROGRAM) $$i $(DESTDIR)$(bindir); \
 	done
 
 uninstall-bin:
@@ -319,8 +319,8 @@
 install-doc: $(DOCOBJ) $(INSTALL_DOCFILES)
 ifdef INSTALL_DOCFILES
 	@for i in $(INSTALL_DOCFILES); do \
-		echo "$(INSTALL_DATA) $$i $(pkgdocdir)"; \
-		$(INSTALL_DATA) $$i $(pkgdocdir); \
+		echo "$(INSTALL_DATA) $$i $(DESTDIR)$(pkgdocdir)"; \
+		$(INSTALL_DATA) $$i $(DESTDIR)$(pkgdocdir); \
 	done
 endif
 
@@ -334,8 +334,8 @@
 install-man: $(DOCOBJ) $(INSTALL_MANFILES)
 ifdef INSTALL_MANFILES
 	@for i in $(INSTALL_MANFILES); do \
-		echo "$(INSTALL_DATA) $$i $(mandir)/man1"; \
-		$(INSTALL_DATA) $$i $(mandir)/man1; \
+		echo "$(INSTALL_DATA) $$i $(DESTDIR)$(mandir)/man1"; \
+		$(INSTALL_DATA) $$i $(DESTDIR)$(mandir)/man1; \
 	done
 endif
 
diff -Naur advancemenu-2.3.4/advance/lib/fz.c advancemenu-2.3.4.patched/advance/lib/fz.c
--- advancemenu-2.3.4/advance/lib/fz.c	Wed May 12 14:39:32 2004
+++ advancemenu-2.3.4.patched/advance/lib/fz.c	Tue May 25 18:22:29 2004
@@ -93,11 +93,7 @@
 
 static int fgetc_lock(FILE* f)
 {
-#if HAVE_FEOF_UNLOCKED
-	return fgetc_unlocked(f);
-#else
 	return fgetc(f);
-#endif
 }
 
 /**************************************************************************/
diff -Naur advancemenu-2.3.4/advance/menu/mconfig.cc advancemenu-2.3.4.patched/advance/menu/mconfig.cc
--- advancemenu-2.3.4/advance/menu/mconfig.cc	Wed May 12 14:39:32 2004
+++ advancemenu-2.3.4.patched/advance/menu/mconfig.cc	Tue May 25 01:38:29 2004
@@ -496,8 +496,6 @@
 			e = new wmame(a0, a2, a3);
 		} else if (a1 == "dmame") {
 			e = new dmame(a0, a2, a3);
-		} else if (a1 == "xmame") {
-			e = new xmame(a0, a2, a3);
 		} else if (a1 == "dmess") {
 			e = new dmess(a0, a2, a3);
 		} else if (a1 == "draine") {
@@ -1074,23 +1072,6 @@
 		if (target_search(path, FILE_MAXPATH, "advmess") == 0) {
 			target_out("Adding emulator `advmess'...\n");
 			conf_set(config_context, "", "emulator", "\"advmess\" advmess \"advmess\" \"\"");
-		}
-		if (target_search(path, FILE_MAXPATH, "xmame") == 0) {
-			target_out("Adding emulator `xmame'...\n");
-			conf_set(config_context, "", "emulator", "\"xmame\" xmame \"xmame\" \"\"");
-		} else {
-			if (target_search(path, FILE_MAXPATH, "xmame.x11") == 0) {
-				target_out("Adding emulator `xmame.x11'...\n");
-				conf_set(config_context, "", "emulator", "\"xmame.x11\" xmame \"xmame.x11\" \"\"");
-			}
-			if (target_search(path, FILE_MAXPATH, "xmame.SDL") == 0) {
-				target_out("Adding emulator `xmame.SDL'...\n");
-				conf_set(config_context, "", "emulator", "\"xmame.SDL\" xmame \"xmame.SDL\" \"\"");
-			}
-			if (target_search(path, FILE_MAXPATH, "xmame.svgalib") == 0) {
-				target_out("Adding emulator `xmame.svgalib'...\n");
-				conf_set(config_context, "", "emulator", "\"xmame.svgalib\" xmame \"xmame.svgalib\" \"\"");
-			}
 		}
 #endif
 	}
