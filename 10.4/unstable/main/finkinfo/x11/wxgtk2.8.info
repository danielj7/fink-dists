# Fingolfin notes: This packages is not at all in sync with wxmac28, which is a pity.
# Some obvious differences:
# - Name: wxgtk2.8 vs. wxmac28 (not much we can do about this short of renaming one 
#   of the two and updating all dependent packages)
# - different maintainer (OK, not really a problem, but a single maintainer helps to keep
#   the packages in sync. At the very least it would be helpful if the maintainers talked
#   to each other. Before that happens, we need a maintainer for this package, though :)
# - different versions: right now 2.8.0 vs 2.8.3, making *both* oudated ;)
# - DocFiles of the splitoff differ
# - one seems to use expat, the other libxml2 (?!?)
# - wxgtk2.8 has lots and lots of --enable switches (but some of them do nothing).
#   which wxmac28 doesn't have/use. In particular, it seems they were added randomly
#   without a true understanding. For example, it just seems *queer* to use
#   --enable-no_rtti and --enable-no_exceptions, you never want those unless you *must*.
#   They are probably the reason why --enable-stl doesn't work (which in turn is for
#   some users a rather interesting option to use).
### Maybe 'it just seems' , but they are NOT the reason.  (JFm)
# - wxgtk2.8 seems to build some extra stuff (from contrib/) -- imo either both or none
#   should do this. maybe contrib stuff should go into splitoffs?
# - missing (?) cppunit dependency (one can argue about this one -- no binary difference should be
#   caused by this. But it would be preferable to either always run the unit tests, or never 
#   (the latter achieved by patching configure?)

Package: wxgtk2.8
Version: 2.8.0
Revision: 2
GCC: 4.0
Description: Cross-platform GUI API - unix/gtk version
License: GPL
Maintainer: None <fink-devel@lists.sourceforge.net>

# + cppunit1.10.2 ?, others ?  Also: no evidence for expat1 from otool or from included (during make) headers 
BuildDepends: <<
  atk1, expat1, gconf2-dev, glib2-dev, gnome-vfs2-unified-dev, gst-plugins-base-0.10-dev,
  gstreamer-0.10-dev, gtk+2-dev, libbonobo2-dev, libgettext3-dev, libgl, libgnomecanvas2-dev,
  libgnomeprint2.2-dev, libgnomeprintui2.2-dev, libiconv-dev,
  libjpeg, libpng3, libtiff, libxml2, orbit2-dev, pango1-xft2-dev, x11-dev
<<
Depends: %N-shlibs (= %v-%r)
Conflicts: wxgtk, wxmac, wxmac28
Replaces: wxgtk, wxmac, wxmac28
BuildDependsOnly: True

PatchScript: <<
  perl -pi -e 's/hardcode_direct=yes/hardcode_direct=no/g' configure
  perl -pi -e 's/single_module/$& -Wl,-x -dead_strip/' build/aclocal/bakefile.m4 configure
  perl -pi -e 's,^extern,#undef BOOL\n$&,' src/unix/displayx11.cpp
# to dispense with '--enable-monolithic' :
  perl -pi -e 's,^\@COND_SHARED_1_USE_XRC_1\@.*\(__WXLIB_BASE_p\)$,$& -lwx_gtk2u_adv-2.8 -lwx_gtk2u_html-2.8,' contrib/src/gizmos/Makefile.in
# for 10.5, force pkg-config not to find cairo, also apply fix for -lGL :
  perl -pi -e 's,exists --print-errors "cairo,$&no,' configure
  perl -pi -e 's;EXTRALIBS_OPENGL=";$&-Wl,-dylib_file,/System/Library/Frameworks/OpenGL.framework/Versions/A/Libraries/libGL.dylib:/System/Library/Frameworks/OpenGL.framework/Versions/A/Libraries/libGL.dylib ;' configure
## uncomment the following to check bdeps  _ (using the command :
## egrep '^\.+ /' wxgtk2.8.log|sort -u|sed -r -e 's,^\.+ ,,'|sort -u|egrep -v '^/usr/(include|lib)/'|xargs dpkg -S 2>/dev/null|cut -f1 -d:|sort -u|xargs
## ):
#  sed -ri -e 's,@CPPFLAGS@,& -H,' {,utils/wxrc/,contrib/src/{gizmos,stc,ogl}/}Makefile.in
<<
Source: mirror:sourceforge:wxwindows/wxWidgets-%v.tar.bz2
Source-MD5: 4bf9c66cdb7cda1d2fe51376c211b9e1

# Avoid linkng old version of self
NoSetLDFLAGS: true
SetLIBRARY_PATH: /usr/X11R6/lib:%p/lib

NoSetCPPFLAGS: true
NoSetMAKEFLAGS: true
SetMAKEFLAGS: -j1

# each of the following led to errors (even with --enable-permissive)
# --with-odbc --with-sdl --enable-stl --enable-accessibility
ConfigureParams: <<
  --with-gtk --with-gnomeprint --with-gnomevfs --with-freetype --with-opengl \
  --with-expat --with-regex --with-zlib --with-libxpm --with-libtiff --with-libjpeg --with-libpng \
  --enable-optimise --enable-threads --enable-no_rtti --enable-no_exceptions \
  --enable-std_iostreams --enable-std_string --enable-gui --enable-help --enable-docview \
  --enable-unicode --enable-intl --enable-display --enable-geometry --enable-controls --enable-gpe --enable-iff \
  --enable-mediactrl --enable-graphics_ctx --enable-dataviewctrl --enable-tabdialog
<<
# try w/o --enable-monolithic
# try w/o "--enable-no_exceptions" to check if rapidsvn builds correctly.. didn't work _ reinstated -no_exceptions
CompileScript: <<
 #!/bin/sh -ev
 export CPATH=%p/include
## have to disable cairo for the moment, else missing symbol gdk_cairo_create
## in src/generic/graphicc.cpp _ has to wait for gtk >= 2.8 presumably
# export CPATH=%p/include/cairo:$CPATH
## the latest version of cairo's pc files require freetype2.pc, which exists only in ft219...
# export PKG_CONFIG_PATH=$PKG_CONFIG_PATH:%p/lib/freetype219/lib/pkgconfig
 cd build
 ../configure %c
 make EXTRALIBS="-lz -lpthread -liconv -lfreetype -lX11 -lXext"
 make -C contrib/src/gizmos
# make -C contrib/src/ogl CXXFLAGS="-DwxUSE_DEPRECATED=0"
# above destroys inherited CXXFLAGS (in particular, -fno-rtti
# hence ensuing missing symbols "typeinfo for..." when linking (eg, libwx_gtk2u_ogl)) _ try without:
 make -C contrib/src/ogl
 make -C contrib/src/stc
<<
InstallScript: <<
 #!/bin/sh -ev
 mkdir -p %i/include
 mkdir -p %i/bin
 cp -R contrib/include/wx %i/include
 cd build
 make DESTDIR=%d install
 make -C contrib/src/gizmos prefix=%i install
 make -C contrib/src/ogl CXXFLAGS="-DwxUSE_DEPRECATED=0" prefix=%i install
 make -C contrib/src/stc prefix=%i install
 make DESTDIR=%d install-wxconfig
 make DESTDIR=%d locale_install
 chmod a-x %i/include/wx-2.8/wx/*.h %i/lib/*
 mkdir -p %i/share/doc
 ln -s %N-shlibs %i/share/doc/%n
<<
SplitOff: <<
 Package: %N-shlibs
 Replaces: %N
 Depends: <<
    libpng3-shlibs, libjpeg-shlibs, libtiff-shlibs, libgettext3-shlibs,
    libiconv, libxml2-shlibs, 
    atk1-shlibs, gconf2-shlibs, glib2-shlibs, gst-plugins-base-0.10-shlibs, gstreamer-0.10-shlibs,
    gtk+2-shlibs, orbit2-shlibs, pango1-xft2-shlibs, x11-shlibs
 <<
 Files: lib/libwx_*-*.*.*.dylib
# The following is with '--enable-monolithic'
# Shlibs: <<
#  %p/lib/libwx_gtk2u-2.8.0.dylib	1.0.0	%n	(>= 2.8.0-1)
#  %p/lib/libwx_gtk2u_gizmos-2.8.0.dylib	1.0.0	%n	(>= 2.8.0-1)
#  %p/lib/libwx_gtk2u_gizmos_xrc-2.8.0.dylib	1.0.0	%n	(>= 2.8.0-1)
#  %p/lib/libwx_gtk2u_gl-2.8.0.dylib	1.0.0	%n	(>= 2.8.0-1)
#  %p/lib/libwx_gtk2u_ogl-2.8.0.dylib	1.0.0	%n	(>= 2.8.0-1)
#  %p/lib/libwx_gtk2u_stc-2.8.0.dylib	1.0.0	%n	(>= 2.8.0-1)
# <<
 Shlibs: <<
  %p/lib/libwx_baseu-2.8.0.dylib	1.0.0	%n	(>= 2.8.0-1)
  %p/lib/libwx_baseu_net-2.8.0.dylib	1.0.0	%n	(>= 2.8.0-1)
  %p/lib/libwx_baseu_xml-2.8.0.dylib	1.0.0	%n	(>= 2.8.0-1)
  %p/lib/libwx_gtk2u_adv-2.8.0.dylib	1.0.0	%n	(>= 2.8.0-1)
  %p/lib/libwx_gtk2u_aui-2.8.0.dylib	1.0.0	%n	(>= 2.8.0-1)
  %p/lib/libwx_gtk2u_core-2.8.0.dylib	1.0.0	%n	(>= 2.8.0-1)
  %p/lib/libwx_gtk2u_gizmos-2.8.0.dylib	1.0.0	%n	(>= 2.8.0-1)
  %p/lib/libwx_gtk2u_gizmos_xrc-2.8.0.dylib	1.0.0	%n	(>= 2.8.0-1)
  %p/lib/libwx_gtk2u_gl-2.8.0.dylib	1.0.0	%n	(>= 2.8.0-1)
  %p/lib/libwx_gtk2u_html-2.8.0.dylib	1.0.0	%n	(>= 2.8.0-1)
  %p/lib/libwx_gtk2u_media-2.8.0.dylib	1.0.0	%n	(>= 2.8.0-1)
  %p/lib/libwx_gtk2u_ogl-2.8.0.dylib	1.0.0	%n	(>= 2.8.0-1)
  %p/lib/libwx_gtk2u_qa-2.8.0.dylib	1.0.0	%n	(>= 2.8.0-1)
  %p/lib/libwx_gtk2u_richtext-2.8.0.dylib	1.0.0	%n	(>= 2.8.0-1)
  %p/lib/libwx_gtk2u_stc-2.8.0.dylib	1.0.0	%n	(>= 2.8.0-1)
  %p/lib/libwx_gtk2u_xrc-2.8.0.dylib	1.0.0	%n	(>= 2.8.0-1)
 <<
 DocFiles: docs/readme.txt docs/licence.txt docs/changes.txt docs/lgpl.txt docs/gpl.txt
<<

Homepage: http://www.wxwidgets.org/
DescDetail: <<
 In addition to common and advanced GUI facilities such as
 frames, scrolling windows, toolbars, tree controls, icons,
 device contexts, printing, splitter windows and so on, there are
 wrappers for common file operations, and facilities for writing
 TCP/IP applications, thread handling, and more. Where certain
 features are not available on a platform, such as MDI and tree
 controls on Unix, they are emulated.
<<
