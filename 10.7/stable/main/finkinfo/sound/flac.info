Package: flac
Version: 1.2.1
Revision: 1001
BuildDepends: <<
	fink (>= 0.30.0),
	fink-package-precedence,
	libiconv-dev,
	libogg,
	nasm
<<
Depends: libflac8 (>= %v-%r)
Source: mirror:sourceforge:%n/%n-%v.tar.gz
Source-MD5: 153c8b15a54da428d1f0fadc756c22c7
PatchFile: %n.patch
PatchFile2: %n-build_lib.mk.patch
PatchFile3: %n-ltmain.sh.patch
PatchFile4: %n-nasm.h.patch
PatchFile5: %n-config.h.ed
PatchFile-MD5: 5c41b21888c325ba7d77dcc67e24ac9b
PatchFile2-MD5: 0e2c5d7b79eaacc6b0795c1d1712f09b
PatchFile3-MD5: a422d308ac47d4d525fab4362dd471ea
PatchFile4-MD5: b8a9daaed4dcb0f305a352e152847440
PatchFile5-MD5: 61f655e7525d2094696f49cd3339adf6
NoSetCPPFLAGS: true
SetCPPFLAGS: -I$(top_builddir) -I$(srcdir)/include -I$(top_srcdir)/include -I%p/include
NoSetLDFLAGS: true
UseMaxBuildJobs: true
ConfigureParams: <<
	--mandir='${prefix}/share/man' \
	--disable-static \
	--enable-dependency-tracking \
	--enable-exhaustive-tests \
	--disable-doxygen-docs \
	--disable-xmms-plugin \
	--disable-rpath \
	--disable-asm-optimizations
<<
BuildDependsOnly: True
GCC: 4.0

CompileScript: <<
  #!/bin/sh -ex
  ./configure %c
  ed - %b/config.h < config.h.ed && touch stamp-h1
  make -w OBJ_FORMAT=macho
  fink-package-precedence --headers --libs --prohibit-bdep=libflac8-dev .
<<
InfoTest: <<
	TestScript: DYLD_LIBRARY_PATH=%b/src/libFLAC++/.libs/:%b/src/libFLAC/.libs make check || exit 2
	TestSuiteSize: large
<<
InstallScript: <<
  #!/bin/sh -ex
  #bd=$(cd . && pwd -P)
  #perl -pi -e "s#\Q$bd\E/src/libFLAC#%p/lib#g" src/plugin_xmms/libxmms-flac.la
  make install DESTDIR=%d 
  mv %i/share/doc/%n-%v %i/share/doc/%n 
<<

SplitOff: <<
  Package: libflac8
  Depends: libogg-shlibs
  Suggests: %N
  Files: lib/libFLAC.*.dylib lib/libFLAC++.*.dylib
  Shlibs: <<
    %p/lib/libFLAC.8.dylib 11.0.0 %n (>= 1.2.1-1)
    %p/lib/libFLAC++.6.dylib 9.0.0 %n (>= 1.2.1-1)
  <<
  DocFiles: README COPYING.LGPL
  Description: Free lossless audio codec - shared libs
<<
SplitOff3: <<
  Package: libflac8-dev
  Files: include lib share/aclocal
  Depends: libflac8, libiconv
  DocFiles: README COPYING.LGPL
  Description: Free lossless audio codec - encoder/decoder
  BuildDependsOnly: true
<<
Splitoff4: <<
  Package: flac-doc
  Files: share/doc/%N/html
  Description: HTML format docs for flac and libflac.
<<
DocFiles: README AUTHORS COPYING.FDL COPYING.GPL COPYING.LGPL
Description: Free lossless audio codec
DescDetail: <<
FLAC stands for Free Lossless Audio Codec. Grossly oversimplified, FLAC
is similar to MP3, but lossless. The FLAC project consists of:
*  The stream format
In the libflacX packages:
*  libFLAC, a library encoders and decoders, and a metadata interface
*  libFLAC++, an object wrapper around libFLAC
In the flac package:
*  flac, a CLI wrapper around libFLAC to encode/decode .flac files
*  metaflac, a command-line metadata editor for .flac files
In the flac-xmms package:
*  Input plugin for XMMS
<<
DescPackaging: <<
Does not use pbxbuild method since we want dylibs.
Also the make/config method puts everything in
the right place.
libtool relink and bash versioning patches applied.
patch to enable dynamic_lookup (for prebinding on 10.3) applied.
<<
DescPort: <<
asm code insisted on building as i386, but switching it 
to x86_64 (macho64) needs lots of love, so disabling.
<<
License: GPL
Maintainer: Hanspeter Niederstrasser <nieder@users.sourceforge.net>
Homepage: http://flac.sourceforge.net/
