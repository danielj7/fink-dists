Package: glib2-shlibs
Version: 2.20.5
Revision: 2
BuildDepends: <<
	fink (>= 0.24.12-1),
	gettext-bin,
	gettext-tools,
	gtk-doc (>= 1.11-1),
	libgettext3-dev,
	libiconv-dev,
	pkgconfig (>= 0.23)
<<
Depends: <<
	libgettext3-shlibs,
	libiconv,
	xdg-base
<<
Recommends: <<
	desktop-file-utils (>= 0.15-1),
	shared-mime-info (>= 0.51-1)
<<
Source: mirror:gnome:sources/glib/2.20/glib-%v.tar.bz2
Source-MD5: 4c178b91d82ef80a2da3c26b772569c0
PatchFile: %n.patch
PatchFile-MD5: e5920bfc51aa16ca8142eb672a9a7410
PatchScript: <<
	sed 's,@PREFIX@,%p,g' < %{PatchFile} | patch -p1
	perl -pi -e 's,/usr/share/gtk-doc/html,%p/share/gtk-doc/html,g' docs/reference/*/html/*.html
<<
SetCFLAGS: -Os
ConfigureParams: --mandir=%p/share/man --disable-gtk-doc --disable-dependency-tracking --disable-fam
CompileScript: <<
	PERL_PATH=/usr/bin/perl PERL=/usr/bin/perl ./configure %c PYTHON=/usr/bin/python
	perl -pi -e '$_="#define BROKEN_POLL 1\n" if /BROKEN_POLL/' config.h
	make
<<
InfoTest: <<
	TestDepends: <<
		desktop-file-utils (>= 0.15-1),
		shared-mime-info (>= 0.51-1)
	<<
	TestScript: LANG=C make check || exit 2
<<
InstallScript: <<
	make install DESTDIR=%d
<<
Shlibs: <<
	%p/lib/libgio-2.0.0.dylib 2001.0.0 %n (>= 2.20.2-1)
	%p/lib/libglib-2.0.0.dylib 2001.0.0 %n (>= 2.20.2-1)
	%p/lib/libgmodule-2.0.0.dylib 2001.0.0 %n (>= 2.20.2-1)
	%p/lib/libgobject-2.0.0.dylib 2001.0.0 %n (>= 2.20.2-1)
	%p/lib/libgthread-2.0.0.dylib 2001.0.0 %n (>= 2.20.2-1)
<<
DocFiles: <<
	AUTHORS
	docs/reference/AUTHORS:AUTHORS.docs.reference
	gmodule/AUTHORS:AUTHORS.gmodule
	ChangeLog*
	docs/reference/ChangeLog:ChangeLog.docs.reference
	gio/ChangeLog:ChangeLog.gio
	gmodule/ChangeLog:ChangeLog.gmodule
	gobject/ChangeLog:ChangeLog.gobject
	gthread/ChangeLog:ChangeLog.gthread
	po/ChangeLog:ChangeLog.po
	COPYING NEWS README
<<
SplitOff: <<
	Package: glib2-dev
	Depends: <<
		glib2-shlibs (= %v-%r),
		libgettext3-shlibs,
		libiconv,
		pkgconfig (>= 0.23)
	<<
	Description: Handy library of utility functions
	Replaces: glib2 (<< 2.18.4-2)
	BuildDependsOnly: True
	Files: <<
		bin
		include
		lib/gio
		lib/glib-2.0
		lib/lib*-2.0.{dylib,la}
		lib/pkgconfig
		share/aclocal
		share/glib-2.0
		share/gtk-doc
		share/man
	<<
	DocFiles: <<
		AUTHORS
		docs/reference/AUTHORS:AUTHORS.docs.reference
		gmodule/AUTHORS:AUTHORS.gmodule
		ChangeLog*
		docs/reference/ChangeLog:ChangeLog.docs.reference
		gio/ChangeLog:ChangeLog.gio
		gmodule/ChangeLog:ChangeLog.gmodule
		gobject/ChangeLog:ChangeLog.gobject
		gthread/ChangeLog:ChangeLog.gthread
		po/ChangeLog:ChangeLog.po
		COPYING NEWS README
	<<
<<
Description: Handy library of utility functions
DescPort: <<
	glib2 provides etc/glib-2.0/charset.alias for darwin because there's
	no system-wide charset.alias.
	See also: http://bugzilla.gnome.org/show_bug.cgi?id=346816
	Can we figure out how to generate this (gettext-tools config.charset
	for host=darwin5?)or import it from an authoritative upstream source
	instead of dragging along a legacy file in %N.patch?

	Disable two tests that fail on OS X apparently due to deficiencies
	in OS X locale support.
	See: http://bugzilla.gnome.org/show_bug.cgi?id=333977

	check uses some C++ but it doesn't leak out into the installed
	package

	Patch child-test.c for our location of `true`. See:
	http://bugzilla.gnome.org/show_bug.cgi?id=495690

	We need to set LANG=C when doing 'make check', else a previously
	installed glib2 will trigger a crash caused by a bug in the old
	de.po. See http://bugzilla.gnome.org/show_bug.cgi?id=310731
	Need to figure out how to patch tests/Makefile to use the nascent
	gettext dictionaries in preference to installed ones.

	poll() is broken on 10.4 but not 10.3; force internal emulation
	to regardless of config result so that lib builds the same everywhere
	and is portable.

	Need to patch gutils.h for inline semantics of gcc on OS X >= 10.5.
	gcc version is not sufficient to determine it (appears to be xcode-
	specific patches to gcc), so test Apple gcc build number. See:
	http://bugzilla.gnome.org/show_bug.cgi?id=315437 (patch	#96366 does
	not work...not __GNUC_PREREQ). No idea a portable solution, but
	msachs says "static inline" is right for this case, so hardcode it.
	2.14.5 does it "differently" but still looks like the same wrong
	patch, so leaving our existing "static inline" hard-coding patch.

	Fix paths in glib-gettextize. See:
	http://bugzilla.gnome.org/show_bug.cgi?id=518309

	Fix glib/gslice.c clobbering of errno.
	See: http://bugzilla.gnome.org/show_bug.cgi?id=554092
	(patch from comments #14)

	Safer -framework flag to avoid future munging in .la. See:
	http://bugzilla.gnome.org/show_bug.cgi?id=566994
	Flag is not passed at all via .la now, but okay because we
	don't have static libs and the shared libs get what they need
	via dyld.

	Not fixing RTLD_GLOBAL configure test. See:
	http://bugzilla.gnome.org/show_bug.cgi?id=583010
<<
DescPackaging: <<
	Library contains some C symbols whose real name looks like C++
	munges. This should not be construed to mean that glib2 is C++ nor
	that it needs to obey Fink C++ packaging rules. C++ is also
	used in some self-tests.

	Prior to 2.12.0-1, %N contained the gettext catalogs and the
	charset.alias file, which are used by the %N-shlibs files. Starting
	in 2.12.0-1, they are all now in the %N-shlibs package, and %N is a
	dummy for compatibility and upgrades.

	Builds with included pcre instead of external lib to avoid need to
	cascade deps on pcre packages

	gtester-report claims to require python >= 2.4, but it appears
	to run with 2.3. Adjust to allow that version so can use
	Apple's on OS X < 10.5 also (py2.5 comes with OS X 10.5). See:
	http://bugzilla.gnome.org/show_bug.cgi?id=553716

	The following are newly deprecated in glib2 2.18.1 since 2.14.6:
		g_assert_warning
		G_GNUC_FUNCTION
		G_GNUC_PRETTY_FUNCTION
	And in 2.20:
		g_volume_monitor_adopt_orphan_mount
	External packages and out-of-sync gnome core might still be
	using them, so may as well leave them undeprecated until jump
	to glib3.

	Leaving G_DISABLE_SINGLE_INCLUDES undefined in most places,
	though in the future it will become defined...

	Disable the FAM plugin for gio. Darwin doesn't have libfam.
	Fink has gamin, a third-party implementation available in
	fink, has a dependency on glib. Eventually package gio-fam
	separately to avoid circular dependency.

	libgio sometimes runs %p/bin/update-desktop-database from the
	desktop-file-utils package or %p/bin/update-mime-database from
	the shared-mime-info package, but those programs link against
	libglib. Leave it as %N-shlibs:Recommends:... to break the
	circular dependency. Ick. Required for self-test, so would
	need to build (but not test) glib2, then build d-f-u & s-m-i
	against it, then rebuild glib2 with testing enabled. Ick^2.

	Make sure the update-*-database programs can be found even if
	run from a non-fink'ed shell: explicit path and fink XDG vars.

	Regenerating gtk-doc files The Right Way (--enable-gtk-doc) is
	very slow, so just patch the prefix in the bad URLs in the
	existing generated files.
<<
License: LGPL
Maintainer: The Gnome Core Team <fink-gnome-core@lists.sourceforge.net>
Homepage: http://www.gtk.org
