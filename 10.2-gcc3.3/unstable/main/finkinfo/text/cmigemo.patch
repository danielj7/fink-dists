diff -rc ../cmigemo-1.2-orig/compile/Make_osx.mak ./compile/Make_osx.mak
*** ../cmigemo-1.2-orig/compile/Make_osx.mak	Tue Mar 23 19:29:21 2004
--- ./compile/Make_osx.mak	Sat Mar 27 02:01:32 2004
***************
*** 26,32 ****
  #
  $(libmigemo_LIB): $(libmigemo_DSO)
  $(libmigemo_DSO): $(libmigemo_OBJ)
! 	$(CC) -dynamiclib -install_name $@ -o $(libmigemo_LIB) $(libmigemo_OBJ)
  	$(RM) $@ $(libmigemo)
  	ln -s $(libmigemo_LIB) $@
  	ln -s $(libmigemo_LIB) $(libmigemo)
--- 26,32 ----
  #
  $(libmigemo_LIB): $(libmigemo_DSO)
  $(libmigemo_DSO): $(libmigemo_OBJ)
! 	$(CC) -dynamiclib -install_name @PREFIX@/lib/$@ -o $(libmigemo_LIB) $(libmigemo_OBJ)
  	$(RM) $@ $(libmigemo)
  	ln -s $(libmigemo_LIB) $@
  	ln -s $(libmigemo_LIB) $(libmigemo)
diff -rc ../cmigemo-1.2-orig/compile/unix.mak ./compile/unix.mak
*** ../cmigemo-1.2-orig/compile/unix.mak	Tue Mar 23 19:29:21 2004
--- ./compile/unix.mak	Sat Mar 27 02:01:32 2004
***************
*** 58,64 ****
  
  install: $(outdir)cmigemo$(EXEEXT) $(libmigemo_DSO) install-mkdir install-dict install-lib
  	$(INSTALL_DATA) $(srcdir)migemo.h $(incdir)
! 	$(INSTALL_DATA) doc/README_j.txt $(docdir)
  	$(INSTALL_PROGRAM) $(outdir)cmigemo$(EXEEXT) $(bindir)
  
  ##############################################################################
--- 58,64 ----
  
  install: $(outdir)cmigemo$(EXEEXT) $(libmigemo_DSO) install-mkdir install-dict install-lib
  	$(INSTALL_DATA) $(srcdir)migemo.h $(incdir)
! 	#$(INSTALL_DATA) doc/README_j.txt $(docdir)
  	$(INSTALL_PROGRAM) $(outdir)cmigemo$(EXEEXT) $(bindir)
  
  ##############################################################################
diff -rc ../cmigemo-1.2-orig/doc/README_j.txt ./doc/README_j.txt
*** ../cmigemo-1.2-orig/doc/README_j.txt	Tue Mar 23 19:29:21 2004
--- ./doc/README_j.txt	Sat Mar 27 02:01:32 2004
***************
*** 2,8 ****
                                                              Since: 15-Aug-2001
                                                                  Version: 1.2.0
                                                    Author: MURAOKA Taro (KoRoN)
!                                                      Last Change: 29-Dec-2003.
  
  説明
    C/MigemoはMigemo(Ruby/Migemo)をC言語で実装したものです。C/Migemoライブラリを
--- 2,8 ----
                                                              Since: 15-Aug-2001
                                                                  Version: 1.2.0
                                                    Author: MURAOKA Taro (KoRoN)
!                                                      Last Change: 24-Mar-2004.
  
  説明
    C/MigemoはMigemo(Ruby/Migemo)をC言語で実装したものです。C/Migemoライブラリを
***************
*** 120,126 ****
      # make osx-install
      # make osx-uninstall
    インストールにより辞書ファイルは
!     /usr/local/share/migemo/{エンコード名}
    に置かれます。
  
    (GNU/gcc:Linux他)
--- 120,126 ----
      # make osx-install
      # make osx-uninstall
    インストールにより辞書ファイルは
!     @PREFIX@/share/migemo/{エンコード名}
    に置かれます。
  
    (GNU/gcc:Linux他)
***************
*** 138,144 ****
      # make gcc-install
      # make gcc-uninstall
    インストールにより辞書ファイルは
!     /usr/local/share/migemo/{エンコード名}
    に置かれます。
  
  利用許諾条件
--- 138,144 ----
      # make gcc-install
      # make gcc-uninstall
    インストールにより辞書ファイルは
!     @PREFIX@/local/share/migemo/{エンコード名}
    に置かれます。
  
  利用許諾条件
Only in ./tools: .migemo.vim.swp
diff -rc ../cmigemo-1.2-orig/tools/migemo.vim ./tools/migemo.vim
*** ../cmigemo-1.2-orig/tools/migemo.vim	Tue Mar 23 19:29:21 2004
--- ./tools/migemo.vim	Sat Mar 27 03:22:12 2004
***************
*** 13,18 ****
--- 13,26 ----
    finish
  endif
  
+ function! s:SearchStandardDict(enc)
+   let dict = '@PREFIX@/share/migemo/'.a:enc.'/migemo-dict'
+   if !filereadable(dict)
+     let dict = ''
+   endif
+   return matchstr(dict, "^[^\<NL>]*")
+ endfunction
+ 
  function! s:SearchDict()
    let path = $VIM . ',' . &runtimepath
    let dict = globpath(path, "dict/migemo-dict")
***************
*** 20,29 ****
      let dict = globpath(path, "migemo-dict")
    endif
    if dict == ''
!     let dict = '/usr/local/share/migemo/'.&encoding.'/migemo-dict'
!     if !filereadable(dict)
!       let dict = ''
!     endif
    endif
    return matchstr(dict, "^[^\<NL>]*")
  endfunction
--- 28,46 ----
      let dict = globpath(path, "migemo-dict")
    endif
    if dict == ''
!     let dict = s:SearchStandardDict(&encoding)
!     let g:migemoenc = &encoding
!   endif
!   if dict == ''
!     let dict = s:SearchStandardDict("cp932")
!     let g:migemoenc = 'cp932'
!   endif
!   if dict == ''
!     let dict = s:SearchStandardDict("euc-jp")
!     let g:migemoenc = 'euc-jp'
!   endif
!   if dict == ''
!     let g:migemoenc = ''
    endif
    return matchstr(dict, "^[^\<NL>]*")
  endfunction
***************
*** 59,67 ****
--- 76,90 ----
      if retval == ''
        return
      endif
+     if strlen(g:migemoenc) && strlen(&encoding) && &encoding != g:migemoenc
+       let retval = iconv(retval, &encoding, g:migemoenc)
+     endif
      let retval = system('cmigemo -v -w "'.retval.'" -d "'.g:migemodict.'"')
      if retval == ''
        return
+     endif
+     if strlen(g:migemoenc) && strlen(&encoding) && &encoding != g:migemoenc
+       let retval = iconv(retval, g:migemoenc, &encoding)
      endif
      let @/ = retval
      let v:errmsg = ''
