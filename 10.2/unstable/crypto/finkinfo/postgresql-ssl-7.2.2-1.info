Package: postgresql-ssl
Version: 7.2.2
Revision: 1
GCC: 3.1
Source: http://www.postgresql.org/ftpsite/source/v%v/postgresql-%v.tar.gz
BuildDepends: libxml2, gdbm, gmp, expat, tcltk, tcltk-dev, ant, openssl-dev, python (>= 2.2.1-5) | python-nox (>= 2.2.1-5)
Depends: readline, passwd, daemonic (>= 20010902-1), openssl-shlibs, expat-shlibs, gdbm-shlibs, libxml2-shlibs, gmp-shlibs, %N-shlibs (= %v-%r), python (>= 2.2.1-5) | python-nox (>= 2.2.1-5)
Conflicts: postgresql
Replaces: postgresql, postgresql-shlibs
Provides: postgresql
PatchScript: sed 's|@PREFIX@|%p|g' < %a/%f.patch | patch -p1
ConfigureParams: --prefix=%p --docdir=%p/share/doc --mandir=%p/share/man --enable-multibyte --enable-recode --with-CXX --with-perl --with-python --with-openssl=%p --with-libraries=%p/lib --with-includes=%p/include --with-tcl --with-tclconfig=%p/lib --with-tkconfig=%p/lib --with-java --enable-odbc
CompileScript: <<
(source %p/etc/profile.d/ant.sh; sh ./configure %c)
(source %p/etc/profile.d/ant.sh; make)
<<
InstallScript: <<
make install DESTDIR=%d INSTALLSITEMAN3DIR=%i/share/man/man3
make install-all-headers DESTDIR=%d
mv %i/share/postgresql/java %i/lib/postgresql/java
ranlib %i/lib/*.a
<<
SplitOff: <<
  Description: Perl tools for PostgreSQL application and function development.
  Package: %N-perl
  Provides: postgresql-perl
  Conflicts: postgresql-perl
  Replaces: postgresql (<< %v), postgresql-perl
  Depends: postgresql-ssl (= %v-%r)
  BuildDependsOnly: true
  Files: lib/perl5 lib/postgresql/plperl.bundle share/man/man3/Pg.3 share/doc/postgresql/html/plperl*
<<
SplitOff2: <<
  Description: Python tools for PostgreSQL application and function development.
  Package: %N-python
  Provides: postgresql-python
  Conflicts: postgresql-python
  Replaces: postgresql (<< %v), postgresql-ptyhon
  Depends: postgresql-ssl (= %v-%r)
  BuildDependsOnly: true
  Files: lib/python2.2 lib/postgresql/plpython.so share/doc/postgresql/html/plpython*
<<
SplitOff3: <<
  Description: TCL tools for PostgreSQL application and function development.
  Package: %N-tcl
  Provides: postgresql-tcl
  Conflicts: postgresql-tcl
  Replaces: postgresql (<< %v), postgresql-tcl
  Depends: postgresql-ssl (= %v-%r)
  BuildDependsOnly: true
  Files: bin/pgtclsh bin/pltcl* lib/libpgtcl* lib/postgresql/pltcl.so include/postgresql/libpgtcl.h
<<
SplitOff4: <<
  Description: Development headers and libraries for PostgreSQL.
  Package: %N-dev
  Depends: %N (= %v-%r)
  Recommends: openssl-dev, tcltk-dev, expat
  Conflicts: postgresql-dev
  Replaces: postgresql (<< %v), postgresql-dev
  BuildDependsOnly: true
  Files: bin/pg_config include lib/*.a lib/libecpg.so lib/libpgeasy.so lib/libpq++.so lib/libpq.so
<<
SplitOff5: <<
  Description: Shared libraries for PostgreSQL.
  Package: %N-shlibs
  Conflicts: postgresql-shlibs
  Replaces: postgresql (<< %v), postgresql-shlibs
  Provides: postgresql-shlibs
  BuildDependsOnly: true
  Files: lib/*.so lib/postgresql/plpgsql.so
<<
DocFiles: COPYRIGHT HISTORY INSTALL README register.txt
DaemonicFile: <<
<service>
<description>PostgreSQL database server</description>
<message> PostgreSQL database server</message>

<daemon name="postgresql">
<executable background="no">/usr/bin/sudo</executable>
<parameters>-u pgsql %p/bin/pg_ctl -D %p/var/postgresql/data start -l %p/var/log/postgresql/logfile</parameters>
</daemon>

</service>
<<
PostInstScript: <<
# create initial database
if [ ! -d %p/var/postgresql/data ]; then
  mkdir -p %p/var/postgresql/data %p/var/log/postgresql
  chown -R pgsql %p/var/postgresql %p/var/log/postgresql
  sudo -u pgsql %p/bin/initdb -D %p/var/postgresql/data
fi

# update daemonic init script if necessary
daemonic install %N
<<
PreRmScript: <<
# clean up
if [ $1 != "upgrade" ]; then
  daemonic remove %N
fi
<<

Description: Open Source SQL database
DescUsage: <<
The package runs initdb on installation as the user 'pgsql'.

You can start the PostgreSQL server manually using 'postmaster' as pgsql (since
pgsql has a shell of /dev/null by default, you must run it as sudo -u pgsql 
postmaster) or you can run 'daemonic enable postgresql' as root to create a 
StartupItem for it
<<
DescPackaging: <<
IMPORTANT: The location of the data files has changed from earlier
revisions of this package. If you're upgrading from an earlier
revision, note that this one expects the data files to be installed
at <prefex>/var/postgresql/data.

When run from the startup script, logs output to 
<prefix>/var/log/postgresql/logfile
<<
DescPort: <<
PostgreSQL 7.2 has pretty good support for darwin out of the box.  The
only things that were patched were some assumptions that make it play
better in Fink.
<<
License: BSD
Maintainer: Benjamin Reed <ranger@befunk.com>
Homepage: http://www.postgresql.org/
