--- pymol-1.5.0.1/setup.py.orig	2012-02-15 18:41:04.000000000 -0500
+++ pymol-1.5.0.1/setup.py	2012-02-15 18:53:01.000000000 -0500
@@ -43,7 +43,7 @@
     ext_link_args=[]
 #============================================================================
 elif sys.platform=='darwin':
-    using_fink = "'/sw/" in str(sys.path)
+    using_fink = "'@FINKPREFIX@/" in str(sys.path)
     if using_fink:
         # NOTE: this code not tested in years and may not work...
         #
@@ -57,42 +57,70 @@
         #
         # REMEMBER to use Fink's Python!
         #
+        try:
+            os.makedirs("generated/include")
+        except OSError:
+            # ignore error if directory already exists
+            pass
+
+        try:
+            os.makedirs("generated/src")
+        except OSError:
+            # ignore error if directory already exists
+            pass
+
+        import create_shadertext
+
+        outputheader = open("generated/include/ShaderText.h",'w')
+        outputfile = open("generated/src/ShaderText.c",'w')
+
+        create_shadertext.create_shadertext("data/shaders",
+                                            "shadertext.txt",
+                                            outputheader,
+                                            outputfile)
+
+        outputheader.close()
+        outputfile.close()
+
         inc_dirs=["ov/src",
                   "layer0","layer1","layer2",
                   "layer3","layer4","layer5", 
-                  "/System/Library/Frameworks/OpenGL.framework/Headers",
-                  "/System/Library/Frameworks/GLUT.framework/Headers",
-                  "/System/Library/Frameworks/CoreFoundation.framework/Headers",
-                  "/System/Library/Frameworks/AppKit.framework/Headers",
-                  "/System/Library/Frameworks/ApplicationServices.framework/Headers",
-                  "/System/Library/Frameworks/Cocoa.framework/Headers",
-                  "/System/Library/Frameworks/IOKit.framework/Headers",
-                  "/sw/lib/freetype2/include",
-                  "/sw/lib/freetype2/include/freetype2",
-                  "/sw/include",
+                  "@FINKPREFIX@/include/freetype2/freetype",
+                  "@FINKPREFIX@/include/freetype2",
+                  "@FINKPREFIX@/include",
+                  "/usr/X11/include",
 		  "modules/cealign/src",
 		  "modules/cealign/src/tnt",
 		  #"contrib/uiuc/plugins/include/",
 		  #"contrib/uiuc/plugins/molfile_plugin/src",
+                  "generated/include",
+                  "generated/src",
                   ]
         libs=[]
         pyogl_libs = []
         lib_dirs=[]
         def_macros=[("_PYMOL_MODULE",None),
-                    ("_PYMOL_OSX",None),
                     ("_PYMOL_LIBPNG",None),
                     ("_PYMOL_FREETYPE",None),
+                    ("_PYMOL_INLINE",None),
+                    ("_PYMOL_NUMPY",None),
+                    ("_PYMOL_OPENGL_SHADERS",None),
+                    ("NO_MMLIBS",None),
+                    ("_PYMOL_CGO_DRAWARRAYS",None),
+                    ("_PYMOL_CGO_DRAWBUFFERS",None),
+                    ("_CGO_DRAWARRAYS",None),
+                    ("_PYMOL_GL_CALLLISTS",None),
+                    ("OPENGL_ES_2",None),
                     ]
         ext_comp_args=[]
-        ext_link_args=["-framework","OpenGL",
-                       "-framework","AppKit",
-                       "-framework","ApplicationServices",
-                       "-framework","CoreFoundation",
-                       "-framework","Cocoa",
-                       "-framework","IOKit",
-                       "-framework","GLUT",
-                       "-lpng",
-                       "-L/sw/lib/freetype2/lib", "-lfreetype" ]
+        ext_link_args=[
+                       "-L@FINKPREFIX@/lib", "-lpng",
+                       "/usr/X11/lib/libGL.dylib",
+                       "/usr/X11/lib/libGLU.dylib",
+                       "-lfreeglut",
+                       "-lglew",
+                       "-L@FINKPREFIX@/lib/freetype219/lib", "-lfreetype"
+                        ]
     else:
         # Not using Fink -- building as if we are on Linux/X11 with
         # the external dependencies compiled into "./ext" in the
@@ -100,16 +128,43 @@
         #
         # REMEMEBER to use "./ext/bin/python ..."
         #
-        EXT = os.getcwd()+"/ext"
+        # create shader text
+        try:
+            os.makedirs("generated/include")
+        except OSError:
+            # ignore error if directory already exists
+            pass
+
+        try:
+            os.makedirs("generated/src")
+        except OSError:
+            # ignore error if directory already exists
+            pass
+
+        import create_shadertext
+
+        outputheader = open("generated/include/ShaderText.h",'w')
+        outputfile = open("generated/src/ShaderText.c",'w')
+
+        create_shadertext.create_shadertext("data/shaders",
+                                            "shadertext.txt",
+                                            outputheader,
+                                            outputfile)
+
+        outputheader.close()
+        outputfile.close()
+
+        EXT = "@PREFIX@"
         inc_dirs=["ov/src",
                   "layer0","layer1","layer2",
                   "layer3","layer4","layer5", 
-                  "/usr/X11R6/include",
                   EXT+"/include",
                   EXT+"/include/GL",
                   EXT+"/include/freetype2",
 		  "modules/cealign/src",
 		  "modules/cealign/src/tnt",
+                  "generated/include",
+                  "generated/src",
                   ]
         libs=[]
         pyogl_libs = []
@@ -117,11 +172,19 @@
         def_macros=[("_PYMOL_MODULE",None),
                     ("_PYMOL_LIBPNG",None),
                     ("_PYMOL_FREETYPE",None),
+                    ("_PYMOL_INLINE",None),
+                    ("_PYMOL_NUMPY",None),
+                    ("_PYMOL_OPENGL_SHADERS",None),
+                    ("NO_MMLIBS",None),
+                    ("_PYMOL_CGO_DRAWARRAYS",None),
+                    ("_PYMOL_CGO_DRAWBUFFERS",None),
+                    ("_CGO_DRAWARRAYS",None),
+                    ("_PYMOL_GL_CALLLISTS",None),
+                    ("OPENGL_ES_2",None),
                     ]
-        ext_comp_args=[]
+        ext_comp_args=["-ffast-math","-funroll-loops","-O3","-fcommon"]
         ext_link_args=[
-            "-L/usr/X11R6/lib64", "-lGL", "-lXxf86vm",
-            "-L"+EXT+"/lib", "-lpng", "-lglut", "-lfreetype"
+                    "-L"+EXT+"/lib", "-lpng", "-lGL", "-lglut", "-lGLEW", "-lfreetype"
             ]
 #============================================================================
 else: # linux or other unix
@@ -230,6 +293,7 @@
                  'pymol/opengl/glu',
                  'pymol/opengl/glut',
                  'pymol/wizard',
+                 'pymol2',
                  'web',
                  'web/examples',
                  'web/javascript', ],
@@ -449,42 +513,56 @@
                   libraries = pyogl_libs,
                   library_dirs = lib_dirs,
                   define_macros = def_macros,
+                  extra_link_args = ext_link_args,
+                  extra_compile_args = ext_comp_args,
                   ),
         Extension("pymol.opengl.glu._glu", ["contrib/pyopengl/_glumodule.c"],
                   include_dirs = inc_dirs,
                   libraries = pyogl_libs,
                   library_dirs = lib_dirs,
-                  define_macros = def_macros
+                  define_macros = def_macros,
+                  extra_link_args = ext_link_args,
+                  extra_compile_args = ext_comp_args,
                   ),
         Extension("pymol.opengl.glut._glut", ["contrib/pyopengl/_glutmodule.c"],
                   include_dirs = inc_dirs,
                   libraries = pyogl_libs,
                   library_dirs = lib_dirs,
-                  define_macros = def_macros
+                  define_macros = def_macros,
+                  extra_link_args = ext_link_args,
+                  extra_compile_args = ext_comp_args,
                   ),
         Extension("pymol.opengl.gl._opengl_num", ["contrib/pyopengl/_opengl_nummodule.c"],
                   include_dirs = inc_dirs,
                   libraries = pyogl_libs,
                   library_dirs = lib_dirs,
-                  define_macros = def_macros
+                  define_macros = def_macros,
+                  extra_link_args = ext_link_args,
+                  extra_compile_args = ext_comp_args,
                   ),
         Extension("pymol.opengl.gl._opengl", ["contrib/pyopengl/_openglmodule.c"],
                   include_dirs = inc_dirs,
                   libraries = pyogl_libs,
                   library_dirs = lib_dirs,
-                  define_macros = def_macros
+                  define_macros = def_macros,
+                  extra_link_args = ext_link_args,
+                  extra_compile_args = ext_comp_args,
                   ),
         Extension("pymol.opengl.gl.openglutil", ["contrib/pyopengl/openglutil.c"],
                   include_dirs = inc_dirs,
                   libraries = pyogl_libs,
                   library_dirs = lib_dirs,
-                  define_macros = def_macros
+                  define_macros = def_macros,
+                  extra_link_args = ext_link_args,
+                  extra_compile_args = ext_comp_args,
                   ),
         Extension("pymol.opengl.gl.openglutil_num", ["contrib/pyopengl/openglutil_num.c"],
                   include_dirs = inc_dirs,
                   libraries = pyogl_libs,
                   library_dirs = lib_dirs,
-                  define_macros = def_macros
+                  define_macros = def_macros,
+                  extra_link_args = ext_link_args,
+                  extra_compile_args = ext_comp_args,
                   )
         ])
 
--- /dev/null	2012-02-14 20:24:44.000000000 -0500
+++ pymol-1.5.0.1/pymol.cmd	2012-02-14 19:31:08.000000000 -0500
@@ -0,0 +1,18 @@
+#!/bin/sh
+#
+# PyMOL startup script
+#
+# ==============================================================
+# Set PYMOL_PATH to point at the correct location on your system
+#
+PYMOL_PATH=@FINKPREFIX@/lib/python2.X/site-packages/pymol
+export PYMOL_PATH
+#
+# ==============================================================
+# (no changes usually required below here)
+#
+# python modules
+#
+APBS_PSIZE=@FINKPREFIX@/share/apbs/tools/manip/psize.py
+export APBS_PSIZE
+exec @FINKPREFIX@/bin/python2.X  @FINKPREFIX@/lib/python2.X/site-packages/pymol/__init__.py -d "_ set stereo_double_pump_mono,quiet=1" "$@"
