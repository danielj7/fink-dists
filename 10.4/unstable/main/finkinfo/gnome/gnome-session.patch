diff -Nurd -x'*~' gnome-session-2.26.1.orig/capplet/Makefile.in gnome-session-2.26.1/capplet/Makefile.in
--- gnome-session-2.26.1.orig/capplet/Makefile.in	2009-04-14 11:35:43.000000000 -0400
+++ gnome-session-2.26.1/capplet/Makefile.in	2009-06-13 13:31:59.000000000 -0400
@@ -273,12 +273,12 @@
 top_srcdir = @top_srcdir@
 NULL = 
 INCLUDES = \
+	-I$(top_srcdir)/egg				\
+	-I$(top_srcdir)/gnome-session			\
 	$(WARN_CFLAGS)					\
 	$(DISABLE_DEPRECATED_CFLAGS)			\
 	$(SESSION_PROPERTIES_CFLAGS)			\
 	$(GCONF_CFLAGS)					\
-	-I$(top_srcdir)/egg				\
-	-I$(top_srcdir)/gnome-session			\
 	-DLOCALE_DIR=\""$(datadir)/locale"\"		\
 	-DGLADEDIR=\""$(pkgdatadir)"\"		\
 	$(NULL)
diff -Nurd -x'*~' gnome-session-2.26.1.orig/compat/Makefile.in gnome-session-2.26.1/compat/Makefile.in
--- gnome-session-2.26.1.orig/compat/Makefile.in	2009-04-14 11:35:43.000000000 -0400
+++ gnome-session-2.26.1/compat/Makefile.in	2009-06-13 13:31:49.000000000 -0400
@@ -291,11 +291,11 @@
 top_builddir = @top_builddir@
 top_srcdir = @top_srcdir@
 INCLUDES = \
+	-I$(top_srcdir)/egg			\
 	$(WARN_CFLAGS)				\
 	$(DISABLE_DEPRECATED_CFLAGS)		\
 	$(COMPAT_CFLAGS)			\
 	$(GCONF_CFLAGS)				\
-	-I$(top_srcdir)/egg			\
 	-DAT_SPI_REGISTRYD_DIR=\""$(AT_SPI_REGISTRYD_DIR)"\" \
 	-DDEFAULT_SESSION_DIR=\""$(default_sessiondir)"\" \
 	-DSYSCONFDIR=\""$(sysconfdir)"\"
diff -Nurd -x'*~' gnome-session-2.26.1.orig/egg/Makefile.in gnome-session-2.26.1/egg/Makefile.in
--- gnome-session-2.26.1.orig/egg/Makefile.in	2009-04-14 11:35:44.000000000 -0400
+++ gnome-session-2.26.1/egg/Makefile.in	2009-06-13 14:16:22.000000000 -0400
@@ -292,8 +292,8 @@
 	-DG_LOG_DOMAIN=\""EggSMClient"\" \
 	$(platform_defines)              \
 	$(EGG_SMCLIENT_CFLAGS)           \
-	$(SM_LIBS)			 \
-	$(ICE_LIBS)			 \
+	$(SM_CFLAGS)			 \
+	$(ICE_CFLAGS)			 \
 	$(WARN_CFLAGS)			 \
 	$(DISABLE_DEPRECATED_CFLAGS)
 
diff -Nurd -x'*~' gnome-session-2.26.1.orig/gnome-session/Makefile.in gnome-session-2.26.1/gnome-session/Makefile.in
--- gnome-session-2.26.1.orig/gnome-session/Makefile.in	2009-04-14 11:35:44.000000000 -0400
+++ gnome-session-2.26.1/gnome-session/Makefile.in	2009-06-13 21:28:36.000000000 -0400
@@ -302,6 +302,7 @@
 NULL = 
 noinst_LTLIBRARIES = libgsmutil.la
 INCLUDES = \
+	-I$(top_srcdir)/egg			\
 	$(WARN_CFLAGS)				\
 	$(DISABLE_DEPRECATED_CFLAGS)		\
 	$(SM_CFLAGS)				\
@@ -309,11 +310,11 @@
 	$(GNOME_SESSION_CFLAGS)			\
 	$(GCONF_CFLAGS)				\
 	$(POLKIT_GNOME_CFLAGS)			\
-	-I$(top_srcdir)/egg			\
 	-DLOCALE_DIR=\""$(datadir)/locale"\"	\
 	-DDATA_DIR=\""$(datadir)/gnome-session"\" \
 	-DDBUS_LAUNCH=\"dbus-launch\"		\
 	-DLIBEXECDIR=\"$(libexecdir)\"		\
+	-DPREFIX=\"$(prefix)\"	\
 	-DGLADEDIR=\""$(pkgdatadir)"\"		\
 	-DGCONF_SANITY_CHECK=\""$(GCONF_SANITY_CHECK)"\" \
 	-DGCONFTOOL_CMD=\"$(GCONFTOOL)\"
@@ -393,7 +394,7 @@
 	$(NULL)
 
 libgsmutil_la_LIBADD = \
-	$(GNOME_SESSION_LIBS)
+	$(GNOME_SESSION_LIBS) -lXext
 
 libgsmutil_la_SOURCES = \
 	gsm-util.c				\
diff -Nurd -x'*~' gnome-session-2.26.1.orig/gnome-session/gdm-signal-handler.c gnome-session-2.26.1/gnome-session/gdm-signal-handler.c
--- gnome-session-2.26.1.orig/gnome-session/gdm-signal-handler.c	2009-04-14 11:31:45.000000000 -0400
+++ gnome-session-2.26.1/gnome-session/gdm-signal-handler.c	2009-06-13 23:57:38.000000000 -0400
@@ -27,7 +27,6 @@
 #include <unistd.h>
 #include <string.h>
 #include <signal.h>
-#include <execinfo.h>
 #include <syslog.h>
 #include <sys/wait.h>
 #include <sys/stat.h>
@@ -160,22 +159,7 @@
 static void
 fallback_get_backtrace (void)
 {
-        void *  frames[64];
-        size_t  size;
-        char ** strings;
-        size_t  i;
-
-        size = backtrace (frames, G_N_ELEMENTS (frames));
-        if ((strings = backtrace_symbols (frames, size))) {
-                syslog (LOG_CRIT, "******************* START ********************************");
-                for (i = 0; i < size; i++) {
-                        syslog (LOG_CRIT, "Frame %zd: %s", i, strings[i]);
-                }
-                free (strings);
-                syslog (LOG_CRIT, "******************* END **********************************");
-        } else {
                 g_warning ("GDM crashed, but symbols couldn't be retrieved.");
-        }
 }
 
 
@@ -197,8 +181,8 @@
                 }
         } else if (pid == 0) {
                 /* Child process */
-                execl (LIBEXECDIR "/gdm-crash-logger",
-                       LIBEXECDIR "/gdm-crash-logger", NULL);
+                execl (PREFIX "/lib/gdm/gdm-crash-logger",
+                       PREFIX "/lib/gdm/gdm-crash-logger", NULL);
         }
 
         return success;
@@ -215,7 +199,7 @@
          * we get much better information out of it.  Otherwise
          * fall back to execinfo.
          */
-        if (g_stat (LIBEXECDIR "/gdm-crash-logger", &s) == 0) {
+        if (g_stat (PREFIX "/lib/gdm/gdm-crash-logger", &s) == 0) {
                 fallback = crashlogger_get_backtrace () ? FALSE : TRUE;
         }
 
diff -Nurd -x'*~' gnome-session-2.26.1.orig/gnome-session/gdm.c gnome-session-2.26.1/gnome-session/gdm.c
--- gnome-session-2.26.1.orig/gnome-session/gdm.c	2009-04-14 11:31:45.000000000 -0400
+++ gnome-session-2.26.1/gnome-session/gdm.c	2009-06-14 00:55:12.000000000 -0400
@@ -254,10 +254,12 @@
 
         g_assert (data->fd <= 0);
 
-        if (g_file_test (GDM_PROTOCOL_SOCKET_PATH, G_FILE_TEST_EXISTS)) {
-                strcpy (addr.sun_path, GDM_PROTOCOL_SOCKET_PATH);
+        if (g_file_test (PREFIX GDM_PROTOCOL_SOCKET_PATH, G_FILE_TEST_EXISTS)) {
+                strcpy (addr.sun_path, PREFIX GDM_PROTOCOL_SOCKET_PATH);
         } else if (g_file_test ("/tmp/.gdm_socket", G_FILE_TEST_EXISTS)) {
                 strcpy (addr.sun_path, "/tmp/.gdm_socket");
+        } else if (g_file_test (GDM_PROTOCOL_SOCKET_PATH, G_FILE_TEST_EXISTS)) {
+                strcpy (addr.sun_path, GDM_PROTOCOL_SOCKET_PATH);
         } else {
                 return FALSE;
         }
diff -Nurd -x'*~' gnome-session-2.26.1.orig/gnome-session/gs-idle-monitor.c gnome-session-2.26.1/gnome-session/gs-idle-monitor.c
--- gnome-session-2.26.1.orig/gnome-session/gs-idle-monitor.c	2009-04-14 11:31:45.000000000 -0400
+++ gnome-session-2.26.1/gnome-session/gs-idle-monitor.c	2009-06-13 14:39:20.000000000 -0400
@@ -27,6 +27,7 @@
 
 #include <X11/Xlib.h>
 #include <X11/extensions/sync.h>
+#include <X11/keysym.h>
 
 #ifdef HAVE_XTEST
 #include <X11/extensions/XTest.h>
diff -Nurd -x'*~' gnome-session-2.26.1.orig/gnome-session/main.c gnome-session-2.26.1/gnome-session/main.c
--- gnome-session-2.26.1.orig/gnome-session/main.c	2009-04-14 11:31:45.000000000 -0400
+++ gnome-session-2.26.1/gnome-session/main.c	2009-06-13 13:37:18.000000000 -0400
@@ -385,6 +385,7 @@
                       char   **argv,
                       GError **error)
 {
+#ifndef __APPLE__
         char **new_argv;
         int    i;
 
@@ -415,6 +416,7 @@
                              g_strerror (errno));
                 return FALSE;
         }
+#endif
 
         /* Should not be reached */
         return TRUE;
