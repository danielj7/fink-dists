Package: gtk+2
Version: 2.12.11
Revision: 2
Description: The Gimp Toolkit
License: LGPL
Maintainer: The Gnome Core Team <fink-gnome-core@lists.sourceforge.net>

Depends: <<
	%N-shlibs (= %v-%r),
	pango1-xft2-ft219 (>= 1.18.4-4),
	x11
<<
BuildDepends: <<
	atk1 (>= 1.20.0-1),
	cairo (>= 1.6-1),
	expat1,
	fink (>= 0.24.12-1),
	fontconfig2-dev (>= 2.4.1-1),
	freetype219 (>= 2.3.5-1),
	gettext-bin,
	gettext-tools,
	glib2-dev (>= 2.14.0-1),
	glitz,
	libgettext3-dev,
	libiconv-dev,
	libjpeg,
	libpng3 (>= 1.2.5-4),
	libtiff,
	pango1-xft2-ft219-dev (>= 1.18.4-4),
	pixman (>= 0.10.0-1),
	pkgconfig (>= 0.21-1),
	x11-dev,
	xft2-dev
<<
# doesn't work, but this is the solution to the FAQ about missing symbols
#BuildConflicts: gtk+2-dev (<< 2.12.10-1)
Conflicts: %N-common
Replaces: %N-common

Source: mirror:gnome:sources/gtk+/2.12/gtk+-%v.tar.bz2
Source-MD5: f7aab88e856a813386f797aade5867ad
Source2: mirror:debian:pool/main/g/gtk+2.0/gtk+2.0_2.12.11-3.diff.gz
Source2-MD5: 388ca6aec5b1a3109bdc8e288e73431d
PatchFile: %n.patch
PatchFile-MD5: d9cc9c62ea177a4ea45e673d59923ae3
PatchScript: <<
#!/bin/sh -ev

	sed -e 's|@PREFIX@|%p|g' <%{PatchFile} | patch -p1
	gzip -dc ../gtk*.diff.gz | patch -p1
	for file in \
		005_xpmico.patch \
		015_default-fallback-icon-theme.patch \
		030_gtkentry_password-char-circle.patch \
		033_treeview_resizing.patch \
		042_treeview_single-focus.patch \
		060_ignore-random-icons.patch \
		091_workaround_no_gtk_init_incorrect_display.patch \
	; do
		patch -p1 < debian/patches/$file
	done
<<

NoSetCPPFLAGS: true
SetCPPFLAGS: -DX_LOCALE -I%p/lib/pango-ft219/include/pango-1.0 -I%p/lib/pango-ft219/include -I%p/lib/freetype219/include/freetype2 -I%p/lib/freetype219/include -I%p/lib/fontconfig2/include -I%p/include -I%p/include/sys
NoSetLDFLAGS: true
SetLDFLAGS: -L%p/lib/pango-ft219/lib -L%p/lib/freetype219/lib -L%p/lib/fontconfig2/lib
SetLIBS: -L%p/lib
SetCFLAGS: -Os
SetCXXFLAGS: -Os
SetLIBRARY_PATH: %p/lib
ConfigureParams: --mandir=%p/share/man --enable-static --disable-shm --disable-gtk-doc --disable-dependency-tracking
CompileScript: <<
#!/bin/sh -ev

	export PKG_CONFIG_PATH="%p/lib/pango-ft219/lib/pkgconfig:%p/lib/fontconfig2/lib/pkgconfig:%p/lib/freetype219/lib/pkgconfig:%p/lib/pkgconfig:$PKG_CONFIG_PATH" FREETYPE_CONFIG=%p/lib/freetype219/bin/freetype-config
	LD_TWOLEVEL_NAMESPACE=1 ./configure %c
	make
<<

InstallScript: <<
	make install DESTDIR=%d
	install -d -m 755 %i/sbin %i/etc/gtk-2.0
	install -c -m 755 update-gdk-pixbuf-loaders %i/sbin/
	install -c -m 755 update-gtk-immodules %i/sbin/
<<
DocFiles: AUTHORS COPYING ChangeLog NEWS README
SplitOff: <<
	Package: %N-shlibs
	Depends: <<
		atk1-shlibs (>= 1.20.0-1),
		glib2-shlibs (>= 2.14.0-1),
		libjpeg-shlibs,
		libpng3-shlibs (>= 1.2.5-4),
		libtiff-shlibs,
		pango1-xft2-ft219-shlibs (>= 1.18.4-4),
		x11-shlibs
	<<
	Replaces: gtk2-engines (<< 2.6.3-1), gtk+2 (<< 2.10.3-1)
	Conflicts: jpilot (<< 0.99.9-12), jpilot-ssl, sylpheed-gpgme (<< 2.3.0-2), sylpheed (<< 2.3.0-2), sylpheed-ssl
	DocFiles: AUTHORS COPYING ChangeLog NEWS README
	RuntimeVars: GDK_USE_XFT: 1
	Files: <<
		lib/lib*-2.0.*.dylib
		lib/gtk-2.0/2.10.0/engines/*.so
		lib/gtk-2.0/2.10.0/engines/*.la
		lib/gtk-2.0/2.10.0/immodules/*.so
		lib/gtk-2.0/2.10.0/immodules/*.la
		lib/gtk-2.0/2.10.0/loaders/*.so
		lib/gtk-2.0/2.10.0/loaders/*.la
		lib/gtk-2.0/2.10.0/printbackends/*.so
		lib/gtk-2.0/2.10.0/printbackends/*.la
		share/locale
	<<
	Shlibs: <<
		%p/lib/libgdk-x11-2.0.0.dylib         1201.0.0 %n (>= 2.12.0-1)
		%p/lib/libgdk_pixbuf-2.0.0.dylib      1201.0.0 %n (>= 2.12.0-1)
		%p/lib/libgdk_pixbuf_xlib-2.0.0.dylib 1201.0.0 %n (>= 2.12.0-1)
		%p/lib/libgtk-x11-2.0.0.dylib         1201.0.0 %n (>= 2.12.0-1)
	<<
<<
SplitOff2: <<
	Package: %N-dev
	Depends: %N (= %v-%r), %N-shlibs (= %v-%r)
	Conflicts: gtk+ (<< 1.2.10-12)
	Replaces: %N (<< 2.6.7-3)
	BuildDependsOnly: True
	DocFiles: AUTHORS COPYING ChangeLog NEWS README
	Files: <<
		include
		lib
		share/aclocal
		share/gtk-doc
	<<
<<

PostInstScript: <<
 case "$1" in
	configure)
	 update-gdk-pixbuf-loaders
	 update-gtk-immodules
	 ;;
 esac
<<
PostRmScript: <<
 case "$1" in
	purge)
	 rm -f %p/etc/gtk-2.0/gdk-pixbuf.loaders
	 rm -f %p/etc/gtk-2.0/gtk.immodules
	 rmdir %p/etc/gtk-2.0 || true
	 ;;
 esac
<<

Homepage: http://www.gtk.org
DescDetail: <<
The X libraries originally written for the GIMP, which are now used by
several other programs as well.
<<
DescPackaging: <<
Packages which install gdk-pixbuf loader(s) should call update-gdk-
pixbuf-loaders in their PostInstScript and PostRmScript to update the
gdk-pixbuf.loaders file.

Packages which install gtk immodule(s) should call update-gtk-immodules
in their PostInstScript and PostRmScript to update the gtk.immodules file.

Older versions of gtk2-engines had a pixbuf theme, but now gtk+2 has
that itself (and gtk2-engines has dropped or renamed it).

Sometimes not all .pc files get created. I suspect this is due to a
missing BuildDepends or missing files due to Installer.app breakage,
but don't know what. So all .pc are listed explicitly in Files so that
if any are not built, the pkg will not build. Better to crash and
force a diagnosis than to build a wrong package silently, which could
lead to pkgs that use these .pc to build incorrectly (possibly
silently also).
<<
DescPort: <<
LDFLAGS and LIBS are modified for detecting freetype2 and xft.
gtk+2-dev conflicts with gtk+ (<< 1.2.11), because it has symbolic
link which intercepts include files of the package.

Import some Debian patches (whichever ones look useful)

Import ltmain.sh dependent-lib dependency handlers from libtool2
(prevents linking against installed lib instead of build-dir one).
Thanks pogma!
<<
