Package: graphviz
Version: 2.22.2
Revision: 1
License: OSI-Approved
# License: Common Public License 1.0
Maintainer: David Fang <fangism@users.sourceforge.net>
Homepage: http://www.graphviz.org/
#Conflicts: graphviz
#Replaces: graphviz
Source: mirror:custom:%n-%v.tar.gz
CustomMirror: <<
nam-US: http://www.graphviz.org/pub/graphviz/ARCHIVE
nam-US: http://www.graphviz.org/pub/graphviz
<<
SourceDirectory: %n-%v
Source-MD5: 34510a76ee176c6e0e64b773174e0fdc
PatchFile: %n.patch
PatchFile-MD5: 8a315909c5e5ed42855340ae8ad25f4b
# PatchScript: <<
#	patch -p0 < %{PatchFile}
# <<
GCC: 4.0
Depends: <<
	%N-shlibs (= %v-%r)
<<
BuildDepends: <<
	pkgconfig (>= 0.20-1),
	x11-dev, 
	atk1 (>= 1.20.0-1),
	avahi-dev,
	dbus-dev (>= 1.0.2-1),
	fink (>= 0.28),
	fontconfig2-dev (>= 2.4.1-1),
	freetype219 (>= 2.3.5-1),
	giflib,
	gmp, 
	glib2-dev (>= 2.14.0-1), 
	glitz,
	gtkglext1 (>= 1.0.6-1007),
	guile18,
	guile18-dev, 
	libpng3 (>= 1.2.10-1), 
	libjpeg, 
	librsvg2 (>= 2.20.0-1),
	libiconv-dev, 
	libgettext3-dev (>= 0.14.5-1),
	gettext-tools,
	libavahi-glib1-dev,
	libgnome2-dev (>= 2.20.0-1),
	libgnomecanvas2-dev (>= 2.20.0-1),
	libgnomeui2-dev (>= 2.20.0-1),
	popt,
	libtool14,
	lua51-dev,
	lua51,
	expat1 (>= 2.0.0-1), 
	gd2 (>= 2.0.35-4), 
	gd2-bin (>= 2.0.35-4), 
	gawk (>= 3.1.2-12), 
	cairo (>= 1.6.4-2),
	pixman (>= 0.10.0-1),
	ocaml,
	swig (>= 1.3.29-1),
	gtk+2-dev (>= 2.12.0-1),
	gnome-keyring-dev (>= 0.8.1-1),
	gnome-vfs2-unified-dev (>= 1:2.20.0-1),
	libbonobo2-dev (>= 2.20.0-1),
	libbonoboui2-dev (>= 2.20.0-1),
	gconf2-dev (>= 2.20.0-1),
	orbit2-dev (>= 2.14.10-1),
	libgsf1.114-dev (>= 1.14.8-2),
	libcroco3,
	libart2 (>= 2.3.16-1),
	libxml2 (>= 2.6.30-1),
	pango1-xft2-ft219-dev (>= 1.18.4-4),
	libglade2 (>= 2.6.2-2),
	libming1-dev
<<
# TODO: --with-quartz
ConfigureParams: --mandir=%p/share/man --with-extraincludedir=%p/include --with-extralibdir=%p/lib --with-tcl=/usr/bin/tclsh --with-tclsh=/usr/bin/tclsh --with-wish=/usr/bin/wish --with-x --x-includes=/usr/X11R6/include --x-libraries=/usr/X11R6/lib --with-ming -with-glitz --disable-r --disable-perl --disable-python FREETYPE2_CFLAGS=-I%p/lib/freetype219/include/freetype2 FREETYPE2_LIBS=-L%p/lib/freetype219/lib GUILE=%p/bin/guile-1.8 PKG_CONFIG_PATH="%p/lib/pango-ft219/lib/pkgconfig:%p/lib/fontconfig2/lib/pkgconfig:%p/lib/freetype219/lib/pkgconfig:$PKG_CONFIG_PATH" RUBY=/usr/bin/ruby CPPFLAGS="-I/System/Library/Frameworks/JavaVM.framework/Versions/A/Headers -I%p/lib/ocaml -idirafter $system_ruby_include"
# --with-freetypeincludedir=/usr/X11R6/include/freetype2 LDFLAGS=-L%p/lib/ocaml OCAML_LIBS=-L%p/lib/ocaml
CompileScript: <<
	#!/bin/sh -ev
	mv configure configure.orig
	sed '/OCAML/s|/usr|%p|g' configure.orig > configure
	chmod +x configure
	ruby_h_path=`find /usr/lib/ruby -name ruby.h`
	test -f "$ruby_h_path" || ruby_h_path=`find /System/Library/Frameworks -name ruby.h | head -n 1`
	test -f "$ruby_h_path" && echo "Found ruby.h as $ruby_h_path, using its dirname..."
	system_ruby_include=`dirname $ruby_h_path`
	test -d "$system_ruby_include"
	./configure %c
	make
<<
# InfoTest: <<
#	TestScript: <<
#	#!/bin/sh -ev
#	# make check || exit 2
# 	# rtest.sh looks intended for post-install checking
#	cd rtest
#	./rtest.sh -v || exit 2
#	<<
##	TestDepends:
#	TestSuiteSize: small
#<<
InstallScript: <<
	#!/bin/sh -ev
	make DESTDIR=%d install
	# remove links in /usr
	rm -rf %d/usr
	rm -rf %d/Library
	#rm -rf %d/Network
	#mkdir -p %i/lib/perl5/darwin-thread-multi-2level/%n
	#ln -s %p/lib/%n/perl/gv.pm %i/lib/perl5/darwin-thread-multi-2level/%n
	mkdir -p %i/share/doc/%n 
	mv %i/share/%n/doc/* %i/share/doc/%n 
	mv %i/share/%n/{demo,examples,graphs} %i/share/doc/%n
	rm -rf %i/share/%n/doc
	# mkdir -p %i/lib/ruby/1.8/%n
	# didn't find any .rb files?
	# not bothering with %p/lib/php
<<
# rtest/rtest.sh is intended as a installcheck-time script
SplitOff: <<
	Package: %N-shlibs
	Depends: <<
		glib2-shlibs (>= 2.14.0-1), 
		gtkglext1-shlibs,
		guile18-shlibs, 
		x11, 
		fontconfig2-shlibs (>= 2.4.1-1),
		freetype219-shlibs (>= 2.3.5-1),
		giflib-shlibs,
		glitz-shlibs,
		libcroco3-shlibs,
		libpng3-shlibs, 
		libjpeg-shlibs, 
		libiconv, 
		librsvg2-shlibs (>= 2.20.0-1),
		libgettext3-shlibs,
		libgsf1.114-shlibs (>= 1.14.8-2),
		libtool14-shlibs, 
		libgnomeui2-shlibs (>= 2.20.0-1),
		lua51-shlibs,
		expat1-shlibs, 
		gd2-shlibs (>= 2.0.35-4), 
		cairo-shlibs (>= 1.6.4-2),
		libming1-shlibs
	<<
	Files: <<
		lib/graphviz/*.*.dylib
		lib/graphviz/guile/*.so
		lib/graphviz/lua/*.so
		lib/graphviz/php/*.so
		lib/graphviz/ruby/*.so
		lib/graphviz/tcl/*.so
		lib/graphviz/tcl/*.*.dylib
		lib/graphviz/tcl/pkgIndex.tcl
		lib/*.*.dylib
	<<
	Shlibs: <<
		%p/lib/graphviz/libgvplugin_core.6.dylib 7.0.0 %n (>= 2.14-1)
		%p/lib/graphviz/libgvplugin_dot_layout.6.dylib 7.0.0 %n (>= 2.14-1)
		%p/lib/graphviz/libgvplugin_gd.6.dylib 7.0.0 %n (>= 2.14-1)
		%p/lib/graphviz/libgvplugin_gdk_pixbuf.6.dylib 7.0.0 %n (>= 2.18-2)
		%p/lib/graphviz/libgvplugin_gtk.6.dylib 7.0.0 %n (>= 2.18-2)
		%p/lib/graphviz/libgvplugin_glitz.6.dylib 7.0.0 %n (>= 2.22.2-1)
		%p/lib/graphviz/libgvplugin_ming.6.dylib 7.0.0 %n (>= 2.18-2)
		%p/lib/graphviz/libgvplugin_neato_layout.6.dylib 7.0.0 %n (>= 2.14-1)
		%p/lib/graphviz/libgvplugin_pango.6.dylib 7.0.0 %n (>= 2.18-2)
		%p/lib/graphviz/libgvplugin_rsvg.6.dylib 7.0.0 %n (>= 2.18-1)
		%p/lib/graphviz/libgvplugin_xlib.6.dylib 7.0.0 %n (>= 2.18-2)
		%p/lib/graphviz/tcl/libgdtclft.0.dylib 1.0.0 %n (>= 2.14-1)
		%p/lib/graphviz/tcl/libtcldot.0.dylib 1.0.0 %n (>= 2.14-1)
		%p/lib/graphviz/tcl/libtcldot_builtin.0.dylib 1.0.0 %n (>= 2.14-1)
		%p/lib/graphviz/tcl/libtclplan.0.dylib 1.0.0 %n (>= 2.14-1)
		%p/lib/graphviz/tcl/libtkspline.0.dylib 1.0.0 %n (>= 2.14-1)
		%p/lib/libcgraph.4.dylib 5.0.0 %n (>= 2.18-1)
		%p/lib/libcdt.4.dylib 5.0.0 %n (>= 2.14-1)
		%p/lib/libgraph.4.dylib 5.0.0 %n (>= 2.14-1)
		%p/lib/libgvc.5.dylib 6.0.0 %n (>= 2.14-1)
		%p/lib/libpathplan.4.dylib 5.0.0 %n (>= 2.14-1)
	<<
	DescPackaging: <<
		There are some other lib/graphviz directories that are empty
		at package-time: R/ io/ java/ ocaml/ python{23,24,25}/ sharp/.
		Don't know what these are about...
	<<
	DocFiles: AUTHORS COPYING ChangeLog INSTALL NEWS README
<<
SplitOff2: <<
	Package: %N-dev
	BuildDependsOnly: true
	Depends: %N-shlibs (= %v-%r)
	Replaces: %N (<< 2.18-2)
	Description: development files for graphviz
	Files: <<
		include
		lib/graphviz/*.la
		lib/graphviz/guile/*.la
		lib/graphviz/lua/*.la
		lib/graphviz/php/*.la
		lib/graphviz/ruby/*.la
		lib/graphviz/tcl/*.la
		lib/pkgconfig
		lib/*.dylib
		lib/*.la
	<<
	DocFiles: AUTHORS COPYING ChangeLog INSTALL NEWS README
<<
PostInstScript: %p/bin/dot -c
DocFiles: AUTHORS COPYING ChangeLog INSTALL NEWS README
# there are more doc files
Description: Graph visualization software
DescDetail: <<
graphviz is a set of graph drawing tools for Unix or MS-Windows 
(win32), including a web service interface (webdot). Graph drawing 
addresses the problem of visualizing structural information by 
constructing geometric representations of abstract graphs and 
networks. Automatic generation of graph drawings has important 
applications in key technologies such as database design, software 
engineering, VLSI and network design and visual interfaces in other 
domains.
.
License: Common Public License 1.0
.
Many thanks to Jeroen Scheerder <Jeroen.Scheerder@phil.uu.nl> for
pointing me in the right directions.
.
Former maintainer(s):
Thomas Kotzian <thomas.kotzian@gmx.at>
Matthias Neeracher <neeracher@mac.com>
<<
DescPackaging: <<
Use libiconv from fink
postinstall 'dot -c' updates config file with list of built plugins.
Links with libtool14's libltdl.dylib, therefore need build-depend on libtool14 
even though libltdl/ already includes ltdl.h
Blindly added deps for guile, lua, ocaml, libgnomeui2,
gettext-tools because they are checked in configure,
though some may result in optional plug-ins.
Not sure what to do about perl/python yet...
	--dmacks disabled because they would need to be lang-versioned
Other deps not listed: zlib-1.2.3 (system's)
Optional: lua (>= 5.0)
also checked in configure: pangocairo, gtkgl+
Thanks to Peter Dyballa for adding ocaml support 
and using the system's Tcl and Ruby.
Ruby headers are found in /usr/lib/ruby or /System/Library/Frameworks.
Prevent plug-in (.so) links from being installed in system paths outside of %p.
Tried to get --with-quartz to work.
<<
