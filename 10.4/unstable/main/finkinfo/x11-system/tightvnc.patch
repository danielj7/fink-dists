diff -Nurd -x'*~' vnc_unixsrc-1.3.8.orig/Xvnc/config/cf/vnclibs.def vnc_unixsrc-1.3.8/Xvnc/config/cf/vnclibs.def
--- vnc_unixsrc-1.3.8.orig/Xvnc/config/cf/vnclibs.def	2003-05-03 05:31:54.000000000 -0400
+++ vnc_unixsrc-1.3.8/Xvnc/config/cf/vnclibs.def	2008-08-26 12:35:50.000000000 -0400
@@ -11,7 +11,7 @@
 /* Avoid linking with different libjpeg in /usr/shlib under Tru64. */
 VNCSYSLIBS = /usr/local/lib/libjpeg.a /usr/local/lib/libz.a -lcrypt
 #else
-VNCSYSLIBS = -L/usr/local/lib -ljpeg -lz -lcrypt
+VNCSYSLIBS = $(LDFLAGS) -ljpeg -lz# -lcrypt
 #endif
 
-VNCCPPFLAGS = -I$(TOP)/../include -I/usr/local/include
+VNCCPPFLAGS = -I$(TOP)/../include $(CPPFLAGS)
diff -Nurd -x'*~' vnc_unixsrc-1.3.8.orig/Xvnc/config/util/lndir.c vnc_unixsrc-1.3.8/Xvnc/config/util/lndir.c
--- vnc_unixsrc-1.3.8.orig/Xvnc/config/util/lndir.c	2000-06-11 08:00:51.000000000 -0400
+++ vnc_unixsrc-1.3.8/Xvnc/config/util/lndir.c	2008-08-26 12:38:43.000000000 -0400
@@ -47,6 +47,7 @@
 #include <X11/Xos.h>
 #include <X11/Xfuncproto.h>
 #include <stdio.h>
+#include <stdlib.h>
 #include <sys/stat.h>
 #if !defined(MINIX) && !defined(Lynx)
 #include <sys/param.h>
diff -Nurd -x'*~' vnc_unixsrc-1.3.8.orig/Xvnc/include/Xos.h vnc_unixsrc-1.3.8/Xvnc/include/Xos.h
--- vnc_unixsrc-1.3.8.orig/Xvnc/include/Xos.h	2000-06-11 08:00:52.000000000 -0400
+++ vnc_unixsrc-1.3.8/Xvnc/include/Xos.h	2008-08-26 12:38:43.000000000 -0400
@@ -150,10 +150,6 @@
 #endif
 #endif /* X_NOT_POSIX else */
 
-#ifdef CSRG_BASED
-#include <stdlib.h>
-#include <unistd.h>
-#endif /* CSRG_BASED */
 
 /*
  * Get struct timeval
diff -Nurd -x'*~' vnc_unixsrc-1.3.8.orig/Xvnc/lib/Xdmcp/Alloc.c vnc_unixsrc-1.3.8/Xvnc/lib/Xdmcp/Alloc.c
--- vnc_unixsrc-1.3.8.orig/Xvnc/lib/Xdmcp/Alloc.c	2000-06-11 08:00:52.000000000 -0400
+++ vnc_unixsrc-1.3.8/Xvnc/lib/Xdmcp/Alloc.c	2008-08-26 12:38:43.000000000 -0400
@@ -31,7 +31,7 @@
 
 /* stubs for use when Xalloc, Xrealloc and Xfree are not defined */
 
-extern char	*malloc (), *realloc ();
+#include <stdlib.h>
 
 unsigned long *
 Xalloc (amount)
diff -Nurd -x'*~' vnc_unixsrc-1.3.8.orig/Xvnc/lib/font/Type1/objects.c vnc_unixsrc-1.3.8/Xvnc/lib/font/Type1/objects.c
--- vnc_unixsrc-1.3.8.orig/Xvnc/lib/font/Type1/objects.c	2000-06-11 08:00:52.000000000 -0400
+++ vnc_unixsrc-1.3.8/Xvnc/lib/font/Type1/objects.c	2008-08-26 12:38:43.000000000 -0400
@@ -55,6 +55,7 @@
  
 #include  <string.h>
 #include  <ctype.h>
+#include <stdio.h>
  
 /*
 override incorrect system functions; for example you might define
diff -Nurd -x'*~' vnc_unixsrc-1.3.8.orig/Xvnc/lib/font/Type1/spaces.c vnc_unixsrc-1.3.8/Xvnc/lib/font/Type1/spaces.c
--- vnc_unixsrc-1.3.8.orig/Xvnc/lib/font/Type1/spaces.c	2000-06-11 08:00:52.000000000 -0400
+++ vnc_unixsrc-1.3.8/Xvnc/lib/font/Type1/spaces.c	2008-08-26 12:38:43.000000000 -0400
@@ -37,6 +37,8 @@
  
 :h3.Include Files
 */
+#include <stdio.h>
+#include <string.h>
 #include "objects.h"
 #include "spaces.h"
 #include "paths.h"
diff -Nurd -x'*~' vnc_unixsrc-1.3.8.orig/Xvnc/lib/font/Type1/t1malloc.c vnc_unixsrc-1.3.8/Xvnc/lib/font/Type1/t1malloc.c
--- vnc_unixsrc-1.3.8.orig/Xvnc/lib/font/Type1/t1malloc.c	2000-06-11 08:00:52.000000000 -0400
+++ vnc_unixsrc-1.3.8/Xvnc/lib/font/Type1/t1malloc.c	2008-08-26 12:38:43.000000000 -0400
@@ -37,6 +37,7 @@
  
 */
 
+#include <stdio.h>
 #include "objects.h"	/* get #define for abort() */
 
 static combine();
diff -Nurd -x'*~' vnc_unixsrc-1.3.8.orig/Xvnc/lib/font/Type1/t1stub.c vnc_unixsrc-1.3.8/Xvnc/lib/font/Type1/t1stub.c
--- vnc_unixsrc-1.3.8.orig/Xvnc/lib/font/Type1/t1stub.c	2000-06-11 08:00:52.000000000 -0400
+++ vnc_unixsrc-1.3.8/Xvnc/lib/font/Type1/t1stub.c	2008-08-26 12:38:43.000000000 -0400
@@ -28,6 +28,7 @@
  * SOFTWARE.
  */
 
+#include <stdio.h>
 #include "objects.h"	/* get #define for abort() */
  
 xiStub()
diff -Nurd -x'*~' vnc_unixsrc-1.3.8.orig/Xvnc/programs/Xserver/Xext/xprint.c vnc_unixsrc-1.3.8/Xvnc/programs/Xserver/Xext/xprint.c
--- vnc_unixsrc-1.3.8.orig/Xvnc/programs/Xserver/Xext/xprint.c	2002-04-30 09:07:31.000000000 -0400
+++ vnc_unixsrc-1.3.8/Xvnc/programs/Xserver/Xext/xprint.c	2008-08-26 12:38:43.000000000 -0400
@@ -66,6 +66,7 @@
 ********************************************************************/
 /* $XFree86: xc/programs/Xserver/Xext/xprint.c,v 1.4 1997/01/02 04:05:05 dawes Exp $ */
 
+#include <stdlib.h>
 #include "X.h"
 #define NEED_EVENTS
 #include "Xproto.h"
diff -Nurd -x'*~' vnc_unixsrc-1.3.8.orig/Xvnc/programs/Xserver/hw/vnc/corre.c vnc_unixsrc-1.3.8/Xvnc/programs/Xserver/hw/vnc/corre.c
--- vnc_unixsrc-1.3.8.orig/Xvnc/programs/Xserver/hw/vnc/corre.c	2001-01-16 17:26:22.000000000 -0500
+++ vnc_unixsrc-1.3.8/Xvnc/programs/Xserver/hw/vnc/corre.c	2008-08-26 12:38:43.000000000 -0400
@@ -24,6 +24,7 @@
  *  USA.
  */
 
+#include <stdlib.h>
 #include <stdio.h>
 #include "rfb.h"
 
diff -Nurd -x'*~' vnc_unixsrc-1.3.8.orig/Xvnc/programs/Xserver/hw/vnc/httpd.c vnc_unixsrc-1.3.8/Xvnc/programs/Xserver/hw/vnc/httpd.c
--- vnc_unixsrc-1.3.8.orig/Xvnc/programs/Xserver/hw/vnc/httpd.c	2003-04-08 18:18:33.000000000 -0400
+++ vnc_unixsrc-1.3.8/Xvnc/programs/Xserver/hw/vnc/httpd.c	2008-08-26 12:38:43.000000000 -0400
@@ -22,6 +22,7 @@
  *  USA.
  */
 
+#include <stdlib.h>
 #include <stdio.h>
 #include <sys/types.h>
 #include <sys/time.h>
diff -Nurd -x'*~' vnc_unixsrc-1.3.8.orig/Xvnc/programs/Xserver/hw/vnc/init.c vnc_unixsrc-1.3.8/Xvnc/programs/Xserver/hw/vnc/init.c
--- vnc_unixsrc-1.3.8.orig/Xvnc/programs/Xserver/hw/vnc/init.c	2006-08-15 03:05:07.000000000 -0400
+++ vnc_unixsrc-1.3.8/Xvnc/programs/Xserver/hw/vnc/init.c	2008-08-26 12:38:43.000000000 -0400
@@ -55,6 +55,7 @@
 
 #include <stdio.h>
 #include <unistd.h>
+#include <stdlib.h>
 #include <stdarg.h>
 #include <sys/types.h>
 #include <sys/socket.h>
diff -Nurd -x'*~' vnc_unixsrc-1.3.8.orig/Xvnc/programs/Xserver/hw/vnc/kbdptr.c vnc_unixsrc-1.3.8/Xvnc/programs/Xserver/hw/vnc/kbdptr.c
--- vnc_unixsrc-1.3.8.orig/Xvnc/programs/Xserver/hw/vnc/kbdptr.c	2001-01-16 15:20:28.000000000 -0500
+++ vnc_unixsrc-1.3.8/Xvnc/programs/Xserver/hw/vnc/kbdptr.c	2008-08-26 12:38:43.000000000 -0400
@@ -23,6 +23,7 @@
  *  USA.
  */
 
+#include <stdlib.h>
 #include <stdio.h>
 
 #include "X11/X.h"
diff -Nurd -x'*~' vnc_unixsrc-1.3.8.orig/Xvnc/programs/Xserver/hw/vnc/rre.c vnc_unixsrc-1.3.8/Xvnc/programs/Xserver/hw/vnc/rre.c
--- vnc_unixsrc-1.3.8.orig/Xvnc/programs/Xserver/hw/vnc/rre.c	2000-06-11 08:00:52.000000000 -0400
+++ vnc_unixsrc-1.3.8/Xvnc/programs/Xserver/hw/vnc/rre.c	2008-08-26 12:38:43.000000000 -0400
@@ -24,6 +24,7 @@
  *  USA.
  */
 
+#include <stdlib.h>
 #include <stdio.h>
 #include "rfb.h"
 
diff -Nurd -x'*~' vnc_unixsrc-1.3.8.orig/Xvnc/programs/Xserver/hw/vnc/sockets.c vnc_unixsrc-1.3.8/Xvnc/programs/Xserver/hw/vnc/sockets.c
--- vnc_unixsrc-1.3.8.orig/Xvnc/programs/Xserver/hw/vnc/sockets.c	2002-10-27 07:36:02.000000000 -0500
+++ vnc_unixsrc-1.3.8/Xvnc/programs/Xserver/hw/vnc/sockets.c	2008-08-26 12:38:43.000000000 -0400
@@ -37,6 +37,7 @@
  *  USA.
  */
 
+#include <stdlib.h>
 #include <stdio.h>
 #include <sys/types.h>
 #include <sys/time.h>
diff -Nurd -x'*~' vnc_unixsrc-1.3.8.orig/Xvnc/programs/Xserver/hw/vnc/tableinittctemplate.c vnc_unixsrc-1.3.8/Xvnc/programs/Xserver/hw/vnc/tableinittctemplate.c
--- vnc_unixsrc-1.3.8.orig/Xvnc/programs/Xserver/hw/vnc/tableinittctemplate.c	2000-06-11 08:00:52.000000000 -0400
+++ vnc_unixsrc-1.3.8/Xvnc/programs/Xserver/hw/vnc/tableinittctemplate.c	2008-08-26 12:38:43.000000000 -0400
@@ -36,6 +36,7 @@
 #error "This file shouldn't be compiled."
 #error "It is included as part of translate.c"
 #endif
+#include <stdlib.h>
 
 #define OUT_T CONCAT2E(CARD,OUT)
 #define SwapOUT(x) CONCAT2E(Swap,OUT(x))
diff -Nurd -x'*~' vnc_unixsrc-1.3.8.orig/Xvnc/programs/Xserver/hw/vnc/translate.c vnc_unixsrc-1.3.8/Xvnc/programs/Xserver/hw/vnc/translate.c
--- vnc_unixsrc-1.3.8.orig/Xvnc/programs/Xserver/hw/vnc/translate.c	2000-10-25 17:24:07.000000000 -0400
+++ vnc_unixsrc-1.3.8/Xvnc/programs/Xserver/hw/vnc/translate.c	2008-08-26 12:38:43.000000000 -0400
@@ -21,6 +21,7 @@
  *  USA.
  */
 
+#include <stdlib.h>
 #include <stdio.h>
 #include "rfb.h"
 
diff -Nurd -x'*~' vnc_unixsrc-1.3.8.orig/Xvnc/programs/Xserver/os/xdmcp.c vnc_unixsrc-1.3.8/Xvnc/programs/Xserver/os/xdmcp.c
--- vnc_unixsrc-1.3.8.orig/Xvnc/programs/Xserver/os/xdmcp.c	2000-06-11 08:00:52.000000000 -0400
+++ vnc_unixsrc-1.3.8/Xvnc/programs/Xserver/os/xdmcp.c	2008-08-26 12:38:43.000000000 -0400
@@ -15,6 +15,7 @@
  *
  */
 
+#include <stdlib.h>
 #ifdef WIN32
 /* avoid conflicting definitions */
 #define BOOL wBOOL
diff -Nurd -x'*~' vnc_unixsrc-1.3.8.orig/vncconnect/vncconnect.c vnc_unixsrc-1.3.8/vncconnect/vncconnect.c
--- vnc_unixsrc-1.3.8.orig/vncconnect/vncconnect.c	2000-11-10 05:20:07.000000000 -0500
+++ vnc_unixsrc-1.3.8/vncconnect/vncconnect.c	2008-08-26 12:38:43.000000000 -0400
@@ -2,6 +2,8 @@
  * vncconnect.c
  */
 
+#include <stdlib.h>
+#include <string.h>
 #include <stdio.h>
 #include <X11/Xlib.h>
 #include <X11/Xatom.h>
