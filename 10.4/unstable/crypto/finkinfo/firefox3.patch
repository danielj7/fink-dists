diff -ruN mozilla-1.9.1-orig/.mozconfig mozilla-1.9.1/.mozconfig
--- mozilla-1.9.1-orig/.mozconfig	1969-12-31 19:00:00.000000000 -0500
+++ mozilla-1.9.1/.mozconfig	2009-03-16 16:34:22.000000000 -0400
@@ -0,0 +1,39 @@
+# sh
+# Build configuration script
+#
+# See http://www.mozilla.org/build/unix.html for build instructions.
+#
+
+. $topsrcdir/browser/config/mozconfig
+
+# Options for client.mk.
+# environment variables to set
+
+# Options for 'configure' (same as command-line options).
+ac_add_options --prefix=@FINKPREFIX@
+ac_add_options --enable-official-branding
+ac_add_options --enable-default-toolkit=cairo-gtk2
+ac_add_options --x-libraries=/usr/X11R6/lib
+ac_add_options --x-includes=/usr/X11R6/include
+#ac_add_options --enable-xft
+#ac_add_options --disable-xft
+#ac_add_options --enable-freetype2
+#ac_add_options --disable-freetype2
+#ac_add_options --enable-xinerama
+#ac_add_options --with-pthreads
+ac_add_options --disable-gnomevfs
+ac_add_options --disable-gnomeui
+ac_add_options --enable-dbus
+ac_add_options --enable-extensions=default,-gnomevfs
+
+ac_add_options --disable-dependency-tracking
+ac_add_options --disable-crashreporter
+
+ac_add_options --disable-debug
+ac_add_options --disable-tests
+ac_add_options --enable-strip
+ac_add_options --enable-optimize='-Os'
+ac_add_options --enable-macos-target=10.5
+#ac_add_options --with-default-mozilla-five-home=@FINKPREFIX@/lib/firefox3
+ac_add_options --with-system-jpeg=@FINKPREFIX@
+ac_add_options --disable-system-cairo
diff -ruN mozilla-1.9.1-orig/browser/components/build/Makefile.in mozilla-1.9.1/browser/components/build/Makefile.in
--- mozilla-1.9.1-orig/browser/components/build/Makefile.in	2009-03-05 16:31:44.000000000 -0500
+++ mozilla-1.9.1/browser/components/build/Makefile.in	2009-03-16 16:34:22.000000000 -0400
@@ -76,6 +76,12 @@
 	$(MOZ_COMPONENT_LIBS) \
 	$(NULL)
 
+# fix for building on Mac/X11 (bug 257773)
+# dependencies for gkgfx
+ifeq ($(MOZ_WIDGET_TOOLKIT), gtk2)
+EXTRA_DSO_LDOPTS += $(MOZ_GTK2_LIBS)
+endif
+
 # Mac: Need to link with CoreFoundation for Mac Migrators (PList reading code)
 # GTK2: Need to link with glib for GNOME shell service
 ifneq (,$(filter mac cocoa gtk2,$(MOZ_WIDGET_TOOLKIT)))
--- mozilla-1.9.1-orig/browser/locales/generic/profile/bookmarks.html.in	2009-03-05 16:31:44.000000000 -0500
+++ mozilla-1.9.1/browser/locales/generic/profile/bookmarks.html.in	2009-03-24 14:06:17.000000000 -0400
@@ -15,6 +15,7 @@
     <DL><p>
         <DT><A HREF="http://www.mozilla.com/@AB_CD@/firefox/central/" ID="rdf:#$GvPhC3">@getting_started@</A>
         <DT><A HREF="http://fxfeeds.mozilla.com/@AB_CD@/firefox/livebookmarks/" FEEDURL="http://fxfeeds.mozilla.com/@AB_CD@/firefox/headlines.xml" ID="rdf:#$HvPhC3">@latest_headlines@</A>
+        <DT><A HREF="http://www.finkproject.org/" ICON_URI="http://www.finkproject.org/favicon.ico" ICON="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAA+0lEQVQ4jWNgGDLg/6sTqv9OVe75uzv43J+TpUv/MzAwEqfxfEfU3y3O///u9P//d5v7/7/HCir/vz8n//9ir9+fffF+eDX/O5yxCqLR4///28u0GRgYGP6uN/sPN/zNBWlMG9+e4Pt7tq0bbutO//9/t3v9///qFQ9e2/7uCZ3/b3fwvX9HMg//PZpz7e9O//9/9ye8+Lc34ubf7V7/f1+e4Irdj3dWVf//f5UNzn91VeLvzoD/f0+U1OK1EadLtrr8/3+uoYcszf+PZHX/OxB/jizNDAwMDP92BX0hW/P/o1k7ydbMwMDA8P98D/ZQJkrz+6sJFNk+oAAAPwyICxl3w8YAAAAASUVORK5CYII=">Fink - Home</A>
     </DL><p>
     <HR>
     <DT><H3 ID="rdf:#$ZvPhC3">@firefox_heading@</H3>
diff -ruN mozilla-1.9.1-orig/config/autoconf.mk.in mozilla-1.9.1/config/autoconf.mk.in
--- mozilla-1.9.1-orig/config/autoconf.mk.in	2009-03-05 16:31:44.000000000 -0500
+++ mozilla-1.9.1/config/autoconf.mk.in	2009-03-16 16:36:19.000000000 -0400
@@ -57,14 +57,14 @@
 prefix		= @prefix@
 exec_prefix	= @exec_prefix@
 bindir		= @bindir@
-includedir	= @includedir@/$(MOZ_APP_NAME)-$(MOZ_APP_VERSION)
+includedir	= @includedir@/$(MOZ_APP_NAME)3
 libdir		= @libdir@
 datadir		= @datadir@
 mandir		= @mandir@
-idldir		= $(datadir)/idl/$(MOZ_APP_NAME)-$(MOZ_APP_VERSION)
+idldir		= $(datadir)/idl/$(MOZ_APP_NAME)3
 
-installdir	= $(libdir)/$(MOZ_APP_NAME)-$(MOZ_APP_VERSION)
+installdir	= $(libdir)/$(MOZ_APP_NAME)3
-sdkdir		= $(libdir)/$(MOZ_APP_NAME)-devel-$(MOZ_APP_VERSION)
+sdkdir		= $(libdir)/$(MOZ_APP_NAME)3-devel
 
 DIST		= $(DEPTH)/dist
 LIBXUL_SDK      =
diff -ruN mozilla-1.9.1-orig/configure mozilla-1.9.1/configure
--- mozilla-1.9.1-orig/configure	2009-03-05 16:39:06.000000000 -0500
+++ mozilla-1.9.1/configure	2009-03-16 22:06:47.000000000 -0400
@@ -5869,11 +5869,11 @@
     ;;
 
 *-darwin*)
-    HOST_CFLAGS="$HOST_CFLAGS -DXP_UNIX -DXP_MACOSX -DNO_X11"
+    HOST_CFLAGS="$HOST_CFLAGS -DXP_UNIX"
     HOST_NSPR_MDCPUCFG='\"md/_darwin.cfg\"'
     HOST_OPTIMIZE_FLAGS="${HOST_OPTIMIZE_FLAGS=-O3}"
     MOZ_FIX_LINK_PATHS='-Wl,-executable_path,$(LIBXUL_DIST)/bin'
-    LIBXUL_LIBS='$(XPCOM_FROZEN_LDOPTS) $(LIBXUL_DIST)/bin/XUL -lobjc'
+    LIBXUL_LIBS='$(XPCOM_FROZEN_LDOPTS) $(LIBXUL_DIST)/bin/libxul.dylib -lobjc'
     ;;
 
 *-linux*|*-kfreebsd*-gnu)
@@ -6158,10 +6158,10 @@
     MKCSHLIB='$(CC) $(CFLAGS) $(DSO_PIC_CFLAGS) $(DSO_LDOPTS) -o $@'
     MOZ_OPTIMIZE_FLAGS="-O2"
     _PEDANTIC=
-    CFLAGS="$CFLAGS -fpascal-strings -fno-common"
-    CXXFLAGS="$CXXFLAGS -fpascal-strings -fno-common"
+    CFLAGS="$CFLAGS -fno-common"
+    CXXFLAGS="$CXXFLAGS -fno-common"
     DLL_SUFFIX=".dylib"
-    DSO_LDOPTS=''
+    DSO_LDOPTS='-framework CoreFoundation'
     STRIP="$STRIP -x -S"
     _PLATFORM_DEFAULT_TOOLKIT='cairo-cocoa'
     MOZ_ENABLE_POSTSCRIPT=
diff -ruN mozilla-1.9.1-orig/fink/applications/firefox.desktop mozilla-1.9.1/fink/applications/firefox.desktop
--- mozilla-1.9.1-orig/fink/applications/firefox.desktop	1969-12-31 19:00:00.000000000 -0500
+++ mozilla-1.9.1/fink/applications/firefox.desktop	2009-03-16 16:36:19.000000000 -0400
@@ -0,0 +1,10 @@
+[Desktop Entry]
+Encoding=UTF-8
+Name=Firefox Web Browser
+Comment=Browse the World Wide Web
+Exec=firefox
+Icon=firefox.png
+Terminal=false
+Type=Application
+Categories=Application;Network
+StartupNotify=true
diff -ruN mozilla-1.9.1-orig/fink/fink.js mozilla-1.9.1/fink/fink.js
--- mozilla-1.9.1-orig/fink/fink.js	1969-12-31 19:00:00.000000000 -0500
+++ mozilla-1.9.1/fink/fink.js	2009-03-16 16:36:19.000000000 -0400
@@ -0,0 +1,25 @@
+pref("general.useragent.extra.vendorComment", "Fink Community Edition");
+
+// Give a default font set that can do BOLD
+//pref("font.name.serif.x-western", "Bitstream Vera Serif");
+//pref("font.name.sans-serif.x-western", "Bitstream Vera Sans");
+//pref("font.size.variable.x-western", 15);
+
+// TrueType
+//pref("font.FreeType2.enable", true);
+//pref("font.freetype2.shared-library", "@FINKPREFIX@/lib/libfreetype.dylib");
+//pref("font.freetype2.shared-library", "/usr/X11R6/lib/libfreetype.6.dylib");
+//pref("font.freetype2.autohinted", true);
+//pref("font.freetype2.unhinted", true);
+//pref("font.antialias.min", 10);
+//pref("font.embedded_bitmaps.max", 1000000);
+//pref("font.scale.tt_bitmap.dark_text.min", 64);
+//pref("font.scale.tt_bitmap.dark_text.gain", "0.0");
+//pref("font.directory.truetype.1", "/Library/Fonts");
+//pref("font.directory.truetype.2", "/Network/Library/Fonts");
+//pref("font.directory.truetype.3", "/System/Library/Fonts");
+//pref("font.directory.truetype.4", "/usr/X11R6/lib/X11/fonts/TTF");
+//pref("font.directory.truetype.5", "@FINKPREFIX@/share/fonts/truetype");
+
+// AA with Bitmap scaling.
+//pref("font.scale.aa_bitmap.enable", true);
--- mozilla-1.9.1-orig/media/liboggplay/src/liboggplay/std_semaphore.h2009-03-05 16:32:15.000000000 -0500
+++ mozilla-1.9.1/media/liboggplay/src/liboggplay/std_semaphore.h	2009-04-01 14:14:08.000000000 -0400
@@ -50,7 +50,7 @@
 #define SEM_CLOSE(p)    CloseHandle(p)
 typedef HANDLE          semaphore;
 #elif defined(__APPLE__)
-#include <Multiprocessing.h>
+#include <Carbon/Carbon.h>
 #define SEM_CREATE(p,s) MPCreateSemaphore(s, s, &(p))
 #define SEM_SIGNAL(p)   MPSignalSemaphore(p)
 #define SEM_WAIT(p)     MPWaitOnSemaphore(p, kDurationForever)
diff -ruN mozilla-1.9.1-orig/modules/libjar/nsZipArchive.cpp mozilla-1.9.1/modules/libjar/nsZipArchive.cpp
--- mozilla-1.9.1-orig/modules/libjar/nsZipArchive.cpp	2009-03-05 16:32:15.000000000 -0500
+++ mozilla-1.9.1/modules/libjar/nsZipArchive.cpp	2009-03-16 16:38:29.000000000 -0400
@@ -51,7 +51,7 @@
 
 #ifndef STANDALONE
 
-#include "nsWildCard.h"
+#include "nsWildCard_old.h"
 #include "nscore.h"
 #include "prmem.h"
 #include "prio.h"
diff -ruN mozilla-1.9.1-orig/modules/libjar/objs.mk mozilla-1.9.1/modules/libjar/objs.mk
--- mozilla-1.9.1-orig/modules/libjar/objs.mk	2009-03-05 16:32:15.000000000 -0500
+++ mozilla-1.9.1/modules/libjar/objs.mk	2009-03-16 16:37:30.000000000 -0400
@@ -37,7 +37,7 @@
 
 MODULES_STANDALONE_LCPPSRCS = \
 		nsZipArchive.cpp \
-		nsWildCard.cpp \
+		nsWildCard_old.cpp \
 		$(NULL)
 
 MODULES_LIBJAR_LCPPSRCS = \
--- mozilla-1.9.1-orig/modules/libpr0n/decoders/icon/Makefile.in	2009-03-05 16:32:15.000000000 -0500
+++ mozilla-1.9.1/modules/libpr0n/decoders/icon/Makefile.in	2009-03-17 09:16:57.000000000 -0400
@@ -67,7 +67,7 @@
 PLATFORM = os2
 endif
 
-ifeq ($(OS_ARCH),Darwin)
+ifeq (cocoa,$(MOZ_WIDGET_TOOLKIT))
 PLATFORM = mac
 endif
 
diff -ruN mozilla-1.9.1-orig/nsprpub/configure mozilla-1.9.1/nsprpub/configure
--- mozilla-1.9.1-orig/nsprpub/configure	2009-03-05 16:32:18.000000000 -0500
+++ mozilla-1.9.1/nsprpub/configure	2009-03-16 16:36:19.000000000 -0400
@@ -3376,9 +3376,6 @@
 
     # Add Mac OS X support for loading CFM & CFBundle plugins
     if test -f /System/Library/Frameworks/Carbon.framework/Carbon; then
-        cat >> confdefs.h <<\EOF
-#define XP_MACOSX 1
-EOF
 
         OS_TARGET=MacOSX
 
@@ -5023,8 +5020,6 @@
 
 
 case $target in
-*-darwin*|*-beos*)
-    ;;
 *)
     echo $ac_n "checking for dlopen in -ldl""... $ac_c" 1>&6
 echo "configure:5031: checking for dlopen in -ldl" >&5
diff -ruN mozilla-1.9.1-orig/nsprpub/pr/include/md/_darwin.h mozilla-1.9.1/nsprpub/pr/include/md/_darwin.h
--- mozilla-1.9.1-orig/nsprpub/pr/include/md/_darwin.h	2009-03-05 16:32:18.000000000 -0500
+++ mozilla-1.9.1/nsprpub/pr/include/md/_darwin.h	2009-03-16 16:36:19.000000000 -0400
@@ -67,7 +67,8 @@
 #ifdef __x86_64__
 #define USE_DLFCN
 #else
-#define USE_MACH_DYLD
+/* #define USE_MACH_DYLD */
+#define USE_DLFCN
 #endif
 #define _PR_HAVE_SOCKADDR_LEN  
 #define _PR_STAT_HAS_ST_ATIMESPEC
diff -ruN mozilla-1.9.1-orig/nsprpub/pr/src/Makefile.in mozilla-1.9.1/nsprpub/pr/src/Makefile.in
--- mozilla-1.9.1-orig/nsprpub/pr/src/Makefile.in	2009-03-05 16:32:18.000000000 -0500
+++ mozilla-1.9.1/nsprpub/pr/src/Makefile.in	2009-03-16 16:36:19.000000000 -0400
@@ -201,9 +201,9 @@
 endif
 endif
 
-ifeq ($(OS_TARGET),MacOSX)
-OS_LIBS		= -framework CoreServices -framework CoreFoundation
-endif
+#ifeq ($(OS_TARGET),MacOSX)
+#OS_LIBS		= -framework CoreServices -framework CoreFoundation
+#endif
 
 ifdef GC_LEAK_DETECTOR
 EXTRA_LIBS	= -L$(dist_libdir) -lboehm
diff -ruN mozilla-1.9.1-orig/nsprpub/pr/src/linking/prlink.c mozilla-1.9.1/nsprpub/pr/src/linking/prlink.c
--- mozilla-1.9.1-orig/nsprpub/pr/src/linking/prlink.c	2009-03-05 16:32:19.000000000 -0500
+++ mozilla-1.9.1/nsprpub/pr/src/linking/prlink.c	2009-03-16 16:36:19.000000000 -0400
@@ -158,7 +158,8 @@
 #if defined(SUNOS4) || defined(DARWIN) || defined(NEXTSTEP) \
     || defined(WIN16) || defined(XP_OS2) \
     || ((defined(OPENBSD) || defined(NETBSD)) && !defined(__ELF__))
-#define NEED_LEADING_UNDERSCORE
+/* On MacOSX 10.3-10.5(+?), dlsym does not accept symbols with '_'. */
+/* #define NEED_LEADING_UNDERSCORE */
 #endif
 
 #define PR_LD_PATHW 0x8000  /* for PR_LibSpec_PathnameU */
diff -ruN mozilla-1.9.1-orig/toolkit/library/Makefile.in mozilla-1.9.1/toolkit/library/Makefile.in
--- mozilla-1.9.1-orig/toolkit/library/Makefile.in	2009-03-05 16:32:46.000000000 -0500
+++ mozilla-1.9.1/toolkit/library/Makefile.in	2009-03-16 22:08:37.000000000 -0400
@@ -230,6 +230,7 @@
 ifeq (gtk2,$(MOZ_WIDGET_TOOLKIT))
 EXTRA_DSO_LDOPTS += $(XLDFLAGS) $(XLIBS) $(MOZ_PANGO_LIBS) $(MOZ_GTK2_LIBS) $(XT_LIBS) -lgthread-2.0
 EXTRA_DSO_LDOPTS += $(FT2_LIBS)
+EXTRA_DSO_LDOPTS += -Wl,-framework,AudioUnit
 endif
 
 ifeq (qt,$(MOZ_WIDGET_TOOLKIT))
--- mozilla-1.9.1-orig/toolkit/mozapps/installer/packager.mk	2009-03-05 16:32:46.000000000 -0500
+++ mozilla-1.9.1/toolkit/mozapps/installer/packager.mk	2009-03-17 10:58:13.000000000 -0400
@@ -418,7 +418,7 @@
 # dist/sdk/lib -> prefix/lib/appname-devel-version/lib
 # prefix/lib/appname-devel-version/* symlinks to the above directories
 install:: stage-package
-ifneq (,$(filter WINNT Darwin,$(OS_ARCH)))
+ifneq (,$(filter WINNT,$(OS_ARCH)))
 	$(error "make install" is not supported on this platform. Use "make package" instead.)
 endif
 	$(NSINSTALL) -D $(DESTDIR)$(installdir)
@@ -434,7 +434,7 @@
 	(cd $(DIST)/sdk/include && tar $(TAR_CREATE_FLAGS) - .) | \
 	  (cd $(DESTDIR)$(includedir)/stable && tar -xf -)
 # The dist/include has module subdirectories that we need to flatten
-	find $(DIST)/include -xtype f -exec $(SYSINSTALL) $(IFLAGS1) {} $(DESTDIR)$(includedir)/unstable \;
+	find $(DIST)/include -type f -exec $(SYSINSTALL) $(IFLAGS1) {} $(DESTDIR)$(includedir)/unstable \;
 # IDL directory is stable (dist/sdk/idl) and unstable (dist/idl)
 	$(NSINSTALL) -D $(DESTDIR)$(idldir)/stable 
 	$(NSINSTALL) -D $(DESTDIR)$(idldir)/unstable
diff -ruN mozilla-1.9.1-orig/xpcom/base/nsStackWalk.cpp mozilla-1.9.1/xpcom/base/nsStackWalk.cpp
--- mozilla-1.9.1-orig/xpcom/base/nsStackWalk.cpp	2009-03-05 16:32:54.000000000 -0500
+++ mozilla-1.9.1/xpcom/base/nsStackWalk.cpp	2009-03-16 16:36:19.000000000 -0400
@@ -1124,7 +1124,7 @@
 #define __USE_GNU
 #endif
 
-#if defined(HAVE_LIBDL) || defined(XP_MACOSX)
+#if defined(HAVE_LIBDL) || defined(XP_UNIX)
 #include <dlfcn.h>
 #endif
 
--- mozilla-1.9.1-orig/xpcom/stub/Makefile.in	2009-03-05 16:32:56.000000000 -0500
+++ mozilla-1.9.1/xpcom/stub/Makefile.in	2009-03-17 06:22:57.000000000 -0400
@@ -108,8 +108,8 @@
 endif
 
 ifeq (Darwin,$(OS_ARCH))
-EXTRA_DSO_LDOPTS += $(DIST)/bin/XUL
-DEPENDENT_LIBS_LIST += XUL
+EXTRA_DSO_LDOPTS += $(DIST)/bin/libxul.dylib
+DEPENDENT_LIBS_LIST += $(LIB_PREFIX)xul$(DLL_SUFFIX)
 else
 EXTRA_DSO_LIBS = xul
 DEPENDENT_LIBS_LIST += $(LIB_PREFIX)xul$(DLL_SUFFIX)
