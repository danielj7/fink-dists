Info2: <<
Package: plplot%type_pkg[-nognome]
Version: 5.8.0
Revision: 1002
Distribution: 10.4, 10.5
GCC: 4.0
Type: -nognome (boolean)

BuildDepends: <<
   aquaterm-dev, automake1.9, fftw3, freetype219, gcc42, gd2, gd2-bin, glib2-dev, hdf5, lasi-dev, libgettext3-dev,
   libiconv-dev, libjpeg, libncurses5, libpng3, libtool14, openjade, opensp4, pango1-xft2, pango1-xft2-dev,
   pkgconfig, readline5, swig, system-java15-dev, x11-dev, xml-dom-pm586, xml-sax-expat-pm586, fink (>= 0.27.2),
   (%type_raw[-nognome] = .) atk1, (%type_raw[-nognome] = .) gnome-python2-py25-dev,
   (%type_raw[-nognome] = .) gtk+2-dev, (%type_raw[-nognome] = .) libart2, (%type_raw[-nognome] = .) libgnomecanvas2-dev,
   (%type_raw[-nognome] = .) libgnomeprint2.2-dev, (%type_raw[-nognome] = .) libgnomeprintui2.2-dev,
   (%type_raw[-nognome] = .) libgnomeui2-dev, (%type_raw[-nognome] = .) libxml2,
   (%type_raw[-nognome] = .) pygobject2-py25-dev, (%type_raw[-nognome] = .) pygtk2-gtk-py25-dev (>= 2.6.3-2)
<<
## bdeps on openjade, opensp4, xml-dom-pm586, xml-sax-expat-pm586 seem needed only for cvs builds
Depends: %N-dev (= %v-%r), lasi, numeric-py25, octave-atlas (>= 3.0.0-1) | octave (>= 3.0.0-1), python, qhull, system-java15
Suggests: tcltk-dev
Replaces: %{Ni} (<< 5.8.0-1), %{Ni}-dev (<< 5.8.0-1), %{Ni}-shlibs (<< 5.8.0-1), %{Ni}, %{Ni}-nognome
Provides: %{Ni}-nognome
# Re: absence of Conflicts: Not completely sure that one can install plplot-nognome + splits on top of plplot + splits,
# and that the latter are still fully functional. Should still be investigated carefully...

Source: mirror:sourceforge:plplot/%{Ni}-%v.tar.gz
Source-MD5: 63e954448b12056aeecf2b53cd97f1f5

PatchScript: <<
#!/bin/sh -ev
 # link dylibs with -single_module, if only to avoid "common symbols" errors.
 # LDFLAGS or the like can't be used since -single_module only usable for dylibs.
 find . -name Makefile.am|xargs sed -i.bak 's;^\([[:space:]]\+\|lib.*_la_LDFLAGS.* \)-no-undefined;& -Wl,-single_module;'
 mv bindings/java/Makefile.am.bak bindings/java/Makefile.am
 # strip executables (in addition to the SetLDFLAGS):
 sed -i.bak -e 's,-no-undefined,& -s,' {utils,bindings/tk}/Makefile.am
 # help configure getting the correct inference about octave version, to avoid direct install of /PLplot and /plplot_octave.oct
 sed -i.bak -e '/OCTAVE_VERSION/s,2\.1/,[2-9].[0-9]/,' configure
 sed -i.bak -e '/OCTAVE_VERSION/s,2\.1/,[[2-9].[0-9]]/,' cf/octave.ac
 # recognize octave versions >= 3 as such
 sed -i.bak -e 's,\$ver\[0\],& >= 3 || &,' bindings/octave/matwrap/wrap_octave.pl 
 ## octave_version.pl is 'required' by matwrap/wrap_octave.pl,
 ## and must be in the same dir, since @INC does not necessarily contain ".."
 mv bindings/octave/octave_version.pl.in bindings/octave/matwrap
 sed -i.bak -e '/bindings\/Makefile/a\
\ \ \ \ bindings/octave/matwrap/octave_version.pl' configure.ac 
 # get info file accepted by InfoDocs
 sed -i.bak -e '/The PLplot Plotting Library/s,: \.,: (%{Ni}).,' doc/docbook/src/%{Ni}doc.info
 ## In bindings/gnome2/python :
 # 1) correct hard-coded addresses for pygtk2-gtk :
 # 2) PYGTK_DEFS are not the path to gnome.defs
 sed -i.bak -e 's,/usr/share,%p/lib,' \
	-e '/^PYGTK_DEFS=/a\
PYGNOME_DEFS=`pkg-config --variable=defsdir gnome-python-2.0`'\
	-e 's,PYGTK\(_DEFS)/\(gnome\|canvas\)\),PYGNOME\1,'\
	bindings/gnome2/python/Makefile.am
 # To avoid multiply-defined symbols errors :
 sed -i.bak -e '/pygobject\.h/i\
#define NO_IMPORT_PYGOBJECT\
#define NO_IMPORT_ARRAY' bindings/gnome2/python/*.c
 ## circumvent ltdl error on get-drv-info for gcw _ still to be understood, and corrected at the proper place.:
 # At least, the fix points to the source of the problem much more than the error msg did ...
  sed -i.bak -e 's,\./get-drv-info,export DYLD_FALLBACK_LIBRARY_PATH=../bindings/gnome2/lib/.libs; &,' drivers/Makefile.am
<<

SetCFLAGS: -Os -fstrict-aliasing -Wno-long-double
NoSetCPPFLAGS: true
NoSetLDFLAGS: true
SetLDFlags: -L%p/lib/python2.5/config -Wl,-x,-dead_strip
SetLIBRARY_PATH: %p/lib
NoSetMAKEFLAGS: true
SetMAKEFLAGS: -j1

ConfigureParams: <<
 --mandir=%p/share/man --infodir=%p/share/info --with-python-incdir=%p/include/python2.5 \
 --with-freetype2-libdir=%p/lib/freetype219/lib --with-freetype2-incdir=%p/lib/freetype219/include/freetype2 \
 --with-freetype-font-dir=/usr/X11R6/lib/X11/fonts --with-gd-libdir=%p/lib --with-gd-incdir=%p/include \
 --with-java-home=/Library/Java/Home TCLLIBDIR=%p/lib TKLIBDIR=%p/lib AQTINCDIR=%p/include/aquaterm \
 --with-pthreads --with-pkg-config --without-rpath --build=powerpc-apple-darwin --disable-java \
 --with-ltdlsystem --enable-f95 FC=gfortran F77=gfortran --with-x --enable-xterm \
 --with-onsgmls --with-prebuiltdoc (%type_raw[-nognome] = -nognome) --disable-gcw
<<
# remains to get rid of "--disable-java" (to conform with 5.6.1)
# to debug a maximum before switching the build-system to the opaque cmake _ which seems needed
# to build the cairo driver, and will apparently be the only one in next %v... <sigh>

CompileScript: <<
 #!/bin/sh -ev
 export CCACHE_DISABLE=1
 export CPATH=%p/lib/freetype219/include:%p/include
 export FCFLAGS="-Os -fstrict-aliasing" FFLAGS="-Os -fstrict-aliasing"
 ln -s %{Ni}.py.Numeric bindings/python/%{Ni}.py
 %{default_script}
<<

InstallScript: <<
  #!/bin/sh -ev
  make install DESTDIR=%d
  mv %i/share/info/%{Ni}doc.info %i/share/info/%{Ni}.info
  rm %i/share/info/*.bak
  ln -s html/index.html %i/share/doc/%{Ni}/%{Ni}.html
  chmod a+x %i/share/%{Ni}%v/examples/python/xw24.py
  chmod -R a-x,a+X %i/lib %i/share/doc
  rm %i/share/doc/%{Ni}/{%{Ni}-%v.{dvi,ps.gz},C{O,o}*}
  ln -s ../%N-shlibs/{COPYING.LIB,Copyright} %i/share/doc/%{Ni}
  if [ "%n" != "%{Ni}" ] ; then ln -s %{Ni} %i/share/doc/%n ; fi
## clean up .la files (and should still do .pc's , and -config...)
  sed -i.bak -e "/^dependency_libs/{
	s,-\([RL]%p/[a-z0-9./]*\|l[a-mp-y]*\)\( \|'\),\2,g
	s, \+, ,g
	s, '$,',
	}" %i/lib{,/*/*}/*.la
  rm -f %i/lib{,/*/*}/*.la.bak
## Adjust TCLLIBPATH _ copied from vtk-py ... (other pkgs would need too ...)
  install -d %i/etc/profile.d
  cat >%i/etc/profile.d/%{Ni}.sh <<-EOF
	export TCLLIBPATH="%p/share/%{Ni}%v/tcl \$TCLLIBPATH"
	EOF
  cat >%i/etc/profile.d/%{Ni}.csh <<-EOF
	if ( ! \$?TCLLIBPATH ) then
		setenv TCLLIBPATH "%p/share/%{Ni}%v/tcl"
	else
		setenv TCLLIBPATH "%p/share/%{Ni}%v/tcl \$TCLLIBPATH"
	endif
	EOF
  chmod 755 %i/etc/profile.d/*
<<
InfoDocs: %{Ni}.info

SplitOff: <<
   Package: %N-shlibs
   Depends: aquaterm-shlibs, freetype219-shlibs, gcc42-shlibs, gd2-shlibs, lasi-shlibs, libtool14-shlibs, pango1-xft2-shlibs, tcltk-shlibs, (%type_raw[-nognome] = .) libgnomeprintui2.2-shlibs
   Replaces: %{Ni} (<< 5.8.0-1), %{Ni}-dev (<< 5.8.0-1), %{Ni}-shlibs (<< 5.8.0-1), %{Ni}-shlibs, %{Ni}-nognome-shlibs
   Provides: %{Ni}-nognome-shlibs
#   Files: lib/lib*.*.dylib lib/*/driversd/*.{so,rc}	## fails for some mystery ... What are the rules?
   Files: lib/lib*.*.dylib lib/%{Ni}%v/driversd/*.{so,rc}
   Shlibs: <<
	%p/lib/libcsirocsa.0.dylib	1.0.0	%n (>= 5.3.1-1)
	%p/lib/libcsironn.0.dylib	1.0.0	%n (>= 5.3.1-1)
	%p/lib/libplplotd.11.dylib	12.0.0	%n (>= 5.8.0-1)
	%p/lib/libplplotcxxd.9.dylib	12.0.0	%n (>= 5.3.1-1)
	%p/lib/libplplotf77cd.9.dylib	11.0.0	%n (>= 5.6.1-1001)
	%p/lib/libplplotf77d.9.dylib	11.0.0	%n (>= 5.6.1-1001)
	%p/lib/libplplotf95cd.0.dylib	1.0.0	%n (>= 5.6.1-1001)
	%p/lib/libplplotf95d.0.dylib	1.0.0	%n (>= 5.6.1-1001)
	%p/lib/libplplottcltkd.11.dylib	12.0.0	%n (>= 5.8.0-1)
	%p/lib/libtclmatrixd.11.dylib	12.0.0	%n (>= 5.8.0-1)
	(%type_raw[-nognome] = .)	%p/lib/libplplotgnome2d.0.dylib	1.0.0	%n (>= 5.8.0-1)
   <<
   InstallScript: <<
	mkdir -p %i/share/doc/%{Ni}-shlibs
	cp -p COPYING.LIB Copyright %i/share/doc/%{Ni}-shlibs
	if [ "%N" != "%{Ni}" ] ; then ln -s %{Ni}-shlibs %i/share/doc/%n ; fi
   <<
<<

SplitOff2: <<
   Package: %N-dev
   Depends: %N-shlibs (= %v-%r)
   Replaces: %{Ni} (<< 5.8.0-1), %{Ni}-dev (<< 5.8.0-1), %{Ni}-shlibs (<< 5.8.0-1), %{Ni}-dev, %{Ni}-nognome-dev
   Provides: %{Ni}-nognome-dev
   Files: lib/*.{,l}a (%type_raw[-nognome] = .) lib/python2.5/site-packages/*.{,l}a lib/*.dylib lib/pkgconfig lib/%{Ni}* include bin/%{Ni}_libtool bin/%{Ni}-config
   BuildDependsOnly: False
   InstallScript: mkdir -p %i/share/doc; ln -s %N-shlibs %i/share/doc/%n
   PreInstScript: rm -fR %p/share/doc/%n
<<

Description: Scientific plotting package

DescDetail: <<
PLplot is relatively small, portable, freely distributable, and is rich
enough to satisfy most users. It has a wide range of plot types
including line (linear, log), contour, 3D, fill, and almost 1000
characters (including Greek and mathematical) in its extended font set. 
The package is designed to make it easy to quickly get graphical output;
only a handful of function calls is typically required.  For more
advanced use, virtually all aspects of plotting are configurable.
<<
DescUsage: <<
Make sure that tcltk-dev is installed.

To test the examples, copy the directory /sw/share/%n%v to
your home directory, and cd into examples. Then run the following
commands from an X11 window:

make
./plplot-test.sh

<<
DescPackaging: <<
Many thanks to the PLplot folks for helping with packaging.

Depends on plplot-dev and tcltk-dev because these are needed during 
runtime. The dependency on tcltk-dev is not imposed, because it violates
Fink policy.
<<
License: LGPL
Maintainer: None <fink-devel@lists.sourceforge.net>
Homepage: http://plplot.sf.net
<<
