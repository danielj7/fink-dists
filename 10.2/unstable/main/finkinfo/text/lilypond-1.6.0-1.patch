diff -ru lilypond-1.6.0.orig/lily/kpath.cc lilypond-1.6.0/lily/kpath.cc
--- lilypond-1.6.0.orig/lily/kpath.cc	Fri Jul 26 03:26:59 2002
+++ lilypond-1.6.0/lily/kpath.cc	Thu Aug 22 14:29:03 2002
@@ -14,6 +14,7 @@
 #define popen REALLYUGLYKLUDGE
 #define pclose ANOTHERREALLYUGLYKLUDGE
 #define getopt YAKLUDGE
+#define __GNU_LIBRARY__
 
 #if HAVE_KPATHSEA_KPATHSEA_H
 extern "C" {
diff -ru lilypond-1.6.0.orig/lily/lily-guile.cc lilypond-1.6.0/lily/lily-guile.cc
--- lilypond-1.6.0.orig/lily/lily-guile.cc	Sun Aug 18 16:12:43 2002
+++ lilypond-1.6.0/lily/lily-guile.cc	Thu Aug 22 16:13:12 2002
@@ -23,6 +23,11 @@
 #include "interval.hh"
 #include "pitch.hh"
 #include "dimensions.hh"
+//
+// source-file.h includes cmath which undefines isinf and isnan
+//
+inline int (isinf)(Real r) { return isinf(r); }
+inline int (isnan)(Real r) { return isnan(r); }
 #include "source-file.hh"
 
 // #define TEST_GC
diff -ru lilypond-1.6.0.orig/lily/my-lily-parser.cc lilypond-1.6.0/lily/my-lily-parser.cc
--- lilypond-1.6.0.orig/lily/my-lily-parser.cc	Fri Aug 16 18:38:52 2002
+++ lilypond-1.6.0/lily/my-lily-parser.cc	Fri Aug 23 14:31:54 2002
@@ -7,6 +7,10 @@
        Jan Nieuwenhuizen <janneke@gnu.org>
 */
 
+//
+// Work aroung a gcc 3.1 (?) bug
+//
+#include <iostream.h>
 #include "my-lily-parser.hh"
 #include "my-lily-lexer.hh"
 #include "warn.hh"
diff -ru lilypond-1.6.0.orig/lily/parser.yy lilypond-1.6.0/lily/parser.yy
--- lilypond-1.6.0.orig/lily/parser.yy	Sun Aug 18 16:12:43 2002
+++ lilypond-1.6.0/lily/parser.yy	Fri Aug 23 18:30:09 2002
@@ -23,6 +23,7 @@
 
 */
 
+#include <iostream.h>
 #include <ctype.h>
 
 #include "translator-def.hh"
@@ -111,7 +112,6 @@
 
 // needed for bison.simple's malloc () and free ()
 
-#include <malloc.h>
 #include <stdlib.h>
 
 
diff -ru lilypond-1.6.0.orig/lily/score.cc lilypond-1.6.0/lily/score.cc
--- lilypond-1.6.0.orig/lily/score.cc	Thu Aug 15 05:52:19 2002
+++ lilypond-1.6.0/lily/score.cc	Fri Aug 23 14:54:49 2002
@@ -77,6 +77,7 @@
 #define PARANOIA
 
 #ifdef PARANOIA
+#include <sys/time.h>
 #include <sys/resource.h>
 #endif
 
diff -ru lilypond-1.6.0.orig/stepmake/stepmake/c++-rules.make lilypond-1.6.0/stepmake/stepmake/c++-rules.make
--- lilypond-1.6.0.orig/stepmake/stepmake/c++-rules.make	Wed Jul 17 17:08:20 2002
+++ lilypond-1.6.0/stepmake/stepmake/c++-rules.make	Fri Aug 23 17:37:11 2002
@@ -24,4 +24,5 @@
 	rm -f $(*F).tab.c $(*F).tab.cc	# if this happens in the wrong order it triggers recompile of the .cc file 
 
 $(outdir)/%.cc: %.ll
-	$(FLEX) -Cfe -p -p -t $< > $@
+	echo '#include <iostream.h>' > $@
+	$(FLEX) -Cfe -p -p -t $< >> $@
diff -ru lilypond-1.6.0.orig/stepmake/stepmake/c-vars.make lilypond-1.6.0/stepmake/stepmake/c-vars.make
--- lilypond-1.6.0.orig/stepmake/stepmake/c-vars.make	Wed Jul 17 17:08:20 2002
+++ lilypond-1.6.0/stepmake/stepmake/c-vars.make	Thu Aug 22 13:38:36 2002
@@ -13,4 +13,4 @@
 
 ALL_C_SOURCES += $(H_FILES) $(C_FILES) $(Y_FILES) $(L_FILES)
 
-ALL_CFLAGS = $(CFLAGS) $(ICFLAGS) $(DEFINES) $(addprefix -I,$(INCLUDES)) $(USER_CFLAGS) $(EXTRA_CFLAGS) $(MODULE_CFLAGS)
+ALL_CFLAGS = $(CFLAGS) $(CPPFLAGS) $(ICFLAGS) $(DEFINES) $(addprefix -I,$(INCLUDES)) $(USER_CFLAGS) $(EXTRA_CFLAGS) $(MODULE_CFLAGS)
diff -ru lilypond-1.6.0.orig/stepmake/stepmake/compile-vars.make lilypond-1.6.0/stepmake/stepmake/compile-vars.make
--- lilypond-1.6.0.orig/stepmake/stepmake/compile-vars.make	Wed Jul 17 17:36:15 2002
+++ lilypond-1.6.0/stepmake/stepmake/compile-vars.make	Fri Aug 23 18:50:41 2002
@@ -3,7 +3,7 @@
 ALL_LDFLAGS = $(LDFLAGS) $(ILDFLAGS) $(EXTRA_LDFLAGS) $($(PACKAGE)_LDFLAGS) $(MODULE_LDFLAGS) $(USER_LDFLAGS)
 
 PIC_FLAGS = -fpic -fPIC
-SHARED_FLAGS = -shared
+SHARED_FLAGS = -shared -flat_namespace -undefined suppress
 
 o-dep-out = $(outdir)/$(subst .o,.dep,$(notdir $@))#
 DO_O_DEP = rm -f $(o-dep-out); DEPENDENCIES_OUTPUT="$(o-dep-out) $(outdir)/$(notdir $@)"
