Package: qrupdate
Version: 1.1.1
Revision: 2
Source: mirror:sourceforge:%{Ni}/1.1/%N-%v.tar.gz
Source-MD5: 7782c7ee6c234e56a72d6b86c1856fa0
Description: QR and Cholesky decomposition library
DescDetail: <<
qrupdate is a Fortran library for fast updates of QR, Cholesky decompositions.
<<
DescUsage: <<
This package contains a static library, header, and unversioned dylib.
<<
DescPackaging: <<
Patch out hardcoded /usr/local.

Uses GNU 'install -D', so we patch that out and use 'mkdir -p' first to avoid
BuildDepends: coreutils-default.

Doesn't get along with current Fink atlas, so use Accelerate.framework.

Use -ff2c to attempt to be compatible with Accelerate.
<<
Maintainer: Alexander Hansen <alexkhansen@users.sourceforge.net>
License: GPL

BuildDepends: gcc46-compiler
Depends: %N-shlibs (=%v-%r)
BuildDependsOnly: true

PatchScript: <<
	#!/bin/sh -ev
	sed -i.orig -e 's|/usr/local|%p|g' \
		-e '/FC/s|gfortran|&-fsf-4.6|' \
		-e 's|-lblas||' \
		-e 's|-llapack||' \
		Makeconf
	sed -i.orig -e 's|install -D|install|g' src/Makefile
	# recursive parallel Makefiles please -- fangism
	sed -i.orig -e '/make -C/s|make|+&|' Makefile
	sed -i.orig2 -e '/BLAS=/i\
LDFLAGS=-framework Accelerate' Makeconf
	sed -i.orig -e '/FFLAGS.*LIBS/s|(FFLAGS)|& $(LDFLAGS)|' test/Makefile
<<

CompileScript: <<
	make solib && make lib
<<

InfoTest: <<
	TestScript:  make test || exit 2
<<

InstallScript: <<
	mkdir -p %i/lib
	make -j1 install-shlib install-staticlib DESTDIR=%d
<<

DocFiles: COPYING README

SplitOff: <<
	Package: %N-shlibs
	Depends: gcc46-shlibs
	Files: lib/lib%N.1*.dylib
	DocFiles: COPYING README
	Shlibs:  %p/lib/lib%N.1.dylib 0.0.0 %n (>= 1.1.1-1)
	DescUsage: This package contains a shared library.
<<
