diff -ruN ccp4-5.99.5-orig/ccp4i/etc/configure.def.dist ccp4-5.99.5/ccp4i/etc/configure.def.dist
--- ccp4-5.99.5-orig/ccp4i/etc/configure.def.dist	2005-11-30 15:21:50.000000000 -0800
+++ ccp4-5.99.5/ccp4i/etc/configure.def.dist	2005-11-30 16:27:46.000000000 -0800
@@ -54,8 +54,8 @@
 MESSAGE                   _text				""
 BLT_LIBRARY               _text                     ""
 MENU_LENGTH               _positiveint              25
-HYPERTEXT_VIEWER          _text                     netscape
-START_NETSCAPE	          _text			    netscape
+HYPERTEXT_VIEWER          _text                     Safari  
+START_NETSCAPE	          _text			    open    
 O_MAPMAN                  _text                     mapman
 MAPMAN_MAXSIZE		  _positiveint		    4194304
 QUANTA_MBKALL             _text                     mbkall
diff -ruN ccp4-5.99.5-orig/ccp4i/etc/osx_ccp4_mail ccp4-5.99.5/ccp4i/etc/osx_ccp4_mail
--- ccp4-5.99.5-orig/ccp4i/etc/osx_ccp4_mail	1969-12-31 16:00:00.000000000 -0800
+++ ccp4-5.99.5/ccp4i/etc/osx_ccp4_mail	2005-11-30 15:59:45.000000000 -0800
@@ -0,0 +1,164 @@
+#!/usr/bin/perl
+# Drop-in replacement for /usr/bin/mail that uses Mail.app (via an
+# applescript) rather than sendmail to send mail.  Unlike /usr/bin/mail,
+# you can't use it for reading mail.
+#
+# usage: mail [<options>] <recipients>
+#     options:
+#         -v           be verbose
+#         -g           activate Mail.app to approve the message
+#         -F <from>    specify the From: address
+#         -b <bcc>     specify Bcc: recipients in a comma-separated list
+#         -c <cc>      specify Cc: recipients in a comma-separated list
+#         -s <subject> specify the message subject
+#
+# The body of the message is read from standard input.
+#
+# Author: Nathaniel Nystrom <nystrom@cs.cornell.edu>
+# This software is in the public domain.
+#
+# Version 1.0,   21 Aug 2003 -- initial version
+# Version 1.0.1, 22 Aug 2003 -- fixes some quoting problems
+# Version 1.0.2, 23 Aug 2003 -- removed -R <reply-to> option; |reply to|
+#                               is a property of _incoming_ messages
+# Version 1.0.3, 17 Sep 2003 -- fixed escaping of \ in message body;
+#                               escape the subject too
+
+use strict;
+$|++;
+
+my ($verbose, $gui);
+my ($from, @to, @cc, @bcc, $subject, $body);
+my $prog;
+($prog = $0) =~ s|.*/||;
+
+while (@ARGV) {
+    my $arg = shift @ARGV;
+
+    if ($arg eq '-v') {
+        $verbose++;
+    }
+    elsif ($arg eq '-g') {
+        $gui++;
+    }
+    elsif ($arg eq '-F') {
+        $from = shift @ARGV || &usage("missing sender");
+    }
+    elsif ($arg eq '-i' || $arg eq '-l' || $arg eq '-n') {
+        # ignore; for /usr/bin/mail compatibility
+    }
+    elsif ($arg eq '-N' || $arg eq '-f' || $arg eq '-u') {
+        &usage("invalid option $arg; $prog cannot be used for reading mail");
+    }
+    elsif ($arg eq '-s') {
+        $subject = shift @ARGV || &usage("missing subject");
+    }
+    elsif ($arg eq '-c') {
+        my $list = shift @ARGV || &usage("missing Cc list");
+        @cc = split /\s*,\s*/, $list;
+    }
+    elsif ($arg eq '-b') {
+        my $list = shift @ARGV || &usage("missing Bcc list");
+        @bcc = split /\s*,\s*/, $list;
+    }
+    elsif ($arg =~ /^-/) {
+        &usage("invalid option $arg");
+    }
+    else {
+        @to = ($arg, @ARGV);
+        last;
+    }
+}
+
+&usage("missing recipients") unless @to;
+
+unless (defined $subject) {
+    print "Subject: ";
+    $subject = <STDIN> || '';
+    chomp $subject;
+}
+
+$body = '';
+
+while (<STDIN>) {
+    $body .= $_;
+}
+
+$body = &escape($body);
+$subject = &escape($subject);
+
+my $script = <<"EOS";
+tell application "Mail"
+    set newMessage to make new outgoing message
+    tell newMessage
+        set subject to "$subject"
+        set content to "$body"
+EOS
+
+for (@to)  { $script .= &recipient('to', $_); }
+for (@cc)  { $script .= &recipient('cc', $_); }
+for (@bcc) { $script .= &recipient('bcc', $_); }
+
+my $visible = $gui ? "true" : "false";
+my $activate = $gui ? "activate" : "send newMessage";
+my $fromln = $from ? "set sender to \"$from\"" : "";
+
+$script .= <<"EOS";
+        $fromln
+        set visible to $visible
+    end tell
+    $activate
+end tell
+EOS
+
+if ($verbose >= 1) {
+    print "From: $from\n" if $from;
+    print "To: ", join(',', @to), "\n" if @to;
+    print "Cc: ", join(',', @cc), "\n" if @cc;
+    print "Bcc: ", join(',', @bcc), "\n" if @bcc;
+
+    if ($verbose >= 2) {
+        print "Script >>>\n";
+        print $script;
+        print "<<<\n";
+        print "\n";
+        print $body;
+    }
+}
+
+open(SCRIPT, "| osascript > /dev/null") || die "Couldn't fork osascript: $!\n";
+print SCRIPT $script;
+close SCRIPT;
+
+exit 0;
+
+sub escape {
+    my $x = shift;
+    $x =~ s/\\/\\\\/gm;
+    $x =~ s/"/\\"/gm;
+    $x =~ s/\n/\\n/gm;
+    $x;
+}
+
+sub recipient {
+    my ($type,$addr) = @_;
+    return <<"EOS"
+        make new $type recipient at end of $type recipients with properties {address: "$addr"}
+EOS
+}
+
+sub usage {
+    my $error = shift;
+    print STDERR "Error: $error\n" if $error;
+    print STDERR <<"EOS";
+usage: $prog [<options>] <recipients>
+    options:
+        -v           be verbose
+        -g           activate Mail.app to approve the message
+        -F <from>    specify the From: address
+        -b <bcc>     specify Bcc: recipients in a comma-separated list
+        -c <cc>      specify Cc: recipients in a comma-separated list
+        -s <subject> specify the message subject
+EOS
+    exit 1;
+}
diff -ruN ccp4-5.99.5-orig/ccp4i/src/local.tcl ccp4-5.99.5/ccp4i/src/local.tcl
--- ccp4-5.99.5-orig/ccp4i/src/local.tcl	2005-11-30 15:21:50.000000000 -0800
+++ ccp4-5.99.5/ccp4i/src/local.tcl	2005-11-30 16:03:56.000000000 -0800
@@ -34,7 +34,7 @@
 #d_arg mail_address Mail addressee
 
 return [expr {1 - [catch \
-   "exec Mail -s \"$subject\" $mail_address < $tmp_file"  ]}]
+   "exec osx_ccp4_mail  -s \"$subject\" $mail_address < $tmp_file"  ]}]
 }
 
 #d_index_title Interaction with Netscape
diff -ruN ccp4-5.99.5-orig/configure ccp4-5.99.5/configure
--- ccp4-5.99.5-orig/configure	2005-11-30 15:22:22.000000000 -0800
+++ ccp4-5.99.5/configure	2005-12-01 05:59:50.000000000 -0800
@@ -52,8 +52,6 @@
 ###
 ### Removing or attempting to bypass this section in the configure script 
 ### is deemed as agreeing to the conditions outlined in $CCP4/conditions.txt
-### unless the --onlylibs flag is passed.
-
 
 agreed=no
 ans=n
@@ -65,20 +63,7 @@
     user=`whoami`
 fi
 
-
-# if --onlylibs has been specified, then set agreed to yes
-# (a bit of a kludge, but it does the job).
-for arg in $*
-do 
-
-    case $arg in
-      -onlylibs | --onlylibs | --onlylib)
-	agreed=yes
-    ;;
-    esac
-done
-
-### has someone else (we know about) agreed to the ccp4 conditions before?
+### has someone else we (know about) agreed to the ccp4 conditions before?
 ### and if so make sure the the home dir has agreement file
 if test -f .agree2ccp4v6; then
    eval touch ${HOME}/.agree2ccp4v6;
@@ -162,7 +147,7 @@
 ### End of licensing section.
 
 usage='echo "Usage: configure [--help] [--srcdir=DIR] [--bindir=DIR]
-       [--libdir=DIR] [--onlylibs] [--tmpdir=DIR] [--with-f2c] [--disable-x]
+       [--libdir=DIR] [--onlylibs] [--tmpdir=DIR] [--with-f2c] [--with-x]
        [--with-shared-libs] [--non_shared] [--with-rxdispencer] [--disable-ccif] 
        [--disable-lapack] [--with-netlib-lapack] [--with-warnings] 
        [--disable-mapslicer] [--disable-fftw] [--with-fftw=DIR] 
@@ -236,9 +221,7 @@
     -onlylibs | --onlylibs | --onlylib | --onlyli | --onlyl | --onlyl | --only | \
       --onl | --on | --o)
       src= ; dotsrc= ; unsupp= ; dotunsupp= ; dotunsuppsrc= ; 
-      disable_mapslicer=yes ; disable_pdb_extract=yes ; disable_x=yes
-      disable_phaser=yes
-      onlylibs=yes ;;
+      disable_mapslicer=yes ; disable_pdb_extract=yes ;;
 
     -tmpdir=* | --tmpdir=* | --tmpdi=* | --tmpd=* | --tmp=* | --tm=* | t=*)
       tmpdir=`echo $arg | sed 's/[-a-z_]*=//'` ;;
@@ -255,6 +238,11 @@
       shared_lib=yes
       ;;
 
+    -with-x | --with-x | --wit-x | --wi-x | \
+      --w-x)
+      with_x=yes
+      ;;
+
     -ww | -w-w | -with-warnings | -with-w | -w-warnings | \
       --ww | --w-w | --with-warnings | --with-w | --w-warnings)
       warnings=yes
@@ -291,11 +279,7 @@
     -disable-pdb_extract | --disable-pdb_extract)
       disable_pdb_extract=yes
       ;;
- 
-    -disable-x | --disable-x)
-      disable_x=yes
-      ;;
- 
+
     -non_shared | --non_shared)
       non_shared=yes
       ;;
@@ -363,22 +347,6 @@
   fi
 done
 
-# Check whether --enable-x or --disable-x was given.
-if test "${enable_x+set}" = set; then
-  enableval="$enable_shared"
-    case $enableval in
-    yes) enable_x=yes ;;
-    no) enable_x=no ;;
-    *) enable_x=yes ;;
-    esac
-else
-  if test "${disable_x+set}" = set ; then
-     enable_x=no
-  else 
-     enable_x=yes
-  fi
-fi;
-
 test -z "$system" && eval $usage || true # system must be defined
 
 case $system in
@@ -395,8 +363,6 @@
 configdir=${PWD}
 test "$tmpdir"  && TMPDIR=${tmpdir}
 
-echo srcdir bindir libdir $srcdir $bindir $libdir 
-
 export libdir RANLIB FC F77 FOPTIM COPTIM XFFLAGS XCFLAGS CC LNS M4 M4FLAGS
 export CXX XCXXFLAGS CXXOPTIM
 export SETFLAGS MAKE F INSTALL_PROGRAM INSTALL_DATA XLDFLAGS TMPDIR
@@ -435,37 +401,18 @@
     exit 1    ;;
 esac
 
-
-# check for onlylibs
-if ! test -z "$onlylibs" ; then
-  echo "! onlylibs build requested"
-  echo "!"
-  echo "! Only the libraries will be configured and built."
-  echo "! Configuration of x-windows programs, phaser and mapslicer"
-  echo "! command library have been implicitly disabled."
-  echo "! (Some messages below regarding re-enabling these options"
-  echo "! are likely to be misleading.)"
-fi
-# check for f2c
 if test -n "$with_f2c"; then
-  echo
   echo "! Using f2c compiler.  (Needs the \`fort77' perl script and f2c later than 19940920.)"
   echo "! Make sure there is no symbolic link from fort77 to g77"
   echo "! \`fort77' comes from, e.g. ftp://sunsite.unc.edu/pub/Linux/devel/lang/fortran"
   echo ""
 elif test "$system" = linux; then
-  echo
   echo "! Using g77 compiler.  If you have an old g77 compiler, you may be better"
   echo "! off using f2c, see --with-f2c option."
 else true
 fi
 # check for xwin stuff
-if test x"$enable_x" = xno; then
-  echo
-  echo "! The x-windows programs will not be installed."
-  echo "! If you want the x-windows programs to be installed re-run"
-  echo "! configure with the --enable-x flag."
-else
+if test -n "$with_x"; then
   echo 
   echo " Will attempt to install the xwindows programs from \`$xwindir'."
   echo " This is not supported for all systems."
@@ -473,7 +420,11 @@
   echo " the xwindows programs will be compiled with an option"
   echo " that means errors are ignored. This could result in some"
   echo " xwindows programs not being compiled." 
-  echo " If you want to disable the xwindows programs use --disable-x"
+else
+  echo 
+  echo "! The x-windows programs will not be installed."
+  echo "! If you want the x-windows programs to be installed re-run"
+  echo "! configure with the --with-x flag." 
 fi
 # check for disabling of ccif
 if test -n "$disable_ccif"; then
@@ -550,20 +501,20 @@
   echo " To disable inclusion of the MapSlicer command library, use the"
   echo " --disable-mapslicer flag"
 fi
-# Check for non_shared option (OSF1/Linux/sunos)
+# Check for non_shared option (OSF1/Linux)
 if test -n "$non_shared"; then
   echo
   echo " You have requested a non-shared build (--non_shared)."
-  # Only available for OSF1 or Linux or sunos
+  # Only available for OSF1 or Linux
   case $system in
-    osf1 | linux | sunos )
+    osf1 | linux )
     if test "$shared_lib" = yes; then
       echo " ***** This option isn't compatible with --with-shared-libs ***** "
       echo " Rerun configure using only one of these options."
       exit 1
     fi
-    echo " Executables will be built using the -non_shared or -static or -Bstatic"
-    echo " compiler flag. This will result in more portable (but much larger)"
+    echo " Executables will be built using the -non_shared or -static compiler"
+    echo " flag. This will result in more portable (but much larger)"
     echo " executables."
     echo "                  ****** WARNING ******"
     echo " Some system libraries may only be available as shared libraries"
@@ -580,8 +531,6 @@
 badvar=0      # set true if any of the checks fail
 
 # fixme: do we need to check BINSORT_MEM?
-# Yes you do.
-if test -z "$onlylibs" ; then 
 for i in BINSORT_SCR CCP4_SCR CINCL CLIBD CCP4_OPEN PUBLIC_FONT84 \
   # BINSORT_MEM
 do
@@ -591,7 +540,6 @@
   else true
   fi
 done
-fi
 
 test $badvar -eq 1 && exit 1 || true
 
@@ -604,45 +552,31 @@
 #     echo "! Beware -- the $system installation isn't properly tested." ; }
 syswarn='echo; echo "! Beware -- the $system installation is not properly tested."'
 
-if test -z "$onlylibs" ; then 
-   for i in CCP4_SCR BINSORT_SCR; do
-     if ( eval test -d \$$i || eval mkdir \$$i ) ; then :
-     else
-       eval echo "! No directory \$$i and can\'t create it."
-       echo "  Check the value of $i."
-       badvar=1
-     fi
-   done
+for i in CCP4_SCR BINSORT_SCR; do
+  if ( eval test -d \$$i || eval mkdir \$$i ) ; then :
+  else
+    eval echo "! No directory \$$i and can\'t create it."
+    echo "  Check the value of $i."
+    badvar=1
+  fi
+done
 
-   for i in libdir bindir; do
-     if ( eval test -d \$$i || eval mkdir \$$i ) ; then :
-     else
-       eval echo "! No directory \$$i and can\'t create it."
-       echo "  Check the argument of --$i."
-       badvar=1
-     fi
-   done
+for i in libdir bindir; do
+  if ( eval test -d \$$i || eval mkdir \$$i ) ; then :
+  else
+    eval echo "! No directory \$$i and can\'t create it."
+    echo "  Check the argument of --$i."
+    badvar=1
+  fi
+done
 
-   for i in $dotsrc $dotunsupp $dotunsuppsrc ./lib ./lib/src ./lib/data ./ccp4i/etc/unix $mosflmdir/lib $mosflmdir/bin $mosflmdir/cbf/lib ; do
-     if test -d $i || mkdir $i; then :
-     else
-       eval echo "! No directory $i and can\'t create it."
-       badvar=1
-     fi
-   done
-else
-   # Kludge to fool the "Makefile" target in the top-level CCP4
-   # Makefile into not trying to remake src/Makefile.in
-   for i in $srcdir/src $srcdir/lib/src ; do
-     if test -d $i || mkdir $i; then
-       if ! test -f $i/Makefile.in ; then
-         echo
-         echo "onlylibs: making dummy file $i/Makefile.in"
-	 touch $i/Makefile.in
-       fi
-     fi
-   done
-fi
+for i in $dotsrc $dotunsupp $dotunsuppsrc ./lib ./lib/src ./lib/data ./ccp4i/etc/unix $mosflmdir/lib $mosflmdir/bin $mosflmdir/cbf/lib ; do
+  if test -d $i || mkdir $i; then :
+  else
+    eval echo "! No directory $i and can\'t create it."
+    badvar=1
+  fi
+done
 
 ### sanity checks
 
@@ -654,17 +588,16 @@
 else true
 fi
 
-if test -z "$onlylibs" ; then 
-    if touch $BINSORT_SCR/binsort$$ ; then
-       rm $BINSORT_SCR/binsort$$
-    else
-       echo "! Can't create $BINSORT_SCR/binsort$$."
-       echo "  Check the value of BINSORT_SCR."
-       badvar=1
-    fi
-    test $badvar -eq 1 && exit 1 || true
+if touch $BINSORT_SCR/binsort$$ ; then
+  rm $BINSORT_SCR/binsort$$
+else
+  echo "! Can't create $BINSORT_SCR/binsort$$."
+  echo "  Check the value of BINSORT_SCR."
+  badvar=1
 fi
 
+test $badvar -eq 1 && exit 1 || true
+
 ### Do specific things for each possible system.  Note we preserve any
 ### supplied values of the variables with the ${...:-...} mechanism.
 
@@ -1137,10 +1070,10 @@
   ;;
 linux_ibm_compilers | linux64_ibm_compilers )       # (tested in Linux PPC SLES9 and 
                 # find a way to get the compiler version)
-#  if test x"$enable_x" = xyes; then
+#  if test -n "$with_x"; then
 #    echo "! Xwindows installation has not been tested    !"
 #    echo "! for this system and so will not be attempted.!"
-#    enable_x=no
+#    with_x=
 #  fi
   case `uname -sm` in
   "Linux ppc64") ;;
@@ -1220,10 +1153,10 @@
           esac;;
       esac
     fi
-    if test x"$enable_x" = xyes; then
+    if test -n "$with_x"; then
       echo "! Xwindows installation has not been tested    !"
       echo "! for this system and so will not be attempted.!"
-      enable_x=no
+      with_x=
     fi
     ;;
   SunOS\ 5*)
@@ -1247,11 +1180,6 @@
       fi
       SHARE_INST='$(INSTALL_DATA) `pwd`/libmmdb.so $(libdir)/libmmdb.so; $(INSTALL_DATA) `pwd`/libccp4c.so $(libdir)/libccp4c.so; $(INSTALL_DATA) `pwd`/libccp4f.so $(libdir)/libccp4f.so'
     fi
-    if test "$non_shared" = yes; then
-      XFFLAGS=${XFFLAGS:-"-Bstatic"}
-      XCFLAGS=${XCFLAGS:-"-Bstatic"}
-      XCXXFLAGS=${XCXXFLAGS:-"-Bstatic"}
-    fi
     FOPTIM=${FOPTIM:-"-O3"}  # -fast is a possibility
     XFFLAGS=${XFFLAGS:-""}  
     XCFLAGS=${XCFLAGS:-""}
@@ -1281,7 +1209,7 @@
       else
         MAPSLICER_SHARE=${MAPSLICER_SHARE:-"ld -dy -G -z allextract -z text libccp4map.a -o libccp4map.so -L/opt/SUNWspro/lib"}
       fi
-    if test x"$enable_x" = xyes; then
+    if test -n "$with_x"; then
       XDL_LIB=${XDL_LIB:-"-L${CCP4_LIB} -lxdl_view"}
       XWIN_LIB=${XWIN_LIB:-"-L/usr/openwin/lib -lXt -lSM -lX11 -lICE"}
     fi
@@ -1300,10 +1228,10 @@
   SETFLAGS=${SETFLAGS:-"amore_FLAGS='$XCFLAGS\ $LDFLAGS\ -O1'"}
   ;;
 hpux)
-  if test x"$enable_x" = xyes; then
+  if test -n "$with_x"; then
     echo "! Xwindows installation has not been tested    !"
     echo "! for this system and so will not be attempted.!"
-    enable_x=no
+    with_x=
   fi
   case `uname -sr` in
   HP-UX\ A.08.*)  # uname -a: HP-UX tcs-hp0 A.08.07 A 9000/750 2002285682
@@ -1658,7 +1586,6 @@
  ;
 }
 _ACEOF
- echo
  test_compile="$CC $XCFLAGS conftest.c -o conftest.o"
  if { (eval echo "testing linux ABI using: \"$CC $XCFLAGS\"")
   (eval $test_compile ) 2>&1
@@ -1677,55 +1604,46 @@
     esac
   fi
   rm -rf conftest*
- 
-  if test "$with_f2c" ; then 
-    M4=${M4:-"m4 -D_f2c=1"}
-    XCFLAGS=${XCFLAGS:-"-DPROTOTYPE"}
-  else
-    case `$CC -dumpversion 2>&1` in
-      4.* )      
-# default to gfortran for the moment
-      case $system in
-        linux64 ) FC=${FC:-"gfortran -m64"} ;;
-        *) FC=${FC:-gfortran} ;;
-        esac
-    esac
-#for non 4.* set g77, etc.
-    case $system in
-      linux64 ) FC=${FC:-"g77 -m64"} ;;
-      *) FC=${FC:-g77} ;;
-      esac
-  fi
   
-  case `$CC -dumpversion 2>&1` in
-    2.96* )
-     if test `rpm -q --qf '%{version}' redhat-release` -eq 7.0  ; then
+  case `$CC -v 2>&1` in
+   *Red\ Hat\ Linux\ 7.0* )
 # This is really on redhat 7.0 with only origional compilers - will work with -O0
-       XFFLAGS=${XFFLAGS:-"-fno-second-underscore -fno-globals -fno-automatic -O0"}
-     else
-       XFFLAGS=${XFFLAGS:-"-fno-second-underscore -fno-globals -fno-automatic"} 
-     fi
-     ;;
-   4.* )
+    XFFLAGS=${XFFLAGS:-"-fno-second-underscore -fno-globals -fno-automatic -O0"} ;;
+   *2.96* )
+    XFFLAGS=${XFFLAGS:-"-fno-second-underscore -fno-globals -fno-automatic"} ;;
+   *gcc\ version\ 4.* )
 # default to gfortran for the moment
-     case $FC in
-       gfortran )
-         XFFLAGS=${XFFLAGS:-"-fno-second-underscore"} 
-         M4=${M4-"m4 -D_gfort=1"}
-         XCFLAGS=${XCFLAGS:-"-DGFORTRAN -DPROTOTYPE"}
-         F_LIBS=${F_LIBS:-"-lgfortran"}
-         SETFLAGS=${SETFLAGS:-"arp_waters_FLAGS='$XFFLAGS $FOPTIM -fforce-mem' " }
-         ;;
-       esac
-     XCFLAGS=${XCFLAGS:-"-DG77 -DPROTOTYPE"}
-     ;;
+    case $system in
+    linux64 )
+      FC=${FC:-"-m64"}
+      ;;
+    *)
+      FC=${FC}
+      ;;
+    esac
+    XFFLAGS=${XFFLAGS:-"-fno-second-underscore"} 
+    M4=${M4-"m4 -D_gfort=1"}
+    XCFLAGS=${XCFLAGS:-"-DGFORTRAN -DPROTOTYPE"}
+    F_LIBS=${F_LIBS}
+    SETFLAGS=${SETFLAGS:-"arp_waters_FLAGS='$XFFLAGS $FOPTIM -fforce-mem' " }
+    ;;
     *) 
      XFFLAGS=${XFFLAGS:-"-fno-second-underscore -fno-globals -fno-automatic"} ;;
   esac
- 
-#default values to catch all 
-  M4=${M4-"m4 -D_g77=1"}
-  XCFLAGS=${XCFLAGS:-"-DG77 -DPROTOTYPE -DHAVE_G2C_H"}
+  
+#for non 4.* set g77, etc.
+  case $system in
+    linux64 )
+      FC=${FC:-"g77 -m64"}
+      ;;
+    *)
+      FC=${FC:-g77}
+      ;;
+    esac
+  test "$with_f2c" && M4=${M4:-"m4 -D_f2c=1"}
+  test "$with_f2c" && XCFLAGS=${XCFLAGS:-"-DPROTOTYPE"}
+  test ! "$with_f2c" && M4=${M4-"m4 -D_g77=1"}
+  test ! "$with_f2c" && XCFLAGS=${XCFLAGS:-"-DG77 -DPROTOTYPE -DHAVE_G2C_H"}
 #Note, space is important, otherwise XCXXFLAGS defaults to XCFLAGS
   XCXXFLAGS=${XCXXFLAGS:-" "}
   F_LIBS=${F_LIBS:-"-lg2c"}
@@ -1755,7 +1673,7 @@
   XDL_LIB=${XDL_LIB:-"-L${CCP4_LIB} -lxdl_view"}
   XWIN_LIB=${XWIN_LIB:-"-L/usr/X11R6/lib -lXt -lSM -lX11 -lICE"}
   XTYPE=${XTYPE:-"LINUX"}
-  CXX_LIBS=${CXX_LIBS:-"-lstdc++"}
+  CXX_LIBS=${CXX_LIBS:-"-L/usr/lib/gcc/darwin/3.3 -L/usr/lib/gcc/darwin/3.3 -L/usr/lib/gcc/darwin/3.3 -lstdc++"}
   XLDFLAGS=${XLDFLAGS:-"-lm"}
   if test "$shared_lib" = yes; then
     SHARE_LIB=${SHARE_LIB:-'ld -shared -soname libmmdb.so --whole-archive -o libmmdb.so libmmdb.a; ld -shared -soname libccp4c.so --whole-archive -o libccp4c.so libccp4c.a; ld -shared -soname libccp4f.so --whole-archive -o libccp4f.so libccp4f.a'}
@@ -1889,30 +1807,27 @@
   ;;
 Darwin)
   CC=${CC:-gcc}
-  CXX=${CXX:-g++}
-  case `$CC -v 2>&1` in
-   *4.* )
+#  CXX=${CXX:-g++}
+  CXX=${CXX:-g++}
+#  case `$CC -v 2>&1` in
+#   *4.* )
 # default to gfortran for the moment
-    FC=${FC:-gfortran} ;;
-   *) FC=${FC:-g77} ;;
-  esac
-  case $FC in
-    *g77* )
-      M4="m4 -D_g77=1"
-      case `$CC -v 2>&1` in
-        *4.* ) XCFLAGS=${XCFLAGS:-"-DPROTOTYPE"} ;;
-        *) XCFLAGS=${XCFLAGS:-"-DG77 -DPROTOTYPE -DHAVE_G2C_H"} ;;
-      esac
-      XFFLAGS=${XFFLAGS:-"-funroll-loops -fno-fast-math -fno-second-underscore -fno-globals -fno-automatic"}
-      F_LIBS=${F_LIBS:-"-lg2c"}
-      ;;
-    *gfortran* )
-       XFFLAGS=${XFFLAGS:-"-fno-second-underscore"}
-       M4=${M4-"m4 -D_gfort=1"}
-       XCFLAGS=${XCFLAGS:-"-DGFORTRAN -DPROTOTYPE"}
-       F_LIBS=${F_LIBS:-"-lgfortran"}
-    ;;
-  esac
+#    FC=${FC:-gfortran}
+#    XFFLAGS=${XFFLAGS:-"-fno-second-underscore"}
+#    M4=${M4-"m4 -D_gfort=1"}
+#    XCFLAGS=${XCFLAGS:-"-DGFORTRAN -DPROTOTYPE"}
+#    F_LIBS=${F_LIBS:-"-lgfortran"}
+#    ;;
+#   *)
+    FC=${FC:-g77}
+    test "$with_f2c" && M4="m4 -D_f2c=1"
+    test "$with_f2c" && XCFLAGS=${XCFLAGS:-"-DPROTOTYPE"}
+    test ! "$with_f2c" && M4="m4 -D_g77=1"
+    test ! "$with_f2c" && XCFLAGS=${XCFLAGS:-"-DG77 -DPROTOTYPE -DHAVE_G2C_H"}
+    XFFLAGS=${XFFLAGS:-"-funroll-loops -fno-fast-math -fno-second-underscore -fno-globals -fno-automatic"}
+    F_LIBS=${F_LIBS:-"-lg2c"}
+#    ;;
+#  esac
   FOPTIM=${FOPTIM:-"-O2"}
   COPTIM=${COPTIM:-"-O2"}
   CXXOPTIM=${CXXOPTIM:-"-O2"}
@@ -1929,13 +1844,13 @@
   XTYPE=${XTYPE:-"LINUX"}
   TIDY=${TIDY:-"rm -f sta*"}
   MAPSLICER_SHARE=${MAPSLICER_SHARE:-""}
-  CXX_LIBS=${CXX_LIBS:-"-lstdc++"}
+  CXX_LIBS=${CXX_LIBS:-"-L/usr/lib/gcc/darwin/3.3 -L/usr/lib/gcc/darwin/3.3 -L/usr/lib/gcc/darwin/3.3 -lstdc++"}
   XLDFLAGS=${XLDFLAGS:-"-lm"}
   XCXXFLAGS=${XCXXFLAGS:-" "}
   XMKMF="IMAKECPP=/usr/bin/cpp xmkmf"
   if test "$shared_lib" = yes; then
     SHARED_LIB_CFLAGS=${SHARED_LIB_CFLAGS:-'-fPIC -fno-common'}
-    SHARE_LIB='${CXX} -dynamiclib -flat_namespace -undefined suppress ${SHARED_LIB_CFLAGS} -install_name libmmdb.dylib -all_load libmmdb.a -o libmmdb.dylib; ${CC} -dynamiclib -flat_namespace -undefined suppress ${SHARED_LIB_CFLAGS} -install_name libccp4c.dylib -all_load libccp4c.a  -o libccp4c.dylib'
+    SHARE_LIB='${CXX} -dynamiclib -flat_namespace -undefined suppress ${SHARED_LIB_CFLAGS} -install_name SW_PREFIX/lib/ccp4-5.99.5/libmmdb.dylib -all_load libmmdb.a -o libmmdb.dylib; ${CC} -dynamiclib -flat_namespace -undefined suppress ${SHARED_LIB_CFLAGS} -install_name SW_PREFIX/lib/ccp4-5.99.5/libccp4c.dylib -all_load libccp4c.a  -o libccp4c.dylib'
     SHARE_INST='${INSTALL_DATA} `pwd`/libmmdb.dylib ${libdir}/libmmdb.dylib; ${INSTALL_DATA} `pwd`/libccp4c.dylib ${libdir}/libccp4c.dylib'
   fi     
 #need -lcc_dynamic to get restFP and saveFP for g77 3.4 under darwin 7
@@ -1958,7 +1873,7 @@
   XCXXFLAGS=${XCXXFLAGS:-"-qarch=auto -qtune=auto -qstrict"}
   F_LIBS=${F_LIBS:-"-lxlf90 -lxlfmath"}
   C_LIBS=${C_LIBS:-"-lc -lgcc"}
-  CXX_LIBS=${CXX_LIBS:-"-libmc++ -lstdc++"}
+  CXX_LIBS=${CXX_LIBS:-"-libmc++ -L/usr/lib/gcc/darwin/3.3 -L/usr/lib/gcc/darwin/3.3 -L/usr/lib/gcc/darwin/3.3 -lstdc++"}
   XLDFLAGS=${XLDFLAGS:-"-lm"}
   FOPTIM=${FOPTIM:-"-O3 -qmaxmem=-1 -qstrict"}
   COPTIM=${COPTIM:-"-O2"}
@@ -1981,7 +1896,7 @@
 #cc_dynamic resolves restFP and saveFP
 #dylib1.o is dyld_stub_binding_helper
 #disable fortran shared library to allow access to common blocks
-    SHARE_LIB='${CXX} -qmkshrobj -flat_namespace -undefined suppress -Wl,-install_name,libmmdb.dylib bfgs_min.o mmdb_chain.o mmdb_manager.o mmdb_symop.o file_.o mmdb_cifdefs.o mmdb_mask.o mmdb_title.o linalg_.o mmdb_coormngr.o mmdb_mmcif.o mmdb_utils.o machine_.o mmdb_cryst.o mmdb_model.o stream_.o mattype_.o mmdb_file.o mmdb_rwbrook.o mmdb_atom.o mmdb_graph.o mmdb_selmngr.o mmdb_align.o mmdb_tables.o math_.o mmdb_sbase.o mmdb_uddata.o mmdb_xml.o mmdb_bondmngr.o mmdb_ficif.o random_n.o -o libmmdb.dylib; ${LD} -dylib -dynamic -flat_namespace -undefined suppress -install_name:libccp4c.dylib -all_load libccp4c.a -o libccp4c.dylib -ldylib1.o;'
+    SHARE_LIB='${CXX} -qmkshrobj -flat_namespace -undefined suppress -Wl,-install_name,SW_PREFIX/lib/ccp4-5.99.5/libmmdb.dylib bfgs_min.o mmdb_chain.o mmdb_manager.o mmdb_symop.o file_.o mmdb_cifdefs.o mmdb_mask.o mmdb_title.o linalg_.o mmdb_coormngr.o mmdb_mmcif.o mmdb_utils.o machine_.o mmdb_cryst.o mmdb_model.o stream_.o mattype_.o mmdb_file.o mmdb_rwbrook.o mmdb_atom.o mmdb_graph.o mmdb_selmngr.o mmdb_align.o mmdb_tables.o math_.o mmdb_sbase.o mmdb_uddata.o mmdb_xml.o mmdb_bondmngr.o mmdb_ficif.o random_n.o -o libmmdb.dylib; ${LD} -dylib -dynamic -flat_namespace -undefined suppress -install_name:SW_PREFIX/lib/ccp4-5.99.5/libccp4c.dylib -all_load libccp4c.a -o libccp4c.dylib -ldylib1.o;'
     SHARE_INST='${INSTALL_DATA} `pwd`/libmmdb.dylib ${libdir}/libmmdb.dylib; ${INSTALL_DATA} `pwd`/libccp4c.dylib ${libdir}/libccp4c.dylib;'
   fi
   LDFLAGS="-lccp4f -lccp4c -lmmdb \$(XCIF_LIB) \$(XLAPACK_LIB) \$(CXX_LIBS) \$(C_LIBS) \$(XLDFLAGS)"
@@ -1991,7 +1906,7 @@
       *Darwin\ 7.* ) 
          XLDFLAGS="$XLDFLAGS -lcc_dynamic"
          if test "$shared_lib" = yes; then
-           SHARE_LIB='${CXX} -qmkshrobj -flat_namespace -undefined suppress -Wl,-install_name,libmmdb.dylib bfgs_min.o mmdb_chain.o mmdb_manager.o mmdb_symop.o file_.o mmdb_cifdefs.o mmdb_mask.o mmdb_title.o linalg_.o mmdb_coormngr.o mmdb_mmcif.o mmdb_utils.o machine_.o mmdb_cryst.o mmdb_model.o stream_.o mattype_.o mmdb_file.o mmdb_rwbrook.o mmdb_atom.o mmdb_graph.o mmdb_selmngr.o mmdb_align.o mmdb_tables.o math_.o mmdb_sbase.o mmdb_uddata.o mmdb_xml.o mmdb_bondmngr.o mmdb_ficif.o random_n.o -o libmmdb.dylib; ${LD} -dylib -dynamic -flat_namespace -undefined suppress -install_name:libccp4c.dylib -all_load libccp4c.a -o libccp4c.dylib -lcc_dynamic -ldylib1.o;'
+           SHARE_LIB='${CXX} -qmkshrobj -flat_namespace -undefined suppress -Wl,-install_name,SW_PREFIX/lib/ccp4-5.99.5/libmmdb.dylib bfgs_min.o mmdb_chain.o mmdb_manager.o mmdb_symop.o file_.o mmdb_cifdefs.o mmdb_mask.o mmdb_title.o linalg_.o mmdb_coormngr.o mmdb_mmcif.o mmdb_utils.o machine_.o mmdb_cryst.o mmdb_model.o stream_.o mattype_.o mmdb_file.o mmdb_rwbrook.o mmdb_atom.o mmdb_graph.o mmdb_selmngr.o mmdb_align.o mmdb_tables.o math_.o mmdb_sbase.o mmdb_uddata.o mmdb_xml.o mmdb_bondmngr.o mmdb_ficif.o random_n.o -o libmmdb.dylib; ${LD} -dylib -dynamic -flat_namespace -undefined suppress -install_name:SW_PREFIX/lib/ccp4-5.99.5/libccp4c.dylib -all_load libccp4c.a -o libccp4c.dylib -lcc_dynamic -ldylib1.o;'
         fi
       ;;
 # With apples move to intel CPUs, xlf and xlc need some help.
@@ -2007,10 +1922,10 @@
     esac
   ;;
 gnu_win32)
-  if test x"$enable_x" = xyes; then
+  if test -n "$with_x"; then
     echo "! Xwindows installation has not been tested    !"
     echo "! for this system and so will not be attempted.!"
-    enable_x=no
+    with_x=
   fi
   case `uname -sr` in
     CYGWIN32_*)
@@ -2084,7 +1999,7 @@
     XDL_LIB=${XDL_LIB:-"-L${CCP4_LIB} -lxdl_view"}
     XWIN_LIB=${XWIN_LIB:-"-L/usr/X11R6/lib -lXt -lSM -lX11 -lICE"}
     XTYPE=${XTYPE:-"LINUX"}
-    XLDFLAGS=${XLDFLAGS:-"-lstdc++ -lg2c -lm"}
+    XLDFLAGS=${XLDFLAGS:-"-L/usr/lib/gcc/darwin/3.3 -L/usr/lib/gcc/darwin/3.3 -L/usr/lib/gcc/darwin/3.3 -lstdc++ -lg2c -lm"}
     if test "$shared_lib" = yes; then
     SHARE_LIB=${SHARE_LIB:-'ld -shared -soname libmmdb.so --whole-archive -o libmmdb.so libmmdb.a; ld -shared -soname libccp4c.so --whole-archive -o libccp4c.so libccp4c.a; ld -shared -soname libccp4f.so --whole-archive -o libccp4f.so libccp4f.a'}
     SHARE_INST='$(INSTALL_DATA) `pwd`/libmmdb.so $(libdir)/libmmdb.so; $(INSTALL_DATA) `pwd`/libccp4c.so $(libdir)/libccp4c.so; $(INSTALL_DATA) `pwd`/libccp4f.so $(libdir)/libccp4f.so; '
@@ -2183,7 +2098,7 @@
 fi
 
 # some setting up for xwindows - or not
-if test x"$enable_x" = xyes; then
+if test "$with_x" = yes; then
     DIRS=". $src $unsupp $xwindir $rotgendir \
            lib/src lib/data"
     /bin/cp $xwindir/XCCPJIFFY/Imakefile $xwindir/XCCPJIFFY/Imakefile.bak
@@ -2598,7 +2513,7 @@
         trylapack=
         tryblas=
 # try the fink installation
-        trydirs="${trydirs} /sw"
+        trydirs="${trydirs} /SW_PREFIX"
         ;;
       Darwin_ibm_compilers )
         # Darwin has libraries with BLAS and LAPACK invoked using
@@ -2650,7 +2565,7 @@
         trylapack=
         tryblas=
 # try the fink installation
-        trydirs="${trydirs} /sw"
+        trydirs="${trydirs} /SW_PREFIX"
         ;;
 #       linux_ia64_sgi_altix)
 # SGI Japan
@@ -2958,24 +2873,10 @@
       cp -f lib/lapack/src/ilaenv-dist.f lib/lapack/src/ilaenv.f
     fi
     # No options for shared libraries yet
-    XFFLAGS_LAPACK=""
     if test "$shared_lib" = yes; then
       echo
       echo "! Sorry... cannot configure make to build shared BLAS or"
       echo "! LAPACK libraries at present"
-      # Check for and remove -fPIC as this may cause problems
-      # for non-shared compilations
-      echo
-      echo "! Removing -fPIC (if present) from compiler flags for LAPACK"
-      for i in ${XFFLAGS}; do
-        if test "$i" = "-fPIC"; then true
-        else
-          XFFLAGS_LAPACK="${XFFLAGS_LAPACK} $i"
-        fi
-      done
-      echo "! XFFLAGS_LAPACK=${XFFLAGS_LAPACK}"
-    else
-      XFFLAGS_LAPACK="${XFFLAGS}"
     fi
     #
     # Create the Makefile header for the LAPACK build
@@ -2993,9 +2894,9 @@
 #
 MAKE     = ${MAKE:-make}
 FORTRAN  = ${FC}
-OPTS     = ${FOPTIM} ${XFFLAGS_LAPACK}
+OPTS     = ${FOPTIM} ${XFFLAGS}
 DRVOPTS  = \$(OPTS)
-NOOPT    = ${NOOPT:--O0 ${XFFLAGS_LAPACK}}
+NOOPT    = ${NOOPT:--O0 ${XFFLAGS}}
 LOADER   = 
 #
 ARCH     = ar
@@ -3298,7 +3199,7 @@
 # platform specific elements
 # initial force static because of allowd compiler options
   if test "$disable_cctbx" != yes ; then
-  cctbxopts=${cctbxopts:-""}
+  cctbxopts=${cctbxopts:-"--static_libraries"}
   case $system in
     *linux*)
       case $CXX in
@@ -3758,10 +3659,7 @@
 
 done
 
-if test x"$enable_x" = xyes; then
-  echo 
-  echo "********* X-WINDOWS CONFIGURATION ***********"
-  echo
+if test "$with_x" = yes; then
 # run configure for xdlview library
   CFLAGS="${COPTIM} ${XCFLAGS}"
   FFLAGS="${FOPTIM} ${XFFLAGS}"
@@ -3772,7 +3670,8 @@
   else
     xopts="--enable-shared=no"
   fi
-  echo "CCP4 configure: Running separate configure for xdlview library."
+  echo
+  echo "Running separate configure for xdlview library."
   echo
   cd x-windows/xdl_view/src
   # It is important for some systems that the files
@@ -3789,8 +3688,6 @@
   echo "configure $xopts --libdir=${libdir}"
   ./configure $xopts --libdir=${libdir} 
   echo
-  echo "CCP4 configure: Running separate configure for libjwc_c library."
-  echo
   cd ${srcdir}/${xwindir}/libjwc/libjwc_c
   echo "Updating modification times for configuration files in libjwc_c"
   echo "Please wait..."
@@ -3799,6 +3696,7 @@
   done
   echo "...done."
   echo
+  echo "Running separate configure for libjwc_c lib"
   echo "configure $xopts --libdir=${libdir}"
   ( touch /tmp/$$.cache_file 2>/dev/null && \
     cat /dev/null > /tmp/$$.cache_file && \
@@ -3806,8 +3704,6 @@
     ./configure $xopts --libdir=${libdir}
   rm -f /tmp/$$.cache_file
   echo
-  echo "CCP4 configure: Running separate configure for libjwc_f library."
-  echo
   cd ${srcdir}/${xwindir}/libjwc/libjwc_f
   # for g77 3.1 some builds do not have no-common for system libs,
   # so disable for now
@@ -3818,6 +3714,7 @@
   done
   echo "...done."
   echo
+  echo "Running separate configure for libjwc_f lib"
   # for g77 3.1 some builds do not have no-common for system libs,
   # so disable for now
   case $system in
@@ -3851,8 +3748,6 @@
   esac
   rm -f /tmp/$$.cache_file
   echo
-  echo "CCP4 configure: Running separate configure for rotgen"
-  echo
   cd ${srcdir}/${rotgendir}
   echo "Updating modification times for configuration files in rotgen"
   echo "Please wait..."
@@ -3861,6 +3756,7 @@
   done
   echo "...done."
   echo
+  echo "Running separate configure for rotgen"
   echo "configure $xopts --with-ccp4-prefix=${libdir} --bindir=${bindir}"
   ( touch /tmp/$$.cache_file 2>/dev/null && \
     cat /dev/null > /tmp/$$.cache_file && \
@@ -3899,17 +3795,14 @@
   fi
   rm -f $$*
   echo
-  echo "CCP4 configure: Running separate configure for Mosflm"
-  echo
   cd ${srcdir}/${mosflmdir}
+  echo "Running separate configure for ipmosflm"
   echo "configure $xopts --libdir=${libdir}"
   ./configure $xopts --libdir=${libdir}
   echo
   cd ../..
   echo "Returning to main configure."
   echo
-  echo "********* X-WINDOWS CONFIGURATION FINISHED ***********"
-  echo
 fi
 
 # fixme: decide whether we should zap any existing libccp4.a
@@ -3922,8 +3815,7 @@
 test "$with_f2c" && opts=$opts" --with-f2c" || true
 test "$shared_lib" = yes && opts="$opts --with-shared-libs" || true
 test "$tmpdir"  && opts="$opts --tmpdir=$tmpdir" || true
-test "$enable_x" = yes && opts="$opts --enable-x" || true
-test "$enable_x" = no && opts="$opts --disable-x" || true
+test "$with_x" = yes && opts="$opts --with-x" || true
 test "$with_rxdispencer" = yes && opts="$opts --with-rxdispencer" || true
 test "$disable_ccif" = yes && opts="$opts --disable-ccif" || true
 test "$disable_cctbx" = yes && opts="$opts --disable-cctbx" || true
@@ -3934,9 +3826,6 @@
 test "$enable_clipper" = yes && opts="$opts --enable-clipper" || true
 test "$enable_ssm" = yes && opts="$opts --enable-ssm" || true
 test "$enable_fftw" = yes && opts="$opts --enable-fftw" || true
-test "$enable_clipper" = no && opts="$opts --disable-clipper" || true
-test "$enable_ssm" = no && opts="$opts --disable-ssm" || true
-test "$enable_fftw" = no && opts="$opts --disable-fftw" || true
 test "${with_fftw:+set}" = set && opts="$opts --with-fftw=${prefix_fftw}" || true
 test "$warnings" = yes && opts="$opts --with-warnings" || true
 test "$non_shared" = yes && opts="$opts --non_shared" || true
diff -ruN ccp4-5.99.5-orig/etc/xloggraph ccp4-5.99.5/etc/xloggraph
--- ccp4-5.99.5-orig/etc/xloggraph	1969-12-31 16:00:00.000000000 -0800
+++ ccp4-5.99.5/etc/xloggraph	2005-11-30 15:58:16.000000000 -0800
@@ -0,0 +1,6 @@
+#!/bin/zsh
+export XUSERFILESEARCHPATH=$CLIB/X11/app-defaults/XCCPJiffy
+xloggraph.exe "$@" &
+export XUSERFILESEARCHPATH=""
+print "Plot button sends pdf to Preview.  Print or save pdf in Preview window."
+exit 0
diff -ruN ccp4-5.99.5-orig/etc/xplot84 ccp4-5.99.5/etc/xplot84
--- ccp4-5.99.5-orig/etc/xplot84	1969-12-31 16:00:00.000000000 -0800
+++ ccp4-5.99.5/etc/xplot84	2005-11-30 15:58:30.000000000 -0800
@@ -0,0 +1,6 @@
+#!/bin/zsh
+export XUSERFILESEARCHPATH=$CLIB/X11/app-defaults/XCCPJiffy
+xplot84driver.exe "$@" &
+export XUSERFILESEARCHPATH=""
+print "Plot button sends pdf to Preview.  Print or save pdf in Preview window."
+exit 0
diff -ruN ccp4-5.99.5-orig/etc/xplot84driver ccp4-5.99.5/etc/xplot84driver
--- ccp4-5.99.5-orig/etc/xplot84driver	1969-12-31 16:00:00.000000000 -0800
+++ ccp4-5.99.5/etc/xplot84driver	2005-11-30 15:58:30.000000000 -0800
@@ -0,0 +1,6 @@
+#!/bin/zsh
+export XUSERFILESEARCHPATH=$CLIB/X11/app-defaults/XCCPJiffy
+xplot84driver.exe "$@" &
+export XUSERFILESEARCHPATH=""
+print "Plot button sends pdf to Preview.  Print or save pdf in Preview window."
+exit 0
diff -ruN ccp4-5.99.5-orig/include/ccp4.setup-bash ccp4-5.99.5/include/ccp4.setup-bash
--- ccp4-5.99.5-orig/include/ccp4.setup-bash	2005-11-30 15:22:15.000000000 -0800
+++ ccp4-5.99.5/include/ccp4.setup-bash	2005-12-01 15:57:56.000000000 -0800
@@ -3,7 +3,7 @@
 # Actually, the aliases can't work asis in ksh.  Should use builtins instead
 # and not worry about ease of keeping in step with the csh one.
 
-# $Id: ccp4.setup-bash,v 1.71 2005/11/21 13:41:54 mdw Exp $
+# $Id: ccp4.setup-bash,v 1.67 2005/09/22 08:40:51 mdw Exp $
 
 # This file is site specific and may also contain machine-specifics.  The CCP4
 # administrator will have to edit this file and then have anyone who wants to
@@ -360,14 +360,3 @@
 
   unset alias  # clean up
 fi             # ksh test
-
-# Set-up cctbx environment
-test -r $CCP4/lib/cctbx/cctbx_build/setpaths.sh && . $CCP4/lib/cctbx/cctbx_build/setpaths.sh
-
-# Set-up phaser environment
-if ( test -d $CCP4/src/phaser) ; then
-  phaser_mtype=`$CCP4/src/phaser/bin/machine_type`
-  phaser_version=`grep PHASER_VERSION $CCP4/src/phaser/conf/version | awk '{print $3}'`
-  phaser_setup_file="${CCP4}/src/phaser/phaser-${phaser_version}/build/${phaser_mtype}/setpaths.sh"
-  test -r $phaser_setup_file && . $phaser_setup_file
-fi
diff -ruN ccp4-5.99.5-orig/include/ccp4.setup-dist ccp4-5.99.5/include/ccp4.setup-dist
--- ccp4-5.99.5-orig/include/ccp4.setup-dist	2005-11-30 15:22:15.000000000 -0800
+++ ccp4-5.99.5/include/ccp4.setup-dist	2005-12-01 16:01:54.000000000 -0800
@@ -1,7 +1,7 @@
 #!/bin/csh
 # CCP4 setup file for C-shell (or tcsh) users.  -*- shell-script -*-
 
-# $Id: ccp4.setup-dist,v 1.83 2005/11/25 14:47:04 mdw Exp $
+# $Id: ccp4.setup-dist,v 1.77 2005/09/22 08:40:52 mdw Exp $
 
 # This file is site specific and may also contain machine-specifics.  The CCP4
 # administrator will have to edit this file and then have anyone who wants to
@@ -107,7 +107,7 @@
     setenv CBIN      $CCP4/bin		
     setenv CLIB      $CCP4/lib	
 
-    setenv CCP4_BROWSER  netscape             
+    setenv CCP4_BROWSER  open            
 
     if (${?MANPATH}) then
       if ($ccp4_first_in_path) then
@@ -181,52 +181,6 @@
 #
 #  setenv BINSORT_MEM     8388608
 
-# LD_LIBRARY_PATH specifies where to find dynamic libraries (e.g. libccp4.so)
-# at runtime
-if (${?LD_LIBRARY_PATH}) then
-  if ($ccp4_first_in_path) then
-    setenv LD_LIBRARY_PATH ${CLIB}:${LD_LIBRARY_PATH}
-  else
-    setenv LD_LIBRARY_PATH ${LD_LIBRARY_PATH}:${CLIB}
-  endif
-else
-  setenv LD_LIBRARY_PATH ${CLIB}
-endif
-
-# DYLD_LIBRARY_PATH specifies where to find dynamic libraries (e.g. libccp4.dylib)
-# at runtime (used on Mac OS X)
-if (${?DYLD_LIBRARY_PATH}) then
-  if ($ccp4_first_in_path) then
-    setenv DYLD_LIBRARY_PATH ${CLIB}:${DYLD_LIBRARY_PATH}
-  else
-    setenv DYLD_LIBRARY_PATH ${DYLD_LIBRARY_PATH}:${CLIB}
-  endif
-else
-  setenv DYLD_LIBRARY_PATH ${CLIB}
-endif
-
-### XAPPLRESDIR ###
-
-# If you want to use xloggraph/xplot84driver, you need to get the application
-# defaults picked up somehow.  As distributed, the file can't just live in an
-# application defaults directory since it requires reading by xrdb to sort out
-# the differences for monochrome displays.  At Daresbury a version of the file
-# assuming a monochrome display is kept in the directory
-# $CCP4_LIB/X11/app-defaults and this is picked up through the
-# XUSERFILESEARCHPATH environment variable.  That means you only see black and
-# white on a colour display.  Alternatively you might make sure that it is
-# read by xrdb on startup of the X Windows system or delegate the
-# responsibility to users to run it.  There are disadvantages to putting an
-# invocation of xrdb in here, one being that the correct value of DISPLAY may
-# not be set at the time this file is read.  Thus edit this part as
-# appropriate.  (SunOS will normally want to use /usr/openwin or $OPENWINHOME
-# instead of /usr; others may want /usr/local/lib or somw such):
-if ($?XUSERFILESEARCHPATH) then
-  setenv XUSERFILESEARCHPATH $CCP4_LIB/X11/app-defaults/%N:$XUSERFILESEARCHPATH
-else
-  setenv XUSERFILESEARCHPATH $CCP4_LIB/X11/app-defaults/%N:/usr/lib/X11/app-defaults
-endif
-
 ### TRAPPFE ###
 # TRAPFPE is set to ensure (in collaboration with -lfpe) an abort on floating
 # point exceptions under IRIX.  It shouldn't cause harm on other systems, but
@@ -348,14 +302,3 @@
   alias lgnoms 'pushd $CCP4_MASTER/laue/gnom/src>/dev/null'
   alias lbin   'pushd $CBIN>/dev/null'
 #
-
-# Set-up cctbx environment
-if (-e $CCP4/lib/cctbx/cctbx_build/setpaths.csh) source $CCP4/lib/cctbx/cctbx_build/setpaths.csh
-
-# Set-up phaser environment
-if (-d $CCP4/src/phaser) then
-  set phaser_mtype = `$CCP4/src/phaser/bin/machine_type`
-  set phaser_version = `grep PHASER_VERSION $CCP4/src/phaser/conf/version | awk '{print $3}'`
-  set phaser_setup_file = "${CCP4}/src/phaser/phaser-${phaser_version}/build/${phaser_mtype}/setpaths.csh"
-  if (-e $phaser_setup_file) source $phaser_setup_file
-endif
diff -ruN ccp4-5.99.5-orig/include/ccp4.setup-sh ccp4-5.99.5/include/ccp4.setup-sh
--- ccp4-5.99.5-orig/include/ccp4.setup-sh	2005-11-30 15:22:15.000000000 -0800
+++ ccp4-5.99.5/include/ccp4.setup-sh	2005-12-01 16:01:23.000000000 -0800
@@ -5,7 +5,7 @@
 # can't work asis in ksh.  Should use builtins instead and not worry about
 # ease of keeping in step with the csh one.
 
-# $Id: ccp4.setup-sh,v 1.11 2005/11/21 13:41:55 mdw Exp $
+# $Id: ccp4.setup-sh,v 1.7 2005/09/09 13:52:45 pjx Exp $
 
 # This file is site specific and may also contain machine-specifics.  The CCP4
 # administrator will have to edit this file and then have anyone who wants to
@@ -91,7 +91,8 @@
     export CBIN=$CCP4/bin		
     export CLIB=$CCP4/lib	
 
-    export CCP4_BROWSER=safari             
+    CCP4_BROWSER=""
+    export CCP4_BROWSER="open"            
     export MANPATH=$CCP4/man:$MANPATH           # edit this if necessary
     export MCTYPE=unix 			# (only for Laue)
 #     ;;
@@ -133,40 +134,6 @@
 #
 #  export BINSORT_MEM=8388608
 
-# LD_LIBRARY_PATH specifies where to find dynamic libraries (e.g. libccp4.so)
-# at runtime
-if test "LD_LIBRARY_PATH"; then
-  export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:$CLIB
-else
-  export LD_LIBRARY_PATH=$CLIB
-fi
-# DYLD_LIBRARY_PATH specifies where to find dynamic libraries
-# (e.g. libccp4.dylib) at runtime
-if test "DYLD_LIBRARY_PATH"; then
-  export DYLD_LIBRARY_PATH=$DYLD_LIBRARY_PATH:$CLIB
-else
-  export DYLD_LIBRARY_PATH=$CLIB
-fi
-
-### XAPPLRESDIR ###
-
-# If you want to use xloggraph/xplot84driver, you need to get the application
-# defaults picked up somehow.  As distributed, the file can't just live in an
-# application defaults directory since it requires reading by xrdb to sort out
-# the differences for monochrome displays.  At Daresbury a version of the file
-# assuming a monochrome display is kept in the directory
-# $CCP4_LIB/X11/app-defaults and this is picked up through the
-# XUSERFILESEARCHPATH environment variable.  That means you only see black and
-# white on a colour display.  Alternatively you might make sure that it is
-# read by xrdb on startup of the X Windows system or delegate the
-# responsibility to users to run it.  There are disadvantages to putting an
-# invocation of xrdb in here, one being that the correct value of DISPLAY may
-# not be set at the time this file is read.  Thus edit this part as
-# appropriate.  (SunOS will normally want to use /usr/openwin or $OPENWINHOME
-# instead of /usr; others may want /usr/local/lib or somw such):
-
-export XAPPLRESDIR=/sw/etc/app-defaults/
-
 ### TRAPPFE ###
 # TRAPFPE is set to ensure (in collaboration with -lfpe) an abort on floating
 # point exceptions under IRIX.  It shouldn't cause harm on other systems, but
@@ -280,14 +247,3 @@
   alias lgnom='pushd $CCP4_MASTER/laue/gnom>/dev/null'
   alias lgnoms='pushd $CCP4_MASTER/laue/gnom/src>/dev/null'
   alias lbin='pushd $CBIN>/dev/null'
-
-# Set-up cctbx environment
-test -r $CCP4/lib/cctbx/cctbx_build/setpaths.sh && . $CCP4/lib/cctbx/cctbx_build/setpaths.sh
-
-# Set-up phaser environment
-if ( test -d $CCP4/src/phaser) ; then
-  phaser_mtype=`$CCP4/src/phaser/bin/machine_type`
-  phaser_version=`grep PHASER_VERSION $CCP4/src/phaser/conf/version | awk '{print $3}'`
-  phaser_setup_file="${CCP4}/src/phaser/phaser-${phaser_version}/build/${phaser_mtype}/setpaths.sh"
-  test -r $phaser_setup_file && . $phaser_setup_file
-fi
diff -ruN ccp4-5.99.5-orig/include/ccp4.setup-zsh ccp4-5.99.5/include/ccp4.setup-zsh
--- ccp4-5.99.5-orig/include/ccp4.setup-zsh	2005-11-30 15:22:15.000000000 -0800
+++ ccp4-5.99.5/include/ccp4.setup-zsh	2005-12-01 16:00:13.000000000 -0800
@@ -18,7 +18,7 @@
 
 # Also contains a few zsh-specific functions and command-completions
 
-# $Id: ccp4.setup-zsh,v 1.11 2005/11/21 13:41:55 mdw Exp $
+# $Id: ccp4.setup-zsh,v 1.7 2005/09/22 08:40:52 mdw Exp $
 
 # This file is site specific and may also contain machine-specifics.  The CCP4
 # administrator will have to edit this file and then have anyone who wants to
@@ -122,6 +122,7 @@
 
     
     if [[ $(uname) = Darwin ]]; then
+        CCP4_BROWSER=""
         export CCP4_BROWSER=open            # open in OS X default browser
     elif [[ $(uname) = Linux ]];then
         export  CCP4_BROWSER=konqueror 
@@ -175,66 +176,6 @@
 #  export BINSORT_MEM=8388608
 
 
-# If installed via fink, skip this bit:
-
-if [[ -z $SWPREFIX ]];then
-  if [[ -d /sw/bin/fink-virtual-pkgs ]];then
-    SWPREFIX=$(dirname $(dirname $(which /sw/bin/fink-virtual-pkgs)))
-  fi
-fi
-
-if [[ -z $SWPREFIX || $CCP4_MASTER != $SWPREFIX/share/xtal ]];then 
-    
-    # LD_LIBRARY_PATH specifies where to find dynamic libraries (e.g. libccp4.so)
-    # at runtime
-    
-    if test "$LD_LIBRARY_PATH"; then
-      if [[ $ccp4_first_in_path == 1 ]]; then
-        export LD_LIBRARY_PATH=$CLIB:$LD_LIBRARY_PATH
-      else
-        export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:$CLIB
-      fi
-    else
-      export LD_LIBRARY_PATH=$CLIB
-    fi
-    # DYLD_LIBRARY_PATH specifies where to find dynamic libraries
-    # (e.g. libccp4.dylib) at runtime
-    if test "$DYLD_LIBRARY_PATH"; then
-      if [[ $ccp4_first_in_path == 1 ]]; then
-        export DYLD_LIBRARY_PATH=$CLIB:$DYLD_LIBRARY_PATH
-      else
-        export DYLD_LIBRARY_PATH=$DYLD_LIBRARY_PATH:$CLIB
-      fi
-    else
-      export DYLD_LIBRARY_PATH=$CLIB
-    fi
-    
-    ### XAPPLRESDIR ###
-    
-    # If you want to use xloggraph/xplot84driver, you need to get the application
-    # defaults picked up somehow.  As distributed, the file can't just live in an
-    # application defaults directory since it requires reading by xrdb to sort out
-    # the differences for monochrome displays.  At Daresbury a version of the file
-    # assuming a monochrome display is kept in the directory
-    # $CCP4_LIB/X11/app-defaults and this is picked up through the
-    # XUSERFILESEARCHPATH environment variable.  That means you only see black and
-    # white on a colour display.  Alternatively you might make sure that it is
-    # read by xrdb on startup of the X Windows system or delegate the
-    # responsibility to users to run it.  There are disadvantages to putting an
-    # invocation of xrdb in here, one being that the correct value of DISPLAY may
-    # not be set at the time this file is read.  Thus edit this part as
-    # appropriate.  (SunOS will normally want to use /usr/openwin or $OPENWINHOME
-    # instead of /usr; others may want /usr/local/lib or somw such):
-
-    if [[ -n "$XUSERFILESEARCHPATH" ]]; then
-        XUSERFILESEARCHPATH=$CCP4_LIB/X11/app-defaults/%N:$XUSERFILESEARCHPATH
-    else
-        XUSERFILESEARCHPATH=$CCP4_LIB/X11/app-defaults/%N:/usr/lib/X11/app-defaults
-    fi
-
-    export XUSERFILESEARCHPATH
-    
-fi
 
 ### TRAPPFE ###
 # TRAPFPE is set to ensure (in collaboration with -lfpe) an abort on floating
@@ -383,16 +324,6 @@
     typeset -U manpath
     typeset -U classpath
      
-# Set-up cctbx environment
-test -r $CCP4/lib/cctbx/cctbx_build/setpaths.sh && . $CCP4/lib/cctbx/cctbx_build/setpaths.sh
  
-# Set-up phaser environment
-if ( test -d $CCP4/src/phaser) ; then
-  phaser_mtype=`$CCP4/src/phaser/bin/machine_type`
-  phaser_version=`grep PHASER_VERSION $CCP4/src/phaser/conf/version | awk '{print $3}'`
-  phaser_setup_file="${CCP4}/src/phaser/phaser-${phaser_version}/build/${phaser_mtype}/setpaths.sh"
-  test -r $phaser_setup_file && . $phaser_setup_file
-fi
-
 
 
diff -ruN ccp4-5.99.5-orig/lib/ccif/configure ccp4-5.99.5/lib/ccif/configure
--- ccp4-5.99.5-orig/lib/ccif/configure	2005-11-30 15:22:13.000000000 -0800
+++ ccp4-5.99.5/lib/ccif/configure	2005-11-30 21:16:17.000000000 -0800
@@ -1892,7 +1892,7 @@
          fi
          SHARED_LIB_CMD='$(CC) $(SHARED_LIB_CFLAGS) -dynamiclib -flat_namespace \\\
                                -undefined suppress -install_name \\\
-                                $(SHARED_LIB_NAME) \\\
+                               SW_PREFIX/lib/ccp4-5.99.5/$(SHARED_LIB_NAME) \\\
                                -all_load $L \\\
                                -o $(SHARED_LIB_NAME)'
          SHARED_LIB_EXPORTS_CMD=''
diff -ruN ccp4-5.99.5-orig/lib/ccif/g2c.h ccp4-5.99.5/lib/ccif/g2c.h
--- ccp4-5.99.5-orig/lib/ccif/g2c.h	1969-12-31 16:00:00.000000000 -0800
+++ ccp4-5.99.5/lib/ccif/g2c.h	2005-11-30 16:27:18.000000000 -0800
@@ -0,0 +1,385 @@
+/* f2c.h  --  Standard Fortran to C header file */
+
+/**  barf  [ba:rf]  2.  "He suggested using FORTRAN, and everybody barfed."
+
+	- From The Shogakukan DICTIONARY OF NEW ENGLISH (Second edition) */
+
+#ifndef F2C_INCLUDE
+#define F2C_INCLUDE
+
+typedef long int integer;
+typedef unsigned long int uinteger;
+typedef char *address;
+typedef short int shortint;
+typedef float real;
+typedef double doublereal;
+typedef struct { real r, i; } complex;
+typedef struct { doublereal r, i; } doublecomplex;
+typedef long int logical;
+typedef short int shortlogical;
+typedef char logical1;
+typedef char integer1;
+#ifdef INTEGER_STAR_8	/* Adjust for integer*8. */
+typedef long long longint;		/* system-dependent */
+typedef unsigned long long ulongint;	/* system-dependent */
+#define qbit_clear(a,b)	((a) & ~((ulongint)1 << (b)))
+#define qbit_set(a,b)	((a) |  ((ulongint)1 << (b)))
+#endif
+
+#define TRUE_ (1)
+#define FALSE_ (0)
+
+/* Extern is for use with -E */
+#ifndef Extern
+#define Extern extern
+#endif
+
+/* I/O stuff */
+
+#ifdef f2c_i2
+/* for -i2 */
+typedef short flag;
+typedef short ftnlen;
+typedef short ftnint;
+#else
+typedef long int flag;
+typedef long int ftnlen;
+typedef long int ftnint;
+#endif
+
+/*external read, write*/
+typedef struct
+{	flag cierr;
+	ftnint ciunit;
+	flag ciend;
+	char *cifmt;
+	ftnint cirec;
+} cilist;
+
+/*internal read, write*/
+typedef struct
+{	flag icierr;
+	char *iciunit;
+	flag iciend;
+	char *icifmt;
+	ftnint icirlen;
+	ftnint icirnum;
+} icilist;
+
+/*open*/
+typedef struct
+{	flag oerr;
+	ftnint ounit;
+	char *ofnm;
+	ftnlen ofnmlen;
+	char *osta;
+	char *oacc;
+	char *ofm;
+	ftnint orl;
+	char *oblnk;
+} olist;
+
+/*close*/
+typedef struct
+{	flag cerr;
+	ftnint cunit;
+	char *csta;
+} cllist;
+
+/*rewind, backspace, endfile*/
+typedef struct
+{	flag aerr;
+	ftnint aunit;
+} alist;
+
+/* inquire */
+typedef struct
+{	flag inerr;
+	ftnint inunit;
+	char *infile;
+	ftnlen infilen;
+	ftnint	*inex;	/*parameters in standard's order*/
+	ftnint	*inopen;
+	ftnint	*innum;
+	ftnint	*innamed;
+	char	*inname;
+	ftnlen	innamlen;
+	char	*inacc;
+	ftnlen	inacclen;
+	char	*inseq;
+	ftnlen	inseqlen;
+	char 	*indir;
+	ftnlen	indirlen;
+	char	*infmt;
+	ftnlen	infmtlen;
+	char	*inform;
+	ftnint	informlen;
+	char	*inunf;
+	ftnlen	inunflen;
+	ftnint	*inrecl;
+	ftnint	*innrec;
+	char	*inblank;
+	ftnlen	inblanklen;
+} inlist;
+
+#define VOID void
+
+union Multitype {	/* for multiple entry points */
+	integer1 g;
+	shortint h;
+	integer i;
+	/* longint j; */
+	real r;
+	doublereal d;
+	complex c;
+	doublecomplex z;
+	};
+
+typedef union Multitype Multitype;
+
+/*typedef long int Long;*/	/* No longer used; formerly in Namelist */
+
+struct Vardesc {	/* for Namelist */
+	char *name;
+	char *addr;
+	ftnlen *dims;
+	int  type;
+	};
+typedef struct Vardesc Vardesc;
+
+struct Namelist {
+	char *name;
+	Vardesc **vars;
+	int nvars;
+	};
+typedef struct Namelist Namelist;
+
+#define abs(x) ((x) >= 0 ? (x) : -(x))
+#define dabs(x) (doublereal)abs(x)
+#define min(a,b) ((a) <= (b) ? (a) : (b))
+#define max(a,b) ((a) >= (b) ? (a) : (b))
+#define dmin(a,b) (doublereal)min(a,b)
+#define dmax(a,b) (doublereal)max(a,b)
+#define bit_test(a,b)	((a) >> (b) & 1)
+#define bit_clear(a,b)	((a) & ~((uinteger)1 << (b)))
+#define bit_set(a,b)	((a) |  ((uinteger)1 << (b)))
+
+/* procedure parameter types for -A and -C++ */
+
+#define F2C_proc_par_types 1
+#ifdef __cplusplus
+typedef int /* Unknown procedure type */ (*U_fp)(...);
+typedef shortint (*J_fp)(...);
+typedef integer (*I_fp)(...);
+typedef real (*R_fp)(...);
+typedef doublereal (*D_fp)(...), (*E_fp)(...);
+typedef /* Complex */ VOID (*C_fp)(...);
+typedef /* Double Complex */ VOID (*Z_fp)(...);
+typedef logical (*L_fp)(...);
+typedef shortlogical (*K_fp)(...);
+typedef /* Character */ VOID (*H_fp)(...);
+typedef /* Subroutine */ int (*S_fp)(...);
+#else
+typedef int /* Unknown procedure type */ (*U_fp)();
+typedef shortint (*J_fp)();
+typedef integer (*I_fp)();
+typedef real (*R_fp)();
+typedef doublereal (*D_fp)(), (*E_fp)();
+typedef /* Complex */ VOID (*C_fp)();
+typedef /* Double Complex */ VOID (*Z_fp)();
+typedef logical (*L_fp)();
+typedef shortlogical (*K_fp)();
+typedef /* Character */ VOID (*H_fp)();
+typedef /* Subroutine */ int (*S_fp)();
+#endif
+/* E_fp is for real functions when -R is not specified */
+typedef VOID C_f;	/* complex function */
+typedef VOID H_f;	/* character function */
+typedef VOID Z_f;	/* double complex function */
+typedef doublereal E_f;	/* real function with -R not specified */
+
+/* undef any lower-case symbols that your C compiler predefines, e.g.: */
+
+#ifndef Skip_f2c_Undefs
+#undef cray
+#undef gcos
+#undef mc68010
+#undef mc68020
+#undef mips
+#undef pdp11
+#undef sgi
+#undef sparc
+#undef sun
+#undef sun2
+#undef sun3
+#undef sun4
+#undef u370
+#undef u3b
+#undef u3b2
+#undef u3b5
+#undef unix
+#undef vax
+#endif
+#endif
+/* If you are using a C++ compiler, append the following to f2c.h
+   for compiling libF77 and libI77. */
+
+#ifdef __cplusplus
+extern "C" {
+extern int abort_(void);
+extern double c_abs(complex *);
+extern void c_cos(complex *, complex *);
+extern void c_div(complex *, complex *, complex *);
+extern void c_exp(complex *, complex *);
+extern void c_log(complex *, complex *);
+extern void c_sin(complex *, complex *);
+extern void c_sqrt(complex *, complex *);
+extern double d_abs(double *);
+extern double d_acos(double *);
+extern double d_asin(double *);
+extern double d_atan(double *);
+extern double d_atn2(double *, double *);
+extern void d_cnjg(doublecomplex *, doublecomplex *);
+extern double d_cos(double *);
+extern double d_cosh(double *);
+extern double d_dim(double *, double *);
+extern double d_exp(double *);
+extern double d_imag(doublecomplex *);
+extern double d_int(double *);
+extern double d_lg10(double *);
+extern double d_log(double *);
+extern double d_mod(double *, double *);
+extern double d_nint(double *);
+extern double d_prod(float *, float *);
+extern double d_sign(double *, double *);
+extern double d_sin(double *);
+extern double d_sinh(double *);
+extern double d_sqrt(double *);
+extern double d_tan(double *);
+extern double d_tanh(double *);
+extern double derf_(double *);
+extern double derfc_(double *);
+extern integer do_fio(ftnint *, char *, ftnlen);
+extern integer do_lio(ftnint *, ftnint *, char *, ftnlen);
+extern integer do_uio(ftnint *, char *, ftnlen);
+extern integer e_rdfe(void);
+extern integer e_rdue(void);
+extern integer e_rsfe(void);
+extern integer e_rsfi(void);
+extern integer e_rsle(void);
+extern integer e_rsli(void);
+extern integer e_rsue(void);
+extern integer e_wdfe(void);
+extern integer e_wdue(void);
+extern integer e_wsfe(void);
+extern integer e_wsfi(void);
+extern integer e_wsle(void);
+extern integer e_wsli(void);
+extern integer e_wsue(void);
+extern int ef1asc_(ftnint *, ftnlen *, ftnint *, ftnlen *);
+extern integer ef1cmc_(ftnint *, ftnlen *, ftnint *, ftnlen *);
+extern double erf(double);
+extern double erf_(float *);
+extern double erfc(double);
+extern double erfc_(float *);
+extern integer f_back(alist *);
+extern integer f_clos(cllist *);
+extern integer f_end(alist *);
+extern void f_exit(void);
+extern integer f_inqu(inlist *);
+extern integer f_open(olist *);
+extern integer f_rew(alist *);
+extern int flush_(void);
+extern void getarg_(integer *, char *, ftnlen);
+extern void getenv_(char *, char *, ftnlen, ftnlen);
+extern short h_abs(short *);
+extern short h_dim(short *, short *);
+extern short h_dnnt(double *);
+extern short h_indx(char *, char *, ftnlen, ftnlen);
+extern short h_len(char *, ftnlen);
+extern short h_mod(short *, short *);
+extern short h_nint(float *);
+extern short h_sign(short *, short *);
+extern short hl_ge(char *, char *, ftnlen, ftnlen);
+extern short hl_gt(char *, char *, ftnlen, ftnlen);
+extern short hl_le(char *, char *, ftnlen, ftnlen);
+extern short hl_lt(char *, char *, ftnlen, ftnlen);
+extern integer i_abs(integer *);
+extern integer i_dim(integer *, integer *);
+extern integer i_dnnt(double *);
+extern integer i_indx(char *, char *, ftnlen, ftnlen);
+extern integer i_len(char *, ftnlen);
+extern integer i_mod(integer *, integer *);
+extern integer i_nint(float *);
+extern integer i_sign(integer *, integer *);
+extern integer iargc_(void);
+extern ftnlen l_ge(char *, char *, ftnlen, ftnlen);
+extern ftnlen l_gt(char *, char *, ftnlen, ftnlen);
+extern ftnlen l_le(char *, char *, ftnlen, ftnlen);
+extern ftnlen l_lt(char *, char *, ftnlen, ftnlen);
+extern void pow_ci(complex *, complex *, integer *);
+extern double pow_dd(double *, double *);
+extern double pow_di(double *, integer *);
+extern short pow_hh(short *, shortint *);
+extern integer pow_ii(integer *, integer *);
+extern double pow_ri(float *, integer *);
+extern void pow_zi(doublecomplex *, doublecomplex *, integer *);
+extern void pow_zz(doublecomplex *, doublecomplex *, doublecomplex *);
+extern double r_abs(float *);
+extern double r_acos(float *);
+extern double r_asin(float *);
+extern double r_atan(float *);
+extern double r_atn2(float *, float *);
+extern void r_cnjg(complex *, complex *);
+extern double r_cos(float *);
+extern double r_cosh(float *);
+extern double r_dim(float *, float *);
+extern double r_exp(float *);
+extern double r_imag(complex *);
+extern double r_int(float *);
+extern double r_lg10(float *);
+extern double r_log(float *);
+extern double r_mod(float *, float *);
+extern double r_nint(float *);
+extern double r_sign(float *, float *);
+extern double r_sin(float *);
+extern double r_sinh(float *);
+extern double r_sqrt(float *);
+extern double r_tan(float *);
+extern double r_tanh(float *);
+extern void s_cat(char *, char **, integer *, integer *, ftnlen);
+extern integer s_cmp(char *, char *, ftnlen, ftnlen);
+extern void s_copy(char *, char *, ftnlen, ftnlen);
+extern int s_paus(char *, ftnlen);
+extern integer s_rdfe(cilist *);
+extern integer s_rdue(cilist *);
+extern integer s_rnge(char *, integer, char *, integer);
+extern integer s_rsfe(cilist *);
+extern integer s_rsfi(icilist *);
+extern integer s_rsle(cilist *);
+extern integer s_rsli(icilist *);
+extern integer s_rsne(cilist *);
+extern integer s_rsni(icilist *);
+extern integer s_rsue(cilist *);
+extern int s_stop(char *, ftnlen);
+extern integer s_wdfe(cilist *);
+extern integer s_wdue(cilist *);
+extern integer s_wsfe(cilist *);
+extern integer s_wsfi(icilist *);
+extern integer s_wsle(cilist *);
+extern integer s_wsli(icilist *);
+extern integer s_wsne(cilist *);
+extern integer s_wsni(icilist *);
+extern integer s_wsue(cilist *);
+extern void sig_die(char *, int);
+extern integer signal_(integer *, void (*)(int));
+extern integer system_(char *, ftnlen);
+extern double z_abs(doublecomplex *);
+extern void z_cos(doublecomplex *, doublecomplex *);
+extern void z_div(doublecomplex *, doublecomplex *, doublecomplex *);
+extern void z_exp(doublecomplex *, doublecomplex *);
+extern void z_log(doublecomplex *, doublecomplex *);
+extern void z_sin(doublecomplex *, doublecomplex *);
+extern void z_sqrt(doublecomplex *, doublecomplex *);
+	}
+#endif
diff -ruN ccp4-5.99.5-orig/lib/cctbx/ccp4_build ccp4-5.99.5/lib/cctbx/ccp4_build
--- ccp4-5.99.5-orig/lib/cctbx/ccp4_build	2005-11-30 15:22:09.000000000 -0800
+++ ccp4-5.99.5/lib/cctbx/ccp4_build	2005-11-30 16:31:07.000000000 -0800
@@ -39,7 +39,9 @@
 cd cctbx_build
 
 echo "Running libtbx/configure.py"
-python ../cctbx_sources/libtbx/configure.py $cctbxopts ccp4io=${CCP4} mmtbx
+# python ../cctbx_sources/libtbx/configure.py $cctbxopts ccp4io=${CCP4} mmtbx
+/System/Library/Frameworks/Python.framework/Versions/Current/bin/python  \ 
+            ../cctbx_sources/libtbx/configure.py $cctbxopts ccp4io=${CCP4} mmtbx
 
 echo "Running setpaths.sh"
 . ./setpaths.sh
diff -ruN ccp4-5.99.5-orig/lib/cctbx/cctbx_install_script.csh ccp4-5.99.5/lib/cctbx/cctbx_install_script.csh
--- ccp4-5.99.5-orig/lib/cctbx/cctbx_install_script.csh	2005-11-30 15:22:09.000000000 -0800
+++ ccp4-5.99.5/lib/cctbx/cctbx_install_script.csh	2005-12-01 06:11:13.000000000 -0800
@@ -29,7 +29,7 @@
 set build_mode=release
 
 if ("`uname`" == "Darwin") then
-  set python_exe="/Library/Frameworks/Python.framework/Versions/2.3/bin/python"
+  set python_exe="/System/Library/Frameworks/Python.framework/Versions/Current/bin/python"
   if (! -x "$python_exe") then
     set python_exe="/System$python_exe"
   endif
diff -ruN ccp4-5.99.5-orig/lib/cctbx/cctbx_sources/boost_adaptbx/SConscript ccp4-5.99.5/lib/cctbx/cctbx_sources/boost_adaptbx/SConscript
--- ccp4-5.99.5-orig/lib/cctbx/cctbx_sources/boost_adaptbx/SConscript	2005-11-30 15:21:54.000000000 -0800
+++ ccp4-5.99.5/lib/cctbx/cctbx_sources/boost_adaptbx/SConscript	2005-12-01 10:06:13.000000000 -0800
@@ -73,11 +73,11 @@
   if (env_etc.compiler == "darwin_c++"):
     env.Replace(SHLINK="libtbx.mac_os_x_ld_bpl_dll")
     env.Prepend(SHLINKFLAGS=[
-      "c++", "-F"+env_etc.darwin_framework_path(), "-framework", "Python"])
+      "c++",  "-framework", "Python"])
   elif (env_etc.compiler == "darwin_gcc"):
     env.Replace(SHLINK="libtbx.mac_os_x_ld_bpl_dll")
     env.Prepend(SHLINKFLAGS=[
-      "g++", "-F"+env_etc.darwin_framework_path(), "-framework", "Python"])
+      "g++", "-framework", "Python"])
 
   jamfile_path = libtbx.env.under_dist("boost", "libs/python/build/Jamfile")
   jamfile_all =   open(str(jamfile_path), "r").read()
diff -ruN ccp4-5.99.5-orig/lib/cctbx/cctbx_sources/ccp4io/lib/data/symop.lib ccp4-5.99.5/lib/cctbx/cctbx_sources/ccp4io/lib/data/symop.lib
--- ccp4-5.99.5-orig/lib/cctbx/cctbx_sources/ccp4io/lib/data/symop.lib	1969-12-31 16:00:00.000000000 -0800
+++ ccp4-5.99.5/lib/cctbx/cctbx_sources/ccp4io/lib/data/symop.lib	2005-11-30 17:40:04.000000000 -0800
@@ -0,0 +1,4910 @@
+1 1 1 P1 PG1 TRICLINIC 'P 1'
+ X,Y,Z
+2 2 2 P-1 PG1bar TRICLINIC 'P -1'
+ X,Y,Z
+ -X,-Y,-Z
+3 2 2 P2 PG2 MONOCLINIC 'P 1 2 1' 
+ X,Y,Z
+ -X,Y,-Z
+4 2 2 P21 PG2 MONOCLINIC 'P 1 21 1'
+ X,Y,Z
+ -X,Y+1/2,-Z
+5 4 2 C2 PG2 MONOCLINIC 'C 1 2 1' 
+  X,Y, Z 
+ -X,Y,-Z 
+ 1/2+X,1/2+Y,Z 
+ 1/2-X,1/2+Y,-Z
+6 2 2 Pm PGm MONOCLINIC 'P 1 m 1' 
+ X, Y,Z 
+ X,-Y,Z
+7 2 2 Pc PGm MONOCLINIC 'P 1 c 1' 
+ X,Y,Z
+ X,-Y,1/2+Z
+8 4 2 Cm PGm MONOCLINIC 'C 1 m 1' 
+ X,Y,Z
+ X,-Y,Z
+ 1/2+X,1/2+Y,Z
+ 1/2+X,1/2-Y,Z
+9 4 2 Cc PGm MONOCLINIC 'C 1 c 1'
+ X,Y,Z
+ X,-Y,1/2+Z
+ 1/2+X,1/2+Y,Z
+ 1/2+X,1/2-Y,1/2+Z
+10 4 4 P2/m PG2/m MONOCLINIC 'P 1 2/m 1' 
+ X,Y,Z
+ X,-Y,Z
+ -X,Y,-Z
+ -X,-Y,-Z
+11 4 4 P21/m PG2/m MONOCLINIC 'P 1 21/m 1' 
+ X,Y,Z
+ -X,1/2+Y,-Z
+ -X,-Y,-Z
+ X,1/2-Y,Z
+12 8 4 C2/m PG2/m MONOCLINIC 'C 1 2/m 1' 
+ X,Y,Z
+ X,-Y,Z
+ -X,Y,-Z
+ -X,-Y,-Z
+ 1/2+X,1/2+Y,Z
+ 1/2+X,1/2-Y,Z
+ 1/2-X,1/2+Y,-Z
+ 1/2-X,1/2-Y,-Z
+13 4 4 P2/c PG2/m MONOCLINIC 'P 1 2/c 1'
+ X,Y,Z
+ -X,Y,1/2-Z
+ -X,-Y,-Z
+ X,-Y,1/2+Z
+14 4 4 P21/c PG2/m MONOCLINIC 'P 1 21/c 1' 
+ X,Y,Z
+ -X,-Y,-Z
+ -X,1/2+Y,1/2-Z
+ X,1/2-Y,1/2+Z
+15 8 4 C2/c PG2/m MONOCLINIC 'C 1 2/c 1' 
+ X,Y,Z
+ -X,Y,1/2-Z
+ -X,-Y,-Z
+ X,-Y,1/2+Z
+ 1/2+X,1/2+Y,Z
+ 1/2-X,1/2+Y,1/2-Z
+ 1/2-X,1/2-Y,-Z
+ 1/2+X,1/2-Y,1/2+Z
+16 4 4 P222 PG222 ORTHORHOMBIC 'P 2 2 2' 
+ X,Y,Z 
+ -X,-Y,Z
+ -X,Y,-Z
+ X,-Y,-Z
+17 4 4 P2221 PG222 ORTHORHOMBIC 'P 2 2 21' 
+ X,Y,Z
+ -X,-Y,1/2+Z
+ -X,Y,1/2-Z
+ X,-Y,-Z
+18 4 4 P21212 PG222 ORTHORHOMBIC 'P 21 21 2' 
+ X,Y,Z
+ -X,-Y,Z
+ 1/2-X,1/2+Y,-Z
+ 1/2+X,1/2-Y,-Z
+19 4 4 P212121 PG222 ORTHORHOMBIC 'P 21 21 21' 
+ X,Y,Z
+ 1/2-X,-Y,1/2+Z
+ -X,1/2+Y,1/2-Z
+ 1/2+X,1/2-Y,-Z
+20 8 4 C2221 PG222 ORTHORHOMBIC 'C 2 2 21' 
+ X,Y,Z
+ -X,-Y,1/2+Z
+ -X,Y,1/2-Z
+ X,-Y,-Z
+ 1/2+X,1/2+Y,Z
+ 1/2-X,1/2-Y,1/2+Z
+ 1/2-X,1/2+Y,1/2-Z
+ 1/2+X,1/2-Y,-Z
+21 8 4 C222 PG222 ORTHORHOMBIC 'C 2 2 2' 
+  X, Y,Z
+ -X,-Y,Z
+ -X, Y,-Z
+  X,-Y,-Z
+ 1/2+X,1/2+Y,Z
+ 1/2-X,1/2-Y,Z
+ 1/2-X,1/2+Y,-Z
+ 1/2+X,1/2-Y,-Z
+22 16 4 F222 PG222 ORTHORHOMBIC 'F 2 2 2' 
+ X,Y,Z
+ -X,-Y,Z
+ -X,Y,-Z
+ X,-Y,-Z
+ X,1/2+Y,1/2+Z
+ -X,1/2-Y,1/2+Z
+ -X,1/2+Y,1/2-Z
+ X,1/2-Y,1/2-Z
+ 1/2+X,Y,1/2+Z
+ 1/2-X,-Y,1/2+Z
+ 1/2-X,Y,1/2-Z
+ 1/2+X,-Y,1/2-Z
+ 1/2+X,1/2+Y,Z
+ 1/2-X,1/2-Y,Z
+ 1/2-X,1/2+Y,-Z
+ 1/2+X,1/2-Y,-Z
+23 8 4 I222 PG222 ORTHORHOMBIC 'I 2 2 2' 
+ X,Y,Z
+ -X,-Y,Z
+ X,-Y,-Z
+ -X,Y,-Z
+ X+1/2,Y+1/2,Z+1/2
+ -X+1/2,-Y+1/2,Z+1/2
+ X+1/2,-Y+1/2,-Z+1/2
+ -X+1/2,Y+1/2,-Z+1/2
+24 8 4 I212121 PG222 ORTHORHOMBIC 'I 21 21 21'
+ X,Y,Z
+ 1/2-X,-Y,1/2+Z
+ -X,1/2+Y,1/2-Z
+ 1/2+X,1/2-Y,-Z
+ 1/2+X,1/2+Y,1/2+Z
+ -X,1/2-Y,Z
+ 1/2-X,Y,-Z
+ X,-Y,1/2-Z
+25 4 4 Pmm2 PGmm2 ORTHORHOMBIC 'P m m 2'
+ X,Y,Z
+ -X,-Y,Z
+ X,-Y,Z
+ -X,Y,Z
+26 4 4 Pmc21 PGmm2 ORTHORHOMBIC 'P m c 21'
+ X,Y,Z
+ -X,-Y,1/2+Z
+ X,-Y,1/2+Z
+ -X,Y,Z
+27 4 4 Pcc2 PGmm2 ORTHORHOMBIC 'P c c 2'
+  X, Y,Z
+ -X,-Y,Z
+  X,-Y,1/2+Z
+ -X, Y,1/2+Z
+28 4 4 Pma2 PGmm2 ORTHORHOMBIC 'P m a 2'
+ X,Y,Z
+ -X,-Y,Z
+ 1/2+X,-Y,Z
+ 1/2-X,Y,Z
+29 4 4 Pca21 PGmm2 ORTHORHOMBIC 'P c a 21'
+ X,Y,Z
+ -X,-Y,1/2+Z
+ 1/2+X,-Y,Z
+ 1/2-X,Y,1/2+Z
+30 4 4 Pnc2 PGmm2 ORTHORHOMBIC 'P n c 2'
+ X,Y,Z
+ -X,-Y,Z
+ X,1/2-Y,1/2+Z
+ -X,1/2+Y,1/2+Z
+31 4 4 Pmn21 PGmm2 ORTHORHOMBIC 'P m n 21'
+ X,Y,Z
+ 1/2-X,-Y,1/2+Z
+ 1/2+X,-Y,1/2+Z
+ -X,Y,Z
+32 4 4 Pba2 PGmm2 ORTHORHOMBIC 'P b a 2'
+ X,Y,Z
+ -X,-Y,Z
+ 1/2+X,1/2-Y,Z
+ 1/2-X,1/2+Y,Z
+33 4 4 Pna21 PGmm2 ORTHORHOMBIC 'P n a 21'
+ X,Y,Z
+ -X,-Y,1/2+Z
+ 1/2+X,1/2-Y,Z
+ 1/2-X,1/2+Y,1/2+Z
+34 4 4 Pnn2 PGmm2 ORTHORHOMBIC 'P n n 2'
+ X,Y,Z
+ -X,-Y,Z
+ 1/2+X,1/2-Y,1/2+Z
+ 1/2-X,1/2+Y,1/2+Z
+35 8 4 Cmm2 PGmm2 ORTHORHOMBIC 'C m m 2'
+ X,Y,Z
+ -X,-Y,Z
+ X,-Y,Z
+ -X,Y,Z
+ 1/2+X,1/2+Y,Z
+ 1/2-X,1/2-Y,Z
+ 1/2+X,1/2-Y,Z
+ 1/2-X,1/2+Y,Z
+36 8 4 Cmc21 PGmm2 ORTHORHOMBIC 'C m c 21'
+ X,Y,Z
+ -X,-Y,1/2+Z
+ X,-Y,1/2+Z
+ -X,Y,Z
+ 1/2+X,1/2+Y,Z
+ 1/2-X,1/2-Y,1/2+Z
+ 1/2+X,1/2-Y,1/2+Z
+ 1/2-X,1/2+Y,Z
+37 8 4 Ccc2 PGmm2 ORTHORHOMBIC 'C c c 2'
+ X,Y,Z
+ -X,-Y,Z
+ X,-Y,1/2+Z
+ -X,Y,1/2+Z
+ 1/2+X,1/2+Y,Z
+ 1/2-X,1/2-Y,Z
+ 1/2+X,1/2-Y,1/2+Z
+ 1/2-X,1/2+Y,1/2+Z
+38 8 4 Amm2 PGmm2 ORTHORHOMBIC 'A m m 2'
+ X,Y,Z
+ -X,-Y,Z
+ X,-Y,Z
+ -X,Y,Z
+ X,1/2+Y,1/2+Z
+ -X,1/2-Y,1/2+Z
+ X,1/2-Y,1/2+Z
+ -X,1/2+Y,1/2+Z
+39 8 4 Abm2 PGmm2 ORTHORHOMBIC 'A b m 2'
+ X,Y,Z
+ -X,-Y,Z
+ X,1/2-Y,Z
+ -X,1/2+Y,Z
+ X,1/2+Y,1/2+Z
+ -X,1/2-Y,1/2+Z
+ X,-Y,1/2+Z
+ -X,Y,1/2+Z
+40 8 4 Ama2 PGmm2 ORTHORHOMBIC 'A m a 2'
+ X,Y,Z
+ -X,-Y,Z
+ 1/2+X,-Y,Z
+ 1/2-X,Y,Z
+ X,1/2+Y,1/2+Z
+ -X,1/2-Y,1/2+Z
+ 1/2+X,1/2-Y,1/2+Z
+ 1/2-X,1/2+Y,1/2+Z
+41 8 4 Aba2 PGmm2 ORTHORHOMBIC 'A b a 2'
+ X,Y,Z
+ -X,-Y,Z
+ 1/2+X,1/2-Y,Z
+ 1/2-X,1/2+Y,Z
+ X,1/2+Y,1/2+Z
+ -X,1/2-Y,1/2+Z
+ 1/2+X,-Y,1/2+Z
+ 1/2-X,Y,1/2+Z
+42 16 4 Fmm2 PGmm2 ORTHORHOMBIC 'F m m 2'
+ X,Y,Z
+ -X,-Y,Z
+ X,-Y,Z
+ -X,Y,Z
+ X,1/2+Y,1/2+Z
+ -X,1/2-Y,1/2+Z
+ X,1/2-Y,1/2+Z
+ -X,1/2+Y,1/2+Z
+ 1/2+X,Y,1/2+Z
+ 1/2-X,-Y,1/2+Z
+ 1/2+X,-Y,1/2+Z
+ 1/2-X,Y,1/2+Z
+ 1/2+X,1/2+Y,Z
+ 1/2-X,1/2-Y,Z
+ 1/2+X,1/2-Y,Z
+ 1/2-X,1/2+Y,Z
+43 16 4 Fdd2 PGmm2 ORTHORHOMBIC 'F d d 2'
+ X,Y,Z
+ -X,-Y,Z
+ 1/4+X,1/4-Y,1/4+Z
+ 1/4-X,1/4+Y,1/4+Z
+ X,1/2+Y,1/2+Z
+ -X,1/2-Y,1/2+Z
+ 1/4+X,3/4-Y,3/4+Z
+ 1/4-X,3/4+Y,3/4+Z
+ 1/2+X,Y,1/2+Z
+ 1/2-X,-Y,1/2+Z
+ 3/4+X,1/4-Y,3/4+Z
+ 3/4-X,1/4+Y,3/4+Z
+ 1/2+X,1/2+Y,Z
+ 1/2-X,1/2-Y,Z
+ 3/4+X,3/4-Y,1/4+Z
+ 3/4-X,3/4+Y,1/4+Z
+44 8 4 Imm2 PGmm2 ORTHORHOMBIC 'I m m 2'
+ X,Y,Z
+ -X,-Y,Z
+ X,-Y,Z
+ -X,Y,Z
+ 1/2+X,1/2+Y,1/2+Z
+ 1/2-X,1/2-Y,1/2+Z
+ 1/2+X,1/2-Y,1/2+Z
+ 1/2-X,1/2+Y,1/2+Z
+45 8 4 Iba2 PGmm2 ORTHORHOMBIC 'I b a 2'
+ X,Y,Z
+ -X,-Y,Z
+ 1/2+X,1/2-Y,Z
+ 1/2-X,1/2+Y,Z
+ 1/2+X,1/2+Y,1/2+Z
+ 1/2-X,1/2-Y,1/2+Z
+ X,-Y,1/2+Z
+ -X,Y,1/2+Z
+46 8 4 Ima2 PGmm2 ORTHORHOMBIC 'I m a 2'
+ X,Y,Z
+ -X,-Y,Z
+ 1/2+X,-Y,Z
+ 1/2-X,Y,Z
+ 1/2+X,1/2+Y,1/2+Z
+ 1/2-X,1/2-Y,1/2+Z
+ X,1/2-Y,1/2+Z
+ -X,1/2+Y,1/2+Z
+47 8 8 Pmmm PGmmm ORTHORHOMBIC 'P 2/m 2/m 2/m' 'P m m m'
+ X,Y,Z
+ -X,-Y,Z
+ -X,Y,-Z
+ X,-Y,-Z
+ -X,-Y,-Z
+ X,Y,-Z
+ X,-Y,Z
+ -X,Y,Z
+48 8 8 Pnnn PGmmm ORTHORHOMBIC 'P 2/n 2/n 2/n'  'P n n n'
+ X,Y,Z
+ -X,-Y,Z
+ -X,Y,-Z
+ X,-Y,-Z
+ 1/2-X,1/2-Y,1/2-Z
+ 1/2+X,1/2+Y,1/2-Z
+ 1/2+X,1/2-Y,1/2+Z
+ 1/2-X,1/2+Y,1/2+Z
+49 8 8 Pccm PGmmm ORTHORHOMBIC 'P 2/c 2/c 2/m' 'P c c m'
+ X,Y,Z
+ -X,-Y,Z
+ -X,Y,1/2-Z
+ X,-Y,1/2-Z
+ -X,-Y,-Z
+ X,Y,-Z
+ X,-Y,1/2+Z
+ -X,Y,1/2+Z
+50 8 8 Pban PGmmm ORTHORHOMBIC 'P 2/b 2/a 2/n' 'P b a n'
+ X,Y,Z
+ -X,-Y,Z
+ -X,Y,-Z
+ X,-Y,-Z
+ 1/2-X,1/2-Y,-Z
+ 1/2+X,1/2+Y,-Z
+ 1/2+X,1/2-Y,Z
+ 1/2-X,1/2+Y,Z
+51 8 8 Pmma PGmmm ORTHORHOMBIC 'P 21/m 2/m 2/a'  'P m m a'
+ X,Y,Z
+ 1/2-X,-Y,Z
+ -X,Y,-Z
+ 1/2+X,-Y,-Z
+ -X,-Y,-Z
+ 1/2+X,Y,-Z
+ X,-Y,Z
+ 1/2-X,Y,Z
+52 8 8 Pnna PGmmm ORTHORHOMBIC 'P 2/n 21/n 2/a'  'P n n a'
+ X,Y,Z
+ 1/2-X,-Y,Z
+ 1/2-X,1/2+Y,1/2-Z
+ X,1/2-Y,1/2-Z
+ -X,-Y,-Z
+ 1/2+X,Y,-Z
+ 1/2+X,1/2-Y,1/2+Z
+ -X,1/2+Y,1/2+Z
+53 8 8 Pmna PGmmm ORTHORHOMBIC 'P 2/m 2/n 21/a' 'P m n a'
+ X,Y,Z
+ 1/2-X,-Y,1/2+Z
+ 1/2-X,Y,1/2-Z
+ X,-Y,-Z
+ -X,-Y,-Z
+ 1/2+X,Y,1/2-Z
+ 1/2+X,-Y,1/2+Z
+ -X,Y,Z
+54 8 8 Pcca PGmmm ORTHORHOMBIC 'P 21/c 2/c 2/a' 'P c c a'
+ X,Y,Z
+ 1/2-X,-Y,Z
+ -X,Y,1/2-Z
+ 1/2+X,-Y,1/2-Z
+ -X,-Y,-Z
+ 1/2+X,Y,-Z
+ X,-Y,1/2+Z
+ 1/2-X,Y,1/2+Z
+55 8 8 Pbam PGmmm ORTHORHOMBIC 'P 21/b 21/a 2/m' 'P b a m'
+ X,Y,Z
+ -X,-Y,Z
+ 1/2-X,1/2+Y,-Z
+ 1/2+X,1/2-Y,-Z
+ -X,-Y,-Z
+ X,Y,-Z
+ 1/2+X,1/2-Y,Z
+ 1/2-X,1/2+Y,Z
+56 8 8 Pccn PGmmm ORTHORHOMBIC 'P 21/c 21/c 2/n' 'P c c n'
+ X,Y,Z
+ 1/2-X,1/2-Y,Z
+ -X,1/2+Y,1/2-Z
+ 1/2+X,-Y,1/2-Z
+ -X,-Y,-Z
+ 1/2+X,1/2+Y,-Z
+ X,1/2-Y,1/2+Z
+ 1/2-X,Y,1/2+Z
+57 8 8 Pbcm PGmmm ORTHORHOMBIC 'P 2/b 21/c 21/m' 'P b c m'
+ X,Y,Z
+ -X,-Y,1/2+Z
+ -X,1/2+Y,1/2-Z
+ X,1/2-Y,-Z
+ -X,-Y,-Z
+ X,Y,1/2-Z
+ X,1/2-Y,1/2+Z
+ -X,1/2+Y,Z
+58 8 8 Pnnm PGmmm ORTHORHOMBIC 'P 21/n 21/n 2/m' 'P n n m'
+ X,Y,Z
+ -X,-Y,Z
+ 1/2-X,1/2+Y,1/2-Z
+ 1/2+X,1/2-Y,1/2-Z
+ -X,-Y,-Z
+ X,Y,-Z
+ 1/2+X,1/2-Y,1/2+Z
+ 1/2-X,1/2+Y,1/2+Z
+59 8 8 Pmmn PGmmm ORTHORHOMBIC 'P 21/m 21/m 2/n' 'P m m n'
+ X,Y,Z
+ -X,-Y,Z
+ 1/2-X,Y+1/2,-Z
+ X+1/2,1/2-Y,-Z
+ 1/2-X,1/2-Y,-Z
+ X+1/2,Y+1/2,-Z
+ X,-Y,Z
+ -X,Y,Z
+60 8 8 Pbcn PGmmm ORTHORHOMBIC 'P 21/b 2/c 21/n' 'P b c n'
+ X,Y,Z
+ 1/2-X,1/2-Y,1/2+Z
+ -X,Y,1/2-Z
+ 1/2+X,1/2-Y,-Z
+ -X,-Y,-Z
+ 1/2+X,1/2+Y,1/2-Z
+ X,-Y,1/2+Z
+ 1/2-X,1/2+Y,Z
+61 8 8 Pbca PGmmm ORTHORHOMBIC 'P 21/b 21/c 21/a' 'P b c a'
+ X,Y,Z
+ 1/2-X,-Y,1/2+Z
+ -X,1/2+Y,1/2-Z
+ 1/2+X,1/2-Y,-Z
+ -X,-Y,-Z
+ 1/2+X,Y,1/2-Z
+ X,1/2-Y,1/2+Z
+ 1/2-X,1/2+Y,Z
+62 8 8 Pnma PGmmm ORTHORHOMBIC 'P 21/n 21/m 21/a' 'P n m a'
+ X,Y,Z
+ -X+1/2,-Y,Z+1/2
+ -X,Y+1/2,-Z
+ X+1/2,-Y+1/2,-Z+1/2
+ -X,-Y,-Z
+ X+1/2,Y,-Z+1/2
+ X,-Y+1/2,Z
+ -X+1/2,Y+1/2,Z+1/2
+63 16 8 Cmcm PGmmm ORTHORHOMBIC 'C 2/m 2/c 21/m' 'C m c m'
+ X,Y,Z
+ -X,-Y,1/2+Z
+ -X,Y,1/2-Z
+ X,-Y,-Z
+ -X,-Y,-Z
+ X,Y,1/2-Z
+ X,-Y,1/2+Z
+ -X,Y,Z
+ 1/2+X,1/2+Y,Z
+ 1/2-X,1/2-Y,1/2+Z
+ 1/2-X,1/2+Y,1/2-Z
+ 1/2+X,1/2-Y,-Z
+ 1/2-X,1/2-Y,-Z
+ 1/2+X,1/2+Y,1/2-Z
+ 1/2+X,1/2-Y,1/2+Z
+ 1/2-X,1/2+Y,Z
+64 16 8 Cmca PGmmm ORTHORHOMBIC 'C 2/m 2/c 21/a' 'C m c a'
+ X,Y,Z
+ -X,1/2-Y,1/2+Z
+ -X,1/2+Y,1/2-Z
+ X,-Y,-Z
+ -X,-Y,-Z
+ X,1/2+Y,1/2-Z
+ X,1/2-Y,1/2+Z
+ -X,Y,Z
+ 1/2+X,1/2+Y,Z
+ 1/2-X,-Y,1/2+Z
+ 1/2-X,Y,1/2-Z
+ 1/2+X,1/2-Y,-Z
+ 1/2-X,1/2-Y,-Z
+ 1/2+X,Y,1/2-Z
+ 1/2+X,-Y,1/2+Z
+ 1/2-X,1/2+Y,Z
+65 16 8 Cmmm PGmmm ORTHORHOMBIC 'C 2/m 2/m 2/m'  'C m m m'
+ X,Y,Z
+ -X,-Y,Z
+ -X,Y,-Z
+ X,-Y,-Z
+ -X,-Y,-Z
+ X,Y,-Z
+ X,-Y,Z
+ -X,Y,Z
+ 1/2+X,1/2+Y,Z
+ 1/2-X,1/2-Y,Z
+ 1/2-X,1/2+Y,-Z
+ 1/2+X,1/2-Y,-Z
+ 1/2-X,1/2-Y,-Z
+ 1/2+X,1/2+Y,-Z
+ 1/2+X,1/2-Y,Z
+ 1/2-X,1/2+Y,Z
+66 16 8 Cccm PGmmm ORTHORHOMBIC 'C 2/c 2/c 2/m'  'C c c m'
+ X,Y,Z
+ -X,-Y,Z
+ -X,Y,1/2-Z
+ X,-Y,1/2-Z
+ -X,-Y,-Z
+ X,Y,-Z
+ X,-Y,1/2+Z
+ -X,Y,1/2+Z
+ 1/2+X,1/2+Y,Z
+ 1/2-X,1/2-Y,Z
+ 1/2-X,1/2+Y,1/2-Z
+ 1/2+X,1/2-Y,1/2-Z
+ 1/2-X,1/2-Y,-Z
+ 1/2+X,1/2+Y,-Z
+ 1/2+X,1/2-Y,1/2+Z
+ 1/2-X,1/2+Y,1/2+Z
+67 16 8 Cmma PGmmm ORTHORHOMBIC 'C 2/m 2/m 2/a' 'C m m a'
+ X,Y,Z
+ -X,1/2-Y,Z
+ -X,1/2+Y,-Z
+ X,-Y,-Z
+ -X,-Y,-Z
+ X,1/2+Y,-Z
+ X,1/2-Y,Z
+ -X,Y,Z
+ 1/2+X,1/2+Y,Z
+ 1/2-X,-Y,Z
+ 1/2-X,Y,-Z
+ 1/2+X,1/2-Y,-Z
+ 1/2-X,1/2-Y,-Z
+ 1/2+X,Y,-Z
+ 1/2+X,-Y,Z
+ 1/2-X,1/2+Y,Z
+68 16 8 Ccca PGmmm ORTHORHOMBIC 'C 2/c 2/c 2/a' 'C c c a'
+ X,Y,Z
+ 1/2-X,1/2-Y,Z
+ -X,Y,-Z
+ 1/2+X,1/2-Y,-Z
+ -X,1/2-Y,1/2-Z
+ 1/2+X,Y,1/2-Z
+ X,1/2-Y,1/2+Z
+ 1/2-X,Y,1/2+Z
+ 1/2+X,1/2+Y,Z
+ -X,-Y,Z
+ 1/2-X,1/2+Y,-Z
+ X,-Y,-Z
+ 1/2-X,-Y,1/2-Z
+ X,1/2+Y,1/2-Z
+ 1/2+X,-Y,1/2+Z
+ -X,1/2+Y,1/2+Z
+69 32 8 Fmmm PGmmm ORTHORHOMBIC 'F 2/m 2/m 2/m' 'F m m m'
+ X,Y,Z
+ -X,-Y,Z
+ -X,Y,-Z
+ X,-Y,-Z
+ -X,-Y,-Z
+ X,Y,-Z
+ X,-Y,Z
+ -X,Y,Z
+ X,1/2+Y,1/2+Z
+ -X,1/2-Y,1/2+Z
+ -X,1/2+Y,1/2-Z
+ X,1/2-Y,1/2-Z
+ -X,1/2-Y,1/2-Z
+ X,1/2+Y,1/2-Z
+ X,1/2-Y,1/2+Z
+ -X,1/2+Y,1/2+Z
+ 1/2+X,Y,1/2+Z
+ 1/2-X,-Y,1/2+Z
+ 1/2-X,Y,1/2-Z
+ 1/2+X,-Y,1/2-Z
+ 1/2-X,-Y,1/2-Z
+ 1/2+X,Y,1/2-Z
+ 1/2+X,-Y,1/2+Z
+ 1/2-X,Y,1/2+Z
+ 1/2+X,1/2+Y,Z
+ 1/2-X,1/2-Y,Z
+ 1/2-X,1/2+Y,-Z
+ 1/2+X,1/2-Y,-Z
+ 1/2-X,1/2-Y,-Z
+ 1/2+X,1/2+Y,-Z
+ 1/2+X,1/2-Y,Z
+ 1/2-X,1/2+Y,Z
+70 32 8 Fddd PGmmm ORTHORHOMBIC 'F 2/d 2/d 2/d' 'F d d d'
+ X,Y,Z
+ -X,-Y,Z
+ -X,Y,-Z
+ X,-Y,-Z
+ 1/4-X,1/4-Y,1/4-Z
+ 1/4+X,1/4+Y,1/4-Z
+ 1/4+X,1/4-Y,1/4+Z
+ 1/4-X,1/4+Y,1/4+Z
+ X,1/2+Y,1/2+Z
+ -X,1/2-Y,1/2+Z
+ -X,1/2+Y,1/2-Z
+ X,1/2-Y,1/2-Z
+ 1/4-X,3/4-Y,3/4-Z
+ 1/4+X,3/4+Y,3/4-Z
+ 1/4+X,3/4-Y,3/4+Z
+ 1/4-X,3/4+Y,3/4+Z
+ 1/2+X,Y,1/2+Z
+ 1/2-X,-Y,1/2+Z
+ 1/2-X,Y,1/2-Z
+ 1/2+X,-Y,1/2-Z
+ 3/4-X,1/4-Y,3/4-Z
+ 3/4+X,1/4+Y,3/4-Z
+ 3/4+X,1/4-Y,3/4+Z
+ 3/4-X,1/4+Y,3/4+Z
+ 1/2+X,1/2+Y,Z
+ 1/2-X,1/2-Y,Z
+ 1/2-X,1/2+Y,-Z
+ 1/2+X,1/2-Y,-Z
+ 3/4-X,3/4-Y,1/4-Z
+ 3/4+X,3/4+Y,1/4-Z
+ 3/4+X,3/4-Y,1/4+Z
+ 3/4-X,3/4+Y,1/4+Z
+71 16 8 Immm PGmmm ORTHORHOMBIC 'I 2/m 2/m 2/m' 'I m m m'
+ X,Y,Z
+ -X,-Y,Z
+ -X,Y,-Z
+ X,-Y,-Z
+ -X,-Y,-Z
+ X,Y,-Z
+ X,-Y,Z
+ -X,Y,Z
+ 1/2+X,1/2+Y,1/2+Z
+ 1/2-X,1/2-Y,1/2+Z
+ 1/2-X,1/2+Y,1/2-Z
+ 1/2+X,1/2-Y,1/2-Z
+ 1/2-X,1/2-Y,1/2-Z
+ 1/2+X,1/2+Y,1/2-Z
+ 1/2+X,1/2-Y,1/2+Z
+ 1/2-X,1/2+Y,1/2+Z
+72 16 8 Ibam PGmmm ORTHORHOMBIC 'I 2/b 2/a 2/m' 'I b a m'
+ X,Y,Z
+ -X,-Y,Z
+ 1/2-X,1/2+Y,-Z
+ 1/2+X,1/2-Y,-Z
+ -X,-Y,-Z
+ X,Y,-Z
+ 1/2+X,1/2-Y,Z
+ 1/2-X,1/2+Y,Z
+ 1/2+X,1/2+Y,1/2+Z
+ 1/2-X,1/2-Y,1/2+Z
+ -X,Y,1/2-Z
+ X,-Y,1/2-Z
+ 1/2-X,1/2-Y,1/2-Z
+ 1/2+X,1/2+Y,1/2-Z
+ X,-Y,1/2+Z
+ -X,Y,1/2+Z
+73 16 8 Ibca PGmmm ORTHORHOMBIC 'I 21/b 21/c 21/a' 'I b c a'
+ X,Y,Z
+ 1/2-X,-Y,1/2+Z
+ -X,1/2+Y,1/2-Z
+ 1/2+X,1/2-Y,-Z
+ -X,-Y,-Z
+ 1/2+X,Y,1/2-Z
+ X,1/2-Y,1/2+Z
+ 1/2-X,1/2+Y,Z
+ 1/2+X,1/2+Y,1/2+Z
+ -X,1/2-Y,Z
+ 1/2-X,Y,-Z
+ X,-Y,1/2-Z
+ 1/2-X,1/2-Y,1/2-Z
+ X,1/2+Y,-Z
+ 1/2+X,-Y,Z
+ -X,Y,1/2+Z
+74 16 8 Imma PGmmm ORTHORHOMBIC 'I 21/m 21/m 21/a' 'I m m a'
+ X,Y,Z
+ -X,1/2-Y,Z
+ -X,1/2+Y,-Z
+ X,-Y,-Z
+ -X,-Y,-Z
+ X,1/2+Y,-Z
+ X,1/2-Y,Z
+ -X,Y,Z
+ 1/2+X,1/2+Y,1/2+Z
+ 1/2-X,-Y,1/2+Z
+ 1/2-X,Y,1/2-Z
+ 1/2+X,1/2-Y,1/2-Z
+ 1/2-X,1/2-Y,1/2-Z
+ 1/2+X,Y,1/2-Z
+ 1/2+X,-Y,1/2+Z
+ 1/2-X,1/2+Y,1/2+Z
+75 4 4 P4 PG4 TETRAGONAL 'P 4'
+ X,Y,Z
+ -X,-Y,Z
+ -Y,X,Z
+ Y,-X,Z
+76 4 4 P41 PG4 TETRAGONAL 'P 41'
+ X,Y,Z
+ -X,-Y,1/2+Z
+ -Y,X,1/4+Z
+ Y,-X,3/4+Z
+77 4 4 P42 PG4 TETRAGONAL 'P 42'
+ X,Y,Z
+ -X,-Y,Z
+ -Y,X,1/2+Z
+ Y,-X,1/2+Z
+78 4 4 P43 PG4 TETRAGONAL 'P 43'
+ X,Y,Z 
+ -X,-Y,1/2+Z
+ -Y,X,3/4+Z
+ Y,-X,1/4+Z
+79 8 4 I4 PG4 TETRAGONAL 'I 4'
+ X,Y,Z
+ -X,-Y,Z
+ -Y,X,Z
+ Y,-X,Z
+ 1/2+X,1/2+Y,1/2+Z
+ 1/2-X,1/2-Y,1/2+Z
+ 1/2-Y,1/2+X,1/2+Z
+ 1/2+Y,1/2-X,1/2+Z
+80 8 4 I41 PG4 TETRAGONAL 'I 41'
+ X,Y,Z
+ 1/2-X,1/2-Y,1/2+Z
+ -Y,1/2+X,1/4+Z
+ 1/2+Y,-X,3/4+Z
+ 1/2+X,1/2+Y,1/2+Z
+ -X,-Y,Z
+ 1/2-Y,X,3/4+Z
+ Y,1/2-X,1/4+Z
+81 4 4 P-4 PG4bar TETRAGONAL 'P -4'
+ X,Y,Z
+ -X,-Y,Z
+ Y,-X,-Z
+ -Y,X,-Z
+82 8 4 I-4 PG4bar TETRAGONAL 'I -4'
+ X,Y,Z
+ -X,-Y,Z
+ Y,-X,-Z
+ -Y,X,-Z
+ 1/2+X,1/2+Y,1/2+Z
+ 1/2-X,1/2-Y,1/2+Z
+ 1/2+Y,1/2-X,1/2-Z
+ 1/2-Y,1/2+X,1/2-Z
+83 8 8 P4/m PG4/m TETRAGONAL 'P 4/m'
+ X,Y,Z
+ -X,-Y,Z
+ -Y,X,Z
+ Y,-X,Z
+ -X,-Y,-Z
+ X,Y,-Z
+ Y,-X,-Z
+ -Y,X,-Z
+84 8 8 P42/m PG4/m TETRAGONAL 'P 42/m'
+ X,Y,Z
+ -X,-Y,Z
+ -Y,X,1/2+Z
+ Y,-X,1/2+Z
+ -X,-Y,-Z
+ X,Y,-Z
+ Y,-X,1/2-Z
+ -Y,X,1/2-Z
+85 8 8 P4/n PG4/m TETRAGONAL 'P 4/n'
+ X,Y,Z
+ -X,-Y,Z
+ 1/2-Y,1/2+X,Z
+ 1/2+Y,1/2-X,Z
+ 1/2-X,1/2-Y,-Z
+ 1/2+X,1/2+Y,-Z
+ Y,-X,-Z
+ -Y,X,-Z
+86 8 8 P42/n PG4/m TETRAGONAL 'P 42/n'
+ X,Y,Z
+ -X,-Y,Z
+ 1/2-Y,1/2+X,1/2+Z
+ 1/2+Y,1/2-X,1/2+Z
+ 1/2-X,1/2-Y,1/2-Z
+ 1/2+X,1/2+Y,1/2-Z
+ Y,-X,-Z
+ -Y,X,-Z
+87 16 8 I4/m PG4/m TETRAGONAL 'I 4/m'
+ X,Y,Z
+ -X,-Y,Z
+ -Y,X,Z
+ Y,-X,Z
+ -X,-Y,-Z
+ X,Y,-Z
+ Y,-X,-Z
+ -Y,X,-Z
+ 1/2+X,1/2+Y,1/2+Z
+ 1/2-X,1/2-Y,1/2+Z
+ 1/2-Y,1/2+X,1/2+Z
+ 1/2+Y,1/2-X,1/2+Z
+ 1/2-X,1/2-Y,1/2-Z
+ 1/2+X,1/2+Y,1/2-Z
+ 1/2+Y,1/2-X,1/2-Z
+ 1/2-Y,1/2+X,1/2-Z
+88 16 8 I41/a PG4/m TETRAGONAL 'I 41/a'
+ X,Y,Z
+ 1/2-X,1/2-Y,1/2+Z
+ -Y,1/2+X,1/4+Z
+ 1/2+Y,-X,3/4+Z
+ -X,1/2-Y,1/4-Z
+ 1/2+X,Y,3/4-Z
+ Y,-X,-Z
+ 1/2-Y,1/2+X,1/2-Z
+ 1/2+X,1/2+Y,1/2+Z
+ -X,-Y,Z
+ 1/2-Y,X,3/4+Z
+ Y,1/2-X,1/4+Z
+ 1/2-X,-Y,3/4-Z
+ X,1/2+Y,1/4-Z
+ 1/2+Y,1/2-X,1/2-Z
+ -Y,X,-Z
+89 8 8 P422 PG422 TETRAGONAL 'P 4 2 2'
+ X,Y,Z
+ -X,-Y,Z
+ -Y,X,Z
+ Y,-X,Z
+ -X,Y,-Z
+ X,-Y,-Z
+ Y,X,-Z
+ -Y,-X,-Z
+90 8 8 P4212 PG422 TETRAGONAL 'P 4 21 2'
+ X,Y,Z
+ -X,-Y,Z
+ 1/2-Y,1/2+X,Z
+ 1/2+Y,1/2-X,Z
+ 1/2-X,1/2+Y,-Z
+ 1/2+X,1/2-Y,-Z
+ Y,X,-Z
+ -Y,-X,-Z
+91 8 8 P4122 PG422 TETRAGONAL 'P 41 2 2'
+ X,Y,Z
+ -X,-Y,1/2+Z
+ -Y,X,1/4+Z
+ Y,-X,3/4+Z
+ -X,Y,-Z
+ X,-Y,1/2-Z
+ Y,X,3/4-Z
+ -Y,-X,1/4-Z
+92 8 8 P41212 PG422 TETRAGONAL 'P 41 21 2'
+ X,Y,Z
+ -X,-Y,1/2+Z
+ 1/2-Y,1/2+X,1/4+Z
+ 1/2+Y,1/2-X,3/4+Z
+ 1/2-X,1/2+Y,1/4-Z
+ 1/2+X,1/2-Y,3/4-Z
+ Y,X,-Z
+ -Y,-X,1/2-Z
+93 8 8 P4222 PG422 TETRAGONAL 'P 42 2 2'
+ X,Y,Z
+ -X,-Y,Z
+ -Y,X,1/2+Z
+ Y,-X,1/2+Z
+ -X,Y,-Z
+ X,-Y,-Z
+ Y,X,1/2-Z
+ -Y,-X,1/2-Z
+94 8 8 P42212 PG422 TETRAGONAL 'P 42 21 2'
+ X,Y,Z
+ -X,-Y,Z
+ 1/2-Y,1/2+X,1/2+Z
+ 1/2+Y,1/2-X,1/2+Z
+ 1/2-X,1/2+Y,1/2-Z
+ 1/2+X,1/2-Y,1/2-Z
+ Y,X,-Z
+ -Y,-X,-Z
+95 8 8 P4322 PG422 TETRAGONAL 'P 43 2 2'
+ X,Y,Z
+ -X,-Y,1/2+Z
+ -Y,X,3/4+Z
+ Y,-X,1/4+Z
+ -X,Y,-Z
+ X,-Y,1/2-Z
+ Y,X,1/4-Z
+ -Y,-X,3/4-Z
+96 8 8 P43212 PG422 TETRAGONAL 'P 43 21 2'
+ X,Y,Z
+ -X,-Y,1/2+Z
+ 1/2-Y,1/2+X,3/4+Z
+ 1/2+Y,1/2-X,1/4+Z
+ 1/2-X,1/2+Y,3/4-Z
+ 1/2+X,1/2-Y,1/4-Z
+ Y,X,-Z
+ -Y,-X,1/2-Z
+97 16 8 I422 PG422 TETRAGONAL 'I 4 2 2'
+ X,Y,Z
+ -X,-Y,Z
+ -Y,X,Z
+ Y,-X,Z
+ -X,Y,-Z
+ X,-Y,-Z
+ Y,X,-Z
+ -Y,-X,-Z
+ 1/2+X,1/2+Y,1/2+Z
+ 1/2-X,1/2-Y,1/2+Z
+ 1/2-Y,1/2+X,1/2+Z
+ 1/2+Y,1/2-X,1/2+Z
+ 1/2-X,1/2+Y,1/2-Z
+ 1/2+X,1/2-Y,1/2-Z
+ 1/2+Y,1/2+X,1/2-Z
+ 1/2-Y,1/2-X,1/2-Z
+98 16 8 I4122 PG422 TETRAGONAL 'I 41 2 2'
+ X,Y,Z
+ 1/2-X,1/2-Y,1/2+Z
+ -Y,1/2+X,1/4+Z
+ 1/2+Y,-X,3/4+Z
+ 1/2-X,Y,3/4-Z
+ X,1/2-Y,1/4-Z
+ 1/2+Y,1/2+X,1/2-Z
+ -Y,-X,-Z
+ 1/2+X,1/2+Y,1/2+Z
+ -X,-Y,Z
+ 1/2-Y,X,3/4+Z
+ Y,1/2-X,1/4+Z
+ -X,1/2+Y,1/4-Z
+ 1/2+X,-Y,3/4-Z
+ Y,X,-Z
+ 1/2-Y,1/2-X,1/2-Z
+99 8 8 P4mm PG4mm TETRAGONAL 'P 4 m m'
+ X,Y,Z
+ -X,-Y,Z
+ -Y,X,Z
+ Y,-X,Z
+ X,-Y,Z
+ -X,Y,Z
+ -Y,-X,Z
+ Y,X,Z
+100 8 8 P4bm PG4mm TETRAGONAL 'P 4 b m'
+ X,Y,Z
+ -X,-Y,Z
+ -Y,X,Z
+ Y,-X,Z
+ 1/2+X,1/2-Y,Z
+ 1/2-X,1/2+Y,Z
+ 1/2-Y,1/2-X,Z
+ 1/2+Y,1/2+X,Z
+101 8 8 P42cm PG4mm TETRAGONAL 'P 42 c m'
+ X,Y,Z
+ -X,-Y,Z
+ -Y,X,1/2+Z
+ Y,-X,1/2+Z
+ X,-Y,1/2+Z
+ -X,Y,1/2+Z
+ -Y,-X,Z
+ Y,X,Z
+102 8 8 P42nm PG4mm TETRAGONAL 'P 42 n m'
+ X,Y,Z
+ -X,-Y,Z
+ 1/2-Y,1/2+X,1/2+Z
+ 1/2+Y,1/2-X,1/2+Z
+ 1/2+X,1/2-Y,1/2+Z
+ 1/2-X,1/2+Y,1/2+Z
+ -Y,-X,Z
+ Y,X,Z
+103 8 8 P4cc PG4mm TETRAGONAL 'P 4 c c'
+ X,Y,Z
+ -X,-Y,Z
+ -Y,X,Z
+ Y,-X,Z
+ X,-Y,1/2+Z
+ -X,Y,1/2+Z
+ -Y,-X,1/2+Z
+ Y,X,1/2+Z
+104 8 8 P4nc PG4mm TETRAGONAL 'P 4 n c'
+ X,Y,Z
+ -X,-Y,Z
+ -Y,X,Z
+ Y,-X,Z
+ 1/2+X,1/2-Y,1/2+Z
+ 1/2-X,1/2+Y,1/2+Z
+ 1/2-Y,1/2-X,1/2+Z
+ 1/2+Y,1/2+X,1/2+Z
+105 8 8 P42mc PG4mm TETRAGONAL 'P 42 m c'
+ X,Y,Z
+ -X,-Y,Z
+ -Y,X,1/2+Z
+ Y,-X,1/2+Z
+ X,-Y,Z
+ -X,Y,Z
+ -Y,-X,1/2+Z
+ Y,X,1/2+Z
+106 8 8 P42bc PG4mm TETRAGONAL 'P 42 b c'
+ X,Y,Z
+ -X,-Y,Z
+ -Y,X,1/2+Z
+ Y,-X,1/2+Z
+ 1/2+X,1/2-Y,Z
+ 1/2-X,1/2+Y,Z
+ 1/2-Y,1/2-X,1/2+Z
+ 1/2+Y,1/2+X,1/2+Z
+107 16 8 I4mm PG4mm TETRAGONAL 'I 4 m m'
+ X,Y,Z
+ -X,-Y,Z
+ -Y,X,Z
+ Y,-X,Z
+ X,-Y,Z
+ -X,Y,Z
+ -Y,-X,Z
+ Y,X,Z
+ 1/2+X,1/2+Y,1/2+Z
+ 1/2-X,1/2-Y,1/2+Z
+ 1/2-Y,1/2+X,1/2+Z
+ 1/2+Y,1/2-X,1/2+Z
+ 1/2+X,1/2-Y,1/2+Z
+ 1/2-X,1/2+Y,1/2+Z
+ 1/2-Y,1/2-X,1/2+Z
+ 1/2+Y,1/2+X,1/2+Z
+108 16 8 I4cm PG4mm TETRAGONAL 'I 4 c m'
+ X,Y,Z
+ -X,-Y,Z
+ -Y,X,Z
+ Y,-X,Z
+ X,-Y,1/2+Z
+ -X,Y,1/2+Z
+ -Y,-X,1/2+Z
+ Y,X,1/2+Z
+ 1/2+X,1/2+Y,1/2+Z
+ 1/2-X,1/2-Y,1/2+Z
+ 1/2-Y,1/2+X,1/2+Z
+ 1/2+Y,1/2-X,1/2+Z
+ 1/2+X,1/2-Y,Z
+ 1/2-X,1/2+Y,Z
+ 1/2-Y,1/2-X,Z
+ 1/2+Y,1/2+X,Z
+109 16 8 I41md PG4mm TETRAGONAL 'I 41 m d'
+ X,Y,Z
+ 1/2-X,1/2-Y,1/2+Z
+ -Y,1/2+X,1/4+Z
+ 1/2+Y,-X,3/4+Z
+ X,-Y,Z
+ 1/2-X,1/2+Y,1/2+Z
+ -Y,1/2-X,1/4+Z
+ 1/2+Y,X,3/4+Z
+ 1/2+X,1/2+Y,1/2+Z
+ -X,-Y,Z
+ 1/2-Y,X,3/4+Z
+ Y,1/2-X,1/4+Z
+ 1/2+X,1/2-Y,1/2+Z
+ -X,Y,Z
+ 1/2-Y,-X,3/4+Z
+ Y,1/2+X,1/4+Z
+110 16 8 I41cd PG4mm TETRAGONAL 'I 41 c d'
+ X,Y,Z
+ 1/2-X,1/2-Y,1/2+Z
+ -Y,1/2+X,1/4+Z
+ 1/2+Y,-X,3/4+Z
+ X,-Y,1/2+Z
+ 1/2-X,1/2+Y,Z
+ -Y,1/2-X,3/4+Z
+ 1/2+Y,X,1/4+Z
+ 1/2+X,1/2+Y,1/2+Z
+ -X,-Y,Z
+ 1/2-Y,X,3/4+Z
+ Y,1/2-X,1/4+Z
+ 1/2+X,1/2-Y,Z
+ -X,Y,1/2+Z
+ 1/2-Y,-X,1/4+Z
+ Y,1/2+X,3/4+Z
+111 8 8 P-42m PG4bar2m TETRAGONAL 'P -4 2 m'
+ X,Y,Z
+ -X,-Y,Z
+ -Y,X,-Z
+ Y,-X,-Z
+ -X,Y,-Z
+ X,-Y,-Z
+ -Y,-X,Z
+ Y,X,Z
+112 8 8 P-42c PG4bar2m TETRAGONAL 'P -4 2 c'
+ X,Y,Z
+ -X,-Y,Z
+ -Y,X,-Z
+ Y,-X,-Z
+ -X,Y,1/2-Z
+ X,-Y,1/2-Z
+ -Y,-X,1/2+Z
+ Y,X,1/2+Z
+113 8 8 P-421m PG4bar2m TETRAGONAL 'P -4 21 m'
+ X,Y,Z
+ -X,-Y,Z
+ -Y,X,-Z
+ Y,-X,-Z
+ 1/2-X,1/2+Y,-Z
+ 1/2+X,1/2-Y,-Z
+ 1/2-Y,1/2-X,Z
+ 1/2+Y,1/2+X,Z
+114 8 8 P-421c PG4bar2m TETRAGONAL 'P -4 21 c'
+ X,Y,Z
+ -X,-Y,Z
+ -Y,X,-Z
+ Y,-X,-Z
+ 1/2-X,1/2+Y,1/2-Z
+ 1/2+X,1/2-Y,1/2-Z
+ 1/2-Y,1/2-X,1/2+Z
+ 1/2+Y,1/2+X,1/2+Z
+115 8 8 P-4m2 PG4barm2 TETRAGONAL 'P -4 m 2'
+ X,Y,Z
+ -X,-Y,Z
+ Y,-X,-Z
+ -Y,X,-Z
+ X,-Y,Z
+ -X,Y,Z
+ Y,X,-Z
+ -Y,-X,-Z
+116 8 8 P-4c2 PG4barm2 TETRAGONAL 'P -4 c 2'
+ X,Y,Z
+ -X,-Y,Z
+ -Y,X,-Z
+ Y,-X,-Z
+ X,-Y,1/2+Z
+ -X,Y,1/2+Z
+ Y,X,1/2-Z
+ -Y,-X,1/2-Z
+117 8 8 P-4b2 PG4barm2 TETRAGONAL 'P -4 b 2'
+ X,Y,Z
+ -X,-Y,Z
+ -Y,X,-Z
+ Y,-X,-Z
+ 1/2+X,1/2-Y,Z
+ 1/2-X,1/2+Y,Z
+ 1/2+Y,1/2+X,-Z
+ 1/2-Y,1/2-X,-Z
+118 8 8 P-4n2 PG4barm2 TETRAGONAL 'P -4 n 2'
+ X,Y,Z
+ -X,-Y,Z
+ -Y,X,-Z
+ Y,-X,-Z
+ 1/2+X,1/2-Y,1/2+Z
+ 1/2-X,1/2+Y,1/2+Z
+ 1/2+Y,1/2+X,1/2-Z
+ 1/2-Y,1/2-X,1/2-Z
+119 16 8 I-4m2 PG4barm2 TETRAGONAL 'I -4 m 2'
+ X,Y,Z
+ -X,-Y,Z
+ -Y,X,-Z
+ Y,-X,-Z
+ X,-Y,Z
+ -X,Y,Z
+ Y,X,-Z
+ -Y,-X,-Z
+ 1/2+X,1/2+Y,1/2+Z
+ 1/2-X,1/2-Y,1/2+Z
+ 1/2-Y,1/2+X,1/2-Z
+ 1/2+Y,1/2-X,1/2-Z
+ 1/2+X,1/2-Y,1/2+Z
+ 1/2-X,1/2+Y,1/2+Z
+ 1/2+Y,1/2+X,1/2-Z
+ 1/2-Y,1/2-X,1/2-Z
+120 16 8 I-4c2 PG4barm2 TETRAGONAL 'I -4 c 2'
+ X,Y,Z
+ -X,-Y,Z
+ -Y,X,-Z
+ Y,-X,-Z
+ X,-Y,1/2+Z
+ -X,Y,1/2+Z
+ Y,X,1/2-Z
+ -Y,-X,1/2-Z
+ 1/2+X,1/2+Y,1/2+Z
+ 1/2-X,1/2-Y,1/2+Z
+ 1/2-Y,1/2+X,1/2-Z
+ 1/2+Y,1/2-X,1/2-Z
+ 1/2+X,1/2-Y,Z
+ 1/2-X,1/2+Y,Z
+ 1/2+Y,1/2+X,-Z
+ 1/2-Y,1/2-X,-Z
+121 16 8 I-42m PG4bar2m TETRAGONAL 'I -4 2 m'
+ X,Y,Z
+ -X,-Y,Z
+ -Y,X,-Z
+ Y,-X,-Z
+ -X,Y,-Z
+ X,-Y,-Z
+ -Y,-X,Z
+ Y,X,Z
+ 1/2+X,1/2+Y,1/2+Z
+ 1/2-X,1/2-Y,1/2+Z
+ 1/2-Y,1/2+X,1/2-Z
+ 1/2+Y,1/2-X,1/2-Z
+ 1/2-X,1/2+Y,1/2-Z
+ 1/2+X,1/2-Y,1/2-Z
+ 1/2-Y,1/2-X,1/2+Z
+ 1/2+Y,1/2+X,1/2+Z
+122 16 8 I-42d PG4bar2m TETRAGONAL 'I -4 2 d'
+ X,Y,Z
+ -X,-Y,Z
+ -Y,X,-Z
+ Y,-X,-Z
+ 1/2-X,Y,3/4-Z
+ 1/2+X,-Y,3/4-Z
+ 1/2-Y,-X,3/4+Z
+ 1/2+Y,X,3/4+Z
+ 1/2+X,1/2+Y,1/2+Z
+ 1/2-X,1/2-Y,1/2+Z
+ 1/2-Y,1/2+X,1/2-Z
+ 1/2+Y,1/2-X,1/2-Z
+ -X,1/2+Y,1/4-Z
+ X,1/2-Y,1/4-Z
+ -Y,1/2-X,1/4+Z
+ Y,1/2+X,1/4+Z
+123 16 16 P4/mmm PG4/mmm TETRAGONAL 'P 4/m 2/m 2/m' 'P4/m m m'
+ X,Y,Z
+ -X,-Y,Z
+ -Y,X,Z
+ Y,-X,Z
+ -X,Y,-Z
+ X,-Y,-Z
+ Y,X,-Z
+ -Y,-X,-Z
+ -X,-Y,-Z
+ X,Y,-Z
+ Y,-X,-Z
+ -Y,X,-Z
+ X,-Y,Z
+ -X,Y,Z
+ -Y,-X,Z
+ Y,X,Z
+124 16 16 P4/mcc PG4/mmm TETRAGONAL 'P 4/m 2/c 2/c' 'P4/m c c'
+ X,Y,Z
+ -X,-Y,Z
+ -Y,X,Z
+ Y,-X,Z
+ -X,Y,1/2-Z
+ X,-Y,1/2-Z
+ Y,X,1/2-Z
+ -Y,-X,1/2-Z
+ -X,-Y,-Z
+ X,Y,-Z
+ Y,-X,-Z
+ -Y,X,-Z
+ X,-Y,1/2+Z
+ -X,Y,1/2+Z
+ -Y,-X,1/2+Z
+ Y,X,1/2+Z
+125 16 16 P4/nbm PG4/mmm TETRAGONAL 'P 4/n 2/b 2/m' 'P4/n b m'
+ X,Y,Z
+ -X,-Y,Z
+ -Y,X,Z
+ Y,-X,Z
+ -X,Y,-Z
+ X,-Y,-Z
+ Y,X,-Z
+ -Y,-X,-Z
+ 1/2-X,1/2-Y,-Z
+ 1/2+X,1/2+Y,-Z
+ 1/2+Y,1/2-X,-Z
+ 1/2-Y,1/2+X,-Z
+ 1/2+X,1/2-Y,Z
+ 1/2-X,1/2+Y,Z
+ 1/2-Y,1/2-X,Z
+ 1/2+Y,1/2+X,Z
+126 16 16 P4/nnc PG4/mmm TETRAGONAL 'P 4/n 2/n 2/c' 'P4/n n c'
+ X,Y,Z
+ -X,-Y,Z
+ -Y,X,Z
+ Y,-X,Z
+ -X,Y,-Z
+ X,-Y,-Z
+ Y,X,-Z
+ -Y,-X,-Z
+ 1/2-X,1/2-Y,1/2-Z
+ 1/2+X,1/2+Y,1/2-Z
+ 1/2+Y,1/2-X,1/2-Z
+ 1/2-Y,1/2+X,1/2-Z
+ 1/2+X,1/2-Y,1/2+Z
+ 1/2-X,1/2+Y,1/2+Z
+ 1/2-Y,1/2-X,1/2+Z
+ 1/2+Y,1/2+X,1/2+Z
+127 16 16 P4/mbm PG4/mmm TETRAGONAL 'P 4/m 21/b 2/m' 'P4/m b m'
+ X,Y,Z
+ -X,-Y,Z
+ -Y,X,Z
+ Y,-X,Z
+ 1/2-X,1/2+Y,-Z
+ 1/2+X,1/2-Y,-Z
+ 1/2+Y,1/2+X,-Z
+ 1/2-Y,1/2-X,-Z
+ -X,-Y,-Z
+ X,Y,-Z
+ Y,-X,-Z
+ -Y,X,-Z
+ 1/2+X,1/2-Y,Z
+ 1/2-X,1/2+Y,Z
+ 1/2-Y,1/2-X,Z
+ 1/2+Y,1/2+X,Z
+128 16 16 P4/mnc PG4/mmm TETRAGONAL 'P 4/m 21/n 2/c' 'P4/m n c'
+ X,Y,Z
+ -X,-Y,Z
+ -Y,X,Z
+ Y,-X,Z
+ 1/2-X,1/2+Y,1/2-Z
+ 1/2+X,1/2-Y,1/2-Z
+ 1/2+Y,1/2+X,1/2-Z
+ 1/2-Y,1/2-X,1/2-Z
+ -X,-Y,-Z
+ X,Y,-Z
+ Y,-X,-Z
+ -Y,X,-Z
+ 1/2+X,1/2-Y,1/2+Z
+ 1/2-X,1/2+Y,1/2+Z
+ 1/2-Y,1/2-X,1/2+Z
+ 1/2+Y,1/2+X,1/2+Z
+129 16 16 P4/nmm PG4/mmm TETRAGONAL 'P 4/n 21/m 2/m' 'P4/n m m'
+ X,Y,Z
+ -X,-Y,Z
+ 1/2-Y,1/2+X,Z
+ 1/2+Y,1/2-X,Z
+ 1/2-X,1/2+Y,-Z
+ 1/2+X,1/2-Y,-Z
+ Y,X,-Z
+ -Y,-X,-Z
+ 1/2-X,1/2-Y,-Z
+ 1/2+X,1/2+Y,-Z
+ Y,-X,-Z
+ -Y,X,-Z
+ X,-Y,Z
+ -X,Y,Z
+ 1/2-Y,1/2-X,Z
+ 1/2+Y,1/2+X,Z
+130 16 16 P4/ncc PG4/mmm TETRAGONAL 'P 4/n 2/c 2/c' 'P4/n c c'
+ X,Y,Z
+ -X,-Y,Z
+ 1/2-Y,1/2+X,Z
+ 1/2+Y,1/2-X,Z
+ 1/2-X,1/2+Y,1/2-Z
+ 1/2+X,1/2-Y,1/2-Z
+ Y,X,1/2-Z
+ -Y,-X,1/2-Z
+ 1/2-X,1/2-Y,-Z
+ 1/2+X,1/2+Y,-Z
+ Y,-X,-Z
+ -Y,X,-Z
+ X,-Y,1/2+Z
+ -X,Y,1/2+Z
+ 1/2-Y,1/2-X,1/2+Z
+ 1/2+Y,1/2+X,1/2+Z
+131 16 16 P42/mmc PG4/mmm TETRAGONAL 'P 42/m 2/m 2/c' 'P42/m m c'
+ X,Y,Z
+ -X,-Y,Z
+ -Y,X,1/2+Z
+ Y,-X,1/2+Z
+ -X,Y,-Z
+ X,-Y,-Z
+ Y,X,1/2-Z
+ -Y,-X,1/2-Z
+ -X,-Y,-Z
+ X,Y,-Z
+ Y,-X,1/2-Z
+ -Y,X,1/2-Z
+ X,-Y,Z
+ -X,Y,Z
+ -Y,-X,1/2+Z
+ Y,X,1/2+Z
+132 16 16 P42/mcm PG4/mmm TETRAGONAL 'P 42/m 2/c 2/m' 'P42/m c m'
+ X,Y,Z
+ -X,-Y,Z
+ -Y,X,1/2+Z
+ Y,-X,1/2+Z
+ -X,Y,1/2-Z
+ X,-Y,1/2-Z
+ Y,X,-Z
+ -Y,-X,-Z
+ -X,-Y,-Z
+ X,Y,-Z
+ Y,-X,1/2-Z
+ -Y,X,1/2-Z
+ X,-Y,1/2+Z
+ -X,Y,1/2+Z
+ -Y,-X,Z
+ Y,X,Z
+133 16 16 P42/nbc PG4/mmm TETRAGONAL 'P 42/n 2/b 2/c' 'P42/n b c'
+ X,Y,Z
+ -X,-Y,Z
+ 1/2-Y,1/2+X,1/2+Z
+ 1/2+Y,1/2-X,1/2+Z
+ -X,Y,1/2-Z
+ X,-Y,1/2-Z
+ 1/2+Y,1/2+X,-Z
+ 1/2-Y,1/2-X,-Z
+ 1/2-X,1/2-Y,1/2-Z
+ 1/2+X,1/2+Y,1/2-Z
+ Y,-X,-Z
+ -Y,X,-Z
+ 1/2+X,1/2-Y,Z
+ 1/2-X,1/2+Y,Z
+ -Y,-X,1/2+Z
+ Y,X,1/2+Z
+134 16 16 P42/nnm PG4/mmm TETRAGONAL 'P 42/n 2/n 2/m' 'P42/n n m'
+ X,Y,Z
+ -X,-Y,Z
+ 1/2-Y,1/2+X,1/2+Z
+ 1/2+Y,1/2-X,1/2+Z
+ -X,Y,-Z
+ X,-Y,-Z
+ 1/2+Y,1/2+X,1/2-Z
+ 1/2-Y,1/2-X,1/2-Z
+ 1/2-X,1/2-Y,1/2-Z
+ 1/2+X,1/2+Y,1/2-Z
+ Y,-X,-Z
+ -Y,X,-Z
+ 1/2+X,1/2-Y,1/2+Z
+ 1/2-X,1/2+Y,1/2+Z
+ -Y,-X,Z
+ Y,X,Z
+135 16 16 P42/mbc PG4/mmm TETRAGONAL 'P 42/m 21/b 2/c' 'P42/m b c'
+ X,Y,Z
+ -X,-Y,Z
+ -Y,X,1/2+Z
+ Y,-X,1/2+Z
+ 1/2-X,1/2+Y,-Z
+ 1/2+X,1/2-Y,-Z
+ 1/2+Y,1/2+X,1/2-Z
+ 1/2-Y,1/2-X,1/2-Z
+ -X,-Y,-Z
+ X,Y,-Z
+ Y,-X,1/2-Z
+ -Y,X,1/2-Z
+ 1/2+X,1/2-Y,Z
+ 1/2-X,1/2+Y,Z
+ 1/2-Y,1/2-X,1/2+Z
+ 1/2+Y,1/2+X,1/2+Z
+136 16 16 P42/mnm PG4/mmm TETRAGONAL 'P 42/m 21/n 2/m' 'P42/m n m'
+ X,Y,Z
+ -X,-Y,Z
+ 1/2-Y,X+1/2,Z+1/2
+ Y+1/2,1/2-X,Z+1/2
+ 1/2-X,Y+1/2,1/2-Z
+ X+1/2,1/2-Y,1/2-Z
+ Y,X,-Z
+ -Y,-X,-Z
+ -X,-Y,-Z
+ X,Y,-Z
+ Y+1/2,1/2-X,1/2-Z
+ 1/2-Y,X+1/2,1/2-Z
+ X+1/2,1/2-Y,Z+1/2
+ 1/2-X,Y+1/2,Z+1/2
+ -Y,-X,Z
+ Y,X,Z
+137 16 16 P42/nmc PG4/mmm TETRAGONAL 'P 42/n 21/m 2/c' 'P42/n m c'
+ X,Y,Z
+ -X,-Y,Z
+ 1/2-Y,1/2+X,1/2+Z
+ 1/2+Y,1/2-X,1/2+Z
+ 1/2-X,1/2+Y,1/2-Z
+ 1/2+X,1/2-Y,1/2-Z
+ Y,X,-Z
+ -Y,-X,-Z
+ 1/2-X,1/2-Y,1/2-Z
+ 1/2+X,1/2+Y,1/2-Z
+ Y,-X,-Z
+ -Y,X,-Z
+ X,-Y,Z
+ -X,Y,Z
+ 1/2-Y,1/2-X,1/2+Z
+ 1/2+Y,1/2+X,1/2+Z
+138 16 16 P42/ncm PG4/mmm TETRAGONAL 'P 42/n 21/c 2/m' 'P42/n c m'
+ X,Y,Z
+ -X,-Y,Z
+ 1/2-Y,1/2+X,1/2+Z
+ 1/2+Y,1/2-X,1/2+Z
+ 1/2-X,1/2+Y,-Z
+ 1/2+X,1/2-Y,-Z
+ Y,X,1/2-Z
+ -Y,-X,1/2-Z
+ 1/2-X,1/2-Y,1/2-Z
+ 1/2+X,1/2+Y,1/2-Z
+ Y,-X,-Z
+ -Y,X,-Z
+ X,-Y,1/2+Z
+ -X,Y,1/2+Z
+ 1/2-Y,1/2-X,Z
+ 1/2+Y,1/2+X,Z
+139 32 16 I4/mmm PG4/mmm TETRAGONAL 'I 4/m 2/m 2/m' 'I4/m m m'
+ X,Y,Z
+ -X,-Y,Z
+ -Y,X,Z
+ Y,-X,Z
+ -X,Y,-Z
+ X,-Y,-Z
+ Y,X,-Z
+ -Y,-X,-Z
+ -X,-Y,-Z
+ X,Y,-Z
+ Y,-X,-Z
+ -Y,X,-Z
+ X,-Y,Z
+ -X,Y,Z
+ -Y,-X,Z
+ Y,X,Z
+ 1/2+X,1/2+Y,1/2+Z
+ 1/2-X,1/2-Y,1/2+Z
+ 1/2-Y,1/2+X,1/2+Z
+ 1/2+Y,1/2-X,1/2+Z
+ 1/2-X,1/2+Y,1/2-Z
+ 1/2+X,1/2-Y,1/2-Z
+ 1/2+Y,1/2+X,1/2-Z
+ 1/2-Y,1/2-X,1/2-Z
+ 1/2-X,1/2-Y,1/2-Z
+ 1/2+X,1/2+Y,1/2-Z
+ 1/2+Y,1/2-X,1/2-Z
+ 1/2-Y,1/2+X,1/2-Z
+ 1/2+X,1/2-Y,1/2+Z
+ 1/2-X,1/2+Y,1/2+Z
+ 1/2-Y,1/2-X,1/2+Z
+ 1/2+Y,1/2+X,1/2+Z
+140 32 16 I4/mcm PG4/mmm TETRAGONAL 'I 4/m 2/c 2/m' 'I4/m c m'
+ X,Y,Z
+ -X,-Y,Z
+ -Y,X,Z
+ Y,-X,Z
+ -X,Y,1/2-Z
+ X,-Y,1/2-Z
+ Y,X,1/2-Z
+ -Y,-X,1/2-Z
+ -X,-Y,-Z
+ X,Y,-Z
+ Y,-X,-Z
+ -Y,X,-Z
+ X,-Y,1/2+Z
+ -X,Y,1/2+Z
+ -Y,-X,1/2+Z
+ Y,X,1/2+Z
+ 1/2+X,1/2+Y,1/2+Z
+ 1/2-X,1/2-Y,1/2+Z
+ 1/2-Y,1/2+X,1/2+Z
+ 1/2+Y,1/2-X,1/2+Z
+ 1/2-X,1/2+Y,-Z
+ 1/2+X,1/2-Y,-Z
+ 1/2+Y,1/2+X,-Z
+ 1/2-Y,1/2-X,-Z
+ 1/2-X,1/2-Y,1/2-Z
+ 1/2+X,1/2+Y,1/2-Z
+ 1/2+Y,1/2-X,1/2-Z
+ 1/2-Y,1/2+X,1/2-Z
+ 1/2+X,1/2-Y,Z
+ 1/2-X,1/2+Y,Z
+ 1/2-Y,1/2-X,Z
+ 1/2+Y,1/2+X,Z
+141 32 16 I41/amd PG4/mmm TETRAGONAL 'I 41/a 2/m 2/d' 'I41/a m d'
+ X,Y,Z
+ 1/2-X,1/2-Y,1/2+Z
+ -Y,1/2+X,1/4+Z
+ 1/2+Y,-X,3/4+Z
+ 1/2-X,Y,3/4-Z
+ X,1/2-Y,1/4-Z
+ 1/2+Y,1/2+X,1/2-Z
+ -Y,-X,-Z
+ -X,1/2-Y,1/4-Z
+ 1/2+X,Y,3/4-Z
+ Y,-X,-Z
+ 1/2-Y,1/2+X,1/2-Z
+ 1/2+X,1/2-Y,1/2+Z
+ -X,Y,Z
+ 1/2-Y,-X,3/4+Z
+ Y,1/2+X,1/4+Z
+ 1/2+X,1/2+Y,1/2+Z
+ -X,-Y,Z
+ 1/2-Y,X,3/4+Z
+ Y,1/2-X,1/4+Z
+ -X,1/2+Y,1/4-Z
+ 1/2+X,-Y,3/4-Z
+ Y,X,-Z
+ 1/2-Y,1/2-X,1/2-Z
+ 1/2-X,-Y,3/4-Z
+ X,1/2+Y,1/4-Z
+ 1/2+Y,1/2-X,1/2-Z
+ -Y,X,-Z
+ X,-Y,Z
+ 1/2-X,1/2+Y,1/2+Z
+ -Y,1/2-X,1/4+Z
+ 1/2+Y,X,3/4+Z
+142 32 16 I41/acd PG4/mmm TETRAGONAL 'I 41/a 2/c 2/d' 'I41/a c d'
+ X,Y,Z
+ 1/2-X,1/2-Y,1/2+Z
+ -Y,1/2+X,1/4+Z
+ 1/2+Y,-X,3/4+Z
+ 1/2-X,Y,1/4-Z
+ X,1/2-Y,3/4-Z
+ 1/2+Y,1/2+X,-Z
+ -Y,-X,1/2-Z
+ -X,1/2-Y,1/4-Z
+ 1/2+X,Y,3/4-Z
+ Y,-X,-Z
+ 1/2-Y,1/2+X,1/2-Z
+ 1/2+X,1/2-Y,Z
+ -X,Y,1/2+Z
+ 1/2-Y,-X,1/4+Z
+ Y,1/2+X,3/4+Z
+ 1/2+X,1/2+Y,1/2+Z
+ -X,-Y,Z
+ 1/2-Y,X,3/4+Z
+ Y,1/2-X,1/4+Z
+ -X,1/2+Y,3/4-Z
+ 1/2+X,-Y,1/4-Z
+ Y,X,1/2-Z
+ 1/2-Y,1/2-X,-Z
+ 1/2-X,-Y,3/4-Z
+ X,1/2+Y,1/4-Z
+ 1/2+Y,1/2-X,1/2-Z
+ -Y,X,-Z
+ X,-Y,1/2+Z
+ 1/2-X,1/2+Y,Z
+ -Y,1/2-X,3/4+Z
+ 1/2+Y,X,1/4+Z
+143 3 3 P3 PG3 TRIGONAL 'P 3'
+ X,Y,Z 
+ -Y,X-Y,Z 
+ Y-X,-X,Z
+144 3 3 P31 PG3 TRIGONAL 'P 31'
+ X,Y,Z
+ -Y,X-Y,Z+1/3
+ Y-X,-X,Z+2/3
+145 3 3 P32 PG3 TRIGONAL 'P 32'
+ X,Y,Z
+ -Y,X-Y,Z+2/3
+ Y-X,-X,Z+1/3
+146 9 3 H3 PG3 TRIGONAL 'H 3'
+ X,Y,Z
+ -Y,X-Y,Z
+ Y-X,-X,Z
+ X+2/3,Y+1/3,Z+1/3
+ -Y+2/3,X-Y+1/3,Z+1/3
+ Y-X+2/3,-X+1/3,Z+1/3
+ X+1/3,Y+2/3,Z+2/3
+ -Y+1/3,X-Y+2/3,Z+2/3
+ Y-X+1/3,-X+2/3,Z+2/3
+1146 3 3 R3 PG3 TRIGONAL 'R 3'
+ X,Y,Z
+ Z,X,Y
+ Y,Z,X
+147 6 6 P-3 PG3bar TRIGONAL 'P -3'
+ X,Y,Z 
+ -Y,X-Y,Z 
+ Y-X,-X,Z
+ -X,-Y,-Z
+ Y,Y-X,-Z
+ X-Y,X,-Z
+148 18 6 H-3 PG3bar TRIGONAL 'H -3'
+ X,Y,Z 
+ -Y,X-Y,Z 
+ Y-X,-X,Z
+ -X,-Y,-Z
+ Y,Y-X,-Z
+ X-Y,X,-Z
+ 2/3+X,1/3+Y,1/3+Z 
+ 2/3-Y,1/3+X-Y,1/3+Z 
+ 2/3+Y-X,1/3-X,1/3+Z
+ 2/3-X,1/3-Y,1/3-Z
+ 2/3+Y,1/3+Y-X,1/3-Z
+ 2/3+X-Y,1/3+X,1/3-Z
+ 1/3+X,2/3+Y,2/3+Z 
+ 1/3-Y,2/3+X-Y,2/3+Z 
+ 1/3+Y-X,2/3-X,2/3+Z
+ 1/3-X,2/3-Y,2/3-Z
+ 1/3+Y,2/3+Y-X,2/3-Z
+ 1/3+X-Y,2/3+X,2/3-Z
+1148 6 6 R-3 PG3bar TRIGONAL 'R -3'
+ X,Y,Z
+ Z,X,Y
+ Y,Z,X
+ -X,-Y,-Z
+ -Z,-X,-Y
+ -Y,-Z,-X
+149 6 6 P312 PG312 TRIGONAL 'P 3 1 2'
+ X,Y,Z
+ -Y,X-Y,Z
+ Y-X,-X,Z
+ -Y,-X,-Z
+ Y-X,Y,-Z
+ X,X-Y,-Z
+150 6 6 P321 PG321 TRIGONAL 'P 3 2 1'
+ X,Y,Z
+ -Y,X-Y,Z
+ Y-X,-X,Z
+ Y,X,-Z
+ X-Y,-Y,-Z
+ -X,Y-X,-Z
+151 6 6 P3112 PG312 TRIGONAL 'P 31 1 2'
+ X,Y,Z
+ -Y,X-Y,1/3+Z
+ Y-X,-X,2/3+Z
+ -Y,-X,2/3-Z
+ Y-X,Y,1/3-Z
+ X,X-Y,-Z
+152 6 6 P3121 PG321 TRIGONAL 'P 31 2 1'
+ X,Y,Z
+ -Y,X-Y,Z+1/3
+ Y-X,-X,Z+2/3
+ Y,X,-Z
+ X-Y,-Y,2/3-Z
+ -X,Y-X,1/3-Z
+153 6 6 P3212 PG312 TRIGONAL 'P 32 1 2'
+ X,Y,Z
+ -Y,X-Y,2/3+Z
+ Y-X,-X,1/3+Z
+ -Y,-X,1/3-Z
+ Y-X,Y,2/3-Z
+ X,X-Y,-Z
+154 6 6 P3221 PG321 TRIGONAL 'P 32 2 1'
+ X,Y,Z
+ -Y,X-Y,Z+2/3
+ Y-X,-X,Z+1/3
+ Y,X,-Z
+ X-Y,-Y,1/3-Z
+ -X,Y-X,2/3-Z
+155 18 6 H32 PG321 TRIGONAL 'H 3 2'
+ X,Y,Z
+ -Y,X-Y,Z
+ Y-X,-X,Z
+ Y,X,-Z
+ X-Y,-Y,-Z 
+ -X,Y-X,-Z
+ 2/3+X,1/3+Y,1/3+Z
+ 2/3-Y,1/3+X-Y,1/3+Z
+ 2/3+Y-X,1/3-X,1/3+Z
+ 2/3+Y,1/3+X,1/3-Z
+ 2/3+X-Y,1/3-Y,1/3-Z 
+ 2/3-X,1/3+Y-X,1/3-Z
+ 1/3+X,2/3+Y,2/3+Z
+ 1/3-Y,2/3+X-Y,2/3+Z
+ 1/3+Y-X,2/3-X,2/3+Z
+ 1/3+Y,2/3+X,2/3-Z
+ 1/3+X-Y,2/3-Y,2/3-Z 
+ 1/3-X,2/3+Y-X,2/3-Z
+1155 6 6 R32 PG32 TRIGONAL 'R 3 2'
+ X,Y,Z
+ Z,X,Y
+ Y,Z,X
+ -Y,-X,-Z
+ -X,-Z,-Y
+ -Z,-Y,-X
+156 6 6 P3m1 PG3m1 TRIGONAL 'P 3 m 1'
+ X,Y,Z 
+ -Y,X-Y,Z 
+ Y-X,-X,Z
+ -Y,-X,Z
+ Y-X,Y,Z
+ X,X-Y,Z
+157 6 6 P31m PG31m TRIGONAL 'P 3 1 m'
+ X,Y,Z 
+ -Y,X-Y,Z 
+ Y-X,-X,Z
+ Y,X,Z
+ X-Y,-Y,Z
+ -X,Y-X,Z
+158 6 6 P3c1 PG3m1 TRIGONAL 'P 3 c 1'
+ X,Y,Z 
+ -Y,X-Y,Z 
+ Y-X,-X,Z
+ -Y,-X,1/2+Z
+ Y-X,Y,1/2+Z
+ X,X-Y,1/2+Z
+159 6 6 P31c PG31m TRIGONAL 'P 3 1 c'
+ X,Y,Z 
+ -Y,X-Y,Z 
+ Y-X,-X,Z
+ Y,X,1/2+Z
+ X-Y,-Y,1/2+Z
+ -X,Y-X,1/2+Z
+160 18 6 H3m PG3m TRIGONAL 'H 3 m'
+ X,Y,Z 
+ -Y,X-Y,Z 
+ Y-X,-X,Z
+ -Y,-X,Z
+ Y-X,Y,Z
+ X,X-Y,Z
+ 2/3+X,1/3+Y,1/3+Z 
+ 2/3-Y,1/3+X-Y,1/3+Z 
+ 2/3+Y-X,1/3-X,1/3+Z
+ 2/3-Y,1/3-X,1/3+Z
+ 2/3+Y-X,1/3+Y,1/3+Z
+ 2/3+X,1/3+X-Y,1/3+Z
+ 1/3+X,2/3+Y,2/3+Z 
+ 1/3-Y,2/3+X-Y,2/3+Z 
+ 1/3+Y-X,2/3-X,2/3+Z
+ 1/3-Y,2/3-X,2/3+Z
+ 1/3+Y-X,2/3+Y,2/3+Z
+ 1/3+X,2/3+X-Y,2/3+Z
+1160 6 6 R3m PG3m TRIGONAL 'R 3 m'
+ X,Y,Z
+ Z,X,Y
+ Y,Z,X
+ Y,X,Z
+ X,Z,Y
+ Z,Y,X
+161 18 6 H3c PG3m TRIGONAL 'H 3 c'
+ X,Y,Z 
+ -Y,X-Y,Z 
+ Y-X,-X,Z
+ -Y,-X,1/2+Z
+ Y-X,Y,1/2+Z
+ X,X-Y,1/2+Z
+ 2/3+X,1/3+Y,1/3+Z 
+ 2/3-Y,1/3+X-Y,1/3+Z 
+ 2/3+Y-X,1/3-X,1/3+Z
+ 2/3-Y,1/3-X,5/6+Z
+ 2/3+Y-X,1/3+Y,5/6+Z
+ 2/3+X,1/3+X-Y,5/6+Z
+ 1/3+X,2/3+Y,2/3+Z 
+ 1/3-Y,2/3+X-Y,2/3+Z 
+ 1/3+Y-X,2/3-X,2/3+Z
+ 1/3-Y,2/3-X,1/6+Z
+ 1/3+Y-X,2/3+Y,1/6+Z
+ 1/3+X,2/3+X-Y,1/6+Z
+1161 6 6 R3c PG3m TRIGONAL 'R 3 c'
+ X,Y,Z
+ Z,X,Y
+ Y,Z,X
+ Y+1/2,X+1/2,Z+1/2
+ X+1/2,Z+1/2,Y+1/2
+ Z+1/2,Y+1/2,X+1/2
+162 12 12 P-31m PG3bar1m TRIGONAL 'P -3 1 2/m' 'P -3 1 m'
+ X,Y,Z
+ -Y,X-Y,Z
+ Y-X,-X,Z
+ -Y,-X,-Z
+ Y-X,Y,-Z
+ X,X-Y,-Z
+ -X,-Y,-Z
+ Y,Y-X,-Z
+ X-Y,X,-Z
+ Y,X,Z
+ X-Y,-Y,Z
+ -X,Y-X,Z
+163 12 12 P-31c PG3bar1m TRIGONAL 'P -3 1 2/c' 'P -3 1 c'
+ X,Y,Z
+ -Y,X-Y,Z
+ Y-X,-X,Z
+ -Y,-X,1/2-Z
+ Y-X,Y,1/2-Z
+ X,X-Y,1/2-Z
+ -X,-Y,-Z
+ Y,Y-X,-Z
+ X-Y,X,-Z
+ Y,X,1/2+Z
+ X-Y,-Y,1/2+Z
+ -X,Y-X,1/2+Z
+164 12 12 P-3m1 PG3barm1 TRIGONAL 'P -3 2/m 1' 'P -3 m 1'
+ X,Y,Z 
+ -Y,X-Y,Z 
+ Y-X,-X,Z
+ Y,X,-Z
+ X-Y,-Y,-Z
+ -X,Y-X,-Z
+ -X,-Y,-Z
+ Y,Y-X,-Z
+ X-Y,X,-Z
+ -Y,-X,Z
+ Y-X,Y,Z
+ X,X-Y,Z
+165 12 12 P-3c1 PG3barm1 TRIGONAL 'P -3 2/c 1' 'P -3 c 1'
+ X,Y,Z 
+ -Y,X-Y,Z 
+ Y-X,-X,Z
+ Y,X,1/2-Z
+ X-Y,-Y,1/2-Z
+ -X,Y-X,1/2-Z
+ -X,-Y,-Z
+ Y,Y-X,-Z
+ X-Y,X,-Z
+ -Y,-X,1/2+Z
+ Y-X,Y,1/2+Z
+ X,X-Y,1/2+Z
+166 36 12 H-3m PG3barm TRIGONAL 'H -3 2/m' 'H -3 m'
+ X,Y,Z 
+ -Y,X-Y,Z 
+ Y-X,-X,Z
+ Y,X,-Z
+ X-Y,-Y,-Z
+ -X,Y-X,-Z
+ -X,-Y,-Z
+ Y,Y-X,-Z
+ X-Y,X,-Z
+ -Y,-X,Z
+ Y-X,Y,Z
+ X,X-Y,Z
+ 2/3+X,1/3+Y,1/3+Z 
+ 2/3-Y,1/3+X-Y,1/3+Z 
+ 2/3+Y-X,1/3-X,1/3+Z
+ 2/3+Y,1/3+X,1/3-Z
+ 2/3+X-Y,1/3-Y,1/3-Z
+ 2/3-X,1/3+Y-X,1/3-Z
+ 2/3-X,1/3-Y,1/3-Z
+ 2/3+Y,1/3+Y-X,1/3-Z
+ 2/3+X-Y,1/3+X,1/3-Z
+ 2/3-Y,1/3-X,1/3+Z
+ 2/3+Y-X,1/3+Y,1/3+Z
+ 2/3+X,1/3+X-Y,1/3+Z
+ 1/3+X,2/3+Y,2/3+Z 
+ 1/3-Y,2/3+X-Y,2/3+Z 
+ 1/3+Y-X,2/3-X,2/3+Z
+ 1/3+Y,2/3+X,2/3-Z
+ 1/3+X-Y,2/3-Y,2/3-Z
+ 1/3-X,2/3+Y-X,2/3-Z
+ 1/3-X,2/3-Y,2/3-Z
+ 1/3+Y,2/3+Y-X,2/3-Z
+ 1/3+X-Y,2/3+X,2/3-Z
+ 1/3-Y,2/3-X,2/3+Z
+ 1/3+Y-X,2/3+Y,2/3+Z
+ 1/3+X,2/3+X-Y,2/3+Z
+1166 12 12 R-3m PG3barm TRIGONAL 'R -3 2/m' 'R -3 m'
+ X,Y,Z
+ Z,X,Y
+ Y,Z,X
+ -Y,-X,-Z
+ -X,-Z,-Y
+ -Z,-Y,-X
+ -X,-Y,-Z
+ -Z,-X,-Y
+ -Y,-Z,-X
+ Y,X,Z
+ X,Z,Y
+ Z,Y,X
+167 36 12 H-3c PG3barm TRIGONAL 'H -3 2/c' 'H -3 c'
+ X,Y,Z 
+ -Y,X-Y,Z 
+ Y-X,-X,Z
+ Y,X,1/2-Z
+ X-Y,-Y,1/2-Z
+ -X,Y-X,1/2-Z
+ -X,-Y,-Z
+ Y,Y-X,-Z
+ X-Y,X,-Z
+ -Y,-X,1/2+Z
+ Y-X,Y,1/2+Z
+ X,X-Y,1/2+Z
+ 2/3+X,1/3+Y,1/3+Z 
+ 2/3-Y,1/3+X-Y,1/3+Z 
+ 2/3+Y-X,1/3-X,1/3+Z
+ 2/3+Y,1/3+X,5/6-Z
+ 2/3+X-Y,1/3-Y,5/6-Z
+ 2/3-X,1/3+Y-X,5/6-Z
+ 2/3-X,1/3-Y,1/3-Z
+ 2/3+Y,1/3+Y-X,1/3-Z
+ 2/3+X-Y,1/3+X,1/3-Z
+ 2/3-Y,1/3-X,5/6+Z
+ 2/3+Y-X,1/3+Y,5/6+Z
+ 2/3+X,1/3+X-Y,5/6+Z
+ 1/3+X,2/3+Y,2/3+Z 
+ 1/3-Y,2/3+X-Y,2/3+Z 
+ 1/3+Y-X,2/3-X,2/3+Z
+ 1/3+Y,2/3+X,1/6-Z
+ 1/3+X-Y,2/3-Y,1/6-Z
+ 1/3-X,2/3+Y-X,1/6-Z
+ 1/3-X,2/3-Y,2/3-Z
+ 1/3+Y,2/3+Y-X,2/3-Z
+ 1/3+X-Y,2/3+X,2/3-Z
+ 1/3-Y,2/3-X,1/6+Z
+ 1/3+Y-X,2/3+Y,1/6+Z
+ 1/3+X,2/3+X-Y,1/6+Z
+1167 12 12 R-3c PG3barm TRIGONAL 'R -3 2/c' 'R -3 c'
+ X,Y,Z
+ Z,X,Y
+ Y,Z,X
+ -Y+1/2,-X+1/2,-Z+1/2
+ -X+1/2,-Z+1/2,-Y+1/2
+ -Z+1/2,-Y+1/2,-X+1/2
+ -X,-Y,-Z
+ -Z,-X,-Y
+ -Y,-Z,-X
+ Y+1/2,X+1/2,Z+1/2
+ X+1/2,Z+1/2,Y+1/2
+ Z+1/2,Y+1/2,X+1/2
+168 6 6 P6 PG6 HEXAGONAL 'P 6'
+ X,Y,Z 
+ -Y,X-Y,Z 
+ Y-X,-X,Z 
+ -X,-Y,Z 
+ Y,Y-X,Z 
+ X-Y,X,Z 
+169 6 6 P61 PG6 HEXAGONAL 'P 61'
+ X,Y,Z
+ -Y,X-Y,Z+1/3
+ Y-X,-X,Z+2/3
+ -X,-Y,Z+1/2
+ Y,Y-X,Z+5/6
+ X-Y,X,Z+1/6
+170 6 6 P65 PG6 HEXAGONAL 'P 65'
+ X,Y,Z
+ -Y,X-Y,Z+2/3
+ Y-X,-X,Z+1/3
+ -X,-Y,Z+1/2
+ Y,Y-X,Z+1/6
+ X-Y,X,Z+5/6
+171 6 6 P62 PG6 HEXAGONAL 'P 62'
+ X,Y,Z 
+ -Y,X-Y,2/3+Z 
+ Y-X,-X,1/3+Z 
+ -X,-Y,Z 
+ Y,Y-X,2/3+Z 
+ X-Y,X,1/3+Z
+172 6 6 P64 PG6 HEXAGONAL 'P 64'
+ X,Y,Z 
+ -Y,X-Y,1/3+Z 
+ Y-X,-X,2/3+Z 
+ -X,-Y,Z 
+ Y,Y-X,1/3+Z 
+ X-Y,X,2/3+Z
+173 6 6 P63 PG6 HEXAGONAL 'P 63'
+ X,Y,Z 
+ -Y,X-Y,Z 
+ Y-X,-X,Z 
+ -X,-Y,1/2+Z 
+ Y,Y-X,1/2+Z 
+ X-Y,X,1/2+Z 
+174 6 6 P-6 PG6bar HEXAGONAL 'P -6'
+ X,Y,Z 
+ -Y,X-Y,Z 
+ Y-X,-X,Z 
+ X,Y,-Z
+ -Y,X-Y,-Z
+ Y-X,-X,-Z
+175 12 12 P6/m PG6/m HEXAGONAL 'P 6/m'
+ X,Y,Z 
+ -Y,X-Y,Z 
+ Y-X,-X,Z 
+ -X,-Y,Z 
+ Y,Y-X,Z 
+ X-Y,X,Z 
+ -X,-Y,-Z
+ Y,Y-X,-Z
+ X-Y,X,-Z
+ X,Y,-Z
+ -Y,X-Y,-Z
+ Y-X,-X,-Z
+176 12 12 P63/m PG6/m HEXAGONAL 'P 63/m'
+ X,Y,Z 
+ -Y,X-Y,Z 
+ Y-X,-X,Z 
+ -X,-Y,1/2+Z 
+ Y,Y-X,1/2+Z 
+ X-Y,X,1/2+Z 
+ -X,-Y,-Z
+ Y,Y-X,-Z
+ X-Y,X,-Z
+ X,Y,1/2-Z
+ -Y,X-Y,1/2-Z
+ Y-X,-X,1/2-Z
+177 12 12 P622 PG622 HEXAGONAL 'P 6 2 2'
+ X,Y,Z        
+ -Y,X-Y,Z       
+ Y-X,-X,Z
+ -X,-Y,Z
+ Y,Y-X,Z
+ X-Y,X,Z
+ Y,X,-Z       
+ X-Y,-Y,-Z
+ -X,Y-X,-Z      
+ -Y,-X,-Z     
+ Y-X,Y,-Z
+ X,X-Y,-Z      
+178 12 12 P6122 PG622 HEXAGONAL 'P 61 2 2'
+ X,Y,Z        
+ -Y,X-Y,1/3+Z   
+ Y-X,-X,2/3+Z
+ -X,-Y,1/2+Z  
+ Y,Y-X,5/6+Z   
+ X-Y,X,1/6+Z
+ Y,X,1/3-Z  
+ X-Y,-Y,-Z
+ -X,Y-X,2/3-Z
+ -Y,-X,5/6-Z
+ Y-X,Y,1/2-Z
+ X,X-Y,1/6-Z
+179 12 12 P6522 PG622 HEXAGONAL 'P 65 2 2'
+ X,Y,Z       
+ -Y,X-Y,2/3+Z   
+ Y-X,-X,1/3+Z
+ -X,-Y,1/2+Z  
+ Y,Y-X,1/6+Z   
+ X-Y,X,5/6+Z
+ Y,X,2/3-Z  
+ X-Y,-Y,-Z
+ -X,Y-X,1/3-Z   
+ -Y,-X,1/6-Z  
+ Y-X,Y,1/2-Z
+ X,X-Y,5/6-Z   
+180 12 12 P6222 PG622 HEXAGONAL 'P 62 2 2'
+ X,Y,Z        
+ -Y,X-Y,2/3+Z       
+ Y-X,-X,1/3+Z
+ -X,-Y,Z
+ Y,Y-X,2/3+Z
+ X-Y,X,1/3+Z
+ Y,X,2/3-Z       
+ X-Y,-Y,-Z
+ -X,Y-X,1/3-Z      
+ -Y,-X,2/3-Z     
+ Y-X,Y,-Z
+ X,X-Y,1/3-Z      
+181 12 12 P6422 PG622 HEXAGONAL 'P 64 2 2'
+ X,Y,Z        
+ -Y,X-Y,1/3+Z       
+ Y-X,-X,2/3+Z
+ -X,-Y,Z
+ Y,Y-X,1/3+Z
+ X-Y,X,2/3+Z
+ Y,X,1/3-Z       
+ X-Y,-Y,-Z
+ -X,Y-X,2/3-Z      
+ -Y,-X,1/3-Z     
+ Y-X,Y,-Z
+ X,X-Y,2/3-Z      
+182 12 12 P6322 PG622 HEXAGONAL 'P 63 2 2'
+ X,Y,Z        
+ -Y,X-Y,Z       
+ Y-X,-X,Z
+ -X,-Y,1/2+Z
+ Y,Y-X,1/2+Z
+ X-Y,X,1/2+Z
+ Y,X,-Z       
+ X-Y,-Y,-Z
+ -X,Y-X,-Z      
+ -Y,-X,1/2-Z     
+ Y-X,Y,1/2-Z
+ X,X-Y,1/2-Z      
+183 12 12 P6mm PG6mm HEXAGONAL 'P 6 m m'
+ X,Y,Z        
+ -Y,X-Y,Z       
+ Y-X,-X,Z
+ -X,-Y,Z
+ Y,Y-X,Z
+ X-Y,X,Z
+ -Y,-X,Z
+ Y-X,Y,Z
+ X,X-Y,Z
+ Y,X,Z
+ X-Y,-Y,Z
+ -X,Y-X,Z
+184 12 12 P6cc PG6mm HEXAGONAL 'P 6 c c'
+ X,Y,Z        
+ -Y,X-Y,Z       
+ Y-X,-X,Z
+ -X,-Y,Z
+ Y,Y-X,Z
+ X-Y,X,Z
+ -Y,-X,1/2+Z
+ Y-X,Y,1/2+Z
+ X,X-Y,1/2+Z
+ Y,X,1/2+Z
+ X-Y,-Y,1/2+Z
+ -X,Y-X,1/2+Z
+185 12 12 P63cm PG6mm HEXAGONAL 'P 63 c m'
+ X,Y,Z        
+ -Y,X-Y,Z       
+ Y-X,-X,Z
+ -X,-Y,1/2+Z
+ Y,Y-X,1/2+Z
+ X-Y,X,1/2+Z
+ -Y,-X,1/2+Z
+ Y-X,Y,1/2+Z
+ X,X-Y,1/2+Z
+ Y,X,Z
+ X-Y,-Y,Z
+ -X,Y-X,Z
+186 12 12 P63mc PG6mm HEXAGONAL 'P 63 m c'
+ X,Y,Z        
+ -Y,X-Y,Z       
+ Y-X,-X,Z
+ -X,-Y,1/2+Z
+ Y,Y-X,1/2+Z
+ X-Y,X,1/2+Z
+ -Y,-X,Z
+ Y-X,Y,Z
+ X,X-Y,Z
+ Y,X,1/2+Z
+ X-Y,-Y,1/2+Z
+ -X,Y-X,1/2+Z
+187 12 12 P-6m2 PG6barm2 HEXAGONAL 'P -6 m 2'
+ X,Y,Z        
+ -Y,X-Y,Z       
+ Y-X,-X,Z
+ X,Y,-Z
+ -Y,X-Y,-Z
+ Y-X,-X,-Z
+ -Y,-X,Z
+ Y-X,Y,Z
+ X,X-Y,Z
+ -Y,-X,-Z
+ Y-X,Y,-Z
+ X,X-Y,-Z
+188 12 12 P-6c2 PG6barm2 HEXAGONAL 'P -6 c 2'
+ X,Y,Z        
+ -Y,X-Y,Z       
+ Y-X,-X,Z
+ X,Y,1/2-Z
+ -Y,X-Y,1/2-Z
+ Y-X,-X,1/2-Z
+ -Y,-X,1/2+Z
+ Y-X,Y,1/2+Z
+ X,X-Y,1/2+Z
+ -Y,-X,-Z
+ Y-X,Y,-Z
+ X,X-Y,-Z
+189 12 12 P-62m PG6bar2m HEXAGONAL 'P -6 2 m'
+ X,Y,Z        
+ -Y,X-Y,Z       
+ Y-X,-X,Z
+ X,Y,-Z
+ -Y,X-Y,-Z
+ Y-X,-X,-Z
+ Y,X,-Z
+ X-Y,-Y,-Z
+ -X,Y-X,-Z
+ Y,X,Z
+ X-Y,-Y,Z
+ -X,Y-X,Z
+190 12 12 P-62c PG6bar2m HEXAGONAL 'P -6 2 c'
+ X,Y,Z        
+ -Y,X-Y,Z       
+ Y-X,-X,Z
+ X,Y,1/2-Z
+ -Y,X-Y,1/2-Z
+ Y-X,-X,1/2-Z
+ Y,X,-Z
+ X-Y,-Y,-Z
+ -X,Y-X,-Z
+ Y,X,1/2+Z
+ X-Y,-Y,1/2+Z
+ -X,Y-X,1/2+Z
+191 24 24 P6/mmm PG6/mmm HEXAGONAL 'P 6/m 2/m 2/m' 'P 6/m m m'
+ X,Y,Z 
+ -Y,X-Y,Z 
+ Y-X,-X,Z 
+ -X,-Y,Z 
+ Y,Y-X,Z 
+ X-Y,X,Z 
+ Y,X,-Z 
+ X-Y,-Y,-Z
+ -X,Y-X,-Z 
+ -Y,-X,-Z 
+ Y-X,Y,-Z
+ X,X-Y,-Z 
+ -X,-Y,-Z 
+ Y,Y-X,-Z 
+ X-Y,X,-Z 
+ X,Y,-Z 
+ Y-X,-X,-Z 
+ -Y,X-Y,-Z 
+ -Y,-X,Z 
+ Y-X,Y,Z
+ X,X-Y,Z 
+ Y,X,Z 
+ X-Y,-Y,Z
+ -X,Y-X,Z 
+192 24 24 P6/mcc PG6/mmm HEXAGONAL 'P 6/m 2/c 2/c' 'P 6/m c c'
+ X,Y,Z 
+ -Y,X-Y,Z 
+ Y-X,-X,Z 
+ -X,-Y,Z 
+ Y,Y-X,Z 
+ X-Y,X,Z 
+ Y,X,1/2-Z 
+ X-Y,-Y,1/2-Z
+ -X,Y-X,1/2-Z 
+ -Y,-X,1/2-Z 
+ Y-X,Y,1/2-Z
+ X,X-Y,1/2-Z 
+ -X,-Y,-Z 
+ Y,Y-X,-Z 
+ X-Y,X,-Z 
+ X,Y,-Z 
+ Y-X,-X,-Z 
+ -Y,X-Y,-Z 
+ -Y,-X,1/2+Z 
+ Y-X,Y,1/2+Z
+ X,X-Y,1/2+Z 
+ Y,X,1/2+Z 
+ X-Y,-Y,1/2+Z
+ -X,Y-X,1/2+Z 
+193 24 24 P63/mcm PG6/mmm HEXAGONAL 'P 63/m 2/c 2/m' 'P 63/m c m'
+ X,Y,Z 
+ -Y,X-Y,Z 
+ Y-X,-X,Z 
+ -X,-Y,1/2+Z 
+ Y,Y-X,1/2+Z 
+ X-Y,X,1/2+Z 
+ Y,X,1/2-Z 
+ X-Y,-Y,1/2-Z
+ -X,Y-X,1/2-Z 
+ -Y,-X,-Z 
+ Y-X,Y,-Z
+ X,X-Y,-Z 
+ -X,-Y,-Z 
+ Y,Y-X,-Z 
+ X-Y,X,-Z 
+ X,Y,1/2-Z 
+ Y-X,-X,1/2-Z 
+ -Y,X-Y,1/2-Z 
+ -Y,-X,1/2+Z 
+ Y-X,Y,1/2+Z
+ X,X-Y,1/2+Z 
+ Y,X,Z 
+ X-Y,-Y,Z
+ -X,Y-X,Z 
+194 24 24 P63/mmc PG6/mmm HEXAGONAL 'P 63/m 2/m 2/c' 'P 63/m m c'
+ X,Y,Z 
+ -Y,X-Y,Z 
+ Y-X,-X,Z 
+ -X,-Y,1/2+Z 
+ Y,Y-X,1/2+Z 
+ X-Y,X,1/2+Z 
+ Y,X,-Z 
+ X-Y,-Y,-Z
+ -X,Y-X,-Z 
+ -Y,-X,1/2-Z 
+ Y-X,Y,1/2-Z
+ X,X-Y,1/2-Z 
+ -X,-Y,-Z 
+ Y,Y-X,-Z 
+ X-Y,X,-Z 
+ X,Y,1/2-Z 
+ Y-X,-X,1/2-Z 
+ -Y,X-Y,1/2-Z 
+ -Y,-X,Z 
+ Y-X,Y,Z
+ X,X-Y,Z 
+ Y,X,1/2+Z 
+ X-Y,-Y,1/2+Z
+ -X,Y-X,1/2+Z 
+195 12 12 P23 PG23 CUBIC 'P 2 3'
+ X,Y,Z 
+ -X,-Y,Z 
+ -X,Y,-Z 
+ X,-Y,-Z 
+ Z,X,Y
+ Z,-X,-Y
+ -Z,-X,Y
+ -Z,X,-Y
+ Y,Z,X
+ -Y,Z,-X
+ Y,-Z,-X
+ -Y,-Z,X
+196 48 12 F23 PG23 CUBIC 'F 2 3'
+ X,Y,Z 
+ -X,-Y,Z 
+ -X,Y,-Z 
+ X,-Y,-Z 
+ Z,X,Y
+ Z,-X,-Y
+ -Z,-X,Y
+ -Z,X,-Y
+ Y,Z,X
+ -Y,Z,-X
+ Y,-Z,-X
+ -Y,-Z,X
+ X,1/2+Y,1/2+Z 
+ -X,1/2-Y,1/2+Z 
+ -X,1/2+Y,1/2-Z 
+ X,1/2-Y,1/2-Z 
+ Z,1/2+X,1/2+Y
+ Z,1/2-X,1/2-Y
+ -Z,1/2-X,1/2+Y
+ -Z,1/2+X,1/2-Y
+ Y,1/2+Z,1/2+X
+ -Y,1/2+Z,1/2-X
+ Y,1/2-Z,1/2-X
+ -Y,1/2-Z,1/2+X
+ 1/2+X,Y,1/2+Z 
+ 1/2-X,-Y,1/2+Z 
+ 1/2-X,Y,1/2-Z 
+ 1/2+X,-Y,1/2-Z 
+ 1/2+Z,X,1/2+Y
+ 1/2+Z,-X,1/2-Y
+ 1/2-Z,-X,1/2+Y
+ 1/2-Z,X,1/2-Y
+ 1/2+Y,Z,1/2+X
+ 1/2-Y,Z,1/2-X
+ 1/2+Y,-Z,1/2-X
+ 1/2-Y,-Z,1/2+X
+ 1/2+X,1/2+Y,Z 
+ 1/2-X,1/2-Y,Z 
+ 1/2-X,1/2+Y,-Z 
+ 1/2+X,1/2-Y,-Z 
+ 1/2+Z,1/2+X,Y
+ 1/2+Z,1/2-X,-Y
+ 1/2-Z,1/2-X,Y
+ 1/2-Z,1/2+X,-Y
+ 1/2+Y,1/2+Z,X
+ 1/2-Y,1/2+Z,-X
+ 1/2+Y,1/2-Z,-X
+ 1/2-Y,1/2-Z,X
+197 24 12 I23 PG23 CUBIC 'I 2 3'
+ X,Y,Z 
+ -X,-Y,Z 
+ -X,Y,-Z 
+ X,-Y,-Z 
+ Z,X,Y
+ Z,-X,-Y
+ -Z,-X,Y
+ -Z,X,-Y
+ Y,Z,X
+ -Y,Z,-X
+ Y,-Z,-X
+ -Y,-Z,X
+ 1/2+X,1/2+Y,1/2+Z 
+ 1/2-X,1/2-Y,1/2+Z 
+ 1/2-X,1/2+Y,1/2-Z 
+ 1/2+X,1/2-Y,1/2-Z 
+ 1/2+Z,1/2+X,1/2+Y
+ 1/2+Z,1/2-X,1/2-Y
+ 1/2-Z,1/2-X,1/2+Y
+ 1/2-Z,1/2+X,1/2-Y
+ 1/2+Y,1/2+Z,1/2+X
+ 1/2-Y,1/2+Z,1/2-X
+ 1/2+Y,1/2-Z,1/2-X
+ 1/2-Y,1/2-Z,1/2+X
+198 12 12 P213 PG23 CUBIC 'P 21 3'
+ X,Y,Z 
+ 1/2-X,-Y,1/2+Z 
+ -X,1/2+Y,1/2-Z 
+ 1/2+X,1/2-Y,-Z 
+ Z,X,Y
+ 1/2+Z,1/2-X,-Y
+ 1/2-Z,-X,1/2+Y
+ -Z,1/2+X,1/2-Y
+ Y,Z,X
+ -Y,1/2+Z,1/2-X
+ 1/2+Y,1/2-Z,-X
+ 1/2-Y,-Z,1/2+X
+199 24 12 I213 PG23 CUBIC 'I 21 3'
+ X,Y,Z
+ 1/2-X,-Y,1/2+Z 
+ -X,1/2+Y,1/2-Z 
+ 1/2+X,1/2-Y,-Z 
+ Z,X,Y
+ 1/2+Z,1/2-X,-Y
+ 1/2-Z,-X,1/2+Y
+ -Z,1/2+X,1/2-Y
+ Y,Z,X
+ -Y,1/2+Z,1/2-X
+ 1/2+Y,1/2-Z,-X
+ 1/2-Y,-Z,1/2+X
+ 1/2+X,1/2+Y,1/2+Z
+ -X,1/2-Y,Z 
+ 1/2-X,Y,-Z 
+ X,-Y,1/2-Z 
+ 1/2+Z,1/2+X,1/2+Y
+ Z,-X,1/2-Y
+ -Z,1/2-X,Y
+ 1/2-Z,X,-Y
+ 1/2+Y,1/2+Z,1/2+X
+ 1/2-Y,Z,-X
+ Y,-Z,1/2-X
+ -Y,1/2-Z,X
+200 24 24 Pm-3 PGm3bar CUBIC 'P 2/m -3' 'P m -3'
+ X,Y,Z 
+ -X,-Y,Z 
+ -X,Y,-Z 
+ X,-Y,-Z 
+ Z,X,Y
+ Z,-X,-Y
+ -Z,-X,Y
+ -Z,X,-Y
+ Y,Z,X
+ -Y,Z,-X
+ Y,-Z,-X
+ -Y,-Z,X
+ -X,-Y,-Z
+ X,Y,-Z
+ X,-Y,Z
+ -X,Y,Z
+ -Z,-X,-Y
+ -Z,X,Y
+ Z,X,-Y
+ Z,-X,Y
+ -Y,-Z,-X
+ Y,-Z,X
+ -Y,Z,X
+ Y,Z,-X
+201 24 24 Pn-3 PGm3bar CUBIC 'P 2/n -3' 'P n -3'
+ X,Y,Z 
+ -X,-Y,Z 
+ -X,Y,-Z 
+ X,-Y,-Z 
+ Z,X,Y
+ Z,-X,-Y
+ -Z,-X,Y
+ -Z,X,-Y
+ Y,Z,X
+ -Y,Z,-X
+ Y,-Z,-X
+ -Y,-Z,X
+ 1/2-X,1/2-Y,1/2-Z
+ 1/2+X,1/2+Y,1/2-Z
+ 1/2+X,1/2-Y,1/2+Z
+ 1/2-X,1/2+Y,1/2+Z
+ 1/2-Z,1/2-X,1/2-Y
+ 1/2-Z,1/2+X,1/2+Y
+ 1/2+Z,1/2+X,1/2-Y
+ 1/2+Z,1/2-X,1/2+Y
+ 1/2-Y,1/2-Z,1/2-X
+ 1/2+Y,1/2-Z,1/2+X
+ 1/2-Y,1/2+Z,1/2+X
+ 1/2+Y,1/2+Z,1/2-X
+202 96 24 Fm-3 PGm3bar CUBIC 'F 2/m -3' 'F m -3'
+ X,Y,Z 
+ -X,-Y,Z 
+ -X,Y,-Z 
+ X,-Y,-Z 
+ Z,X,Y
+ Z,-X,-Y
+ -Z,-X,Y
+ -Z,X,-Y
+ Y,Z,X
+ -Y,Z,-X
+ Y,-Z,-X
+ -Y,-Z,X
+ -X,-Y,-Z
+ X,Y,-Z
+ X,-Y,Z
+ -X,Y,Z
+ -Z,-X,-Y
+ -Z,X,Y
+ Z,X,-Y
+ Z,-X,Y
+ -Y,-Z,-X
+ Y,-Z,X
+ -Y,Z,X
+ Y,Z,-X
+ X,1/2+Y,1/2+Z 
+ -X,1/2-Y,1/2+Z 
+ -X,1/2+Y,1/2-Z 
+ X,1/2-Y,1/2-Z 
+ Z,1/2+X,1/2+Y
+ Z,1/2-X,1/2-Y
+ -Z,1/2-X,1/2+Y
+ -Z,1/2+X,1/2-Y
+ Y,1/2+Z,1/2+X
+ -Y,1/2+Z,1/2-X
+ Y,1/2-Z,1/2-X
+ -Y,1/2-Z,1/2+X
+ -X,1/2-Y,1/2-Z
+ X,1/2+Y,1/2-Z
+ X,1/2-Y,1/2+Z
+ -X,1/2+Y,1/2+Z
+ -Z,1/2-X,1/2-Y
+ -Z,1/2+X,1/2+Y
+ Z,1/2+X,1/2-Y
+ Z,1/2-X,1/2+Y
+ -Y,1/2-Z,1/2-X
+ Y,1/2-Z,1/2+X
+ -Y,1/2+Z,1/2+X
+ Y,1/2+Z,1/2-X
+ 1/2+X,Y,1/2+Z 
+ 1/2-X,-Y,1/2+Z 
+ 1/2-X,Y,1/2-Z 
+ 1/2+X,-Y,1/2-Z 
+ 1/2+Z,X,1/2+Y
+ 1/2+Z,-X,1/2-Y
+ 1/2-Z,-X,1/2+Y
+ 1/2-Z,X,1/2-Y
+ 1/2+Y,Z,1/2+X
+ 1/2-Y,Z,1/2-X
+ 1/2+Y,-Z,1/2-X
+ 1/2-Y,-Z,1/2+X
+ 1/2-X,-Y,1/2-Z
+ 1/2+X,Y,1/2-Z
+ 1/2+X,-Y,1/2+Z
+ 1/2-X,Y,1/2+Z
+ 1/2-Z,-X,1/2-Y
+ 1/2-Z,X,1/2+Y
+ 1/2+Z,X,1/2-Y
+ 1/2+Z,-X,1/2+Y
+ 1/2-Y,-Z,1/2-X
+ 1/2+Y,-Z,1/2+X
+ 1/2-Y,Z,1/2+X
+ 1/2+Y,Z,1/2-X
+ 1/2+X,1/2+Y,Z 
+ 1/2-X,1/2-Y,Z 
+ 1/2-X,1/2+Y,-Z 
+ 1/2+X,1/2-Y,-Z 
+ 1/2+Z,1/2+X,Y
+ 1/2+Z,1/2-X,-Y
+ 1/2-Z,1/2-X,Y
+ 1/2-Z,1/2+X,-Y
+ 1/2+Y,1/2+Z,X
+ 1/2-Y,1/2+Z,-X
+ 1/2+Y,1/2-Z,-X
+ 1/2-Y,1/2-Z,X
+ 1/2-X,1/2-Y,-Z
+ 1/2+X,1/2+Y,-Z
+ 1/2+X,1/2-Y,Z
+ 1/2-X,1/2+Y,Z
+ 1/2-Z,1/2-X,-Y
+ 1/2-Z,1/2+X,Y
+ 1/2+Z,1/2+X,-Y
+ 1/2+Z,1/2-X,Y
+ 1/2-Y,1/2-Z,-X
+ 1/2+Y,1/2-Z,X
+ 1/2-Y,1/2+Z,X
+ 1/2+Y,1/2+Z,-X
+203 96 24 Fd-3 PGm3bar CUBIC 'F 2/d -3' 'F d -3'
+ X,Y,Z
+ -X,-Y,Z
+ -X,Y,-Z
+ X,-Y,-Z
+ Z,X,Y
+ Z,-X,-Y
+ -Z,-X,Y
+ -Z,X,-Y
+ Y,Z,X
+ -Y,Z,-X
+ Y,-Z,-X
+ -Y,-Z,X
+ 1/4-X,1/4-Y,1/4-Z
+ 1/4+X,1/4+Y,1/4-Z
+ 1/4+X,1/4-Y,1/4+Z
+ 1/4-X,1/4+Y,1/4+Z
+ 1/4-Z,1/4-X,1/4-Y
+ 1/4-Z,1/4+X,1/4+Y
+ 1/4+Z,1/4+X,1/4-Y
+ 1/4+Z,1/4-X,1/4+Y
+ 1/4-Y,1/4-Z,1/4-X 
+ 1/4+Y,1/4-Z,1/4+X
+ 1/4-Y,1/4+Z,1/4+X
+ 1/4+Y,1/4+Z,1/4-X
+ X,1/2+Y,1/2+Z
+ -X,1/2-Y,1/2+Z
+ -X,1/2+Y,1/2-Z
+ X,1/2-Y,1/2-Z
+ Z,1/2+X,1/2+Y
+ Z,1/2-X,1/2-Y
+ -Z,1/2-X,1/2+Y
+ -Z,1/2+X,1/2-Y
+ Y,1/2+Z,1/2+X
+ -Y,1/2+Z,1/2-X
+ Y,1/2-Z,1/2-X
+ -Y,1/2-Z,1/2+X
+ 1/4-X,3/4-Y,3/4-Z
+ 1/4+X,3/4+Y,3/4-Z
+ 1/4+X,3/4-Y,3/4+Z
+ 1/4-X,3/4+Y,3/4+Z
+ 1/4-Z,3/4-X,3/4-Y
+ 1/4-Z,3/4+X,3/4+Y
+ 1/4+Z,3/4+X,3/4-Y
+ 1/4+Z,3/4-X,3/4+Y
+ 1/4-Y,3/4-Z,3/4-X 
+ 1/4+Y,3/4-Z,3/4+X
+ 1/4-Y,3/4+Z,3/4+X
+ 1/4+Y,3/4+Z,3/4-X
+ 1/2+X,Y,1/2+Z
+ 1/2-X,-Y,1/2+Z
+ 1/2-X,Y,1/2-Z
+ 1/2+X,-Y,1/2-Z
+ 1/2+Z,X,1/2+Y
+ 1/2+Z,-X,1/2-Y
+ 1/2-Z,-X,1/2+Y
+ 1/2-Z,X,1/2-Y
+ 1/2+Y,Z,1/2+X
+ 1/2-Y,Z,1/2-X
+ 1/2+Y,-Z,1/2-X
+ 1/2-Y,-Z,1/2+X
+ 3/4-X,1/4-Y,3/4-Z
+ 3/4+X,1/4+Y,3/4-Z
+ 3/4+X,1/4-Y,3/4+Z
+ 3/4-X,1/4+Y,3/4+Z
+ 3/4-Z,1/4-X,3/4-Y
+ 3/4-Z,1/4+X,3/4+Y
+ 3/4+Z,1/4+X,3/4-Y
+ 3/4+Z,1/4-X,3/4+Y
+ 3/4-Y,1/4-Z,3/4-X 
+ 3/4+Y,1/4-Z,3/4+X
+ 3/4-Y,1/4+Z,3/4+X
+ 3/4+Y,1/4+Z,3/4-X
+ 1/2+X,1/2+Y,Z
+ 1/2-X,1/2-Y,Z
+ 1/2-X,1/2+Y,-Z
+ 1/2+X,1/2-Y,-Z
+ 1/2+Z,1/2+X,Y
+ 1/2+Z,1/2-X,-Y
+ 1/2-Z,1/2-X,Y
+ 1/2-Z,1/2+X,-Y
+ 1/2+Y,1/2+Z,X
+ 1/2-Y,1/2+Z,-X
+ 1/2+Y,1/2-Z,-X
+ 1/2-Y,1/2-Z,X
+ 3/4-X,3/4-Y,1/4-Z
+ 3/4+X,3/4+Y,1/4-Z
+ 3/4+X,3/4-Y,Z+1/4
+ 3/4-X,3/4+Y,Z+1/4
+ 3/4-Z,3/4-X,1/4-Y
+ 3/4-Z,3/4+X,1/4+Y
+ 3/4+Z,3/4+X,1/4-Y
+ 3/4+Z,3/4-X,1/4+Y
+ 3/4-Y,3/4-Z,1/4-X 
+ 3/4+Y,3/4-Z,1/4+X
+ 3/4-Y,3/4+Z,1/4+X
+ 3/4+Y,3/4+Z,1/4-X
+204 48 24 Im-3 PGm3bar CUBIC 'I 2/m -3' 'I m -3'
+ X,Y,Z 
+ -X,-Y,Z 
+ -X,Y,-Z 
+ X,-Y,-Z 
+ Z,X,Y
+ Z,-X,-Y
+ -Z,-X,Y
+ -Z,X,-Y
+ Y,Z,X
+ -Y,Z,-X
+ Y,-Z,-X
+ -Y,-Z,X
+ -X,-Y,-Z
+ X,Y,-Z
+ X,-Y,Z
+ -X,Y,Z
+ -Z,-X,-Y
+ -Z,X,Y
+ Z,X,-Y
+ Z,-X,Y
+ -Y,-Z,-X
+ Y,-Z,X
+ -Y,Z,X
+ Y,Z,-X
+ 1/2+X,1/2+Y,1/2+Z 
+ 1/2-X,1/2-Y,1/2+Z 
+ 1/2-X,1/2+Y,1/2-Z 
+ 1/2+X,1/2-Y,1/2-Z 
+ 1/2+Z,1/2+X,1/2+Y
+ 1/2+Z,1/2-X,1/2-Y
+ 1/2-Z,1/2-X,1/2+Y
+ 1/2-Z,1/2+X,1/2-Y
+ 1/2+Y,1/2+Z,1/2+X
+ 1/2-Y,1/2+Z,1/2-X
+ 1/2+Y,1/2-Z,1/2-X
+ 1/2-Y,1/2-Z,1/2+X
+ 1/2-X,1/2-Y,1/2-Z
+ 1/2+X,1/2+Y,1/2-Z
+ 1/2+X,1/2-Y,1/2+Z
+ 1/2-X,1/2+Y,1/2+Z
+ 1/2-Z,1/2-X,1/2-Y
+ 1/2-Z,1/2+X,1/2+Y
+ 1/2+Z,1/2+X,1/2-Y
+ 1/2+Z,1/2-X,1/2+Y
+ 1/2-Y,1/2-Z,1/2-X
+ 1/2+Y,1/2-Z,1/2+X
+ 1/2-Y,1/2+Z,1/2+X
+ 1/2+Y,1/2+Z,1/2-X
+205 24 24 Pa-3 PGm3bar CUBIC 'P 21/a -3' 'P a -3'
+ X,Y,Z 
+ 1/2-X,-Y,1/2+Z 
+ -X,1/2+Y,1/2-Z 
+ 1/2+X,1/2-Y,-Z 
+ Z,X,Y
+ 1/2+Z,1/2-X,-Y
+ 1/2-Z,-X,1/2+Y
+ -Z,1/2+X,1/2-Y
+ Y,Z,X
+ -Y,1/2+Z,1/2-X
+ 1/2+Y,1/2-Z,-X
+ 1/2-Y,-Z,1/2+X
+ -X,-Y,-Z
+ 1/2+X,Y,1/2-Z
+ X,1/2-Y,1/2+Z
+ 1/2-X,1/2+Y,Z
+ -Z,-X,-Y
+ 1/2-Z,1/2+X,Y
+ 1/2+Z,X,1/2-Y
+ Z,1/2-X,1/2+Y
+ -Y,-Z,-X
+ Y,1/2-Z,1/2+X
+ 1/2-Y,1/2+Z,X
+ 1/2+Y,Z,1/2-X
+206 48 24 Ia-3 PGm3bar CUBIC 'I 21/a -3' 'I a -3'
+ X,Y,Z 
+ 1/2-X,-Y,1/2+Z 
+ -X,1/2+Y,1/2-Z 
+ 1/2+X,1/2-Y,-Z 
+ Z,X,Y
+ 1/2+Z,1/2-X,-Y
+ 1/2-Z,-X,1/2+Y
+ -Z,1/2+X,1/2-Y
+ Y,Z,X
+ -Y,1/2+Z,1/2-X
+ 1/2+Y,1/2-Z,-X
+ 1/2-Y,-Z,1/2+X
+ -X,-Y,-Z
+ 1/2+X,Y,1/2-Z
+ X,1/2-Y,1/2+Z
+ 1/2-X,1/2+Y,Z
+ -Z,-X,-Y
+ 1/2-Z,1/2+X,Y
+ 1/2+Z,X,1/2-Y
+ Z,1/2-X,1/2+Y
+ -Y,-Z,-X
+ Y,1/2-Z,1/2+X
+ 1/2-Y,1/2+Z,X
+ 1/2+Y,Z,1/2-X
+ 1/2+X,1/2+Y,1/2+Z 
+ -X,1/2-Y,Z 
+ 1/2-X,+Y,-Z 
+ X,-Y,1/2-Z 
+ 1/2+Z,1/2+X,1/2+Y
+ Z,-X,1/2-Y
+ -Z,1/2-X,Y
+ 1/2-Z,X,-Y
+ 1/2+Y,1/2+Z,1/2+X
+ 1/2-Y,Z,-X
+ Y,-Z,1/2-X
+ -Y,1/2-Z,X
+ 1/2-X,1/2-Y,1/2-Z
+ X,1/2+Y,-Z
+ 1/2+X,-Y,Z
+ -X,Y,1/2+Z
+ 1/2-Z,1/2-X,1/2-Y
+ -Z,X,1/2+Y
+ Z,1/2+X,-Y
+ 1/2+Z,-X,Y
+ 1/2-Y,1/2-Z,1/2-X
+ 1/2+Y,-Z,X
+ -Y,Z,1/2+X
+ Y,1/2+Z,-X
+207 24 24 P432 PG432 CUBIC 'P 4 3 2'
+ X,Y,Z 
+ -X,-Y,Z 
+ -X,Y,-Z 
+ X,-Y,-Z 
+ Z,X,Y
+ Z,-X,-Y
+ -Z,-X,Y
+ -Z,X,-Y
+ Y,Z,X
+ -Y,Z,-X
+ Y,-Z,-X
+ -Y,-Z,X
+ Y,X,-Z
+ -Y,-X,-Z
+ Y,-X,Z
+ -Y,X,Z
+ X,Z,-Y
+ -X,Z,Y
+ -X,-Z,-Y
+ X,-Z,Y
+ Z,Y,-X
+ Z,-Y,X
+ -Z,Y,X
+ -Z,-Y,-X
+208 24 24 P4232 PG432 CUBIC 'P 42 3 2'
+ X,Y,Z 
+ -X,-Y,Z 
+ -X,Y,-Z 
+ X,-Y,-Z 
+ Z,X,Y
+ Z,-X,-Y
+ -Z,-X,Y
+ -Z,X,-Y
+ Y,Z,X
+ -Y,Z,-X
+ Y,-Z,-X
+ -Y,-Z,X
+ 1/2+Y,1/2+X,1/2-Z
+ 1/2-Y,1/2-X,1/2-Z
+ 1/2+Y,1/2-X,1/2+Z
+ 1/2-Y,1/2+X,1/2+Z
+ 1/2+X,1/2+Z,1/2-Y
+ 1/2-X,1/2+Z,1/2+Y
+ 1/2-X,1/2-Z,1/2-Y
+ 1/2+X,1/2-Z,1/2+Y
+ 1/2+Z,1/2+Y,1/2-X
+ 1/2+Z,1/2-Y,1/2+X
+ 1/2-Z,1/2+Y,1/2+X
+ 1/2-Z,1/2-Y,1/2-X
+209 96 24 F432 PG432 CUBIC 'F 4 3 2'
+ X,Y,Z 
+ -X,-Y,Z 
+ -X,Y,-Z 
+ X,-Y,-Z 
+ Z,X,Y
+ Z,-X,-Y
+ -Z,-X,Y
+ -Z,X,-Y
+ Y,Z,X
+ -Y,Z,-X
+ Y,-Z,-X
+ -Y,-Z,X
+ Y,X,-Z
+ -Y,-X,-Z
+ Y,-X,Z
+ -Y,X,Z
+ X,Z,-Y
+ -X,Z,Y
+ -X,-Z,-Y
+ X,-Z,Y
+ Z,Y,-X
+ Z,-Y,X
+ -Z,Y,X
+ -Z,-Y,-X
+ X,1/2+Y,1/2+Z 
+ -X,1/2-Y,1/2+Z 
+ -X,1/2+Y,1/2-Z 
+ X,1/2-Y,1/2-Z 
+ Z,1/2+X,1/2+Y
+ Z,1/2-X,1/2-Y
+ -Z,1/2-X,1/2+Y
+ -Z,1/2+X,1/2-Y
+ Y,1/2+Z,1/2+X
+ -Y,1/2+Z,1/2-X
+ Y,1/2-Z,1/2-X
+ -Y,1/2-Z,1/2+X
+ Y,1/2+X,1/2-Z
+ -Y,1/2-X,1/2-Z
+ Y,1/2-X,1/2+Z
+ -Y,1/2+X,1/2+Z
+ X,1/2+Z,1/2-Y
+ -X,1/2+Z,1/2+Y
+ -X,1/2-Z,1/2-Y
+ X,1/2-Z,1/2+Y
+ Z,1/2+Y,1/2-X
+ Z,1/2-Y,1/2+X
+ -Z,1/2+Y,1/2+X
+ -Z,1/2-Y,1/2-X
+ 1/2+X,Y,1/2+Z 
+ 1/2-X,-Y,1/2+Z 
+ 1/2-X,Y,1/2-Z 
+ 1/2+X,-Y,1/2-Z 
+ 1/2+Z,X,1/2+Y
+ 1/2+Z,-X,1/2-Y
+ 1/2-Z,-X,1/2+Y
+ 1/2-Z,X,1/2-Y
+ 1/2+Y,Z,1/2+X
+ 1/2-Y,Z,1/2-X
+ 1/2+Y,-Z,1/2-X
+ 1/2-Y,-Z,1/2+X
+ 1/2+Y,X,1/2-Z
+ 1/2-Y,-X,1/2-Z
+ 1/2+Y,-X,1/2+Z
+ 1/2-Y,X,1/2+Z
+ 1/2+X,Z,1/2-Y
+ 1/2-X,Z,1/2+Y
+ 1/2-X,-Z,1/2-Y
+ 1/2+X,-Z,1/2+Y
+ 1/2+Z,Y,1/2-X
+ 1/2+Z,-Y,1/2+X
+ 1/2-Z,Y,1/2+X
+ 1/2-Z,-Y,1/2-X
+ 1/2+X,1/2+Y,Z 
+ 1/2-X,1/2-Y,Z 
+ 1/2-X,1/2+Y,-Z 
+ 1/2+X,1/2-Y,-Z 
+ 1/2+Z,1/2+X,Y
+ 1/2+Z,1/2-X,-Y
+ 1/2-Z,1/2-X,Y
+ 1/2-Z,1/2+X,-Y
+ 1/2+Y,1/2+Z,X
+ 1/2-Y,1/2+Z,-X
+ 1/2+Y,1/2-Z,-X
+ 1/2-Y,1/2-Z,X
+ 1/2+Y,1/2+X,-Z
+ 1/2-Y,1/2-X,-Z
+ 1/2+Y,1/2-X,Z
+ 1/2-Y,1/2+X,Z
+ 1/2+X,1/2+Z,-Y
+ 1/2-X,1/2+Z,Y
+ 1/2-X,1/2-Z,-Y
+ 1/2+X,1/2-Z,Y
+ 1/2+Z,1/2+Y,-X
+ 1/2+Z,1/2-Y,X
+ 1/2-Z,1/2+Y,X
+ 1/2-Z,1/2-Y,-X
+210 96 24 F4132 PG432 CUBIC 'F 41 3 2'
+ X,Y,Z 
+ -X,1/2-Y,1/2+Z 
+ 1/2-X,1/2+Y,-Z 
+ 1/2+X,-Y,1/2-Z 
+ Z,X,Y
+ 1/2+Z,-X,1/2-Y
+ -Z,1/2-X,1/2+Y
+ 1/2-Z,1/2+X,-Y
+ Y,Z,X
+ 1/2-Y,1/2+Z,-X
+ 1/2+Y,-Z,1/2-X
+ -Y,1/2-Z,1/2+X
+ 3/4+Y,1/4+X,3/4-Z
+ 1/4-Y,1/4-X,1/4-Z
+ 1/4+Y,3/4-X,3/4+Z
+ 3/4-Y,3/4+X,1/4+Z
+ 3/4+X,1/4+Z,3/4-Y
+ 3/4-X,3/4+Z,1/4+Y
+ 1/4-X,1/4-Z,1/4-Y
+ 1/4+X,3/4-Z,3/4+Y
+ 3/4+Z,1/4+Y,3/4-X
+ 1/4+Z,3/4-Y,3/4+X
+ 3/4-Z,3/4+Y,1/4+X
+ 1/4-Z,1/4-Y,1/4-X
+ X,1/2+Y,1/2+Z 
+ -X,-Y,Z 
+ 1/2-X,Y,1/2-Z 
+ 1/2+X,1/2-Y,-Z 
+ Z,1/2+X,1/2+Y
+ 1/2+Z,1/2-X,-Y
+ -Z,-X,Y
+ 1/2-Z,X,1/2-Y
+ Y,1/2+Z,1/2+X
+ 1/2-Y,Z,1/2-X
+ 1/2+Y,1/2-Z,-X
+ -Y,-Z,X
+ 3/4+Y,3/4+X,1/4-Z
+ 1/4-Y,3/4-X,3/4-Z
+ 1/4+Y,1/4-X,1/4+Z
+ 3/4-Y,1/4+X,3/4+Z
+ 3/4+X,3/4+Z,1/4-Y
+ 3/4-X,1/4+Z,3/4+Y
+ 1/4-X,3/4-Z,3/4-Y
+ 1/4+X,1/4-Z,1/4+Y
+ 3/4+Z,3/4+Y,1/4-X
+ 1/4+Z,1/4-Y,1/4+X
+ 3/4-Z,1/4+Y,3/4+X
+ 1/4-Z,3/4-Y,3/4-X
+ 1/2+X,Y,1/2+Z 
+ 1/2-X,1/2-Y,Z 
+ -X,1/2+Y,1/2-Z 
+ X,-Y,-Z 
+ 1/2+Z,X,1/2+Y
+ Z,-X,-Y
+ 1/2-Z,1/2-X,Y
+ -Z,1/2+X,1/2-Y
+ 1/2+Y,Z,1/2+X
+ -Y,1/2+Z,1/2-X
+ Y,-Z,-X
+ 1/2-Y,1/2-Z,X
+ 1/4+Y,1/4+X,1/4-Z
+ 3/4-Y,1/4-X,3/4-Z
+ 3/4+Y,3/4-X,1/4+Z
+ 1/4-Y,3/4+X,3/4+Z
+ 1/4+X,1/4+Z,1/4-Y
+ 1/4-X,3/4+Z,3/4+Y
+ 3/4-X,1/4-Z,3/4-Y
+ 3/4+X,3/4-Z,1/4+Y
+ 1/4+Z,1/4+Y,1/4-X
+ 3/4+Z,3/4-Y,1/4+X
+ 1/4-Z,3/4+Y,3/4+X
+ 3/4-Z,1/4-Y,3/4-X
+ 1/2+X,1/2+Y,Z 
+ 1/2-X,-Y,1/2+Z 
+ -X,Y,-Z 
+ X,1/2-Y,1/2-Z 
+ 1/2+Z,1/2+X,Y
+ Z,1/2-X,1/2-Y
+ 1/2-Z,-X,1/2+Y
+ -Z,X,-Y
+ 1/2+Y,1/2+Z,X
+ -Y,Z,-X
+ Y,1/2-Z,1/2-X
+ 1/2-Y,-Z,1/2+X
+ 1/4+Y,3/4+X,3/4-Z
+ 3/4-Y,3/4-X,1/4-Z
+ 3/4+Y,1/4-X,3/4+Z
+ 1/4-Y,1/4+X,1/4+Z
+ 1/4+X,3/4+Z,3/4-Y
+ 1/4-X,1/4+Z,1/4+Y
+ 3/4-X,3/4-Z,1/4-Y
+ 3/4+X,1/4-Z,3/4+Y
+ 1/4+Z,3/4+Y,3/4-X
+ 3/4+Z,1/4-Y,3/4+X
+ 1/4-Z,1/4+Y,1/4+X
+ 3/4-Z,3/4-Y,1/4-X
+211 48 24 I432 PG432 CUBIC 'I 4 3 2'
+ X,Y,Z 
+ -X,-Y,Z 
+ -X,Y,-Z 
+ X,-Y,-Z 
+ Z,X,Y
+ Z,-X,-Y
+ -Z,-X,Y
+ -Z,X,-Y
+ Y,Z,X
+ -Y,Z,-X
+ Y,-Z,-X
+ -Y,-Z,X
+ Y,X,-Z
+ -Y,-X,-Z
+ Y,-X,Z
+ -Y,X,Z
+ X,Z,-Y
+ -X,Z,Y
+ -X,-Z,-Y
+ X,-Z,Y
+ Z,Y,-X
+ Z,-Y,X
+ -Z,Y,X
+ -Z,-Y,-X
+ 1/2+X,1/2+Y,1/2+Z 
+ 1/2-X,1/2-Y,1/2+Z 
+ 1/2-X,1/2+Y,1/2-Z 
+ 1/2+X,1/2-Y,1/2-Z 
+ 1/2+Z,1/2+X,1/2+Y
+ 1/2+Z,1/2-X,1/2-Y
+ 1/2-Z,1/2-X,1/2+Y
+ 1/2-Z,1/2+X,1/2-Y
+ 1/2+Y,1/2+Z,1/2+X
+ 1/2-Y,1/2+Z,1/2-X
+ 1/2+Y,1/2-Z,1/2-X
+ 1/2-Y,1/2-Z,1/2+X
+ 1/2+Y,1/2+X,1/2-Z
+ 1/2-Y,1/2-X,1/2-Z
+ 1/2+Y,1/2-X,1/2+Z
+ 1/2-Y,1/2+X,1/2+Z
+ 1/2+X,1/2+Z,1/2-Y
+ 1/2-X,1/2+Z,1/2+Y
+ 1/2-X,1/2-Z,1/2-Y
+ 1/2+X,1/2-Z,1/2+Y
+ 1/2+Z,1/2+Y,1/2-X
+ 1/2+Z,1/2-Y,1/2+X
+ 1/2-Z,1/2+Y,1/2+X
+ 1/2-Z,1/2-Y,1/2-X
+212 24 24 P4332 PG432 CUBIC 'P 43 3 2'
+ X,Y,Z 
+ 1/2-X,-Y,1/2+Z 
+ -X,1/2+Y,1/2-Z 
+ 1/2+X,1/2-Y,-Z 
+ Z,X,Y
+ 1/2+Z,1/2-X,-Y
+ 1/2-Z,-X,1/2+Y
+ -Z,1/2+X,1/2-Y
+ Y,Z,X
+ -Y,1/2+Z,1/2-X
+ 1/2+Y,1/2-Z,-X
+ 1/2-Y,-Z,1/2+X
+ 1/4+Y,3/4+X,3/4-Z
+ 1/4-Y,1/4-X,1/4-Z
+ 3/4+Y,3/4-X,1/4+Z
+ 3/4-Y,1/4+X,3/4+Z
+ 1/4+X,3/4+Z,3/4-Y
+ 3/4-X,1/4+Z,3/4+Y
+ 1/4-X,1/4-Z,1/4-Y
+ 3/4+X,3/4-Z,1/4+Y
+ 1/4+Z,3/4+Y,3/4-X
+ 3/4+Z,3/4-Y,1/4+X
+ 3/4-Z,1/4+Y,3/4+X
+ 1/4-Z,1/4-Y,1/4-X
+213 24 24 P4132 PG432 CUBIC 'P 41 3 2'
+ X,Y,Z 
+ 1/2-X,-Y,1/2+Z 
+ -X,1/2+Y,1/2-Z 
+ 1/2+X,1/2-Y,-Z 
+ Z,X,Y
+ 1/2+Z,1/2-X,-Y
+ 1/2-Z,-X,1/2+Y
+ -Z,1/2+X,1/2-Y
+ Y,Z,X
+ -Y,1/2+Z,1/2-X
+ 1/2+Y,1/2-Z,-X
+ 1/2-Y,-Z,1/2+X
+ 3/4+Y,1/4+X,1/4-Z
+ 3/4-Y,3/4-X,3/4-Z
+ 1/4+Y,1/4-X,3/4+Z
+ 1/4-Y,3/4+X,1/4+Z
+ 3/4+X,1/4+Z,1/4-Y
+ 1/4-X,3/4+Z,1/4+Y
+ 3/4-X,3/4-Z,3/4-Y
+ 1/4+X,1/4-Z,3/4+Y
+ 3/4+Z,1/4+Y,1/4-X
+ 1/4+Z,1/4-Y,3/4+X
+ 1/4-Z,3/4+Y,1/4+X
+ 3/4-Z,3/4-Y,3/4-X
+214 48 24 I4132 PG432 CUBIC 'I 41 3 2'
+ X,Y,Z 
+ 1/2-X,-Y,1/2+Z 
+ -X,1/2+Y,1/2-Z 
+ 1/2+X,1/2-Y,-Z 
+ Z,X,Y
+ 1/2+Z,1/2-X,-Y
+ 1/2-Z,-X,1/2+Y
+ -Z,1/2+X,1/2-Y
+ Y,Z,X
+ -Y,1/2+Z,1/2-X
+ 1/2+Y,1/2-Z,-X
+ 1/2-Y,-Z,1/2+X
+ 3/4+Y,1/4+X,1/4-Z
+ 3/4-Y,3/4-X,3/4-Z
+ 1/4+Y,1/4-X,3/4+Z
+ 1/4-Y,3/4+X,1/4+Z
+ 3/4+X,1/4+Z,1/4-Y
+ 1/4-X,3/4+Z,1/4+Y
+ 3/4-X,3/4-Z,3/4-Y
+ 1/4+X,1/4-Z,3/4+Y
+ 3/4+Z,1/4+Y,1/4-X
+ 1/4+Z,1/4-Y,3/4+X
+ 1/4-Z,3/4+Y,1/4+X
+ 3/4-Z,3/4-Y,3/4-X
+ 1/2+X,1/2+Y,1/2+Z 
+ -X,1/2-Y,Z 
+ 1/2-X,Y,-Z 
+ X,-Y,1/2-Z 
+ 1/2+Z,1/2+X,1/2+Y
+ Z,-X,1/2-Y
+ -Z,1/2-X,Y
+ 1/2-Z,X,-Y
+ 1/2+Y,1/2+Z,1/2+X
+ 1/2-Y,Z,-X
+ Y,-Z,1/2-X
+ -Y,1/2-Z,X
+ 1/4+Y,3/4+X,3/4-Z
+ 1/4-Y,1/4-X,1/4-Z
+ 3/4+Y,3/4-X,1/4+Z
+ 3/4-Y,1/4+X,3/4+Z
+ 1/4+X,3/4+Z,3/4-Y
+ 3/4-X,1/4+Z,3/4+Y
+ 1/4-X,1/4-Z,1/4-Y
+ 3/4+X,3/4-Z,1/4+Y
+ 1/4+Z,3/4+Y,3/4-X
+ 3/4+Z,3/4-Y,1/4+X
+ 3/4-Z,1/4+Y,3/4+X
+ 1/4-Z,1/4-Y,1/4-X
+215 24 24 P-43m PG4bar3m CUBIC 'P -4 3 m'
+ X,Y,Z 
+ -X,-Y,Z 
+ -X,Y,-Z 
+ X,-Y,-Z 
+ Z,X,Y
+ Z,-X,-Y
+ -Z,-X,Y
+ -Z,X,-Y
+ Y,Z,X
+ -Y,Z,-X
+ Y,-Z,-X
+ -Y,-Z,X
+ Y,X,Z
+ -Y,-X,Z
+ Y,-X,-Z
+ -Y,X,-Z
+ X,Z,Y
+ -X,Z,-Y
+ -X,-Z,Y
+ X,-Z,-Y
+ Z,Y,X
+ Z,-Y,-X
+ -Z,Y,-X
+ -Z,-Y,X
+216 96 24 F-43m PG4bar3m CUBIC 'F -4 3 m'
+ X,Y,Z 
+ -X,-Y,Z 
+ -X,Y,-Z 
+ X,-Y,-Z 
+ Z,X,Y
+ Z,-X,-Y
+ -Z,-X,Y
+ -Z,X,-Y
+ Y,Z,X
+ -Y,Z,-X
+ Y,-Z,-X
+ -Y,-Z,X
+ Y,X,Z
+ -Y,-X,Z
+ Y,-X,-Z
+ -Y,X,-Z
+ X,Z,Y
+ -X,Z,-Y
+ -X,-Z,Y
+ X,-Z,-Y
+ Z,Y,X
+ Z,-Y,-X
+ -Z,Y,-X
+ -Z,-Y,X
+ X,1/2+Y,1/2+Z 
+ -X,1/2-Y,1/2+Z 
+ -X,1/2+Y,1/2-Z 
+ X,1/2-Y,1/2-Z 
+ Z,1/2+X,1/2+Y
+ Z,1/2-X,1/2-Y
+ -Z,1/2-X,1/2+Y
+ -Z,1/2+X,1/2-Y
+ Y,1/2+Z,1/2+X
+ -Y,1/2+Z,1/2-X
+ Y,1/2-Z,1/2-X
+ -Y,1/2-Z,1/2+X
+ Y,1/2+X,1/2+Z
+ -Y,1/2-X,1/2+Z
+ Y,1/2-X,1/2-Z
+ -Y,1/2+X,1/2-Z
+ X,1/2+Z,1/2+Y
+ -X,1/2+Z,1/2-Y
+ -X,1/2-Z,1/2+Y
+ X,1/2-Z,1/2-Y
+ Z,1/2+Y,1/2+X
+ Z,1/2-Y,1/2-X
+ -Z,1/2+Y,1/2-X
+ -Z,1/2-Y,1/2+X
+ 1/2+X,Y,1/2+Z 
+ 1/2-X,-Y,1/2+Z 
+ 1/2-X,Y,1/2-Z 
+ 1/2+X,-Y,1/2-Z 
+ 1/2+Z,X,1/2+Y
+ 1/2+Z,-X,1/2-Y
+ 1/2-Z,-X,1/2+Y
+ 1/2-Z,X,1/2-Y
+ 1/2+Y,Z,1/2+X
+ 1/2-Y,Z,1/2-X
+ 1/2+Y,-Z,1/2-X
+ 1/2-Y,-Z,1/2+X
+ 1/2+Y,X,1/2+Z
+ 1/2-Y,-X,1/2+Z
+ 1/2+Y,-X,1/2-Z
+ 1/2-Y,X,1/2-Z
+ 1/2+X,Z,1/2+Y
+ 1/2-X,Z,1/2-Y
+ 1/2-X,-Z,1/2+Y
+ 1/2+X,-Z,1/2-Y
+ 1/2+Z,Y,1/2+X
+ 1/2+Z,-Y,1/2-X
+ 1/2-Z,Y,1/2-X
+ 1/2-Z,-Y,1/2+X
+ 1/2+X,1/2+Y,Z 
+ 1/2-X,1/2-Y,Z 
+ 1/2-X,1/2+Y,-Z 
+ 1/2+X,1/2-Y,-Z 
+ 1/2+Z,1/2+X,Y
+ 1/2+Z,1/2-X,-Y
+ 1/2-Z,1/2-X,Y
+ 1/2-Z,1/2+X,-Y
+ 1/2+Y,1/2+Z,X
+ 1/2-Y,1/2+Z,-X
+ 1/2+Y,1/2-Z,-X
+ 1/2-Y,1/2-Z,X
+ 1/2+Y,1/2+X,Z
+ 1/2-Y,1/2-X,Z
+ 1/2+Y,1/2-X,-Z
+ 1/2-Y,1/2+X,-Z
+ 1/2+X,1/2+Z,Y
+ 1/2-X,1/2+Z,-Y
+ 1/2-X,1/2-Z,Y
+ 1/2+X,1/2-Z,-Y
+ 1/2+Z,1/2+Y,X
+ 1/2+Z,1/2-Y,-X
+ 1/2-Z,1/2+Y,-X
+ 1/2-Z,1/2-Y,X
+217 48 24 I-43m PG4bar3m CUBIC 'I -4 3 m'
+ X,Y,Z 
+ -X,-Y,Z 
+ -X,Y,-Z 
+ X,-Y,-Z 
+ Z,X,Y
+ Z,-X,-Y
+ -Z,-X,Y
+ -Z,X,-Y
+ Y,Z,X
+ -Y,Z,-X
+ Y,-Z,-X
+ -Y,-Z,X
+ Y,X,Z
+ -Y,-X,Z
+ Y,-X,-Z
+ -Y,X,-Z
+ X,Z,Y
+ -X,Z,-Y
+ -X,-Z,Y
+ X,-Z,-Y
+ Z,Y,X
+ Z,-Y,-X
+ -Z,Y,-X
+ -Z,-Y,X
+ 1/2+X,1/2+Y,1/2+Z 
+ 1/2-X,1/2-Y,1/2+Z 
+ 1/2-X,1/2+Y,1/2-Z 
+ 1/2+X,1/2-Y,1/2-Z 
+ 1/2+Z,1/2+X,1/2+Y
+ 1/2+Z,1/2-X,1/2-Y
+ 1/2-Z,1/2-X,1/2+Y
+ 1/2-Z,1/2+X,1/2-Y
+ 1/2+Y,1/2+Z,1/2+X
+ 1/2-Y,1/2+Z,1/2-X
+ 1/2+Y,1/2-Z,1/2-X
+ 1/2-Y,1/2-Z,1/2+X
+ 1/2+Y,1/2+X,1/2+Z
+ 1/2-Y,1/2-X,1/2+Z
+ 1/2+Y,1/2-X,1/2-Z
+ 1/2-Y,1/2+X,1/2-Z
+ 1/2+X,1/2+Z,1/2+Y
+ 1/2-X,1/2+Z,1/2-Y
+ 1/2-X,1/2-Z,1/2+Y
+ 1/2+X,1/2-Z,1/2-Y
+ 1/2+Z,1/2+Y,1/2+X
+ 1/2+Z,1/2-Y,1/2-X
+ 1/2-Z,1/2+Y,1/2-X
+ 1/2-Z,1/2-Y,1/2+X
+218 24 24 P-43n PG4bar3m CUBIC 'P -4 3 n'
+ X,Y,Z 
+ -X,-Y,Z 
+ -X,Y,-Z 
+ X,-Y,-Z 
+ Z,X,Y
+ Z,-X,-Y
+ -Z,-X,Y
+ -Z,X,-Y
+ Y,Z,X
+ -Y,Z,-X
+ Y,-Z,-X
+ -Y,-Z,X
+ 1/2+Y,1/2+X,1/2+Z
+ 1/2-Y,1/2-X,1/2+Z
+ 1/2+Y,1/2-X,1/2-Z
+ 1/2-Y,1/2+X,1/2-Z
+ 1/2+X,1/2+Z,1/2+Y
+ 1/2-X,1/2+Z,1/2-Y
+ 1/2-X,1/2-Z,1/2+Y
+ 1/2+X,1/2-Z,1/2-Y
+ 1/2+Z,1/2+Y,1/2+X
+ 1/2+Z,1/2-Y,1/2-X
+ 1/2-Z,1/2+Y,1/2-X
+ 1/2-Z,1/2-Y,1/2+X
+219 96 24 F-43c PG4bar3m CUBIC 'F -4 3 c'
+ X,Y,Z 
+ -X,-Y,Z 
+ -X,Y,-Z 
+ X,-Y,-Z 
+ Z,X,Y
+ Z,-X,-Y
+ -Z,-X,Y
+ -Z,X,-Y
+ Y,Z,X
+ -Y,Z,-X
+ Y,-Z,-X
+ -Y,-Z,X
+ 1/2+Y,1/2+X,1/2+Z
+ 1/2-Y,1/2-X,1/2+Z
+ 1/2+Y,1/2-X,1/2-Z
+ 1/2-Y,1/2+X,1/2-Z
+ 1/2+X,1/2+Z,1/2+Y
+ 1/2-X,1/2+Z,1/2-Y
+ 1/2-X,1/2-Z,1/2+Y
+ 1/2+X,1/2-Z,1/2-Y
+ 1/2+Z,1/2+Y,1/2+X
+ 1/2+Z,1/2-Y,1/2-X
+ 1/2-Z,1/2+Y,1/2-X
+ 1/2-Z,1/2-Y,1/2+X
+ X,1/2+Y,1/2+Z 
+ -X,1/2-Y,1/2+Z 
+ -X,1/2+Y,1/2-Z 
+ X,1/2-Y,1/2-Z 
+ Z,1/2+X,1/2+Y
+ Z,1/2-X,1/2-Y
+ -Z,1/2-X,1/2+Y
+ -Z,1/2+X,1/2-Y
+ Y,1/2+Z,1/2+X
+ -Y,1/2+Z,1/2-X
+ Y,1/2-Z,1/2-X
+ -Y,1/2-Z,1/2+X
+ 1/2+Y,X,Z
+ 1/2-Y,-X,Z
+ 1/2+Y,-X,-Z
+ 1/2-Y,X,-Z
+ 1/2+X,Z,Y
+ 1/2-X,Z,-Y
+ 1/2-X,-Z,Y
+ 1/2+X,-Z,-Y
+ 1/2+Z,Y,X
+ 1/2+Z,-Y,-X
+ 1/2-Z,Y,-X
+ 1/2-Z,-Y,X
+ 1/2+X,Y,1/2+Z 
+ 1/2-X,-Y,1/2+Z 
+ 1/2-X,Y,1/2-Z 
+ 1/2+X,-Y,1/2-Z 
+ 1/2+Z,X,1/2+Y
+ 1/2+Z,-X,1/2-Y
+ 1/2-Z,-X,1/2+Y
+ 1/2-Z,X,1/2-Y
+ 1/2+Y,Z,1/2+X
+ 1/2-Y,Z,1/2-X
+ 1/2+Y,-Z,1/2-X
+ 1/2-Y,-Z,1/2+X
+ Y,1/2+X,Z
+ -Y,1/2-X,Z
+ Y,1/2-X,-Z
+ -Y,1/2+X,-Z
+ X,1/2+Z,Y
+ -X,1/2+Z,-Y
+ -X,1/2-Z,Y
+ X,1/2-Z,-Y
+ Z,1/2+Y,X
+ Z,1/2-Y,-X
+ -Z,1/2+Y,-X
+ -Z,1/2-Y,X
+ 1/2+X,1/2+Y,Z 
+ 1/2-X,1/2-Y,Z 
+ 1/2-X,1/2+Y,-Z 
+ 1/2+X,1/2-Y,-Z 
+ 1/2+Z,1/2+X,Y
+ 1/2+Z,1/2-X,-Y
+ 1/2-Z,1/2-X,Y
+ 1/2-Z,1/2+X,-Y
+ 1/2+Y,1/2+Z,X
+ 1/2-Y,1/2+Z,-X
+ 1/2+Y,1/2-Z,-X
+ 1/2-Y,1/2-Z,X
+ Y,X,1/2+Z
+ -Y,-X,1/2+Z
+ Y,-X,1/2-Z
+ -Y,X,1/2-Z
+ X,Z,1/2+Y
+ -X,Z,1/2-Y
+ -X,-Z,1/2+Y
+ X,-Z,1/2-Y
+ Z,Y,1/2+X
+ Z,-Y,1/2-X
+ -Z,Y,1/2-X
+ -Z,-Y,1/2+X
+220 48 24 I-43d PG4bar3m CUBIC 'I -4 3 d'
+ X,Y,Z
+ 1/2-X,-Y,1/2+Z
+ -X,1/2+Y,1/2-Z
+ 1/2+X,1/2-Y,-Z
+ Z,X,Y
+ 1/2+Z,1/2-X,-Y
+ 1/2-Z,-X,1/2+Y
+ -Z,1/2+X,1/2-Y
+ Y,Z,X
+ -Y,1/2+Z,1/2-X
+ 1/2+Y,1/2-Z,-X
+ 1/2-Y,-Z,1/2+X
+ 1/4+Y,1/4+X,1/4+Z
+ 1/4-Y,3/4-X,3/4+Z
+ 3/4+Y,1/4-X,3/4-Z
+ 3/4-Y,3/4+X,1/4-Z
+ 1/4+X,1/4+Z,1/4+Y
+ 3/4-X,3/4+Z,1/4-Y
+ 1/4-X,3/4-Z,3/4+Y
+ 3/4+X,1/4-Z,3/4-Y
+ 1/4+Z,1/4+Y,1/4+X
+ 3/4+Z,1/4-Y,3/4-X
+ 3/4-Z,3/4+Y,1/4-X
+ 1/4-Z,3/4-Y,3/4+X
+ 1/2+X,1/2+Y,1/2+Z
+ -X,1/2-Y,Z
+ 1/2-X,Y,-Z
+ X,-Y,1/2-Z
+ 1/2+Z,1/2+X,1/2+Y
+ Z,-X,1/2-Y
+ -Z,1/2-X,Y
+ 1/2-Z,X,-Y
+ 1/2+Y,1/2+Z,1/2+X
+ 1/2-Y,Z,-X
+ Y,-Z,1/2-X
+ -Y,1/2-Z,X
+ 3/4+Y,3/4+X,3/4+Z
+ 3/4-Y,1/4-X,1/4+Z
+ 1/4+Y,3/4-X,1/4-Z
+ 1/4-Y,1/4+X,3/4-Z
+ 3/4+X,3/4+Z,3/4+Y
+ 1/4-X,1/4+Z,3/4-Y
+ 3/4-X,1/4-Z,1/4+Y
+ 1/4+X,3/4-Z,1/4-Y
+ 3/4+Z,3/4+Y,3/4+X
+ 1/4+Z,3/4-Y,1/4-X
+ 1/4-Z,1/4+Y,3/4-X
+ 3/4-Z,1/4-Y,1/4+X
+221 48 48 Pm-3m PGm3barm CUBIC 'P 4/m -3 2/m' 'P m -3 m'
+ X,Y,Z
+ -X,-Y,Z
+ -X,Y,-Z
+ X,-Y,-Z
+ Z,X,Y
+ Z,-X,-Y
+ -Z,-X,Y
+ -Z,X,-Y
+ Y,Z,X
+ -Y,Z,-X
+ Y,-Z,-X
+ -Y,-Z,X
+ Y,X,-Z
+ -Y,-X,-Z
+ Y,-X,Z
+ -Y,X,Z
+ X,Z,-Y
+ -X,Z,Y
+ -X,-Z,-Y
+ X,-Z,Y
+ Z,Y,-X
+ Z,-Y,X
+ -Z,Y,X
+ -Z,-Y,-X
+ -X,-Y,-Z
+ X,Y,-Z
+ X,-Y,Z
+ -X,Y,Z
+ -Z,-X,-Y
+ -Z,X,Y
+ Z,X,-Y
+ Z,-X,Y
+ -Y,-Z,-X
+ Y,-Z,X
+ -Y,Z,X
+ Y,Z,-X
+ -Y,-X,Z
+ Y,X,Z
+ -Y,X,-Z
+ Y,-X,-Z
+ -X,-Z,Y
+ X,-Z,-Y
+ X,Z,Y
+ -X,Z,-Y
+ -Z,-Y,X
+ -Z,Y,-X
+ Z,-Y,-X
+ Z,Y,X
+222 48 48 Pn-3n PGm3barm CUBIC 'P 4/n -3 2/n' P n -3 n'
+ X,Y,Z
+ -X,-Y,Z
+ -X,Y,-Z
+ X,-Y,-Z
+ Z,X,Y
+ Z,-X,-Y
+ -Z,-X,Y
+ -Z,X,-Y
+ Y,Z,X
+ -Y,Z,-X
+ Y,-Z,-X
+ -Y,-Z,X
+ Y,X,-Z
+ -Y,-X,-Z
+ Y,-X,Z
+ -Y,X,Z
+ X,Z,-Y
+ -X,Z,Y
+ -X,-Z,-Y
+ X,-Z,Y
+ Z,Y,-X
+ Z,-Y,X
+ -Z,Y,X
+ -Z,-Y,-X
+ 1/2-X,1/2-Y,1/2-Z
+ 1/2+X,1/2+Y,1/2-Z
+ 1/2+X,1/2-Y,1/2+Z
+ 1/2-X,1/2+Y,1/2+Z
+ 1/2-Z,1/2-X,1/2-Y
+ 1/2-Z,1/2+X,1/2+Y
+ 1/2+Z,1/2+X,1/2-Y
+ 1/2+Z,1/2-X,1/2+Y
+ 1/2-Y,1/2-Z,1/2-X
+ 1/2+Y,1/2-Z,1/2+X
+ 1/2-Y,1/2+Z,1/2+X
+ 1/2+Y,1/2+Z,1/2-X
+ 1/2-Y,1/2-X,1/2+Z
+ 1/2+Y,1/2+X,1/2+Z
+ 1/2-Y,1/2+X,1/2-Z
+ 1/2+Y,1/2-X,1/2-Z
+ 1/2-X,1/2-Z,1/2+Y
+ 1/2+X,1/2-Z,1/2-Y
+ 1/2+X,1/2+Z,1/2+Y
+ 1/2-X,1/2+Z,1/2-Y
+ 1/2-Z,1/2-Y,1/2+X
+ 1/2-Z,1/2+Y,1/2-X
+ 1/2+Z,1/2-Y,1/2-X
+ 1/2+Z,1/2+Y,1/2+X
+223 48 48 Pm-3n PGm3barm CUBIC 'P 42/m -3 2/n' 'P m -3 n'
+ X,Y,Z
+ -X,-Y,Z
+ -X,Y,-Z
+ X,-Y,-Z
+ Z,X,Y
+ Z,-X,-Y
+ -Z,-X,Y
+ -Z,X,-Y
+ Y,Z,X
+ -Y,Z,-X
+ Y,-Z,-X
+ -Y,-Z,X
+ 1/2+Y,1/2+X,1/2-Z
+ 1/2-Y,1/2-X,1/2-Z
+ 1/2+Y,1/2-X,1/2+Z
+ 1/2-Y,1/2+X,1/2+Z
+ 1/2+X,1/2+Z,1/2-Y
+ 1/2-X,1/2+Z,1/2+Y
+ 1/2-X,1/2-Z,1/2-Y
+ 1/2+X,1/2-Z,1/2+Y
+ 1/2+Z,1/2+Y,1/2-X
+ 1/2+Z,1/2-Y,1/2+X
+ 1/2-Z,1/2+Y,1/2+X
+ 1/2-Z,1/2-Y,1/2-X
+ -X,-Y,-Z
+ X,Y,-Z
+ X,-Y,Z
+ -X,Y,Z
+ -Z,-X,-Y
+ -Z,X,Y
+ Z,X,-Y
+ Z,-X,Y
+ -Y,-Z,-X
+ Y,-Z,X
+ -Y,Z,X
+ Y,Z,-X
+ 1/2-Y,1/2-X,1/2+Z
+ 1/2+Y,1/2+X,1/2+Z
+ 1/2-Y,1/2+X,1/2-Z
+ 1/2+Y,1/2-X,1/2-Z
+ 1/2-X,1/2-Z,1/2+Y
+ 1/2+X,1/2-Z,1/2-Y
+ 1/2+X,1/2+Z,1/2+Y
+ 1/2-X,1/2+Z,1/2-Y
+ 1/2-Z,1/2-Y,1/2+X
+ 1/2-Z,1/2+Y,1/2-X
+ 1/2+Z,1/2-Y,1/2-X
+ 1/2+Z,1/2+Y,1/2+X
+224 48 48 Pn-3m PGm3barm CUBIC 'P 42/n -3 2/m' 'P n -3 m'
+ X,Y,Z
+ -X,-Y,Z
+ -X,Y,-Z
+ X,-Y,-Z
+ Z,X,Y
+ Z,-X,-Y
+ -Z,-X,Y
+ -Z,X,-Y
+ Y,Z,X
+ -Y,Z,-X
+ Y,-Z,-X
+ -Y,-Z,X
+ 1/2+Y,1/2+X,1/2-Z
+ 1/2-Y,1/2-X,1/2-Z
+ 1/2+Y,1/2-X,1/2+Z
+ 1/2-Y,1/2+X,1/2+Z
+ 1/2+X,1/2+Z,1/2-Y
+ 1/2-X,1/2+Z,1/2+Y
+ 1/2-X,1/2-Z,1/2-Y
+ 1/2+X,1/2-Z,1/2+Y
+ 1/2+Z,1/2+Y,1/2-X
+ 1/2+Z,1/2-Y,1/2+X
+ 1/2-Z,1/2+Y,1/2+X
+ 1/2-Z,1/2-Y,1/2-X
+ 1/2-X,1/2-Y,1/2-Z
+ 1/2+X,1/2+Y,1/2-Z
+ 1/2+X,1/2-Y,1/2+Z
+ 1/2-X,1/2+Y,1/2+Z
+ 1/2-Z,1/2-X,1/2-Y
+ 1/2-Z,1/2+X,1/2+Y
+ 1/2+Z,1/2+X,1/2-Y
+ 1/2+Z,1/2-X,1/2+Y
+ 1/2-Y,1/2-Z,1/2-X
+ 1/2+Y,1/2-Z,1/2+X
+ 1/2-Y,1/2+Z,1/2+X
+ 1/2+Y,1/2+Z,1/2-X
+ -Y,-X,Z
+ Y,X,Z
+ -Y,X,-Z
+ Y,-X,-Z
+ -X,-Z,Y
+ X,-Z,-Y
+ X,Z,Y
+ -X,Z,-Y
+ -Z,-Y,X
+ -Z,Y,-X
+ Z,-Y,-X
+ Z,Y,X
+225 192 48 Fm-3m PGm3barm CUBIC 'F 4/m -3 2/m' 'F m -3 m'
+ X,Y,Z
+ -X,-Y,Z
+ -X,Y,-Z
+ X,-Y,-Z
+ Z,X,Y
+ Z,-X,-Y
+ -Z,-X,Y
+ -Z,X,-Y
+ Y,Z,X
+ -Y,Z,-X
+ Y,-Z,-X
+ -Y,-Z,X
+ Y,X,-Z
+ -Y,-X,-Z
+ Y,-X,Z
+ -Y,X,Z
+ X,Z,-Y
+ -X,Z,Y
+ -X,-Z,-Y
+ X,-Z,Y
+ Z,Y,-X
+ Z,-Y,X
+ -Z,Y,X
+ -Z,-Y,-X
+ -X,-Y,-Z
+ X,Y,-Z
+ X,-Y,Z
+ -X,Y,Z
+ -Z,-X,-Y
+ -Z,X,Y
+ Z,X,-Y
+ Z,-X,Y
+ -Y,-Z,-X
+ Y,-Z,X
+ -Y,Z,X
+ Y,Z,-X
+ -Y,-X,Z
+ Y,X,Z
+ -Y,X,-Z
+ Y,-X,-Z
+ -X,-Z,Y
+ X,-Z,-Y
+ X,Z,Y
+ -X,Z,-Y
+ -Z,-Y,X
+ -Z,Y,-X
+ Z,-Y,-X
+ Z,Y,X
+ X,1/2+Y,1/2+Z
+ -X,1/2-Y,1/2+Z
+ -X,1/2+Y,1/2-Z
+ X,1/2-Y,1/2-Z
+ Z,1/2+X,1/2+Y
+ Z,1/2-X,1/2-Y
+ -Z,1/2-X,1/2+Y
+ -Z,1/2+X,1/2-Y
+ Y,1/2+Z,1/2+X
+ -Y,1/2+Z,1/2-X
+ Y,1/2-Z,1/2-X
+ -Y,1/2-Z,1/2+X
+ Y,1/2+X,1/2-Z
+ -Y,1/2-X,1/2-Z
+ Y,1/2-X,1/2+Z
+ -Y,1/2+X,1/2+Z
+ X,1/2+Z,1/2-Y
+ -X,1/2+Z,1/2+Y
+ -X,1/2-Z,1/2-Y
+ X,1/2-Z,1/2+Y
+ Z,1/2+Y,1/2-X
+ Z,1/2-Y,1/2+X
+ -Z,1/2+Y,1/2+X
+ -Z,1/2-Y,1/2-X
+ -X,1/2-Y,1/2-Z
+ X,1/2+Y,1/2-Z
+ X,1/2-Y,1/2+Z
+ -X,1/2+Y,1/2+Z
+ -Z,1/2-X,1/2-Y
+ -Z,1/2+X,1/2+Y
+ Z,1/2+X,1/2-Y
+ Z,1/2-X,1/2+Y
+ -Y,1/2-Z,1/2-X
+ Y,1/2-Z,1/2+X
+ -Y,1/2+Z,1/2+X
+ Y,1/2+Z,1/2-X
+ -Y,1/2-X,1/2+Z
+ Y,1/2+X,1/2+Z
+ -Y,1/2+X,1/2-Z
+ Y,1/2-X,1/2-Z
+ -X,1/2-Z,1/2+Y
+ X,1/2-Z,1/2-Y
+ X,1/2+Z,1/2+Y
+ -X,1/2+Z,1/2-Y
+ -Z,1/2-Y,1/2+X
+ -Z,1/2+Y,1/2-X
+ Z,1/2-Y,1/2-X
+ Z,1/2+Y,1/2+X
+ 1/2+X,Y,1/2+Z
+ 1/2-X,-Y,1/2+Z
+ 1/2-X,Y,1/2-Z
+ 1/2+X,-Y,1/2-Z
+ 1/2+Z,X,1/2+Y
+ 1/2+Z,-X,1/2-Y
+ 1/2-Z,-X,1/2+Y
+ 1/2-Z,X,1/2-Y
+ 1/2+Y,Z,1/2+X
+ 1/2-Y,Z,1/2-X
+ 1/2+Y,-Z,1/2-X
+ 1/2-Y,-Z,1/2+X
+ 1/2+Y,X,1/2-Z
+ 1/2-Y,-X,1/2-Z
+ 1/2+Y,-X,1/2+Z
+ 1/2-Y,X,1/2+Z
+ 1/2+X,Z,1/2-Y
+ 1/2-X,Z,1/2+Y
+ 1/2-X,-Z,1/2-Y
+ 1/2+X,-Z,1/2+Y
+ 1/2+Z,Y,1/2-X
+ 1/2+Z,-Y,1/2+X
+ 1/2-Z,Y,1/2+X
+ 1/2-Z,-Y,1/2-X
+ 1/2-X,-Y,1/2-Z
+ 1/2+X,Y,1/2-Z
+ 1/2+X,-Y,1/2+Z
+ 1/2-X,Y,1/2+Z
+ 1/2-Z,-X,1/2-Y
+ 1/2-Z,X,1/2+Y
+ 1/2+Z,X,1/2-Y
+ 1/2+Z,-X,1/2+Y
+ 1/2-Y,-Z,1/2-X
+ 1/2+Y,-Z,1/2+X
+ 1/2-Y,Z,1/2+X
+ 1/2+Y,Z,1/2-X
+ 1/2-Y,-X,1/2+Z
+ 1/2+Y,X,1/2+Z
+ 1/2-Y,X,1/2-Z
+ 1/2+Y,-X,1/2-Z
+ 1/2-X,-Z,1/2+Y
+ 1/2+X,-Z,1/2-Y
+ 1/2+X,Z,1/2+Y
+ 1/2-X,Z,1/2-Y
+ 1/2-Z,-Y,1/2+X
+ 1/2-Z,Y,1/2-X
+ 1/2+Z,-Y,1/2-X
+ 1/2+Z,Y,1/2+X
+ 1/2+X,1/2+Y,Z
+ 1/2-X,1/2-Y,Z
+ 1/2-X,1/2+Y,-Z
+ 1/2+X,1/2-Y,-Z
+ 1/2+Z,1/2+X,Y
+ 1/2+Z,1/2-X,-Y
+ 1/2-Z,1/2-X,Y
+ 1/2-Z,1/2+X,-Y
+ 1/2+Y,1/2+Z,X
+ 1/2-Y,1/2+Z,-X
+ 1/2+Y,1/2-Z,-X
+ 1/2-Y,1/2-Z,X
+ 1/2+Y,1/2+X,-Z
+ 1/2-Y,1/2-X,-Z
+ 1/2+Y,1/2-X,Z
+ 1/2-Y,1/2+X,Z
+ 1/2+X,1/2+Z,-Y
+ 1/2-X,1/2+Z,Y
+ 1/2-X,1/2-Z,-Y
+ 1/2+X,1/2-Z,Y
+ 1/2+Z,1/2+Y,-X
+ 1/2+Z,1/2-Y,X
+ 1/2-Z,1/2+Y,X
+ 1/2-Z,1/2-Y,-X
+ 1/2-X,1/2-Y,-Z
+ 1/2+X,1/2+Y,-Z
+ 1/2+X,1/2-Y,Z
+ 1/2-X,1/2+Y,Z
+ 1/2-Z,1/2-X,-Y
+ 1/2-Z,1/2+X,Y
+ 1/2+Z,1/2+X,-Y
+ 1/2+Z,1/2-X,Y
+ 1/2-Y,1/2-Z,-X
+ 1/2+Y,1/2-Z,X
+ 1/2-Y,1/2+Z,X
+ 1/2+Y,1/2+Z,-X
+ 1/2-Y,1/2-X,Z
+ 1/2+Y,1/2+X,Z
+ 1/2-Y,1/2+X,-Z
+ 1/2+Y,1/2-X,-Z
+ 1/2-X,1/2-Z,Y
+ 1/2+X,1/2-Z,-Y
+ 1/2+X,1/2+Z,Y
+ 1/2-X,1/2+Z,-Y
+ 1/2-Z,1/2-Y,X
+ 1/2-Z,1/2+Y,-X
+ 1/2+Z,1/2-Y,-X
+ 1/2+Z,1/2+Y,X
+226 192 48 Fm-3c PGm3barm CUBIC 'F 4/m -3 2/c' 'F m -3 c'
+ X,Y,Z
+ -X,-Y,Z
+ -X,Y,-Z
+ X,-Y,-Z
+ Z,X,Y
+ Z,-X,-Y
+ -Z,-X,Y
+ -Z,X,-Y
+ Y,Z,X
+ -Y,Z,-X
+ Y,-Z,-X
+ -Y,-Z,X
+ 1/2+Y,1/2+X,1/2-Z
+ 1/2-Y,1/2-X,1/2-Z
+ 1/2+Y,1/2-X,1/2+Z
+ 1/2-Y,1/2+X,1/2+Z
+ 1/2+X,1/2+Z,1/2-Y
+ 1/2-X,1/2+Z,1/2+Y
+ 1/2-X,1/2-Z,1/2-Y
+ 1/2+X,1/2-Z,1/2+Y
+ 1/2+Z,1/2+Y,1/2-X
+ 1/2+Z,1/2-Y,1/2+X
+ 1/2-Z,1/2+Y,1/2+X
+ 1/2-Z,1/2-Y,1/2-X
+ -X,-Y,-Z
+ X,Y,-Z
+ X,-Y,Z
+ -X,Y,Z
+ -Z,-X,-Y
+ -Z,X,Y
+ Z,X,-Y
+ Z,-X,Y
+ -Y,-Z,-X
+ Y,-Z,X
+ -Y,Z,X
+ Y,Z,-X
+ 1/2-Y,1/2-X,1/2+Z
+ 1/2+Y,1/2+X,1/2+Z
+ 1/2-Y,1/2+X,1/2-Z
+ 1/2+Y,1/2-X,1/2-Z
+ 1/2-X,1/2-Z,1/2+Y
+ 1/2+X,1/2-Z,1/2-Y
+ 1/2+X,1/2+Z,1/2+Y
+ 1/2-X,1/2+Z,1/2-Y
+ 1/2-Z,1/2-Y,1/2+X
+ 1/2-Z,1/2+Y,1/2-X
+ 1/2+Z,1/2-Y,1/2-X
+ 1/2+Z,1/2+Y,1/2+X
+ X,1/2+Y,1/2+Z
+ -X,1/2-Y,1/2+Z
+ -X,1/2+Y,1/2-Z
+ X,1/2-Y,1/2-Z
+ Z,1/2+X,1/2+Y
+ Z,1/2-X,1/2-Y
+ -Z,1/2-X,1/2+Y
+ -Z,1/2+X,1/2-Y
+ Y,1/2+Z,1/2+X
+ -Y,1/2+Z,1/2-X
+ Y,1/2-Z,1/2-X
+ -Y,1/2-Z,1/2+X
+ 1/2+Y,X,-Z
+ 1/2-Y,-X,-Z
+ 1/2+Y,-X,Z
+ 1/2-Y,X,Z
+ 1/2+X,Z,-Y
+ 1/2-X,Z,Y
+ 1/2-X,-Z,-Y
+ 1/2+X,-Z,Y
+ 1/2+Z,Y,-X
+ 1/2+Z,-Y,X
+ 1/2-Z,Y,X
+ 1/2-Z,-Y,-X
+ -X,1/2-Y,1/2-Z
+ X,1/2+Y,1/2-Z
+ X,1/2-Y,1/2+Z
+ -X,1/2+Y,1/2+Z
+ -Z,1/2-X,1/2-Y
+ -Z,1/2+X,1/2+Y
+ Z,1/2+X,1/2-Y
+ Z,1/2-X,1/2+Y
+ -Y,1/2-Z,1/2-X
+ Y,1/2-Z,1/2+X
+ -Y,1/2+Z,1/2+X
+ Y,1/2+Z,1/2-X
+ 1/2-Y,-X,Z
+ 1/2+Y,X,Z
+ 1/2-Y,X,-Z
+ 1/2+Y,-X,-Z
+ 1/2-X,-Z,Y
+ 1/2+X,-Z,-Y
+ 1/2+X,Z,Y
+ 1/2-X,Z,-Y
+ 1/2-Z,-Y,X
+ 1/2-Z,Y,-X
+ 1/2+Z,-Y,-X
+ 1/2+Z,Y,X
+ 1/2+X,Y,1/2+Z
+ 1/2-X,-Y,1/2+Z
+ 1/2-X,Y,1/2-Z
+ 1/2+X,-Y,1/2-Z
+ 1/2+Z,X,1/2+Y
+ 1/2+Z,-X,1/2-Y
+ 1/2-Z,-X,1/2+Y
+ 1/2-Z,X,1/2-Y
+ 1/2+Y,Z,1/2+X
+ 1/2-Y,Z,1/2-X
+ 1/2+Y,-Z,1/2-X
+ 1/2-Y,-Z,1/2+X
+ Y,1/2+X,-Z
+ -Y,1/2-X,-Z
+ Y,1/2-X,Z
+ -Y,1/2+X,Z
+ X,1/2+Z,-Y
+ -X,1/2+Z,Y
+ -X,1/2-Z,-Y
+ X,1/2-Z,Y
+ Z,1/2+Y,-X
+ Z,1/2-Y,X
+ -Z,1/2+Y,X
+ -Z,1/2-Y,-X
+ 1/2-X,-Y,1/2-Z
+ 1/2+X,Y,1/2-Z
+ 1/2+X,-Y,1/2+Z
+ 1/2-X,Y,1/2+Z
+ 1/2-Z,-X,1/2-Y
+ 1/2-Z,X,1/2+Y
+ 1/2+Z,X,1/2-Y
+ 1/2+Z,-X,1/2+Y
+ 1/2-Y,-Z,1/2-X
+ 1/2+Y,-Z,1/2+X
+ 1/2-Y,Z,1/2+X
+ 1/2+Y,Z,1/2-X
+ -Y,1/2-X,Z
+ Y,1/2+X,Z
+ -Y,1/2+X,-Z
+ Y,1/2-X,-Z
+ -X,1/2-Z,Y
+ X,1/2-Z,-Y
+ X,1/2+Z,Y
+ -X,1/2+Z,-Y
+ -Z,1/2-Y,X
+ -Z,1/2+Y,-X
+ Z,1/2-Y,-X
+ Z,1/2+Y,X
+ 1/2+X,1/2+Y,Z
+ 1/2-X,1/2-Y,Z
+ 1/2-X,1/2+Y,-Z
+ 1/2+X,1/2-Y,-Z
+ 1/2+Z,1/2+X,Y
+ 1/2+Z,1/2-X,-Y
+ 1/2-Z,1/2-X,Y
+ 1/2-Z,1/2+X,-Y
+ 1/2+Y,1/2+Z,X
+ 1/2-Y,1/2+Z,-X
+ 1/2+Y,1/2-Z,-X
+ 1/2-Y,1/2-Z,X
+ Y,X,1/2-Z
+ -Y,-X,1/2-Z
+ Y,-X,1/2+Z
+ -Y,X,1/2+Z
+ X,Z,1/2-Y
+ -X,Z,1/2+Y
+ -X,-Z,1/2-Y
+ X,-Z,1/2+Y
+ Z,Y,1/2-X
+ Z,-Y,1/2+X
+ -Z,Y,1/2+X
+ -Z,-Y,1/2-X
+ 1/2-X,1/2-Y,-Z
+ 1/2+X,1/2+Y,-Z
+ 1/2+X,1/2-Y,Z
+ 1/2-X,1/2+Y,Z
+ 1/2-Z,1/2-X,-Y
+ 1/2-Z,1/2+X,Y
+ 1/2+Z,1/2+X,-Y
+ 1/2+Z,1/2-X,Y
+ 1/2-Y,1/2-Z,-X
+ 1/2+Y,1/2-Z,X
+ 1/2-Y,1/2+Z,X
+ 1/2+Y,1/2+Z,-X
+ -Y,-X,1/2+Z
+ Y,X,1/2+Z
+ -Y,X,1/2-Z
+ Y,-X,1/2-Z
+ -X,-Z,1/2+Y
+ X,-Z,1/2-Y
+ X,Z,1/2+Y
+ -X,Z,1/2-Y
+ -Z,-Y,1/2+X
+ -Z,Y,1/2-X
+ Z,-Y,1/2-X
+ Z,Y,1/2+X
+227 192 48 Fd-3m PGm3barm CUBIC 'F 41/d -3 2/m' 'F d -3 m'
+ X,Y,Z
+ -X,1/2-Y,1/2+Z
+ 1/2-X,1/2+Y,-Z
+ 1/2+X,-Y,1/2-Z
+ Z,X,Y
+ 1/2+Z,-X,1/2-Y
+ -Z,1/2-X,1/2+Y
+ 1/2-Z,1/2+X,-Y
+ Y,Z,X
+ 1/2-Y,1/2+Z,-X
+ 1/2+Y,-Z,1/2-X
+ -Y,1/2-Z,1/2+X
+ 3/4+Y,1/4+X,3/4-Z
+ 1/4-Y,1/4-X,1/4-Z
+ 1/4+Y,3/4-X,3/4+Z
+ 3/4-Y,3/4+X,1/4+Z
+ 3/4+X,1/4+Z,3/4-Y
+ 3/4-X,3/4+Z,1/4+Y
+ 1/4-X,1/4-Z,1/4-Y
+ 1/4+X,3/4-Z,3/4+Y
+ 3/4+Z,1/4+Y,3/4-X
+ 1/4+Z,3/4-Y,3/4+X
+ 3/4-Z,3/4+Y,1/4+X
+ 1/4-Z,1/4-Y,1/4-X
+ 1/4-X,1/4-Y,1/4-Z
+ 1/4+X,3/4+Y,3/4-Z
+ 3/4+X,3/4-Y,1/4+Z
+ 3/4-X,1/4+Y,3/4+Z
+ 1/4-Z,1/4-X,1/4-Y
+ 3/4-Z,1/4+X,3/4+Y
+ 1/4+Z,3/4+X,3/4-Y
+ 3/4+Z,3/4-X,1/4+Y
+ 1/4-Y,1/4-Z,1/4-X
+ 3/4+Y,3/4-Z,1/4+X
+ 3/4-Y,1/4+Z,3/4+X
+ 1/4+Y,3/4+Z,3/4-X
+ 1/2-Y,-X,1/2+Z
+ Y,X,Z
+ -Y,1/2+X,1/2-Z
+ 1/2+Y,1/2-X,-Z
+ 1/2-X,-Z,1/2+Y
+ 1/2+X,1/2-Z,-Y
+ X,Z,Y
+ -X,1/2+Z,1/2-Y
+ 1/2-Z,-Y,1/2+X
+ -Z,1/2+Y,1/2-X
+ 1/2+Z,1/2-Y,-X
+ Z,Y,X
+ X,1/2+Y,1/2+Z
+ -X,-Y,Z
+ 1/2-X,Y,1/2-Z
+ 1/2+X,1/2-Y,-Z
+ Z,1/2+X,1/2+Y
+ 1/2+Z,1/2-X,-Y
+ -Z,-X,Y
+ 1/2-Z,X,1/2-Y
+ Y,1/2+Z,1/2+X
+ 1/2-Y,Z,1/2-X
+ 1/2+Y,1/2-Z,-X
+ -Y,-Z,X
+ 3/4+Y,3/4+X,1/4-Z
+ 1/4-Y,3/4-X,3/4-Z
+ 1/4+Y,1/4-X,1/4+Z
+ 3/4-Y,1/4+X,3/4+Z
+ 3/4+X,3/4+Z,1/4-Y
+ 3/4-X,1/4+Z,3/4+Y
+ 1/4-X,3/4-Z,3/4-Y
+ 1/4+X,1/4-Z,1/4+Y
+ 3/4+Z,3/4+Y,1/4-X
+ 1/4+Z,1/4-Y,1/4+X
+ 3/4-Z,1/4+Y,3/4+X
+ 1/4-Z,3/4-Y,3/4-X
+ 1/4-X,3/4-Y,3/4-Z
+ 1/4+X,1/4+Y,1/4-Z
+ 3/4+X,1/4-Y,3/4+Z
+ 3/4-X,3/4+Y,1/4+Z
+ 1/4-Z,3/4-X,3/4-Y
+ 3/4-Z,3/4+X,1/4+Y
+ 1/4+Z,1/4+X,1/4-Y
+ 3/4+Z,1/4-X,3/4+Y
+ 1/4-Y,3/4-Z,3/4-X
+ 3/4+Y,1/4-Z,3/4+X
+ 3/4-Y,3/4+Z,1/4+X
+ 1/4+Y,1/4+Z,1/4-X
+ 1/2-Y,1/2-X,Z
+ Y,1/2+X,1/2+Z
+ -Y,X,-Z
+ 1/2+Y,-X,1/2-Z
+ 1/2-X,1/2-Z,Y
+ 1/2+X,-Z,1/2-Y
+ X,1/2+Z,1/2+Y
+ -X,Z,-Y
+ 1/2-Z,1/2-Y,X
+ -Z,Y,-X
+ 1/2+Z,-Y,1/2-X
+ Z,1/2+Y,1/2+X
+ 1/2+X,Y,1/2+Z
+ 1/2-X,1/2-Y,Z
+ -X,1/2+Y,1/2-Z
+ X,-Y,-Z
+ 1/2+Z,X,1/2+Y
+ Z,-X,-Y
+ 1/2-Z,1/2-X,Y
+ -Z,1/2+X,1/2-Y
+ 1/2+Y,Z,1/2+X
+ -Y,1/2+Z,1/2-X
+ Y,-Z,-X
+ 1/2-Y,1/2-Z,X
+ 1/4+Y,1/4+X,1/4-Z
+ 3/4-Y,1/4-X,3/4-Z
+ 3/4+Y,3/4-X,1/4+Z
+ 1/4-Y,3/4+X,3/4+Z
+ 1/4+X,1/4+Z,1/4-Y
+ 1/4-X,3/4+Z,3/4+Y
+ 3/4-X,1/4-Z,3/4-Y
+ 3/4+X,3/4-Z,1/4+Y
+ 1/4+Z,1/4+Y,1/4-X
+ 3/4+Z,3/4-Y,1/4+X
+ 1/4-Z,3/4+Y,3/4+X
+ 3/4-Z,1/4-Y,3/4-X
+ 3/4-X,1/4-Y,3/4-Z
+ 3/4+X,3/4+Y,1/4-Z
+ 1/4+X,3/4-Y,3/4+Z
+ 1/4-X,1/4+Y,1/4+Z
+ 3/4-Z,1/4-X,3/4-Y
+ 1/4-Z,1/4+X,1/4+Y
+ 3/4+Z,3/4+X,1/4-Y
+ 1/4+Z,3/4-X,3/4+Y
+ 3/4-Y,1/4-Z,3/4-X
+ 1/4+Y,3/4-Z,3/4+X
+ 1/4-Y,1/4+Z,1/4+X
+ 3/4+Y,3/4+Z,1/4-X
+ -Y,-X,Z
+ 1/2+Y,X,1/2+Z
+ 1/2-Y,1/2+X,-Z
+ Y,1/2-X,1/2-Z
+ -X,-Z,Y
+ X,1/2-Z,1/2-Y
+ 1/2+X,Z,1/2+Y
+ 1/2-X,1/2+Z,-Y
+ -Z,-Y,X
+ 1/2-Z,1/2+Y,-X
+ Z,1/2-Y,1/2-X
+ 1/2+Z,Y,1/2+X
+ 1/2+X,1/2+Y,Z
+ 1/2-X,-Y,1/2+Z
+ -X,Y,-Z
+ X,1/2-Y,1/2-Z
+ 1/2+Z,1/2+X,Y
+ Z,1/2-X,1/2-Y
+ 1/2-Z,-X,1/2+Y
+ -Z,X,-Y
+ 1/2+Y,1/2+Z,X
+ -Y,Z,-X
+ Y,1/2-Z,1/2-X
+ 1/2-Y,-Z,1/2+X
+ 1/4+Y,3/4+X,3/4-Z
+ 3/4-Y,3/4-X,1/4-Z
+ 3/4+Y,1/4-X,3/4+Z
+ 1/4-Y,1/4+X,1/4+Z
+ 1/4+X,3/4+Z,3/4-Y
+ 1/4-X,1/4+Z,1/4+Y
+ 3/4-X,3/4-Z,1/4-Y
+ 3/4+X,1/4-Z,3/4+Y
+ 1/4+Z,3/4+Y,3/4-X
+ 3/4+Z,1/4-Y,3/4+X
+ 1/4-Z,1/4+Y,1/4+X
+ 3/4-Z,3/4-Y,1/4-X
+ 3/4-X,3/4-Y,1/4-Z
+ 3/4+X,1/4+Y,3/4-Z
+ 1/4+X,1/4-Y,1/4+Z
+ 1/4-X,3/4+Y,3/4+Z
+ 3/4-Z,3/4-X,1/4-Y
+ 1/4-Z,3/4+X,3/4+Y
+ 3/4+Z,1/4+X,3/4-Y
+ 1/4+Z,1/4-X,1/4+Y
+ 3/4-Y,3/4-Z,1/4-X
+ 1/4+Y,1/4-Z,1/4+X
+ 1/4-Y,3/4+Z,3/4+X
+ 3/4+Y,1/4+Z,3/4-X
+ -Y,1/2-X,1/2+Z
+ 1/2+Y,1/2+X,Z
+ 1/2-Y,X,1/2-Z
+ Y,-X,-Z
+ -X,1/2-Z,1/2+Y
+ X,-Z,-Y
+ 1/2+X,1/2+Z,Y
+ 1/2-X,Z,1/2-Y
+ -Z,1/2-Y,1/2+X
+ 1/2-Z,Y,1/2-X
+ Z,-Y,-X
+ 1/2+Z,1/2+Y,X
+228 192 48 Fd-3c PGm3barm CUBIC 'F 41/d -3 2/c' 'F d -3 c'
+ X,Y,Z
+ -X,1/2-Y,1/2+Z
+ 1/2-X,1/2+Y,-Z
+ 1/2+X,-Y,1/2-Z
+ Z,X,Y
+ 1/2+Z,-X,1/2-Y
+ -Z,1/2-X,1/2+Y
+ 1/2-Z,1/2+X,-Y
+ Y,Z,X
+ 1/2-Y,1/2+Z,-X
+ 1/2+Y,-Z,1/2-X
+ -Y,1/2-Z,1/2+X
+ 3/4+Y,1/4+X,3/4-Z
+ 1/4-Y,1/4-X,1/4-Z
+ 1/4+Y,3/4-X,3/4+Z
+ 3/4-Y,3/4+X,1/4+Z
+ 3/4+X,1/4+Z,3/4-Y
+ 3/4-X,3/4+Z,1/4+Y
+ 1/4-X,1/4-Z,1/4-Y
+ 1/4+X,3/4-Z,3/4+Y
+ 3/4+Z,1/4+Y,3/4-X
+ 1/4+Z,3/4-Y,3/4+X
+ 3/4-Z,3/4+Y,1/4+X
+ 1/4-Z,1/4-Y,1/4-X
+ 3/4-X,3/4-Y,3/4-Z
+ 3/4+X,1/4+Y,1/4-Z
+ 1/4+X,1/4-Y,3/4+Z
+ 1/4-X,3/4+Y,1/4+Z
+ 3/4-Z,3/4-X,3/4-Y
+ 1/4-Z,3/4+X,1/4+Y
+ 3/4+Z,1/4+X,1/4-Y
+ 1/4+Z,1/4-X,3/4+Y
+ 3/4-Y,3/4-Z,3/4-X
+ 1/4+Y,1/4-Z,3/4+X
+ 1/4-Y,3/4+Z,1/4+X
+ 3/4+Y,1/4+Z,1/4-X
+ -Y,1/2-X,Z
+ 1/2+Y,1/2+X,1/2+Z
+ 1/2-Y,X,-Z
+ Y,-X,1/2-Z
+ -X,1/2-Z,Y
+ X,-Z,1/2-Y
+ 1/2+X,1/2+Z,1/2+Y
+ 1/2-X,Z,-Y
+ -Z,1/2-Y,X
+ 1/2-Z,Y,-X
+ Z,-Y,1/2-X
+ 1/2+Z,1/2+Y,1/2+X
+ X,1/2+Y,1/2+Z
+ -X,-Y,Z
+ 1/2-X,Y,1/2-Z
+ 1/2+X,1/2-Y,-Z
+ Z,1/2+X,1/2+Y
+ 1/2+Z,1/2-X,-Y
+ -Z,-X,Y
+ 1/2-Z,X,1/2-Y
+ Y,1/2+Z,1/2+X
+ 1/2-Y,Z,1/2-X
+ 1/2+Y,1/2-Z,-X
+ -Y,-Z,X
+ 3/4+Y,3/4+X,1/4-Z
+ 1/4-Y,3/4-X,3/4-Z
+ 1/4+Y,1/4-X,1/4+Z
+ 3/4-Y,1/4+X,3/4+Z
+ 3/4+X,3/4+Z,1/4-Y
+ 3/4-X,1/4+Z,3/4+Y
+ 1/4-X,3/4-Z,3/4-Y
+ 1/4+X,1/4-Z,1/4+Y
+ 3/4+Z,3/4+Y,1/4-X
+ 1/4+Z,1/4-Y,1/4+X
+ 3/4-Z,1/4+Y,3/4+X
+ 1/4-Z,3/4-Y,3/4-X
+ 3/4-X,1/4-Y,1/4-Z
+ 3/4+X,3/4+Y,3/4-Z
+ 1/4+X,3/4-Y,1/4+Z
+ 1/4-X,1/4+Y,3/4+Z
+ 3/4-Z,1/4-X,1/4-Y
+ 1/4-Z,1/4+X,3/4+Y
+ 3/4+Z,3/4+X,3/4-Y
+ 1/4+Z,3/4-X,1/4+Y
+ 3/4-Y,1/4-Z,1/4-X
+ 1/4+Y,3/4-Z,1/4+X
+ 1/4-Y,1/4+Z,3/4+X
+ 3/4+Y,3/4+Z,3/4-X
+ -Y,-X,1/2+Z
+ 1/2+Y,X,Z
+ 1/2-Y,1/2+X,1/2-Z
+ Y,1/2-X,-Z
+ -X,-Z,1/2+Y
+ X,1/2-Z,-Y
+ 1/2+X,Z,Y
+ 1/2-X,1/2+Z,1/2-Y
+ -Z,-Y,1/2+X
+ 1/2-Z,1/2+Y,1/2-X
+ Z,1/2-Y,-X
+ 1/2+Z,Y,X
+ 1/2+X,Y,1/2+Z
+ 1/2-X,1/2-Y,Z
+ -X,1/2+Y,1/2-Z
+ X,-Y,-Z
+ 1/2+Z,X,1/2+Y
+ Z,-X,-Y
+ 1/2-Z,1/2-X,Y
+ -Z,1/2+X,1/2-Y
+ 1/2+Y,Z,1/2+X
+ -Y,1/2+Z,1/2-X
+ Y,-Z,-X
+ 1/2-Y,1/2-Z,X
+ 1/4+Y,1/4+X,1/4-Z
+ 3/4-Y,1/4-X,3/4-Z
+ 3/4+Y,3/4-X,1/4+Z
+ 1/4-Y,3/4+X,3/4+Z
+ 1/4+X,1/4+Z,1/4-Y
+ 1/4-X,3/4+Z,3/4+Y
+ 3/4-X,1/4-Z,3/4-Y
+ 3/4+X,3/4-Z,1/4+Y
+ 1/4+Z,1/4+Y,1/4-X
+ 3/4+Z,3/4-Y,1/4+X
+ 1/4-Z,3/4+Y,3/4+X
+ 3/4-Z,1/4-Y,3/4-X
+ 1/4-X,3/4-Y,1/4-Z
+ 1/4+X,1/4+Y,3/4-Z
+ 3/4+X,1/4-Y,1/4+Z
+ 3/4-X,3/4+Y,3/4+Z
+ 1/4-Z,3/4-X,1/4-Y
+ 3/4-Z,3/4+X,3/4+Y
+ 1/4+Z,1/4+X,3/4-Y
+ 3/4+Z,1/4-X,1/4+Y
+ 1/4-Y,3/4-Z,1/4-X
+ 3/4+Y,1/4-Z,1/4+X
+ 3/4-Y,3/4+Z,3/4+X
+ 1/4+Y,1/4+Z,3/4-X
+ 1/2-Y,1/2-X,1/2+Z
+ Y,1/2+X,Z
+ -Y,X,1/2-Z
+ 1/2+Y,-X,-Z
+ 1/2-X,1/2-Z,1/2+Y
+ 1/2+X,-Z,-Y
+ X,1/2+Z,Y
+ -X,Z,1/2-Y
+ 1/2-Z,1/2-Y,1/2+X
+ -Z,Y,1/2-X
+ 1/2+Z,-Y,-X
+ Z,1/2+Y,X
+ 1/2+X,1/2+Y,Z
+ 1/2-X,-Y,1/2+Z
+ -X,Y,-Z
+ X,1/2-Y,1/2-Z
+ 1/2+Z,1/2+X,Y
+ Z,1/2-X,1/2-Y
+ 1/2-Z,-X,1/2+Y
+ -Z,X,-Y
+ 1/2+Y,1/2+Z,X
+ -Y,Z,-X
+ Y,1/2-Z,1/2-X
+ 1/2-Y,-Z,1/2+X
+ 1/4+Y,3/4+X,3/4-Z
+ 3/4-Y,3/4-X,1/4-Z
+ 3/4+Y,1/4-X,3/4+Z
+ 1/4-Y,1/4+X,1/4+Z
+ 1/4+X,3/4+Z,3/4-Y
+ 1/4-X,1/4+Z,1/4+Y
+ 3/4-X,3/4-Z,1/4-Y
+ 3/4+X,1/4-Z,3/4+Y
+ 1/4+Z,3/4+Y,3/4-X
+ 3/4+Z,1/4-Y,3/4+X
+ 1/4-Z,1/4+Y,1/4+X
+ 3/4-Z,3/4-Y,1/4-X
+ 1/4-X,1/4-Y,3/4-Z
+ 1/4+X,3/4+Y,1/4-Z
+ 3/4+X,3/4-Y,3/4+Z
+ 3/4-X,1/4+Y,1/4+Z
+ 1/4-Z,1/4-X,3/4-Y
+ 3/4-Z,1/4+X,1/4+Y
+ 1/4+Z,3/4+X,1/4-Y
+ 3/4+Z,3/4-X,3/4+Y
+ 1/4-Y,1/4-Z,3/4-X
+ 3/4+Y,3/4-Z,3/4+X
+ 3/4-Y,1/4+Z,1/4+X
+ 1/4+Y,3/4+Z,1/4-X
+ 1/2-Y,-X,Z
+ Y,X,1/2+Z
+ -Y,1/2+X,-Z
+ 1/2+Y,1/2-X,1/2-Z
+ 1/2-X,-Z,Y
+ 1/2+X,1/2-Z,1/2-Y
+ X,Z,1/2+Y
+ -X,1/2+Z,-Y
+ 1/2-Z,-Y,X
+ -Z,1/2+Y,-X
+ 1/2+Z,1/2-Y,1/2-X
+ Z,Y,1/2+X
+229 96 48 Im-3m PGm3barm CUBIC 'I 4/m -3 2/m' 'I m -3 m'
+ X,Y,Z
+ -X,-Y,Z
+ -X,Y,-Z
+ X,-Y,-Z
+ Z,X,Y
+ Z,-X,-Y
+ -Z,-X,Y
+ -Z,X,-Y
+ Y,Z,X
+ -Y,Z,-X
+ Y,-Z,-X
+ -Y,-Z,X
+ Y,X,-Z
+ -Y,-X,-Z
+ Y,-X,Z
+ -Y,X,Z
+ X,Z,-Y
+ -X,Z,Y
+ -X,-Z,-Y
+ X,-Z,Y
+ Z,Y,-X
+ Z,-Y,X
+ -Z,Y,X
+ -Z,-Y,-X
+ -X,-Y,-Z
+ X,Y,-Z
+ X,-Y,Z
+ -X,Y,Z
+ -Z,-X,-Y
+ -Z,X,Y
+ Z,X,-Y
+ Z,-X,Y
+ -Y,-Z,-X
+ Y,-Z,X
+ -Y,Z,X
+ Y,Z,-X
+ -Y,-X,Z
+ Y,X,Z
+ -Y,X,-Z
+ Y,-X,-Z
+ -X,-Z,Y
+ X,-Z,-Y
+ X,Z,Y
+ -X,Z,-Y
+ -Z,-Y,X
+ -Z,Y,-X
+ Z,-Y,-X
+ Z,Y,X
+ 1/2+X,1/2+Y,1/2+Z
+ 1/2-X,1/2-Y,1/2+Z
+ 1/2-X,1/2+Y,1/2-Z
+ 1/2+X,1/2-Y,1/2-Z
+ 1/2+Z,1/2+X,1/2+Y
+ 1/2+Z,1/2-X,1/2-Y
+ 1/2-Z,1/2-X,1/2+Y
+ 1/2-Z,1/2+X,1/2-Y
+ 1/2+Y,1/2+Z,1/2+X
+ 1/2-Y,1/2+Z,1/2-X
+ 1/2+Y,1/2-Z,1/2-X
+ 1/2-Y,1/2-Z,1/2+X
+ 1/2+Y,1/2+X,1/2-Z
+ 1/2-Y,1/2-X,1/2-Z
+ 1/2+Y,1/2-X,1/2+Z
+ 1/2-Y,1/2+X,1/2+Z
+ 1/2+X,1/2+Z,1/2-Y
+ 1/2-X,1/2+Z,1/2+Y
+ 1/2-X,1/2-Z,1/2-Y
+ 1/2+X,1/2-Z,1/2+Y
+ 1/2+Z,1/2+Y,1/2-X
+ 1/2+Z,1/2-Y,1/2+X
+ 1/2-Z,1/2+Y,1/2+X
+ 1/2-Z,1/2-Y,1/2-X
+ 1/2-X,1/2-Y,1/2-Z
+ 1/2+X,1/2+Y,1/2-Z
+ 1/2+X,1/2-Y,1/2+Z
+ 1/2-X,1/2+Y,1/2+Z
+ 1/2-Z,1/2-X,1/2-Y
+ 1/2-Z,1/2+X,1/2+Y
+ 1/2+Z,1/2+X,1/2-Y
+ 1/2+Z,1/2-X,1/2+Y
+ 1/2-Y,1/2-Z,1/2-X
+ 1/2+Y,1/2-Z,1/2+X
+ 1/2-Y,1/2+Z,1/2+X
+ 1/2+Y,1/2+Z,1/2-X
+ 1/2-Y,1/2-X,1/2+Z
+ 1/2+Y,1/2+X,1/2+Z
+ 1/2-Y,1/2+X,1/2-Z
+ 1/2+Y,1/2-X,1/2-Z
+ 1/2-X,1/2-Z,1/2+Y
+ 1/2+X,1/2-Z,1/2-Y
+ 1/2+X,1/2+Z,1/2+Y
+ 1/2-X,1/2+Z,1/2-Y
+ 1/2-Z,1/2-Y,1/2+X
+ 1/2-Z,1/2+Y,1/2-X
+ 1/2+Z,1/2-Y,1/2-X
+ 1/2+Z,1/2+Y,1/2+X
+230 96 48 Ia-3d PGm3barm CUBIC 'I 41/a -3 2/d' 'I a -3 d'
+ X,Y,Z
+ 1/2-X,-Y,1/2+Z
+ -X,1/2+Y,1/2-Z
+ 1/2+X,1/2-Y,-Z
+ Z,X,Y
+ 1/2+Z,1/2-X,-Y
+ 1/2-Z,-X,1/2+Y
+ -Z,1/2+X,1/2-Y
+ Y,Z,X
+ -Y,1/2+Z,1/2-X
+ 1/2+Y,1/2-Z,-X
+ 1/2-Y,-Z,1/2+X
+ 3/4+Y,1/4+X,1/4-Z
+ 3/4-Y,3/4-X,3/4-Z
+ 1/4+Y,1/4-X,3/4+Z
+ 1/4-Y,3/4+X,1/4+Z
+ 3/4+X,1/4+Z,1/4-Y
+ 1/4-X,3/4+Z,1/4+Y
+ 3/4-X,3/4-Z,3/4-Y
+ 1/4+X,1/4-Z,3/4+Y
+ 3/4+Z,1/4+Y,1/4-X
+ 1/4+Z,1/4-Y,3/4+X
+ 1/4-Z,3/4+Y,1/4+X
+ 3/4-Z,3/4-Y,3/4-X
+ -X,-Y,-Z
+ 1/2+X,Y,1/2-Z
+ X,1/2-Y,1/2+Z
+ 1/2-X,1/2+Y,Z
+ -Z,-X,-Y
+ 1/2-Z,1/2+X,Y
+ 1/2+Z,X,1/2-Y
+ Z,1/2-X,1/2+Y
+ -Y,-Z,-X
+ Y,1/2-Z,1/2+X
+ 1/2-Y,1/2+Z,X
+ 1/2+Y,Z,1/2-X
+ 1/4-Y,3/4-X,3/4+Z
+ 1/4+Y,1/4+X,1/4+Z
+ 3/4-Y,3/4+X,1/4-Z
+ 3/4+Y,1/4-X,3/4-Z
+ 1/4-X,3/4-Z,3/4+Y
+ 3/4+X,1/4-Z,3/4-Y
+ 1/4+X,1/4+Z,1/4+Y
+ 3/4-X,3/4+Z,1/4-Y
+ 1/4-Z,3/4-Y,3/4+X
+ 3/4-Z,3/4+Y,1/4-X
+ 3/4+Z,1/4-Y,3/4-X
+ 1/4+Z,1/4+Y,1/4+X
+ 1/2+X,1/2+Y,1/2+Z
+ -X,1/2-Y,Z
+ 1/2-X,Y,-Z
+ X,-Y,1/2-Z
+ 1/2+Z,1/2+X,1/2+Y
+ Z,-X,1/2-Y
+ -Z,1/2-X,Y
+ 1/2-Z,X,-Y
+ 1/2+Y,1/2+Z,1/2+X
+ 1/2-Y,Z,-X
+ Y,-Z,1/2-X
+ -Y,1/2-Z,X
+ 1/4+Y,3/4+X,3/4-Z
+ 1/4-Y,1/4-X,1/4-Z
+ 3/4+Y,3/4-X,1/4+Z
+ 3/4-Y,1/4+X,3/4+Z
+ 1/4+X,3/4+Z,3/4-Y
+ 3/4-X,1/4+Z,3/4+Y
+ 1/4-X,1/4-Z,1/4-Y
+ 3/4+X,3/4-Z,1/4+Y
+ 1/4+Z,3/4+Y,3/4-X
+ 3/4+Z,3/4-Y,1/4+X
+ 3/4-Z,1/4+Y,3/4+X
+ 1/4-Z,1/4-Y,1/4-X
+ 1/2-X,1/2-Y,1/2-Z
+ X,1/2+Y,-Z
+ 1/2+X,-Y,Z
+ -X,Y,1/2+Z
+ 1/2-Z,1/2-X,1/2-Y
+ -Z,X,1/2+Y
+ Z,1/2+X,-Y
+ 1/2+Z,-X,Y
+ 1/2-Y,1/2-Z,1/2-X
+ 1/2+Y,-Z,X
+ -Y,Z,1/2+X
+ Y,1/2+Z,-X
+ 3/4-Y,1/4-X,1/4+Z
+ 3/4+Y,3/4+X,3/4+Z
+ 1/4-Y,1/4+X,3/4-Z
+ 1/4+Y,3/4-X,1/4-Z
+ 3/4-X,1/4-Z,1/4+Y
+ 1/4+X,3/4-Z,1/4-Y
+ 3/4+X,3/4+Z,3/4+Y
+ 1/4-X,1/4+Z,3/4-Y
+ 3/4-Z,1/4-Y,1/4+X
+ 1/4-Z,1/4+Y,3/4-X
+ 1/4+Z,3/4-Y,1/4-X
+ 3/4+Z,3/4+Y,3/4+X
+1003 2 2 P2 PG2C MONOCLINIC 'P 1 1 2'  !(dyad along z)
+ X,Y,Z
+ -X,-Y,Z
+1004 2 2 P1121 PG2C MONOCLINIC 'P 1 1 21'  !(unique axis c)
+ X,Y,Z 
+ -X,-Y,1/2+Z
+3004 4 2 I21 PG2 MONOCLINIC  'I 1 21 1'
+ X,Y,Z 
+ -X,1/2+Y,-Z
+ X+1/2,Y+1/2,Z+1/2 
+ -X+1/2,Y,1/2-Z
+1005 4 2 B2 PG2C MONOCLINIC 'B 1 1 2' 'B 2'
+ X,Y,Z 
+ -X,-Y,Z 
+ 1/2+X,+Y,1/2+Z 
+ 1/2-X,-Y,1/2+Z
+2005 4 2 A2 PG2C MONOCLINIC 'A 2 1 1'  
+ X, Y, Z 
+ X,-Y,-Z
+ X,1/2+Y,1/2+Z
+ X,1/2-Y,1/2-Z
+3005 4 2 C21 PG2 MONOCLINIC 'C 1 21 1' ! (Origin on screw at 1/4X)
+ X, Y, Z 
+ -X,1/2+Y,-Z
+ 1/2+X,1/2+Y,Z 
+  1/2-X, Y,-Z
+4005 4 2 I2 PG2 MONOCLINIC 'I 1 2 1' 'I 2' !!! GJK @ 2003-06-02
+ X,Y,Z
+ -X,Y,-Z
+ X+1/2,Y+1/2,Z+1/2
+ -X+1/2,Y+1/2,-Z+1/2
+1006 2 2 P11m       PG2C MONOCLINIC 'P 1 1 m'
+ X,Y,Z 
+ X,Y,-Z
+1007 2 2 P11b       PG2C MONOCLINIC 'P 1 1 b'
+ X,Y,Z
+ X,1/2+Y,-Z
+1008 4 2 B11m       PG2 MONOCLINIC 'B 1 1 m'
+ X,Y,Z
+ X,-Y,Z
+ 1/2+X,1/2+Y,Z
+ 1/2+X,1/2-Y,Z
+1009 4 2 B11b       PG2C MONOCLINIC 'B 1 1 b'
+ X,Y,Z
+ X,1/2+Y,-Z
+ 1/2+X,Y,1/2+Z
+ 1/2+X,1/2+Y,1/2-Z
+1010 4 4 P112/m     PG2C MONOCLINIC 'P 1 1 2/m'
+ X,Y,Z
+ X,Y,-Z
+ -X,-Y,Z
+ -X,-Y,-Z
+1011 4 4 P1121/m    PG2C MONOCLINIC 'P 1 1 21/m'
+ X,Y,Z
+ -X,-Y,1/2+Z
+ -X,-Y,-Z
+ X,Y,1/2-Z
+1012 8 4 B112/m     PG2C MONOCLINIC 'B 1 1 2/m' 
+ X,Y,Z
+ X,Y,-Z
+ -X,-Y,Z
+ -X,-Y,-Z
+ 1/2+X,Y,1/2+Z
+ 1/2+X,Y,1/2-Z
+ 1/2-X,-Y,1/2+Z
+ 1/2-X,-Y,1/2-Z
+1013 4 4 P112/b     PG2C MONOCLINIC 'P 1 1 2/b' 
+ X,Y,Z
+ -X,1/2-Y,Z
+ -X,-Y,-Z
+ X,1/2+Y,-Z
+1014 4 4 P1121/b    PG2C MONOCLINIC 'P 1 1 21/b'
+ X,Y,Z
+ -X,-Y,-Z
+ -X,1/2-Y,1/2+Z
+ X,1/2+Y,1/2-Z
+1015 8 4 B112/b     PG2C MONOCLINIC 'B 1 1 2/b' 
+ X,Y,Z
+ -X,1/2-Y,Z
+ -X,-Y,-Z
+ X,1/2+Y,-Z
+ 1/2+X,Y,1/2+Z
+ 1/2-X,1/2-Y,1/2+Z
+ 1/2-X,-Y,1/2-Z
+ 1/2+X,1/2+Y,1/2-Z
+1017 4 4 P2122 PG222 ORTHORHOMBIC 'P 21 2 2' !(unique axis a)
+ X,Y,Z 
+ -X,Y,-Z 
+ 1/2+X,-Y,-Z 
+ 1/2-X,-Y,Z
+2017 4 4 P2212 PG222 ORTHORHOMBIC 'P 2 21 2' !(unique axis b)
+  X,Y,Z 
+  X,1/2-Y,-Z 
+ -X,1/2+Y,-Z 
+ -X,-Y,Z
+1018 4 4 P21212a PG222 ORTHORHOMBIC 'P 21 21 2 (a)' ! origin on 21 21, shift (1/4,1/4,0)
+ X,Y,Z 
+ 1/2-X,1/2-Y,Z 
+ X+1/2,-Y,-Z 
+ -X,Y+1/2,-Z
+2018 4 4 P21221 PG222 ORTHORHOMBIC 'P 21 2 21'  !(unique axis b)
+ X,Y,Z 
+ -X,Y,-Z 
+ 1/2+X,-Y,1/2-Z 
+ 1/2-X,-Y,1/2+Z
+3018 4 4 P22121 PG222 ORTHORHOMBIC 'P 2 21 21'  !(unique axis a)
+ X,Y,Z 
+  X,-Y,-Z 
+ -X,1/2+Y,1/2-Z 
+ -X,1/2-Y,1/2+Z
+1020 8 4 C2221a PG222 ORTHORHOMBIC 'C 2 2 21a)' ! P212121 with C centring, shift(1/4,0,0)
+ X,Y,Z 
+ 1/2-X,-Y,1/2+Z 
+ 1/2+X,1/2-Y,-Z 
+ -X,1/2+Y,1/2-Z
+ 1/2+X,1/2+Y,Z 
+ -X,1/2-Y,1/2+Z 
+ X,-Y,-Z 
+ 1/2-X,Y,1/2-Z
+1021 8 4 C222a PG222 ORTHORHOMBIC 'C 2 2 2a'  ! C21212a origin on 21 21
+ X,Y,Z 
+ 1/2-X,1/2-Y,Z 
+ X+1/2,-Y,-Z 
+ -X,Y+1/2,-Z
+ 1/2+ X,1/2+Y,Z 
+ -X,-Y,Z 
+ X,1/2-Y,-Z 
+ 1/2-X,Y,-Z
+1022 16 4 F222a PG222 ORTHORHOMBIC 'F 2 2 2a' ! same as 1018 with face centring  shift (1/4,0,0)
+ X,Y,Z         
+ 1/2-X,1/2-Y,Z 
+ X+1/2,-Y,-Z 
+ -X,Y+1/2,-Z
+ X,Y+1/2,Z+1/2 
+ 1/2-X,-Y,Z+1/2 
+ X+1/2,-Y+1/2,-Z+1/2 
+ -X,Y,-Z+1/2
+ X+1/2,Y,Z+1/2 
+ -X,1/2-Y,Z+1/2 
+ X,-Y,-Z+1/2 
+ -X+1/2,Y+1/2,-Z+1/2
+ X+1/2,Y+1/2,Z 
+ -X,-Y,Z 
+ X,-Y+1/2,-Z 
+ -X+1/2,Y,-Z
+1023 8 4 I222a PG222 ORTHORHOMBIC 'I 2 2 2a'  ! as 1018 with origin shift (1/4,1/4,1/4)
+ X,Y,Z 
+ 1/2-X,1/2-Y,Z 
+ X+1/2,-Y,-Z 
+ -X,Y+1/2,-Z
+ 1/2+X,1/2+Y,1/2+Z 
+  -X,-Y,1/2+Z
+ 1/2-X,Y,1/2-Z 
+  X,1/2-Y,1/2-Z
+1059 8 8 Pmmn2 PGmmm ORTHORHOMBIC 'P 21/m 21/m 2/n a'
+ X,Y,Z
+ 1/2-X,1/2-Y,Z
+ -X,1/2+Y,-Z
+ 1/2+X,-Y,-Z
+ -X,-Y,-Z
+ X+1/2,Y+1/2,-Z
+ X,1/2-Y,Z
+ 1/2-X,Y,Z
+1094 8 8 P42212a PG422 TETRAGONAL 'P 42 21 2a' ! (as P21212a) origin on 21 21 ie Shift 1/4,1/4,1/4
+ X,Y,Z                 
+ 1/2-X,1/2-Y,Z
+ -Y,X+1/2,1/2+Z        
+ Y+1/2,-X,1/2+Z
+ -X,Y+1/2,-Z           
+ X+1/2,-Y,-Z
+ Y,X,1/2-Z             
+ 1/2-Y,1/2-X,1/2-Z
+1197 24 12 I23a PG23 CUBIC 'I 2 3a' ! Expansion of 1023 which is an expansion of 1018
+ X,Y,Z
+ 1/2-X,1/2-Y,Z
+ X+1/2,-Y,-Z
+ -X,Y+1/2,-Z
+ Y,Z,X
+ 1/2-Y,1/2-Z,X
+ Y+1/2,-Z,-X
+ -Y,Z+1/2,-X
+ Z,X,Y
+ 1/2-Z,1/2-X,Y
+ Z+1/2,-X,-Y
+ -Z,X+1/2,-Y
+ 1/2+X,1/2+Y,1/2+Z
+ -X,-Y,1/2+Z
+ X,1/2-Y,1/2-Z
+ 1/2-X,Y,1/2-Z
+ 1/2+Y,1/2+Z,1/2+X
+ -Y,-Z,1/2+X
+ Y,1/2-Z,1/2-X
+ 1/2-Y,Z,1/2-X
+ 1/2+Z,1/2+X,1/2+Y
+ -Z,-X,1/2+Y
+ Z,1/2-X,1/2-Y
+ 1/2-Z,X,1/2-Y
diff -ruN ccp4-5.99.5-orig/lib/cctbx/cctbx_sources/ccp4io/lib/src/ccp4_array.c ccp4-5.99.5/lib/cctbx/cctbx_sources/ccp4io/lib/src/ccp4_array.c
--- ccp4-5.99.5-orig/lib/cctbx/cctbx_sources/ccp4io/lib/src/ccp4_array.c	1969-12-31 16:00:00.000000000 -0800
+++ ccp4-5.99.5/lib/cctbx/cctbx_sources/ccp4io/lib/src/ccp4_array.c	2005-11-30 17:40:04.000000000 -0800
@@ -0,0 +1,179 @@
+/*
+     ccp4_array.c: implementation file for resizable array implementation.
+     Copyright (C) 2002  Kevin Cowtan
+
+     This library is free software and is distributed under the terms and
+     conditions of the CCP4 licence agreement as `Part 0' (Annex 2)
+     software, which is version 2.1 of the GNU Lesser General Public
+     Licence (LGPL) with the following additional clause:
+
+        `You may also combine or link a "work that uses the Library" to
+        produce a work containing portions of the Library, and distribute
+        that work under terms of your choice, provided that you give
+        prominent notice with each copy of the work that the specified
+        version of the Library is used in it, and that you include or
+        provide public access to the complete corresponding
+        machine-readable source code for the Library including whatever
+        changes were used in the work. (i.e. If you make changes to the
+        Library you must distribute those, but you do not need to
+        distribute source or object code to those portions of the work
+        not covered by this licence.)'
+
+     Note that this clause grants an additional right and does not impose
+     any additional restriction, and so does not affect compatibility
+     with the GNU General Public Licence (GPL). If you wish to negotiate
+     other terms, please contact the maintainer.
+
+     You can redistribute it and/or modify the library under the terms of
+     the GNU Lesser General Public License as published by the Free Software
+     Foundation; either version 2.1 of the License, or (at your option) any
+     later version.
+
+     This library is distributed in the hope that it will be useful, but
+     WITHOUT ANY WARRANTY; without even the implied warranty of
+     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+     Lesser General Public License for more details.
+
+     You should have received a copy of the CCP4 licence and/or GNU
+     Lesser General Public License along with this library; if not, write
+     to the CCP4 Secretary, Daresbury Laboratory, Warrington WA4 4AD, UK.
+     The GNU Lesser General Public can also be obtained by writing to the
+     Free Software Foundation, Inc., 59 Temple Place, Suite 330, Boston,
+     MA 02111-1307 USA
+*/
+
+/** @file ccp4_array.c
+ *  implementation file for resizable array implementation.
+ *  Kevin Cowtan
+ */
+
+#include "ccp4_array.h"
+
+ccp4_ptr ccp4array_new_(ccp4_ptr *p)
+{
+  ccp4array_base *v;
+  v = (ccp4array_base *)malloc(sizeof(ccp4array_base));
+  v->size = v->capacity = 0;
+  *p = (ccp4_ptr *)((ccp4_byteptr)(v)+sizeof(ccp4array_base));
+  return *p;
+}
+
+ccp4_ptr ccp4array_new_size_(ccp4_ptr *p, const int size, const size_t reclen)
+{
+  ccp4array_base *v;
+  int capacity = (size * 12) / 10 + 2;
+  v = (ccp4array_base *)malloc(sizeof(ccp4array_base) + capacity * reclen);
+  v->size = size;
+  v->capacity = capacity;
+  *p = (ccp4_ptr *)((ccp4_byteptr)(v)+sizeof(ccp4array_base));
+  return *p;
+}
+
+void ccp4array_resize_(ccp4_ptr *p, const int size, const size_t reclen)
+{
+  ccp4array_base *v;
+  v = (ccp4array_base *)((ccp4_byteptr)(*p)-sizeof(ccp4array_base));
+  if (size > v->capacity) {
+    v->capacity = (size * 12) / 10 + 2;
+    v = (ccp4array_base *)realloc(v, sizeof(ccp4array_base) + v->capacity * reclen);
+    *p = (ccp4_ptr *)((ccp4_byteptr)(v)+sizeof(ccp4array_base));
+  }
+  v->size = size;
+}
+
+void ccp4array_reserve_(ccp4_ptr *p, const int size, const size_t reclen)
+{
+  ccp4array_base *v;
+  v = (ccp4array_base *)((ccp4_byteptr)(*p)-sizeof(ccp4array_base));
+  v->capacity = size;
+  if ( v->size > size ) v->size = size;
+  v = (ccp4array_base *)realloc(v, sizeof(ccp4array_base) + v->capacity * reclen);
+  *p = (ccp4_ptr *)((ccp4_byteptr)(v)+sizeof(ccp4array_base));
+}
+
+void ccp4array_append_(ccp4_ptr *p, ccp4_constptr data, const size_t reclen)
+{
+  ccp4array_base *v;
+  int osize;
+  v = (ccp4array_base *)((ccp4_byteptr)(*p)-sizeof(ccp4array_base));
+  osize = v->size;
+  ccp4array_resize_(p, osize+1, reclen);
+  memcpy((ccp4_byteptr)(*p)+osize*reclen, data, reclen);
+}
+
+void ccp4array_append_n_(ccp4_ptr *p, ccp4_constptr data, const int n, const size_t reclen)
+{
+  ccp4array_base *v;
+  ccp4_byteptr newdata;
+  int osize, i;
+  v = (ccp4array_base *)((ccp4_byteptr)(*p)-sizeof(ccp4array_base));
+  osize = v->size;
+  ccp4array_resize_(p, osize+n, reclen);
+  newdata = (ccp4_byteptr)(*p)+osize*reclen;
+  for ( i = 0; i < n; i++ ) {
+    memcpy(newdata, data, reclen);
+    newdata += reclen;
+  }
+}
+
+void ccp4array_append_list_(ccp4_ptr *p, ccp4_constptr data, const int n, const size_t reclen)
+{
+  ccp4array_base *v;
+  int osize;
+  v = (ccp4array_base *)((ccp4_byteptr)(*p)-sizeof(ccp4array_base));
+  osize = v->size;
+  ccp4array_resize_(p, osize+n, reclen);
+  memcpy((ccp4_byteptr)(*p)+osize*reclen, data, n * reclen);
+}
+
+void ccp4array_insert_(ccp4_ptr *p, const int i, ccp4_constptr data, const size_t reclen)
+{
+  ccp4array_base *v;
+  int osize;
+  v = (ccp4array_base *)((ccp4_byteptr)(*p)-sizeof(ccp4array_base));
+  osize = v->size;
+  ccp4array_resize_(p, osize+1, reclen);
+  memmove((ccp4_byteptr)(*p)+(i+1)*reclen, (ccp4_byteptr)(*p)+i*reclen, (osize-i)*reclen);
+  memcpy((ccp4_byteptr)(*p)+i*reclen, data, reclen);  
+}
+
+void ccp4array_delete_ordered_(ccp4_ptr *p, const int i, const size_t reclen)
+{
+  ccp4array_base *v;
+  int nsize;
+  v = (ccp4array_base *)((ccp4_byteptr)(*p)-sizeof(ccp4array_base));
+  nsize = v->size - 1;
+  memmove((ccp4_byteptr)(*p)+i*reclen, (ccp4_byteptr)(*p)+(i+1)*reclen, (nsize-i)*reclen);
+  v->size--; /* ccp4array_resize_(p, nsize, reclen); */
+}
+
+void ccp4array_delete_(ccp4_ptr *p, const int i, const size_t reclen)
+{
+  ccp4array_base *v;
+  int nsize;
+  v = (ccp4array_base *)((ccp4_byteptr)(*p)-sizeof(ccp4array_base));
+  nsize = v->size - 1;
+  memcpy((ccp4_byteptr)(*p)+i*reclen, (ccp4_byteptr)(*p)+nsize*reclen, reclen);
+  v->size--; /* ccp4array_resize_(p, size, reclen); */
+}
+
+void ccp4array_delete_last_(ccp4_ptr *p, const size_t reclen)
+{
+  ccp4array_base *v;
+  v = (ccp4array_base *)((ccp4_byteptr)(*p)-sizeof(ccp4array_base));
+  v->size--; /* ccp4array_resize_(p, v->size-1, reclen); */
+}
+
+int ccp4array_size_(ccp4_constptr *p)
+{
+  ccp4array_base *v;
+  v = (ccp4array_base *)((ccp4_byteptr)(*p)-sizeof(ccp4array_base));
+  return v->size;
+}
+
+void ccp4array_free_(ccp4_ptr *p)
+{
+  ccp4array_base *v;
+  v = (ccp4array_base *)((ccp4_byteptr)(*p)-sizeof(ccp4array_base));
+  free(v);
+}
diff -ruN ccp4-5.99.5-orig/lib/cctbx/cctbx_sources/ccp4io/lib/src/ccp4_array.h ccp4-5.99.5/lib/cctbx/cctbx_sources/ccp4io/lib/src/ccp4_array.h
--- ccp4-5.99.5-orig/lib/cctbx/cctbx_sources/ccp4io/lib/src/ccp4_array.h	1969-12-31 16:00:00.000000000 -0800
+++ ccp4-5.99.5/lib/cctbx/cctbx_sources/ccp4io/lib/src/ccp4_array.h	2005-11-30 17:40:04.000000000 -0800
@@ -0,0 +1,275 @@
+/*
+     ccp4_array.h: header file for resizable array implementation. 
+     Copyright (C) 2002  Kevin Cowtan
+
+     This library is free software and is distributed under the terms and
+     conditions of the CCP4 licence agreement as `Part 0' (Annex 2)
+     software, which is version 2.1 of the GNU Lesser General Public
+     Licence (LGPL) with the following additional clause:
+
+        `You may also combine or link a "work that uses the Library" to
+        produce a work containing portions of the Library, and distribute
+        that work under terms of your choice, provided that you give
+        prominent notice with each copy of the work that the specified
+        version of the Library is used in it, and that you include or
+        provide public access to the complete corresponding
+        machine-readable source code for the Library including whatever
+        changes were used in the work. (i.e. If you make changes to the
+        Library you must distribute those, but you do not need to
+        distribute source or object code to those portions of the work
+        not covered by this licence.)'
+
+     Note that this clause grants an additional right and does not impose
+     any additional restriction, and so does not affect compatibility
+     with the GNU General Public Licence (GPL). If you wish to negotiate
+     other terms, please contact the maintainer.
+
+     You can redistribute it and/or modify the library under the terms of
+     the GNU Lesser General Public License as published by the Free Software
+     Foundation; either version 2.1 of the License, or (at your option) any
+     later version.
+
+     This library is distributed in the hope that it will be useful, but
+     WITHOUT ANY WARRANTY; without even the implied warranty of
+     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+     Lesser General Public License for more details.
+
+     You should have received a copy of the CCP4 licence and/or GNU
+     Lesser General Public License along with this library; if not, write
+     to the CCP4 Secretary, Daresbury Laboratory, Warrington WA4 4AD, UK.
+     The GNU Lesser General Public can also be obtained by writing to the
+     Free Software Foundation, Inc., 59 Temple Place, Suite 330, Boston,
+     MA 02111-1307 USA
+*/
+
+/** @file ccp4_array.h
+ *  header file for resizable array implementation.
+ *  Kevin Cowtan
+ */
+
+/*
+CCP4 resizable array implementation.
+
+This defines an object and methods which looks just like a simple C
+array, but can be resized at will without incurring excessive
+overheads.
+
+A pointer to the desired type is created. Array elements are accessed
+from this pointer as normal. Other operations depend on macros which
+extract the stored type from the type of the pointer.
+
+The array is managed with a header, which is positioned before the
+beginning of the array. The malloc'ed memory area starts at the
+beginning of this header. However the pointer to the header is not
+stored, but rather derived from the array pointer whenever it is
+required.
+
+Arrays have a size and a capacity. The size is the number of elements
+in use, and the capacity is the number of elements available before a
+new memory allocation is required. When new memory is required, an
+excess is reqested to allow the array to grow further before
+performing another malloc.
+
+If the precise amount of memory is known, the capacity can be
+controlled directly using the 'reserve' macro.
+
+Example: to handle an array of type mytype:
+
+\code
+  int i;
+  mytype x,y;
+  mytype *array;
+
+  ccp4array_new(array);
+
+  ccp4array_append_n(array, x, 3);
+
+  for ( i = 0; i < 3; i++ ) y = array[i];
+
+  ccp4array_free(array);
+\endcode
+*/
+
+#ifndef __CCP4_ARRAY_INC
+#define __CCP4_ARRAY_INC
+
+#ifdef  __cplusplus
+extern "C" {
+#endif
+
+#include <stdlib.h>
+#include <string.h>
+
+/*! constant pointer type */
+typedef const void *ccp4_constptr;
+/*! byte pointer type */
+typedef char *ccp4_byteptr;
+/*! pointer type */
+typedef void *ccp4_ptr;
+
+/*! struct definition for the array pre-header */
+typedef struct ccp4array_base_ {
+  int size, capacity;
+} ccp4array_base;
+
+/*! Macro to allocate a new array.
+  The array is allocated with a size and capacity of 0
+  \param v   The array pointer
+  \return    The new array pointer (redundent)
+*/
+#define ccp4array_new(v) ccp4array_new_((ccp4_ptr*)(&v))
+
+/*! Macro to allocate a new array with non-zero size.
+  The array is allocated with a size of s and capacity of at least s
+  \param v   The array pointer
+  \param s   The new size
+  \return    The new array pointer (redundent)
+*/
+#define ccp4array_new_size(v,s) ccp4array_new_size_((ccp4_ptr*)(&v),s,sizeof(*v))
+
+/*! Macro to resize an array.
+  This changes the size. Memory allocation only takes place if the new
+  size is greater than the capacity. If that occurs, the new capacity
+  will be slightly greater than the requested size, to allow room for
+  expansion.
+  \param v   The array pointer
+  \param s   The new size
+*/
+#define ccp4array_resize(v,s) ccp4array_resize_((ccp4_ptr*)(&v),s,sizeof(*v))
+
+/*! Macro to reserve space for an array.
+  This forces a memory reallocation. The size of the array is
+  unchanged, unless the new capacity is less than the current size, in
+  which case the size is set to the new capacity. Unlike resize, the
+  new allocation will be exactly the size of the array.
+  \param v   The array pointer
+  \param s   The new capacity
+*/
+#define ccp4array_reserve(v,s) ccp4array_reserve_((ccp4_ptr*)(&v),s,sizeof(*v))
+
+/*! Macro to append an element to an array.
+  This increments the size. Memory allocation only takes place if the new
+  size is greater than the capacity.
+  \param v   The array pointer
+  \param d   The new element (may not be a literal)
+*/
+#define ccp4array_append(v,d) ccp4array_append_((ccp4_ptr*)(&v),(ccp4_constptr)(&d),sizeof(*v))
+
+/*! Macro to append n copies of an element to an array.
+  This increments the size by n. Memory allocation only takes place if the new
+  size is greater than the capacity.
+  \param v   The array pointer
+  \param d   The new element (may not be a literal)
+  \param n   The number of copies to append
+*/
+#define ccp4array_append_n(v,d,n) ccp4array_append_n_((ccp4_ptr*)(&v),(ccp4_constptr)(&d),n,sizeof(*v))
+
+/*! Macro to append n elements from another list to an array.
+  This increment the size by n. Memory allocation only takes place if the new
+  size is greater than the capacity.
+  \param v   The array pointer
+  \param l   Pointer to the list
+  \param n   The number of copies to append
+*/
+#define ccp4array_append_list(v,l,n) ccp4array_append_list_((ccp4_ptr*)(&v),(ccp4_constptr)l,n,sizeof(*v))
+
+/*! Macro to insert an element before the element[i] of an array.
+  This increments the size. All subsequent elements are moved up. As a
+  result this method is slow.
+  \param v   The array pointer
+  \param d   The new element (may not be a literal)
+  \param i   The element before which the insertion is to be made.
+*/
+#define ccp4array_insert(v,i,d) ccp4array_insert_((ccp4_ptr*)(&v),i,(ccp4_constptr)(&d),sizeof(*v))
+
+/*! Macro to delete element[i] of an array, preserving order.
+  This decrements the size. All subsequent elements are moved down. As a
+  result this method is slow.
+  \param v   The array pointer
+  \param i   The element to be deleted
+*/
+#define ccp4array_delete_ordered(v,i) ccp4array_delete_ordered_((ccp4_ptr*)(&v),i,sizeof(*v))
+
+/*! Macro to delete element[i] of an array without preserving order. The
+  last element is moved into the gap, and the size is decremented.
+  \param v   The array pointer
+  \param i   The element to be deleted
+*/
+#define ccp4array_delete(v,i) ccp4array_delete_((ccp4_ptr*)(&v),i,sizeof(*v))
+
+/*! Macro to delete the last element of an array.
+  This decrements the size.
+  \param v   The array pointer
+*/
+#define ccp4array_delete_last(v) ccp4array_delete_last_((ccp4_ptr*)(&v),sizeof(*v))
+
+/*! Macro to return the size of the array.
+  \param v   The array pointer
+  \return    The size (int)
+*/
+#define ccp4array_size(v) ccp4array_size_((ccp4_constptr*)(&v))
+
+/*! Macro free the array.
+  All memory, including the header, is freed.
+  \param v   The array pointer
+*/
+#define ccp4array_free(v) ccp4array_free_((ccp4_ptr*)(&v))
+
+/** 
+ * See macro ccp4array_new 
+*/
+ccp4_ptr ccp4array_new_(ccp4_ptr *p);
+/** 
+ * See macro ccp4array_new_size 
+*/
+ccp4_ptr ccp4array_new_size_(ccp4_ptr *p, const int size, const size_t reclen);
+/** 
+ * See macro ccp4array_resize 
+*/
+void ccp4array_resize_(ccp4_ptr *p, const int size, const size_t reclen);
+/** 
+ * See macro ccp4array_reserve 
+*/
+void ccp4array_reserve_(ccp4_ptr *p, const int size, const size_t reclen);
+/** 
+ * See macro ccp4array_append 
+*/
+void ccp4array_append_(ccp4_ptr *p, ccp4_constptr data, const size_t reclen);
+/** 
+ * See macro ccp4array_append_n 
+*/
+void ccp4array_append_n_(ccp4_ptr *p, ccp4_constptr data, const int n, const size_t reclen);
+/** 
+ * See macro ccp4array_append_list 
+*/
+void ccp4array_append_list_(ccp4_ptr *p, ccp4_constptr data, const int n, const size_t reclen);
+/** 
+ * See macro ccp4array_insert  
+*/
+void ccp4array_insert_(ccp4_ptr *p, const int i, ccp4_constptr data, const size_t reclen);
+/** 
+ * See macro ccp4array_delete_ordered 
+*/
+void ccp4array_delete_ordered_(ccp4_ptr *p, const int i, const size_t reclen);
+/** 
+ * See macro ccp4array_delete 
+*/
+void ccp4array_delete_(ccp4_ptr *p, const int i, const size_t reclen);
+/** 
+ * See macro ccp4array_delete_last 
+*/
+void ccp4array_delete_last_(ccp4_ptr *p, const size_t reclen);
+/** 
+ * See macro ccp4array_size 
+*/
+int ccp4array_size_(ccp4_constptr *p);
+/** 
+ * See macro ccp4array_free
+*/
+void ccp4array_free_(ccp4_ptr *p);
+
+#ifdef __cplusplus
+} 
+#endif
+
+#endif /* __CCP4_ARRAY_INC */
diff -ruN ccp4-5.99.5-orig/lib/cctbx/cctbx_sources/ccp4io/lib/src/ccp4_errno.h ccp4-5.99.5/lib/cctbx/cctbx_sources/ccp4io/lib/src/ccp4_errno.h
--- ccp4-5.99.5-orig/lib/cctbx/cctbx_sources/ccp4io/lib/src/ccp4_errno.h	1969-12-31 16:00:00.000000000 -0800
+++ ccp4-5.99.5/lib/cctbx/cctbx_sources/ccp4io/lib/src/ccp4_errno.h	2005-11-30 17:40:04.000000000 -0800
@@ -0,0 +1,189 @@
+/*
+     ccp4_errno.h: Header file for error handling routines
+     Copyright (C) 2001  CCLRC, Charles Ballard and Martyn Winn
+
+     This library is free software and is distributed under the terms and
+     conditions of the CCP4 licence agreement as `Part 0' (Annex 2)
+     software, which is version 2.1 of the GNU Lesser General Public
+     Licence (LGPL) with the following additional clause:
+
+        `You may also combine or link a "work that uses the Library" to
+        produce a work containing portions of the Library, and distribute
+        that work under terms of your choice, provided that you give
+        prominent notice with each copy of the work that the specified
+        version of the Library is used in it, and that you include or
+        provide public access to the complete corresponding
+        machine-readable source code for the Library including whatever
+        changes were used in the work. (i.e. If you make changes to the
+        Library you must distribute those, but you do not need to
+        distribute source or object code to those portions of the work
+        not covered by this licence.)'
+
+     Note that this clause grants an additional right and does not impose
+     any additional restriction, and so does not affect compatibility
+     with the GNU General Public Licence (GPL). If you wish to negotiate
+     other terms, please contact the maintainer.
+
+     You can redistribute it and/or modify the library under the terms of
+     the GNU Lesser General Public License as published by the Free Software
+     Foundation; either version 2.1 of the License, or (at your option) any
+     later version.
+
+     This library is distributed in the hope that it will be useful, but
+     WITHOUT ANY WARRANTY; without even the implied warranty of
+     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+     Lesser General Public License for more details.
+
+     You should have received a copy of the CCP4 licence and/or GNU
+     Lesser General Public License along with this library; if not, write
+     to the CCP4 Secretary, Daresbury Laboratory, Warrington WA4 4AD, UK.
+     The GNU Lesser General Public can also be obtained by writing to the
+     Free Software Foundation, Inc., 59 Temple Place, Suite 330, Boston,
+     MA 02111-1307 USA
+*/
+/** @file ccp4_errno.h
+ *  Header file for error handling routines
+ *  base error codes on system errors. 
+ */
+
+#ifndef __CCP4_ERROR_GUARD
+#define __CCP4_ERROR_GUARD
+
+#include <errno.h>
+
+
+#ifndef CCP4_ERRSYSTEM
+#define CCP4_ERRSYSTEM(x) (((x)&0xfff)<<24)
+#endif
+#ifndef CCP4_ERRLEVEL
+#define CCP4_ERRLEVEL(x)  (((x)&0xf)<<16)
+#endif
+#ifndef CCP4_ERRSETLEVEL
+#define CCP4_ERRSETLEVEL(y,x) ((y) & (~CCP4_ERRLEVEL(0xf)) | CCP4_ERRLEVEL(x)))
+#endif
+#ifndef CCP4_ERRGETSYS   
+#define CCP4_ERRGETSYS(x)   (((x)>>24)&0xfff)
+#endif
+#ifndef CCP4_ERRGETLEVEL
+#define CCP4_ERRGETLEVEL(x) (((x)>>16)&0xf)
+#endif
+#ifndef CCP4_ERRGETCODE
+#define CCP4_ERRGETCODE(x)  ((x)&0xffff)
+#endif
+
+#define CCP4_ERR_SYS CCP4_ERRSYSTEM(0x0)
+#define CCP4_ERR_FILE CCP4_ERRSYSTEM(0x1)
+#define CCP4_ERR_COORD CCP4_ERRSYSTEM(0x2)
+#define CCP4_ERR_MTZ CCP4_ERRSYSTEM(0x3)
+#define CCP4_ERR_MAP CCP4_ERRSYSTEM(0x4)
+#define CCP4_ERR_UTILS CCP4_ERRSYSTEM(0x5)
+#define CCP4_ERR_PARS CCP4_ERRSYSTEM(0x6)
+#define CCP4_ERR_SYM CCP4_ERRSYSTEM(0x7)
+#define CCP4_ERR_GEN CCP4_ERRSYSTEM(0x8)
+
+#define CCP4_COUNT(x) sizeof(x)/sizeof(x[0])
+
+/** @global ccp4_errno: global variable that stores the error last error
+ *           code from the ccp4 libraries 
+ * | 12 bits - library | 4 bits - level | 16 bits - code |
+ *
+ *  associated macros
+ *    CCP4_ERR_SYS   0     OS error
+ *    CCP4_ERR_FILE  1     io library
+ *    CCP4_ERR_COORD 2     mmdb
+ *    CCP4_ERR_MTZ   3     cmtz
+ *    CCP4_ERR_MAP   4     map io
+ *    CCP4_ERR_UTILS 5     utility routines
+ *    CCP4_ERR_PARS  6     parser routines
+ *    CCP4_ERR_SYM   7     csymlib 
+ *
+ * and bit manipulation
+ *    CCP4_ERRSYSTEM   system mask for setting
+ *    CCP4_ERRLEVEL    error level mask
+ *    CCP4_ERRSETLEVEL error level mask for setting error level
+ *    CCP4_ERRGETSYS   mask for returning system
+ *    CCP4_ERRGETLEVEL mask for returning level
+ *    CCP4_ERRGETCODE  mask for returning the code
+ *
+ * error levels
+ *    0  Success
+ *    1  Informational
+ *    2  Warning 
+ *    3  Error
+ *    4  Fatal
+ */ 
+#ifdef __cplusplus
+extern "C" {
+#endif
+extern int ccp4_errno;
+#ifdef __cplusplus
+}
+#endif
+
+#ifdef __cplusplus
+namespace CCP4 {
+extern "C" {
+#endif
+
+/** Print out passed message and internal message based upon
+ *  ccp4_errno
+ *            "message : error message "
+ * @param message (const char *)
+ * @return void
+ */
+void ccp4_error( const char *);
+
+/** Obtain character string based upon error code.
+ *  Typical use ccp4_strerror(ccp4_errno)
+ *  The returned string is statically allocated in the
+ *  library_err.c file and should not be freed.
+ * @param error code (int)
+ * @return const pointer to error message (const char *) 
+ */
+const char *ccp4_strerror( int);
+
+/** Wrapper for ccp4_error which also calls exit(1)
+ * @param message (const char *)
+ * @return void
+ */
+void ccp4_fatal(const char *);
+
+/** Function to set verbosity level for messages from
+ *  ccp4_signal. Currently just off (0) and on (1).
+ *  It should be generalised to be able to switch
+ *  individual components on and off, i.e. replace 1 by
+ *  a mask.
+ *  cf. ccp4VerbosityLevel which sets the verbosity level
+ *  for ccp4printf  These are separate as they may be used
+ *  differently.
+ * @param iverb If >= 0 then set the verbosity level to the
+ *  value of iverb. If < 0 (by convention -1) then report
+ *  current level. 
+ * @return current verbosity level
+ */
+int ccp4_liberr_verbosity(int iverb);
+
+/** Routine to set ccp4_errno and print out message for
+ *  error tracing. This should be the only way in
+ *  which ccp4_errno is set.
+ *  See error codes above for levels and systems.
+ *  A callback with prototype void function(void)
+ *  may also be passed to the routine.
+ *  Note: FATAL calls exit(1). 
+ *  If ccp4_liberr_verbosity returns 0, then ccp4_signal sets
+ *  ccp4_errno and returns without doing anything else.
+ * @param error code (int)
+ * @param message (const char * const) 
+ * @param callback (point to routine void (*)(void) )
+ * @return void
+ */
+void ccp4_signal(const int, const char *const, void (*)());
+
+int cfile_perror(const char *);
+
+#ifdef __cplusplus
+}
+}
+#endif
+
+#endif  /*!CCP4_ERROR_GUARD */
diff -ruN ccp4-5.99.5-orig/lib/cctbx/cctbx_sources/ccp4io/lib/src/ccp4_file_err.h ccp4-5.99.5/lib/cctbx/cctbx_sources/ccp4io/lib/src/ccp4_file_err.h
--- ccp4-5.99.5-orig/lib/cctbx/cctbx_sources/ccp4io/lib/src/ccp4_file_err.h	1969-12-31 16:00:00.000000000 -0800
+++ ccp4-5.99.5/lib/cctbx/cctbx_sources/ccp4io/lib/src/ccp4_file_err.h	2005-11-30 17:40:04.000000000 -0800
@@ -0,0 +1,63 @@
+/*
+     ccp4_file_err.h: header file with file handling error codes
+     Copyright (C) 2001  CCLRC, Charles Ballard
+
+     This library is free software and is distributed under the terms and
+     conditions of the CCP4 licence agreement as `Part 0' (Annex 2)
+     software, which is version 2.1 of the GNU Lesser General Public
+     Licence (LGPL) with the following additional clause:
+
+        `You may also combine or link a "work that uses the Library" to
+        produce a work containing portions of the Library, and distribute
+        that work under terms of your choice, provided that you give
+        prominent notice with each copy of the work that the specified
+        version of the Library is used in it, and that you include or
+        provide public access to the complete corresponding
+        machine-readable source code for the Library including whatever
+        changes were used in the work. (i.e. If you make changes to the
+        Library you must distribute those, but you do not need to
+        distribute source or object code to those portions of the work
+        not covered by this licence.)'
+
+     Note that this clause grants an additional right and does not impose
+     any additional restriction, and so does not affect compatibility
+     with the GNU General Public Licence (GPL). If you wish to negotiate
+     other terms, please contact the maintainer.
+
+     You can redistribute it and/or modify the library under the terms of
+     the GNU Lesser General Public License as published by the Free Software
+     Foundation; either version 2.1 of the License, or (at your option) any
+     later version.
+
+     This library is distributed in the hope that it will be useful, but
+     WITHOUT ANY WARRANTY; without even the implied warranty of
+     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+     Lesser General Public License for more details.
+
+     You should have received a copy of the CCP4 licence and/or GNU
+     Lesser General Public License along with this library; if not, write
+     to the CCP4 Secretary, Daresbury Laboratory, Warrington WA4 4AD, UK.
+     The GNU Lesser General Public can also be obtained by writing to the
+     Free Software Foundation, Inc., 59 Temple Place, Suite 330, Boston,
+     MA 02111-1307 USA
+*/
+#ifndef _GUARD_FILE_ERR
+#define _GUARD_FILE_ERR
+
+#define CCP4_ERRNO(y) (CCP4_ERR_FILE | (y))
+#define CIO_Ok 0
+#define CIO_BadMode 1
+#define CIO_CantOpenFile 2
+#define CIO_MaxFile 3
+#define CIO_ReadFail 4
+#define CIO_WriteFail 5
+#define CIO_CloseFail 6
+#define CIO_SeekFail 7
+#define CIO_NullPtr 8
+#define CIO_EOF 9
+#define CIO_NoFile 10
+#define CIO_NotOpen 11
+#define CIO_UnlinkFail 12
+
+#endif
+
diff -ruN ccp4-5.99.5-orig/lib/cctbx/cctbx_sources/ccp4io/lib/src/ccp4_parser.c ccp4-5.99.5/lib/cctbx/cctbx_sources/ccp4io/lib/src/ccp4_parser.c
--- ccp4-5.99.5-orig/lib/cctbx/cctbx_sources/ccp4io/lib/src/ccp4_parser.c	1969-12-31 16:00:00.000000000 -0800
+++ ccp4-5.99.5/lib/cctbx/cctbx_sources/ccp4io/lib/src/ccp4_parser.c	2005-11-30 17:40:04.000000000 -0800
@@ -0,0 +1,1756 @@
+/*
+     ccp4_parser.c: Functions to read in and "parse" CCP4 keyworded input. 
+     Copyright (C) 2001  CCLRC, Peter Briggs
+
+     This library is free software and is distributed under the terms and
+     conditions of the CCP4 licence agreement as `Part 0' (Annex 2)
+     software, which is version 2.1 of the GNU Lesser General Public
+     Licence (LGPL) with the following additional clause:
+
+        `You may also combine or link a "work that uses the Library" to
+        produce a work containing portions of the Library, and distribute
+        that work under terms of your choice, provided that you give
+        prominent notice with each copy of the work that the specified
+        version of the Library is used in it, and that you include or
+        provide public access to the complete corresponding
+        machine-readable source code for the Library including whatever
+        changes were used in the work. (i.e. If you make changes to the
+        Library you must distribute those, but you do not need to
+        distribute source or object code to those portions of the work
+        not covered by this licence.)'
+
+     Note that this clause grants an additional right and does not impose
+     any additional restriction, and so does not affect compatibility
+     with the GNU General Public Licence (GPL). If you wish to negotiate
+     other terms, please contact the maintainer.
+
+     You can redistribute it and/or modify the library under the terms of
+     the GNU Lesser General Public License as published by the Free Software
+     Foundation; either version 2.1 of the License, or (at your option) any
+     later version.
+
+     This library is distributed in the hope that it will be useful, but
+     WITHOUT ANY WARRANTY; without even the implied warranty of
+     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+     Lesser General Public License for more details.
+
+     You should have received a copy of the CCP4 licence and/or GNU
+     Lesser General Public License along with this library; if not, write
+     to the CCP4 Secretary, Daresbury Laboratory, Warrington WA4 4AD, UK.
+     The GNU Lesser General Public can also be obtained by writing to the
+     Free Software Foundation, Inc., 59 Temple Place, Suite 330, Boston,
+     MA 02111-1307 USA
+*/
+
+
+/** @file ccp4_parser.c
+ *
+ *  @brief Functions to read in and "parse" CCP4-style keyworded input.
+ *
+ *  @author Peter Briggs
+ *  @date April 2001
+ */
+
+/*   ccp4_parser.c
+     Peter Briggs CCP4 April 2001
+
+     Functions to read in and "parse" (scan, in reality) CCP4-style
+     "keyworded" input, plus utility routines.
+
+     ccp4_parse_start(maxtokens)
+     initialise a CCP4PARSERARRAY to be used in subsequent calls to
+     ccp4_parser routines.
+
+     ccp4_parse_end(parser)
+     clean up CCP4PARSERARRAY parser after use
+
+     ccp4_parse_init_token(parser,itok)
+     initialise a single token in CCP4PARSERARRAY before use
+
+     ccp4_parse_reset(parser)
+     initialise CCP4PARSERARRAY before use (includes calls to
+     ccp4_parse_init_token to initialise all tokens)
+
+     ccp4_parse_delimiters(parser,delimiters,nulldelimiters)
+     set up or restore non-default delimiters
+
+     int ccp4_parse_comments(parser,comment_chars)
+     set up or restore non-default comment characters
+
+     ccp4_parse_maxmin(parser,max_exp,min_exp)
+     set non-default maximum and minimum values for numerical tokens
+
+     ccp4_parse(line,parser)
+     given a string "line", break up into tokens and store in
+     CCP4PARSERARRAY "parser"
+
+     ccp4_parser(line,parser,print)
+     read input from stdin or external file, break up into tokens
+     and store in CCP4PARSERARRAY "parser"
+
+     ccp4_keymatch(keyin1,keyin2)
+     compare input strings to see if they match as CCP4-style keywords
+
+     strtoupper(str1,str2)
+     convert string to uppercase
+
+     strmatch(str1,str2)
+     check if strings are identical
+
+     charmatch(character,charlist)
+     check if character appears in a list of possibilities
+
+     doublefromstr(str,....)
+     convert a string representation of a number into the number, also
+     checks for exponent over/underflow, returns numbers of digits and
+     values of "components" (integer and fractional parts, and base-10
+     exponent)
+
+*/
+
+/* Header files */
+
+#include <stdio.h>
+#include <stdlib.h>
+#include <string.h>
+#ifndef __FLOAT_H__
+#  include <float.h>
+#endif
+#include <math.h>
+#include "ccp4_parser.h"
+#include "ccp4_errno.h"
+#include "ccp4_sysdep.h"
+
+/* stuff for error reporting */
+#define CPARSER_ERRNO(n) (CCP4_ERR_PARS | (n))
+
+/* error defs */
+#define  CPARSERR_Ok                  0
+#define  CPARSERR_MaxTokExceeded      1
+#define  CPARSERR_AllocFail           2
+#define  CPARSERR_NullPointer         3
+#define  CPARSERR_LongLine            4
+#define  CPARSERR_CantOpenFile        5
+#define  CPARSERR_NoName              6
+#define  CPARSERR_ExpOverflow         7
+#define  CPARSERR_ExpUnderflow        8
+#define  CPARSERR_MatToSymop          9
+#define  CPARSERR_SymopToMat         10
+
+/*------------------------------------------------------------------*/
+
+/* Parser Functions */
+
+/*------------------------------------------------------------------*/
+
+/* ccp4_parse_start
+
+   This initialises a CCP4PARSERARRAY to be used with the ccp4_parse/
+   ccp4_parser functions.
+   The calling function must supply the maximum number of tokens.
+*/
+CCP4PARSERARRAY* ccp4_parse_start(const int maxtokens)
+{
+  int itok,diag=0;
+  CCP4PARSERARRAY *parsePtr;
+
+  if (diag) printf("CCP4_PARSE_START: ccp4_parse_start starting\n");
+
+  /* Initial check for sensible values */
+  if (maxtokens < 1) return NULL;
+
+  /* Return a pointer to a CCP4PARSERARRAY */
+  parsePtr = (CCP4PARSERARRAY *) ccp4_utils_malloc(sizeof(CCP4PARSERARRAY));
+  if (parsePtr) {
+    if (diag) printf("CCP4_PARSE_START: allocated parsePtr\n");
+    parsePtr->token = (CCP4PARSERTOKEN *) ccp4_utils_malloc(sizeof(CCP4PARSERTOKEN)*maxtokens);
+    if (!parsePtr->token) {
+      free(parsePtr);
+      parsePtr = NULL;
+    } else {
+      if (diag) printf("CCP4_PARSE_START: allocated parsePtr->token\n");
+      parsePtr->maxtokens = maxtokens;
+      parsePtr->fp = NULL;
+
+      /* Explicitly ensure that each token's fullstring member is
+	 set to NULL before calling ccp4_parse_reset (which tries to
+	 free memory associated with non-NULL fullstrings) since
+	 we can't rely on them being created with a NULL value */
+      for (itok = 0; itok < maxtokens; itok++)
+	parsePtr->token[itok].fullstring = NULL;
+      ccp4_parse_reset(parsePtr);
+      if (diag) printf("CCP4_PARSE_START: fullstring set to NULL\n");
+
+      /* Initialise the default maximum and minimum allowed
+	 exponents for numerical tokens */
+      ccp4_parse_maxmin(parsePtr,DBL_MAX_10_EXP,DBL_MIN_10_EXP);
+      if (diag) printf("CCP4_PARSE_START: max and min set\n");
+
+      /* Initialise the default delimiter and null delimiter characters
+	 with a call to ccp4_parse_delimiters */
+      parsePtr->delim=NULL;
+      parsePtr->nulldelim=NULL;
+      if (!ccp4_parse_delimiters(parsePtr,NULL,NULL)) {
+	ccp4_parse_end(parsePtr);
+	parsePtr = NULL;
+      }
+      if (diag) printf("CCP4_PARSE_START: delimiters set\n");
+
+      /* Initialise the default comment characters with a call
+	 to ccp4_parse_comments */
+      parsePtr->comment=NULL;
+      if (!ccp4_parse_comments(parsePtr,NULL)) {
+	ccp4_parse_end(parsePtr);
+	parsePtr = NULL;
+      }
+      if (diag) printf("CCP4_PARSE_START: comments set\n");
+    }
+  }
+  
+  if (diag) printf("CCP4_PARSE_START: Returning from ccp4_parse_start\n");
+  return parsePtr;
+}
+
+/*------------------------------------------------------------------*/
+
+/* ccp4_parse_end
+
+   This cleans up a CCP4PARSEARRAY after being used by ccp4_parse/
+   ccp4_parser functions.
+*/
+int ccp4_parse_end(CCP4PARSERARRAY *parsePtr)
+{
+  int i,maxtokens;
+
+  /* Anything to do? */
+  if (parsePtr) {
+    /* Free memory for each token */
+    maxtokens = parsePtr->maxtokens;
+    if (parsePtr->token && parsePtr->maxtokens > 0) {
+      for (i=0; i<maxtokens; i++)
+	if(parsePtr->token[i].fullstring) free(parsePtr->token[i].fullstring); 
+      free(parsePtr->token);
+    }
+    /* Free memory for lists of comments and delimiters */
+    if (parsePtr->comment) free(parsePtr->comment);
+    if (parsePtr->delim) free(parsePtr->delim);
+    if (parsePtr->nulldelim) free(parsePtr->nulldelim);
+    /* Free memory for rest of parserarray structure */
+    free(parsePtr);
+  }
+  /* All done */
+  return 0;
+}
+
+/*------------------------------------------------------------------*/
+
+/* ccp4_parse_init_token
+
+   Initialise a token in a parser array
+   This sets all string members of the specified token to NULL and
+   all numerical values (including flags) to zero
+*/
+
+int ccp4_parse_init_token(const CCP4PARSERARRAY *parsePtr, const int itok)
+{
+  if (parsePtr) {
+    if (itok < parsePtr->maxtokens) {
+      /* Full string is dynamically allocated - free the
+	 associated memory, if assigned */
+      if (parsePtr->token[itok].fullstring) {
+	  free(parsePtr->token[itok].fullstring);
+	  parsePtr->token[itok].fullstring = NULL;
+      }
+      /* Set fixed string tokens to empty string */
+      strcpy(parsePtr->token[itok].word,"");
+      /* Set numerical value to zero */
+      parsePtr->token[itok].value = 0.0;
+      /* Set flags to zero */
+      parsePtr->token[itok].isstring = 0;
+      parsePtr->token[itok].isnumber = 0;
+      parsePtr->token[itok].isquoted = 0;
+      parsePtr->token[itok].isnull   = 0;
+      /* Set start and end positions to zero */
+      parsePtr->token[itok].ibeg = 0;
+      parsePtr->token[itok].iend = 0;
+    }
+  }
+  return 0;
+}
+
+/*------------------------------------------------------------------*/
+
+/* ccp4_parse_reset
+
+   Reinitialise a parser array before calling ccp4_parse
+
+   An application using ccp4_parse (rather than ccp4_parser, which
+   also calls this function) can call this function to reset the
+   parser array, rather than reinitialising the structure members
+   explicitly
+*/
+int ccp4_parse_reset(CCP4PARSERARRAY *parsePtr)
+{
+  int itok;
+
+  if (parsePtr) {
+    /* Initialise the tokens to have null values */
+    for (itok=0; itok<parsePtr->maxtokens; itok++)
+      ccp4_parse_init_token(parsePtr,itok);
+    /* Initialise number of tokens to zero */
+    parsePtr->ntokens = 0;
+  }
+  return 0;
+}
+
+/*------------------------------------------------------------------*/
+
+/* ccp4_parse_delimiters
+
+   This allows the application to set its own delimiter characters
+   to be used in the ccp4_parser routines.
+
+   If a NULL pointer is supplied for either of the two lists then
+   then the default delimiters are (re)set.
+
+   Returns 1 on success, 0 if there was an error. In the event of
+   an error the delimiter lists will be unchanged.
+*/
+
+int ccp4_parse_delimiters(CCP4PARSERARRAY *parsePtr,
+			  const char *delim, const char *nulldelim)
+{
+  const char defdelim[]=" \t,=\r",defnulldelim[]=",=";
+  char *delimPtr=NULL,*nulldelimPtr=NULL;
+  int  ldelim,lnulldelim,istatus=1;
+
+  if (parsePtr) {
+
+    /* If supplied delim is NULL then set to the default */
+    if (!delim) {
+      ldelim = strlen(defdelim) + 1;
+    } else {
+      ldelim = strlen(delim) + 1;
+    }
+    delimPtr = (char *) ccp4_utils_malloc(sizeof(char)*ldelim);
+    if (delimPtr) {
+      ldelim--;
+      if (!delim) {
+	strncpy(delimPtr,defdelim,ldelim+1);
+      } else {
+	strncpy(delimPtr,delim,ldelim+1);
+      }
+      delimPtr[ldelim] = '\0';
+    }
+
+    /* If supplied nulldelim is NULL then set to the default */
+    if (!nulldelim) {
+      lnulldelim = strlen(defnulldelim) + 1;
+    } else {
+      lnulldelim = strlen(nulldelim) + 1;
+    }
+    nulldelimPtr = (char *) ccp4_utils_malloc(sizeof(char)*lnulldelim);
+    if (nulldelimPtr) {
+      lnulldelim--;
+      if (!nulldelim) {
+	strncpy(nulldelimPtr,defnulldelim,lnulldelim+1);
+      } else {
+	strncpy(nulldelimPtr,nulldelim,lnulldelim+1);
+      }
+      nulldelimPtr[lnulldelim] = '\0';
+    }
+
+    /* Assign new delimiters in parser array */
+    if (delimPtr && nulldelimPtr) {
+      if (parsePtr->delim) free(parsePtr->delim);
+      parsePtr->delim = delimPtr;
+      if (parsePtr->nulldelim) free(parsePtr->nulldelim);
+      parsePtr->nulldelim = nulldelimPtr;
+    } else {
+      /* There is an error - don't reset the parser array */
+      if (delimPtr) free(delimPtr);
+      if (nulldelimPtr) free(nulldelimPtr);
+      istatus = 0;
+    }
+  } else {
+    istatus = 0;
+  }
+  return istatus;
+}
+
+/*------------------------------------------------------------------*/
+
+/* ccp4_parse_comments
+
+   This allows the application to set its own comment characters
+   to be used in the ccp4_parser routines.
+
+   If a NULL pointer is supplied for the list of comment characters
+   then the default comment characters are (re)set.
+
+   Returns 1 on success, 0 if there was an error. In the event of
+   an error the comment lists will be unchanged.
+*/
+
+int ccp4_parse_comments(CCP4PARSERARRAY *parsePtr, const char *comment_chars)
+{
+  const char def_comment_chars[]="#!";
+  char  *commentPtr=NULL;
+  int   lcomment,istatus=1;
+
+  if (parsePtr) {
+
+    /* If the supplied comment list is NULL then set to the default */
+    if (!comment_chars) {
+      lcomment = strlen(def_comment_chars) + 1;
+    } else {
+      lcomment = strlen(comment_chars) + 1;
+    }
+    commentPtr = (char *) ccp4_utils_malloc(sizeof(char)*lcomment);
+    if (commentPtr) {
+      if (!comment_chars) {
+	strncpy(commentPtr,def_comment_chars,lcomment);
+      } else {
+	strncpy(commentPtr,comment_chars,lcomment);
+      }
+      lcomment--;
+      commentPtr[lcomment] = '\0';
+    }
+
+    /* Assign the new comments in the parser array */
+    if (commentPtr) {
+      if (parsePtr->comment) free(parsePtr->comment);
+      parsePtr->comment = commentPtr;
+    } else {
+      /* There was an error - don't reset the parser array */
+      istatus = 0;
+    }
+  } else {
+    /* The parser was unset on entry - also an error */
+    istatus = 0;
+  }
+  return istatus;
+}
+
+/*------------------------------------------------------------------*/
+
+/* ccp4_parse_maxmin
+
+   This allows the application to set its own maximum and minimum
+   exponent values, which are used as limits when evaluating the values
+   of numerical tokens in order to avoid over/underflow.
+*/
+
+int ccp4_parse_maxmin(CCP4PARSERARRAY *parsePtr, const double max_exponent,
+		      const double min_exponent)
+{
+  if (parsePtr) {
+    parsePtr->max_exponent = (double) max_exponent;
+    parsePtr->min_exponent = (double) min_exponent;
+  }
+  return 1;
+}
+
+/*------------------------------------------------------------------*/
+
+/* ccp4_parse
+
+   This is a scanner based on the old CCP4 Fortranic PARSE routine.
+ 
+   It takes an input string ("line") and returns the number of
+   tokens ("ntokens") which are delimited by certain characters
+   (defaulted to space, tab, comma, equals - these can be changed by
+   the application using a call to ccp4_parse_delimiters).
+   Information about the tokens themselves is returned as members of
+   elements in an array ("tokens") of type CCP4PARSERTOKEN (see header
+   file for definition and members).
+
+   Substrings can be delimited by single- or double-quotes but must 
+   be surrounded by delimiters to be recognised.
+
+   An unquoted comment character (defaulted to ! or #) in the input line
+   introduces a trailing comment which is ignored. The comment
+   characters can be changed using a call to ccp4_parse_comments.
+
+   Null fields are denoted by two adjacent null delimiters (defaulted
+   to comma and equals - these can be changed by the application
+   using a call to ccp4_parse_delimiters).
+
+   ccp4_parse returns the number of tokens found in the line. The
+   tokens are returned via the CCP4PARSERARRAY parser.
+
+   Arguments:
+
+   line   = pointer to a null-terminated string of characters,
+            forming the input to be processed. Unaltered on
+	    output.
+   parser = pointer to a CCP4PARSERARRAY structure which will
+            be used to hold the results of processing the input
+	    line.
+*/
+
+int ccp4_parse(const char *line, CCP4PARSERARRAY *parser)
+{
+  int quotedstring,starttoken,endtoken;
+  char this_char,next_char,matchquote;
+
+  int llen,ich,lword,diag=0;
+  int token,nulltoken,isquote,iscommt,isdelim;
+  double value;
+  char *delim,*nulldelim,*comm;
+  char quot[]="\"\'";
+  int  ibeg,iend,start;
+
+  double intvalue,frcvalue,expvalue;
+  int    intdigits,frcdigits,expdigits;
+
+  /* Local parser variables */
+  int ntok,maxtok;
+  CCP4PARSERTOKEN *tokenarray;
+
+  /* Begin */
+
+  /* Set diag = 1 and recompile to switch on diagnostic output */
+  if (diag) printf("CCP4_PARSE: ccp4_parse starting\n");
+
+  maxtok = parser->maxtokens;
+  ntok = parser->ntokens;
+  if (ntok < 0) ntok = 0;
+
+  /* Initialise pointer for local version of the token array */
+  tokenarray = parser->token;
+
+  /* Initialise pointers for lists of comments and delimiters */
+  comm = parser->comment;
+  delim = parser->delim;
+  nulldelim = parser->nulldelim;
+
+  /* Don't process any tokens already dealt with */
+  if (ntok > 0) {
+    start = tokenarray[ntok-1].iend + 1;
+    /* Special case: if the last token was quoted
+       then in fact the character at this position will be
+       a quote - if so then step on another character */
+    if (charmatch(line[start],quot)) {
+      if (diag) printf("CCP4_PARSE: start character is a quote, stepping on\n");
+      start++;
+    }
+  } else {
+    start = 0;
+  }
+
+  /* Don't process empty lines */
+  llen = strlen(line);
+  if (diag) printf("CCP4_PARSE: Line is: \"%s\"\nLength of line is %d\n",line,llen);
+  if (llen > 0) {
+
+    /* Initialise flags and counters */
+    quotedstring = 0;
+    token        = 0;
+    nulltoken    = 0;
+
+    /* Process the line two characters at a time */
+
+    if (diag) printf("CCP4_PARSE: Start position for parsing line is %d\n",start);
+    for (ich=start-1; ich<llen; ich++) {
+
+      /* Examine characters in pairs */
+
+      /* Deal with special case, start and end of line
+	 This is to avoid accessing non-existant parts of the string */
+      if (ich < start) {
+	this_char = delim[0];
+      } else {
+	this_char = line[ich];
+      }
+      if (ich == llen-1) {
+	next_char = delim[0];
+      } else {
+	next_char = line[ich+1];
+      }
+      if (diag) printf("CCP4_PARSE: %d: Current char = \"%c\" : \n",ich,this_char);
+
+      /* Set flags for this round
+	 The pairs of characters are analysed and flags set
+	 accordingly to signal actions after the analysis */
+      starttoken = 0;
+      endtoken   = 0;
+
+      if (!quotedstring) {
+	/* Not in a quoted string so look for opening quotes
+	   This is delimiter followed by quote character */
+
+	/* Is current character a delimiter character? */
+	isdelim = charmatch(this_char,delim);
+	
+	/* Is next charcter a quote character? */
+	isquote = charmatch(next_char,quot);
+
+	/* Start of quoted string? */
+	if (isdelim && isquote) {
+
+	  if (diag) printf("CCP4_PARSE: start of a quoted string\n");
+	  quotedstring = 1;
+	  starttoken = 1;
+	  matchquote = next_char;
+	  /* Advance to the next character immediately */
+	  ich++;
+
+	} else {
+	  /* Not the start of a quoted string */
+
+	  /* Is the current character the start of a comment? */
+	  iscommt = charmatch(this_char,comm);
+	  if (iscommt) {
+	    if (diag) printf("CCP4_PARSE: start of a comment\n");
+	  }
+
+	  /* Is the current character the start or end of a token? */
+	  if (!isdelim) {
+
+	    /* End of the current token?
+	       Only if we are in a token now, and the next
+	       character is a delimiter or a comment */
+	    if (token && (charmatch(next_char,delim) || charmatch(next_char,comm))) {
+	      if (diag) printf("CCP4_PARSE: end of a token\n");
+	      endtoken = 1;
+	    }
+
+	  } else {
+
+	    /* Start of a token?
+	       Only if we are not in a token now, and the next character
+	       is not a delimiter (or a comment) too */
+	    if (!token && !(charmatch(next_char,delim) || charmatch(next_char,comm))) {
+		if (diag) printf("CCP4_PARSE: start of a token\n");
+		starttoken = 1;
+	    }
+	    
+	    /* Or - could be a null token?
+	       This is a pair of null delimiters together */
+	    if (!token && charmatch(this_char,nulldelim)
+		&& charmatch(next_char,nulldelim)) {
+	      if (diag) printf("CCP4_PARSE: null token\n");
+	      starttoken = 1;
+	      nulltoken  = 1;
+	    }
+
+	  }
+	  /* End of token identification */
+	}
+	
+      } else {
+	/* Inside a quoted string so look for closing quotes
+	   This is a matching quote followed by a delimiter */
+	
+	/* Is current character a matching quote? */
+	isquote = (this_char == matchquote);
+
+	/* Is next charcter a delimiter character? */
+	isdelim = charmatch(next_char,delim);
+
+	/* End of quoted string */
+	if (isdelim && isquote) {
+	  if (diag) printf("CCP4_PARSE: end of a quoted string\n");
+	  quotedstring = 0;
+	  endtoken = 1;
+	  matchquote = ' ';
+	}
+	/* End of character analyses */
+      }
+
+      /* Start of new token */
+      if (starttoken) {
+	/* Check we don't have maximum number of tokens already */
+	if (ntok < maxtok) {
+	  /* Set flags */
+	  token = 1;
+	  if (quotedstring || !nulltoken) {
+	    ibeg = ich + 1;
+	  } else {
+	    ibeg = ich;
+	  }
+	  if (diag) printf("CCP4_PARSE: Start of a new token... ibeg = %d\n",ibeg);
+	  /* Initialise values */
+	  tokenarray[ntok].fullstring = NULL;
+	  tokenarray[ntok].value    = 0.0;
+	  tokenarray[ntok].isstring = 0;
+	  tokenarray[ntok].strlength = 0;
+	  tokenarray[ntok].isnumber = 0;
+	  tokenarray[ntok].intdigits= 0;
+	  tokenarray[ntok].frcdigits= 0;
+	  tokenarray[ntok].isquoted = 0;
+	  tokenarray[ntok].isnull   = 0;
+	  /* Flag start of quoted string */
+	  if (quotedstring) { tokenarray[ntok].isquoted = 1; }
+	  /* Flag null token */
+	  if (nulltoken) {
+	    if (diag) printf("CCP4_PARSE: Null token\n");
+	    tokenarray[ntok].isnull = 1;
+	    tokenarray[ntok].iend   = ich;
+	    token = 0;
+	    nulltoken = 0;
+	  }
+	} else {
+	  /* Maximum number of tokens already found */
+          ccp4_signal(CPARSER_ERRNO(CPARSERR_MaxTokExceeded),"ccp4_parse",NULL);
+	  parser->ntokens = ntok;
+	  return ntok;
+	}
+	if (diag) printf("CCP4_PARSE: This is the start of token %d\n",ntok);
+      }
+      /* End of new token */
+
+      /* End of current token */
+      if (endtoken) {
+	token = 0;
+	/* Exclude trailing quote from the token? */
+	if (tokenarray[ntok].isquoted) {
+	  iend = ich - 1;
+	} else {
+	  iend = ich;
+	}
+	if (diag) printf("CCP4_PARSE: End of a token... iend = %d\n",iend);
+	/* Store the full token in the array */
+	lword = iend - ibeg + 1;
+	if (diag) printf("CCP4_PARSE: lword = %d - start char = %c, end char = %c\n",
+			 lword,line[ibeg],line[iend]);
+	tokenarray[ntok].fullstring = (char *) ccp4_utils_malloc(sizeof(char)*(lword+1));
+	if (tokenarray[ntok].fullstring) {
+	  strncpy(tokenarray[ntok].fullstring,&line[ibeg],lword);
+	  tokenarray[ntok].fullstring[lword] = '\0';
+	  if (diag) printf("CCP4_PARSE: Token is \"%s\"\n",tokenarray[ntok].fullstring);
+	} else {
+          ccp4_signal(CPARSER_ERRNO(CPARSERR_AllocFail),"ccp4_parse",NULL);
+	}
+	tokenarray[ntok].ibeg = ibeg;
+	tokenarray[ntok].iend = iend;
+	/* Store the 4 character token in the array */
+	if (lword > 4) lword = 4; 
+	strncpy(tokenarray[ntok].word,&line[ibeg],lword);
+	tokenarray[ntok].word[lword] = '\0';
+	/* Determine numerical value (if any) */
+	if (doublefromstr(tokenarray[ntok].fullstring,parser->max_exponent,
+			  parser->min_exponent,&value,&intvalue,&intdigits,
+			  &frcvalue,&frcdigits,&expvalue,&expdigits)) {
+	  if (diag) printf("CCP4_PARSE: This has a numerical value of %lf\n",value);
+	  tokenarray[ntok].value     = value;
+	  tokenarray[ntok].isnumber  = 1;
+	  tokenarray[ntok].intdigits = intdigits;
+	  tokenarray[ntok].frcdigits = frcdigits;
+	} else {
+	  if (diag) printf("CCP4_PARSE: There is no numerical value for this token\n");
+	  tokenarray[ntok].isstring = 1;
+	  tokenarray[ntok].strlength   = strlen(tokenarray[ntok].fullstring);
+	}
+	/* Reset flags etc ready for next token*/
+	token  = 0;
+	value  = 0.0;
+	/* Increment number of tokens */
+	ntok++;
+	if (diag) printf("CCP4_PARSE: This is the end of a token\n");
+      }
+
+      /* Don't do any more processing after a comment */
+      if (iscommt) {
+	parser->ntokens = ntok;
+	return ntok;
+      }
+      /* Check the next pair of characters */
+    }
+    /* Reset the number of tokens in the parser array */
+    parser->ntokens = ntok;
+    if (diag) printf("CCP4_PARSE: ntokens = %d, and ntok = %d\n",parser->ntokens,ntok);
+  }
+  return ntok;
+}
+
+/*------------------------------------------------------------------*/
+
+/* ccp4_parser
+
+   This is based on the old CCP4 Fortranic PARSER routine.
+
+   The normal behaviour is to read "keyworded" data from the input
+   stream, and interpret it. Stdin is the default, but a line
+   starting with @<name> starts reading from file <name> until eof.
+
+   Each input line may be continued on the next line by the continuation
+   characters `&', `-' or `\' at the end of the input line. This
+   character is dropped from the list returned to the calling application.
+
+   Pass in a zero length line to force reading from the command line.
+   nchars is the maximum number of characters which will be read into the line.
+   (If line is not blank then it will be processed and more input
+   read in if it ends in a continuation character, or forces reading from
+   an external file.)
+
+   The "print" argument should be supplied as 0 to suppress echoing of the
+   input lines to standard output.
+
+   ccp4_parser returns the number of tokens parsed in the input line. The
+   results of the parsing are stored as members of the CCP4PARSEARRAY
+   structure "parser" and can be accessed by the application program.
+
+   The function returns the number of tokens, or 0 on reaching end of file.
+   On encountering an unrecoverable error ccp4_parser returns -1. 
+
+   Arguments:
+
+   line   = pointer to a null-terminated string of characters,
+            forming the input to be processed.
+	    On input can either be an empty string ("") or
+	    contain characters to be processed (see above for
+	    description).
+	    On output "line" will be overwritten with the actual
+	    input line, up to nchar characters.
+   nchars = maximum number of characters that can be read into
+            "line" i.e. the size of "line" in memory.
+   parser = pointer to a CCP4PARSERARRAY structure which will
+            be used to hold the results of processing the input
+	    line.
+   print  = flag controlling echoing of input lines to stdout.
+            print=0: suppress echoing of lines to stdout
+	    Otherwise echoing is turned on.
+*/
+
+int ccp4_parser(char *line, const int nchars, CCP4PARSERARRAY *parser,
+		const int print)
+{
+  int fromstdin=0,fromfile=0,fromapp=0,diag=0;
+  int nch,nold,continuation,first,trunc,llen,buflen;
+  char *linein=NULL,filename[200];
+
+  /* Local parser variables */
+  int  ntok;
+  FILE *filein;
+  CCP4PARSERTOKEN *tokenarray;
+
+  /* Undocumented feature - if print < 0 then also print out
+     diagnostic info */
+  if (print < 0) {
+    /*print = 1;*/
+    diag  = 1;
+  }
+
+  /* Begin */
+  if (diag) printf("CCP4_PARSER: ccp4_parser starting\n");
+
+  /* Abort if parser is a NULL pointer */
+  if (!parser) {
+    ccp4_signal(CPARSER_ERRNO(CPARSERR_NullPointer),"ccp4_parser",NULL);
+    return -1;
+  }
+
+  /* Abort if line is NULL pointer */
+  if (!line) {
+    ccp4_signal(CPARSER_ERRNO(CPARSERR_NullPointer),"ccp4_parser",NULL);
+    return -1;
+  }
+
+  /* Reset the parser array for this sweep
+     This will prevent phantom values from an earlier call
+     to ccp4_parser persisting in the parser array */
+  ccp4_parse_reset(parser);
+
+  /* Blank the keyword */
+  strcpy(parser->keyword,"");
+
+  /* Initialise local variables and pointers */
+  tokenarray = parser->token;
+  ntok       = parser->ntokens;
+  filein     = parser->fp;
+  if (diag) printf("CCP4_PARSER: parser->ntokens = %d, ntok = %d\n",
+		   parser->ntokens,ntok);
+
+  /* Set up an internal buffer for input
+     The buffer is over-allocated (twice as long as the max string
+     length allocated for line by the calling application)
+  */
+  buflen = (nchars*2)+1;
+  linein = (char *) ccp4_utils_malloc(buflen*sizeof(char));
+
+  if (!linein) {
+    ccp4_signal(CPARSER_ERRNO(CPARSERR_AllocFail),"ccp4_parser",NULL);
+    return 0;
+  }
+
+  /* Use nch as a count of the number of remaining characters
+     in line */
+  nch = nchars;
+
+  /* If line is empty then read from the standard input
+     Otherwise process the line from the application first */
+  if (strlen(line)==0) {
+    if (!filein) {
+      if (diag) printf("CCP4_PARSER: Reading from stdin\n");
+      fromstdin = 1;
+    } else {
+      if (diag) printf("CCP4_PARSER: Reading from file\n");
+      fromfile = 1;
+    }
+  } else {
+    if (diag) printf("CCP4_PARSER: Reading line supplied by the application program\n");
+    fromapp = 1;
+  }
+
+  /* Set flag for first line of input */
+  first = 1;
+  
+  /* Set flag for line continuation */
+  continuation = 1;
+  
+  /* Start the input loop */
+  while (continuation) {
+
+    if (diag) printf("CCP4_PARSER: starting loop\n");
+    /* Read input from stdin a line at a time */
+    if (fromstdin) {
+      if (diag) printf("CCP4_PARSER: reading from stdin...\n");
+      if (!fgets(linein,buflen,stdin)) {
+	/* Jump out at this point if eof is reached from
+	   stdin */
+	return 0;
+      }
+    } else if (fromfile) {
+      if (diag) printf("CCP4_PARSER: reading from external file...\n");
+      if (!fgets(linein,buflen,filein)) {
+	/* Return to input from stdin if eof is read from
+	   the external file */
+	if (diag) printf("CCP4_PARSER: End of external file reached\n");
+	fclose(filein);
+	filein = NULL;
+	fromfile  = 0;
+	fromstdin = 1;
+	/* Blank the line and reset the first flag to
+	   force reading from standard input immediately */
+	linein[0] = '\0';
+	ntok      = 0;
+	parser->ntokens = ntok;
+	first     = 1;
+      }
+    } else if (fromapp) {
+      if (diag) printf("CCP4_PARSER: reading from application...\n");
+      /* If this line contains a continuation mark then
+	 read from stdin next time around */
+      strncpy(linein,line,nchars);
+      linein[nchars]='\0';
+    }
+
+    /* Strip any trailing newline e.g. from fgets */
+    llen = strlen(linein);
+    if (llen > 0)
+      if (linein[llen-1] == '\n') {
+	linein[llen-1] = '\0';
+	llen--;
+      }
+    
+    /* If previous line ended with a continuation character
+       then append this one to it
+       Check that we don't overflow the number of characters
+       specified by the application */
+
+    if (llen > nch) {
+      ccp4_signal(CPARSER_ERRNO(CPARSERR_LongLine),"ccp4_parser",NULL);
+    }
+    if (first) {
+      strncpy(line,linein,nch);
+      first = 0;
+    } else {
+      strncat(line,linein,nch);
+    }
+    nch = nchars - llen;
+    if (diag) {
+      printf("CCP4_PARSER: line = \"%s\"\n",line);
+      printf("CCP4_PARSER: remaining available characters = %d\n",nch);
+    }
+      
+    /* Use ccp4_parse to break the input line up into tokens
+       Only parse the latest chunk - ccp4_parse will append
+       new tokens onto the tokenarray */
+    nold = ntok;
+    ntok = ccp4_parse(line,parser);
+
+    if (diag) printf("CCP4_PARSER: ntok = %d, nold = %d\n",ntok,nold);
+
+    /* Have we found more tokens since last time? */
+    if (ntok != nold) {
+      /* Check first token to see if it is an instruction
+	 to read from an external file */
+      if (!fromfile && tokenarray[0].word[0] == '@') {
+	if (diag) printf("CCP4_PARSER: Instruction to read from external file\n");
+	/* Get filename and attempt to open file */
+	if (tokenarray[0].fullstring) {
+	  llen = strlen(tokenarray[0].fullstring);
+	  strncpy(filename,&tokenarray[0].fullstring[1],llen);
+	  if (diag) printf("CCP4_PARSER: External file name is \"%s\"\n",filename);
+	  /* Open the external file as read-only */
+	  filein = fopen(filename,"r");
+	  if (!filein) {
+            ccp4_signal(CPARSER_ERRNO(CPARSERR_CantOpenFile),"ccp4_parser",NULL);
+	  } else {
+	    fromstdin = 0;
+	    fromfile  = 1;
+	  }
+	} else {
+	  /* Token with file name is null */
+          ccp4_signal(CPARSER_ERRNO(CPARSERR_NoName),"ccp4_parser",NULL);
+	}
+	/* Blank the line and reset the number of tokens
+	   to force reading from the external file immediately */
+	line[0] = '\0';
+	ntok    = 0;
+	parser->ntokens = ntok;
+
+      /* Check last token to see if it is continuation
+	 character */
+      } else if (ntok > 0 &&
+	  (strmatch("&",tokenarray[ntok-1].word) ||
+	   strmatch("\\",tokenarray[ntok-1].word) ||
+	   strmatch("-",tokenarray[ntok-1].word))) {
+	if (diag) printf("CCP4_PARSER: Detected continuation character\n");
+	/* It's a continuation mark 
+	   Set flag to indicate this fact in later rounds */
+	continuation = 1;
+	/* Truncate the line to remove the continuation
+	   character */
+	if (ntok > 1)
+	  trunc = tokenarray[ntok-1].ibeg;
+	else
+	  trunc = 0;
+	if (diag) printf("CCP4_PARSER: Continuation character should be at position %d\n\"%c\" is the character at this position\n",trunc,line[trunc]);
+	line[trunc] = '\0';
+	/* Lose the last token */ 
+	ntok--;
+	parser->ntokens = ntok;
+      } else {
+	/* Not a continuation character */
+	continuation = 0;
+      }
+      
+    } else {
+      /* Didn't get any more tokens from the last pass
+	 Check if it is a blank line or comment line */
+      if (ntok == 0) {
+	/* Echo comment line to stdout and blank
+	   the line */
+	if (strlen(line) > 0) {
+	  if (print) printf(" Comment line--- %s\n",line);
+	  line[0] = '\0';
+          nch = nchars;
+	}
+        if (fromapp) continuation = 0;
+      }
+    }
+    if (diag) printf("CCP4_PARSER: Continuation = %d\n",continuation);
+
+    /* If the line was supplied by the application but is now being continued
+       then make sure we read from stdin next time */
+    if (continuation && fromapp) {
+      if (diag) printf("CCP4_PARSER: switching to stdin\n");
+      fromapp   = 0;
+      fromstdin = 1;
+    }
+  }
+
+  /* Fetch and uppercase keyword */
+    if (ntok > 0) {
+      strtoupper(parser->keyword,tokenarray[0].word);
+      parser->keyword[strlen(tokenarray[0].word)] = '\0';
+      if (diag) printf("CCP4_PARSER: Keyword is %s\n",parser->keyword);
+      /*Echo the line to standard output */ 
+      if (print) printf(" Data line--- %s\n",line); 
+    } else {
+      parser->keyword[0] = '\0';
+    }
+
+  free(linein);
+  /* Update the returned variables */
+  parser->fp = filein;
+  
+  if (diag) printf("CCP4_PARSER: Returning from ccp4_parser\n");
+  return ntok;
+}
+
+/*------------------------------------------------------------------*/
+
+/* ccp4_keymatch
+
+   Returns 1 if keywords keyin1 and keyin2 are "identical", 0 otherwise.
+
+   Keywords are identical if they are the same up to the first four
+   characters, independent of case.
+*/
+int ccp4_keymatch(const char *keyin1, const char *keyin2)
+{
+  int  len1,len2;
+  char key1[5],key2[5],keyup1[5],keyup2[5];
+
+  /* Initial check */
+  if (!keyin1 || !keyin2) return 0;
+
+  /* Compare truncated lengths */
+  len1 = strlen(keyin1);
+  if (len1 > 4) len1 = 4;
+ 
+  len2 = strlen(keyin2);
+  if (len2 > 4) len2 = 4;
+
+  /* If lengths don't match then keywords can't be identical */
+  if (len1 != len2) return 0;
+
+  /* If supplied words are longer than four characters then
+     truncate them after the fourth character */
+  strncpy(key1,keyin1,len1);
+  key1[len1] = '\0';
+
+  strncpy(key2,keyin2,4);
+  key2[len2] = '\0';
+
+  /* Convert strings to uppercase */
+  strtoupper(keyup1,key1);
+  keyup1[len1] = '\0';
+  strtoupper(keyup2,key2);
+  keyup2[len2] = '\0';
+
+  /* Compare using strmatch */
+  return strmatch(keyup1,keyup2);
+}
+
+char *strtoupper (char *str1, const char *str2)
+{
+  int len2,i;
+
+  if (!str2) return NULL;
+  
+  len2 = strlen(str2);
+  if (len2 > 0) for (i=0; i<len2 ; i++) str1[i] = toupper(str2[i]);
+  str1[len2] = '\0';
+  return str1;
+}
+
+char *strtolower (char *str1, const char *str2)
+{
+  int len2,i;
+
+  if (!str2) return NULL;
+  
+  len2 = strlen(str2);
+  if (len2 > 0) for (i=0; i<len2 ; i++) str1[i] = tolower(str2[i]);
+  str1[len2] = '\0';
+  return str1;
+}
+
+/*------------------------------------------------------------------*/
+
+/* strmatch
+
+   Compare two strings.
+
+   Returns 1 if strings are identical, 0 if they differ.
+*/
+int strmatch (const char *str1, const char *str2)
+{
+  int len1,len2,i;
+
+  /* Don't process null strings */
+  if (!str1 || !str2) return 0;
+
+  len1 = strlen(str1);
+  len2 = strlen(str2);
+
+  /* Cannot be identical if lengths differ */
+  if (len1 != len2) return 0;
+
+  /* Check character by character
+     If any character differs then strings cannot be identical */
+  for (i=0; i<len1; i++)
+    if (str1[i] != str2[i]) return 0;
+
+  /* Must be a match */
+  return 1;
+}
+
+/*------------------------------------------------------------------*/
+
+/* charmatch
+
+   Returns 1 if character matches one of the characters in the string,
+   0 otherwise.
+*/
+int charmatch(const char character, const char *charlist)
+{
+  int jdo,ismatch=0;
+
+  if (charlist) {
+    jdo = 0;
+    while (jdo<strlen(charlist) && !ismatch) {
+      if (charlist[jdo] == character) ismatch = 1;
+      jdo++;
+    }
+  }
+
+  return ismatch;
+}
+
+/*------------------------------------------------------------------*/
+
+/* doublefromstr
+
+   Determine whether string represents a valid number, and return the
+   numerical value if it is.
+   The function returns 1 for a valid number, 0 otherwise.
+
+   Valid numbers are represented by:
+   ^[+-]?[0-9]*\.?[0-9]*[Ee]?[+-]?[0-9]*$
+   (I think this is the correct regular expression...? -pjx)
+
+   The component parts are: an integer part representing the value
+   of the number upto the decimal point; a decimal fraction
+   representing the value of the number upto the base-10 exponent;
+   a base-10 exponent. The full value of the string is then
+   int_part + frac_part * 10^(exp_part)
+
+   The value of each component is returned separately via the argument
+   list. The number of "digits" (= number of characters in the string)
+   of each component are also returned - note that these include non-
+   significant digits such as leading zeroes in the integer part,
+   but non-numeric characters (+-eE) are not counted.
+
+   The function can also trap for large or small exponents, to
+   avoid overflow or underflow.
+   The maximum and minimum allowed exponents are supplied by the calling
+   application as the arguments max_exp and min_exp. (Values can be
+   be taken from float.h).
+   In the event of the limits being exceeded, only the values of the
+   components are evaluated; the total value of the number is returned as
+   zero.
+*/
+int doublefromstr(const char *str, const double max_exp, const double min_exp,
+		  double *valuePtr, double *intvaluePtr, int *intdigitsPtr,
+		  double *frcvaluePtr, int *frcdigitsPtr,
+		  double *expvaluePtr, int *expdigitsPtr)
+{
+  int    lstr,ichar=0,char_value,diag=0;
+  int    sign,expsign,point,exponent,is_int,is_frc,is_exp;
+  int    n_int_digits=0,n_frc_digits=0,n_exp_digits=0;
+  char   this_char, this_str[2];
+  double int_value=0,frc_value=0,exp_value=0;
+
+  if (diag) printf("DOUBLEFROMSTR: starting\n");
+  if (diag) printf("DOUBLEFROMSTR: Biggest exponent is %lf, smallest is %lf\n",max_exp,min_exp);
+
+  /* Initialise exported variables */
+  *valuePtr = 0.0;
+  *intvaluePtr = 0.0;
+  *frcvaluePtr = 0.0;
+  *expvaluePtr = 0.0;
+  *intdigitsPtr = 0;
+  *frcdigitsPtr = 0;
+  *expdigitsPtr = 0;
+
+  /* Nothing to do for an empty string */
+  lstr = strlen(str);
+  if (!lstr) return 0;
+
+  /* Initialise internal flags and variables */
+  sign     = 1;
+  expsign  = 1;
+  point    = -1;
+  exponent = -1;
+
+  is_int   = 1;
+  is_frc   = 0;
+  is_exp   = 0;
+
+  /* Process the string character by character */
+  while (ichar < lstr) {
+    /* Get current character */
+    this_char = str[ichar];
+    if (diag) printf("DOUBLEFROMSTR: This char = %c",this_char);
+
+    /* Check: is this character a digit? */
+    if (!isdigit(this_char)) {
+
+      /* Not a digit */
+      if (diag) printf(" is not a digit...\n");
+
+      if (this_char == '+' || this_char == '-') {
+	/* Sign? i.e. + or -
+	   This can only occur in two places: immediately at the
+	   start of the putative number, or immediately at the start
+	   of the putative exponent */
+	if (ichar == 0 && this_char == '-') {
+	  sign = -1;
+	} else if (ichar == exponent + 1 && this_char == '-') {
+	  expsign = -1;
+	} else if (this_char != '+') {
+	  return 0;
+	}
+
+      } else if (this_char == '.') {
+	/* Decimal point? i.e. .
+	   There can only be one decimal point */
+	if (point > -1) return 0;
+	point = ichar;
+	is_int = 0;
+	is_frc = 1;
+
+      } else if (toupper(this_char) == 'E') {
+        char next_char = (ichar+1 < lstr ) ? str[ichar+1] : '\0';
+        if ( next_char == '+' || next_char == '-')
+           next_char = (ichar+2 < lstr ) ? str[ichar+2] : '\0';
+        /* require the next active character after E to be a digit */
+        if ( !isdigit(next_char) )  return 0;
+	/* Exponent? i.e. e or E
+	   There can only be one exponent */
+        if (exponent > -1) return 0;
+        exponent = ichar;
+        is_int = 0;
+        is_frc = 0;
+        is_exp = 1;
+      } else {
+	/* Not a permissible character
+	   This is not a number so get out now */
+	if (diag) printf("DOUBLEFROMSTR: Not a permitted character - exiting\n");
+	return 0;
+      }
+    } else {
+      /* It is a digit
+	 Build up the value of each component */
+
+      if (diag) printf(" is a digit ...\n");
+
+      this_str[0] = this_char;
+      this_str[1] = '\0';
+      char_value = atoi(this_str);
+
+      if (is_int) {
+	/* Integer part of the number */
+	n_int_digits++;
+	int_value = int_value * 10.0 + (double) char_value;
+	if (diag) printf("DOUBLEFROMSTR: Processing integer component: value = %lf, #digits = %d\n",int_value,n_int_digits);
+      } else if (is_frc) {
+	/* Decimal part of the number */
+	n_frc_digits++;
+	frc_value = frc_value + ((double) char_value)/pow(10.0,(double) n_frc_digits);
+	if (diag) printf("DOUBLEFROMSTR: Processing decimal component: value = %lf, #digits = %d\n",frc_value,n_frc_digits);
+      } else if (is_exp) {
+	/* Exponent */
+	n_exp_digits++;
+	exp_value = exp_value * 10.0 + (double) char_value;
+	if (diag) printf("DOUBLEFROMSTR: Processing exponential component: value = %lf, #digits = %d\n",exp_value,n_exp_digits);
+      }
+
+    }
+    /* Next character */
+    ichar++;
+  }
+  /*
+    Done loop over characters - if we have got this far then it
+    must be a number
+  */
+
+  /* Set component values */
+  int_value = int_value * (double) sign;
+  frc_value = frc_value * (double) sign;
+  exp_value = exp_value * (double) expsign;
+
+  /* Export component values */
+  *intvaluePtr = int_value;
+  *frcvaluePtr = frc_value;
+  *expvaluePtr = exp_value;
+
+  /* Export numbers of 'digits' */
+  *intdigitsPtr = n_int_digits;
+  *frcdigitsPtr = n_frc_digits;
+  *expdigitsPtr = n_exp_digits;
+
+  /* Is the exponent out-of-range? */
+
+  /* There are two considerations:
+     (i) can pow(10.0,exp_value) actually be evaluated?
+     (ii) can int_part * pow(10.0,exp_value) be evaluated?
+     This second is an issue for numbers with int_part > 0.
+  */
+  if ( (exp_value + (double) (n_int_digits - 1) > max_exp) && 
+        (n_int_digits || n_frc_digits) ) {
+    ccp4_signal(CPARSER_ERRNO(CPARSERR_ExpOverflow),"doublefromstr",NULL);
+    printf("DOUBLEFROMSTR: Token is \"%s\"\n",str);
+    *valuePtr = 0.0;
+  } else if ( (exp_value < min_exp) && 
+        (n_int_digits || n_frc_digits) ) {
+    ccp4_signal(CPARSER_ERRNO(CPARSERR_ExpUnderflow),"doublefromstr",NULL);
+    printf("DOUBLEFROMSTR: Token is \"%s\"\n",str);
+    *valuePtr = 0.0;
+  } else {
+    /* Evaluate the number to get a value */
+    *valuePtr = int_value + frc_value;
+    if (is_exp) *valuePtr = (*valuePtr)*pow(10.0,exp_value);
+  }
+
+  if (diag) printf("DOUBLEFROMSTR: Integer component = %lf, (%d digits)\n",
+		   *intvaluePtr,*intdigitsPtr);
+  if (diag) printf("DOUBLEFROMSTR: Decimal component = %lf, (%d digits)\n",
+		   *frcvaluePtr,*frcdigitsPtr);
+  if (diag) printf("DOUBLEFROMSTR: Exponent component = %lf, (%d digits)\n",
+		   *expvaluePtr,*expdigitsPtr);
+  if (diag) printf("DOUBLEFROMSTR: Finished - value is determined to be %lf\n",*valuePtr);
+
+  return 1;
+}
+
+ccp4_symop symop_to_rotandtrn(const char *symchs_begin, const char *symchs_end) {
+
+  float rsm[4][4];
+
+  symop_to_mat4(symchs_begin, symchs_end, rsm[0]);
+  return (mat4_to_rotandtrn((const float (*)[4])rsm));
+
+}
+
+/*------------------------------------------------------------------*/
+
+/* symop_to_mat4
+
+   Translates a single symmetry operator string into a 4x4 quine
+   matrix representation
+   NB Uses a utility function (symop_to_mat4_err) when reporting
+   failures.
+
+   Syntax of possible symop strings:
+
+   real space symmetry operations, e.g. X+1/2,Y-X,Z
+   reciprocal space operations,    e.g. h,l-h,-k
+   reciprocal axis vectors,        e.g. a*+c*,c*,-b*
+   real space axis vectors,        e.g. a,c-a,-b
+
+   The strings can contain spaces, and the coordinate and translation
+   parts may be in either order.
+
+   The function returns 1 on success, 0 if there was a failure to
+   generate a matrix representation.
+*/
+const char *symop_to_mat4(const char *symchs_begin, const char *symchs_end, float *rot)
+{
+  int no_real =0, no_recip = 0, no_axis = 0;          /* counters */
+  int col = 3, nops = 0;
+  int nsym = 0, init_array = 1;
+  float sign = 1.0f, value = 0.0f, value2;
+  char *cp, ch;
+  const char *ptr_symchs = symchs_begin;
+  int j,k;                                 /* loop variables */
+  int Isep = 0;                             /* parsed seperator? */
+
+  while (ptr_symchs < symchs_end) {
+    ch = *ptr_symchs;
+
+    /* Parse symop */
+    if (isspace(ch)) {
+      /* Have to allow symop strings to contain spaces for
+	 compatibility with older MTZ files
+	 Ignore and step on to next character */
+      ++ptr_symchs;
+      continue;
+    } else if (ch == ',' || ch == '*') {           
+      ++ptr_symchs;
+      if (value == 0.0f && col == 3) {
+        /* nothing set, this is a problem */
+        ccp4_signal(CPARSER_ERRNO(CPARSERR_SymopToMat),"symop_to_mat4",NULL);
+        return NULL ;
+      } else {
+        Isep = 1;     /* drop through to evaluation*/
+      }
+    } else if (ch == 'X' || ch == 'x') {
+      no_real++, col = 0;
+      if (value == 0.0f) value = sign * 1.0f;
+      ++ptr_symchs;
+      continue;
+    } else if (ch == 'Y' || ch == 'y') {
+      no_real++, col = 1;
+      if (value == 0.0f) value = sign * 1.0f;
+      ++ptr_symchs;
+      continue;
+    } else if (ch == 'Z' || ch == 'z') {
+      no_real++, col = 2;
+      if (value == 0.0f) value = sign * 1.0f;
+      ++ptr_symchs;
+      continue;
+    } else if (ch == 'H' || ch == 'h') {
+      no_recip++, col = 0;
+      if (value == 0.0f) value = sign * 1.0f;
+      ++ptr_symchs;
+      continue;
+    } else if (ch == 'K' || ch == 'k') {
+      no_recip++, col = 1;
+      if (value == 0.0f) value = sign * 1.0f;
+      ++ptr_symchs;
+      continue;
+    } else if (ch == 'L' || ch == 'l') {
+      no_recip++, col = 2;
+      if (value == 0.0f) value = sign * 1.0f;
+      ++ptr_symchs;
+      continue;
+    } else if (ch == 'A' || ch == 'a') {
+      no_axis++, col = 0;
+      if (value == 0.0f) value = sign * 1.0f;
+      if (*++ptr_symchs == '*' && ( no_axis != 3 || no_recip )) ++ptr_symchs;
+      continue;
+    } else if (ch == 'B' || ch == 'b') {
+      no_axis++, col = 1;
+      if (value == 0.0f) value = sign * 1.0f;
+      if (*++ptr_symchs == '*' && ( no_axis != 3 || no_recip )) ++ptr_symchs;
+      continue;
+    } else if (ch == 'C' || ch == 'c') {
+      no_axis++, col = 2;
+      if (value == 0.0f) value = sign * 1.0f;
+      if (*++ptr_symchs == '*' && ( no_axis != 3 || no_recip )) ++ptr_symchs;
+      continue;
+    } else if (ch == '+' || ch == '-') {
+      sign = ((ch == '+')? 1.0f : -1.0f) ;
+      ++ptr_symchs;
+      if ( value == 0.0f && col == 3) 
+	continue;
+      /* drop through to evaluation */
+    } else if ( ch == '/') {
+      ++ptr_symchs;
+      if (value == 0.0f) {
+	/* error */
+	symop_to_mat4_err(symchs_begin);
+	return NULL;
+      }
+      value2 = strtod(ptr_symchs, &cp);
+      if (!value2) {
+	/* error */
+	symop_to_mat4_err(symchs_begin);
+	return NULL;
+      }
+      /* Nb don't apply the sign to value here
+	 It will already have been applied in the previous round */
+      value = (float) value/value2;
+      ptr_symchs = cp;
+      continue;
+    } else if ( isdigit(ch) || ch == '.') {
+      value = sign*strtod(ptr_symchs, &cp);
+      ptr_symchs = cp;
+      continue;
+    } else {
+      ++ptr_symchs;
+      continue;
+    }
+   
+  /* initialise and clear the relevant array  (init_array == 1)*/
+  /* use knowledge that we are using a [4][4] for rot */
+  if (init_array) {
+    init_array = 0;       
+    for (j = 0 ; j !=4 ; ++j)
+      for (k = 0; k !=4 ; ++k)
+        rot[(((nsym << 2) + k ) << 2) +j] = 0.0f;
+     rot[(((nsym << 2 ) + 3 )  << 2) +3] = 1.0f;
+  }
+ 
+    /* value to be entered in rot */
+    rot[(((nsym << 2) + nops) << 2) + col] = value;
+
+    /* have we passed a operator seperator */
+    if (Isep) {
+      Isep = 0;
+      ++nops;
+      sign = 1.0f;
+      if (nops == 3 ) { ++nsym; nops=0 ; init_array = 1; }
+    }
+
+    /* reset for next cycle */
+    col = 3;
+    value = 0.0f;
+    no_recip = 0, no_axis = 0, no_real = 0;
+  }
+
+  /* Tidy up last value */
+  if (value) rot[(((nsym << 2) + nops) << 2) + col] = value;
+
+  if (nops<2) {
+    /* Processed fewer than 3 operators, raise an error */
+    symop_to_mat4_err(symchs_begin);
+    return NULL;
+  }
+
+  /* Return with success */
+  return ptr_symchs;
+}
+
+/* Internal function: report error from symop_to_mat4_err */
+int symop_to_mat4_err(const char *symop)
+{
+  printf("\n **SYMMETRY OPERATOR ERROR**\n\n Error in interpreting symop \"%s\"\n\n",
+	 symop);
+  ccp4_signal(CPARSER_ERRNO(CPARSERR_SymopToMat),"symop_to_mat4",NULL);
+  return 1;
+}
+
+ccp4_symop mat4_to_rotandtrn(const float rsm[4][4]) {
+
+  int i,j;
+  ccp4_symop symop;
+
+  for (i = 0; i < 3; ++i) {
+    for (j = 0; j < 3; ++j) 
+      symop.rot[i][j]=rsm[i][j];
+    symop.trn[i]=rsm[i][3];
+  }
+
+  return (symop);
+}
+
+char *rotandtrn_to_symop(char *symchs_begin, char *symchs_end, const ccp4_symop symop)
+{
+  float rsm[4][4];
+
+  rotandtrn_to_mat4(rsm,symop);
+  return(mat4_to_symop(symchs_begin,symchs_end,(const float (*)[4])rsm));
+}
+
+void rotandtrn_to_mat4(float rsm[4][4], const ccp4_symop symop) {
+
+  int i,j;
+
+  for (i = 0; i < 3; ++i) {
+    for (j = 0; j < 3; ++j) 
+      rsm[i][j]=symop.rot[i][j];
+    rsm[i][3]=symop.trn[i];
+    rsm[3][i]=0.0;
+  }
+  rsm[3][3]=1.0;
+}
+
+char *mat4_to_symop(char *symchs_begin, char *symchs_end, const float rsm[4][4])
+{
+  static char axiscr[] = {'X','Y','Z'};
+  static char numb[] = {'0','1','2','3','4','5','6','7','8','9'};
+  static int npntr1[12] = { 0,1,1,1,0,1,0,2,3,5,0,0 };
+  static int npntr2[12] = { 0,6,4,3,0,2,0,3,4,6,0,0 };
+
+  int jdo10, jdo20, irsm, itr, ist;
+  register char *ich;
+  int debug=0;
+
+  if (debug)
+    for (jdo20 = 0; jdo20 != 4; ++jdo20) 
+      printf("Input matrix: %f %f %f %f \n",rsm[jdo20][0],rsm[jdo20][1],
+          rsm[jdo20][2],rsm[jdo20][3]);
+
+  /* blank output string */
+  for (ich = symchs_begin; ich < symchs_end; ++ich) 
+    *ich = ' ';
+  ich = symchs_begin;
+
+  for (jdo20 = 0; jdo20 != 3; ++jdo20) {
+    *ich = '0';
+    ist = 0;    /* ---- Ist is flag for first character of operator */
+    for (jdo10 = 0; jdo10 != 4; ++jdo10) {
+      
+      if (rsm[jdo20][jdo10] != 0.f) {
+	irsm = (int) rint(fabs(rsm[jdo20][jdo10]));
+	
+	if ( rsm[jdo20][jdo10] > 0. && ist) {
+	  if (ich >= symchs_end) {
+	    ccp4_signal(CCP4_ERRLEVEL(3) | CPARSER_ERRNO(CPARSERR_MatToSymop), 
+			"mat4_to_symop 1", NULL);
+	    return NULL; }
+	  *ich++ = '+';
+	} else if ( rsm[jdo20][jdo10] < 0.f ) {
+	  if (ich >= symchs_end) {
+	    ccp4_signal(CCP4_ERRLEVEL(3) | CPARSER_ERRNO(CPARSERR_MatToSymop), 
+			"mat4_to_symop 2", NULL);
+	    return NULL; }
+	  if (jdo10 != 3) {
+	    *ich++ = '-';
+	  } else {
+	    /* translation part is forced to be positive, see below */
+	    *ich++ = '+';
+	  }
+          ist = 1;
+	}
+      
+	if (jdo10 != 3) {
+	  /* rotation part */
+	  if (ich+1 >= symchs_end) {
+	    ccp4_signal(CCP4_ERRLEVEL(3) | CPARSER_ERRNO(CPARSERR_MatToSymop), 
+		      "mat4_to_symop 3", NULL);
+	    return NULL; }
+	  if (irsm != 1) {
+	    *ich++ = numb[irsm];
+	    *ich++ = axiscr[jdo10];
+	  } else {
+	    *ich++ = axiscr[jdo10];
+	  }
+	  ist = 1;
+        } else {
+	  /* translation part */
+	  itr = (int) rint(rsm[jdo20][3]*12.0);
+          while (itr < 0) itr += 12;
+          itr = (itr - 1) % 12;
+          if (npntr1[itr] > 0) {
+	   if (ich+2 >= symchs_end) {
+	    ccp4_signal(CCP4_ERRLEVEL(3) | CPARSER_ERRNO(CPARSERR_MatToSymop), 
+		      "mat4_to_symop 4", NULL);
+	    return NULL; }
+	   *ich++ = numb[npntr1[itr]];
+	   *ich++ = '/';
+           *ich++ = numb[npntr2[itr]];
+	  } else {
+           *--ich = ' ';
+	  }
+	}
+      }
+    }
+    if (jdo20 != 2) {
+      if (*ich == '0')
+        ++ich;
+      if (ich+2 >= symchs_end) {
+        ccp4_signal(CCP4_ERRLEVEL(3) | CPARSER_ERRNO(CPARSERR_MatToSymop), 
+                     "mat4_to_symop 5", NULL);
+        return NULL; }
+      *ich++ = ',';
+      *ich++ = ' ';
+      *ich++ = ' ';
+    }
+  }
+  return symchs_begin;
+}
+
+char *mat4_to_recip_symop(char *symchs_begin, char *symchs_end, const float rsm[4][4])
+{
+  char *symop;
+  size_t lsymop;
+  register char *ich, *ich_out;
+
+  lsymop = symchs_end-symchs_begin;
+  symop = (char *) ccp4_utils_malloc(lsymop*sizeof(char));
+
+  mat4_to_symop(symop, symop+lsymop, rsm);
+  ich_out = symchs_begin;
+  for (ich = symop; ich < symop+lsymop; ++ich) {
+    if (*ich == 'X') {
+      if (ich_out == symchs_begin || (ich_out > symchs_begin && 
+          *(ich_out-1) != '-' && *(ich_out-1) != '+')) *ich_out++ = '+';
+      *ich_out++ = 'h';
+    } else if (*ich == 'Y') {
+      if (ich_out == symchs_begin || (ich_out > symchs_begin && 
+          *(ich_out-1) != '-' && *(ich_out-1) != '+')) *ich_out++ = '+';
+      *ich_out++ = 'k';
+    } else if (*ich == 'Z') {
+      if (ich_out == symchs_begin || (ich_out > symchs_begin && 
+          *(ich_out-1) != '-' && *(ich_out-1) != '+')) *ich_out++ = '+';
+      *ich_out++ = 'l';
+    } else if (*ich == ' ') {
+      /* skip */
+    } else {
+      *ich_out++ = *ich;
+    }
+  }
+  while (ich_out < symchs_end) *ich_out++ = ' ';
+
+  free (symop);
+  return symchs_begin;
+}
diff -ruN ccp4-5.99.5-orig/lib/cctbx/cctbx_sources/ccp4io/lib/src/ccp4_parser.h ccp4-5.99.5/lib/cctbx/cctbx_sources/ccp4io/lib/src/ccp4_parser.h
--- ccp4-5.99.5-orig/lib/cctbx/cctbx_sources/ccp4io/lib/src/ccp4_parser.h	1969-12-31 16:00:00.000000000 -0800
+++ ccp4-5.99.5/lib/cctbx/cctbx_sources/ccp4io/lib/src/ccp4_parser.h	2005-11-30 17:40:04.000000000 -0800
@@ -0,0 +1,341 @@
+/*
+     ccp4_parser.h: Headers for functions to read in and "parse" CCP4 keyworded input.
+     Copyright (C) 2001  CCLRC, Peter Briggs
+
+     This library is free software and is distributed under the terms and
+     conditions of the CCP4 licence agreement as `Part 0' (Annex 2)
+     software, which is version 2.1 of the GNU Lesser General Public
+     Licence (LGPL) with the following additional clause:
+
+        `You may also combine or link a "work that uses the Library" to
+        produce a work containing portions of the Library, and distribute
+        that work under terms of your choice, provided that you give
+        prominent notice with each copy of the work that the specified
+        version of the Library is used in it, and that you include or
+        provide public access to the complete corresponding
+        machine-readable source code for the Library including whatever
+        changes were used in the work. (i.e. If you make changes to the
+        Library you must distribute those, but you do not need to
+        distribute source or object code to those portions of the work
+        not covered by this licence.)'
+
+     Note that this clause grants an additional right and does not impose
+     any additional restriction, and so does not affect compatibility
+     with the GNU General Public Licence (GPL). If you wish to negotiate
+     other terms, please contact the maintainer.
+
+     You can redistribute it and/or modify the library under the terms of
+     the GNU Lesser General Public License as published by the Free Software
+     Foundation; either version 2.1 of the License, or (at your option) any
+     later version.
+
+     This library is distributed in the hope that it will be useful, but
+     WITHOUT ANY WARRANTY; without even the implied warranty of
+     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+     Lesser General Public License for more details.
+
+     You should have received a copy of the CCP4 licence and/or GNU
+     Lesser General Public License along with this library; if not, write
+     to the CCP4 Secretary, Daresbury Laboratory, Warrington WA4 4AD, UK.
+     The GNU Lesser General Public can also be obtained by writing to the
+     Free Software Foundation, Inc., 59 Temple Place, Suite 330, Boston,
+     MA 02111-1307 USA
+*/
+
+/** @page cparser_page CParser library
+ *
+ * @verbatim
+
+<!-- ::INDEX_INFO::CParser library::Library::::C Software Library for CCP4-style parsing:::::::: -->
+
+   @endverbatim
+ *
+ *  @section cparser_file_list File list
+
+<ul>
+<li>ccp4_parser.h - contains details of the C/C++ API
+</ul>
+
+ *  @section cparser_overview Overview
+ 
+These functions do CCP4-style parsing, as used for processing keywords
+of CCP4 programs, MTZ header records, etc.
+
+ *  @section cparser_usage Usage
+
+The following code snippets illustrate how the functions might be used
+to read from stdin:
+<pre>
+
+int           ntok=0;
+char          line[201],*key;
+CCP4PARSERTOKEN * token=NULL;
+CCP4PARSERARRAY * parser;
+
+  parser = (CCP4PARSERARRAY *) ccp4_parse_start(20);
+  key   = parser->keyword;
+  token = parser->token;
+
+  RC   = 0;
+  while (!RC) {
+
+    line[0] = '\0';
+    ntok = ccp4_parser(line,200,parser,1);
+
+    if (ntok < 1) {
+
+      RC = 111;
+
+    } else {      
+
+      if (ccp4_keymatch("MINDIST",key))  {
+	if (ntok != 2) {
+	  ccperror ( 1,"MINDIST requires a single numerical argument" );
+	  RC = -100;
+	} else {
+	  minDist = token[1].value;
+        }
+      }	else  {
+	printf ( "Unrecognised keyword \"%s\"\n",token[0].fullstring );
+	RC = -118;
+      }
+    }
+  }
+
+  ccp4_parse_end ( parser );
+
+</pre>
+
+ *  @section cparser_examples Examples
+
+See the distributed programs <a href="../ncont.html">NCONT</a> and
+<a href="../pdbcur.html">PDBCUR</a>.
+
+ */
+
+/** @file ccp4_parser.h
+ *
+ *  @brief Functions to read in and "parse" CCP4-style keyworded input.
+ *
+ *  @author Peter Briggs
+ *  @date April 2001
+ */
+
+/*------------------------------------------------------------------*/
+
+/* Macro definitions */
+
+/*------------------------------------------------------------------*/
+
+#ifndef __CCP4_Parser__
+#define __CCP4_Parser__
+
+
+/* note order: these must be outside CCP4 namespace */
+#include <stdio.h>
+#include"ccp4_utils.h"
+#include"ccp4_spg.h"
+
+/* Macro to make C functions callable from C++ */
+#ifdef  __cplusplus
+namespace CCP4 {
+extern "C" {
+typedef CSym::ccp4_symop ccp4_symop;
+#endif
+
+/*------------------------------------------------------------------*/
+
+/* Parser String Sizes */
+
+/*------------------------------------------------------------------*/
+
+#define CCP4_PARSER_MAXLINELENGTH     200
+#define CCP4_PARSER_MAXFILENAMELENGTH 200
+
+/*------------------------------------------------------------------*/
+
+/* Structures and typedefs */
+
+/*------------------------------------------------------------------*/
+
+/* CCP4 Parser token
+   Construct to hold the information about a single token */
+
+typedef struct {
+  char   *fullstring;   /* Full string containing all of token */
+  char   word[5];       /* First four characters of token */
+  double value;         /* Equivalent numerical value */
+  int    isstring;      /* Flag: true if token is character string */
+  int    strlength;     /* Number of characters in whole token (strings only) */
+  int    isnumber;      /* Flag: true if token is number */
+  int    intdigits;     /* Number of 'digits' preceeding the decimal point
+			   (numbers only) */
+  int    frcdigits;     /* Number of 'digits' after the decimal point (numbers
+			   only) */
+  int    isquoted;      /* Flag: true if token is contained in quotes */
+  int    isnull;        /* Flag: true if token is null field */
+  int    ibeg,iend;     /* Begin and end character positions of token
+			   in input line */
+} CCP4PARSERTOKEN;
+
+/* CCP4 Parser array
+   Construct to hold the information about a parsed line */
+
+typedef struct {
+  /* "Public" members */
+  char   keyword[5];      /* Keyword (=token[1].token, uppercased) */
+  int    ntokens;         /* Number of tokens */
+  CCP4PARSERTOKEN *token; /* Array of tokens */
+  /* "Private" members */
+  FILE   *fp;             /* Pointer to an external command file */
+  int    maxtokens;       /* Maximum number of tokens allowed */
+  char   *delim;          /* List of delimiter characters */
+  char   *nulldelim;      /* List of null delimiter characters */
+  char   *comment;        /* List of comment characters */
+  double max_exponent;    /* Largest allowed exponent for numerical tokens */
+  double min_exponent;    /* Smallest allowed exponent for numerical tokens */
+} CCP4PARSERARRAY;     
+
+/*------------------------------------------------------------------*/
+
+/* Function Prototypes */
+
+/*------------------------------------------------------------------*/
+
+/* Core cparser functions */
+
+/** Initialise a CCP4PARSERARRAY to be used in subsequent calls to
+ *  ccp4_parser routines. The calling function must supply the maximum 
+ *  number of tokens on a line (including continuation lines).
+ * @param maxtokens maximum number of tokens on a line
+ * @return pointer to a new CCP4PARSERARRAY structure
+ */
+CCP4PARSERARRAY* ccp4_parse_start(const int maxtokens);
+
+/** Cleans up a CCP4PARSEARRAY after being used by ccp4_parse/
+   ccp4_parser functions.
+ * @param parsePtr pointer to a CCP4PARSERARRAY structure
+ * @return 0 on completion
+ */
+int ccp4_parse_end(CCP4PARSERARRAY *parsePtr);
+
+int ccp4_parse_init_token(const CCP4PARSERARRAY *parsePtr, const int itok);
+
+int ccp4_parse_delimiters(CCP4PARSERARRAY *parsePtr, const char *delim,
+				  const char *nulldelim);
+
+int ccp4_parse_comments(CCP4PARSERARRAY *parsePtr, const char *comment_chars);
+
+int ccp4_parse_maxmin(CCP4PARSERARRAY *parsePtr, const double max_exponent,
+			      const double min_exponent);
+
+int ccp4_parse_reset(CCP4PARSERARRAY *parsePtr);
+
+int ccp4_parse(const char *line, CCP4PARSERARRAY *parser);
+
+/** The main function for parsing lines, either supplied or read
+ * from stdin.
+ * @param line pointer to a null-terminated string of characters,
+ * forming the input to be processed. On input can either be an empty 
+ * string ("") which forces reading from stdin, or contain characters 
+ * to be processed. On output "line" will be overwritten with the actual
+ * input line.
+ * @param n maximum number of characters that can be read into
+ * "line" i.e. the size of "line" in memory.
+ * @param parser pointer to a CCP4PARSERARRAY structure which will
+ * be used to hold the results of processing the input line.
+ * @param print flag controlling echoing of input lines to stdout.
+ * print=0: suppress echoing of lines to stdout. Otherwise echoing is 
+ * turned on.
+ * @return Number of tokens found.
+ */
+int ccp4_parser(char *line, const int n, CCP4PARSERARRAY *parser,
+			const int print);
+
+/* External utility functions */
+
+/** Test whether two keywords are identical. Keywords are identical if 
+ * they are the same up to the first four characters, independent of case.
+ * @param keyin1 keyword 1.
+ * @param keyin2 keyword 2.
+ * @return 1 if keywords keyin1 and keyin2 are "identical", 0 otherwise.
+ */
+int ccp4_keymatch(const char *keyin1, const char *keyin2);
+
+/* Internal utility functions */
+
+/** Convert string to uppercase.
+ * @param str1 On exit str1 will contain uppercased copy of str2
+ * @param str2 Input string
+ * @return str1
+ */
+char *strtoupper (char *str1, const char *str2);
+
+/** Convert string to lowercase.
+ * @param str1 On exit str1 will contain lowercased copy of str2
+ * @param str2 Input string
+ * @return str1
+ */
+char *strtolower (char *str1, const char *str2);
+
+int strmatch (const char *str1, const char *str2);
+
+int charmatch(const char character, const char *charlist);
+
+int doublefromstr(const char *str, const double max_exp, const double min_exp,
+			  double *valuePtr, double *intvaluePtr, int *intdigitsPtr,
+			  double *frcvaluePtr, int *frcdigitsPtr,
+			  double *expvaluePtr, int *expdigitsPtr);
+
+/** Convert symmetry operator as string to ccp4_symop struct.
+ * @param symchs_begin pointer to beginning of string
+ * @param symchs_end pointer to end of string (i.e. last character
+ *   is *(symchs_end-1) )
+ * @return pointer to ccp4_symop struct
+ */
+ccp4_symop symop_to_rotandtrn(const char *symchs_begin, const char *symchs_end);
+
+/** Convert symmetry operator as string to matrix.
+ * This is Charles' version of symfr. Note that translations
+ * are held in elements [*][3] and [3][3] is set to 1.0
+ * @param symchs_begin pointer to beginning of string
+ * @param symchs_end pointer to end of string (i.e. last character
+ *   is *(symchs_end-1) )
+ * @param rot 4 x 4 matrix operator
+ * @return  NULL on error, final position pointer on success
+ */
+const char * symop_to_mat4(const char *symchs_begin, const char *symchs_end, float *rot);
+int symop_to_mat4_err(const char *symop);
+ccp4_symop mat4_to_rotandtrn(const float rsm[4][4]);
+/* This is Charles' version of symtr */
+char *rotandtrn_to_symop(char *symchs_begin, char *symchs_end, const ccp4_symop symop);
+void rotandtrn_to_mat4(float rsm[4][4], const ccp4_symop symop);
+
+/** Convert symmetry operator as matrix to string.
+ * This is Charles' version of symtr. Note that translations
+ * are held in elements [*][3] and [3][3] is set to 1.0
+ * @param symchs_begin pointer to beginning of string
+ * @param symchs_end pointer to end of string (i.e. last character
+ *   is *(symchs_end-1) )
+ * @param rsm 4 x 4 matrix operator
+ * @return pointer to beginning of string
+ */
+char *mat4_to_symop(char *symchs_begin, char *symchs_end, const float rsm[4][4]);
+
+/** Convert symmetry operator as matrix to string in reciprocal space notation.
+ * This is Charles' version of symtr. Note that translations
+ * are held in elements [*][3] and [3][3] is set to 1.0
+ * @param symchs_begin pointer to beginning of string
+ * @param symchs_end pointer to end of string (i.e. last character
+ *   is *(symchs_end-1) )
+ * @param rsm 4 x 4 matrix operator
+ * @return pointer to beginning of string
+ */
+char *mat4_to_recip_symop(char *symchs_begin, char *symchs_end, const float rsm[4][4]);
+
+#ifdef __cplusplus
+}
+}
+#endif
+
+#endif  /* __CCP4_Parser__ */
diff -ruN ccp4-5.99.5-orig/lib/cctbx/cctbx_sources/ccp4io/lib/src/ccp4_spg.h ccp4-5.99.5/lib/cctbx/cctbx_sources/ccp4io/lib/src/ccp4_spg.h
--- ccp4-5.99.5-orig/lib/cctbx/cctbx_sources/ccp4io/lib/src/ccp4_spg.h	1969-12-31 16:00:00.000000000 -0800
+++ ccp4-5.99.5/lib/cctbx/cctbx_sources/ccp4io/lib/src/ccp4_spg.h	2005-11-30 17:40:04.000000000 -0800
@@ -0,0 +1,116 @@
+/*
+     ccp4_spg.h: Data structure for symmetry information
+     Copyright (C) 2001  CCLRC, Martyn Winn
+
+     This library is free software and is distributed under the terms and
+     conditions of the CCP4 licence agreement as `Part 0' (Annex 2)
+     software, which is version 2.1 of the GNU Lesser General Public
+     Licence (LGPL) with the following additional clause:
+
+        `You may also combine or link a "work that uses the Library" to
+        produce a work containing portions of the Library, and distribute
+        that work under terms of your choice, provided that you give
+        prominent notice with each copy of the work that the specified
+        version of the Library is used in it, and that you include or
+        provide public access to the complete corresponding
+        machine-readable source code for the Library including whatever
+        changes were used in the work. (i.e. If you make changes to the
+        Library you must distribute those, but you do not need to
+        distribute source or object code to those portions of the work
+        not covered by this licence.)'
+
+     Note that this clause grants an additional right and does not impose
+     any additional restriction, and so does not affect compatibility
+     with the GNU General Public Licence (GPL). If you wish to negotiate
+     other terms, please contact the maintainer.
+
+     You can redistribute it and/or modify the library under the terms of
+     the GNU Lesser General Public License as published by the Free Software
+     Foundation; either version 2.1 of the License, or (at your option) any
+     later version.
+
+     This library is distributed in the hope that it will be useful, but
+     WITHOUT ANY WARRANTY; without even the implied warranty of
+     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+     Lesser General Public License for more details.
+
+     You should have received a copy of the CCP4 licence and/or GNU
+     Lesser General Public License along with this library; if not, write
+     to the CCP4 Secretary, Daresbury Laboratory, Warrington WA4 4AD, UK.
+     The GNU Lesser General Public can also be obtained by writing to the
+     Free Software Foundation, Inc., 59 Temple Place, Suite 330, Boston,
+     MA 02111-1307 USA
+*/
+
+/** @file ccp4_spg.h
+ *
+ *  @brief Data structure for symmetry information.
+ *
+ *  A data structure for spacegroup information and related
+ *  quantities. Some items are loaded from syminfo.lib while
+ *  others are calculated on the fly.
+ *
+ *  @author Martyn Winn 
+ */
+
+#ifndef __CCP4_SPG__
+#define __CCP4_SPG__
+
+#ifdef  __cplusplus
+namespace CSym {
+extern "C" {
+#endif
+
+/* Kevin's symmetry operator */
+
+typedef struct ccp4_symop_
+{
+  float rot[3][3];
+  float trn[3];
+} ccp4_symop;
+
+typedef struct ccp4_spacegroup_
+{
+  int spg_num;            /* true spacegroup number */
+  int spg_ccp4_num;       /* CCP4 spacegroup number */
+  char symbol_Hall[40];   /* Hall symbol */
+  char symbol_xHM[20];    /* Extended Hermann Mauguin symbol  */
+  char symbol_old[20];    /* old spacegroup name */
+
+  char point_group[20];   /* point group name */
+  char crystal[20];       /* crystal system */
+
+  int nlaue;              /* CCP4 Laue class number, inferred from asu_descr */
+  char laue_name[20];     /* Laue class name */
+  int laue_sampling[3];   /* sampling factors for FFT */
+
+  int npatt;              /* Patterson spacegroup number, inferred from asu_descr */
+  char patt_name[40];     /* Patterson spacegroup name */
+
+  int nsymop;             /* total number of symmetry operations */
+  int nsymop_prim;        /* number of primitive symmetry operations */
+  ccp4_symop *symop;      /* symmetry matrices */
+  ccp4_symop *invsymop;   /* inverse symmetry matrices */
+
+  float chb[3][3];        /* change of basis matrix from file */
+
+  char asu_descr[80];     /* asu description from file */
+  int (*asufn)(const int, const int, const int); /* pointer to ASU function */
+
+  int centrics[12];       /* symop which generates centric zone, 0 if none */
+  int epsilon[13];        /* flag which epsilon zones are applicable */
+
+  char mapasu_zero_descr[80];  /* origin-based map asu: description from file */
+  float mapasu_zero[3];   /* origin-based map asu: upper limits */
+
+  char mapasu_ccp4_descr[80];  /* CCP4 map asu: defaults to mapasu_zero */
+  float mapasu_ccp4[3];   /* CCP4 map asu: upper limits */
+
+} CCP4SPG;
+
+#ifdef __cplusplus
+} }
+#endif
+
+#endif  /*!__CCP4_SPG__ */
+
diff -ruN ccp4-5.99.5-orig/lib/cctbx/cctbx_sources/ccp4io/lib/src/ccp4_sysdep.h ccp4-5.99.5/lib/cctbx/cctbx_sources/ccp4io/lib/src/ccp4_sysdep.h
--- ccp4-5.99.5-orig/lib/cctbx/cctbx_sources/ccp4io/lib/src/ccp4_sysdep.h	1969-12-31 16:00:00.000000000 -0800
+++ ccp4-5.99.5/lib/cctbx/cctbx_sources/ccp4io/lib/src/ccp4_sysdep.h	2005-11-30 17:40:04.000000000 -0800
@@ -0,0 +1,320 @@
+/*
+     ccp4_sysdep.h: System-dependent definitions
+     Copyright (C) 2001  CCLRC
+
+     This library is free software and is distributed under the terms and
+     conditions of the CCP4 licence agreement as `Part 0' (Annex 2)
+     software, which is version 2.1 of the GNU Lesser General Public
+     Licence (LGPL) with the following additional clause:
+
+        `You may also combine or link a "work that uses the Library" to
+        produce a work containing portions of the Library, and distribute
+        that work under terms of your choice, provided that you give
+        prominent notice with each copy of the work that the specified
+        version of the Library is used in it, and that you include or
+        provide public access to the complete corresponding
+        machine-readable source code for the Library including whatever
+        changes were used in the work. (i.e. If you make changes to the
+        Library you must distribute those, but you do not need to
+        distribute source or object code to those portions of the work
+        not covered by this licence.)'
+
+     Note that this clause grants an additional right and does not impose
+     any additional restriction, and so does not affect compatibility
+     with the GNU General Public Licence (GPL). If you wish to negotiate
+     other terms, please contact the maintainer.
+
+     You can redistribute it and/or modify the library under the terms of
+     the GNU Lesser General Public License as published by the Free Software
+     Foundation; either version 2.1 of the License, or (at your option) any
+     later version.
+
+     This library is distributed in the hope that it will be useful, but
+     WITHOUT ANY WARRANTY; without even the implied warranty of
+     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+     Lesser General Public License for more details.
+
+     You should have received a copy of the CCP4 licence and/or GNU
+     Lesser General Public License along with this library; if not, write
+     to the CCP4 Secretary, Daresbury Laboratory, Warrington WA4 4AD, UK.
+     The GNU Lesser General Public can also be obtained by writing to the
+     Free Software Foundation, Inc., 59 Temple Place, Suite 330, Boston,
+     MA 02111-1307 USA
+*/
+
+/** @file ccp4_sysdep.h
+ *
+ *  @brief System-dependent definitions.
+ *
+ *  @author Charles Ballard, based in part on earlier versions
+ */
+
+#ifndef __CCP4_BITS
+#define __CCP4_BITS
+
+#if defined (_AIX) || defined(___AIX)
+#  define KNOWN_MACHINE
+#  define CALL_LIKE_HPUX 1
+#endif
+
+#if defined (__hpux) 
+#  define KNOWN_MACHINE
+#  define CALL_LIKE_HPUX 1
+#endif
+
+#ifdef __sgi   /* in ANSI mode */
+#  ifndef sgi
+#    define sgi
+#  endif
+#endif
+
+#if defined (sgi)
+#  define KNOWN_MACHINE
+#  define CALL_LIKE_SUN 1
+#endif
+
+#if defined (sun) || defined (__sun)
+#  define KNOWN_MACHINE
+#  define CALL_LIKE_SUN 1
+#  if !defined(__STDC__) || defined(__GNUC__)
+#    if !defined(G77)
+      extern char *sys_errlist [];
+#     define strerror(i) sys_errlist[i] /* k&r compiler doesn't have it */
+#    endif
+#  endif
+#endif
+
+#if defined(__OSF1__) || defined(__osf__)
+#  define KNOWN_MACHINE
+#  define CALL_LIKE_SUN 1
+#endif
+
+#ifndef VMS
+#  if defined (vms) || defined (__vms) || defined (__VMS)
+#    define VMS
+#  endif
+#endif
+#if defined (VMS)
+#  define KNOWN_MACHINE
+#  define CALL_LIKE_VMS 1
+#endif
+
+#if defined(_MSC_VER) || defined (WIN32)
+# if defined (_MSC_VER) && (_MSC_VER >= 800)
+#  define CALL_LIKE_MVS 2
+# else
+#  define CALL_LIKE_MVS 1
+# endif
+#  define KNOWN_MACHINE
+#endif
+
+#if defined (linux) || defined __linux__ || defined (__CYGWIN__)
+#  undef CALL_LIKE_SUN
+#  define KNOWN_MACHINE
+#  define CALL_LIKE_SUN 1
+#endif
+
+#if defined __linux__ && ( defined __PPC || defined __PPC__ )
+#  undef CALL_LIKE_SUN
+#  define KNOWN_MACHINE
+#  define CALL_LIKE_SUN 1
+#endif
+
+#if defined (__FreeBSD__)
+#  undef CALL_LIKE_SUN
+#  define KNOWN_MACHINE
+#  define CALL_LIKE_SUN 1
+#endif
+
+#if defined(F2C) || defined(G77)
+#  undef CALL_LIKE_SUN
+#  define CALL_LIKE_SUN 1
+#  define KNOWN_MACHINE
+#endif
+
+#if defined(__APPLE__)
+#  undef CALL_LIKE_SUN
+#  define CALL_LIKE_SUN 1
+#  define KNOWN_MACHINE
+#endif
+
+#if defined (_CALL_SYSV) && ! defined (__APPLE__)
+#  undef CALL_LIKE_SUN
+#  define CALL_LIKE_SUN 1
+#  define KNOWN_MACHINE
+#endif
+
+#if ! defined (KNOWN_MACHINE)
+#  error System type is not known -- see the Installation Guide
+#else
+
+#ifndef _POSIX_SOURCE
+#define _POSIX_SOURCE
+#endif
+
+/* include X/Open Unix extensions (e.g. cuserid) */
+#ifndef _XOPEN_SOURCE
+#define _XOPEN_SOURCE
+#endif
+
+#include <stdio.h>
+
+#if defined (VMS)
+#  include <descrip.h>          /* non-POSIX */
+#  define NOUNISTD
+#else
+#  include <sys/types.h>
+#  include <sys/stat.h>
+#  if !defined (_WIN32) && !defined (_MSC_VER)
+#    include <sys/times.h>
+#  endif
+#  ifdef _MSC_VER
+#    define NOUNISTD
+#  endif
+#endif
+
+#include <stddef.h>
+#include <string.h>
+
+#ifndef NOUNISTD
+#  include <unistd.h>
+#else
+#  ifndef VMS 
+#    ifndef _MSC_VER
+#      include <sys/file.h>     /* ESV, old Concentrix */ /* non-POSIX */
+#    endif
+#  endif
+#endif
+#ifndef NOSTDLIB                /* for TitanOS 4.2, at least? */
+#  include <stdlib.h>
+#endif
+
+#include <errno.h>
+#include <ctype.h>
+
+#if defined(_AIX) || defined (__hpux) || defined(F2C) ||\
+    defined(G77) || defined(_WIN32) /* would do no harm on others, though */
+#  include <time.h>
+#endif
+
+#include <limits.h>
+#include <float.h>
+
+#if defined (F2C)
+#  define Skip_f2c_Undefs
+#  include "f2c.h"
+#endif
+#if defined (G77)
+#  define Skip_f2c_Undefs       /* g2c.h infelicity... */
+#  if defined (HAVE_G2C_H)
+#    include "g2c.h"
+#  else
+#    include "f2c.h"
+#  endif
+#endif
+
+/* rint() function does not seen to exist for mingw32
+   defined in library_utils.c */
+#  if ((defined _WIN32) || (defined _MSC_VER)) && (!defined rint)
+  double rint(double x);
+#endif
+
+#ifdef _MSC_VER
+#define  M_PI            3.14159265358979323846
+#endif
+
+#ifdef _MSC_VER
+#  define PATH_SEPARATOR '\\'
+#  define EXT_SEPARATOR '.'
+#else
+#  define PATH_SEPARATOR '/'
+#  define EXT_SEPARATOR '.'
+#endif
+
+#define MAXFLEN       512    /**< the maximum length of a filename in CCP4 */
+#define MAXFILES       16    /**< maximum number of files open symultaneously */
+#define DEFMODE         2    /**< default mode access for random access files */
+
+#define IRRELEVANT_OP   0
+#define READ_OP         1
+#define WRITE_OP        2
+
+#include<fcntl.h>
+#ifndef SEEK_SET
+#  define SEEK_SET 0
+#  define SEEK_CUR 1
+#  define SEEK_END 2
+#endif /* ! SEEK_SET */
+#ifndef O_WRONLY
+#define O_RDONLY 0x0000       /**< i/o mode: read-only */
+#define O_WRONLY 0x0001       /**< i/o mode: write-only  */
+#define O_RDWR   0x0002       /**< i/o mode: read and write  */
+#define O_APPEND 0x0008       /**< i/o mode: append to existing file  */
+#define O_CREAT  0x0200       /**< i/o mode: create file  */
+#define O_TRUNC  0x0400       /**< i/o mode: truncate existing file  */
+#endif
+#define O_TMP    0x0010       /**< i/o mode: scratch file */
+
+#define BYTE  0
+#define INT16 1   
+#define INT32 6
+#define FLOAT32 2
+#define COMP32  3
+#define COMP64  4
+
+#define DFNTI_MBO       1       /**< Motorola byte order 2's compl */
+#define DFNTI_IBO       4       /**< Intel byte order 2's compl */
+
+#define DFNTF_BEIEEE    1       /**< big endian IEEE (canonical) */
+#define DFNTF_VAX       2       /**< Vax format */
+#define DFNTF_CONVEXNATIVE 5    /**< Convex native floats */
+#define DFNTF_LEIEEE    4       /**< little-endian IEEE format */
+
+#if defined (VAX) || defined (vax) /* gcc seems to use vax */
+#  define NATIVEFT DFNTF_VAX
+#  define NATIVEIT DFNTI_IBO
+#endif
+
+#if defined(MIPSEL) || defined(i386) || defined(i860) || defined(__ia64__) || defined(__amd64__) || defined(__x86_64__)
+#  define NATIVEIT DFNTI_IBO
+#  define NATIVEFT DFNTF_LEIEEE
+#endif
+
+#if defined (powerpc) || defined (__ppc__) || defined __PPC
+#  define NATIVEIT DFNTI_MBO
+#  define NATIVEFT DFNTF_BEIEEE
+#endif
+
+#ifdef __alpha
+#  ifdef VMS
+#    if __IEEE_FLOAT == 1
+#      define NATIVEFT DFNTF_LEIEEE
+#    else
+#      define NATIVEFT DFNTF_VAX
+#    endif
+#  else                       /* assume OSF/1 */
+#    define NATIVEFT DFNTF_LEIEEE
+#  endif
+#  define NATIVEIT DFNTI_IBO
+#endif
+
+#if defined(MIPSEB) || defined(__hpux) || defined(_AIX) || defined(m68k) || defined(mc68000) || defined(sparc) || defined (__sparc__)
+#  define NATIVEIT DFNTI_MBO
+#  define NATIVEFT DFNTF_BEIEEE
+#endif
+
+#ifndef NATIVEFT
+#  error "Can't determine machine number format"
+#endif
+
+#define DFNT_UINT       0       /**< unsigned int */
+#define DFNT_SINT       1       /**< short int */
+#define DFNT_INT        2       /**< int */
+#define DFNT_UCHAR      3       /**< unsigned char */
+#define DFNT_CHAR       4       /**< char */
+#define DFNT_FLOAT      5       /**< float */
+#define DFNT_DOUBLE     6       /**< double */
+
+#endif
+
+#endif /* __CCP4_BITS */
diff -ruN ccp4-5.99.5-orig/lib/cctbx/cctbx_sources/ccp4io/lib/src/ccp4_types.h ccp4-5.99.5/lib/cctbx/cctbx_sources/ccp4io/lib/src/ccp4_types.h
--- ccp4-5.99.5-orig/lib/cctbx/cctbx_sources/ccp4io/lib/src/ccp4_types.h	1969-12-31 16:00:00.000000000 -0800
+++ ccp4-5.99.5/lib/cctbx/cctbx_sources/ccp4io/lib/src/ccp4_types.h	2005-11-30 17:40:04.000000000 -0800
@@ -0,0 +1,103 @@
+/*
+     ccp4_types.h: CCP4 library.c macro definitions etc
+     Copyright (C) 2001  CCLRC
+
+     This library is free software and is distributed under the terms and
+     conditions of the CCP4 licence agreement as `Part 0' (Annex 2)
+     software, which is version 2.1 of the GNU Lesser General Public
+     Licence (LGPL) with the following additional clause:
+
+        `You may also combine or link a "work that uses the Library" to
+        produce a work containing portions of the Library, and distribute
+        that work under terms of your choice, provided that you give
+        prominent notice with each copy of the work that the specified
+        version of the Library is used in it, and that you include or
+        provide public access to the complete corresponding
+        machine-readable source code for the Library including whatever
+        changes were used in the work. (i.e. If you make changes to the
+        Library you must distribute those, but you do not need to
+        distribute source or object code to those portions of the work
+        not covered by this licence.)'
+
+     Note that this clause grants an additional right and does not impose
+     any additional restriction, and so does not affect compatibility
+     with the GNU General Public Licence (GPL). If you wish to negotiate
+     other terms, please contact the maintainer.
+
+     You can redistribute it and/or modify the library under the terms of
+     the GNU Lesser General Public License as published by the Free Software
+     Foundation; either version 2.1 of the License, or (at your option) any
+     later version.
+
+     This library is distributed in the hope that it will be useful, but
+     WITHOUT ANY WARRANTY; without even the implied warranty of
+     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+     Lesser General Public License for more details.
+
+     You should have received a copy of the CCP4 licence and/or GNU
+     Lesser General Public License along with this library; if not, write
+     to the CCP4 Secretary, Daresbury Laboratory, Warrington WA4 4AD, UK.
+     The GNU Lesser General Public can also be obtained by writing to the
+     Free Software Foundation, Inc., 59 Temple Place, Suite 330, Boston,
+     MA 02111-1307 USA
+*/
+#ifndef __CCP4_TYPES
+#define __CCP4_TYPES
+
+#include "ccp4_sysdep.h"
+
+typedef unsigned short uint16;
+#ifdef SIXTEENBIT
+typedef unsigned long uint32;
+#else
+typedef unsigned int uint32;
+#endif
+typedef float float32;
+typedef unsigned char uint8;
+union float_uint_uchar {
+    float32 f;
+    uint32 i;
+    uint8 c[4];
+  };
+
+typedef   char     *        pstr;
+
+/* CCP4 library.c macro definitions */
+
+#ifndef FALSE
+#define FALSE 0
+#define TRUE 1
+#endif
+
+typedef struct { double r;             /* real component and */
+                 double i;             /* imaginary component of */
+               } COMPLEX;              /* a complex number */
+
+typedef struct { double r;             /* radial and */
+                 double phi;           /* angular component of */
+               } POLAR;                /* a complex number */
+
+/* some simple macros, which may exist anyway */
+#ifndef SQR
+#define SQR(x) ((x)*(x))
+#endif
+#ifndef DEGREE
+#define DEGREE(x) ((((x < 0)?(x)+2*M_PI:(x))*360)/(2*M_PI))
+#endif
+#ifndef RADIAN
+#define RADIAN(x) ((((x<0)?(x)+360:(x))*2*M_PI)/360)
+#endif
+#ifndef MAX
+#define MAX(x, y) (((x)>(y))?(x):(y))
+#endif
+#ifndef MIN
+#define MIN(x, y) (((x)<(y))?(x):(y))
+#endif
+#ifndef ABS
+#define ABS(x) (((x)<0)?-(x):(x))
+#endif
+#ifndef SIGN
+#define SIGN(x) (((x)<0)?-1:1)
+#endif
+
+#endif   /* __CCP4_TYPES */
diff -ruN ccp4-5.99.5-orig/lib/cctbx/cctbx_sources/ccp4io/lib/src/ccp4_unitcell.c ccp4-5.99.5/lib/cctbx/cctbx_sources/ccp4io/lib/src/ccp4_unitcell.c
--- ccp4-5.99.5-orig/lib/cctbx/cctbx_sources/ccp4io/lib/src/ccp4_unitcell.c	1969-12-31 16:00:00.000000000 -0800
+++ ccp4-5.99.5/lib/cctbx/cctbx_sources/ccp4io/lib/src/ccp4_unitcell.c	2005-11-30 17:40:04.000000000 -0800
@@ -0,0 +1,352 @@
+/*
+     ccp4_unitcell.c: C library for manipulations based on cell parameters.
+     Copyright (C) 2001  CCLRC, Martyn Winn
+
+     This library is free software and is distributed under the terms and
+     conditions of the CCP4 licence agreement as `Part 0' (Annex 2)
+     software, which is version 2.1 of the GNU Lesser General Public
+     Licence (LGPL) with the following additional clause:
+
+        `You may also combine or link a "work that uses the Library" to
+        produce a work containing portions of the Library, and distribute
+        that work under terms of your choice, provided that you give
+        prominent notice with each copy of the work that the specified
+        version of the Library is used in it, and that you include or
+        provide public access to the complete corresponding
+        machine-readable source code for the Library including whatever
+        changes were used in the work. (i.e. If you make changes to the
+        Library you must distribute those, but you do not need to
+        distribute source or object code to those portions of the work
+        not covered by this licence.)'
+
+     Note that this clause grants an additional right and does not impose
+     any additional restriction, and so does not affect compatibility
+     with the GNU General Public Licence (GPL). If you wish to negotiate
+     other terms, please contact the maintainer.
+
+     You can redistribute it and/or modify the library under the terms of
+     the GNU Lesser General Public License as published by the Free Software
+     Foundation; either version 2.1 of the License, or (at your option) any
+     later version.
+
+     This library is distributed in the hope that it will be useful, but
+     WITHOUT ANY WARRANTY; without even the implied warranty of
+     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+     Lesser General Public License for more details.
+
+     You should have received a copy of the CCP4 licence and/or GNU
+     Lesser General Public License along with this library; if not, write
+     to the CCP4 Secretary, Daresbury Laboratory, Warrington WA4 4AD, UK.
+     The GNU Lesser General Public can also be obtained by writing to the
+     Free Software Foundation, Inc., 59 Temple Place, Suite 330, Boston,
+     MA 02111-1307 USA
+*/
+
+/** @file ccp4_unitcell.c
+ *  C library for manipulations based on cell parameters.
+ *  Martyn Winn 
+ */
+
+#include <stdio.h>
+
+#include "ccp4_unitcell.h"
+#include "cvecmat.h"
+#include "ccp4_errno.h"
+
+/* from input cell and orthogonalisation code, find orthogonalisation
+   and fractionalisation matrices. Returns cell volume. */
+
+double ccp4uc_frac_orth_mat(const double cell[6], const int ncode, 
+			 double ro[3][3], double rf[3][3])
+{
+  int i,j;
+  double conv,alph,bet,gamm,sina,cosa,sinb,cosb,sing,cosg,
+    sinas,cosas,sinbs,cosbs,sings,cosgs,a,b,c;
+
+  conv = atan(1.0)*4.0/180.0;
+  alph = cell[3]*conv;
+  bet = cell[4]*conv;
+  gamm = cell[5]*conv;
+  sina = sin(alph);
+  cosa = cos(alph);
+  sinb = sin(bet);
+  cosb = cos(bet);
+  sing = sin(gamm);
+  cosg = cos(gamm);
+  cosas = (cosg*cosb-cosa)/ (sinb*sing);
+  sinas = sqrt(1.0-cosas*cosas);
+  cosbs = (cosa*cosg-cosb)/ (sina*sing);
+  sinbs = sqrt(1.0-cosbs*cosbs);
+  cosgs = (cosa*cosb-cosg)/ (sina*sinb);
+  sings = sqrt(1.0-cosgs*cosgs);
+  a = cell[0];
+  b = cell[1];
+  c = cell[2];
+	
+  /* calculate ro */
+  for ( i = 0; i < 3; i++ ) 
+    for ( j = 0; j < 3; j++ ) 
+      ro[i][j] = 0.0;
+
+  /* ncode 1 -  xo along a  zo along c* */
+
+  switch (ncode) {
+  case 1:
+    ro[0][0] = a;
+    ro[0][1] = b*cosg;
+    ro[0][2] = c*cosb;
+    ro[1][1] = b*sing;
+    ro[1][2] = -c*sinb*cosas;
+    ro[2][2] = c*sinb*sinas;
+    break;
+
+ /* ncode 2 -  xo along b  zo along a* */
+
+  case 2:
+    ro[0][0] = a*cosg;
+    ro[0][1] = b;
+    ro[0][2] = c*cosa;
+    ro[1][0] = -a*sing*cosbs;
+    ro[1][2] = c*sina;
+    ro[2][0] = a*sing*sinbs;
+    break;
+
+ /* ncode 3 -  xo along c  zo along b* */
+
+  case 3:
+    ro[0][0] = a*cosb;
+    ro[0][1] = b*cosa;
+    ro[0][2] = c;
+    ro[1][0] = a*sinb;
+    ro[1][1] = -b*sina*cosgs;
+    ro[2][1] = b*sina*sings;
+    break;
+
+ /* ncode 4 -  trigonal only - xo along a+b  yo alon a-b  zo along c* */
+
+  case 4:
+    ro[0][0] = a/2.0;
+    ro[0][1] = a/2.0;
+    ro[1][0] = -a*sing;
+    ro[1][1] = a*sing;
+    ro[2][2] = c;
+    break;
+
+ /* ncode 5 -  xo along a*   zo along c */
+
+  case 5:
+    ro[0][0] = a*sinb*sings;
+    ro[1][0] = -a*sinb*cosgs;
+    ro[1][1] = b*sina;
+    ro[2][0] = a*cosb;
+    ro[2][1] = b*cosa;
+    ro[2][2] = c;
+    break;
+
+ /* ncode 6 -  grr*! to  gerard bricogne - his setting for p1 in skew.
+     xo along a  yo along b* */
+
+  case 6:
+    ro[0][0] = a;
+    ro[0][1] = b*cosg;
+    ro[0][2] = c*cosb;
+    ro[1][1] = b*sing*sinas;
+    ro[2][1] = -b*sing*cosas;
+    ro[2][2] = c*sinb;
+    break;
+  }
+
+   /* now calculate rf from ro, determinant gives cell volume */
+
+  return invert3matrix((const double (*)[3]) ro, rf);
+
+}
+
+/* from input cell, find dimensions of reciprocal cell. 
+   Returns reciprocal cell volume. */
+
+double ccp4uc_calc_rcell(const double cell[6], double rcell[6])
+{
+  double conv,alph,bet,gamm,vol,sina,cosa,sinb,cosb,sing,cosg,
+    sinas,cosas,sinbs,cosbs,sings,cosgs,a,b,c;
+
+  conv = 3.14159/180.0;
+  alph = cell[3]*conv;
+  bet = cell[4]*conv;
+  gamm = cell[5]*conv;
+  vol = ccp4uc_calc_cell_volume(cell);
+  sina = sin(alph);
+  cosa = cos(alph);
+  sinb = sin(bet);
+  cosb = cos(bet);
+  sing = sin(gamm);
+  cosg = cos(gamm);
+  cosas = (cosg*cosb-cosa)/ (sinb*sing);
+  sinas = sqrt(1.0-cosas*cosas);
+  cosbs = (cosa*cosg-cosb)/ (sina*sing);
+  sinbs = sqrt(1.0-cosbs*cosbs);
+  cosgs = (cosa*cosb-cosg)/ (sina*sinb);
+  sings = sqrt(1.0-cosgs*cosgs);
+  a = cell[0];
+  b = cell[1];
+  c = cell[2];
+  rcell[0] = b*c*sina/vol;
+  rcell[1] = c*a*sinb/vol;
+  rcell[2] = a*b*sing/vol;
+  rcell[3] = atan2(sinas,cosas)/conv;
+  rcell[4] = atan2(sinbs,cosbs)/conv;
+  rcell[5] = atan2(sings,cosgs)/conv;
+
+  return (1.0 / vol);
+}
+
+/* Convert orthogonal to fractional coordinates. Translation only if
+   deliberate origin shift - does this ever happen? Leave it to the
+   application. */
+
+void ccp4uc_orth_to_frac(const double rf[3][3], const double xo[3], double xf[3])
+{
+  xf[0] = rf[0][0]*xo[0] + rf[0][1]*xo[1] + rf[0][2]*xo[2];
+  xf[1] = rf[1][0]*xo[0] + rf[1][1]*xo[1] + rf[1][2]*xo[2];
+  xf[2] = rf[2][0]*xo[0] + rf[2][1]*xo[1] + rf[2][2]*xo[2];
+}
+
+/* Convert fractional to orthogonal coordinates. */
+
+void ccp4uc_frac_to_orth(const double ro[3][3], const double xf[3], double xo[3])
+{
+  xo[0] = ro[0][0]*xf[0] + ro[0][1]*xf[1] + ro[0][2]*xf[2];
+  xo[1] = ro[1][0]*xf[0] + ro[1][1]*xf[1] + ro[1][2]*xf[2];
+  xo[2] = ro[2][0]*xf[0] + ro[2][1]*xf[1] + ro[2][2]*xf[2];
+}
+
+/* Convert orthogonal to fractional u matrix. */
+
+void ccp4uc_orthu_to_fracu(const double rf[3][3], const double uo[6], double uf[6])
+{
+  int i,j;
+  double uomat[3][3], ufmat[3][3], rft[3][3], temp[3][3];
+
+  uomat[0][0] = uo[0]; uomat[0][1] = uo[3]; uomat[0][2] = uo[4]; 
+  uomat[1][0] = uo[3]; uomat[1][1] = uo[1]; uomat[1][2] = uo[5]; 
+  uomat[2][0] = uo[4]; uomat[2][1] = uo[5]; uomat[2][2] = uo[2]; 
+  for ( i = 0; i < 3; i++ ) 
+    for ( j = 0; j < 3; j++ ) 
+      rft[i][j] = rf[j][i];
+
+  ccp4_3matmul(temp,(const double (*)[3]) uomat,(const double (*)[3]) rft);
+  ccp4_3matmul(ufmat,rf,(const double (*)[3]) temp);
+
+  uf[0] = ufmat[0][0]; uf[1] = ufmat[1][1]; uf[2] = ufmat[2][2]; 
+  uf[3] = ufmat[0][1]; uf[4] = ufmat[0][2]; uf[5] = ufmat[1][2]; 
+}
+
+/* Convert fractional to orthogonal u matrix. */
+
+void ccp4uc_fracu_to_orthu(const double ro[3][3], const double uf[6], double uo[6])
+{
+  int i,j;
+  double uomat[3][3], ufmat[3][3], rot[3][3], temp[3][3];
+
+  ufmat[0][0] = uf[0]; ufmat[0][1] = uf[3]; ufmat[0][2] = uf[4]; 
+  ufmat[1][0] = uf[3]; ufmat[1][1] = uf[1]; ufmat[1][2] = uf[5]; 
+  ufmat[2][0] = uf[4]; ufmat[2][1] = uf[5]; ufmat[2][2] = uf[2]; 
+  for ( i = 0; i < 3; i++ ) 
+    for ( j = 0; j < 3; j++ ) 
+      rot[i][j] = ro[j][i];
+
+  ccp4_3matmul(temp,(const double (*)[3]) ufmat,(const double (*)[3]) rot);
+  ccp4_3matmul(uomat,ro,(const double (*)[3]) temp);
+
+  uo[0] = uomat[0][0]; uo[1] = uomat[1][1]; uo[2] = uomat[2][2]; 
+  uo[3] = uomat[0][1]; uo[4] = uomat[0][2]; uo[5] = uomat[1][2]; 
+}
+
+/* Calculate cell volume from cell parameters */
+
+double ccp4uc_calc_cell_volume(const double cell[6])
+{
+  double conv,alph,bet,gamm,sum,v;
+
+  conv = 3.14159/180.0;
+  alph = cell[3]*conv;
+  bet = cell[4]*conv;
+  gamm = cell[5]*conv;
+  sum = (alph+bet+gamm)*0.5;
+  v = sqrt(sin(sum-alph)*sin(sum-bet)*sin(sum-gamm)*sin(sum));
+  return (2.0*cell[0]*cell[1]*cell[2]*v);
+}
+
+/* Check cells agree within tolerance */
+
+int ccp4uc_cells_differ(const double cell1[6], const double cell2[6], const double tolerance)
+{
+  int i;
+  double vol1, vol2, acheck;
+
+  vol1 = ccp4uc_calc_cell_volume(cell1);  
+  vol2 = ccp4uc_calc_cell_volume(cell2);
+
+  /* check cell volumes */
+  acheck = fabs(0.5*(vol1 - vol2))/(vol1 + vol2);
+  if (acheck > tolerance) {
+    if (ccp4_liberr_verbosity(-1)) {
+      printf("Difference in cell volumes detected.\n");
+      printf("  vol1 = %lf  vol2 = %lf \n",vol1,vol2);
+    }
+    return 1;
+  }
+
+  /* check cell parameters */
+  acheck = 0.0;
+  for ( i = 0; i < 6; i++ ) 
+    acheck += fabs(0.5*(cell2[i]-cell1[i]))/(cell2[i]+cell1[i]);
+  if (acheck > 3.0*tolerance) {
+    if (ccp4_liberr_verbosity(-1)) {
+      printf("Large difference in cell parameters detected.\n");
+      printf("  cell1 = %lf %lf %lf %lf %lf %lf \n",
+	   cell1[0],cell1[1],cell1[2],cell1[3],cell1[4],cell1[5]);
+      printf("  cell2 = %lf %lf %lf %lf %lf %lf \n",
+	   cell2[0],cell2[1],cell2[2],cell2[3],cell2[4],cell2[5]);
+    }
+    return 1;
+  } else if (acheck > tolerance) {
+    if (ccp4_liberr_verbosity(-1)) {
+      printf("Small difference in cell parameters detected.\n");
+      printf("  cell1 = %lf %lf %lf %lf %lf %lf \n",
+	   cell1[0],cell1[1],cell1[2],cell1[3],cell1[4],cell1[5]);
+      printf("  cell2 = %lf %lf %lf %lf %lf %lf \n",
+	   cell2[0],cell2[1],cell2[2],cell2[3],cell2[4],cell2[5]);
+    }
+    return 1;
+  }
+  return 0;
+}
+
+int ccp4uc_is_rhombohedral(const float cell[6], const float tolerance) {
+
+  double acheck;
+
+  acheck = fabs(cell[0]-cell[1]);
+  acheck += fabs(cell[1]-cell[2]);
+  acheck += fabs(cell[0]-cell[2]);
+  acheck += fabs(cell[3]-cell[4]);
+  acheck += fabs(cell[3]-cell[5]);
+  acheck += fabs(cell[4]-cell[5]);
+  if (acheck > (double) tolerance) return 0;
+  return 1;
+
+}
+
+int ccp4uc_is_hexagonal(const float cell[6], const float tolerance) {
+
+  double acheck;
+
+  acheck = fabs(cell[0]-cell[1]);
+  acheck += fabs(cell[3]-90.0);
+  acheck += fabs(cell[4]-90.0);
+  acheck += fabs(cell[5]-120.0);
+  if (acheck > (double) tolerance) return 0;
+  return 1;
+
+}
diff -ruN ccp4-5.99.5-orig/lib/cctbx/cctbx_sources/ccp4io/lib/src/ccp4_unitcell.h ccp4-5.99.5/lib/cctbx/cctbx_sources/ccp4io/lib/src/ccp4_unitcell.h
--- ccp4-5.99.5-orig/lib/cctbx/cctbx_sources/ccp4io/lib/src/ccp4_unitcell.h	1969-12-31 16:00:00.000000000 -0800
+++ ccp4-5.99.5/lib/cctbx/cctbx_sources/ccp4io/lib/src/ccp4_unitcell.h	2005-11-30 17:40:04.000000000 -0800
@@ -0,0 +1,144 @@
+/*
+     ccp4_unitcell.h: headers for C library for ccp4_unitcell.c
+     Copyright (C) 2001  CCLRC, Martyn Winn  
+
+     This library is free software and is distributed under the terms and
+     conditions of the CCP4 licence agreement as `Part 0' (Annex 2)
+     software, which is version 2.1 of the GNU Lesser General Public
+     Licence (LGPL) with the following additional clause:
+
+        `You may also combine or link a "work that uses the Library" to
+        produce a work containing portions of the Library, and distribute
+        that work under terms of your choice, provided that you give
+        prominent notice with each copy of the work that the specified
+        version of the Library is used in it, and that you include or
+        provide public access to the complete corresponding
+        machine-readable source code for the Library including whatever
+        changes were used in the work. (i.e. If you make changes to the
+        Library you must distribute those, but you do not need to
+        distribute source or object code to those portions of the work
+        not covered by this licence.)'
+
+     Note that this clause grants an additional right and does not impose
+     any additional restriction, and so does not affect compatibility
+     with the GNU General Public Licence (GPL). If you wish to negotiate
+     other terms, please contact the maintainer.
+
+     You can redistribute it and/or modify the library under the terms of
+     the GNU Lesser General Public License as published by the Free Software
+     Foundation; either version 2.1 of the License, or (at your option) any
+     later version.
+
+     This library is distributed in the hope that it will be useful, but
+     WITHOUT ANY WARRANTY; without even the implied warranty of
+     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+     Lesser General Public License for more details.
+
+     You should have received a copy of the CCP4 licence and/or GNU
+     Lesser General Public License along with this library; if not, write
+     to the CCP4 Secretary, Daresbury Laboratory, Warrington WA4 4AD, UK.
+     The GNU Lesser General Public can also be obtained by writing to the
+     Free Software Foundation, Inc., 59 Temple Place, Suite 330, Boston,
+     MA 02111-1307 USA
+*/
+
+/** @file ccp4_unitcell.h
+ *  C library for manipulations based on cell parameters.
+ *  Martyn Winn 
+ */
+
+#ifndef __CCP4_UNITCELL
+#define __CCP4_UNITCELL
+
+#ifdef  __cplusplus
+namespace CCP4uc {
+extern "C" {
+#endif
+
+#include <math.h>
+
+/** From input cell and orthogonalisation code, find orthogonalisation
+   and fractionalisation matrices.
+ * @param cell
+ * @param ncode
+ * @param ro
+ * @param rf
+ * @return Cell volume
+ */
+double ccp4uc_frac_orth_mat(const double cell[6], const int ncode, 
+			   double ro[3][3], double rf[3][3]);
+
+/** From input cell, find dimensions of reciprocal cell.
+ * @param cell
+ * @param rcell
+ * @return Reciprocal cell volume
+ */
+double ccp4uc_calc_rcell(const double cell[6], double rcell[6]);
+
+/** Convert orthogonal to fractional coordinates. Translation only if
+   deliberate origin shift - does this ever happen? Leave it to the
+   application.
+ * @param rf
+ * @param xo
+ * @param xf
+ * @return void
+ */
+void ccp4uc_orth_to_frac(const double rf[3][3], const double xo[3], double xf[3]);
+
+/** Convert fractional to orthogonal coordinates.
+ * @param ro
+ * @param xf
+ * @param xo
+ * @return void
+ */
+void ccp4uc_frac_to_orth(const double ro[3][3], const double xf[3], double xo[3]);
+
+/** Convert orthogonal to fractional u matrix.
+ * @param rf
+ * @param uo
+ * @param uf
+ * @return void
+ */
+void ccp4uc_orthu_to_fracu(const double rf[3][3], const double uo[6], double uf[6]);
+
+/** Convert fractional to orthogonal u matrix.
+ * @param ro
+ * @param uf
+ * @param uo
+ * @return void
+ */
+void ccp4uc_fracu_to_orthu(const double ro[3][3], const double uf[6], double uo[6]);
+
+/** Calculate cell volume from cell parameters.
+ * @param cell
+ * @return Cell volume.
+ */
+double ccp4uc_calc_cell_volume(const double cell[6]);
+
+/** Check cells agree within tolerance.
+ * @param cell1 First cell.
+ * @param cell2 Second cell.
+ * @param tolerance A tolerance for agreement.
+ * @return 1 if cells differ by more than tolerance, 0 otherwise.
+ */
+int ccp4uc_cells_differ(const double cell1[6], const double cell2[6], const double tolerance);
+
+/** Check if cell parameters conform to a rhombohedral setting.
+ * @param cell Cell parameters. Angles are assumed to be in degrees.
+ * @param tolerance A tolerance for agreement.
+ * @return 1 if cell parameters conform, 0 otherwise.
+ */
+int ccp4uc_is_rhombohedral(const float cell[6], const float tolerance);
+
+/** Check if cell parameters conform to a hexagonal setting.
+ * @param cell Cell parameters. Angles are assumed to be in degrees.
+ * @param tolerance A tolerance for agreement.
+ * @return 1 if cell parameters conform, 0 otherwise. 
+ */
+int ccp4uc_is_hexagonal(const float cell[6], const float tolerance);
+
+#ifdef __cplusplus
+} }
+#endif
+
+#endif  /*!CCP4_UNITCELL */
diff -ruN ccp4-5.99.5-orig/lib/cctbx/cctbx_sources/ccp4io/lib/src/ccp4_utils.h ccp4-5.99.5/lib/cctbx/cctbx_sources/ccp4io/lib/src/ccp4_utils.h
--- ccp4-5.99.5-orig/lib/cctbx/cctbx_sources/ccp4io/lib/src/ccp4_utils.h	1969-12-31 16:00:00.000000000 -0800
+++ ccp4-5.99.5/lib/cctbx/cctbx_sources/ccp4io/lib/src/ccp4_utils.h	2005-11-30 17:40:04.000000000 -0800
@@ -0,0 +1,136 @@
+/*
+     ccp4_utils.h: headers for utility functions.
+     Copyright (C) 2001  CCLRC, Charles Ballard
+
+     This library is free software and is distributed under the terms and
+     conditions of the CCP4 licence agreement as `Part 0' (Annex 2)
+     software, which is version 2.1 of the GNU Lesser General Public
+     Licence (LGPL) with the following additional clause:
+
+        `You may also combine or link a "work that uses the Library" to
+        produce a work containing portions of the Library, and distribute
+        that work under terms of your choice, provided that you give
+        prominent notice with each copy of the work that the specified
+        version of the Library is used in it, and that you include or
+        provide public access to the complete corresponding
+        machine-readable source code for the Library including whatever
+        changes were used in the work. (i.e. If you make changes to the
+        Library you must distribute those, but you do not need to
+        distribute source or object code to those portions of the work
+        not covered by this licence.)'
+
+     Note that this clause grants an additional right and does not impose
+     any additional restriction, and so does not affect compatibility
+     with the GNU General Public Licence (GPL). If you wish to negotiate
+     other terms, please contact the maintainer.
+
+     You can redistribute it and/or modify the library under the terms of
+     the GNU Lesser General Public License as published by the Free Software
+     Foundation; either version 2.1 of the License, or (at your option) any
+     later version.
+
+     This library is distributed in the hope that it will be useful, but
+     WITHOUT ANY WARRANTY; without even the implied warranty of
+     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+     Lesser General Public License for more details.
+
+     You should have received a copy of the CCP4 licence and/or GNU
+     Lesser General Public License along with this library; if not, write
+     to the CCP4 Secretary, Daresbury Laboratory, Warrington WA4 4AD, UK.
+     The GNU Lesser General Public can also be obtained by writing to the
+     Free Software Foundation, Inc., 59 Temple Place, Suite 330, Boston,
+     MA 02111-1307 USA
+*/
+
+/** @file ccp4_utils.h
+ *  @brief   Utility functions.
+ *  @author  Charles Ballard
+ */
+
+#ifndef __CCP4_UTILS
+#define __CCP4_UTILS
+
+#include <string.h>
+#include "ccp4_types.h"
+#include "library_file.h"
+
+#ifdef __cplusplus
+namespace CCP4 {
+extern "C" {
+#endif
+
+/****************************************************************************
+ * Function prototypes                                                      *
+ ****************************************************************************/
+
+size_t ccp4_utils_flength (char *, int);
+
+int ccp4_utils_translate_mode_float(float *, const void *, int, int);
+
+void ccp4_utils_fatal (const char *);
+
+void ccp4_utils_print (const char *message);
+
+int ccp4_utils_setenv (char *);
+
+/* turn on line buffering for stdout */
+int ccp4_utils_outbuf (void);
+
+/* turn off any buffering on stdin */
+int ccp4_utils_noinpbuf (void);
+
+union float_uint_uchar ccp4_nan ();
+
+int ccp4_utils_isnan (const union float_uint_uchar *);
+
+void ccp4_utils_bml (int, union float_uint_uchar *);
+
+void ccp4_utils_wrg (int, union float_uint_uchar *, float *);
+
+void ccp4_utils_hgetlimits (int *, float *);
+
+int ccp4_utils_mkdir (const char *, const char *);
+
+int ccp4_utils_chmod (const char *, const char *);
+
+void *ccp4_utils_malloc(size_t);
+
+void *ccp4_utils_realloc(void *, size_t);
+
+void *ccp4_utils_calloc(size_t, size_t);
+
+int ccp4_file_size(const char *);
+
+char *ccp4_utils_username(void);
+
+char *ccp4_utils_basename(char *filename);
+
+char *ccp4_utils_pathname(char *filename);
+
+char *ccp4_utils_extension(char *filename);
+
+char *ccp4_utils_joinfilenames(char *dir, char *file);
+
+void ccp4_utils_idate (int *);
+
+char *ccp4_utils_date(char *);
+
+void ccp4_utils_itime (int *);
+
+char *ccp4_utils_time(char *);
+
+float ccp4_utils_etime (float *);
+
+#if defined (_MSC_VER)
+double ccp4_erfc( double x );
+#endif
+
+/****************************************************************************
+*  End of prototypes                                                        *
+*****************************************************************************/
+#ifdef __cplusplus
+}
+}
+#endif
+
+#endif  /* __CCP4_UTILS */
diff -ruN ccp4-5.99.5-orig/lib/cctbx/cctbx_sources/ccp4io/lib/src/ccp4_vars.h ccp4-5.99.5/lib/cctbx/cctbx_sources/ccp4io/lib/src/ccp4_vars.h
--- ccp4-5.99.5-orig/lib/cctbx/cctbx_sources/ccp4io/lib/src/ccp4_vars.h	1969-12-31 16:00:00.000000000 -0800
+++ ccp4-5.99.5/lib/cctbx/cctbx_sources/ccp4io/lib/src/ccp4_vars.h	2005-11-30 17:40:04.000000000 -0800
@@ -0,0 +1,71 @@
+/*
+     ccp4_vars.h: Standard strings for certain quantites
+     Copyright (C) 2002  CCLRC, Martyn Winn
+
+     This library is free software and is distributed under the terms and
+     conditions of the CCP4 licence agreement as `Part 0' (Annex 2)
+     software, which is version 2.1 of the GNU Lesser General Public
+     Licence (LGPL) with the following additional clause:
+
+        `You may also combine or link a "work that uses the Library" to
+        produce a work containing portions of the Library, and distribute
+        that work under terms of your choice, provided that you give
+        prominent notice with each copy of the work that the specified
+        version of the Library is used in it, and that you include or
+        provide public access to the complete corresponding
+        machine-readable source code for the Library including whatever
+        changes were used in the work. (i.e. If you make changes to the
+        Library you must distribute those, but you do not need to
+        distribute source or object code to those portions of the work
+        not covered by this licence.)'
+
+     Note that this clause grants an additional right and does not impose
+     any additional restriction, and so does not affect compatibility
+     with the GNU General Public Licence (GPL). If you wish to negotiate
+     other terms, please contact the maintainer.
+
+     You can redistribute it and/or modify the library under the terms of
+     the GNU Lesser General Public License as published by the Free Software
+     Foundation; either version 2.1 of the License, or (at your option) any
+     later version.
+
+     This library is distributed in the hope that it will be useful, but
+     WITHOUT ANY WARRANTY; without even the implied warranty of
+     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+     Lesser General Public License for more details.
+
+     You should have received a copy of the CCP4 licence and/or GNU
+     Lesser General Public License along with this library; if not, write
+     to the CCP4 Secretary, Daresbury Laboratory, Warrington WA4 4AD, UK.
+     The GNU Lesser General Public can also be obtained by writing to the
+     Free Software Foundation, Inc., 59 Temple Place, Suite 330, Boston,
+     MA 02111-1307 USA
+*/
+/*
+*/
+
+/* Author: Martyn Winn */
+
+/* Standard strings for certain quantites - for future use */
+
+#ifndef __CCP4_VARS__
+#define __CCP4_VARS__
+
+#define MTZFILENAME "data::mtzfile::filename"
+#define MTZTITLE "data::mtzfile::title"
+#define MTZSPACEGROUP "data::mtzfile::spacegroup_num"        
+#define MTZNUMREFLS "data::mtzfile::num_reflections"
+#define MTZMNF "data::mtzfile::missing_number_flag"
+#define MTZSORTORDER "data::mtzfile::sort_order"          
+
+#define CRYSTALXTALNAME "data::crystal::crystal_name"
+#define CRYSTALPNAME "data::crystal::project_name"
+#define CRYSTALCELL "data::crystal::cell"
+
+#define DATASETDNAME "data::crystal::dataset::dataset_name"
+#define DATASETWAVELENGTH "data::crystal::dataset::wavelength"
+
+#define COLUMNLABEL "data::crystal_i::dataset_i::column_i::label"
+#define COLUMNTYPE "data::crystal_i::dataset_i::column_i::type"
+
+#endif  /*!__CCP4_VARS__ */
diff -ruN ccp4-5.99.5-orig/lib/cctbx/cctbx_sources/ccp4io/lib/src/cmtzlib.c ccp4-5.99.5/lib/cctbx/cctbx_sources/ccp4io/lib/src/cmtzlib.c
--- ccp4-5.99.5-orig/lib/cctbx/cctbx_sources/ccp4io/lib/src/cmtzlib.c	1969-12-31 16:00:00.000000000 -0800
+++ ccp4-5.99.5/lib/cctbx/cctbx_sources/ccp4io/lib/src/cmtzlib.c	2005-11-30 17:40:04.000000000 -0800
@@ -0,0 +1,3651 @@
+/*
+     cmtzlib.c: functions for handling MTZ files
+     Copyright (C) 2001  CCLRC, Martyn Winn
+
+     This library is free software and is distributed under the terms and
+     conditions of the CCP4 licence agreement as `Part 0' (Annex 2)
+     software, which is version 2.1 of the GNU Lesser General Public
+     Licence (LGPL) with the following additional clause:
+
+        `You may also combine or link a "work that uses the Library" to
+        produce a work containing portions of the Library, and distribute
+        that work under terms of your choice, provided that you give
+        prominent notice with each copy of the work that the specified
+        version of the Library is used in it, and that you include or
+        provide public access to the complete corresponding
+        machine-readable source code for the Library including whatever
+        changes were used in the work. (i.e. If you make changes to the
+        Library you must distribute those, but you do not need to
+        distribute source or object code to those portions of the work
+        not covered by this licence.)'
+
+     Note that this clause grants an additional right and does not impose
+     any additional restriction, and so does not affect compatibility
+     with the GNU General Public Licence (GPL). If you wish to negotiate
+     other terms, please contact the maintainer.
+
+     You can redistribute it and/or modify the library under the terms of
+     the GNU Lesser General Public License as published by the Free Software
+     Foundation; either version 2.1 of the License, or (at your option) any
+     later version.
+
+     This library is distributed in the hope that it will be useful, but
+     WITHOUT ANY WARRANTY; without even the implied warranty of
+     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+     Lesser General Public License for more details.
+
+     You should have received a copy of the CCP4 licence and/or GNU
+     Lesser General Public License along with this library; if not, write
+     to the CCP4 Secretary, Daresbury Laboratory, Warrington WA4 4AD, UK.
+     The GNU Lesser General Public can also be obtained by writing to the
+     Free Software Foundation, Inc., 59 Temple Place, Suite 330, Boston,
+     MA 02111-1307 USA
+*/
+
+/* DO NOT put Doxygen comments here - put in cmtzlib.h */
+/* See cmtzlib.h for descriptions of functions */
+
+#include <stdio.h>
+#include <string.h>
+#include <stdlib.h>
+#include <math.h>
+#include "cmtzlib.h"
+#include "ccp4_types.h"
+#include "ccp4_array.h"
+#include "ccp4_parser.h"
+#include "ccp4_vars.h"
+#include "ccp4_errno.h"
+#include "ccp4_unitcell.h"
+
+/* stuff for error reporting */
+#define CMTZ_ERRNO(n) (CCP4_ERR_MTZ | (n))
+
+/* error defs */
+#define  CMTZERR_Ok                  0
+#define  CMTZERR_NoChannel           1
+#define  CMTZERR_NoFile              2
+#define  CMTZERR_NoLogicalName       3
+#define  CMTZERR_CantOpenFile        4
+#define  CMTZERR_NoHeader            5
+#define  CMTZERR_ReadFail            6
+#define  CMTZERR_WriteFail           7
+#define  CMTZERR_ParamError          8
+#define  CMTZERR_Cellerr             9
+#define  CMTZERR_FileStamp           10
+#define  CMTZERR_SymErr              11
+#define  CMTZERR_AllocFail           12
+#define  CMTZERR_MaxFile             13
+#define  CMTZERR_ParserFail          14
+#define  CMTZERR_NotMTZ              15
+#define  CMTZERR_DatasetIncomplete   16
+#define  CMTZERR_NoArch              17
+#define  CMTZERR_NullDataset         18
+#define  CMTZERR_BadVersion          19
+#define  CMTZERR_SYMINFIncomplete    20
+#define  CMTZERR_COLUMNIncomplete    21
+#define  CMTZERR_BadBatchHeader    22
+#define  CMTZERR_DifferentVersion  23
+
+MTZ *MtzGet(const char *logname, int read_refs)
+
+{ return MtzGetUserCellTolerance(logname, read_refs, 0.002);
+}
+
+MTZ *MtzGetUserCellTolerance(const char *logname, int read_refs, const double cell_tolerance)
+
+{ MTZ *mtz;
+  CCP4File *filein;
+  int istat, newproj, cset_warn=0, length;
+  MTZCOL *colin[MCOLUMNS], *newcol;
+  char *filename;
+  char crysin[MXTALS][65],projin[MXTALS][65],crystal[65],project[65];
+  double cellin[MXTALS][6],cell[6];
+  int jxtalin[MSETS];
+  char mkey[4], keyarg[76], hdrrec[MTZRECORDLENGTH+1], label[30], type[3];
+  int i, j, hdrst, ntotcol, nref, ntotset=0, nbat, nhist=0, icolin;
+  int ixtal, jxtal, iset, iiset, icset, nxtal=0, nset[MXTALS]={0}, isym=0;
+  int indhigh[3],indlow[3],isort[5],ind_xtal,ind_set,ind_col[3],debug=0;
+  float min,max,totcell[6],minres,maxres;
+  float *refldata;
+  double coefhkl[6];
+
+  /* For cparser */
+  CCP4PARSERARRAY *parser;
+  CCP4PARSERTOKEN *token=NULL;
+  char *key;
+  int ntok,iprint=0;
+
+  /* For batches */
+  int ibat,nintegers,nreals;
+  float buf[NBATCHWORDS];
+  int *intbuf = (int *) buf;
+  float *fltbuf = buf + NBATCHINTEGERS;
+  MTZBAT *batch;
+
+  if (debug) 
+    printf(" Entering MtzGet \n");
+
+  /* check input */
+  if (!logname) return NULL;
+
+  /* Open the mtz file: */
+  if (getenv(logname) != NULL) {
+    filename = strdup(getenv(logname));
+  } else {
+    filename = strdup(logname);
+  }
+
+  if (debug) 
+    printf(" Opening file %s \n",filename);
+
+  filein = ccp4_file_open(filename,O_RDONLY);
+  if (! filein ) {
+    ccp4_signal(CCP4_ERRLEVEL(3) | CMTZ_ERRNO(CMTZERR_CantOpenFile),"MtzGet",NULL);
+    free(filename);
+    return NULL;
+  }
+
+  if (debug) 
+    printf(" File opened successfully \n");
+
+  ccp4_file_setstamp(filein, 2);
+  /* Read architecture */
+  istat = ccp4_file_rarch (filein);
+  if (!istat) {
+   ccp4_signal(CCP4_ERRLEVEL(2) | CMTZ_ERRNO(CMTZERR_NoArch),
+                        "MtzGet", NULL);
+  }
+
+  parser = ccp4_parse_start(20);
+  if (parser == NULL) {
+    ccp4_signal(CCP4_ERRLEVEL(3) | CMTZ_ERRNO(CMTZERR_ParserFail),"MtzGet",NULL);
+    free(filename);
+    ccp4_file_close(filein);
+    return NULL;
+  }
+  /* Set some convenient pointers to members of the parser array */
+  key   = parser->keyword;
+  token = parser->token;
+
+  ccp4_file_seek (filein, 0, SEEK_SET);
+  ccp4_file_setmode(filein,0);
+  istat = ccp4_file_readchar(filein, (uint8 *) hdrrec, 4);
+  /* We don't test all reads, but this one should trap for e.g. truncated files */
+  if (istat == EOF || hdrrec[0] == '\0') {
+    ccp4_signal(CCP4_ERRLEVEL(3) | CMTZ_ERRNO(CMTZERR_ReadFail),"MtzGet",NULL);
+    ccp4_parse_end(parser);
+    ccp4_file_close(filein);
+    free(filename);
+    return NULL;
+  }
+  hdrrec[4] = '\0';
+  ntok = ccp4_parser(hdrrec, MTZRECORDLENGTH, parser, iprint);
+
+  if (!ccp4_keymatch(key,"MTZ")) {
+    ccp4_signal(CCP4_ERRLEVEL(3) | CMTZ_ERRNO(CMTZERR_NotMTZ),"MtzGet",NULL);
+    ccp4_parse_end(parser);
+    ccp4_file_close(filein);
+    free(filename);
+    return(NULL);
+  }
+
+  if (debug) 
+    printf(" MTZ file confirmed \n");
+
+  ccp4_file_setmode(filein,6);
+  istat = ccp4_file_read(filein, (uint8 *) &hdrst, 1);
+  if (debug) printf(" hdrst read as %d \n",hdrst);
+
+  /* 1st Pass: Read ntotcol, nref, nbat and dataset info.  
+     nxtal and nset are used to assign memory for MTZ structure.
+     Position at top of header */
+  /* We don't test all seeks, but this one might trap duff files */
+  if ( ccp4_file_seek(filein, hdrst-1, SEEK_SET) ) {
+    ccp4_signal(CCP4_ERRLEVEL(3) | CMTZ_ERRNO(CMTZERR_ReadFail),"MtzGet",NULL);
+    ccp4_parse_end(parser);
+    ccp4_file_close(filein);
+    free(filename);
+    return NULL;
+  }
+
+  /* set up base dataset in case it is in not in file */
+  iiset = 0;
+  nxtal = 1;
+  jxtalin[0]=0;
+  strcpy(projin[0],"HKL_base");
+  strcpy(crysin[0],"HKL_base");
+  nset[0] = 1;
+
+  if (debug) 
+    printf(" Start first pass \n");
+
+  strcpy(project,"dummy");
+  strcpy(crystal,"dummy");
+  ccp4_file_setmode(filein,0);
+  istat = ccp4_file_readchar(filein, (uint8 *) hdrrec, MTZRECORDLENGTH);
+  if (debug) 
+    printf(" Read first header record with istat = %d \n",istat);
+  /* We don't test all reads, but this one should trap for e.g. truncated files */
+  if (istat == EOF || hdrrec[0] == '\0') {
+    ccp4_signal(CCP4_ERRLEVEL(3) | CMTZ_ERRNO(CMTZERR_ReadFail),"MtzGet",NULL);
+    ccp4_parse_end(parser);
+    ccp4_file_close(filein);
+    free(filename);
+    return NULL;
+  }
+
+  hdrrec[MTZRECORDLENGTH] = '\0';
+  ntok = ccp4_parser(hdrrec, MTZRECORDLENGTH, parser, iprint);
+  while (!ccp4_keymatch(key,"END")) {
+
+    /* read total number of columns, reflections and batches */
+    if (ccp4_keymatch(key, "NCOL")) {
+      ntotcol = (int) token[1].value;
+      nref = (int) token[2].value;
+      nbat = (int) token[3].value;
+    }
+
+    /* read total number of datasets over all projects/crystals */
+    else if (ccp4_keymatch(key, "NDIF")) {
+      ntotset = (int) token[1].value;
+      if (debug) printf(" MtzGet: NDIF is %d\n",ntotset);
+    }
+
+    /* PROJECT line. Projects are not part of data structure, but
+       may imply new crystal in hierarchy. */
+    else if (ccp4_keymatch(key, "PROJ")) {
+      ++iiset;
+      if (iiset >= MSETS) {
+        if (ccp4_liberr_verbosity(-1))
+          printf("MtzGet: Maximum number of datasets exceeded! \n");
+        ccp4_parse_end(parser);
+        ccp4_file_close(filein);
+        free(filename);
+        return NULL;
+      }
+      strcpy(project,"dummy");
+      if (ntok > 2) strcpy(project,token[2].fullstring);
+      strcpy(crystal,project);
+      jxtal = -1;
+      for (ixtal = 0; ixtal < nxtal; ++ixtal) {
+        if (strcmp(projin[ixtal],project) == 0) {
+          jxtal = ixtal;
+          jxtalin[iiset] = jxtal;
+        }
+      }
+      /* New project implies new crystal */
+      newproj=0;
+      if (jxtal == -1) {
+        ++nxtal;
+        if (nxtal > MXTALS) {
+          if (ccp4_liberr_verbosity(-1))
+            printf("MtzGet: Maximum number of crystals exceeded! \n");
+          ccp4_parse_end(parser);
+          ccp4_file_close(filein);
+          free(filename);
+          return NULL;
+        }
+        jxtalin[iiset]=nxtal-1;
+        strcpy(projin[nxtal-1],project);
+        strcpy(crysin[nxtal-1],crystal);
+        newproj=1;
+      }
+    }
+
+    /* CRYSTAL line. This will be missing in old files! 
+       If the line is present but incomplete we treat it as missing. */
+    else if (ccp4_keymatch(key, "CRYS")) {
+      if (ntok >= 3) {
+       strcpy(crystal,token[2].fullstring);
+       if (newproj == 1) {
+        strcpy(crysin[nxtal-1],crystal);
+       } else { 
+        jxtal = -1;
+        for (ixtal = 0; ixtal < nxtal; ++ixtal) {
+          if (strcmp(crysin[ixtal],crystal) == 0) {
+            jxtal = ixtal;
+            jxtalin[iiset] = jxtal;
+          }
+        }
+        if (jxtal == -1) {
+          ++nxtal;
+          if (nxtal > MXTALS) {
+            if (ccp4_liberr_verbosity(-1))
+              printf("MtzGet: Maximum number of crystals exceeded! \n");
+            ccp4_parse_end(parser);
+            ccp4_file_close(filein);
+            free(filename);
+            return NULL;
+          }
+          jxtalin[iiset]=nxtal-1;
+          strcpy(projin[nxtal-1],project);
+          strcpy(crysin[nxtal-1],crystal);
+        }
+       }
+      }
+    }
+
+    /* DATASET line. This should present for every dataset so use to
+       increment dataset count. However, if this is the base dataset,
+       don't increment as we already have it. */
+    else if (ccp4_keymatch(key, "DATA")) {
+      if ( ntok <= 2 || (ntok > 2 && strcmp(token[2].fullstring,"HKL_base")) )
+        ++nset[jxtalin[iiset]];
+    }
+
+    /* DCELL line. */
+    else if (ccp4_keymatch(key, "DCEL")) {
+      for (i = 0; i < 6; ++i) 
+        cell[i] = token[i+2].value;
+      /* If old crystal but cell dimensions differ, make new crystal.
+         This is primarily for old files with no CRYSTAL cards. 
+         This test doesn't apply to base dataset. 
+         Chosen tolerance is arbitrary - there is no single correct value! */
+      if (jxtal > 0 && iiset > 0 && 
+	  ccp4uc_cells_differ(cellin[jxtal], cell, cell_tolerance)) {
+        if (debug) {
+          printf(" MtzGet: Old crystal %d but new cell dimensions. \n",jxtal);
+          for (i = 0; i < 6; ++i) 
+            printf(" %lf %lf \n",cellin[jxtal][i],cell[i]);
+	}
+        ++nxtal;
+        if (nxtal > MXTALS) {
+          if (ccp4_liberr_verbosity(-1))
+            printf("MtzGet: Maximum number of crystals exceeded! \n");
+          ccp4_parse_end(parser);
+          ccp4_file_close(filein);
+          free(filename);
+          return NULL;
+        }
+        strcpy(projin[nxtal-1],project);
+        strcpy(crysin[nxtal-1],crystal);
+	/* Try to make crystal name unique */
+        sprintf(crysin[nxtal-1]+strlen(crystal),"%d",nxtal);
+	/* correct DATASET increment */
+        --nset[jxtalin[iiset]];
+        jxtalin[iiset]=nxtal-1;
+        ++nset[jxtalin[iiset]];
+      }
+      for (i = 0; i < 6; ++i) 
+        cellin[jxtalin[iiset]][i] = cell[i];
+    }
+
+    istat = ccp4_file_readchar(filein, (uint8 *) hdrrec, MTZRECORDLENGTH);
+    hdrrec[MTZRECORDLENGTH] = '\0';
+    ntok = ccp4_parser(hdrrec, MTZRECORDLENGTH, parser, iprint);
+  }
+
+  if (debug) {
+    printf(" MtzGet: Found %d crystals \n",nxtal);
+    for (i = 0; i < nxtal; ++i) 
+      printf(" MtzGet: Crystal %d has %d datasets \n",i+1,nset[i]);
+  }
+
+  if (debug) 
+    printf(" MtzGet: end of 1st pass \n");
+
+  /* Allocate memory for input MTZ file */
+  if (! (mtz = MtzMalloc(nxtal, nset))) {
+    ccp4_parse_end(parser);
+    ccp4_file_close(filein);
+    free(filename);
+    return NULL;
+  }
+  if (debug) 
+    printf(" MtzGet: created mtz \n");
+  mtz->filein = filein;
+  mtz->nref_filein = nref;
+  mtz->nref = nref;
+  mtz->ncol_read = ntotcol;
+  mtz->n_orig_bat = nbat;
+  mtz->batch = NULL;
+  mtz->refs_in_memory = read_refs;
+
+  /* set up base dataset in case it is in not in file */
+  nset[0] = 0;
+  for (i = 1; i < nxtal; ++i) 
+    nset[i] = -1;
+  iiset = 0;
+  strcpy(mtz->xtal[0]->pname,"HKL_base");
+  strcpy(mtz->xtal[0]->xname,"HKL_base");
+  mtz->xtal[0]->xtalid = 0;
+  mtz->xtal[0]->cell[0] = 0.0;
+  mtz->xtal[0]->set[0]->setid = 0;
+  strcpy(mtz->xtal[0]->set[0]->dname,"HKL_base");
+  mtz->xtal[0]->set[0]->wavelength = 0.0;
+
+  if (debug) 
+    printf(" MtzGet: starting 2nd pass \n");
+
+  /* 2nd Pass: Copy dataset information to MTZ structure.
+     Position at top of header */
+  ccp4_file_setmode(filein,6);
+  ccp4_file_seek(filein, hdrst-1, SEEK_SET);
+
+  /* Read dataset information */
+  ccp4_file_setmode(filein,0);
+  istat = ccp4_file_readchar(filein, (uint8 *) hdrrec, MTZRECORDLENGTH);
+  hdrrec[MTZRECORDLENGTH] = '\0';
+  ntok = ccp4_parser(hdrrec, MTZRECORDLENGTH, parser, iprint);
+  while (strncmp((strncpy(mkey,hdrrec,4)),"END",3) != 0) {
+
+    if (strncmp (mkey, "PROJ",4) == 0) {
+      ++iiset;
+      strcpy(mtz->xtal[jxtalin[iiset]]->pname,projin[jxtalin[iiset]]);
+      strcpy(mtz->xtal[jxtalin[iiset]]->xname,crysin[jxtalin[iiset]]);
+      mtz->xtal[jxtalin[iiset]]->xtalid = jxtalin[iiset] + 1;
+    }
+
+    else if (strncmp (mkey, "DATA",4) == 0) {
+      if ( ntok <= 2 || (ntok > 2 && strcmp(token[2].fullstring,"HKL_base")) ) {
+        iset = (int) token[1].value;
+        ++nset[jxtalin[iiset]];
+        /* Test that dataset exists (i.e. pointer is non-NULL) */
+        if (!mtz->xtal[jxtalin[iiset]]->set[nset[jxtalin[iiset]]]) {
+          ccp4_signal(CCP4_ERRLEVEL(3) | 
+                      CMTZ_ERRNO(CMTZERR_NullDataset),"MtzGet",NULL);
+          ccp4_parse_end(parser);
+          ccp4_file_close(filein);
+          free(filename);
+          return NULL;
+	}
+        mtz->xtal[jxtalin[iiset]]->set[nset[jxtalin[iiset]]]->setid = iset;
+        strcpy(mtz->xtal[jxtalin[iiset]]->set[nset[jxtalin[iiset]]]->dname,"dummy");
+        if (ntok > 2) strcpy(mtz->xtal[jxtalin[iiset]]->set[nset[jxtalin[iiset]]]->dname,
+                              token[2].fullstring);
+      }
+    }
+
+    else if (strncmp (mkey, "DCEL",4) == 0) {
+      for (i = 0; i < 6; ++i) 
+        mtz->xtal[jxtalin[iiset]]->cell[i] = (float) token[i+2].value;
+    }
+
+    /* this keyword not in use yet */
+    else if (strncmp (mkey, "DRES",4) == 0) {
+      for (i = 0; i < 3; ++i) {
+        indhigh[i] = (int) token[i+2].value;
+        indlow[i] = (int) token[i+5].value;
+      }
+      MtzHklcoeffs(mtz->xtal[jxtalin[iiset]]->cell, coefhkl);
+      mtz->xtal[jxtalin[iiset]]->resmax = MtzInd2reso(indhigh, coefhkl);
+      mtz->xtal[jxtalin[iiset]]->resmin = MtzInd2reso(indlow, coefhkl);
+    }
+
+    else if (strncmp (mkey, "DWAV",4) == 0) {
+      mtz->xtal[jxtalin[iiset]]->set[nset[jxtalin[iiset]]]->wavelength = (float) token[2].value;
+    }
+
+    istat = ccp4_file_readchar(filein, (uint8 *) hdrrec, MTZRECORDLENGTH);
+    hdrrec[MTZRECORDLENGTH] = '\0';
+    ntok = ccp4_parser(hdrrec, MTZRECORDLENGTH, parser, iprint);
+  }
+
+  if (debug) 
+    printf(" MtzGet: end of 2nd pass \n");
+
+  /* 3rd Pass: Position at top of header */
+  ccp4_file_setmode(filein,6);
+  ccp4_file_seek(filein, hdrst-1, SEEK_SET);
+
+  icolin = -1;
+  ccp4_file_setmode(filein,0);
+  istat = ccp4_file_readchar(filein, (uint8 *) hdrrec, MTZRECORDLENGTH);
+  hdrrec[MTZRECORDLENGTH] = '\0';
+  ntok = ccp4_parser(hdrrec, MTZRECORDLENGTH, parser, iprint);
+  while (strncmp((strncpy(mkey,hdrrec,4)),"END",3) != 0) {
+
+    if (debug) 
+      printf(" MtzGet: header line %s \n",hdrrec);
+
+    if (strncmp (mkey, "VERS",4) == 0) {
+      if (atoi(hdrrec+10) != MTZ_MAJOR_VERSN) {
+         if (ccp4_liberr_verbosity(-1))
+           printf("Input MTZ file has major version %d and minor version %d \n",
+	       atoi(hdrrec+10),atoi(hdrrec+12));
+         ccp4_signal(CCP4_ERRLEVEL(3) | CMTZ_ERRNO(CMTZERR_BadVersion),"MtzGet",NULL);
+         ccp4_parse_end(parser);
+         ccp4_file_close(filein);
+         free(filename);
+         return(NULL);
+         }  
+      if (atoi(hdrrec+12) != MTZ_MINOR_VERSN) {
+         if (ccp4_liberr_verbosity(-1))
+           printf("Input MTZ file has major version %d and minor version %d \n",
+	       atoi(hdrrec+10),atoi(hdrrec+12));
+         ccp4_signal(CCP4_ERRLEVEL(2) | CMTZ_ERRNO(CMTZERR_DifferentVersion),"MtzGet",NULL);
+         }  
+       }
+    else if (strncmp (mkey, "TITL",4) == 0) {
+       strncpy(mtz->title,hdrrec+6,70); 
+       length = 70;
+       while ((--length >= 0) && (mtz->title[length] == ' '));
+       mtz->title[length+1] = '\0';
+       }
+
+    else if (strncmp (mkey, "CELL",4) == 0) {
+      for (i = 0; i < 6; ++i) 
+        totcell[i] = (float) token[i+1].value;
+      for (i = 0; i < mtz->nxtal; ++i) {
+        if (mtz->xtal[i]->cell[0] < 0.01) {
+          mtz->xtal[i]->cell[0] = totcell[0];
+          mtz->xtal[i]->cell[1] = totcell[1];
+          mtz->xtal[i]->cell[2] = totcell[2];
+          mtz->xtal[i]->cell[3] = totcell[3];
+          mtz->xtal[i]->cell[4] = totcell[4];
+          mtz->xtal[i]->cell[5] = totcell[5];
+        }
+      } 
+    }
+    else if (strncmp (mkey, "SORT",4) == 0) {
+      for (i = 0; i < 5; ++i) 
+        isort[i] = (int) token[i+1].value;
+    }
+    else if (strncmp (mkey, "SYMI",4) == 0) {
+      /* Check that there are enough tokens in the header record */
+      if (ntok < 7) {
+	ccp4_signal(CCP4_ERRLEVEL(3) | CMTZ_ERRNO(CMTZERR_SYMINFIncomplete),
+                        "MtzGet", NULL);
+        ccp4_parse_end(parser);
+        ccp4_file_close(filein);
+        free(filename);
+	return(NULL);
+      }
+      mtz->mtzsymm.nsym = (int) token[1].value;
+      mtz->mtzsymm.nsymp = (int) token[2].value;
+      mtz->mtzsymm.symtyp = token[3].fullstring[0];
+      mtz->mtzsymm.spcgrp = (int) token[4].value;
+      strcpy(mtz->mtzsymm.spcgrpname,token[5].fullstring);
+      strcpy(mtz->mtzsymm.pgname,token[6].fullstring);
+       }
+    else if (strncmp (mkey, "SYMM",4) == 0) {
+      symop_to_mat4(hdrrec+4,hdrrec+MTZRECORDLENGTH,mtz->mtzsymm.sym[isym++][0]);
+       }
+
+    else if (strncmp (mkey, "COLU",4) == 0) {
+      /* Check that there are enough tokens in the header record */
+      if (ntok < 5) {
+	ccp4_signal(CCP4_ERRLEVEL(3) | CMTZ_ERRNO(CMTZERR_COLUMNIncomplete),
+                        "MtzGet", NULL);
+        ccp4_parse_end(parser);
+        ccp4_file_close(filein);
+        free(filename);
+	return(NULL);
+      }
+      ++icolin;
+      if (icolin >= MCOLUMNS) {
+        if (ccp4_liberr_verbosity(-1))
+          printf("MtzGet: Maximum number of columns exceeded! \n");
+        ccp4_parse_end(parser);
+        ccp4_file_close(filein);
+        free(filename);
+        return NULL;
+      }
+      strcpy(label,token[1].fullstring);
+      strcpy(type,token[2].fullstring);
+      min = (float) token[3].value;
+      max = (float) token[4].value;
+      /* Dataset id for this column
+	 Very old MTZ files may not have this value */
+      if (ntok < 6) {
+        if (!cset_warn) {
+          if (ccp4_liberr_verbosity(-1)) {
+            printf("Dataset id missing from COLUMN records in MTZ header. \n");
+            printf("Making default assignments. \n");
+	  }
+          ccp4_signal(CCP4_ERRLEVEL(2) | CMTZ_ERRNO(CMTZERR_DatasetIncomplete),
+                        "MtzGet", NULL);
+          cset_warn = 1;
+	}
+	icset = 0;
+      } else {
+	icset = (int) token[5].value;
+      }
+      /* Special trap for M/ISYM */
+      if (type[0] == 'Y' && strncmp (label,"M/ISYM",6) == 0)
+        strcpy(label,"M_ISYM");
+      /* Find dataset corresponding to this column */
+      ixtal = 0; iset = 0;
+      for (i = 0; i < mtz->nxtal; ++i) {
+       for (j = 0; j < mtz->xtal[i]->nset; ++j) {
+        if (mtz->xtal[i]->set[j]->setid == icset) {
+          ixtal = i;
+          iset = j;
+          break;
+        }
+       }
+      }
+
+      /* Create column. */
+      newcol = MtzAddColumn(mtz, mtz->xtal[ixtal]->set[iset], label, type);
+      newcol->source = icolin + 1;
+      newcol->min = min;
+      newcol->max = max;
+      colin[icolin] = newcol;
+    }
+
+    else if (strncmp (mkey, "VALM",4) == 0) {
+      strcpy(keyarg,token[1].fullstring);
+      if (strncmp (keyarg, "NAN",3) == 0) {
+        sprintf(mtz->mnf.amnf,"NAN");
+      } else {
+	mtz->mnf.fmnf = (float) token[1].value;
+      }
+    }
+
+    else if (strncmp (mkey, "RESO",4) == 0) {
+      minres = (float) token[1].value;
+      maxres = (float) token[2].value;
+      for (i = 0; i < mtz->nxtal; ++i) {
+        if (mtz->xtal[i]->resmax == 0.0)
+          mtz->xtal[i]->resmax = maxres;
+        if (mtz->xtal[i]->resmin == 100.0)
+          mtz->xtal[i]->resmin = minres;
+      }
+    }
+
+    istat = ccp4_file_readchar(filein, (uint8 *) hdrrec, MTZRECORDLENGTH);
+    hdrrec[MTZRECORDLENGTH] = '\0';
+    ntok = ccp4_parser(hdrrec, MTZRECORDLENGTH, parser, iprint);
+  }
+
+  /* copy sort order */
+  for (i = 0; i < 5; ++i) {
+    if (isort[i] > 0) 
+      mtz->order[i] = colin[isort[i]-1];
+  }
+
+  if (debug) 
+    printf(" MtzGet: end of 3rd pass \n");
+
+  /* Now read history if any */
+  istat = ccp4_file_readchar(filein, (uint8 *) hdrrec, MTZRECORDLENGTH);
+  hdrrec[MTZRECORDLENGTH] = '\0';
+  ntok = ccp4_parser(hdrrec, MTZRECORDLENGTH, parser, iprint);
+  while (!ccp4_keymatch(key,"MTZE")) {
+
+    if (ccp4_keymatch(key, "MTZH")) {
+      nhist = (int) token[1].value;
+      /* allocate memory for nhist lines */
+      mtz->hist = MtzCallocHist(nhist);
+      mtz->histlines = nhist;
+
+      for (i = 0; i < nhist; ++i) {
+        istat = ccp4_file_readchar(filein, (uint8 *) hdrrec, MTZRECORDLENGTH);
+        strncpy(mtz->hist + MTZRECORDLENGTH*i,hdrrec,MTZRECORDLENGTH);
+      }
+
+    } else if (ccp4_keymatch(key, "MTZB")) {
+      for (ibat = 0; ibat < nbat; ++ibat) {
+
+        istat = ccp4_file_readchar(filein, (uint8 *) hdrrec, MTZRECORDLENGTH);
+        hdrrec[MTZRECORDLENGTH] = '\0';
+        ntok = ccp4_parser(hdrrec, MTZRECORDLENGTH, parser, iprint);
+        if (!ccp4_keymatch(key, "BH")) {
+          ccp4_signal(CCP4_ERRLEVEL(3) | CMTZ_ERRNO(CMTZERR_BadBatchHeader),
+                        "MtzGet", NULL);
+          ccp4_parse_end(parser);
+          ccp4_file_close(filein);
+          free(filename);
+          return(NULL);
+        }
+
+	/* allocate memory for this batch */
+        if (ibat == 0) {
+          mtz->batch = MtzMallocBatch();
+          batch = mtz->batch;
+        } else {
+          batch->next = MtzMallocBatch();
+          batch = batch->next;
+        }
+        batch->next = NULL;
+        batch->num = (int) token[1].value;
+        /* nwords = (int) token[2].value; */
+        nintegers = (int) token[3].value;
+        nreals = (int) token[4].value;
+	/* read batch title */
+        istat = ccp4_file_readchar(filein, (uint8 *) hdrrec, MTZRECORDLENGTH);
+        strncpy(batch->title,hdrrec+6,70); 
+        batch->title[70]='\0';
+
+        ccp4_file_setmode(filein,6);
+        istat = ccp4_file_read(filein, (uint8 *) intbuf, nintegers);
+        ccp4_file_setmode(filein,2);
+        istat = ccp4_file_read(filein, (uint8 *) fltbuf, nreals);
+
+        MtzArrayToBatch(intbuf, fltbuf, batch);
+
+        ccp4_file_setmode(filein,0);
+	istat = ccp4_file_readchar(filein, (uint8 *) hdrrec, MTZRECORDLENGTH); 
+        hdrrec[MTZRECORDLENGTH] = '\0';
+        ntok = ccp4_parser(hdrrec, MTZRECORDLENGTH, parser, iprint);
+        if (ntok == 4) {
+          strcpy(batch->gonlab[0],token[1].fullstring); 
+          strcpy(batch->gonlab[1],token[2].fullstring); 
+          strcpy(batch->gonlab[2],token[3].fullstring); 
+          batch->gonlab[0][8] = batch->gonlab[1][8] = batch->gonlab[2][8] = '\0';
+        } else {
+          batch->gonlab[0][0] = batch->gonlab[1][0] = batch->gonlab[2][0] = '\0';
+	}
+      }
+    }
+
+    istat = ccp4_file_readchar(filein, (uint8 *) hdrrec, MTZRECORDLENGTH);
+    hdrrec[MTZRECORDLENGTH] = '\0';
+    ntok = ccp4_parser(hdrrec, MTZRECORDLENGTH, parser, iprint);
+  }
+
+  /* Finished with the parser array */
+  ccp4_parse_end(parser);
+
+  if (debug) 
+    printf(" MtzGet: end of batch pass \n");
+
+  /* Position at start of reflections */
+  ccp4_file_setmode(filein,6);
+  ccp4_file_seek(filein, SIZE1, SEEK_SET);
+
+  if (read_refs) {
+
+    refldata = (float *) ccp4_utils_malloc(ntotcol*sizeof(float));
+    /* Read all reflections into memory - make this optional? */
+    for (i = 0; i < mtz->nref_filein; ++i) {
+      MtzRrefl(filein, ntotcol, refldata);
+      for (j = 0; j < ntotcol; ++j)
+        colin[j]->ref[i] = refldata[j];
+    }
+    free(refldata);
+
+    /* Recalculate resolution limits */
+
+    /* Find dataset of indices */
+    MtzFindInd(mtz,&ind_xtal,&ind_set,ind_col);
+
+    for (i = 0; i < mtz->nxtal; ++i) {
+      MtzHklcoeffs(mtz->xtal[i]->cell, coefhkl);
+      for (j = 0; j < mtz->nref; ++j) {
+        indhigh[0] = (int) mtz->xtal[ind_xtal]->set[ind_set]->col[ind_col[0]]->ref[j];
+        indhigh[1] = (int) mtz->xtal[ind_xtal]->set[ind_set]->col[ind_col[1]]->ref[j];
+        indhigh[2] = (int) mtz->xtal[ind_xtal]->set[ind_set]->col[ind_col[2]]->ref[j];
+        maxres = MtzInd2reso(indhigh, coefhkl);
+        if (maxres > mtz->xtal[i]->resmax) mtz->xtal[i]->resmax = maxres;
+        if (maxres < mtz->xtal[i]->resmin) mtz->xtal[i]->resmin = maxres;
+      }
+    }
+
+    /* And close the mtz file: */
+    ccp4_file_close(filein);
+    mtz->filein = NULL;
+  }
+
+  free(filename); 
+
+  return(mtz);}
+
+int MtzArrayToBatch(const int *intbuf, const float *fltbuf, MTZBAT *batch)
+
+{  int i;
+
+  batch->iortyp = intbuf[3];
+  for (i = 0; i < 6; ++i)
+    batch->lbcell[i] = intbuf[4 + i];
+  batch->misflg = intbuf[10];
+  batch->jumpax = intbuf[11];
+  batch->ncryst = intbuf[12];
+  batch->lcrflg = intbuf[13];
+  batch->ldtype = intbuf[14];
+  batch->jsaxs = intbuf[15];
+  batch->nbscal = intbuf[16];
+  batch->ngonax = intbuf[17];
+  batch->lbmflg = intbuf[18];
+  batch->ndet = intbuf[19];
+  batch->nbsetid = intbuf[20];
+
+  for (i = 0; i < 6; ++i)
+    batch->cell[i] = fltbuf[i];
+  for (i = 0; i < 9; ++i)
+    batch->umat[i] = fltbuf[6 + i];
+  for (i = 0; i < 3; ++i) 
+    batch->phixyz[0][i] = fltbuf[15 + i];
+  for (i = 0; i < 3; ++i) 
+    batch->phixyz[1][i] = fltbuf[18 + i];
+  for (i = 0; i < 12; ++i) 
+    batch->crydat[i] = fltbuf[21 + i];
+  for (i = 0; i < 3; ++i) 
+    batch->datum[i] = fltbuf[33 + i];
+  batch->phistt = fltbuf[36];
+  batch->phiend = fltbuf[37];
+  for (i = 0; i < 3; ++i) 
+    batch->scanax[i] = fltbuf[38 + i];
+  batch->time1 = fltbuf[41];
+  batch->time2 = fltbuf[42];
+  batch->bscale = fltbuf[43];
+  batch->bbfac = fltbuf[44];
+  batch->sdbscale = fltbuf[45];
+  batch->sdbfac = fltbuf[46];
+  batch->phirange = fltbuf[47];
+  for (i = 0; i < 3; ++i)
+    batch->e1[i] = fltbuf[59 + i];
+  for (i = 0; i < 3; ++i)
+    batch->e2[i] = fltbuf[62 + i];
+  for (i = 0; i < 3; ++i)
+    batch->e3[i] = fltbuf[65 + i];
+  for (i = 0; i < 3; ++i)
+    batch->source[i] = fltbuf[80 + i];
+  for (i = 0; i < 3; ++i)
+    batch->so[i] = fltbuf[83 + i];
+  batch->alambd = fltbuf[86];
+  batch->delamb = fltbuf[87];
+  batch->delcor = fltbuf[88];
+  batch->divhd = fltbuf[89];
+  batch->divvd = fltbuf[90];
+  for (i = 0; i < 2; ++i)
+  { batch->dx[i] = fltbuf[111 + (i * 6)];
+    batch->theta[i] = fltbuf[112 + (i * 6)];
+    batch->detlm[i][0][0] = fltbuf[113 + (i * 6)];
+    batch->detlm[i][0][1] = fltbuf[114 + (i * 6)];
+    batch->detlm[i][1][0] = fltbuf[115 + (i * 6)];
+    batch->detlm[i][1][1] = fltbuf[116 + (i * 6)];}
+
+  return 1;
+}
+
+int MtzRrefl(CCP4File *filein, int ncol, float *refldata) {
+
+  int istat;
+
+  ccp4_file_setmode(filein,2);
+  istat = ccp4_file_read(filein, (uint8 *) refldata, ncol);
+
+  /* This will return EOF if end-of-file is reached. But by then
+     you will have read the MTZ file header, so not so useful. */
+  return istat;
+}
+
+int MtzFindInd(const MTZ *mtz, int *ind_xtal, int *ind_set, int ind_col[3]) {
+
+  int i,j,k;
+
+  /* default to first 3 columns of 1st datset */
+  *ind_xtal = 0;
+  *ind_set = 0;
+  ind_col[0] = 0;
+  ind_col[1] = 1;
+  ind_col[2] = 2;  
+
+  for (i = 0; i < mtz->nxtal; ++i) 
+   for (j = 0; j < mtz->xtal[i]->nset; ++j) 
+    for (k = 0; k < mtz->xtal[i]->set[j]->ncol; ++k) {
+     if (mtz->xtal[i]->set[j]->col[k]->label[0] == 'H' &&
+         mtz->xtal[i]->set[j]->col[k]->type[0] == 'H') {
+       *ind_xtal = i;
+       *ind_set = j;
+       ind_col[0] = k;
+     }
+     if (mtz->xtal[i]->set[j]->col[k]->label[0] == 'K' &&
+         mtz->xtal[i]->set[j]->col[k]->type[0] == 'H') 
+       ind_col[1] = k;
+     if (mtz->xtal[i]->set[j]->col[k]->label[0] == 'L' &&
+         mtz->xtal[i]->set[j]->col[k]->type[0] == 'H') 
+       ind_col[2] = k;
+    }
+
+  return 1;
+}
+
+float MtzInd2reso(const int in[3], const double coefhkl[6]) {
+
+  int ih,ik,il;
+  float reso;
+
+  ih = in[0];
+  ik = in[1];
+  il = in[2];
+
+  reso = (float) 4.0 * (ih*ih*coefhkl[0] + ih*ik*coefhkl[1] + 
+             ih*il*coefhkl[2] + ik*ik*coefhkl[3] + 
+             ik*il*coefhkl[4] + il*il*coefhkl[5]);
+
+  return reso;
+
+}
+
+int MtzHklcoeffs(const float cell[6], double coefhkl[6]) {
+
+  /* generate coefhkl coefficients from given cell parameters */
+
+  int i;
+  double alpha,beta,gamma,degtorad,denom;
+  double ax,bx,by,cx,cy,cz;
+  double axst,ayst,azst,byst,bzst,czst;
+
+  /* sanity clause (but there ain't no sanity clause!) */
+  for (i = 0; i < 6; ++i) 
+    coefhkl[i] = 0.0;
+  for (i = 0; i < 6; ++i)
+    if (cell[i] < 0.001) {
+      ccp4_signal(CCP4_ERRLEVEL(3) | CMTZ_ERRNO(CMTZERR_Cellerr),"MtzHklcoeffs",NULL);
+      return 0;
+    }
+
+  degtorad = atan(1.0)/45.0;
+
+  alpha = degtorad*cell[3];
+  beta = degtorad*cell[4];
+  gamma = degtorad*cell[5];
+
+  /* orthogonal frame for calculation 
+   a along x, b in x-y plane */
+
+  ax = cell[0];
+  bx = cell[1] * cos(gamma);
+  by = cell[1] * sin(gamma);
+  cx = cell[2] * cos(beta);
+  cy = (cell[1]*cell[2]*cos(alpha) - bx*cx)/by;
+  cz = sqrt(cell[2]*cell[2] - cx*cx - cy*cy);
+
+  /* find reciprocal vectors in orthogonal frame */
+
+  denom = ax*by*cz;
+  axst = 1.0/ax;
+  ayst = -bx*cz/denom;
+  azst = (bx*cy - by*cx)/denom;
+  byst = 1.0/by;
+  bzst = -ax*cy/denom;
+  czst = 1.0/cz;
+
+  coefhkl[0] = 0.25*(axst*axst + ayst*ayst + azst*azst);
+  coefhkl[1] = 0.5*(ayst*byst + azst*bzst);
+  coefhkl[2] = 0.5*(azst*czst);
+  coefhkl[3] = 0.25*(byst*byst + bzst*bzst);
+  coefhkl[4] = 0.5*(bzst*czst);
+  coefhkl[5] = 0.25*(czst*czst);
+
+  return 1;
+}
+
+int ccp4_lrtitl(const MTZ *mtz, char *title) {
+
+  int length;
+
+  length = (int) strlen(strcpy(title, mtz->title));
+  if (length > 0) {
+    while ((--length >= 0) && (title[length] == ' '));
+    ++length;
+  }
+  return(length);
+}
+
+int ccp4_lrhist(const MTZ *mtz, char history[][MTZRECORDLENGTH], int nlines) {
+
+  int i,nhist;
+
+  if (nlines < mtz->histlines)
+    nhist = nlines;
+  else
+    nhist = mtz->histlines;
+
+  for (i = 0; i < nhist; ++i) {
+    strncpy(history[i],mtz->hist + MTZRECORDLENGTH*i,MTZRECORDLENGTH);
+  }
+
+  return nhist;
+}
+
+int ccp4_lrsort(const MTZ *mtz, int isort[5]) {
+
+  int i,j,k,l,icol;
+
+  icol = 0;
+  for (i = 0; i < 5; ++i) 
+    isort[i] = 0;
+  /* Loop over crystals */
+  for (i = 0; i < mtz->nxtal; ++i) {
+    /* Loop over datasets for each crystal */
+    for (j = 0; j < mtz->xtal[i]->nset; ++j) {
+      /* Loop over columns for each dataset */
+      for (k = 0; k < mtz->xtal[i]->set[j]->ncol; ++k) {
+        ++icol;
+        for (l = 0; l < 5; ++l) {
+          if (mtz->order[l] == mtz->xtal[i]->set[j]->col[k])
+            isort[l] = icol;
+        }
+      }
+    }
+  }
+
+  return 1;
+}
+
+int ccp4_lrbats(const MTZ *mtz, int *nbatx, int batchx[]) {
+
+  int i=0;
+  MTZBAT *batch;
+
+  *nbatx = mtz->n_orig_bat;
+  batch = mtz->batch;
+  while (batch != NULL) {
+    batchx[i++] = batch->num;
+    batch = batch->next;
+  }
+
+  return i;
+}
+
+void MtzDebugHierarchy(const MTZ *mtz) {
+
+  int i,j,k;
+
+  if (mtz->filein)
+    printf("MtzDebugHierarchy: input file = %s \n",mtz->filein->name);
+  if (mtz->fileout)
+    printf("MtzDebugHierarchy: output file = %s \n",mtz->fileout->name);
+
+  printf("MtzDebugHierarchy: nxtal = %d \n",mtz->nxtal);
+  for (i = 0; i < mtz->nxtal; ++i) {
+   printf("MtzDebugHierarchy: xtal = %s, cell = %f %f %f %f %f %f \n",
+          mtz->xtal[i]->xname,
+	  mtz->xtal[i]->cell[0],mtz->xtal[i]->cell[1],mtz->xtal[i]->cell[2],
+	  mtz->xtal[i]->cell[3],mtz->xtal[i]->cell[4],mtz->xtal[i]->cell[5]);
+   printf("MtzDebugHierarchy: xtal = %s, nset = %d \n",mtz->xtal[i]->xname,
+              mtz->xtal[i]->nset);
+   for (j = 0; j < mtz->xtal[i]->nset; ++j) {
+    printf("MtzDebugHierarchy: xtal = %s, set = %s, setid = %d, ncol = %d \n",
+              mtz->xtal[i]->xname,mtz->xtal[i]->set[j]->dname,
+              mtz->xtal[i]->set[j]->setid,mtz->xtal[i]->set[j]->ncol);
+     for (k = 0; k < mtz->xtal[i]->set[j]->ncol; ++k) {
+      printf("MtzDebugHierarchy: col = %s (in: %d) (out: %d) \n",
+              mtz->xtal[i]->set[j]->col[k]->label,
+              mtz->xtal[i]->set[j]->col[k]->source,
+              mtz->xtal[i]->set[j]->col[k]->active);
+     }
+   }
+  }
+
+}
+
+/* List of column information: label, type, dataset.
+   Returns number of columns in current structure. */
+int MtzListColumn(const MTZ *mtz, char clabs[][31], char ctyps[][3], int csetid[]) {
+
+ int i,j,k,icol=0;
+
+ /* Loop over crystals */
+   for (i = 0; i < mtz->nxtal; ++i) {
+ /* Loop over datasets for each crystal */
+    for (j = 0; j < mtz->xtal[i]->nset; ++j) {
+ /* Loop over columns for each dataset */
+     for (k = 0; k < mtz->xtal[i]->set[j]->ncol; ++k) {
+       if (strcmp(mtz->xtal[i]->set[j]->col[k]->type,"Y") == 0 && 
+           strcmp(mtz->xtal[i]->set[j]->col[k]->label,"M_ISYM") == 0) {
+         strcpy(clabs[icol],"M/ISYM");
+       } else {
+         strcpy(clabs[icol],mtz->xtal[i]->set[j]->col[k]->label);
+       }
+       strcpy(ctyps[icol],mtz->xtal[i]->set[j]->col[k]->type);
+       csetid[icol] = mtz->xtal[i]->set[j]->setid;
+       ++icol;
+     }
+    }
+   }
+   return icol;
+}
+
+/* List of column information from input file: label, type, dataset.
+   Returns number of columns in input file. */
+int MtzListInputColumn(const MTZ *mtz, char clabs[][31], char ctyps[][3], int csetid[]) {
+
+ int i,j,k,colin,icol=0;
+
+ /* Loop over crystals */
+   for (i = 0; i < mtz->nxtal; ++i) {
+ /* Loop over datasets for each crystal */
+    for (j = 0; j < mtz->xtal[i]->nset; ++j) {
+ /* Loop over columns for each dataset */
+     for (k = 0; k < mtz->xtal[i]->set[j]->ncol; ++k) {
+      if (colin = mtz->xtal[i]->set[j]->col[k]->source) {
+       if (strcmp(mtz->xtal[i]->set[j]->col[k]->type,"Y") == 0 && 
+           strcmp(mtz->xtal[i]->set[j]->col[k]->label,"M_ISYM") == 0) {
+         strcpy(clabs[colin - 1],"M/ISYM");
+       } else {
+         strcpy(clabs[colin - 1],mtz->xtal[i]->set[j]->col[k]->label);
+       }
+       strcpy(ctyps[colin - 1],mtz->xtal[i]->set[j]->col[k]->type);
+       csetid[colin - 1] = mtz->xtal[i]->set[j]->setid;
+       ++icol;
+      }
+     }
+    }
+   }
+   return icol;
+}
+
+int ccp4_lrcell(const MTZXTAL *xtl, float cell[]) {
+
+  int i;
+
+  for (i = 0; i < 6; ++i) {
+    cell[i] = xtl->cell[i];
+  }
+ 
+  return 1;
+}
+
+int MtzResLimits(const MTZ *mtz, float *minres, float *maxres) {
+
+  int i;
+
+  *maxres = 0.0;
+  *minres = 100.0;
+ /* Loop over crystals */
+  for (i = 0; i < mtz->nxtal; ++i) {
+    if (mtz->xtal[i]->resmax > *maxres) *maxres = mtz->xtal[i]->resmax;
+    if (mtz->xtal[i]->resmin < *minres) *minres = mtz->xtal[i]->resmin;
+  }
+
+  return 1;
+}
+
+int ccp4_lrsymi(const MTZ *mtz, int *nsympx, char *ltypex, int *nspgrx, 
+       char *spgrnx, char *pgnamx) {
+
+  *nsympx = mtz->mtzsymm.nsymp;
+  *nspgrx = mtz->mtzsymm.spcgrp;
+  ltypex[0] = mtz->mtzsymm.symtyp;
+  ltypex[1] = '\0';
+  strcpy(spgrnx,mtz->mtzsymm.spcgrpname);
+  strcpy(pgnamx,mtz->mtzsymm.pgname);
+
+  return *nspgrx;
+}
+
+int MtzSpacegroupNumber(const MTZ *mtz)
+/* get the spacegroup number (likely CCP4 convention) */
+{
+  if (!mtz) return 0;
+  return mtz->mtzsymm.spcgrp;
+}
+
+int ccp4_lrsymm(const MTZ *mtz, int *nsymx, float rsymx[192][4][4]) {
+
+  int i,j,k;
+
+  *nsymx = mtz->mtzsymm.nsym;
+  for (i = 0; i < *nsymx; ++i) {
+    for (j = 0; j < 4; ++j) {
+      for (k = 0; k < 4; ++k) {
+        rsymx[i][j][k] = mtz->mtzsymm.sym[i][j][k];
+      }
+    }
+  }
+
+  return *nsymx;
+}
+
+int MtzParseLabin(char *labin_line, const char prog_labels[][31], 
+            const int nlprgi, char user_labels[][2][31]) 
+ 
+{ int i,j,imatch,nlabels=0,err=0;
+  char label1[31],label2[31];
+
+  /* For cparser */
+  CCP4PARSERARRAY *parser=NULL;
+  CCP4PARSERTOKEN *token=NULL;
+  char *key;
+  int ntok,iprint=0;
+
+  parser = ccp4_parse_start(strlen(labin_line));
+  if (parser == NULL) {
+    ccp4_signal(CCP4_ERRLEVEL(3) | CMTZ_ERRNO(CMTZERR_ParserFail),"MtzParseLabin",NULL);
+    return -1;
+  }
+  /* Set some convenient pointers to members of the parser array */
+  key   = parser->keyword;
+  token = parser->token;
+
+  ntok = ccp4_parser(labin_line, strlen(labin_line), parser, iprint);
+
+  if (ccp4_keymatch(key,"LABI")) {
+    if (iprint) printf("Interpreting LABIN line.\n");
+  } else if (ccp4_keymatch(key,"LABO")) {
+    if (iprint) printf("Interpreting LABOUT line.\n");
+  } else if (ccp4_keymatch(key,"COMP")) {
+    if (iprint) printf("Interpreting COMPLETE line (freerflag).\n");
+  } else {
+    printf("Warning in MtzParseLabin: Input is not LABIN or LABOUT line !!\n");
+  }
+
+  /* initialise user labels */
+  for (j = 0; j < nlprgi; ++j) {
+    strcpy(user_labels[j][0],"");
+    strcpy(user_labels[j][1],"");
+  }
+
+  for (i = 1; i < ntok; i += 2) {
+    strcpy(label1,token[i].fullstring);
+    /* Trap against trying to access tokens that don't exist */
+    if (i+1 < ntok) {
+      strcpy(label2,token[i+1].fullstring);
+
+      /* check first label against program labels */
+      imatch = 0;
+      for (j = 0; j < nlprgi; ++j) {
+	if (strcmp(label1,prog_labels[j]) == 0) {
+	  strcpy(user_labels[j][0],label1);
+	  strcpy(user_labels[j][1],label2);
+	  imatch = 1;
+	  ++nlabels;
+	  break;
+	}
+      }
+ 
+      if (imatch == 0) {
+	/* check second label against program labels */
+	for (j = 0; j < nlprgi; ++j) {
+	  if (strcmp(label2,prog_labels[j]) == 0) {
+	    strcpy(user_labels[j][0],label2);
+	    strcpy(user_labels[j][1],label1);
+	    imatch = 1;
+	    ++nlabels;
+	    break;
+	  }
+	}
+      }
+    } else {
+      printf("MtzParseLabin: run out of labels trying to match \"%s\"\n",label1);
+      /* Stop here - there are no more labels to process */
+      err++;
+      break;
+    }
+
+    if (imatch == 0) {
+      /* no match */
+      printf("MtzParseLabin: neither label recognised: %s %s \n",label1,label2);
+      err++;
+    }
+  }
+
+  /* Finished with the parser array */
+  ccp4_parse_end(parser);
+
+  return err ? -1 : nlabels;
+}
+
+MTZCOL **ccp4_lrassn(const MTZ *mtz, const char labels[][31], const int nlabels, 
+             char types[][3]) 
+{
+  int ilab;
+  char label[31];
+  MTZCOL *col, **lookup;
+
+  lookup = (MTZCOL **) ccp4_utils_malloc(nlabels*sizeof(MTZCOL *));
+
+ /* Loop over labels */
+   for (ilab = 0; ilab < nlabels; ++ilab) {
+
+     strcpy(label,labels[ilab]);
+     /* column not assigned */
+     if (label[0] == '\0') {
+       lookup[ilab] = NULL;
+     } else {
+       /* Special trap for M/ISYM */
+       if (strcmp(types[ilab],"Y") == 0 && strcmp(label,"M/ISYM") == 0)
+         strcpy(label,"M_ISYM");
+       col = MtzColLookup(mtz,label);
+       if (col != NULL) {
+
+	 /* if requested type is blank, return actual type */
+         if (!strcmp(types[ilab],"")) {
+           if (strcmp(col->type,"")) {
+             strcpy(types[ilab],col->type);
+	   } else {
+             strcpy(types[ilab],"R");
+	   }
+
+	 /* check requested column type against file type. */
+	 } else if (strncmp(col->type,types[ilab],1)) {
+           printf("From ccp4_lrassn: expected type %s does not match file type %s for column %s\n", 
+             types[ilab],col->type,col->label);
+           if (!strcmp(types[ilab],"R") || !strcmp(types[ilab],"I"))
+             printf("(This may be intended for generic types R/I.) \n");
+	 }
+       }
+
+       lookup[ilab] = col;
+     }
+   }
+
+   return lookup;
+}
+
+int ccp4_lridx(const MTZ *mtz, const MTZSET *set, char crystal_name[64], 
+            char dataset_name[64], char project_name[64], int *isets, 
+            float datcell[6], float *datwave)
+{
+  int i;
+  MTZXTAL *xtl;
+
+  /* find which crystal this dataset  belongs to */
+  xtl = MtzSetXtal(mtz, set);
+
+  /* copy crystal and dataset information */
+  strncpy(crystal_name,xtl->xname,63);
+  crystal_name[63] = '\0';
+  strncpy(dataset_name,set->dname,63);
+  dataset_name[63] = '\0';
+  strncpy(project_name,xtl->pname,63);
+  project_name[63] = '\0';
+  *isets = set->setid;
+  for (i = 0; i < 6; ++i)
+     datcell[i] = xtl->cell[i];
+  *datwave = set->wavelength;
+
+  return 1;
+}
+
+/* Return MTZ record in file order */
+int ccp4_lrrefl(const MTZ *mtz, float *resol, float adata[], int logmss[], int iref) {
+
+  int i,j,k;
+  int ind[3],ixtal;
+  unsigned int colin;
+  float *refldata;
+  double coefhkl[6];
+
+  /* If we are past the last reflection, indicate this with return value. */
+  if (iref > mtz->nref_filein) 
+    return 1;
+
+  /* If reflections not in memory, read next record from file. */
+  if (!mtz->refs_in_memory) {
+    refldata = (float *) ccp4_utils_malloc(mtz->ncol_read*sizeof(float));
+    if (MtzRrefl( mtz->filein, mtz->ncol_read, refldata) == EOF) {
+      free(refldata);
+      return 1;
+    }
+  }
+
+ /* Loop over all columns in the MTZ struct, and select those which
+    derive from the input file. */
+  for (i = 0; i < mtz->nxtal; ++i) {
+    for (j = 0; j < mtz->xtal[i]->nset; ++j) {
+     for (k = 0; k < mtz->xtal[i]->set[j]->ncol; ++k) {
+       if (colin = mtz->xtal[i]->set[j]->col[k]->source) {
+         if (mtz->refs_in_memory) {
+           adata[colin - 1] = mtz->xtal[i]->set[j]->col[k]->ref[iref-1];
+         } else {
+           adata[colin - 1] = refldata[colin - 1];
+	 }
+         logmss[colin - 1] = ccp4_ismnf(mtz, adata[colin - 1]);
+         if (mtz->xtal[i]->set[j]->col[k]->type[0] == 'H') {
+           if (strcmp(mtz->xtal[i]->set[j]->col[k]->label,"H") == 0)
+             ind[0] = (int) adata[colin - 1];
+           if (strcmp(mtz->xtal[i]->set[j]->col[k]->label,"K") == 0)
+             ind[1] = (int) adata[colin - 1];
+           if (strcmp(mtz->xtal[i]->set[j]->col[k]->label,"L") == 0)
+             ind[2] = (int) adata[colin - 1];
+	 }
+       }
+     }
+    }
+  }
+
+  /* calculate resolution of this reflection, based on cell of 
+     first crystal with non-zero cell dimensions */
+  for (ixtal = 0; ixtal < mtz->nxtal; ++ixtal)
+   if (mtz->xtal[ixtal]->cell[0] > 0.001) {
+     MtzHklcoeffs(mtz->xtal[ixtal]->cell, coefhkl);
+     break;
+   }
+  *resol = MtzInd2reso(ind, coefhkl);
+  /* kludge taken from mtzlib.f */
+  if (*resol > mtz->xtal[ixtal]->resmax) *resol = mtz->xtal[ixtal]->resmax;
+  if (*resol < mtz->xtal[ixtal]->resmin) *resol = mtz->xtal[ixtal]->resmin;
+
+  free(refldata);
+  return 0;
+}
+
+/* Return MTZ record in lookup order */
+int ccp4_lrreff(const MTZ *mtz, float *resol, float adata[], int logmss[],
+   const MTZCOL *lookup[], const int ncols, const int iref) {
+
+  int icol,l;
+  int ind[3],ixtal,ind_xtal,ind_set,ind_col[3];
+  unsigned int colin;
+  float *refldata;
+  double coefhkl[6];
+  union float_uint_uchar uf;
+
+  /* If we are past the last reflection, indicate this with return value. */
+  if (iref > mtz->nref_filein) 
+    return 1;
+
+  /* If reflections not in memory, read next record from file. */
+  if (!mtz->refs_in_memory) {
+    refldata = (float *) ccp4_utils_malloc(mtz->ncol_read*sizeof(float));
+    if (MtzRrefl( mtz->filein, mtz->ncol_read, refldata) == EOF) {
+      free(refldata);
+      return 1;
+    }
+  }
+
+  if (strncmp (mtz->mnf.amnf,"NAN",3) == 0) {
+    uf = ccp4_nan();
+  } else {
+    uf.f = mtz->mnf.fmnf;
+  }
+
+  /* loop over columns requested in lookup array. */
+  for (icol=0; icol < ncols; icol++) {
+    logmss[icol] = 1;
+    if (lookup[icol]) {
+      if (mtz->refs_in_memory) {
+        adata[icol] = lookup[icol]->ref[iref-1];
+        logmss[icol] = ccp4_ismnf(mtz, adata[icol]);
+      } else {
+         if (colin = lookup[icol]->source) {
+           adata[icol] = refldata[colin - 1];
+           logmss[icol] = ccp4_ismnf(mtz, adata[icol]);
+	 } else {
+           adata[icol] = uf.f;
+           logmss[icol] = 1;
+	 }
+      }
+    }
+  }
+
+  /* Check if HKL are first 3 columns */
+  if (lookup[0]->type[0] == 'H' && lookup[1]->type[0] == 'H' && 
+      lookup[2]->type[0] == 'H') {
+    ind[0] = (int) adata[0];
+    ind[1] = (int) adata[1];
+    ind[2] = (int) adata[2];
+  } else {
+    MtzFindInd(mtz,&ind_xtal,&ind_set,ind_col);
+    for (l = 0; l < ncols; ++l) {
+      if (lookup[l] == mtz->xtal[ind_xtal]->set[ind_set]->col[ind_col[0]])
+        ind[0] = (int) adata[l];
+      if (lookup[l] == mtz->xtal[ind_xtal]->set[ind_set]->col[ind_col[1]])
+        ind[1] = (int) adata[l];
+      if (lookup[l] == mtz->xtal[ind_xtal]->set[ind_set]->col[ind_col[2]])
+        ind[2] = (int) adata[l];
+    }
+  }
+
+  /* calculate resolution of this reflection, based on cell of 
+     first crystal with non-zero cell dimensions */
+  for (ixtal = 0; ixtal < mtz->nxtal; ++ixtal)
+   if (mtz->xtal[ixtal]->cell[0] > 0.001) {
+     MtzHklcoeffs(mtz->xtal[ixtal]->cell, coefhkl);
+     break;
+   }
+  *resol = MtzInd2reso(ind, coefhkl);
+  /* kludge taken from mtzlib.f */
+  if (*resol > mtz->xtal[ixtal]->resmax) *resol = mtz->xtal[ixtal]->resmax;
+  if (*resol < mtz->xtal[ixtal]->resmin) *resol = mtz->xtal[ixtal]->resmin;
+
+  free(refldata);
+  return 0;
+}
+
+int ccp4_ismnf(const MTZ *mtz, const float datum) {
+
+  if (strncmp (mtz->mnf.amnf,"NAN",3) == 0) {
+    return ccp4_utils_isnan((union float_uint_uchar *) &datum);
+  } else {
+    if (datum == mtz->mnf.fmnf)
+        return 1;
+  }
+  return 0;
+}
+
+int ccp4_lhprt(const MTZ *mtz, int iprint) {
+
+  int i,j,k,numbat,isort[5],base_set_exists=0;
+  float maxres=0.0,minres=100.0;
+  char buffer[MTZRECORDLENGTH+1],symline[81];
+  MTZSET *baseset=NULL;
+
+  if (iprint <= 0) return 2;
+
+  printf(" * Title:\n\n");
+  printf(" %s\n\n",mtz->title);
+
+  if (baseset = MtzSetLookup(mtz,"HKL_base/HKL_base")) {
+    if ( MtzNumActiveColsInSet(baseset) ||
+         MtzNbatchesInSet(mtz,baseset) ) {
+      printf(" * Base dataset:\n\n");
+      printf(" %8d %s\n",baseset->setid,"HKL_base");
+      printf("          %s\n","HKL_base");
+      printf("          %s\n","HKL_base");
+      base_set_exists=1;
+    }
+  }
+
+  printf("\n * Number of Datasets = %d\n\n",MtzNumActiveSet(mtz)-base_set_exists);
+  printf(" * Dataset ID, project/crystal/dataset names, cell dimensions, wavelength:\n\n");
+ /* Loop over crystals */
+  for (i = 0; i < mtz->nxtal; ++i) {
+ /* Loop over datasets for each crystal */
+    for (j = 0; j < mtz->xtal[i]->nset; ++j) {
+      /* is this the base dataset? */
+      if (mtz->xtal[i]->set[j] == baseset) continue;
+      /* check if dataset contains any active columns */
+      if ( (MtzNumActiveColsInSet(mtz->xtal[i]->set[j]) == 0) &&
+           (MtzNbatchesInSet(mtz,mtz->xtal[i]->set[j]) == 0) ) continue;
+      printf(" %8d %s\n",mtz->xtal[i]->set[j]->setid,mtz->xtal[i]->pname);
+      printf("          %s\n",mtz->xtal[i]->xname);
+      printf("          %s\n",mtz->xtal[i]->set[j]->dname);
+      printf("          %10.4f%10.4f%10.4f%10.4f%10.4f%10.4f\n",
+        mtz->xtal[i]->cell[0],mtz->xtal[i]->cell[1],mtz->xtal[i]->cell[2],
+        mtz->xtal[i]->cell[3],mtz->xtal[i]->cell[4],mtz->xtal[i]->cell[5]);
+      printf("          %10.5f\n",mtz->xtal[i]->set[j]->wavelength);
+    }
+  }
+  printf("\n * Number of Columns = %d\n\n",MtzNumActiveCol(mtz));
+  printf(" * Number of Reflections = %d\n\n",mtz->nref);
+  if (strncmp (mtz->mnf.amnf,"NAN",3) == 0) {
+   printf(" * Missing value set to NaN in input mtz file\n\n");
+  } else {
+   printf(" * Missing value set to %f in input mtz file\n\n",mtz->mnf.fmnf);
+  }
+
+  /* if new batch headers have been written, lose the old ones */
+  if (MtzNbat(mtz) > mtz->n_orig_bat) {
+    numbat = MtzNbat(mtz) - mtz->n_orig_bat;
+  } else {
+    numbat = mtz->n_orig_bat;
+  }
+  if (numbat > 0)
+    printf(" * Number of Batches = %d\n\n",numbat);
+
+  if (iprint == 2 || iprint == 3) {
+    printf(" * HISTORY for current MTZ file :\n\n");
+    for (i = 0; i < mtz->histlines; ++i) {
+      strncpy(buffer,mtz->hist + MTZRECORDLENGTH*i,MTZRECORDLENGTH);
+      buffer[MTZRECORDLENGTH] = '\0';
+      printf(" %s\n",buffer);
+    }
+    printf("\n");
+  }
+
+  if (iprint == 1 || iprint == 2 || iprint >=4 ) {
+
+  printf(" * Column Labels :\n\n");
+ /* Loop over crystals */
+  for (i = 0; i < mtz->nxtal; ++i) {
+ /* Loop over datasets for each crystal */
+   for (j = 0; j < mtz->xtal[i]->nset; ++j) {
+ /* Loop over columns for each dataset */
+    for (k = 0; k < mtz->xtal[i]->set[j]->ncol; ++k) {
+     if (mtz->xtal[i]->set[j]->col[k]->active) {
+      if (strcmp(mtz->xtal[i]->set[j]->col[k]->type,"Y") == 0 && 
+         strcmp(mtz->xtal[i]->set[j]->col[k]->label,"M_ISYM") == 0) {
+       printf(" M/ISYM");
+      } else {
+       printf(" %s",mtz->xtal[i]->set[j]->col[k]->label);
+      }
+     }
+    }
+   }
+  }
+  printf("\n\n * Column Types :\n\n");
+ /* Loop over crystals */
+  for (i = 0; i < mtz->nxtal; ++i) {
+ /* Loop over datasets for each crystal */
+   for (j = 0; j < mtz->xtal[i]->nset; ++j) {
+ /* Loop over columns for each dataset */
+    for (k = 0; k < mtz->xtal[i]->set[j]->ncol; ++k) {
+     if (mtz->xtal[i]->set[j]->col[k]->active) 
+      printf(" %s",mtz->xtal[i]->set[j]->col[k]->type);
+    }
+   }
+  }
+  printf("\n\n * Associated datasets :\n\n");
+ /* Loop over crystals */
+  for (i = 0; i < mtz->nxtal; ++i) {
+ /* Loop over datasets for each crystal */
+   for (j = 0; j < mtz->xtal[i]->nset; ++j) {
+ /* Loop over columns for each dataset */
+    for (k = 0; k < mtz->xtal[i]->set[j]->ncol; ++k) {
+     if (mtz->xtal[i]->set[j]->col[k]->active) 
+      printf(" %d",mtz->xtal[i]->set[j]->setid);
+    }
+   }
+  }
+
+  } else if ( iprint == 3 ) {
+
+  printf(" * Column Labels, Types, Ranges [and Dataset IDs] :\n\n");
+
+  /* Loop over crystals/datasets/columns */
+  for (i = 0; i < mtz->nxtal; ++i) {
+   for (j = 0; j < mtz->xtal[i]->nset; ++j) {
+    for (k = 0; k < mtz->xtal[i]->set[j]->ncol; ++k) {
+     if (mtz->xtal[i]->set[j]->col[k]->active) 
+      if (strcmp(mtz->xtal[i]->set[j]->col[k]->type,"Y") == 0 && 
+         strcmp(mtz->xtal[i]->set[j]->col[k]->label,"M_ISYM") == 0) {
+       printf(" M/ISYM                         %2s %19.4f %19.4f %8d \n",
+         mtz->xtal[i]->set[j]->col[k]->type,
+         mtz->xtal[i]->set[j]->col[k]->min,mtz->xtal[i]->set[j]->col[k]->max,
+         mtz->xtal[i]->set[j]->setid);
+      } else {
+       printf(" %-30s %2s %19.4f %19.4f %8d \n",
+         mtz->xtal[i]->set[j]->col[k]->label,mtz->xtal[i]->set[j]->col[k]->type,
+         mtz->xtal[i]->set[j]->col[k]->min,mtz->xtal[i]->set[j]->col[k]->max,
+         mtz->xtal[i]->set[j]->setid);
+      }
+    }
+   }
+  }
+
+  }
+
+  /* write overall cell - just for scripts which grep for this */
+  printf("\n\n * Cell Dimensions : (obsolete - refer to dataset cell dimensions above)\n\n");
+  for (i = 0; i < mtz->nxtal; ++i) 
+    if (mtz->xtal[i]->cell[0] > 0.001) {
+      printf(" %9.4f %9.4f %9.4f %9.4f %9.4f %9.4f \n\n",
+        mtz->xtal[i]->cell[0],mtz->xtal[i]->cell[1],mtz->xtal[i]->cell[2],
+        mtz->xtal[i]->cell[3],mtz->xtal[i]->cell[4],mtz->xtal[i]->cell[5]);
+      break;
+    }
+
+  /* Calculate overall  resolution limits */
+  for (i = 0; i < mtz->nxtal; ++i) {
+      if (mtz->xtal[i]->resmax > maxres) maxres = mtz->xtal[i]->resmax;
+      if (mtz->xtal[i]->resmin < minres) minres = mtz->xtal[i]->resmin;
+  }
+  printf(" *  Resolution Range :\n\n");
+  if (maxres > 0.0) {
+    printf(" %10.5f %10.5f     ( %10.3f - %10.3f A )\n\n",
+       minres,maxres,1.0/sqrt(minres),1.0/sqrt(maxres));
+  } else {
+    printf("   Not set - no crystals or reflections? \n\n");
+  }
+  ccp4_lrsort(mtz, isort);
+  printf(" * Sort Order :\n\n  %5d %5d %5d %5d %5d\n\n",isort[0],isort[1],isort[2],
+       isort[3],isort[4]);
+
+  if (iprint == 3 || iprint == 4 ) {
+
+    printf(" * Number of Symmetry Operations = %d \n",mtz->mtzsymm.nsym);
+    printf(" * Number of Primitive Operations = %d \n",mtz->mtzsymm.nsymp);
+    printf(" * Space Group = %d \'%s\' \n",mtz->mtzsymm.spcgrp,mtz->mtzsymm.spcgrpname);
+    printf(" * Lattice Type = %c \n",mtz->mtzsymm.symtyp);
+    printf(" * Point Group Name = %s \n",mtz->mtzsymm.pgname);
+
+    printf("\n * Symmetry Operations : \n\n");
+    for (i = 0; i < mtz->mtzsymm.nsym; ++i) {
+      mat4_to_symop(symline,symline+80,(const float (*)[4])mtz->mtzsymm.sym[i]);
+      symline[60] = '\0';
+      printf(" Symmetry %d %s\n",i+1,symline);
+      for (j = 0; j < 4; ++j) 
+        printf(" %5.2f %5.2f %5.2f %5.2f \n",mtz->mtzsymm.sym[i][j][0],
+           mtz->mtzsymm.sym[i][j][1],mtz->mtzsymm.sym[i][j][2],
+	       mtz->mtzsymm.sym[i][j][3]);
+    }
+
+  } else {
+    printf(" * Space group = \'%s\' (number     %d)\n\n",mtz->mtzsymm.spcgrpname,
+       mtz->mtzsymm.spcgrp);
+  }
+
+  return 1;
+}
+
+int ccp4_lhprt_adv(const MTZ *mtz, int iprint) {
+
+  int i,j,k;
+  char buffer[MTZRECORDLENGTH+1];
+
+  printf(" HEADER INFORMATION FROM MTZ FILE \n\n");
+
+  printf(" * File information :\n\n");
+
+  printf("%s       %s\n",MTZTITLE,mtz->title);
+  printf("%s       %d\n",MTZSPACEGROUP,mtz->mtzsymm.spcgrp);
+  printf("%s       %d\n",MTZNUMREFLS,mtz->nref);
+  if (strncmp (mtz->mnf.amnf,"NAN",3) == 0) {
+   printf("%s       %s\n",MTZMNF,"NaN");
+  } else {
+   printf("%s       %f\n",MTZMNF,mtz->mnf.fmnf);
+  }
+  printf("%s       %s\n",MTZSORTORDER,"(not implemented)");
+
+  printf("\n * Crystals, datasets :\n");
+ /* Loop over crystals */
+  for (i = 0; i < mtz->nxtal; ++i) {
+
+    printf("\n%s       %s\n",CRYSTALXTALNAME,mtz->xtal[i]->xname);
+    printf("%s       %s\n",CRYSTALPNAME,mtz->xtal[i]->pname);
+    printf("%s       %10.4f%10.4f%10.4f%10.4f%10.4f%10.4f\n",CRYSTALCELL,
+        mtz->xtal[i]->cell[0],mtz->xtal[i]->cell[1],mtz->xtal[i]->cell[2],
+        mtz->xtal[i]->cell[3],mtz->xtal[i]->cell[4],mtz->xtal[i]->cell[5]);
+
+ /* Loop over datasets for each crystal */
+    for (j = 0; j < mtz->xtal[i]->nset; ++j) {
+      printf("\n    %s       %s\n",DATASETDNAME,mtz->xtal[i]->set[j]->dname);
+      printf("    %s       %10.5f\n",DATASETWAVELENGTH,mtz->xtal[i]->set[j]->wavelength);
+      if (mtz->xtal[i]->set[j]->ncol > 0) {
+        printf("\n        %s %s\n",COLUMNLABEL,COLUMNTYPE);
+ /* Loop over columns for each dataset */
+        for (k = 0; k < mtz->xtal[i]->set[j]->ncol; ++k) {
+          printf("                     %-31s %-3s\n",mtz->xtal[i]->set[j]->col[k]->label,
+                                       mtz->xtal[i]->set[j]->col[k]->type);
+        }
+      }
+    }
+  }
+
+  printf("\n * HISTORY for current MTZ file :\n\n");
+  for (i = 0; i < mtz->histlines; ++i) {
+    strncpy(buffer,mtz->hist + MTZRECORDLENGTH*i,MTZRECORDLENGTH);
+    buffer[MTZRECORDLENGTH] = '\0';
+    printf(" %s\n",buffer);
+  }
+
+  return 1;
+}
+
+int ccp4_lrbat(MTZBAT *batch, float *buf, char *charbuf, int iprint)
+
+{ int nwords=NBATCHWORDS,nintegers=NBATCHINTEGERS,nreals=NBATCHREALS;
+  int *intbuf = (int *) buf;
+  float *fltbuf = buf + NBATCHINTEGERS;
+
+  if (!batch) return 0;
+
+  MtzBatchToArray(batch,intbuf,fltbuf);
+  intbuf[0] = nwords;
+  intbuf[1] = nintegers;
+  intbuf[2] = nreals;
+
+  strncpy(charbuf,batch->title,70); 
+  strncpy(charbuf+70,batch->gonlab[0],8); 
+  strncpy(charbuf+78,batch->gonlab[1],8); 
+  strncpy(charbuf+86,batch->gonlab[2],8); 
+
+  if (iprint == 1) {
+    printf(" Batch number: \n %6d    %s\n",batch->num,batch->title);
+  } else if (iprint > 1) {
+    MtzPrintBatchHeader(batch);
+  }
+
+  return 1;
+}
+
+int MtzPrintBatchHeader(const MTZBAT *batch) {
+
+  int i;
+  char labtype[20],axes[5],string1[40],string2[40];
+
+  switch (batch->ldtype) {
+  case 1:
+    strcpy(labtype,"oscillation data");
+    break;
+  case 2:
+    strcpy(labtype,"area detector data");
+    break;
+  case 3:
+    strcpy(labtype,"Laue data");
+    break;
+  default:
+    strcpy(labtype,"*** unknown data type ***");
+  }
+
+  switch (batch->jumpax) {
+  case 1:
+    strcpy(axes,"a*");
+    break;
+  case 2:
+    strcpy(axes,"b*");
+    break;
+  case 3:
+    strcpy(axes,"c*");
+    break;
+  default:
+    strcpy(axes,"none");
+  }
+
+  printf(" Batch number: \n");
+  printf(" %6d    %s\n",batch->num,batch->title);
+  printf("\n %s \n\n %s %7d     %s  \n\n %s %7d\n %s %7d\n %s %7.2f %7.2f %7.2f %7.2f %7.2f %7.2f\n %s %7d %7d %7d %7d %7d %7d \n",
+	 "++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++",
+	 "Orientation data for batch",batch->num,labtype,
+	 "  Crystal number ...................",batch->ncryst,
+         "  Associated dataset ID ............",batch->nbsetid,
+         "  Cell dimensions ..................",
+         batch->cell[0],batch->cell[1],batch->cell[2],
+         batch->cell[3],batch->cell[4],batch->cell[5],
+         "  Cell fix flags ...................",
+         batch->lbcell[0],batch->lbcell[1],batch->lbcell[2],
+         batch->lbcell[3],batch->lbcell[4],batch->lbcell[5]);
+  if (!batch->misflg) {
+    strcpy(string1,"Orientation matrix U .............");
+    strcpy(string2,"    (including setting angles)    ");
+  } else {
+    strcpy(string1,"Standard orientation matrix U ....");
+    strcpy(string2,"                                  ");
+  }    
+  printf("   %s %9.4f %9.4f %9.4f \n   %s %9.4f %9.4f %9.4f \n   %s %9.4f %9.4f %9.4f \n",
+         string1,batch->umat[0],batch->umat[3],batch->umat[6],
+         string2,batch->umat[1],batch->umat[4],batch->umat[7],
+         "                                  ",batch->umat[2],batch->umat[5],batch->umat[8]);
+  if (batch->misflg == 1) {
+    printf("   %s %6.2f %6.2f %6.2f\n",
+         "Missetting angles PhiX PhiY PhiZ..",
+         batch->phixyz[0][0],batch->phixyz[0][1],batch->phixyz[0][2]);
+  } else if (batch->misflg > 1) {
+    printf("   %s %6.2f %6.2f %6.2f %6.2f %6.2f %6.2f\n",
+         "Missetting angles PhiX PhiY PhiZ..",
+         batch->phixyz[0][0],batch->phixyz[0][1],batch->phixyz[0][2],
+         batch->phixyz[1][0],batch->phixyz[1][1],batch->phixyz[1][2]);
+  }
+  printf("   %s%s%s   %s\n",
+         "Reciprocal axis nearest ",batch->gonlab[0],"..",axes);
+  if (!batch->lcrflg) {
+    printf("   %s %6.3f \n",
+	   "Mosaicity ........................",batch->crydat[0]);
+  } else {
+    printf("   %s %6.3f %6.3f \n",
+           "Mosaicity (horizontal, vertical)..",batch->crydat[0],batch->crydat[1]);
+  }
+  printf("   Datum goniostat angles (degrees)..");
+  for (i = 0; i < batch->ngonax; ++i) 
+    printf(" %8.3f",batch->datum[i]);
+  printf("\n");
+
+  if (batch->jsaxs > 0 && batch->jsaxs <= batch->ngonax) 
+    printf("   %s  %s \n",
+	 "Scan axis ........................",batch->gonlab[batch->jsaxs-1]);
+  printf("   %s %8.3f %8.3f \n   %s %8.3f \n   %s %8.2f %8.2f \n",
+	 "Start & stop Phi angles (degrees).",batch->phistt,batch->phiend,
+	 "Range of Phi angles (degrees).....",batch->phirange,
+         "Start & stop time (minutes).......",batch->time1,batch->time2);
+
+  if (batch->nbscal == 4) {
+    printf("   %s %9.4f %9.4f \n   %s %9.4f %9.4f \n",
+	   "   Batch scale & SD .................",batch->bscale,batch->sdbscale,
+	   "   Batch B-factor & SD ..............",batch->bbfac,batch->sdbfac);
+  }
+
+  printf("   %s  \n   %s %7d \n   %s %s %s %9.4f %9.4f %9.4f \n   %s %s %s %9.4f %9.4f %9.4f \n   %s %s %s %9.4f %9.4f %9.4f \n",
+         " Crystal goniostat information :-",
+	 "   Number of goniostat axes..........",batch->ngonax,
+	 "   Goniostat vectors.....",batch->gonlab[0],"....",batch->e1[0],batch->e1[1],batch->e1[2],
+	 "                    .....",batch->gonlab[1],"....",batch->e2[0],batch->e2[1],batch->e2[2],
+	 "                    .....",batch->gonlab[2],"....",batch->e3[0],batch->e3[1],batch->e3[2]);
+
+  printf("   %s \n   %s  %9.4f %9.4f %9.4f \n   %s %9.4f %9.4f %9.4f \n",
+	 " Beam information :-",
+	 "   Idealized X-ray beam vector.......",batch->source[0],batch->source[1],batch->source[2],
+	 "   X-ray beam vector with tilts......",batch->so[0],batch->so[1],batch->so[2]);
+
+  if (batch->lbmflg == 0) {
+    printf("   %s %9.5f %9.5f \n",
+           "   Wavelength and dispersion ........",batch->alambd,batch->delamb);
+  } else if (batch->lbmflg == 1) {
+    printf("   %s %9.5f %9.5f %9.5f \n   %s %7.3f %7.3f \n",
+	   "   Wavelength and dispersion ........",batch->alambd,batch->delamb,batch->delcor,
+	   "   Divergence .......................",batch->divhd,batch->divvd);
+  }
+
+  printf(" Detector information :-\n   Number of detectors...............%7d \n",batch->ndet);
+  printf("   %s%9.3f\n%s%9.3f\n%s%7.1f%7.1f%7.1f%7.1f\n",
+         "   Crystal to Detector distance (mm).",batch->dx[0],
+         "   Detector swing angle..............",batch->theta[0],
+         "   Pixel limits on detector..........",batch->detlm[0][0][0],batch->detlm[0][0][1],batch->detlm[0][1][0],batch->detlm[0][1][1]);
+  printf(" ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++\n\n");
+
+  return 1;
+}
+
+int ccp4_lwtitl(MTZ *mtz, const char *ftitle, int flag) {
+
+  int length;
+
+  if (flag == 0) {
+
+    strncpy(mtz->title,ftitle,70);
+
+  } else {
+
+    /* Append ftitle to existing title.
+       BEWARE this has been fixed a few times for special
+       cases. There is often a reaons behind numbers
+       such as 69, so don't change it lightly */
+
+    length = (int) strlen(mtz->title);
+    /* this shouldn't happen if title is NULL terminated */
+    if (length > 70) length = 70;
+    while ((--length >= 0) && mtz->title[length] == ' ');
+    /* if there is an existing title and it doesn't take
+       up all 70 chars, then add a space before appending
+       new title */
+    if (length >= 0 && length < 69)
+      mtz->title[++length] = ' ';
+    strncpy(mtz->title+length+1,ftitle,69-length);
+
+  }
+  mtz->title[70] = '\0';
+
+  return 1;
+}
+
+int MtzSetSortOrder(MTZ *mtz, MTZCOL *colsort[5]) {
+
+  int i;
+
+  for (i = 0; i < 5; ++i) 
+    mtz->order[i] = colsort[i];
+
+  return 1;
+}
+
+int MtzAddHistory(MTZ *mtz, const char history[][MTZRECORDLENGTH], const int nlines) {
+
+  int i,j,numlines=0;
+  char *newhist;
+
+  newhist = MtzCallocHist(mtz->histlines + nlines);
+  /* write new history lines */
+  for (i = 0; i < nlines; ++i) {
+   for (j = 0; j < MTZRECORDLENGTH; ++j) {
+    /* remove leading blanks and blank lines */
+    if ( *(history[i]+j) != ' ') {
+     strncpy(newhist + MTZRECORDLENGTH*i,history[i]+j,MTZRECORDLENGTH-j);
+     ++numlines;
+     break;
+    }
+   }
+  }
+  /* copy old history lines */
+  for (i = 0; i < mtz->histlines; ++i) {
+    strncpy(newhist + MTZRECORDLENGTH*numlines + MTZRECORDLENGTH*i,
+        mtz->hist + MTZRECORDLENGTH*i,MTZRECORDLENGTH);
+  }
+  MtzFreeHist(mtz->hist);
+  mtz->hist = newhist;
+  mtz->histlines += numlines;
+
+  return mtz->histlines;
+}
+
+int ccp4_lwidx(MTZ *mtz, const char crystal_name[],  const char dataset_name[],
+       const char project_name[], const float datcell[6], const float *datwave) {
+
+  MTZXTAL *xtl;
+  MTZSET *set;
+  int i;
+  char path1[200];
+
+  /* Is it a new crystal? */
+  if ((xtl = MtzXtalLookup(mtz,crystal_name)) == NULL) {
+    xtl = MtzAddXtal(mtz,crystal_name,project_name,datcell);
+    MtzAddDataset(mtz,xtl,dataset_name,*datwave);
+  } else {
+    /* Existing crystal - update parameters */
+    if (project_name && strlen(project_name) > 0) {
+      strncpy(xtl->pname,project_name,64);
+      xtl->pname[64] = '\0';
+    }
+    if (datcell[0] > 0.0)
+      for (i = 0; i < 6; ++i) 
+        xtl->cell[i] = datcell[i];
+    strcpy( path1, "/" );
+    strcat( path1, xtl->xname );
+    strcat( path1, "/" );
+    strcat( path1, dataset_name );
+    /* Is it a new dataset? */
+    if ((set = MtzSetLookup(mtz,path1)) == NULL) {
+      MtzAddDataset(mtz,xtl,dataset_name,*datwave);
+    } else {
+      if (*datwave > 0.0)
+        set->wavelength = *datwave;
+    }
+  }
+  return 1;
+}
+
+int MtzAssignHKLtoBase(MTZ *mtz)
+{
+  int i,j,k,l=0;
+  MTZSET *baseset=NULL;
+  MTZCOL *colarray[3];
+
+  /* get base dataset if it exists */
+  baseset = MtzSetLookup(mtz,"HKL_base/HKL_base");
+
+  if (baseset) {
+
+   for (i = 0; i < mtz->nxtal; ++i)
+    for (j = 0; j < mtz->xtal[i]->nset; ++j)
+     for (k = 0; k < mtz->xtal[i]->set[j]->ncol; ++k) 
+       if ( strcmp(mtz->xtal[i]->set[j]->col[k]->type,"H") == 0 ) {
+        colarray[l++] = mtz->xtal[i]->set[j]->col[k];
+        if (l == 3) goto assign;
+       }
+
+    assign:
+    for (l = 0; l < 3; ++l)
+      if (colarray[l]) MtzAssignColumn(mtz, colarray[l], "HKL_base","HKL_base");
+
+  }
+  return 1;
+}
+
+int MtzAssignColumn(MTZ *mtz, MTZCOL *col, const char crystal_name[],  
+     const char dataset_name[]) 
+{
+
+  MTZXTAL *xtl;
+  MTZSET *set, *oldset;
+  int i,j;
+  float datcell[6] = {0.0}, datwave = 0.0;
+  char path1[200], *path2;
+
+  if ( !mtz || !col || !crystal_name || !dataset_name || 
+       !strcmp(crystal_name,"") || !strcmp(dataset_name,"") )
+      ccp4_signal(CCP4_ERRLEVEL(3) | CMTZ_ERRNO(CMTZERR_ParamError),"MtzAssignColumn",NULL);
+
+  /* if column already belongs in this dataset, do nothing and return */
+  oldset = MtzColSet(mtz, col);
+  path2 = MtzSetPath(mtz, oldset);
+  strcpy( path1, "/" );
+  strcat( path1, crystal_name );
+  strcat( path1, "/" );
+  strcat( path1, dataset_name );
+  if ( MtzPathMatch( path1, path2 ) ) {
+    free (path2);
+    return 1;
+  }
+  free (path2);
+
+  /* remove column from existing set */
+  for (i = 0; i < oldset->ncol; ++i) {
+    if ( oldset->col[i] == col ) {
+      for (j = i; j < oldset->ncol - 1; ++j) 
+	oldset->col[j] = oldset->col[j+1];
+      oldset->col[oldset->ncol--] = NULL;
+      break;
+    }
+  }
+
+  /* Does the requested new dataset exist? If not, create it. */
+  if ( !(set = MtzSetLookup(mtz,path1)) ) {
+    if ( !(xtl = MtzXtalLookup(mtz,crystal_name)) ) 
+      xtl = MtzAddXtal(mtz,crystal_name,crystal_name,datcell);
+    set = MtzAddDataset(mtz,xtl,dataset_name,datwave);
+  }
+
+  /* Add column to new dataset */
+  if ( ++set->ncol > ccp4array_size(set->col))
+    ccp4array_resize(set->col, set->ncol + 9);
+  set->col[set->ncol - 1] = col;
+
+  return 1;
+}
+
+int ccp4_lwsymm(MTZ *mtz, int nsymx, int nsympx, float rsymx[192][4][4], 
+   char ltypex[], int nspgrx, char spgrnx[], char pgnamx[])
+{
+  int i,j,k,length;
+
+  mtz->mtzsymm.nsym = nsymx;
+  mtz->mtzsymm.nsymp = nsympx;
+  for (i = 0; i < nsymx; ++i) {
+    for (j = 0; j < 4; ++j) {
+      for (k = 0; k < 4; ++k) {
+        mtz->mtzsymm.sym[i][j][k] = rsymx[i][j][k];
+      }
+    }
+  }
+  mtz->mtzsymm.symtyp = ltypex[0];
+  mtz->mtzsymm.spcgrp = nspgrx;
+
+  length = ( strlen(spgrnx) < MAXSPGNAMELENGTH ) ? strlen(spgrnx) : MAXSPGNAMELENGTH;
+  strncpy(mtz->mtzsymm.spcgrpname,spgrnx,length);
+  mtz->mtzsymm.spcgrpname[length] = '\0';
+
+  strcpy(mtz->mtzsymm.pgname,pgnamx);
+
+  return 1;
+}
+
+MTZCOL **ccp4_lwassn(MTZ *mtz, const char labels[][31], const int nlabels, 
+             const char types[][3], const int iappnd) 
+{
+  int i,j,k,ilab;
+  MTZCOL *col, **lookup;
+  MTZSET *defaultset;
+
+  lookup = (MTZCOL **) ccp4_utils_malloc(nlabels*sizeof(MTZCOL *));
+
+  /* if iappnd = 0, deactivate existing columns */
+  if (iappnd == 0) {
+ /* Loop over crystals */
+   for (i = 0; i < mtz->nxtal; ++i) {
+ /* Loop over datasets for each crystal */
+    for (j = 0; j < mtz->xtal[i]->nset; ++j) {
+ /* Loop over columns for each dataset */
+     for (k = 0; k < mtz->xtal[i]->set[j]->ncol; ++k) {
+       mtz->xtal[i]->set[j]->col[k]->active = 0;
+     }
+    }
+   }
+  } 
+
+  /* new columns need to be assigned to a dataset. Set this
+     as the base dataset if it exists, else the first dataset. */
+  if ( !(defaultset = MtzSetLookup(mtz,"HKL_base/HKL_base")) )
+    defaultset = mtz->xtal[0]->set[0];
+
+  /* Loop over labels */
+  for (ilab = 0; ilab < nlabels; ++ilab) {
+    if (strcmp(types[ilab],"Y") == 0 && strcmp(labels[ilab],"M/ISYM") == 0) {
+      col = MtzColLookup(mtz,"M_ISYM");
+    } else {
+      col = MtzColLookup(mtz,labels[ilab]);
+    }
+    if (col) {
+      col->active = 1;
+      lookup[ilab] = col;
+    } else {
+      /* add new column to first dataset - MtzAssignColumn corrects this */
+      if (strcmp(types[ilab],"Y") == 0 && strcmp(labels[ilab],"M/ISYM") == 0) {
+        lookup[ilab] = MtzAddColumn(mtz, defaultset, 
+                      "M/ISYM", types[ilab]);
+      } else {
+        lookup[ilab] = MtzAddColumn(mtz, defaultset, 
+                      labels[ilab], types[ilab]);
+      }
+    }
+  }
+
+  return lookup;
+}
+
+int ccp4_lwbat(MTZ *mtz, MTZBAT *batch, const int batno, const float *buf, const char *charbuf)
+
+{  
+  int *intbuf = (int *) buf;
+  const float *fltbuf = buf + NBATCHINTEGERS;
+  char cbatch[95]=" ";
+  int i,cbatch_len;
+  MTZBAT *otherbat;
+
+  if (batch == NULL) {
+    /* add new batch at end of list */
+    batch = mtz->batch;
+    /* is this the first ever batch? */
+    if (batch == NULL) {
+      mtz->batch = MtzMallocBatch();
+      batch = mtz->batch;
+      batch->num = batno;
+      batch->next = NULL;
+    } else {
+      /* first, skip over n_orig_bat batches if some were read in */
+      for (i=0; i < mtz->n_orig_bat - 1; ++i)
+        batch = batch->next;
+      if (mtz->n_orig_bat == 0 && batch->num == batno) {
+        printf("From ccp4_lwbat: warning: attempt to add new batch with existing batch number %d!\n",batno);
+        return 0;
+      }
+      while (batch->next != NULL) {
+        batch = batch->next;
+        if (batch->num == batno) {
+          printf("From ccp4_lwbat: warning: attempt to add new batch with existing batch number %d!\n",batno);
+          return 0;
+        }
+      }
+      batch->next = MtzMallocBatch();
+      batch = batch->next;
+      batch->num = batno;
+      batch->next = NULL;
+    }
+  } else {
+    if (batch->num != batno) {
+      /* renumbering - check unique */
+      otherbat = mtz->batch;
+      while (otherbat != NULL) {
+        if (otherbat->num == batno && otherbat != batch) {
+          printf("From ccp4_lwbat: warning: attempt to change batch number to existing batch number %d!\n",batno);
+          return 0;
+        }
+        otherbat = otherbat->next;
+      }
+      batch->num = batno;
+    }
+  }
+
+  MtzArrayToBatch(intbuf,fltbuf,batch);
+
+  cbatch_len = ( strlen(charbuf) < 94 ) ? strlen(charbuf) : 94;
+  strncpy(cbatch,charbuf,cbatch_len);
+
+  strncpy(batch->title,cbatch,70); 
+  strncpy(batch->gonlab[0],cbatch+70,8); 
+  strncpy(batch->gonlab[1],cbatch+78,8); 
+  strncpy(batch->gonlab[2],cbatch+86,8); 
+  batch->gonlab[0][8] = batch->gonlab[1][8] = batch->gonlab[2][8] = '\0';
+
+  return 1;
+}
+
+int ccp4_lwbsetid(MTZ *mtz, MTZBAT *batch, const char xname[], const char dname[])
+
+{
+  MTZXTAL *xtl;
+  MTZSET *set;
+  char path1[200];
+
+  if ((xtl = MtzXtalLookup(mtz,xname)) != NULL) {
+    strcpy( path1, "/" );
+    strcat( path1, xtl->xname );
+    strcat( path1, "/" );
+    strcat( path1, dname );
+    if ((set = MtzSetLookup(mtz,path1)) != NULL) {
+      batch->nbsetid = set->setid;
+      return 1;
+    }
+  }
+
+  printf("From ccp4_lwbsetid: warning: dataset id not found!\n");
+  return 0;
+}
+
+int MtzDeleteRefl(MTZ *mtz, int iref)
+
+{
+  int i,j,k;
+
+  /* only possible if reflections in memory */
+  if (mtz->refs_in_memory) {
+    for (i = 0; i < mtz->nxtal; ++i) 
+     for (j = 0; j < mtz->xtal[i]->nset; ++j) 
+      for (k = 0; k < mtz->xtal[i]->set[j]->ncol; ++k) 
+        ccp4array_delete_ordered(mtz->xtal[i]->set[j]->col[k]->ref,iref);
+    --mtz->nref;
+  }
+
+  return 1;
+}
+
+int ccp4_lwrefl(MTZ *mtz, const float adata[], MTZCOL *lookup[], 
+           const int ncol, const int iref)
+
+{ int i,j,k,l,icol,ind[3],ind_xtal,ind_set,ind_col[3];
+  float refldata[MCOLUMNS],res;
+  double coefhkl[6];
+
+  /* if this is extra reflection, check memory for in-memory mode */
+  if (mtz->refs_in_memory && iref > mtz->nref) {
+    if (iref > ccp4array_size(lookup[0]->ref)) {
+     /* Loop over crystals */
+      for (i = 0; i < mtz->nxtal; ++i) {
+     /* Loop over datasets for each crystal */
+       for (j = 0; j < mtz->xtal[i]->nset; ++j) {
+      /* Loop over columns for each dataset */
+        for (k = 0; k < mtz->xtal[i]->set[j]->ncol; ++k) {
+         ccp4array_resize(mtz->xtal[i]->set[j]->col[k]->ref, iref);
+        }
+       }
+      }
+    }
+  }
+
+  /* update variables held in memory */
+  icol = -1;
+  for (i = 0; i < ncol; ++i) {
+    if (lookup[i]) {
+      /* update reflection for in-memory mode */
+      if (mtz->refs_in_memory) {
+        lookup[i]->ref[iref-1] = adata[i];
+      } 
+      /* update column ranges */
+      if (!ccp4_ismnf(mtz, adata[i])) {
+        if (iref == 1) {
+          lookup[i]->min = adata[i];
+          lookup[i]->max = adata[i];
+        } else {
+          if (adata[i] < lookup[i]->min) lookup[i]->min = adata[i];
+          if (adata[i] > lookup[i]->max) lookup[i]->max = adata[i];
+        }
+      }
+    }
+  }
+
+  /* write reflection for on-disk mode */
+  if (!mtz->refs_in_memory) {
+
+    icol = -1;
+    /* Loop over all active columns */
+    for (i = 0; i < mtz->nxtal; ++i) 
+     for (j = 0; j < mtz->xtal[i]->nset; ++j) 
+      for (k = 0; k < mtz->xtal[i]->set[j]->ncol; ++k) 
+        if (mtz->xtal[i]->set[j]->col[k]->active) {
+          ++icol;
+          /* for each active column, see if value to write */
+          for (l = 0; l < ncol; ++l) 
+            if (lookup[l] == mtz->xtal[i]->set[j]->col[k]) {
+              refldata[icol] = adata[l];
+	      break;
+	    }
+	}
+
+    if (MtzWrefl(mtz->fileout, icol+1, refldata) != icol+1 )
+      return 0;
+
+     /* Update resolution limits. For in-memory mode, this is done in MtzPut. */
+     /* Check if HKL are first 3 columns */
+     if (lookup[0]->type[0] == 'H' && lookup[1]->type[0] == 'H' && 
+         lookup[2]->type[0] == 'H') {
+       ind[0] = (int) adata[0];
+       ind[1] = (int) adata[1];
+       ind[2] = (int) adata[2];
+     } else {
+       MtzFindInd(mtz,&ind_xtal,&ind_set,ind_col);
+       for (l = 0; l < ncol; ++l) {
+         if (lookup[l] == mtz->xtal[ind_xtal]->set[ind_set]->col[ind_col[0]])
+           ind[0] = (int) adata[l];
+         if (lookup[l] == mtz->xtal[ind_xtal]->set[ind_set]->col[ind_col[1]])
+           ind[1] = (int) adata[l];
+         if (lookup[l] == mtz->xtal[ind_xtal]->set[ind_set]->col[ind_col[2]])
+           ind[2] = (int) adata[l];
+       }
+     }
+
+     for (i = 0; i < mtz->nxtal; ++i) {
+      if (mtz->xtal[i]->cell[0] > 0.001) {
+       MtzHklcoeffs(mtz->xtal[i]->cell, coefhkl);
+       res = MtzInd2reso(ind, coefhkl);
+       if (res > 0.0) {
+         if (res > mtz->xtal[i]->resmax) mtz->xtal[i]->resmax = res;
+         if (res < mtz->xtal[i]->resmin) mtz->xtal[i]->resmin = res;
+         if (res > mtz->resmax_out) mtz->resmax_out = res;
+         if (res < mtz->resmin_out) mtz->resmin_out = res;
+       }
+      }
+     }
+  }
+
+  /* increment nref if we are adding new reflections */
+  if (iref > mtz->nref)
+    mtz->nref = iref;
+
+  return 1;
+}
+
+int MtzPut(MTZ *mtz, const char *logname)
+
+{ char hdrrec[81],symline[81],spgname[MAXSPGNAMELENGTH+3];
+ CCP4File *fileout;
+ int i, j, k, l, hdrst, icol, numbat, isort[5], debug=0;
+ int ind[3],ind_xtal,ind_set,ind_col[3],length,glob_cell_written=0;
+ double coefhkl[6];
+ float res,refldata[MCOLUMNS];
+ int nwords=NBATCHWORDS,nintegers=NBATCHINTEGERS,nreals=NBATCHREALS;
+ float buf[NBATCHWORDS];
+ int *intbuf = (int *) buf;
+ float *fltbuf = buf + NBATCHINTEGERS;
+ MTZBAT *batch, *lastoldbatch;
+ MTZXTAL *xtl;
+
+ if (debug) 
+   printf(" MtzPut: entering \n");
+
+ if (!mtz->fileout) {
+
+   if ( !(fileout = MtzOpenForWrite(logname)) ) return 0;
+
+   if (debug) 
+     printf(" MtzPut: file opened \n");
+
+ } else {
+   fileout = mtz->fileout;
+ }
+
+ if (mtz->refs_in_memory) {
+   /* Write all reflections from memory - make this optional? */
+   for (l = 0; l < mtz->nref; ++l) {
+     icol = 0;
+   /* Loop over crystals */
+     for (i = 0; i < mtz->nxtal; ++i) {
+   /* Loop over datasets for each crystal */
+      for (j = 0; j < mtz->xtal[i]->nset; ++j) {
+   /* Loop over columns for each dataset */
+       for (k = 0; k < mtz->xtal[i]->set[j]->ncol; ++k) {
+         if (mtz->xtal[i]->set[j]->col[k]->active) {
+           refldata[icol++] = mtz->xtal[i]->set[j]->col[k]->ref[l];
+         }
+       }
+      }
+     }
+     if (MtzWrefl(fileout, icol, refldata) != icol ) return 0;
+   }
+
+   if (debug) 
+     printf(" MtzPut: reflections written \n");
+
+ }
+
+ ccp4_file_setmode(fileout,0);
+ /* Write header */
+ sprintf(hdrrec,"VERS MTZ:V%d.%d",MTZ_MAJOR_VERSN,MTZ_MINOR_VERSN);
+ /* if MTZ_MAJOR_VERSN,MTZ_MINOR_VERSN get into double figures,
+    adjust following call to MtzWhdrLine */
+ MtzWhdrLine(fileout,13,hdrrec);
+ strcpy(hdrrec,"TITLE ");
+ strncpy(hdrrec+6,mtz->title,70);
+ MtzWhdrLine(fileout,76,hdrrec);
+ /* if new batch headers have been written, lose the old ones */
+ /* mtz->n_orig_bat is original number of batches, MtzNbat(mtz) the current */
+ if (MtzNbat(mtz) == mtz->n_orig_bat) {
+   numbat = mtz->n_orig_bat;
+ } else {
+   numbat = MtzNbat(mtz) - mtz->n_orig_bat;
+ }
+ sprintf(hdrrec,"NCOL %8d %12d %8d",MtzNumActiveCol(mtz),mtz->nref,numbat);
+ MtzWhdrLine(fileout,35,hdrrec);
+ if (debug) printf(" MtzPut: NCOL just written \n");
+
+ /* Purely for backwards compatibility: output first non-zero cell as
+    global cell. Also update base dataset cell. */
+ for (i = 0; i < mtz->nxtal; ++i) {
+   if ( !strcmp(mtz->xtal[i]->xname,"HKL_base") ) continue;
+   if ( (MtzNumActiveSetsInXtal(mtz,mtz->xtal[i]) == 0) ) continue;
+   if (mtz->xtal[i]->cell[0] > 0.001) {
+     sprintf(hdrrec,"CELL  %9.4f %9.4f %9.4f %9.4f %9.4f %9.4f",mtz->xtal[i]->cell[0],
+           mtz->xtal[i]->cell[1],mtz->xtal[i]->cell[2],mtz->xtal[i]->cell[3],
+           mtz->xtal[i]->cell[4],mtz->xtal[i]->cell[5]);
+     MtzWhdrLine(fileout,65,hdrrec);
+     if (xtl = MtzXtalLookup(mtz,"HKL_base"))
+       for (j = 0; j < 6; ++j)
+         xtl->cell[j] = mtz->xtal[i]->cell[j];
+     glob_cell_written=1;
+     break;
+   }
+ }
+ /* if no suitable cell found, then try HKL_base cell */
+ if (!glob_cell_written) {
+   if (xtl = MtzXtalLookup(mtz,"HKL_base")) {
+     sprintf(hdrrec,"CELL  %9.4f %9.4f %9.4f %9.4f %9.4f %9.4f",xtl->cell[0],
+           xtl->cell[1],xtl->cell[2],xtl->cell[3],xtl->cell[4],xtl->cell[5]);
+     MtzWhdrLine(fileout,65,hdrrec);
+     glob_cell_written=1;
+   }
+ }
+ if (debug) printf(" MtzPut: CELL just written \n");
+
+ ccp4_lrsort(mtz, isort);
+ sprintf(hdrrec,"SORT  %3d %3d %3d %3d %3d",isort[0],isort[1],isort[2],
+       isort[3],isort[4]);
+ MtzWhdrLine(fileout,25,hdrrec);
+ if (debug) printf(" MtzPut: SORT just written \n");
+
+ spgname[0] = '\'';
+ length = strlen(mtz->mtzsymm.spcgrpname);
+ while ((--length >= 0) && mtz->mtzsymm.spcgrpname[length] == ' ');
+ strncpy(spgname+1,mtz->mtzsymm.spcgrpname,length+1);
+ spgname[length+2] = '\'';
+ spgname[length+3] = '\0';
+ sprintf(hdrrec,"SYMINF %3d %2d %c %5d %22s %5s",mtz->mtzsymm.nsym,mtz->mtzsymm.nsymp,
+      mtz->mtzsymm.symtyp,mtz->mtzsymm.spcgrp,spgname,mtz->mtzsymm.pgname);
+ MtzWhdrLine(fileout,50,hdrrec);
+ if (debug) printf(" MtzPut: SYMINF just written \n");
+
+ for (i = 0; i < mtz->mtzsymm.nsym; ++i) {
+     mat4_to_symop(symline,symline+74,(const float (*)[4])mtz->mtzsymm.sym[i]);
+     symline[74] = '\0';
+     sprintf(hdrrec,"SYMM %74s",symline);
+     MtzWhdrLine(fileout,79,hdrrec); 
+ }
+ if (debug) printf(" MtzPut: symmetry just written \n");
+
+ if (mtz->refs_in_memory) {
+  /* Find dataset of indices */
+   MtzFindInd(mtz,&ind_xtal,&ind_set,ind_col);
+
+  /* Recalculate crystal resolution limits */
+  for (i = 0; i < mtz->nxtal; ++i) {
+   mtz->xtal[i]->resmax = 0.0;
+   mtz->xtal[i]->resmin = 100.0;
+   MtzHklcoeffs(mtz->xtal[i]->cell, coefhkl);
+   for (j = 0; j < mtz->nref; ++j) {
+      ind[0] = (int) mtz->xtal[ind_xtal]->set[ind_set]->col[ind_col[0]]->ref[j];
+      ind[1] = (int) mtz->xtal[ind_xtal]->set[ind_set]->col[ind_col[1]]->ref[j];
+      ind[2] = (int) mtz->xtal[ind_xtal]->set[ind_set]->col[ind_col[2]]->ref[j];
+      res = MtzInd2reso(ind, coefhkl);
+      /* crystal limits */
+      if (res > 0.0) {
+        if (res > mtz->xtal[i]->resmax) mtz->xtal[i]->resmax = res;
+        if (res < mtz->xtal[i]->resmin) mtz->xtal[i]->resmin = res;
+        if (res > mtz->resmax_out) mtz->resmax_out = res;
+        if (res < mtz->resmin_out) mtz->resmin_out = res;
+      }
+   }
+  }
+ }
+ sprintf(hdrrec,"RESO %-20f %-20f",mtz->resmin_out,mtz->resmax_out);
+ MtzWhdrLine(fileout,46,hdrrec);
+
+ if (debug) 
+   printf(" MtzPut: resolution limts just written \n");
+
+ if (strncmp (mtz->mnf.amnf,"NAN",3) == 0) {
+   sprintf(hdrrec,"VALM NAN");
+   MtzWhdrLine(fileout,8,hdrrec);
+ } else {
+   sprintf(hdrrec,"VALM %-20f",mtz->mnf.fmnf);
+   MtzWhdrLine(fileout,25,hdrrec);
+ }
+
+ if (debug) 
+   printf(" MtzPut: VALM just written \n");
+
+ /* Loop over crystals */
+ for (i = 0; i < mtz->nxtal; ++i) {
+ /* Loop over datasets for each crystal */
+  for (j = 0; j < mtz->xtal[i]->nset; ++j) {
+ /* Loop over columns for each dataset */
+   for (k = 0; k < mtz->xtal[i]->set[j]->ncol; ++k) {
+     if (mtz->xtal[i]->set[j]->col[k]->active) {
+       if (strcmp(mtz->xtal[i]->set[j]->col[k]->type,"Y") == 0 && 
+           strcmp(mtz->xtal[i]->set[j]->col[k]->label,"M_ISYM") == 0) {
+         sprintf(hdrrec,"COLUMN %-30s ","M/ISYM");
+       } else {
+         sprintf(hdrrec,"COLUMN %-30s ",mtz->xtal[i]->set[j]->col[k]->label);
+       }
+       /* Check that the column type is set
+	  If it is blank then the COLUMN record will be incomplete */
+       if (mtz->xtal[i]->set[j]->col[k]->type[0] == '\0') {
+         if (ccp4_liberr_verbosity(-1))
+  	   printf("From MtzPut: column type for %s is not set, assume type R\n",
+		mtz->xtal[i]->set[j]->col[k]->label);
+	 strncpy(mtz->xtal[i]->set[j]->col[k]->type,"R",2);
+       }
+       sprintf(hdrrec+38,"%c %17.4f %17.4f %4d",
+                   mtz->xtal[i]->set[j]->col[k]->type[0],
+                   mtz->xtal[i]->set[j]->col[k]->min,
+                   mtz->xtal[i]->set[j]->col[k]->max,
+                   mtz->xtal[i]->set[j]->setid);
+       MtzWhdrLine(fileout,MTZRECORDLENGTH,hdrrec);
+     }
+   }
+  }
+ }
+
+ if (debug) 
+   printf(" MtzPut: column info just written \n");
+
+ sprintf(hdrrec,"NDIF %8d",MtzNumActiveSet(mtz));
+ MtzWhdrLine(fileout,13,hdrrec);
+
+ if (debug) 
+   printf(" MtzPut: about to write dataset info \n");
+
+ /* Loop over crystals */
+ for (i = 0; i < mtz->nxtal; ++i) {
+ /* Loop over datasets for each crystal */
+  for (j = 0; j < mtz->xtal[i]->nset; ++j) {
+   /* check if dataset contains any active columns or batches */
+   if ( (MtzNumActiveColsInSet(mtz->xtal[i]->set[j]) == 0) &&
+        (MtzNbatchesInSet(mtz,mtz->xtal[i]->set[j]) == 0) ) continue;
+   sprintf(hdrrec,"PROJECT %7d %-64s",mtz->xtal[i]->set[j]->setid,
+                                      mtz->xtal[i]->pname);
+   MtzWhdrLine(fileout,MTZRECORDLENGTH,hdrrec);
+   sprintf(hdrrec,"CRYSTAL %7d %-64s",mtz->xtal[i]->set[j]->setid,
+                                      mtz->xtal[i]->xname);
+   MtzWhdrLine(fileout,MTZRECORDLENGTH,hdrrec);
+   sprintf(hdrrec,"DATASET %7d %-64s",mtz->xtal[i]->set[j]->setid,
+                                      mtz->xtal[i]->set[j]->dname);
+   MtzWhdrLine(fileout,MTZRECORDLENGTH,hdrrec);
+   sprintf(hdrrec,"DCELL   %7d %10.4f%10.4f%10.4f%10.4f%10.4f%10.4f",
+        mtz->xtal[i]->set[j]->setid,mtz->xtal[i]->cell[0],
+        mtz->xtal[i]->cell[1],mtz->xtal[i]->cell[2],
+        mtz->xtal[i]->cell[3],mtz->xtal[i]->cell[4], 
+        mtz->xtal[i]->cell[5]);
+   MtzWhdrLine(fileout,76,hdrrec);
+   sprintf(hdrrec,"DWAVEL  %7d %10.5f",mtz->xtal[i]->set[j]->setid,
+                                       mtz->xtal[i]->set[j]->wavelength);
+   MtzWhdrLine(fileout,26,hdrrec);
+  }
+ }
+
+ if (MtzNbat(mtz) > 0) {
+   batch = mtz->batch;
+   /* if new batch headers have been written, lose the old ones */
+   if (MtzNbat(mtz) > mtz->n_orig_bat) {
+     for (i=0; i < mtz->n_orig_bat; ++i) {
+       lastoldbatch = batch;
+       batch = batch->next;
+     }
+     numbat = MtzNbat(mtz) - mtz->n_orig_bat;
+     batch = sort_batches(batch,numbat);
+     if (mtz->n_orig_bat > 0) {
+       lastoldbatch->next = batch;
+     } else {
+       mtz->batch = batch;
+     }
+   } else {
+     numbat = mtz->n_orig_bat;
+   }
+   if (debug) {
+     printf(" MtzPut: original number of batches %d \n",mtz->n_orig_bat);
+     printf(" MtzPut: total number of batches %d \n",MtzNbat(mtz));
+     printf(" MtzPut: number of batches to be written %d \n",numbat);
+   }
+
+   for (i = 0; i < numbat; i += 12) {
+     sprintf(hdrrec,"BATCH ");
+     l = 6;
+     for (j = 0; j < 12 && i+j < numbat; ++j) {
+       sprintf(hdrrec+6+6*j,"%6d",batch->num);
+       l += 6;
+       batch = batch->next;
+     }
+     MtzWhdrLine(fileout,l,hdrrec);
+   }
+ }
+
+ sprintf(hdrrec,"END ");
+ MtzWhdrLine(fileout,4,hdrrec);
+
+ if (debug) 
+   printf(" MtzPut: main header written \n");
+
+ if (mtz->histlines > 0) {
+   sprintf(hdrrec,"MTZHIST %3d",mtz->histlines);
+   MtzWhdrLine(fileout,11,hdrrec);
+   for (i = 0; i < mtz->histlines; ++i) {
+     strncpy(hdrrec,mtz->hist + MTZRECORDLENGTH*i,MTZRECORDLENGTH);
+     MtzWhdrLine(fileout,MTZRECORDLENGTH,hdrrec);
+   }
+ }
+
+ if (MtzNbat(mtz) > 0) {
+   batch = mtz->batch;
+   /* if new batch headers have been written, lose the old ones */
+   if (MtzNbat(mtz) > mtz->n_orig_bat)
+     for (i=0; i < mtz->n_orig_bat; ++i)
+       batch = batch->next;
+   sprintf(hdrrec,"MTZBATS");
+   MtzWhdrLine(fileout,7,hdrrec);
+   while (batch != NULL) {
+     sprintf(hdrrec,"BH %8d%8d%8d%8d",batch->num,nwords,nintegers,nreals);
+     MtzWhdrLine(fileout,35,hdrrec);
+     strcpy(hdrrec,"TITLE ");
+     strncpy(hdrrec+6,batch->title,70);
+     MtzWhdrLine(fileout,76,hdrrec);
+     MtzBatchToArray(batch,intbuf,fltbuf);
+     intbuf[0] = nwords;
+     intbuf[1] = nintegers;
+     intbuf[2] = nreals;
+     ccp4_file_setmode(fileout,2);
+     ccp4_file_write(fileout, (uint8 *) buf, nwords);
+     ccp4_file_setmode(fileout,0);
+     if (batch->gonlab[0] != "") {
+       sprintf(hdrrec,"BHCH %8s%8s%8s",batch->gonlab[0],batch->gonlab[1],batch->gonlab[2]);
+     } else {
+       sprintf(hdrrec,"BHCH                         ");
+     }
+     MtzWhdrLine(fileout,29,hdrrec);
+     batch = batch->next;
+   }
+ }
+
+ if (debug) 
+   printf(" MtzPut: batch headers written \n");
+
+ sprintf(hdrrec,"MTZENDOFHEADERS ");
+ MtzWhdrLine(fileout,16,hdrrec);
+
+ /* go back and correct hdrst */
+ ccp4_file_setmode(fileout,0);
+ ccp4_file_seek(fileout, 4, SEEK_SET); 
+ hdrst = mtz->nref * MtzNumActiveCol(mtz) + SIZE1 + 1;
+ ccp4_file_setmode(fileout,2);
+ ccp4_file_write(fileout,(uint8 *) &hdrst,1);
+
+ /* And close the mtz file: */
+ if (!mtz->fileout) 
+   ccp4_file_close(fileout);
+
+ if (debug) 
+   printf(" MtzPut: bye bye \n");
+
+ return 1;
+}
+
+MTZBAT *sort_batches(MTZBAT *batch, int numbat)
+
+{ int debug=0; 
+ int i,max_num_bat,isort=0,nmerges,sublistsize=1,sublist1,sublist2;
+ MTZBAT *cur_batch1, *cur_batch2, *sorted_batch, *tail;
+ MTZBAT *tmp;
+
+ /* first check if already in order */
+ cur_batch1 = batch;
+ max_num_bat = cur_batch1->num;
+ for (i=0; i < numbat; ++i) {
+   cur_batch1 = cur_batch1->next;
+   /* reached end of list */
+   if (!cur_batch1) return batch;
+   if (cur_batch1->num < max_num_bat) {
+     isort=1;
+     break;
+   } else {
+     max_num_bat = cur_batch1->num;
+   }
+ }
+ if (!isort) return batch;
+
+ if (ccp4_liberr_verbosity(-1))
+   printf("\n Note: Sorting batch headers prior to writing to file... \n\n");
+
+ /* Sort */
+ /* This is Simon Tatham's algorithm, implemented for batches. */
+
+ if (debug) {
+   tmp = batch;
+   for (i=0; i < numbat; ++i) {
+     printf(" %d",tmp->num);
+     tmp = tmp->next;
+   }
+   printf(" \n");
+ }
+
+ while (1) {
+
+   if (debug) printf(" sort_batches: pass with sublist size %d \n",sublistsize);
+   cur_batch1 = batch;
+   tail = NULL;
+   batch = NULL;
+   nmerges = 0; 
+   while (cur_batch1) {
+
+     ++nmerges;
+     cur_batch2 = cur_batch1;
+     sublist1 = 0;
+     while (cur_batch2 && sublist1 < sublistsize) {
+       ++sublist1;
+       cur_batch2 = cur_batch2->next;
+     } 
+     sublist2 = sublistsize;
+
+     while (sublist1 > 0 || (sublist2 > 0 && cur_batch2)) {
+
+       /* decide whether next batch comes from cur_batch1 or cur_batch2 */
+       if (sublist1 == 0) {
+	 /* cur_batch1 is empty; batch must come from cur_batch2. */
+	 sorted_batch = cur_batch2; cur_batch2 = cur_batch2->next; sublist2--;
+       } else if (sublist2 == 0 || !cur_batch2) {
+	 /* cur_batch2 is empty; batch must come from cur_batch1. */
+	 sorted_batch = cur_batch1; cur_batch1 = cur_batch1->next; sublist1--;
+       } else if (cur_batch1->num <= cur_batch2->num ) {
+	 /* cur_batch1 number is lower (or same); batch must come from cur_batch1. */
+	 sorted_batch = cur_batch1; cur_batch1 = cur_batch1->next; sublist1--;
+       } else {
+	 /* cur_batch2 number is lower; batch must come from cur_batch2. */
+	 sorted_batch = cur_batch2; cur_batch2 = cur_batch2->next; sublist2--;
+       }
+
+       /* add the next element to the merged list */
+       if (tail) { 
+         tail->next = sorted_batch;
+       } else {
+         batch = sorted_batch;
+       }
+       tail = sorted_batch;
+
+     }
+
+     /* sorted this sub-list - move to next */
+     cur_batch1 = cur_batch2;
+
+   }
+
+   tail->next = NULL;
+
+   if (debug) {
+     tmp = batch;
+     for (i=0; i < numbat; ++i) {
+       printf(" %d",tmp->num);
+       tmp = tmp->next;
+     }
+     printf(" \n");
+   }
+
+   /* If we have done only one merge, we're finished. */
+   if (nmerges <= 1)   /* allow for nmerges==0, the empty list case */
+     return batch;
+
+    /* Otherwise repeat, merging lists twice the size */
+    sublistsize *= 2;
+ }
+
+}
+
+CCP4File *MtzOpenForWrite(const char *logname)
+
+{ CCP4File *fileout;
+ int debug=0;
+ int hdrst;
+ char *filename;
+
+ if (debug) printf(" MtzOpenForWrite: entering \n");
+ /* Open the mtz file: */
+ if (getenv(logname) != NULL) {
+   filename = strdup(getenv(logname));
+ } else {
+   filename = strdup(logname);
+ }
+ fileout = ccp4_file_open(filename,O_RDWR | O_TRUNC);
+ if (! fileout ) {
+   ccp4_signal(CCP4_ERRLEVEL(3) | CMTZ_ERRNO(CMTZERR_CantOpenFile),"MtzOpenForWrite",NULL);
+   return NULL;
+ }
+ if (debug) printf(" MtzOpenForWrite: file opened \n");
+
+ /* Write initial info */
+ ccp4_file_setmode(fileout,0);
+ ccp4_file_writechar(fileout, (uint8 *) "MTZ ",4);
+ ccp4_file_setmode(fileout,2);
+ hdrst = SIZE1 + 1;
+ ccp4_file_write(fileout,(uint8 *) &hdrst,1);
+
+ ccp4_file_setstamp(fileout,2);
+/* Write architecture */
+ ccp4_file_warch(fileout);
+ if (debug) printf(" MtzOpenForWrite: stamp written \n");
+
+ /* Position at start of reflections - intervening gap should be filled
+    with zeros */
+ ccp4_file_seek(fileout, SIZE1, SEEK_SET); 
+
+ free(filename); 
+
+ if (debug) printf(" MtzOpenForWrite: bye bye \n");
+ return fileout;
+}
+
+int MtzBatchToArray(MTZBAT *batch, int *intbuf, float *fltbuf)
+
+{  int i;
+
+  if (!batch) return 0;
+
+  for (i = 0; i < NBATCHINTEGERS; ++i)
+    intbuf[i] = 0;
+  for (i = 0; i < NBATCHREALS; ++i)
+    fltbuf[i] = 0.0;
+
+  intbuf[3] = batch->iortyp;
+  for (i = 0; i < 6; ++i)
+    intbuf[4+i] = batch->lbcell[i];
+  intbuf[10] = batch->misflg;
+  intbuf[11] = batch->jumpax;
+  intbuf[12] = batch->ncryst;
+  intbuf[13] = batch->lcrflg;
+  intbuf[14] = batch->ldtype;
+  intbuf[15] = batch->jsaxs;
+  intbuf[16] = batch->nbscal;
+  intbuf[17] = batch->ngonax;
+  intbuf[18] = batch->lbmflg;
+  intbuf[19] = batch->ndet;
+  intbuf[20] = batch->nbsetid;
+
+  for (i = 0; i < 6; ++i)
+    fltbuf[i] = batch->cell[i];
+  for (i = 0; i < 9; ++i)
+    fltbuf[6 + i] = batch->umat[i];
+  for (i = 0; i < 3; ++i) 
+    fltbuf[15 + i] = batch->phixyz[0][i];
+  for (i = 0; i < 3; ++i) 
+    fltbuf[18 + i] = batch->phixyz[1][i];
+  for (i = 0; i < 12; ++i) 
+    fltbuf[21 + i] = batch->crydat[i];
+  for (i = 0; i < 3; ++i) 
+    fltbuf[33 + i] = batch->datum[i];
+  fltbuf[36] = batch->phistt;
+  fltbuf[37] = batch->phiend;
+  for (i = 0; i < 3; ++i) 
+    fltbuf[38 + i] = batch->scanax[i];
+  fltbuf[41] = batch->time1;
+  fltbuf[42] = batch->time2;
+  fltbuf[43] = batch->bscale;
+  fltbuf[44] = batch->bbfac;
+  fltbuf[45] = batch->sdbscale;
+  fltbuf[46] = batch->sdbfac;
+  fltbuf[47] = batch->phirange;
+  for (i = 0; i < 3; ++i)
+    fltbuf[59 + i] = batch->e1[i];
+  for (i = 0; i < 3; ++i)
+    fltbuf[62 + i] = batch->e2[i];
+  for (i = 0; i < 3; ++i)
+    fltbuf[65 + i] = batch->e3[i];
+  for (i = 0; i < 3; ++i)
+    fltbuf[80 + i] = batch->source[i];
+  for (i = 0; i < 3; ++i)
+    fltbuf[83 + i] = batch->so[i];
+  fltbuf[86] = batch->alambd;
+  fltbuf[87] = batch->delamb;
+  fltbuf[88] = batch->delcor;
+  fltbuf[89] = batch->divhd;
+  fltbuf[90] = batch->divvd;
+  for (i = 0; i < batch->ndet; ++i)
+  { fltbuf[111 + (i * 6)] = batch->dx[i];
+    fltbuf[112 + (i * 6)] = batch->theta[i];
+    fltbuf[113 + (i * 6)] = batch->detlm[i][0][0];
+    fltbuf[114 + (i * 6)] = batch->detlm[i][0][1];
+    fltbuf[115 + (i * 6)] = batch->detlm[i][1][0];
+    fltbuf[116 + (i * 6)] = batch->detlm[i][1][1];}
+
+  return 1;
+}
+
+int MtzWhdrLine(CCP4File *fileout, int nitems, char buffer[]) {
+
+  /* write header record to fileout. Record is filled from
+     nitems to MTZRECORDLENGTH by blanks.
+
+     If a C-style null terminator is encountered before nitems
+     are copied then the null terminator character is not
+     copied and the string is padded with blanks from that
+     point onwards */
+
+ char hdrrec[MTZRECORDLENGTH];
+ int i,j;
+
+ for (i = 0; i < nitems; ++i) {
+   /* Trap for C-style null character */
+   if (buffer[i] == '\0') {
+     break;
+   }
+   hdrrec[i] = buffer[i];
+ }
+ for (j = i; j < MTZRECORDLENGTH; ++j)
+   hdrrec[j] = ' ';
+
+ return (ccp4_file_writechar(fileout, (uint8 *) hdrrec,MTZRECORDLENGTH));
+
+}
+
+int MtzWrefl(CCP4File *fileout, int ncol, float *refldata) {
+
+  if (!fileout)  {
+    ccp4_signal(CCP4_ERRLEVEL(3) | CMTZ_ERRNO(CMTZERR_NoFile),"MtzWrefl",NULL);
+    return 0;
+  }
+  return (ccp4_file_write(fileout, (uint8 *) refldata, ncol));
+
+}
+
+MTZ *MtzMalloc(int nxtal, int nset[])
+
+{ MTZ *mtz;
+  int i,j,itime[3];
+  float zerocell[6]={0.0};
+  char dummy_xname[17];
+
+  ccp4_utils_itime(itime);
+  sprintf(dummy_xname,"NULL_xname%2.2d%2.2d%2.2d",itime[0],itime[1],itime[2]);
+  dummy_xname[16]='\0';
+
+  /* Allocate main header and symmetry */
+  mtz = (MTZ *) ccp4_utils_malloc(sizeof(MTZ));
+  if (mtz == NULL) {
+    ccp4_signal(CCP4_ERRLEVEL(3) | CMTZ_ERRNO(CMTZERR_AllocFail),"MtzMalloc",NULL);
+    return NULL;
+  }
+  memset(mtz,'\0',sizeof(MTZ));
+
+  mtz->nxtal=0;
+  ccp4array_new_size(mtz->xtal,5);
+  /* Allocate crystals and datasets. */
+  if (nxtal == 0) {
+    mtz->xtal[0] = NULL;
+  } else {
+    for (i = 0; i < nxtal; ++i) {
+      /* This adds mtz->xtal[i] */
+      if ( ! MtzAddXtal(mtz,dummy_xname,"NULL_pname",zerocell) ) return NULL;
+      mtz->xtal[i]->nset = 0;
+      for (j = 0; j < nset[i]; ++j) {
+        /* This adds mtz->xtal[i]->set[j] */
+        if ( ! MtzAddDataset(mtz,mtz->xtal[i],"NULL_dname",0.0) ) return NULL;
+      }
+    }
+  }
+
+  /* initialise main header */
+  mtz->filein = NULL;
+  mtz->fileout = NULL;
+  mtz->title[0] = '\0';
+  mtz->hist = NULL;
+  mtz->histlines = 0;
+  mtz->nxtal = nxtal;
+  mtz->ncol_read = 0;
+  mtz->nref = 0;
+  mtz->nref_filein = 0;
+  mtz->refs_in_memory = 1;
+  mtz->n_orig_bat = 0;
+  mtz->resmax_out = 0.0f;
+  mtz->resmin_out = 999.0f;
+  sprintf(mtz->mnf.amnf,"NAN");
+  mtz->mtzsymm.spcgrp = 0;
+  mtz->mtzsymm.spcgrpname[0] = '\0';
+  mtz->mtzsymm.nsym = 0;
+  mtz->mtzsymm.nsymp = 0;
+  mtz->mtzsymm.symtyp = '\0';
+  mtz->mtzsymm.pgname[0] = '\0';
+  mtz->batch = NULL;
+  for (i = 0; i < 5; ++i) {
+    mtz->order[i] = NULL;
+  }
+
+  return(mtz);
+}
+
+int MtzFree(MTZ *mtz)
+
+/* Frees the memory reserved for 'mtz' */
+
+{ int i,j,k;
+
+ /* Close attached mtz files */
+ if (mtz->filein) {
+    ccp4_file_close(mtz->filein);
+    mtz->filein = NULL;
+ }
+ if (mtz->fileout) {
+    ccp4_file_close(mtz->fileout);
+    mtz->fileout = NULL;
+ }
+
+  /* Loop over crystals */
+  for (i = 0; i < mtz->nxtal; ++i) {
+  /* Loop over datasets for each crystal */
+   for (j = 0; j < mtz->xtal[i]->nset; ++j) {
+  /* Loop over columns for each dataset */
+    for (k = 0; k < mtz->xtal[i]->set[j]->ncol; ++k) {
+      MtzFreeCol(mtz->xtal[i]->set[j]->col[k]);
+    }
+    ccp4array_free(mtz->xtal[i]->set[j]->col);
+    free((void *) mtz->xtal[i]->set[j]);
+   }
+   ccp4array_free(mtz->xtal[i]->set);
+   free((void *) mtz->xtal[i]);
+  }
+  ccp4array_free(mtz->xtal);
+
+  if (mtz->batch) {
+    MtzFreeBatch(mtz->batch);
+    mtz->batch = NULL;
+  }
+
+  if (mtz->hist != NULL) 
+    MtzFreeHist(mtz->hist);
+
+  free((void *) mtz);
+  return 1;
+}
+
+MTZBAT *MtzMallocBatch()
+
+/* Allocates memory for a single batch header */
+
+{ MTZBAT *batch;
+
+  batch = (MTZBAT *) ccp4_utils_malloc(sizeof(MTZBAT));
+  if (batch == NULL) {
+    ccp4_signal(CCP4_ERRLEVEL(3) | CMTZ_ERRNO(CMTZERR_AllocFail),"MtzMallocBatch",NULL);
+    return NULL;
+  }
+  memset(batch,'\0',sizeof(MTZBAT));
+  batch->next = NULL;
+
+  return(batch);
+}
+
+int MtzFreeBatch(MTZBAT *batch) 
+
+/* Frees the memory reserved for 'batch' */
+
+{
+  if (batch != NULL) {
+    MtzFreeBatch(batch->next);
+    batch->next = NULL;
+    free(batch);
+  }
+  return 1;
+}
+
+MTZCOL *MtzMallocCol(MTZ *mtz, int nref)
+
+{ MTZCOL *col;
+
+  col = (MTZCOL *) ccp4_utils_malloc(sizeof(MTZCOL));
+  if (col == NULL) {
+    ccp4_signal(CCP4_ERRLEVEL(3) | CMTZ_ERRNO(CMTZERR_AllocFail),"MtzMallocCol",NULL);
+    return NULL;
+  }
+  memset(col,'\0',sizeof(MTZCOL));
+
+  col->ref = NULL;
+  if (mtz->refs_in_memory) {
+    ccp4array_new_size(col->ref,nref);
+    if (col->ref == NULL) {
+      ccp4_signal(CCP4_ERRLEVEL(3) | CMTZ_ERRNO(CMTZERR_AllocFail),"MtzMallocCol",NULL);
+      return NULL;
+    }
+  }
+
+  return(col);
+}
+
+int MtzFreeCol(MTZCOL *col)
+
+{ if (col->ref) ccp4array_free(col->ref);
+  free((void *) col);
+  return 1;
+}
+
+char *MtzCallocHist(int nhist)
+
+/* Allocates memory for the mtz history with 'nhist' lines */
+
+{ char *hist;
+
+ hist = (char *) ccp4_utils_calloc(nhist, sizeof(char)*MTZRECORDLENGTH);
+ return(hist);
+}
+
+int MtzFreeHist(char *hist)
+
+/* Frees the memory reserved for 'hist' */
+
+{ 
+  free((void *) hist);
+  return 1;
+}
+
+MTZXTAL *MtzAddXtal(MTZ *mtz, const char *xname, const char *pname,
+              const float cell[6])
+{
+  /* add a new crystal to the mtz */
+  int i,x;
+  MTZXTAL *xtal;
+
+  xtal = (MTZXTAL *) ccp4_utils_malloc( sizeof(MTZXTAL) );
+  if (! xtal ) { 
+    ccp4_signal(CCP4_ERRLEVEL(3) | CMTZ_ERRNO(CMTZERR_AllocFail),"MtzAddXtal",NULL);
+    return NULL;
+  }
+  memset(xtal,'\0',sizeof(MTZXTAL));
+
+  /* fill out the data */
+  strncpy( xtal->xname, xname, 64 );
+  xtal->xname[64] = '\0';
+  strncpy( xtal->pname, pname, 64 );
+  xtal->pname[64] = '\0';
+  xtal->resmin = 100.0;
+  xtal->resmax = 0.0;
+  for (i = 0; i < 6; i++) xtal->cell[i] = cell[i];
+  /* make new xtalid */
+  for (i = x = 0; x < mtz->nxtal; x++)
+    if (mtz->xtal[x]->xtalid > i) i = mtz->xtal[x]->xtalid;
+  xtal->xtalid = ++i;
+  xtal->nset = 0;
+  /* create initial array of 10 pointers to datasets */
+  ccp4array_new_size(xtal->set,10);
+
+  /* add pointer to mtz */
+  if ( ++mtz->nxtal > ccp4array_size(mtz->xtal))
+    ccp4array_resize(mtz->xtal, mtz->nxtal + 2);
+  mtz->xtal[ mtz->nxtal - 1 ] = xtal;
+
+  return xtal;
+}
+
+MTZSET *MtzAddDataset(MTZ *mtz, MTZXTAL *xtl, const char *dname,
+                 const float wavelength)
+{
+  /* add a new dataset to the xtal */
+  int i,x,s;
+  MTZSET *set;
+
+  set = (MTZSET *) ccp4_utils_malloc( sizeof(MTZSET) );
+  if ( ! set ) { 
+    ccp4_signal(CCP4_ERRLEVEL(3) | CMTZ_ERRNO(CMTZERR_AllocFail),"MtzAddDataset",NULL);
+    return NULL;
+  }
+  memset(set,'\0',sizeof(MTZSET));
+
+  /* fill out the data */
+  strncpy( set->dname, dname, 64 );
+  set->dname[64] = '\0';
+  set->wavelength = wavelength;
+
+  /* New setid is one more than greatest current setid.
+     It must be at least 1, unless it is the base dataset setid=0. */
+  if (!strcmp(set->dname,"HKL_base")) {
+    set->setid = 0;
+  } else {
+    i = 0;
+    for (x = 0; x < mtz->nxtal; x++)
+      for (s = 0; s < mtz->xtal[x]->nset; s++)
+        if (mtz->xtal[x]->set[s]->setid > i) i = mtz->xtal[x]->set[s]->setid;
+    set->setid = ++i;
+  }
+
+  set->ncol = 0;
+  /* create initial array of 20 pointers to columns */
+  ccp4array_new_size(set->col,20);
+
+  /* add pointer to xtal */
+  if ( ++xtl->nset > ccp4array_size(xtl->set))
+    ccp4array_resize(xtl->set, xtl->nset + 4);
+  xtl->set[ xtl->nset - 1 ] = set;
+
+  return set;
+}
+
+MTZCOL *MtzAddColumn(MTZ *mtz, MTZSET *set, const char *label,
+                const char *type)
+{
+  /* add a new column to the dataset */
+  int i,nref;
+  union float_uint_uchar uf;
+  MTZCOL *col;
+
+  if (set->ncol == MCOLUMNS) { 
+    printf("MtzAddColumn: No more columns! \n");
+    return NULL;
+  }
+
+  /* allocate some memory for first column */
+  if (!mtz->refs_in_memory) {
+    nref = 0;
+  } else if (mtz->nref == 0) {
+    nref = 2000;
+  } else {
+    nref = mtz->nref;
+  }
+  col = MtzMallocCol(mtz, nref);
+  if (col == NULL) {
+    ccp4_signal(CCP4_ERRLEVEL(3) | CMTZ_ERRNO(CMTZERR_AllocFail),"MtzAddColumn",NULL);
+    return NULL;
+  }
+
+  /* fill out the data */
+  strncpy( col->label, label, 30 );
+  col->label[30] = '\0';
+  strncpy( col->type, type, 2);
+  col->type[2] = '\0';
+  col->active = 1;
+  col->source = 0;
+  col->min = 1.e06;
+  col->max = -1.e06;
+  /* add pointer to set */
+  if ( ++set->ncol > ccp4array_size(set->col))
+    ccp4array_resize(set->col, set->ncol + 9);
+  set->col[ set->ncol - 1 ] = col;
+  /* initialise column to MNF */
+  if (strncmp (mtz->mnf.amnf,"NAN",3) == 0) {
+   uf = ccp4_nan();
+  } else {
+   uf.f = mtz->mnf.fmnf;
+  }
+  for (i=0; i < nref; i++) col->ref[i] = uf.f;
+
+  return col;
+}
+
+int MtzToggleColumn(MTZCOL *col)
+{
+  /* Toggle active flag of column */
+  if (col->active) {
+    col->active = 0;
+  } else {
+    col->active = 1;
+  }
+  return col->active;
+}
+
+MTZSET *MtzColSet(const MTZ *mtz, const MTZCOL *col)
+{
+  int x,s,c;
+  for (x=0; x < mtz->nxtal; x++)
+    for (s=0; s < mtz->xtal[x]->nset; s++)
+      for (c=0; c < mtz->xtal[x]->set[s]->ncol; c++)
+      if (mtz->xtal[x]->set[s]->col[c] == col)
+        return mtz->xtal[x]->set[s];
+  printf ("MtzColSet: no such column. \n"); 
+  return NULL;
+}
+
+MTZXTAL *MtzSetXtal(const MTZ *mtz, const MTZSET *set)
+{
+  int x,s;
+  for (x=0; x < mtz->nxtal; x++)
+    for (s=0; s < mtz->xtal[x]->nset; s++)
+      if (mtz->xtal[x]->set[s] == set)
+        return mtz->xtal[x];
+  printf ("MtzSetXtal: no such dataset. \n"); 
+  return NULL;
+}
+
+int MtzNxtal(const MTZ *mtz)
+{
+  return mtz->nxtal;
+}
+
+int MtzNumActiveXtal(const MTZ *mtz)
+{
+  int k,ixtal=0;
+
+  for (k=0; k < mtz->nxtal; k++)
+     if (MtzNumActiveSetsInXtal(mtz,mtz->xtal[k])) ++ixtal;
+  return ixtal;
+}
+
+MTZXTAL **MtzXtals(MTZ *mtz)
+{
+  return mtz->xtal;
+}
+
+MTZXTAL *MtzIxtal(const MTZ *mtz, const int ixtal)
+{
+  return mtz->xtal[ixtal];
+}
+
+int MtzNsetsInXtal(const MTZXTAL *xtal)
+{
+  return xtal->nset;
+}
+
+int MtzNumActiveSetsInXtal(const MTZ *mtz, const MTZXTAL *xtal)
+{
+  int k,iset=0;
+
+  for (k=0; k < xtal->nset; k++)
+     if (MtzNumActiveColsInSet(xtal->set[k]) ||
+         MtzNbatchesInSet(mtz, xtal->set[k])) ++iset;
+  return iset;
+}
+
+MTZSET **MtzSetsInXtal(MTZXTAL *xtal)
+{
+  return xtal->set;
+}
+
+MTZSET *MtzIsetInXtal(const MTZXTAL *xtal, const int iset)
+{
+  return xtal->set[iset];
+}
+
+int MtzNcolsInSet(const MTZSET *set)
+{
+  return set->ncol;
+}
+
+int MtzNumActiveColsInSet(const MTZSET *set)
+{
+  int k,icol=0;
+
+  for (k=0; k < set->ncol; k++)
+     icol += set->col[k]->active;
+  return icol;
+}
+
+int MtzNumSourceColsInSet(const MTZSET *set)
+{
+  int k,icol=0;
+
+  for (k=0; k < set->ncol; k++)
+    if (set->col[k]->source) ++icol;
+  return icol;
+}
+
+int MtzNbatchesInSet(const MTZ *mtz, const MTZSET *set)
+{
+  int i,ibatch=0;
+  MTZBAT *batch;
+
+  batch = mtz->batch;
+
+  /* if new batch headers have been written, lose the old ones */
+  if (MtzNbat(mtz) > mtz->n_orig_bat) 
+    for (i=0; i < mtz->n_orig_bat; ++i)
+       batch = batch->next;
+
+  while (batch) {
+    if (batch->nbsetid == set->setid) ++ibatch;
+    batch = batch->next;
+  }
+
+  return ibatch;
+}
+
+MTZCOL **MtzColsInSet(MTZSET *set)
+{
+  return set->col;
+}
+
+MTZCOL *MtzIcolInSet(const MTZSET *set, const int icol)
+{
+  return set->col[icol];
+}
+
+char *MtzColType(MTZCOL *col)
+{
+  return col->type;
+}
+
+int MtzNset(const MTZ *mtz)
+{
+  int x,iset=0;
+  for (x=0; x < mtz->nxtal; x++)
+    iset += MtzNsetsInXtal(mtz->xtal[x]);
+  return iset;
+}
+
+int MtzNumActiveSet(const MTZ *mtz)
+{
+  int x,iset=0;
+  for (x=0; x < mtz->nxtal; x++)
+    iset += MtzNumActiveSetsInXtal(mtz,mtz->xtal[x]);
+  return iset;
+}
+  
+int MtzNcol(const MTZ *mtz)
+{
+  int x,s,icol=0;
+  for (x=0; x < mtz->nxtal; x++)
+    for (s=0; s < mtz->xtal[x]->nset; s++)
+      icol += MtzNcolsInSet(mtz->xtal[x]->set[s]);
+  return icol;
+}
+  
+int MtzNumActiveCol(const MTZ *mtz)
+{
+  int x,s,icol=0;
+  for (x=0; x < mtz->nxtal; x++)
+    for (s=0; s < mtz->xtal[x]->nset; s++)
+      icol += MtzNumActiveColsInSet(mtz->xtal[x]->set[s]);
+  return icol;
+}
+  
+int MtzNumSourceCol(const MTZ *mtz)
+{
+  int x,s,icol=0;
+  for (x=0; x < mtz->nxtal; x++)
+    for (s=0; s < mtz->xtal[x]->nset; s++)
+      icol += MtzNumSourceColsInSet(mtz->xtal[x]->set[s]);
+  return icol;
+}
+   
+int MtzNref(const MTZ *mtz)
+{
+  /* get the number of reflections in the mtz */
+
+  return mtz->nref;
+}
+ 
+int MtzNbat(const MTZ *mtz)
+{
+  /* get the number of batches in the mtz */
+  int cnt=0;
+  MTZBAT *batch;
+
+  for (batch = mtz->batch ; batch != NULL ; batch = batch->next ) 
+    ++cnt;
+
+  return cnt;
+}
+  
+char *MtzXtalPath(const MTZXTAL *xtal)
+{
+  /* Return the full path name of a crystal */
+  char *path;
+  size_t length;
+
+  length = strlen(xtal->xname)+2;
+  path = (char *) ccp4_utils_malloc(length*sizeof(char));
+  strcpy( path, "/" );
+  strcat( path, xtal->xname );
+  path[length-1] = '\0';
+  return ( path );
+}
+
+char *MtzSetPath(const MTZ *mtz, const MTZSET *set)
+{
+  /* Return the full path name of a dataset */
+  char *path, *path1;
+  size_t length;
+
+  path1 = MtzXtalPath( MtzSetXtal( mtz, set ) );
+  length = strlen(path1)+strlen(set->dname)+2;
+  path = ccp4_utils_malloc(length*sizeof(char));
+  strcpy( path, path1 );
+  free (path1);  
+  strcat( path, "/" );
+  strcat( path, set->dname );
+  path[length-1] = '\0';
+  return ( path );
+}
+
+char *MtzColPath(const MTZ *mtz, const MTZCOL *col)
+{
+  /* Return the full path name of a column */
+  char *path, *path1;
+  size_t length;
+
+  path1 = MtzSetPath( mtz, MtzColSet( mtz, col ) );
+  length = strlen(path1)+strlen(col->label)+2;
+  path = (char *) ccp4_utils_malloc(length*sizeof(char));
+  strcpy( path, path1 );
+  free (path1);  
+  strcat( path, "/" );
+  strcat( path, col->label );
+  path[length-1] = '\0';
+  return ( path );
+}
+
+int MtzRJustPath(char *path, const char *partial, const int njust)
+{
+  /* Complete a right-justified path by prefixing with wildcards */
+  int i, j;
+  /* count the slashes */
+  for ( i = j = 0; i < strlen(partial); i++ ) if ( partial[i] == '/' ) j++;
+
+  strcpy( path, "");
+  if ( j++ < njust ) strcat( path, "/" );
+  while ( j++ < njust ) strcat( path, "*/" );
+  strcat( path, partial );
+
+  return 1;
+}
+
+int MtzPathMatch(const char *path1, const char *path2)
+{
+  /* test for match between two paths, including wildcards */
+  /* this version only handles wildcards at the end of name components */
+  int p1 = 0, p2 = 0;
+  while ( path1[p1] != '\0' && path2[p2] != '\0' ) {    /* search both paths */
+    if ( path1[p1] != path2[p2] ) {
+      if ( path1[p1] != '*' && path2[p2] != '*' )
+      return FALSE;                       /* non-wild mismatch is terminal */
+      while ( path1[p1] != '/' && path1[p1] != '\0' ) p1++;   /* skip compnt */
+      while ( path2[p2] != '/' && path2[p2] != '\0' ) p2++;   /* skip compnt */
+    } else {
+      p1++; p2++;
+    }
+  }
+  return (path1[p1] == path2[p2]);          /* true only if both paths ended */
+}
+
+
+MTZCOL *MtzColLookup(const MTZ *mtz, const char *label)
+{
+  /* Returns a pointer to the column of mtz with the given `label`, or NULL */
+  int x,s,c;
+  char *path1, path2[200];
+
+  /* complete the right-justified path */
+  MtzRJustPath( path2, label, 3 );
+  /* now find the matching column */
+  for (x=0; x < mtz->nxtal; x++)  /* not much point in optimising this */
+    for (s=0; s < mtz->xtal[x]->nset; s++)
+      for (c=0; c < mtz->xtal[x]->set[s]->ncol; c++) {
+        path1 = MtzColPath(mtz, mtz->xtal[x]->set[s]->col[c]);
+        if ( MtzPathMatch( path1, path2 ) ) {
+          free (path1);
+          return mtz->xtal[x]->set[s]->col[c];
+	}
+        free (path1);
+      }
+  return NULL;
+}
+
+MTZSET *MtzSetLookup(const MTZ *mtz, const char *label)
+{
+  int x,s;
+  char *path1, path2[200];
+
+  /* complete the right-justified path */
+  MtzRJustPath( path2, label, 2 );
+  /* now find the matching column */
+  for (x=0; x < mtz->nxtal; x++)  
+    for (s=0; s < mtz->xtal[x]->nset; s++) {
+      path1 = MtzSetPath(mtz, mtz->xtal[x]->set[s]);
+      if ( MtzPathMatch( path1, path2 ) ) {
+        free (path1);
+        return mtz->xtal[x]->set[s];
+      }
+    free (path1);
+    }
+  return NULL;
+}
+
+MTZXTAL *MtzXtalLookup(const MTZ *mtz, const char *label)
+{
+  /* Returns a pointer to the crystal of mtz with the given `label`, or NULL */
+  int x;
+  char *path1, path2[200];
+
+  /* complete the right-justified path */
+  MtzRJustPath( path2, label, 1 );
+  /* now find the matching column */
+  for (x=0; x < mtz->nxtal; x++) { 
+    path1 = MtzXtalPath(mtz->xtal[x]);
+    if ( MtzPathMatch( path1, path2 ) ) {
+      free (path1);
+      return mtz->xtal[x];
+    }
+    free (path1);
+  }
+  return NULL;
+}
diff -ruN ccp4-5.99.5-orig/lib/cctbx/cctbx_sources/ccp4io/lib/src/cmtzlib.h ccp4-5.99.5/lib/cctbx/cctbx_sources/ccp4io/lib/src/cmtzlib.h
--- ccp4-5.99.5-orig/lib/cctbx/cctbx_sources/ccp4io/lib/src/cmtzlib.h	1969-12-31 16:00:00.000000000 -0800
+++ ccp4-5.99.5/lib/cctbx/cctbx_sources/ccp4io/lib/src/cmtzlib.h	2005-11-30 17:40:04.000000000 -0800
@@ -0,0 +1,1021 @@
+/*
+     cmtzlib.h: header file for cmtzlib.c
+     Copyright (C) 2001  CCLRC, Martyn Winn
+
+     This library is free software and is distributed under the terms and
+     conditions of the CCP4 licence agreement as `Part 0' (Annex 2)
+     software, which is version 2.1 of the GNU Lesser General Public
+     Licence (LGPL) with the following additional clause:
+
+        `You may also combine or link a "work that uses the Library" to
+        produce a work containing portions of the Library, and distribute
+        that work under terms of your choice, provided that you give
+        prominent notice with each copy of the work that the specified
+        version of the Library is used in it, and that you include or
+        provide public access to the complete corresponding
+        machine-readable source code for the Library including whatever
+        changes were used in the work. (i.e. If you make changes to the
+        Library you must distribute those, but you do not need to
+        distribute source or object code to those portions of the work
+        not covered by this licence.)'
+
+     Note that this clause grants an additional right and does not impose
+     any additional restriction, and so does not affect compatibility
+     with the GNU General Public Licence (GPL). If you wish to negotiate
+     other terms, please contact the maintainer.
+
+     You can redistribute it and/or modify the library under the terms of
+     the GNU Lesser General Public License as published by the Free Software
+     Foundation; either version 2.1 of the License, or (at your option) any
+     later version.
+
+     This library is distributed in the hope that it will be useful, but
+     WITHOUT ANY WARRANTY; without even the implied warranty of
+     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+     Lesser General Public License for more details.
+
+     You should have received a copy of the CCP4 licence and/or GNU
+     Lesser General Public License along with this library; if not, write
+     to the CCP4 Secretary, Daresbury Laboratory, Warrington WA4 4AD, UK.
+     The GNU Lesser General Public can also be obtained by writing to the
+     Free Software Foundation, Inc., 59 Temple Place, Suite 330, Boston,
+     MA 02111-1307 USA
+*/
+
+/** @page cmtz_page CMTZ library
+ *
+ * @verbatim
+
+<!-- ::INDEX_INFO::CMTZ library::Library::::C/C++ Software Library for MTZ files:::::::: -->
+
+   @endverbatim
+ *
+ *  @section cmtz_file_list File list
+
+<ul>
+<li>cmtzlib.h - contains details of the C/C++ API
+<li>mtzdata.h - contains details of the MTZ data structure
+</ul>
+
+ *  @section cmtz_overview Overview
+ 
+The CMTZ library is centred around a data structure, defined in
+mtzdata.h Reading an MTZ file causes a data structure to be
+created and populated from the MTZ header. There are a variety of functions 
+for manipulating the data structure, for example adding crystals, datasets
+or columns. The data structure can be dumped to an output MTZ data file.
+<p>
+The library operates in two modes with respect to the reflection data.
+If <tt>mtz->refs_in_memory = 1</tt> (as set e.g. by the argument to 
+<tt>MtzGet</tt>), then all reflection data is read into memory from
+the file, and can be manipulated in memory. Else if 
+<tt>mtz->refs_in_memory = 0</tt> then explicit calls to <tt>ccp4_lrrefl</tt>,
+<tt>ccp4_lrreff</tt> and <tt>ccp4_lwrefl</tt> are required to read
+and write reflections from/to disk.
+<p>
+Information on the data structure is given in mtzdata.h
+
+ *  @section cmtz_princ_func Principal Functions
+ *  @subsection cmtz_reading Reading MTZ files
+
+Start by looking at <tt>MtzGet</tt> and <tt>ccp4_lrrefl</tt> / <tt>ccp4_lrreff</tt>.
+
+ *  @subsection cmtz_writing Writing MTZ files
+
+If you have a structure in memory already, use <tt>MtzPut</tt> followed
+by <tt>MtzFree</tt> to release the memory. 
+<p>
+If you need to create a structure from scratch (i.e. without reading
+from an input file) then use <tt>MtzMalloc</tt>, <tt>MtzOpenForWrite</tt>, 
+<tt>ccp4_lwsymm</tt>, <tt>MtzAddXtal</tt>, <tt>MtzAddDataset</tt>, 
+<tt>MtzAddColumn</tt> and <tt>ccp4_lwrefl</tt>.
+
+ * @section cmtz_symmetry Symmetry Information
+
+All reflection data in an MTZ file is assumed to belong to the same
+spacegroup. The spacegroup is identified in the MTZ file by SYMINF
+and SYMM records in the file header. This information is copied 
+into the in-memory data structure. The list of symmetry operators
+(copied from the SYMM header records) is taken to be the definitive
+indicator of the spacegroup.
+<p>
+The functions <tt>ccp4_lrsymi</tt>, <tt>ccp4_lrsymm</tt> and 
+<tt>ccp4_lwsymm</tt> read from and write to the symmetry sections
+of the data structure. No symmetry manipulations are done within
+the CMTZ library itself. Within CCP4, the CSYM library provides 
+appropriate functions, but other symmetry libraries could be used.
+
+ *  @section cmtz_examples Examples
+
+See examples on <a href="ftp://ftp.ccp4.ac.uk/pub/mdw/cmtz">ftp area</a>
+
+ */
+
+/** @file cmtzlib.h
+ *
+ *  @brief C-level library for input, output and manipulation of MTZ files.
+ *
+ *  Functions defining the C-level API for accessing MTZ files.
+ *  MtzGet and MtzPut read and write MTZ files to/from a data
+ *  structure defined in mtzdata.h  Other functions allow one
+ *  to access data structure members, and to manipulate the structure
+ *  and the values of structure members. Functions with names
+ *  beginning <tt>ccp4_lr</tt> or <tt>ccp4_lw</tt> are primarily 
+ *  to support the Fortran API.
+ *
+ *  @author Martyn Winn 
+ */
+
+#ifndef __CMTZLib__
+#define __CMTZLib__
+
+
+/* defines CCP4::CCP4File */
+#include "ccp4_utils.h"
+
+#ifdef  __cplusplus
+namespace CMtz {
+extern "C" {
+typedef CCP4::CCP4File CCP4File;
+#endif
+
+/* needs to be here for C++ to use CCP4File typedef */
+#include "mtzdata.h"
+
+/**** MTZ i/o ****/
+
+/** Reads the contents of the MTZ file into an MTZ structure.
+ * @param logname (I) Logical name of MTZ file
+ * @param read_refs (I) Whether to read reflections into memory (non-zero) or
+ *        to read later from file (zero)
+ * @return Pointer to MTZ struct
+ */
+MTZ *MtzGet(const char *logname, int read_refs);
+
+/** Reads the contents of the MTZ file into an MTZ structure. As for function
+ * MtzGet except for extra argument cell_tolerance.
+ * @param logname (I) Logical name of MTZ file
+ * @param read_refs (I) Whether to read reflections into memory (non-zero) or
+ *        to read later from file (zero)
+ * @param cell_tolerance (I) User-defined tolerance for ccp4uc_cells_differ.
+ *        Setting this to zero means that a new crystal is generated whenever
+ *        dataset cell dimensions are different. MtzGet allows for a certain
+ *        variation within a single crystal.
+ * @return Pointer to MTZ struct
+ */
+MTZ *MtzGetUserCellTolerance(const char *logname, int read_refs, const double cell_tolerance);
+
+/** Reads reflection data from MTZ file.
+ * @param filein pointer to input file
+ * @param ncol number of columns to read
+ * @param refldata array of reflection data
+ * @return istat from ccp4_file_read
+ */
+int MtzRrefl(CCP4File *filein, int ncol, float *refldata);
+
+/** Writes an MTZ data structure to disk. If file is already open, MtzPut
+ * uses file pointer in mtz struct, else uses logical name of file.
+ * @param mtz pointer to MTZ struct.
+ * @param logname logical name for output file or blank.
+ * @return 1 on success, 0 on failure
+ */
+int MtzPut(MTZ *mtz, const char *logname);
+
+/** Opens a new MTZ file for writing.
+ * @param logname logical name for output file.
+ * @return pointer to file or NULL on failure
+ */
+CCP4File *MtzOpenForWrite(const char *logname);
+
+/** Write header record to fileout. Record is filled from
+ * buffer and padded by blanks to a total length of MTZRECORDLENGTH.
+ * @param fileout Pointer to output file.
+ * @param nitems Number of characters in buffer.
+ * @param buffer Character buffer containing MTZ header line.
+ * @return Number of bytes written on success, EOF on failure.
+ */
+int MtzWhdrLine(CCP4File *fileout, int nitems, char buffer[]);
+
+/** Write ncol column entries to fileout from refldata.
+ * @param fileout pointer to output MTZ file.
+ * @param ncol number of reflection data items to write.
+ * @param refldata array of reflection data items.
+ * @return Number of items written. If this is less than ncol, then
+ * that indicates a write error.
+ */
+int MtzWrefl(CCP4File *fileout, int ncol, float *refldata);
+
+/** Delete a reflection from the data structure. Beware, there
+ * is no going back!
+ * @param mtz pointer to MTZ struct.
+ * @param iref index of reflection
+ * @return 0 if successful, 1 otherwise
+ */
+int MtzDeleteRefl(MTZ *mtz, int iref);
+
+/**** Memory allocation ****/
+
+/** Allocates memory for an MTZ header structure. The structure can
+ * contain 0, 1 or more crystals, and for each crystal 0, 1 or more 
+ * datasets. Crystals have a name based on the time "NULL_xnameHHMMSS"
+ * to ensure uniqueness (compared to crystals defined elsewhere - all
+ * new crystals created here will (probably) have the same name).
+ * Crystals have the project name "NULL_pname", and datasets have the
+ * name "NULL_dname".
+ * @param nxtal Number of crystals to allocate.
+ * @param nset Number of datasets for each crystal to allocate.
+ * @return pointer to MTZ header struct
+ */
+MTZ *MtzMalloc(int nxtal, int nset[]);
+
+/** Frees the memory reserved for the MTZ header struct.
+ * @param mtz pointer to MTZ header struct. 
+ * @return 1 on success, 0 on failure
+ */
+int MtzFree(MTZ *mtz);
+
+/** Allocates memory for an MTZ column. Space is allocated for
+ * the reflection data if and only if mtz->refs_in_memory is set.
+ * @param mtz pointer to MTZ header struct. 
+ * @param nref number of reflections in column.
+ * @return pointer to MTZ column.
+ */
+MTZCOL *MtzMallocCol(MTZ *mtz, int nref);
+
+/** Frees the memory reserved for 'col'
+ * @param col pointer to MTZ column.
+ * @return 1 on success, 0 on failure
+ */
+int MtzFreeCol(MTZCOL *col);
+
+/** Allocates memory for a single batch header.
+ * @return pointer to batch
+ */
+MTZBAT *MtzMallocBatch(void);
+
+/** Frees the memory reserved for 'batch'.
+ * @param batch
+ * @return 1 on success, 0 on failure
+ */
+int MtzFreeBatch(MTZBAT *batch);
+  
+/** Allocates memory for the mtz history with 'nhist' lines.
+ * @param nhist
+ * @return pointer to history
+ */
+char *MtzCallocHist(int nhist);
+
+/** Frees the memory reserved for 'hist'.
+ * @param hist
+ * @return 1 on success, 0 on failure
+ */
+int MtzFreeHist(char *hist);
+
+/** Free all memory malloc'd from static pointers.
+ * To be called before program exit. The function can be
+ * registered with atexit.
+ * @return void
+ */
+void MtzMemTidy(void);
+
+/**** Header operations ****/
+  
+/** Get the number of batches in the mtz.
+ * @param mtz pointer to MTZ struct
+ * @return Number of batches.
+ */
+int MtzNbat(const MTZ *mtz);
+
+/** Get the number of reflections in the mtz.
+ * @param mtz pointer to MTZ struct
+ * @return Number of reflections.
+ */
+int MtzNref(const MTZ *mtz);
+
+/** Get the spacegroup number (likely CCP4 convention).
+ * @param mtz pointer to MTZ struct
+ * @return Spacegroup number.
+ */
+int MtzSpacegroupNumber(const MTZ *mtz);
+
+/** Return the overall resolution limits of the MTZ structure.
+ * These are the widest limits over all crystals present.
+ * @param mtz pointer to MTZ struct
+ * @param minres minimum resolution
+ * @param maxres maximum resolution
+ * @return 1 on success, 0 on failure 
+ */
+int MtzResLimits(const MTZ *mtz, float *minres, float *maxres);
+
+/**** Crystal operations ****/
+
+/** Get the total number of crystals in the MTZ structure
+ * @param mtz pointer to MTZ struct
+ * @return number of active crystals
+ */
+int MtzNxtal(const MTZ *mtz);
+
+/** Get the number of active crystals in the MTZ structure
+ * @param mtz pointer to MTZ struct
+ * @return number of active crystals
+ */
+int MtzNumActiveXtal(const MTZ *mtz);
+
+/** Return array of pointers to crystals.
+ * @param mtz pointer to MTZ struct
+ * @return array of pointers to crystals
+ */
+MTZXTAL **MtzXtals(MTZ *mtz);
+
+/** Return pointer to the ixtal'th crystal. 
+ * @param mtz pointer to MTZ struct
+ * @param ixtal number of the particular crystal (ixtal = 0 ... MtzNxtal(xtal) -1 
+ * @return pointer to the specified crystal
+ */
+MTZXTAL *MtzIxtal(const MTZ *mtz, const int ixtal);
+
+/** Return the full path name of a crystal as "/xname" 
+ * Memory for the path name is assigned with malloc, and can
+ * be free'd by the calling function.
+ * @param xtal pointer to the crystal struct
+ * @return pointer to string containing path name
+ */
+char *MtzXtalPath(const MTZXTAL *xtal);
+
+/** Returns a pointer to the crystal of mtz with the given `label`, or NULL.
+ * @param mtz pointer to MTZ struct
+ * @param label
+ * @return pointer to crystal
+ */
+MTZXTAL *MtzXtalLookup(const MTZ *mtz, const char *label);
+
+/** Add a crystal to header mtz.
+ * @param mtz pointer to MTZ struct
+ * @param xname Crystal name.
+ * @param pname Name of associated project.
+ * @param cell Cell dimensions of crystal.
+ * @return Pointer to crystal.
+ */
+MTZXTAL *MtzAddXtal(MTZ *mtz, const char *xname, const char *pname,
+                  const float cell[6]);
+
+/** For a given crystal, return number of datasets in that crystal.
+ * @param xtal pointer to the crystal struct
+ * @return number of datasets
+ */
+int MtzNsetsInXtal(const MTZXTAL *xtal);
+
+/** For a given crystal, return number of active datasets in that crystal.
+ * @param xtal pointer to the crystal struct
+ * @return number of datasets
+ */
+int MtzNumActiveSetsInXtal(const MTZ *mtz, const MTZXTAL *xtal);
+
+/** For a given crystal, return array of pointers to datasets 
+ * in that crystal.
+ * @param xtal pointer to the crystal struct
+ * @return array of pointers to datasets 
+ */
+MTZSET **MtzSetsInXtal(MTZXTAL *xtal);
+
+/** For a given crystal, return pointer to the iset'th dataset
+ * in that crystal.
+ * @param xtal pointer to the crystal struct
+ * @param iset number of the particular dataset (iset = 0 ... MtzNsetsInXtal(xtal) -1
+ * @return pointer to specified dataset
+ */
+MTZSET *MtzIsetInXtal(const MTZXTAL *xtal, const int iset);
+
+/**** Dataset operations ****/
+
+/** Get the number of datasets in the MTZ structure
+ * @param mtz pointer to MTZ struct
+ * @return total number of datasets
+ */
+int MtzNset(const MTZ *mtz);
+
+/** Get the number of active datasets in the MTZ structure
+ * @param mtz pointer to MTZ struct
+ * @return total number of datasets
+ */
+int MtzNumActiveSet(const MTZ *mtz);
+
+/** Get the crystal associated with a dataset 
+ * The pointer to MTZ is required to do reverse lookup of xname. 
+ * @param mtz pointer to MTZ struct
+ * @param set pointer to dataset
+ * @return pointer to parent crystal, or NULL if "set" is
+ *    not present in "mtz".
+ */
+MTZXTAL *MtzSetXtal(const MTZ *mtz, const MTZSET *set);
+
+/** Return the full path name of a dataset as "/xname/dname" 
+ * The pointer to MTZ is required to do reverse lookup of xname.
+ * Memory for the path name is assigned with malloc, and can
+ * be free'd by the calling function.
+ * @param mtz pointer to MTZ struct
+ * @param set pointer to dataset
+ * @return pointer to string containing path name
+ */
+char *MtzSetPath(const MTZ *mtz, const MTZSET *set);
+
+/** Returns a pointer to the dataset of MTZ with the given label.
+ * @param mtz pointer to MTZ struct.
+ * @param label Label of desired set. This could be <dname> or
+ *   <xname>/<dname>.
+ * @return pointer to set or NULL if not found
+ */
+MTZSET *MtzSetLookup(const MTZ *mtz, const char *label);
+
+/** Add a dataset to crystal xtl
+ * @param mtz pointer to MTZ struct.
+ * @param xtl pointer to crystal struct.
+ * @param dname Dataset name
+ * @param wavelength X-ray wavelength of dataset
+ * @return pointer to set
+ */
+MTZSET *MtzAddDataset(MTZ *mtz, MTZXTAL *xtl, const char *dname,
+                    const float wavelength);
+
+/** For a given dataset, return number of columns in that dataset.
+ * This is simply set->ncol and so includes all columns irrespective
+ * of col->active
+ * @param set pointer to dataset
+ * @return number of columns
+ */
+int MtzNcolsInSet(const MTZSET *set);
+
+/** For a given dataset, return number of active columns in that dataset.
+ * @param set pointer to dataset
+ * @return number of active columns
+ */
+int MtzNumActiveColsInSet(const MTZSET *set);
+
+/** For a given dataset, return number of columns in that dataset
+ * which have a source in an input file (i.e. non-zero source attribute).
+ * @param set pointer to dataset
+ * @return number of source columns
+ */
+int MtzNumSourceColsInSet(const MTZSET *set);
+
+/** For a given dataset, return number of batches in that dataset.
+ * @param mtz pointer to MTZ struct
+ * @param set pointer to dataset
+ * @return number of batches
+ */
+int MtzNbatchesInSet(const MTZ *mtz, const MTZSET *set);
+
+/** For a given dataset, return array of pointers to columns 
+ * in that dataset.
+ * @param set pointer to dataset
+ * @return array of pointers to columns 
+ */
+MTZCOL **MtzColsInSet(MTZSET *set);
+
+/** For a given dataset, return pointer to the icol'th column
+ * in that dataset.
+ * @param set pointer to dataset
+ * @param icol number of 
+ * the particular column (icol = 0 ... MtzNcolsInSet(set) -1
+ * @return pointer to specified column
+ */
+MTZCOL *MtzIcolInSet(const MTZSET *set, const int icol);
+
+/**** Column operations ****/
+
+/** Add a column to dataset set and create + fill with NAN
+ * @param mtz pointer to MTZ struct
+ * @param set pointer to dataset
+ * @param label Column label
+ * @param type Column type
+ * @return pointer to column
+ */
+MTZCOL *MtzAddColumn(MTZ *mtz, MTZSET *set, const char *label,
+                   const char *type);
+
+/** Assigns HKL columns to the base dataset.
+ * @param mtz pointer to MTZ struct
+ * @return 1 on success, 0 on failure
+ */
+int MtzAssignHKLtoBase(MTZ *mtz);
+
+/** Assigns a column to a dataset identified by crystal_name and
+ * dataset_name. First, the function checks whether the
+ * column already belongs to this dataset, in which case it does nothing.
+ * Then it checks if the requested dataset exists. If not, it is created,
+ * though it is better to explicitly create it beforehand. Finally, the column
+ * is assigned to the dataset.
+ * @param mtz pointer to MTZ struct
+ * @param col pointer to column
+ * @param crystal_name name of crystal containing dataset
+ * @param dataset_name name of dataset
+ * @return 1 on success, 0 on failure
+ */
+int MtzAssignColumn(MTZ *mtz, MTZCOL *col, const char crystal_name[],  
+	     const char dataset_name[]);
+
+/** Toggle active flag of column. A value of 0 means inactive and will
+ * not be written out, whereas a value of 1 means active and will
+ * be written out.
+ * @param col pointer to column
+ * @return New value of col->active.
+ */
+int MtzToggleColumn(MTZCOL *col);
+
+/** Get the dataset associated with a column.
+ * @param mtz pointer to MTZ struct
+ * @param col pointer to column of interest
+ * @return pointer to set containing column of interest, or NULL
+ *   if "col" is not contained in "mtz".
+ */
+MTZSET  *MtzColSet(const MTZ *mtz, const MTZCOL *col);
+
+/** Get the number of columns in the MTZ data structure.
+ * @param mtz pointer to MTZ struct
+ * @return number of columns
+ */
+int MtzNcol(const MTZ *mtz);
+  
+/** Get the number of active columns in the MTZ data structure.
+ * @param mtz pointer to MTZ struct
+ * @return number of columns
+ */
+int MtzNumActiveCol(const MTZ *mtz);
+  
+/** Get the number of columns in the MTZ data structure which have 
+ * a source in an input file (i.e. non-zero source attribute).
+ * @param mtz pointer to MTZ struct
+ * @return number of columns
+ */
+int MtzNumSourceCol(const MTZ *mtz);
+
+/** Return the full path name of a column as "/xname/dname/label" 
+ * Memory for the path name is assigned with malloc, and can
+ * be free'd by the calling function.
+ * @param mtz pointer to MTZ struct
+ * @param col pointer to MTZ column.
+ * @return full path name of column
+ */
+char *MtzColPath(const MTZ *mtz, const MTZCOL *col);
+
+/** Complete a right-justified path by prefixing with wildcards
+ * @param path Completed path.
+ * @param partial Partial right-justified path
+ * @param njust
+ * @return 1 on success, 0 on failure.
+ */
+int MtzRJustPath(char *path, const char *partial, const int njust);
+
+/** Test for match between two paths, including wildcards
+ * @param path1 First path
+ * @param path2 Second path
+ * @return 1 if paths match, else 0.
+ */
+int MtzPathMatch(const char *path1, const char *path2);
+
+/** Returns a pointer to the column of mtz with the given `label`, or NULL
+ * @param mtz pointer to MTZ struct
+ * @param label Column label.
+ * @return pointer to column
+ */
+MTZCOL *MtzColLookup(const MTZ *mtz, const char *label);
+
+/** Get the MTZ column type of a particular column.
+ * @param col pointer to MTZ column.
+ * @return column type
+ */
+char *MtzColType(MTZCOL *col);
+
+/** Print summary of current crystal/dataset/column hierarchy. This
+ * is designed for debugging purposes rather than for the user.
+ * @param mtz pointer to MTZ struct
+ * @return void
+ */
+void MtzDebugHierarchy(const MTZ *mtz);
+
+/** List of column information: label, type, dataset.
+ * @param mtz pointer to MTZ struct
+ * @param clabs List of labels (output).
+ * @param ctyps List of column types (output).
+ * @param csetid List of dataset IDs (output).
+ * @return number of columns in current structure.
+ */
+int MtzListColumn(const MTZ *mtz, char clabs[][31], char ctyps[][3], int csetid[]);
+
+/** List of column information from input file: label, type, dataset.
+ * @param mtz pointer to MTZ struct
+ * @param clabs List of labels (output).
+ * @param ctyps List of column types (output).
+ * @param csetid List of dataset IDs (output).
+ * @return number of columns in input file.
+ */
+int MtzListInputColumn(const MTZ *mtz, char clabs[][31], char ctyps[][3], int csetid[]);
+
+/**** helper functions ****/
+
+/** Find where indices h, k, l are in MTZ structure. Usually, they
+ * will be first 3 columns of 1st dataset, but safest not to assume this.
+ * @param mtz pointer to MTZ struct
+ * @param ind_xtal crystal containing indices
+ * @param ind_set dataset containing indices
+ * @param ind_col 3 columns containing indices
+ * @return 1 on success, 0 on failure
+ */
+int MtzFindInd(const MTZ *mtz, int *ind_xtal, int *ind_set, int ind_col[3]);
+
+/** Calculate resolution from indices and coefhkl.
+ * coefhkl is obtained from MtzHklcoeffs.
+ * @param in integer array of 3 indices
+ * @param coefhkl double array of 6 coefficients
+ * @return resolution
+ */
+float MtzInd2reso(const int in[3], const double coefhkl[6]);
+
+/** Generate coefhkl coefficients from given cell parameters.
+ * @param cell cell dimensions to be used for resolution calculation.
+ * @param coefhkl double array of 6 coefficients
+ * @return 1 on success, 0 on failure
+ */
+int MtzHklcoeffs(const float cell[6], double coefhkl[6]);
+
+/** Reads batch arrays into data structure.
+ * @param intbuf pointer to integer batch array
+ * @param fltbuf pointer to float batch array
+ * @param batch pointer to batch structure
+ * @return 1 on success, 0 on failure
+ */
+int MtzArrayToBatch(const int *intbuf, const float *fltbuf, MTZBAT *batch);
+
+/** Writes data structure to batch arrays.
+ * @param batch pointer to batch structure
+ * @param intbuf pointer to integer batch array
+ * @param fltbuf pointer to float batch array
+ * @return 1 on success, 0 on failure
+ */
+int MtzBatchToArray(MTZBAT *batch, int *intbuf, float *fltbuf);
+
+/** Sort a linked list of batches on batch number. The function
+ * first checks whether batches are already in order, as they
+ * will usually be.
+ * @param batch pointer to beginning of batch list
+ * @param numbat number of batches to be sorted
+ * @return Sorted list if batches sorted, original list if batches 
+ *  already in order
+ */
+MTZBAT *sort_batches(MTZBAT *batch, int numbat);
+
+/**** pseudo-mtzlib routines ****/
+
+/** Returns title of MTZ structure 'mtz'
+ * @param mtz pointer to MTZ struct
+ * @param title MTZ title as character string
+ * @return length of title excluding trailing blanks and terminating null
+ *  character.
+ */
+int ccp4_lrtitl(const MTZ *mtz, char *title);
+
+/** Get history lines from MTZ structure.
+ * @param mtz Pointer to MTZ struct.
+ * @param history Returned history lines.
+ * @param nlines Requested number of history lines.
+ * @return Actual number of history lines returned.
+ */
+int ccp4_lrhist(const MTZ *mtz, char history[][MTZRECORDLENGTH], int nlines);
+
+/** Get sort order from MTZ structure.
+ * @param mtz Pointer to MTZ struct.
+ * @param isort Returned sort order.
+ * @return 1 on success, 0 on failure
+ */
+int ccp4_lrsort(const MTZ *mtz, int isort[5]);
+
+/** Get batch numbers from MTZ structure.
+ * @param mtz Pointer to MTZ struct.
+ * @param nbatx Number of batches in input file.
+ * @param batchx Returned array of batch numbers.
+ * @return Number of batches.
+ */
+int ccp4_lrbats(const MTZ *mtz, int *nbatx, int batchx[]);
+
+/** Get cell dimensions for a particular crystal.
+ * @param xtl Pointer to crystal.
+ * @param cell Output cell dimensions.
+ * @return 1 on success, 0 on failure.
+ */
+int ccp4_lrcell(const MTZXTAL *xtl, float cell[]);
+
+/** Get spacegroup information as held in MTZ header.
+ * @param mtz Pointer to MTZ struct.
+ * @param nsympx Number of primitive symmetry operators.
+ * @param ltypex Lattice type (P,A,B,C,I,F,R).
+ * @param nspgrx Spacegroup number.
+ * @param spgrnx Spacegroup name.
+ * @param pgnamx Pointgroup name.
+ * @return Spacegroup number.
+ */
+int ccp4_lrsymi(const MTZ *mtz, int *nsympx, char *ltypex, int *nspgrx, 
+       char *spgrnx, char *pgnamx);
+
+/** Get symmetry matrices from MTZ structure. Note: ordering of matrices
+ * in rsymx was changed in April 2004.
+ * @param mtz Pointer to MTZ struct.
+ * @param nsymx Number of symmetry operators held in MTZ header.
+ * @param rsymx Symmetry operators as 4 x 4 matrices, in the order they
+ *   are held in the MTZ header. Each matrix has translations in
+ *   elements [*][3].
+ * @return Number of symmetry operators.
+ */
+int ccp4_lrsymm(const MTZ *mtz, int *nsymx, float rsymx[192][4][4]);
+
+/** Uses LABIN or LABOUT line to convert program labels to user labels.
+ * This is a helper function, but does not access reflection structure at all.
+ * @param labin_line (I) LABIN/LABOUT line from Parser.
+ * @param prog_labels (I) Progam labels.
+ * @param nlprgi (I) Number of program labels.
+ * @param user_labels (O) On output, user-supplied file labels in corresponding
+ *  positions. For unassigned program labels, user_labels is empty string.
+ * @return Number of program labels matched, or -1 if there was an error.
+ */
+int MtzParseLabin(char *labin_line, const char prog_labels[][31], 
+	   const int nlprgi, char user_labels[][2][31]);
+
+/** Finds columns in an MTZ struct according to column labels. Column types
+ *  are checked for agreement between requested type (in argument 'types')
+ *  and file type. If requested type is blank, file type is returned in 
+ *  argument 'types'. Note, this function is different from Fortranic LRASSN, 
+ *  in that any conversion from program labels to user labels should have been done
+ *  previously.
+ * @param mtz Pointer to MTZ struct.
+ * @param labels Input array of column labels to be found in MTZ struct.
+ * @param nlabels Number of columns to be found.
+ * @param types Input array of column types of columns to be found.
+ * @return Array of pointers to columns in MTZ struct. Array element is
+ *  NULL if column not found.
+ */
+MTZCOL **ccp4_lrassn(const MTZ *mtz, const char labels[][31], const int nlabels, 
+		char types[][3]);
+
+/** Report information on a particular dataset. This represents the
+ * collection of data held in one series of dataset records in the MTZ header.
+ * It is mainly useful for supporting old Fortran calls.
+ * @param mtz pointer to MTZ struct
+ * @param set pointer to dataset
+ * @param crystal_name Crystal name
+ * @param dataset_name Dataset name
+ * @param project_name Project name
+ * @param isets Dataset ID.
+ * @param datcell Cell dimensions of crystal that dataset belongs to.
+ * @param datwave X-ray wavelength associated with dataset.
+ * @return 1 on success, 0 on failure
+ */
+int ccp4_lridx(const MTZ *mtz, const MTZSET *set, char crystal_name[64], 
+            char dataset_name[64], char project_name[64], int *isets, 
+            float datcell[6], float *datwave);
+
+/** Returns iref'th reflection from file held in MTZ struct mtz. Returns
+ * data for all columns held in input file, in the order that they are 
+ * held in the source file. The value of col->source can be used to find
+ * particular columns.
+ * In "in-memory" mode, reflection data is taken from arrays held in
+ * memory. In the traditional file-based mode, a reflection record is
+ * read from the input file.
+ * @param mtz pointer to MTZ struct
+ * @param resol resolution of reflection (output).
+ * @param adata array of requested values (output).
+ * @param logmss array of flags for missing data (output). A value of 1 indicates
+ * a Missing Number Flag, and a value of 0 indicates usable data.
+ * @param iref index of requested reflection (starting at 1).
+ * @return 1 if past last reflection, else 0
+ */
+int ccp4_lrrefl(const MTZ *mtz, float *resol, float adata[], int logmss[], int iref);
+
+/** Returns iref'th reflection from file held in MTZ struct mtz. Returns
+ * data for certain columns held in input file, as specified by the
+ * column pointers held in lookup.
+ * In "in-memory" mode, reflection data is taken from arrays held in
+ * memory. In the traditional file-based mode, a reflection record is
+ * read from the input file.
+ * @param mtz pointer to MTZ struct
+ * @param resol resolution of reflection (output).
+ * @param adata array of requested values (output).
+ * @param logmss array of flags for missing data (output). A value of 1 indicates
+ * a Missing Number Flag, and a value of 0 indicates usable data.
+ * @param lookup array of pointers to requested columns
+ * @param ncols number of requested columns
+ * @param iref index of requested reflection (starting at 1).
+ * @return 1 if past last reflection, else 0
+ */
+int ccp4_lrreff(const MTZ *mtz, float *resol, float adata[], int logmss[],
+		const MTZCOL *lookup[], const int ncols, const int iref);
+
+/** Checks whether a particular reflection value represents missing data.
+ * @param mtz Pointer to the MTZ struct, which holds the value representing
+ * missing data (the Missing Number Flag) against which the input datum
+ * is compared.
+ * @param datum Reflection value to be checked.
+ * @return Returns 1 is datum is the MNF, and 0 otherwise.
+ */
+int ccp4_ismnf(const MTZ *mtz, const float datum);
+
+/** Function to print header information in traditional format.
+ * @param mtz Pointer to MTZ struct
+ * @param iprint Print level
+ * @return 1 on success, 0 on failure 
+ */
+int ccp4_lhprt(const MTZ *mtz, int iprint);
+
+/** Function to print header information in format appropriate
+ * to data structure hierarchy.
+ * @param mtz Pointer to MTZ struct
+ * @param iprint Print level
+ * @return 1 on success, 0 on failure 
+ */
+int ccp4_lhprt_adv(const MTZ *mtz, int iprint);
+
+/** Function to return batch header data for a specified batch.
+ * @param batch Pointer to requested batch.
+ * @param buf On return, real and integer batch data.
+ * @param charbuf On return, character batch data (title and axes names).
+ * @param iprint =0 no printing, =1 print title only, >1 print full header.
+ * @return 1 on success, 0 on failure
+ */
+int ccp4_lrbat(MTZBAT *batch, float *buf, char *charbuf, int iprint);
+
+/** Function to print batch header data for a specified batch to stdout.
+ * @param batch Pointer to requested batch.
+ * @return 1 on success, 0 on failure 
+ */
+int MtzPrintBatchHeader(const MTZBAT *batch);
+
+/** Write header title for later output to file.
+ * @param mtz Pointer to MTZ struct.
+ * @param ftitle Title string.
+ * @param flag If 0 overwrite existing title, else append to
+ * existing title.
+ * @return 1 on success, 0 on failure 
+ */
+int ccp4_lwtitl(MTZ *mtz, const char *ftitle, int flag);
+
+/** Sets the sort order in the MTZ header. The sort order is
+ * a list of columns to be used for sorting, to be applied in
+ * the order they appear in the list, i.e. sort first on
+ * colsort[0], then on colsort[1], etc. If there are less than
+ * 5 columns to be used for sorting, some of colsort[] may be NULL.
+ * @param mtz Pointer to MTZ struct
+ * @param colsort Array of pointers to columns.
+ * @return 1 on success, 0 on failure
+ */
+int MtzSetSortOrder(MTZ *mtz, MTZCOL *colsort[5]);
+
+/** Adds history lines to the MTZ header in front of existing history lines.
+ * @param mtz pointer to MTZ struct
+ * @param history lines to be added
+ * @param nlines number of lines to be added
+ * @return total number of history lines
+ */
+int MtzAddHistory(MTZ *mtz, const char history[][MTZRECORDLENGTH], const int nlines);
+
+/** Write or update symmetry information for MTZ header. This provides support
+ * for the Fortran API, and is not particularly convenient for C programs. 
+ * Note: ordering of matrices in rsymx was changed in November 2003.
+ * @param mtz pointer to MTZ struct
+ * @param nsymx number of symmetry operators
+ * @param nsympx number of primitive symmetry operators
+ * @param rsymx array of symmetry operators (dimensions ordered in C convention,
+ *   with translations in elements [*][3])
+ * @param ltypex lattice type
+ * @param nspgrx spacegroup number
+ * @param spgrnx spacegroup name
+ * @param pgnamx point group name
+ * @return 1 on success, 0 on failure 
+ */
+int ccp4_lwsymm(MTZ *mtz, int nsymx, int nsympx, float rsymx[192][4][4], 
+		char ltypex[], int nspgrx, char spgrnx[], char pgnamx[]);
+
+/* Assign columns for writing. Check to see if columns already exist,
+ * else create them. New columns are assigned to the base dataset if it 
+ * exists, else the first dataset.
+ * @param mtz pointer to MTZ struct
+ * @param labels Input array of column labels to be assigned.
+ * @param nlabels Number of columns.
+ * @param types Input array of column types of columns.
+ * @param iappnd If iappnd = 0, then deactivate columns which are
+ *   not selected (allows one to write out a subset of columns). Else
+ *   if iappnd = 1, append these columns to existing ones.
+ * @return Array of pointers to columns in MTZ struct.
+ */
+MTZCOL **ccp4_lwassn(MTZ *mtz, const char labels[][31], const int nlabels, 
+             const char types[][3], const int iappnd);
+
+/* Add or update a dataset in the MTZ structure. If the crystal name is
+ * not recognised, then a new crystal is created containing a single
+ * dataset. If the crystal name is recognised, then the parameters of
+ * the crystal are updated. The child dataset is then created if necessary
+ * or an existing dataset updated.
+ * Note that this function is used to update crystal parameters, as well
+ * as add crystals. If a duplicate crystal name is used by mistake, then 
+ * the old crystal parameters are lost.
+ * @param mtz pointer to MTZ struct
+ * @param crystal_name Crystal name
+ * @param dataset_name Dataset name
+ * @param project_name Project name
+ * @param datcell Cell dimensions of crystal that dataset belongs to.
+ * @param datwave X-ray wavelength associated with dataset.
+ * @return 1 on success, 0 on failure
+ */
+int ccp4_lwidx(MTZ *mtz, const char crystal_name[],  const char dataset_name[],
+	const char project_name[], const float datcell[6], const float *datwave);
+
+
+/** Function to output reflection values for iref'th reflection.
+ * In "in-memory" mode, values are added/updated for columns for which 
+ * a column-pointer is given in lookup, up to a maximum of ncol columns.
+ * In the traditional file-based mode, a reflection record is written
+ * to file.
+ * @param mtz pointer to MTZ struct
+ * @param adata array of values.
+ * @param lookup array of pointers to columns.
+ * @param ncol number of columns.
+ * @param iref Reflection number such that 1st reflection is iref=1.
+ * @return 1 on success, 0 on failure
+ */
+int ccp4_lwrefl(MTZ *mtz, const float adata[], MTZCOL *lookup[], 
+		 const int ncol, const int iref);
+
+/** Write new batch information to 'batch' or if 'batch' is NULL create 
+ * new batch header with batch number 'batno'. If you try to create more 
+ * than one new batch header with the same batch number, the function will
+ * complain and return. It is OK to create a new batch with the same
+ * number as one read from file - this is the mechanism for changing
+ * batch headers.
+ * @param mtz pointer to MTZ struct
+ * @param batch pointer to batch
+ * @param batno batch number
+ * @param buf pointer to batch array
+ * @param charbuf pointer to character batch array
+ * @return 1 on success, 0 on failure
+ */
+int ccp4_lwbat(MTZ *mtz, MTZBAT *batch, const int batno, const float *buf, const char *charbuf);
+
+int ccp4_lwbsetid(MTZ *mtz, MTZBAT *batch, const char xname[], const char dname[]);
+
+/* -- Below here there are no implementations -- */
+
+/* COMPLEX HLToSF(float hla, float hlb, float hlc, float hld, BOOLEAN centric); */
+/* Returns the mean structure factor as a complex number from a structure
+   factor probability distribution described by Hendrickson/Lattman
+   coefficients. If `centric == TRUE`, the coefficients describe a centric
+   distribution. */
+
+/* MTZ *MtzSort(MTZ *mtz, char *ident); */
+/* Sorts `mtz` using the identifiers (separated by spaces) in `ident` as
+   keys. Sorting can be done on up to 200 columns. A pointer to `*mtz` is
+   returned. */
+
+/* MTZ *HLCombine (MTZ *to, float toscale, MTZ *frm, float frmscale); */
+/* Combines extra phase information for common reflections between 'frm'
+   and 'to' into the phase information of 'to'. The phase probabilities
+   are described by Hendrickson Lattman coefficients, with the identifiers
+   "HLA", "HLB", HLC", and "HLD", the indices are identified by "H", "K" 
+   and "L". HL-coeffs from 'to' are scaled by 'toscale', the coeffs from
+   'frm' are scaled by 'frmscale'. A pointer to `to` is returned. */
+
+/* void MtzPhiFom(MTZ *mtz); */
+/* Calculates the best phase and the figure of from Hendrickson Lattman
+   coefficients. The following columns should be present in `mtz`:
+   "H", "K" & "L" (indices); "PHIB" & "FOM" (best phase (degrees) and figure of
+   merit); "HLA", "HLB", "HLC" & "HLD" (Hendrickson Lattman coefficients). */
+
+/* MTZ *MtzCopy(MTZ *frm); */
+/* Produces an exact copy of `frm` and returns a pointer to it. */
+
+/* MTZ *MtzColAppend(MTZ *mtz, char *ident, char type); */
+/* Appends a column to `*mtz` with identity `ident` and type `type`, provided
+   no column with identity `ident` exists. */
+
+/* MTZ *MtzColRemove(MTZ *mtz, char *ident); */
+/* Removes a column from `*mtz` with identity `ident`. */
+
+/* MTZ *MtzUpdateRanges(MTZ *mtz); */
+/* Updates ranges of all columns in `mtz` and returns `mtz`. */
+
+/* MTZCOL *MtzColNewRange(MTZCOL *col, int nref); */
+/* Updates the minimum & maximum values in `col` and returns `col`. */
+
+/* int *MtzUnique(MTZ *mtz, char *ident); */
+/* Returns an array (k) of indices: k[j] returns the first occurrence of a set
+   of idents, eg. MtzUnique(mtz, "H K L") returns an array from which all the 
+   unique reflections can be determined by indexing with k: k[i] is the index
+   of the last relection of a set which all have the same hkl indices. It is
+   assumed that `mtz` is sorted, using `ident` as keys. */
+
+/* float PhaseProb(float phase, float hla, float hlb, float hlc, float hld,
+		BOOLEAN centric); */
+/* Returns the probability of `phase` (expressed in radians) as determined by
+   the Hendrickson-Lattman coefficients `hla`, `hlb`, `hlc` and `hld`. If
+   `centric == TRUE`, the coefficients describe a centric distribution. */
+
+#ifdef __cplusplus
+} }
+#endif
+#endif
diff -ruN ccp4-5.99.5-orig/lib/cctbx/cctbx_sources/ccp4io/lib/src/csymlib.c ccp4-5.99.5/lib/cctbx/cctbx_sources/ccp4io/lib/src/csymlib.c
--- ccp4-5.99.5-orig/lib/cctbx/cctbx_sources/ccp4io/lib/src/csymlib.c	1969-12-31 16:00:00.000000000 -0800
+++ ccp4-5.99.5/lib/cctbx/cctbx_sources/ccp4io/lib/src/csymlib.c	2005-11-30 17:40:04.000000000 -0800
@@ -0,0 +1,1951 @@
+/*
+     csymlib.c: C-level library for symmetry information.
+     Copyright (C) 2001  CCLRC, Martyn Winn
+
+     This library is free software and is distributed under the terms and
+     conditions of the CCP4 licence agreement as `Part 0' (Annex 2)
+     software, which is version 2.1 of the GNU Lesser General Public
+     Licence (LGPL) with the following additional clause:
+
+        `You may also combine or link a "work that uses the Library" to
+        produce a work containing portions of the Library, and distribute
+        that work under terms of your choice, provided that you give
+        prominent notice with each copy of the work that the specified
+        version of the Library is used in it, and that you include or
+        provide public access to the complete corresponding
+        machine-readable source code for the Library including whatever
+        changes were used in the work. (i.e. If you make changes to the
+        Library you must distribute those, but you do not need to
+        distribute source or object code to those portions of the work
+        not covered by this licence.)'
+
+     Note that this clause grants an additional right and does not impose
+     any additional restriction, and so does not affect compatibility
+     with the GNU General Public Licence (GPL). If you wish to negotiate
+     other terms, please contact the maintainer.
+
+     You can redistribute it and/or modify the library under the terms of
+     the GNU Lesser General Public License as published by the Free Software
+     Foundation; either version 2.1 of the License, or (at your option) any
+     later version.
+
+     This library is distributed in the hope that it will be useful, but
+     WITHOUT ANY WARRANTY; without even the implied warranty of
+     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+     Lesser General Public License for more details.
+
+     You should have received a copy of the CCP4 licence and/or GNU
+     Lesser General Public License along with this library; if not, write
+     to the CCP4 Secretary, Daresbury Laboratory, Warrington WA4 4AD, UK.
+     The GNU Lesser General Public can also be obtained by writing to the
+     Free Software Foundation, Inc., 59 Temple Place, Suite 330, Boston,
+     MA 02111-1307 USA
+*/
+
+/* DO NOT put Doxygen comments here - put in csymlib.h */
+/* See csymlib.h for descriptions of functions */
+
+#include <stdio.h>
+#include <string.h>
+#include <stdlib.h>
+#include <math.h>
+#include "ccp4_parser.h"
+#include "ccp4_types.h"
+#include "ccp4_utils.h"
+#include "csymlib.h"
+#include "cvecmat.h"
+#include "ccp4_errno.h"
+#include "ccp4_unitcell.h"
+
+/* stuff for error reporting */
+#define CSYM_ERRNO(n) (CCP4_ERR_SYM | (n))
+
+/* error defs */
+#define  CSYMERR_Ok                  0
+#define  CSYMERR_ParserFail          1
+#define  CSYMERR_NoSyminfoFile       2
+#define  CSYMERR_NullSpacegroup      3
+#define  CSYMERR_NoAsuDefined        4
+#define  CSYMERR_NoLaueCodeDefined   5
+
+CCP4SPG *ccp4spg_load_by_standard_num(const int numspg) 
+{ 
+  return ccp4spg_load_spacegroup(numspg, 0, NULL, NULL, 0, NULL);
+}
+
+CCP4SPG *ccp4spg_load_by_ccp4_num(const int ccp4numspg) 
+{ 
+  return ccp4spg_load_spacegroup(0, ccp4numspg, NULL, NULL, 0, NULL);
+}
+
+CCP4SPG *ccp4spg_load_by_spgname(const char *spgname) 
+{ 
+  return ccp4spg_load_spacegroup(0, 0, spgname, NULL, 0, NULL);
+}
+
+CCP4SPG *ccp4spg_load_by_ccp4_spgname(const char *ccp4spgname) 
+{ 
+  return ccp4spg_load_spacegroup(0, 0, NULL, ccp4spgname, 0, NULL);
+}
+
+CCP4SPG *ccp4_spgrp_reverse_lookup(const int nsym1, const ccp4_symop *op1)
+{
+  return ccp4spg_load_spacegroup(0, 0, NULL, NULL, nsym1, op1);
+}
+
+CCP4SPG *ccp4spg_load_spacegroup(const int numspg, const int ccp4numspg,
+         const char *spgname, const char *ccp4spgname, 
+         const int nsym1, const ccp4_symop *op1) 
+
+{ CCP4SPG *spacegroup;
+  int i,j,k,l,debug=0,nsym2,symops_provided=0,ierr,ilaue;
+  float sg_chb[4][4],limits[2],rot1[4][4],rot2[4][4];
+  FILE *filein;
+  char *symopfile, *ccp4dir, filerec[80];
+  ccp4_symop *op2,*op3,opinv;
+
+  /* spacegroup variables */
+  int sg_num, sg_ccp4_num, sg_nsymp, sg_num_cent;
+  float cent_ops[4][4];
+  char sg_symbol_old[20],sg_symbol_Hall[40],sg_symbol_xHM[20],
+       sg_point_group[20],sg_patt_group[40];
+  char sg_basisop[80],sg_symop[192][80],sg_cenop[4][80];
+  char sg_asu_descr[80], map_asu_x[12], map_asu_y[12], map_asu_z[12];    
+  char map_asu_ccp4_x[12], map_asu_ccp4_y[12], map_asu_ccp4_z[12]; 
+
+  /* For cparser */
+  CCP4PARSERARRAY *parser;
+  CCP4PARSERTOKEN *token=NULL;
+  char *key;
+  int iprint=0;
+
+  /* initialisations */
+  sg_nsymp=0;
+  sg_num_cent=0;
+
+  if (nsym1) symops_provided=1;
+
+  spacegroup = (CCP4SPG *) ccp4_utils_malloc(sizeof(CCP4SPG));
+
+  if (debug) {
+    printf(" Entering ccp4spg_load_spacegroup, with arguments %d %d %d \n",
+        numspg,ccp4numspg,nsym1);
+    if (spgname) printf(" spgname = %s \n",spgname);
+    if (ccp4spgname) printf(" ccp4spgname = %s \n",ccp4spgname);
+    for (i = 0; i < nsym1; ++i) {
+      printf(" %f %f %f \n",op1[i].rot[0][0],op1[i].rot[0][1],op1[i].rot[0][2]);
+      printf(" %f %f %f \n",op1[i].rot[1][0],op1[i].rot[1][1],op1[i].rot[1][2]);
+      printf(" %f %f %f \n",op1[i].rot[2][0],op1[i].rot[2][1],op1[i].rot[2][2]);
+      printf(" %f %f %f \n\n",op1[i].trn[0],op1[i].trn[1],op1[i].trn[2]);
+    }
+  }
+
+  /* if we are searching with symops, make sure translations are modulo 1 */
+  if (symops_provided) {
+    op3 = (ccp4_symop *) ccp4_utils_malloc(nsym1*sizeof(ccp4_symop));
+    for (i = 0; i < nsym1; ++i) {
+     for (k = 0; k < 3; ++k) {
+      for (l = 0; l < 3; ++l) {
+        op3[i].rot[k][l]=op1[i].rot[k][l];
+      }
+      op3[i].trn[k] = op1[i].trn[k];
+     }
+     ccp4spg_norm_trans(&op3[i]);
+    }
+  }
+
+  /* Open the symop file: */
+  if (!(symopfile = getenv("SYMINFO"))) {
+    printf("Environment variable SYMINFO not set ... guessing location of symmetry file. \n");
+    if (!(ccp4dir = getenv("CLIBD"))) {
+      printf("Environment variable CLIBD not set ... big trouble! \n");
+      return NULL;
+    }
+
+    symopfile = ccp4_utils_malloc((strlen(ccp4dir)+22)*sizeof(char));
+    strcpy(symopfile,ccp4_utils_joinfilenames(ccp4dir,"syminfo.lib"));
+    symopfile[strlen(ccp4dir)+21] = '\0';
+    printf(" SYMINFO file set to %s \n",symopfile);
+  } else {
+    printf("\n Spacegroup information obtained from library file: \n");
+    printf(" Logical Name: SYMINFO   Filename: %s\n\n",symopfile);
+  }
+
+  filein = fopen(symopfile,"r");
+  if (!filein) {
+    ccp4_signal(CSYM_ERRNO(CSYMERR_NoSyminfoFile),"ccp4spg_load_spacegroup",NULL); 
+    return NULL;
+  }
+
+  if (!(getenv("SYMINFO"))) free(symopfile);
+
+  parser = ccp4_parse_start(20);
+  if (parser == NULL) 
+    ccp4_signal(CSYM_ERRNO(CSYMERR_ParserFail),"ccp4spg_load_spacegroup",NULL);
+  /* "=" is used in map asu fields, so remove it as delimiter */
+  ccp4_parse_delimiters(parser," \t,",",");
+  /* Set some convenient pointers to members of the parser array */
+  key   = parser->keyword;
+  token = parser->token;
+
+  if (debug) 
+    printf(" parser initialised \n");
+
+  while (fgets(filerec,80,filein)) {
+    if (strlen(filerec) > 1) {
+
+      ccp4_parser(filerec, 80, parser, iprint);
+
+      if (ccp4_keymatch(key, "number")) {
+        sg_num = (int) token[1].value;
+      }
+
+      if (ccp4_keymatch(key, "basisop")) {
+        strcpy(sg_basisop,filerec+8);
+      }
+
+      if (ccp4_keymatch(key, "symbol")) {
+        if (strcmp(token[1].fullstring,"ccp4") == 0)
+          sg_ccp4_num = (int) token[2].value;
+        if (strcmp(token[1].fullstring,"Hall") == 0)
+          strcpy(sg_symbol_Hall,token[2].fullstring);
+        if (strcmp(token[1].fullstring,"xHM") == 0)
+          strcpy(sg_symbol_xHM,token[2].fullstring);
+        if (strcmp(token[1].fullstring,"old") == 0)
+          strcpy(sg_symbol_old,token[2].fullstring);
+        if (strcmp(token[1].fullstring,"patt") == 0)
+          strcpy(sg_patt_group,token[3].fullstring);
+        if (strcmp(token[1].fullstring,"pgrp") == 0)
+          strcpy(sg_point_group,token[3].fullstring);
+      }
+
+      if (ccp4_keymatch(key, "hklasu")) {
+        if (strcmp(token[1].fullstring,"ccp4") == 0)
+          strcpy(sg_asu_descr,token[2].fullstring);
+      }
+
+      if (ccp4_keymatch(key, "mapasu")) {
+        if (strcmp(token[1].fullstring,"zero") == 0) {
+          strcpy(map_asu_x,token[2].fullstring);
+          strcpy(map_asu_y,token[3].fullstring);
+          strcpy(map_asu_z,token[4].fullstring);
+        } else if (strcmp(token[1].fullstring,"ccp4") == 0) {
+          strcpy(map_asu_ccp4_x,token[2].fullstring);
+          strcpy(map_asu_ccp4_y,token[3].fullstring);
+          strcpy(map_asu_ccp4_z,token[4].fullstring);
+        }
+      }
+
+      if (ccp4_keymatch(key, "symop")) {
+        strcpy(sg_symop[sg_nsymp++],filerec+6);
+      }
+
+      if (ccp4_keymatch(key, "cenop")) {
+        strcpy(sg_cenop[sg_num_cent++],filerec+6);
+      }
+
+      if (ccp4_keymatch(key, "end_spacegroup")) {
+        /* end of spacegroup block, so check if right one */
+        if (numspg) {
+          if (sg_num == numspg)
+            break;
+        } else if (ccp4numspg) {
+          if (sg_ccp4_num == ccp4numspg)
+            break;
+        } else if (spgname) {
+          if (ccp4spg_name_equal_to_lib(sg_symbol_xHM,spgname))
+            break;
+        } else if (ccp4spgname) {
+          if (ccp4spg_name_equal_to_lib(sg_symbol_old,ccp4spgname))
+            break;
+          if (ccp4spg_name_equal_to_lib(sg_symbol_xHM,ccp4spgname))
+            break;
+        } else if (symops_provided) {
+          nsym2 = sg_nsymp*sg_num_cent;
+          if (nsym2 == nsym1) {
+            op2 = (ccp4_symop *) ccp4_utils_malloc(nsym2*sizeof(ccp4_symop));
+            for (i = 0; i < sg_num_cent; ++i) {
+             symop_to_mat4(sg_cenop[i],sg_cenop[i]+strlen(sg_cenop[i]),cent_ops[0]);
+             for (j = 0; j < sg_nsymp; ++j) {
+              symop_to_mat4(sg_symop[j],sg_symop[j]+strlen(sg_symop[j]),rot2[0]);
+              ccp4_4matmul(rot1,(const float (*)[4])cent_ops,(const float (*)[4])rot2);
+              op2[i*sg_nsymp+j] = mat4_to_rotandtrn((const float (*)[4])rot1);
+	      /* combination of primitive and centering operators can 
+                 produce translations greater than one. */
+              ccp4spg_norm_trans(&op2[i*sg_nsymp+j]);
+	     }
+            }
+	    /* op3 are requested operators and op2 are from SYMINFO file */
+            if (ccp4_spgrp_equal(nsym1,op3,nsym2,op2)) {
+              if (debug) printf(" ops match for sg %d ! \n",sg_num);
+              free(op2);
+              break;
+            }
+	    free(op2);
+	  }
+        }
+        sg_nsymp = 0;
+        sg_num_cent = 0;
+        sg_symbol_xHM[0]='\0';
+        sg_symbol_old[0]='\0';
+      }
+    }
+  }
+  if (symops_provided) free(op3);
+
+  if (debug) 
+    printf(" parser finished \n");
+
+  /* Finished with the parser array */
+  ccp4_parse_end(parser);
+  fclose(filein);
+
+  if (!sg_nsymp) {
+    printf(" Failed to find spacegroup in SYMINFO! \n");
+    return NULL;
+  } 
+
+  /* extract various symbols for spacegroup */
+  spacegroup->spg_num = sg_num;
+  spacegroup->spg_ccp4_num = sg_ccp4_num;
+  strcpy(spacegroup->symbol_Hall,sg_symbol_Hall);
+  strcpy(spacegroup->symbol_xHM,sg_symbol_xHM);
+  strcpy(spacegroup->symbol_old,sg_symbol_old);
+  strcpy(spacegroup->point_group,"PG");
+  strcpy(spacegroup->point_group+2,sg_point_group);
+
+  if (debug) 
+    printf(" Read in details of spacegroup %d %d \n",sg_num,sg_ccp4_num);
+
+  /* change of basis */
+  if (debug) 
+    printf(" Change of basis %s \n",sg_basisop);
+  symop_to_mat4(sg_basisop,sg_basisop+strlen(sg_basisop),sg_chb[0]);
+  for (i = 0; i < 3; ++i) {
+   for (j = 0; j < 3; ++j) {
+    spacegroup->chb[i][j] = sg_chb[i][j];
+   }
+  }
+  if (debug)
+    for (k = 0; k < 3; ++k) 
+      printf("chb: %f %f %f\n",spacegroup->chb[k][0],
+           spacegroup->chb[k][1],spacegroup->chb[k][2]);
+
+  /* symmetry operators */
+  spacegroup->nsymop_prim = sg_nsymp;
+  spacegroup->nsymop = sg_nsymp*sg_num_cent;
+  spacegroup->symop = (ccp4_symop *) ccp4_utils_malloc(spacegroup->nsymop*sizeof(ccp4_symop));
+  spacegroup->invsymop = (ccp4_symop *) ccp4_utils_malloc(spacegroup->nsymop*sizeof(ccp4_symop));
+  if (symops_provided) {
+   for (i = 0; i < nsym1; ++i) {
+    opinv = ccp4_symop_invert(op1[i]);
+    for (k = 0; k < 3; ++k) {
+      for (l = 0; l < 3; ++l) {
+        spacegroup->symop[i].rot[k][l]=op1[i].rot[k][l];
+        spacegroup->invsymop[i].rot[k][l]=opinv.rot[k][l];
+      }
+      spacegroup->symop[i].trn[k] = op1[i].trn[k];
+      spacegroup->invsymop[i].trn[k] = opinv.trn[k];
+    }
+   }
+  } else {
+   for (i = 0; i < sg_num_cent; ++i) {
+    symop_to_mat4(sg_cenop[i],sg_cenop[i]+strlen(sg_cenop[i]),cent_ops[0]);
+    for (j = 0; j < sg_nsymp; ++j) {
+     strncpy(filerec,sg_symop[j],80);   /* symop_to_mat4 overwrites later sg_symop */
+     symop_to_mat4(filerec,filerec+strlen(filerec),rot2[0]);
+     ccp4_4matmul(rot1,(const float (*)[4])cent_ops,(const float (*)[4])rot2);
+     invert4matrix((const float (*)[4])rot1,rot2);
+     for (k = 0; k < 3; ++k) {
+      for (l = 0; l < 3; ++l) {
+        spacegroup->symop[i*sg_nsymp+j].rot[k][l]=rot1[k][l];
+        spacegroup->invsymop[i*sg_nsymp+j].rot[k][l]=rot2[k][l];
+      }
+      spacegroup->symop[i*sg_nsymp+j].trn[k] = rot1[k][3];
+      spacegroup->invsymop[i*sg_nsymp+j].trn[k] = rot2[k][3];
+     }
+     /* unless symops have been provided, store normalised operators */
+     ccp4spg_norm_trans(&spacegroup->symop[i*sg_nsymp+j]);
+     ccp4spg_norm_trans(&spacegroup->invsymop[i*sg_nsymp+j]);
+    }
+   }
+  }
+  if (debug) 
+   for (i = 0; i < sg_num_cent; ++i) 
+    for (j = 0; j < sg_nsymp; ++j) {
+     for (k = 0; k < 3; ++k) 
+      printf("rot/trn: %f %f %f %f\n",spacegroup->symop[i*sg_nsymp+j].rot[k][0],
+           spacegroup->symop[i*sg_nsymp+j].rot[k][1],
+           spacegroup->symop[i*sg_nsymp+j].rot[k][2],
+           spacegroup->symop[i*sg_nsymp+j].trn[k]);
+     for (k = 0; k < 3; ++k) 
+      printf("inv rot/trn: %f %f %f %f\n",spacegroup->invsymop[i*sg_nsymp+j].rot[k][0],
+           spacegroup->invsymop[i*sg_nsymp+j].rot[k][1],
+           spacegroup->invsymop[i*sg_nsymp+j].rot[k][2],
+           spacegroup->invsymop[i*sg_nsymp+j].trn[k]);
+    }
+
+  /* reciprocal asymmetric unit */
+  strcpy(spacegroup->asu_descr,sg_asu_descr);
+
+  /* Select ASU function (referred to default basis) from asu desc */
+  /* Also infer Laue and Patterson groups. This uses additional
+     information from spacegroup name. In general, we use Hall symbol
+     because syminfo.lib is missing a few xHM symbols. However, we
+     need to use the latter for R vs. H settings. */
+  ierr = 1;
+  ilaue = 1;
+
+  if ( strcmp( sg_asu_descr, "l>0 or (l==0 and (h>0 or (h==0 and k>=0)))" ) == 0 ) {
+     spacegroup->asufn = &ASU_1b;
+     ilaue = ccp4spg_load_laue(spacegroup,3);
+     spacegroup->npatt = 2;
+     strcpy(spacegroup->patt_name,"P-1");
+     ierr = 0;
+  }
+  if ( strcmp( sg_asu_descr, "k>=0 and (l>0 or (l=0 and h>=0))" ) == 0 ) {
+     spacegroup->asufn = &ASU_2_m;
+     ilaue = ccp4spg_load_laue(spacegroup,4);
+     if (strchr(spacegroup->symbol_Hall,'P')) {
+       spacegroup->npatt = 10;
+       strcpy(spacegroup->patt_name,"P2/m");
+     } else if (strchr(spacegroup->symbol_Hall,'C')) {
+       spacegroup->npatt = 12;
+       strcpy(spacegroup->patt_name,"C2/m");
+     }
+     ierr = 0;
+  }
+  if ( strcmp( sg_asu_descr, "h>=0 and k>=0 and l>=0" ) == 0 ) {
+     spacegroup->asufn = &ASU_mmm;
+     ilaue = ccp4spg_load_laue(spacegroup,6);
+     if (strchr(spacegroup->symbol_Hall,'P')) {
+       spacegroup->npatt = 47;
+       strcpy(spacegroup->patt_name,"Pmmm");
+     } else if (strchr(spacegroup->symbol_Hall,'C')) {
+       spacegroup->npatt = 65;
+       strcpy(spacegroup->patt_name,"Cmmm");
+     } else if (strchr(spacegroup->symbol_Hall,'I')) {
+       spacegroup->npatt = 71;
+       strcpy(spacegroup->patt_name,"Immm");
+     } else if (strchr(spacegroup->symbol_Hall,'F')) {
+       spacegroup->npatt = 69;
+       strcpy(spacegroup->patt_name,"Fmmm");
+     }
+     ierr = 0;
+  }
+  if ( strcmp( sg_asu_descr, "l>=0 and ((h>=0 and k>0) or (h=0 and k=0))" ) == 0  &&
+       strcmp( sg_patt_group, "4/m" ) == 0 ) {
+     spacegroup->asufn = &ASU_4_m;
+     ilaue = ccp4spg_load_laue(spacegroup,7);
+     spacegroup->nlaue = 7;
+     strcpy(spacegroup->laue_name,"4/m");
+     spacegroup->laue_sampling[0] = 4;
+     spacegroup->laue_sampling[1] = 4;
+     spacegroup->laue_sampling[2] = 8;
+     if (strchr(spacegroup->symbol_Hall,'P')) {
+       spacegroup->npatt = 83;
+       strcpy(spacegroup->patt_name,"P4/m");
+     } else if (strchr(spacegroup->symbol_Hall,'I')) {
+       spacegroup->npatt = 87;
+       strcpy(spacegroup->patt_name,"I4/m");
+     }
+     ierr = 0;
+  }
+  if ( strcmp( sg_asu_descr, "h>=k and k>=0 and l>=0" ) == 0 &&
+       strcmp( sg_patt_group, "4/mmm" ) == 0 ) {
+     spacegroup->asufn = &ASU_4_mmm;
+     ilaue = ccp4spg_load_laue(spacegroup,8);
+     if (strchr(spacegroup->symbol_Hall,'P')) {
+       spacegroup->npatt = 123;
+       strcpy(spacegroup->patt_name,"P4/mmm");
+     } else if (strchr(spacegroup->symbol_Hall,'I')) {
+       spacegroup->npatt = 139;
+       strcpy(spacegroup->patt_name,"I4/mmm");
+     }
+     ierr = 0;
+  }
+  if ( strcmp( sg_asu_descr, "(h>=0 and k>0) or (h=0 and k=0 and l>=0)" ) == 0 ) {
+     spacegroup->asufn = &ASU_3b;
+     ilaue = ccp4spg_load_laue(spacegroup,9);
+     if (strchr(spacegroup->symbol_Hall,'P')) {
+       spacegroup->npatt = 147;
+       strcpy(spacegroup->patt_name,"P-3");
+     } else if (strchr(spacegroup->symbol_xHM,'H')) {
+       /* this is special case, as Hall doesn't specify H */
+       spacegroup->npatt = 148;
+       strcpy(spacegroup->patt_name,"H-3");
+     } else if (strchr(spacegroup->symbol_Hall,'R')) {
+       spacegroup->npatt = 1148;
+       strcpy(spacegroup->patt_name,"R-3");
+     }
+     ierr = 0;
+  }
+  if ( strcmp( sg_asu_descr, "h>=k and k>=0 and (k>0 or l>=0)" ) == 0 ) {
+     spacegroup->asufn = &ASU_3bm;
+     ilaue = ccp4spg_load_laue(spacegroup,10);
+     spacegroup->npatt = 162;
+     strcpy(spacegroup->patt_name,"P-31m");
+     ierr = 0;
+  }
+  if ( strcmp( sg_asu_descr, "h>=k and k>=0 and (h>k or l>=0)" ) == 0 ) {
+     spacegroup->asufn = &ASU_3bmx;
+     ilaue = ccp4spg_load_laue(spacegroup,11);
+     if (strchr(spacegroup->symbol_Hall,'P')) {
+       spacegroup->npatt = 164;
+       strcpy(spacegroup->patt_name,"P-3m1");
+     } else if (strchr(spacegroup->symbol_xHM,'H')) {
+       /* this is special case, as Hall doesn't specify H */
+       spacegroup->npatt = 166;
+       strcpy(spacegroup->patt_name,"H-3m");
+     } else if (strchr(spacegroup->symbol_Hall,'R')) {
+       spacegroup->npatt = 1166;
+       strcpy(spacegroup->patt_name,"R-3m");
+     }
+     ierr = 0;
+  }
+  if ( strcmp( sg_asu_descr, "l>=0 and ((h>=0 and k>0) or (h=0 and k=0))" ) == 0 &&
+       strcmp( sg_patt_group, "6/m" ) == 0 ) {
+     spacegroup->asufn = &ASU_6_m;
+     ilaue = ccp4spg_load_laue(spacegroup,12);
+     spacegroup->npatt = 175;
+     strcpy(spacegroup->patt_name,"P6/m");
+     ierr = 0;
+  }
+  if ( strcmp( sg_asu_descr, "h>=k and k>=0 and l>=0" ) == 0 &&
+       strcmp( sg_patt_group, "6/mmm" ) == 0 ) {
+     spacegroup->asufn = &ASU_6_mmm;
+     ilaue = ccp4spg_load_laue(spacegroup,13);
+     spacegroup->nlaue = 13;
+     strcpy(spacegroup->laue_name,"6/mmm");
+     spacegroup->laue_sampling[0] = 6;
+     spacegroup->laue_sampling[1] = 6;
+     spacegroup->laue_sampling[2] = 12;
+     spacegroup->npatt = 191;
+     strcpy(spacegroup->patt_name,"P6/mmm");
+     ierr = 0;
+  }
+  if ( strcmp( sg_asu_descr, "h>=0 and ((l>=h and k>h) or (l=h and k=h))" ) == 0 ) {
+     spacegroup->asufn = &ASU_m3b;
+     ilaue = ccp4spg_load_laue(spacegroup,14);
+     if (strchr(spacegroup->symbol_Hall,'P')) {
+       spacegroup->npatt = 200;
+       strcpy(spacegroup->patt_name,"Pm-3");
+     } else if (strchr(spacegroup->symbol_Hall,'I')) {
+       spacegroup->npatt = 204;
+       strcpy(spacegroup->patt_name,"Im-3");
+     } else if (strchr(spacegroup->symbol_Hall,'F')) {
+       spacegroup->npatt = 202;
+       strcpy(spacegroup->patt_name,"Fm-3");
+     }
+     ierr = 0;
+  }
+  if ( strcmp( sg_asu_descr, "k>=l and l>=h and h>=0" ) == 0 ) {
+     spacegroup->asufn = &ASU_m3bm;
+     ilaue = ccp4spg_load_laue(spacegroup,15);
+     if (strchr(spacegroup->symbol_Hall,'P')) {
+       spacegroup->npatt = 221;
+       strcpy(spacegroup->patt_name,"Pm-3m");
+     } else if (strchr(spacegroup->symbol_Hall,'I')) {
+       spacegroup->npatt = 229;
+       strcpy(spacegroup->patt_name,"Im-3m");
+     } else if (strchr(spacegroup->symbol_Hall,'F')) {
+       spacegroup->npatt = 225;
+       strcpy(spacegroup->patt_name,"Fm-3m");
+     }
+     ierr = 0;
+  }
+
+  /* Raise an error if failed to match the ASU description */
+  if (ierr) {
+    ccp4_signal(CSYM_ERRNO(CSYMERR_NoAsuDefined),"ccp4spg_load_spacegroup",NULL);
+    if (spacegroup) free(spacegroup);
+    return NULL;
+  }
+
+  /* Raise an error if failed to match the Laue code */
+  if (ilaue) {
+    ccp4_signal(CSYM_ERRNO(CSYMERR_NoLaueCodeDefined),"ccp4spg_load_spacegroup",NULL);
+    if (spacegroup) free(spacegroup);
+    return NULL;
+  }
+
+  /* real asymmetric unit */
+  /* origin-based choice */
+  sprintf(spacegroup->mapasu_zero_descr,"%s %s %s",map_asu_x,map_asu_y,map_asu_z);
+  range_to_limits(map_asu_x, limits);
+  spacegroup->mapasu_zero[0] = limits[1];
+  range_to_limits(map_asu_y, limits);
+  spacegroup->mapasu_zero[1] = limits[1];
+  range_to_limits(map_asu_z, limits);
+  spacegroup->mapasu_zero[2] = limits[1];
+  /* CCP4 choice a la SETLIM - defaults to origin-based choice */
+  range_to_limits(map_asu_ccp4_x, limits);
+  if (limits[1] > 0) {
+    sprintf(spacegroup->mapasu_ccp4_descr,"%s %s %s",map_asu_ccp4_x,map_asu_ccp4_y,map_asu_ccp4_z);
+    spacegroup->mapasu_ccp4[0] = limits[1];
+    range_to_limits(map_asu_ccp4_y, limits);
+    spacegroup->mapasu_ccp4[1] = limits[1];
+    range_to_limits(map_asu_ccp4_z, limits);
+    spacegroup->mapasu_ccp4[2] = limits[1];
+  } else {
+    strcpy(spacegroup->mapasu_ccp4_descr,spacegroup->mapasu_zero_descr);
+    spacegroup->mapasu_ccp4[0] = spacegroup->mapasu_zero[0];
+    spacegroup->mapasu_ccp4[1] = spacegroup->mapasu_zero[1];
+    spacegroup->mapasu_ccp4[2] = spacegroup->mapasu_zero[2];
+  }
+  if (debug) {
+    printf(" mapasu limits %f %f %f \n",spacegroup->mapasu_zero[0],
+	   spacegroup->mapasu_zero[1],spacegroup->mapasu_zero[2]);
+    printf(" CCP4 mapasu limits %f %f %f \n",spacegroup->mapasu_ccp4[0],
+	   spacegroup->mapasu_ccp4[1],spacegroup->mapasu_ccp4[2]);
+  }
+
+  /* set up centric and epsilon zones for this spacegroup */
+  ccp4spg_set_centric_zones(spacegroup);
+  ccp4spg_set_epsilon_zones(spacegroup);
+
+  if (debug) 
+    printf(" Leaving ccp4spg_load_spacegroup \n");
+
+  return spacegroup;
+}
+
+void ccp4spg_free(CCP4SPG **sp) {
+  free ((*sp)->symop);
+  free ((*sp)->invsymop);
+  free (*sp);
+  *sp=NULL;
+}
+
+int ccp4_spg_get_centering(const char *symbol_Hall, float cent_ops[4][3])
+{
+  int debug=0;
+  int i,j;
+
+  for (i = 0; i < 4; ++i) 
+   for (j = 0; j < 3; ++j) 
+    cent_ops[i][j] = 0.0;
+
+  if (strchr(symbol_Hall,'P')) {
+    if (debug) printf("Primitive \n");
+    return 1;
+  } else if (strchr(symbol_Hall,'A')) {
+    if (debug) printf("A centering \n");
+    cent_ops[1][1] = 0.5;
+    cent_ops[1][2] = 0.5;
+    return 2;
+  } else if (strchr(symbol_Hall,'B')) {
+    if (debug) printf("B centering \n");
+    cent_ops[1][0] = 0.5;
+    cent_ops[1][2] = 0.5;
+    return 2;
+  } else if (strchr(symbol_Hall,'C')) {
+    if (debug) printf("C centering \n");
+    cent_ops[1][0] = 0.5;
+    cent_ops[1][1] = 0.5;
+    return 2;
+  } else if (strchr(symbol_Hall,'F')) {
+    if (debug) printf("F centering \n");
+    cent_ops[1][1] = 0.5;
+    cent_ops[1][2] = 0.5;
+    cent_ops[2][0] = 0.5;
+    cent_ops[2][2] = 0.5;
+    cent_ops[3][0] = 0.5;
+    cent_ops[3][1] = 0.5;
+    return 4;
+  } else if (strchr(symbol_Hall,'I')) {
+    if (debug) printf("I centering \n");
+    cent_ops[1][0] = 0.5;
+    cent_ops[1][1] = 0.5;
+    cent_ops[1][2] = 0.5;
+    return 2;
+  } else if (strchr(symbol_Hall,'H')) {
+    /* fixme: Hall doesn't specify H, whereas xHM does */
+    if (debug) printf("H centering \n");
+    cent_ops[1][0] = 2.0/3.0;
+    cent_ops[1][1] = 1.0/3.0;
+    cent_ops[1][2] = 1.0/3.0;
+    cent_ops[2][0] = 1.0/3.0;
+    cent_ops[2][1] = 2.0/3.0;
+    cent_ops[2][2] = 2.0/3.0;
+    return 3;
+  } else if (strchr(symbol_Hall,'R')) {
+    if (debug) printf("R centering \n");
+    return 1;
+  }
+  return 0;
+}
+
+/* standard asu tests for 11 Laue classes */
+
+int ASU_1b   (const int h, const int k, const int l)
+  { return (l>0 || (l==0 && (h>0 || (h==0 && k>=0)))); }
+int ASU_2_m  (const int h, const int k, const int l)
+  { return (k>=0 && (l>0 || (l==0 && h>=0))); }
+int ASU_mmm  (const int h, const int k, const int l)
+  { return (h>=0 && k>=0 && l>=0); }
+int ASU_4_m  (const int h, const int k, const int l)
+  { return (l>=0 && ((h>=0 && k>0) || (h==0 && k==0))); }
+int ASU_4_mmm(const int h, const int k, const int l)
+  { return (h>=k && k>=0 && l>=0); }
+int ASU_3b   (const int h, const int k, const int l)
+  { return (h>=0 && k>0) || (h==0 && k==0 && l >= 0); }
+int ASU_3bm  (const int h, const int k, const int l)
+  { return (h>=k && k>=0 && (k>0 || l>=0)); }
+int ASU_3bmx (const int h, const int k, const int l)
+  { return (h>=k && k>=0 && (h>k || l>=0)); }
+int ASU_6_m  (const int h, const int k, const int l)
+  { return (l>=0 && ((h>=0 && k>0) || (h==0 && k==0))); }
+int ASU_6_mmm(const int h, const int k, const int l)
+  { return (h>=k && k>=0 && l>=0); }
+int ASU_m3b  (const int h, const int k, const int l)
+  { return (h>=0 && ((l>=h && k>h) || (l==h && k==h))); }
+int ASU_m3bm  (const int h, const int k, const int l)
+  { return (h>=0 && k>=l && l>=h); }
+
+char *ccp4spg_symbol_Hall(CCP4SPG* sp) {
+  if (!sp) {  
+    ccp4_signal(CSYM_ERRNO(CSYMERR_NullSpacegroup),"ccp4spg_symbol_Hall",NULL); 
+    return NULL;
+  }
+  return sp->symbol_Hall; 
+}
+
+ccp4_symop ccp4_symop_invert( const ccp4_symop op1 )
+{
+  float rot1[4][4],rot2[4][4];
+
+  rotandtrn_to_mat4(rot1,op1);
+  invert4matrix((const float (*)[4])rot1,rot2);
+  return (mat4_to_rotandtrn((const float (*)[4])rot2));
+}
+
+int ccp4spg_name_equal(const char *spgname1, const char *spgname2) {
+
+  char *ch1, *ch2, *spgname1_upper, *spgname2_upper;
+
+  /* create copies of input strings, and convert to upper case */
+  spgname1_upper = strdup(spgname1);
+  strtoupper(spgname1_upper,spgname1);
+  spgname2_upper = strdup(spgname2);
+  strtoupper(spgname2_upper,spgname2);
+
+  ch1 = spgname1_upper;
+  ch2 = spgname2_upper;
+  while (*ch1 == *ch2) {
+    if (*ch1 == '\0' && *ch2 == '\0') {
+      free(spgname1_upper);
+      free(spgname2_upper);
+      return 1;
+    }
+    ++ch1;
+    ++ch2;
+  }
+  free(spgname1_upper);
+  free(spgname2_upper);
+  return 0;
+}
+
+int ccp4spg_name_equal_to_lib(const char *spgname_lib, const char *spgname_match) {
+
+  char *ch1, *ch2, *spgname1_upper, *spgname2_upper, *tmpstr;
+  int have_one_1=0, have_one_2=0;
+
+  /* create copies of input strings, convert to upper case, and
+     deal with colons */
+  spgname1_upper = strdup(spgname_lib);
+  strtoupper(spgname1_upper,spgname_lib);
+  ccp4spg_name_de_colon(spgname1_upper);
+  spgname2_upper = strdup(spgname_match);
+  strtoupper(spgname2_upper,spgname_match);
+  ccp4spg_name_de_colon(spgname2_upper);
+
+  /* see if strings are equal, except for spaces */
+  ch1 = spgname1_upper;
+  ch2 = spgname2_upper;
+  while (*ch1 == *ch2) {
+    if (*ch1 == '\0' && *ch2 == '\0') {
+      free(spgname1_upper);
+      free(spgname2_upper);
+      return 1;
+    }
+    while (*(++ch1) == ' ') ;
+    while (*(++ch2) == ' ') ;
+  }
+
+  /* if that didn't work, and spgname_match is a short name, try removing
+     " 1 " from spgname_lib, and matching again. This would match P21 to
+     'P 1 21 1' for instance. */
+
+  /* try to identify if "short names" are being used. */
+  if (strstr(spgname1_upper," 1 ")) have_one_1 = 1;
+  if (strstr(spgname2_upper," 1 ")) have_one_2 = 1; 
+  /* if spgname_lib has " 1 " and spgname_match doesn't, then strip
+     out " 1" to do "short" comparison */
+  if (have_one_1 && ! have_one_2) {
+     tmpstr = strdup(spgname1_upper);
+     ccp4spg_to_shortname(tmpstr,spgname1_upper);
+     strcpy(spgname1_upper,tmpstr);
+     free(tmpstr);
+  }
+
+  /* see if strings are equal, except for spaces */
+  ch1 = spgname1_upper;
+  ch2 = spgname2_upper;
+  while (*ch1 == *ch2) {
+    if (*ch1 == '\0' && *ch2 == '\0') {
+      free(spgname1_upper);
+      free(spgname2_upper);
+      return 1;
+    }
+    while (*(++ch1) == ' ') ;
+    while (*(++ch2) == ' ') ;
+  }
+
+  free(spgname1_upper);
+  free(spgname2_upper);
+  return 0;
+}
+
+char *ccp4spg_to_shortname(char *shortname, const char *longname) {
+
+  const char *ch1;
+  char *ch2;
+  int trigonal=0;
+
+  ch1 = longname;
+  ch2 = shortname;
+
+  /* "P 1" is an exception */
+  if (!strcmp(ch1,"P 1")) {
+    strcpy(ch2,"P1");
+    return  ch2;
+  }
+
+  /* trigonal are another exception, don't want to lose significant " 1" */
+  if (!strncmp(ch1,"P 3",3) || !strncmp(ch1,"P -3",4) || !strncmp(ch1,"R 3",3) || !strncmp(ch1,"R -3",4)) trigonal=1;
+
+  while (*ch1 != '\0') {
+    if (!trigonal && !strncmp(ch1," 1",2)) {
+      ch1 += 2;
+    } else {
+      /* take out blanks - note check for " 1" takes precedence */
+      while (*ch1 == ' ') ++ch1;
+      if (*ch1 != '\0') { *ch2 = *ch1; ++ch2; ++ch1; }
+    }
+  }
+  *ch2 = '\0';
+  return ch2;
+}
+
+void ccp4spg_name_de_colon(char *name) {
+
+  char *ch1;
+
+  /* various spacegroup names have settings specified by colon. We'll
+     deal with these on a case-by-case basis. */
+  if (ch1 = strstr(name,":R")) {
+  /* :R spacegroup should be R already so just replace with blanks */
+    *ch1 = ' ';
+    *(ch1+1) = ' ';
+  } else if (ch1 = strstr(name,":H")) {
+  /* :H spacegroup should be R so change to H */
+    *ch1 = ' ';
+    *(ch1+1) = ' ';
+    ch1 = strstr(name,"R");
+    if (ch1 != NULL) *ch1 = 'H';
+  }
+    
+  return;
+}
+
+int ccp4spg_pgname_equal(const char *pgname1, const char *pgname2) {
+
+  char *ch1, *ch2, *pgname1_upper, *pgname2_upper;
+
+  pgname1_upper = strdup(pgname1);
+  strtoupper(pgname1_upper,pgname1);
+  pgname2_upper = strdup(pgname2);
+  strtoupper(pgname2_upper,pgname2);
+
+  ch1 = pgname1_upper;
+  if (pgname1_upper[0] == 'P' && pgname1_upper[1] == 'G') ch1 += 2;
+  ch2 = pgname2_upper;
+  if (pgname2_upper[0] == 'P' && pgname2_upper[1] == 'G') ch2 += 2;
+  while (*ch1 == *ch2) {
+    if (*ch1 == '\0' && *ch2 == '\0') {
+      free(pgname1_upper);
+      free(pgname2_upper);
+      return 1;
+    }
+    while (*(++ch1) == ' ') ;
+    while (*(++ch2) == ' ') ;
+  }
+  free(pgname1_upper);
+  free(pgname2_upper);
+  return 0;
+}
+
+ccp4_symop *ccp4spg_norm_trans(ccp4_symop *op) {
+
+  int i;
+
+  for ( i = 0; i < 3; i++ ) {
+    while (op->trn[i] < 0.0) op->trn[i] += 1.0;
+    while (op->trn[i] >= 1.0) op->trn[i] -= 1.0;
+  }
+
+  return op;
+}
+
+int ccp4_spgrp_equal( int nsym1, const ccp4_symop *op1, int nsym2, const ccp4_symop *op2 )
+{
+  int i, n;
+  int *symcode1, *symcode2;
+
+  /* first check that we have equal number of symops */
+  if ( nsym1 != nsym2 ) return 0;
+
+  n = nsym1;
+
+  /* now make the sym code arrays */
+  symcode1 = ccp4_utils_malloc( n * sizeof(int) );
+  symcode2 = ccp4_utils_malloc( n * sizeof(int) );
+  for ( i = 0; i < n; i++ ) {
+    symcode1[i] = ccp4_symop_code( op1[i] );
+    symcode2[i] = ccp4_symop_code( op2[i] );
+  }
+  /* sort the symcodes */
+  /* Kevin suggests maybe just compare all pairs rather than sort */
+  qsort( symcode1, n, sizeof(int), &ccp4_int_compare );
+  qsort( symcode2, n, sizeof(int), &ccp4_int_compare );
+  /* compare the symcodes */
+  for ( i = 0; i < n; i++ ) {
+    if ( symcode1[i] != symcode2[i] ) break;
+  }
+  /* delete the symcodes */
+  free(symcode1);
+  free(symcode2);
+
+  /* return true if they are equal */
+  return ( i == n );
+}
+
+int ccp4_spgrp_equal_order( int nsym1, const ccp4_symop *op1, int nsym2, const ccp4_symop *op2 )
+{
+  int i;
+
+  /* first check that we have equal number of symops */
+  if ( nsym1 != nsym2 ) return 0;
+
+  /* compare the symcodes */
+  for ( i = 0; i < nsym1; i++ ) {
+    if ( ccp4_symop_code( op1[i] ) != ccp4_symop_code( op2[i] ) ) break;
+  }
+
+  /* return true if they are equal */
+  return ( i == nsym1 );
+}
+
+int ccp4_symop_code(ccp4_symop op)
+{
+  int i, j, code=0;
+  for ( i=0; i<3; i++ )
+    for ( j=0; j<3; j++ )
+      code = ( code << 2 ) | ( (int) rint( op.rot[i][j] ) & 0x03 ) ;
+  for ( i=0; i<3; i++ )
+    code = ( code << 4 ) | ( (int) rint( op.trn[i]*12.0 ) & 0x0f ) ;
+  return code;
+}
+
+int ccp4_int_compare( const void *p1, const void *p2 )
+{
+  return ( *((int*)p1) - *((int*)p2) );
+}
+
+int ccp4spg_is_in_pm_asu(const CCP4SPG* sp, const int h, const int k, const int l) {
+  if (ccp4spg_is_in_asu(sp,h,k,l)) return (1);
+  if (ccp4spg_is_in_asu(sp,-h,-k,-l)) return (-1);
+  return 0;
+}
+
+int ccp4spg_is_in_asu(const CCP4SPG* sp, const int h, const int k, const int l) {
+  if (!sp) {  
+    ccp4_signal(CSYM_ERRNO(CSYMERR_NullSpacegroup),"ccp4spg_is_in_asu",NULL); 
+    return 0;
+  }
+  if ( ccp4spg_do_chb(sp->chb) ) return sp->asufn(
+      (int) rint( h*sp->chb[0][0] + k*sp->chb[1][0] + l*sp->chb[2][0] ),
+      (int) rint( h*sp->chb[0][1] + k*sp->chb[1][1] + l*sp->chb[2][1] ),
+      (int) rint( h*sp->chb[0][2] + k*sp->chb[1][2] + l*sp->chb[2][2] ) );
+  else
+    return sp->asufn( h, k, l );
+}
+
+int ccp4spg_put_in_asu(const CCP4SPG* sp, const int hin, const int kin, const int lin,
+		       int *hout, int *kout, int *lout ) {
+
+  int i, isign;
+
+  if (!sp) {  
+    ccp4_signal(CSYM_ERRNO(CSYMERR_NullSpacegroup),"ccp4spg_put_in_asu",NULL); 
+    return 0;
+  }
+
+  /* cycle through all primitive symmetry operations until in asu */
+
+  for (i = 0; i < sp->nsymop_prim; ++i) {
+    *hout = (int) rint( hin*sp->symop[i].rot[0][0] + kin*sp->symop[i].rot[1][0] + 
+                        lin*sp->symop[i].rot[2][0] ); 
+    *kout = (int) rint( hin*sp->symop[i].rot[0][1] + kin*sp->symop[i].rot[1][1] + 
+                        lin*sp->symop[i].rot[2][1] ); 
+    *lout = (int) rint( hin*sp->symop[i].rot[0][2] + kin*sp->symop[i].rot[1][2] + 
+                        lin*sp->symop[i].rot[2][2] ); 
+    if (isign = ccp4spg_is_in_pm_asu(sp,*hout,*kout,*lout)) {
+      *hout = *hout * isign;
+      *kout = *kout * isign;
+      *lout = *lout * isign;
+      return ( (isign > 0) ? 2*i+1 : 2*i+2 );
+    }
+  }
+
+  printf ("Can't put in asu ! \n");
+  return 0;
+}
+
+/* Generate indices according to symmetry operation isym */
+
+void ccp4spg_generate_indices(const CCP4SPG* sp, const int isym,
+                  const int hin, const int kin, const int lin,
+		       int *hout, int *kout, int *lout ) {
+
+  int jsym, isign;
+
+  if (!sp) {  
+    ccp4_signal(CSYM_ERRNO(CSYMERR_NullSpacegroup),"ccp4spg_generate_indices",NULL); 
+    return;
+  }
+
+  jsym = (isym - 1) / 2;
+  isign = (isym % 2) ? 1 : -1 ; 
+
+  *hout = isign * (int) rint(hin*sp->invsymop[jsym].rot[0][0] + 
+       kin*sp->invsymop[jsym].rot[1][0] + lin*sp->invsymop[jsym].rot[2][0]); 
+  *kout = isign * (int) rint(hin*sp->invsymop[jsym].rot[0][1] + 
+       kin*sp->invsymop[jsym].rot[1][1] + lin*sp->invsymop[jsym].rot[2][1]); 
+  *lout = isign * (int) rint(hin*sp->invsymop[jsym].rot[0][2] + 
+       kin*sp->invsymop[jsym].rot[1][2] + lin*sp->invsymop[jsym].rot[2][2]); 
+
+}
+
+/* shift phase value associated with hin,kin,lin according to translation 
+and optional sign change. Return in range 0,360 */
+
+float ccp4spg_phase_shift(const int hin, const int kin, const int lin,
+                const float phasin, const float trans[3], const int isign)
+{
+  double phasout;
+
+  phasout = (double) phasin;
+  if (isign == -1) phasout = - phasout;
+
+  phasout += (hin*trans[0] + kin*trans[1] + lin*trans[2]) * 360.0;
+
+  phasout = fmod(phasout,360.0);
+  if (phasout < 0.0) phasout += 360.0;
+
+  return ((float) phasout);
+
+}
+
+int ccp4spg_do_chb(const float chb[3][3]) {
+
+  return ( chb[0][0] != 1 || chb[1][1] != 1 || chb[2][2] != 1 ||
+	   chb[0][1] != 0 || chb[0][2] != 0 || chb[1][2] != 0 ||
+	   chb[1][0] != 0 || chb[2][0] != 0 || chb[2][1] != 0 );
+
+}
+
+/* functions to identify centrics - based on Randy's method */
+
+void ccp4spg_set_centric_zones(CCP4SPG* sp) {
+
+  int i,j,hnew,knew,lnew;
+  int ihkl[12][3];
+
+  if (!sp) {  
+    ccp4_signal(CSYM_ERRNO(CSYMERR_NullSpacegroup),"ccp4spg_set_centric_zones",NULL); 
+    return;
+  }
+  ihkl[0][0] = 0; ihkl[0][1] = 1; ihkl[0][2] = 2; 
+  ihkl[1][0] = 1; ihkl[1][1] = 0; ihkl[1][2] = 2; 
+  ihkl[2][0] = 1; ihkl[2][1] = 2; ihkl[2][2] = 0; 
+  ihkl[3][0] = 1; ihkl[3][1] = 1; ihkl[3][2] = 10; 
+  ihkl[4][0] = 1; ihkl[4][1] = 10; ihkl[4][2] = 1; 
+  ihkl[5][0] = 10; ihkl[5][1] = 1; ihkl[5][2] = 1; 
+  ihkl[6][0] = 1; ihkl[6][1] = -1; ihkl[6][2] = 10; 
+  ihkl[7][0] = 1; ihkl[7][1] = 10; ihkl[7][2] = -1; 
+  ihkl[8][0] = 10; ihkl[8][1] = 1; ihkl[8][2] = -1; 
+  ihkl[9][0] = -1; ihkl[9][1] = 2; ihkl[9][2] = 10; 
+  ihkl[10][0] = 2; ihkl[10][1] = -1; ihkl[10][2] = 10; 
+  ihkl[11][0] = 1; ihkl[11][1] = 4; ihkl[11][2] = 8; 
+
+  /* loop over all possible centric zones */
+  for (i = 0; i < 12; ++i) {
+   sp->centrics[i] = 0;
+   for (j = 0; j < sp->nsymop; ++j) {
+    hnew = (int) rint( ihkl[i][0]*sp->symop[j].rot[0][0] + 
+      ihkl[i][1]*sp->symop[j].rot[1][0] + ihkl[i][2]*sp->symop[j].rot[2][0] );
+    if (hnew == -ihkl[i][0]) {
+     knew = (int) rint( ihkl[i][0]*sp->symop[j].rot[0][1] + 
+       ihkl[i][1]*sp->symop[j].rot[1][1] + ihkl[i][2]*sp->symop[j].rot[2][1] );
+     if (knew == -ihkl[i][1]) {
+      lnew = (int) rint( ihkl[i][0]*sp->symop[j].rot[0][2] + 
+        ihkl[i][1]*sp->symop[j].rot[1][2] + ihkl[i][2]*sp->symop[j].rot[2][2] );
+      if (lnew == -ihkl[i][2]) {
+        sp->centrics[i] = j+1;
+        break;
+      }
+     }
+    }
+   }
+  }
+}
+
+int ccp4spg_is_centric(const CCP4SPG* sp, const int h, const int k, const int l) {
+
+  int i;
+
+  if (!sp) {  
+    ccp4_signal(CSYM_ERRNO(CSYMERR_NullSpacegroup),"ccp4spg_is_centric",NULL); 
+    return -1;
+  }
+  /* loop over all possible centric zones */
+  for (i = 0; i < 12; ++i) 
+    if (sp->centrics[i]) 
+      if (ccp4spg_check_centric_zone(i+1,h,k,l) == 0)
+        return 1;
+
+  return 0;
+}
+
+/* check indices against centric zones - return 0 if in zone "nzone" */
+
+int ccp4spg_check_centric_zone(const int nzone, const int h, const int k, const int l) {
+
+  switch (nzone) {
+  case 1:
+    return h;
+  case 2:
+    return k;
+  case 3:
+    return l;
+  case 4:
+    return h - k;
+  case 5:
+    return h - l;
+  case 6:
+    return k - l;
+  case 7:
+    return h + k;
+  case 8:
+    return h + l;
+  case 9:
+    return k + l;
+  case 10:
+    return 2*h + k;
+  case 11:
+    return h + 2*k;
+  case 12:
+    return 0;
+  }
+  printf ("Invalid nzone ! \n");
+  return 0;
+}
+
+float ccp4spg_centric_phase(const CCP4SPG* sp, const int h, const int k, const int l) {
+
+  int i,isym;
+  float centric_phase;
+
+  if (!sp) {  
+    ccp4_signal(CSYM_ERRNO(CSYMERR_NullSpacegroup),"ccp4spg_centric_phase",NULL); 
+    return 0.0;
+  }
+  /* loop over all possible centric zones */
+  for (i = 0; i < 12; ++i) 
+    if (sp->centrics[i]) 
+      if (ccp4spg_check_centric_zone(i+1,h,k,l) == 0) {
+        isym = sp->centrics[i];
+        centric_phase = h*sp->symop[isym-1].trn[0] + 
+	  k*sp->symop[isym-1].trn[1] + l*sp->symop[isym-1].trn[2];
+        centric_phase = 180.0*(centric_phase - rint(centric_phase));
+        if (centric_phase < 0.0) centric_phase = centric_phase + 180.0;
+        return centric_phase;
+      }
+
+  return 0;
+}
+
+void ccp4spg_print_centric_zones(const CCP4SPG* sp) {
+
+  int i,j=0;
+  char centric_zone[8];
+
+  if (!sp) {  
+    ccp4_signal(CSYM_ERRNO(CSYMERR_NullSpacegroup),"ccp4spg_print_centric_zones",NULL); 
+    return;
+  }
+  printf("\n  ******   CENTRIC ZONES  ****** \n\n");
+
+  /* loop over all possible centric zones */
+  for (i = 0; i < 12; ++i) 
+    if (sp->centrics[i]) {
+      printf("  CENTRIC Zone   %d\n",++j);
+      printf("  Reflections of type  %s \n\n",
+                ccp4spg_describe_centric_zone(i+1,centric_zone));
+    }
+
+  if (!j) printf("  (no centric zones for this spacegroup) \n\n");
+}
+
+char *ccp4spg_describe_centric_zone(const int nzone, char *centric_zone) {
+
+  switch (nzone) {
+  case 1:
+    return ( strcpy(centric_zone,"0kl") );
+  case 2:
+    return ( strcpy(centric_zone,"h0l") );
+  case 3:
+    return ( strcpy(centric_zone,"hk0") );
+  case 4:
+    return ( strcpy(centric_zone,"hhl") );
+  case 5:
+    return ( strcpy(centric_zone,"hkh") );
+  case 6:
+    return ( strcpy(centric_zone,"hkk") );
+  case 7:
+    return ( strcpy(centric_zone,"h -hl") );
+  case 8:
+    return ( strcpy(centric_zone,"hk -h") );
+  case 9:
+    return ( strcpy(centric_zone,"hk -k") );
+  case 10:
+    return ( strcpy(centric_zone,"-h 2h l") );
+  case 11:
+    return ( strcpy(centric_zone,"2h -h l") );
+  case 12:
+    return ( strcpy(centric_zone,"hkl") );
+  }
+  printf ("Invalid nzone ! \n");
+  return "null";
+}
+
+/* functions to identify epsilon zones - based on Randy's method */
+
+void ccp4spg_set_epsilon_zones(CCP4SPG* sp) {
+
+  int i,j,hnew,knew,lnew,neps;
+  int ihkl[13][3];
+
+  if (!sp) {  
+    ccp4_signal(CSYM_ERRNO(CSYMERR_NullSpacegroup),"ccp4spg_set_epsilon_zones",NULL); 
+    return;
+  }
+  ihkl[0][0] = 1; ihkl[0][1] = 0; ihkl[0][2] = 0; 
+  ihkl[1][0] = 0; ihkl[1][1] = 2; ihkl[1][2] = 0; 
+  ihkl[2][0] = 0; ihkl[2][1] = 0; ihkl[2][2] = 2; 
+  ihkl[3][0] = 1; ihkl[3][1] = 1; ihkl[3][2] = 0; 
+  ihkl[4][0] = 1; ihkl[4][1] = 0; ihkl[4][2] = 1; 
+  ihkl[5][0] = 0; ihkl[5][1] = 1; ihkl[5][2] = 1; 
+  ihkl[6][0] = 1; ihkl[6][1] = -1; ihkl[6][2] = 0; 
+  ihkl[7][0] = 1; ihkl[7][1] = 0; ihkl[7][2] = -1; 
+  ihkl[8][0] = 0; ihkl[8][1] = 1; ihkl[8][2] = -1; 
+  ihkl[9][0] = -1; ihkl[9][1] = 2; ihkl[9][2] = 0; 
+  ihkl[10][0] = 2; ihkl[10][1] = -1; ihkl[10][2] = 0; 
+  ihkl[11][0] = 1; ihkl[11][1] = 1; ihkl[11][2] = 1; 
+  ihkl[12][0] = 1; ihkl[12][1] = 2; ihkl[12][2] = 3; 
+
+  /* Loop over all possible epsilon zones, except the catch-all 13th. For each 
+     zone, "neps" counts the number of symmetry operators that map a representative
+     reflection "ihkl" to itself. At least the identity will do this. If any
+     more do, then this is a relevant epsilon zone. */
+  for (i = 0; i < 12; ++i) {
+   sp->epsilon[i] = 0;
+   neps = 0;
+   for (j = 0; j < sp->nsymop_prim; ++j) {
+    hnew = (int) rint( ihkl[i][0]*sp->symop[j].rot[0][0] + 
+      ihkl[i][1]*sp->symop[j].rot[1][0] + ihkl[i][2]*sp->symop[j].rot[2][0] );
+    if (hnew == ihkl[i][0]) {
+     knew = (int) rint( ihkl[i][0]*sp->symop[j].rot[0][1] + 
+       ihkl[i][1]*sp->symop[j].rot[1][1] + ihkl[i][2]*sp->symop[j].rot[2][1] );
+     if (knew == ihkl[i][1]) {
+      lnew = (int) rint( ihkl[i][0]*sp->symop[j].rot[0][2] + 
+        ihkl[i][1]*sp->symop[j].rot[1][2] + ihkl[i][2]*sp->symop[j].rot[2][2] );
+      if (lnew == ihkl[i][2]) {
+        ++neps;
+      }
+     }
+    }
+   }
+   if (neps > 1) sp->epsilon[i] = neps * (sp->nsymop/sp->nsymop_prim);
+  }
+  /* hkl zone covers all with neps of 1 */
+  sp->epsilon[12] = sp->nsymop/sp->nsymop_prim;
+}
+
+int ccp4spg_get_multiplicity(const CCP4SPG* sp, const int h, const int k, const int l) {
+
+  int i;
+
+  if (!sp) {  
+    ccp4_signal(CSYM_ERRNO(CSYMERR_NullSpacegroup),"ccp4spg_get_multiplicity",NULL); 
+    return 0;
+  }
+  /* loop over all possible epsilon zones */
+  for (i = 0; i < 13; ++i) 
+    if (sp->epsilon[i]) 
+      if (ccp4spg_check_epsilon_zone(i+1,h,k,l) == 0)
+        return sp->epsilon[i];
+
+  return 0;
+}
+
+int ccp4spg_check_epsilon_zone(const int nzone, const int h, const int k, const int l) {
+
+  int bigfac=1000;  /* this needs to be big enough to prevent accidental zeros */
+
+  switch (nzone) {
+  case 1:
+    return bigfac*k + l;
+  case 2:
+    return h + bigfac*l;
+  case 3:
+    return h + bigfac*k;
+  case 4:
+    return h - k + bigfac*l;
+  case 5:
+    return h + bigfac*k - l;
+  case 6:
+    return bigfac*h + k - l;
+  case 7:
+    return h + k + bigfac*l;
+  case 8:
+    return h + bigfac*k + l;
+  case 9:
+    return bigfac*h + k + l;
+  case 10:
+    return 2*h + k + bigfac*l;
+  case 11:
+    return h + 2*k + bigfac*l;
+  case 12:
+    return h + bigfac*k - (bigfac+1)*l;
+  case 13:
+    return 0;
+  }
+  printf ("Invalid nzone ! \n");
+  return 0;
+}
+
+void ccp4spg_print_epsilon_zones(const CCP4SPG* sp) {
+
+  int i,j=0;
+  char epsilon_zone[8];
+
+  if (!sp) {  
+    ccp4_signal(CSYM_ERRNO(CSYMERR_NullSpacegroup),"ccp4spg_print_epsilon_zones",NULL); 
+    return;
+  }
+  printf("\n  ******   EPSILON ZONES -  Reflection Classes and their multiplicity ****** \n");
+
+  /* loop over all possible epsilon zones */
+  for (i = 0; i < 13; ++i) 
+    if (sp->epsilon[i]) {
+      printf("\n  EPSILON Zone   %d\n",++j);
+      printf("  Reflections of type  %s \n",
+                ccp4spg_describe_epsilon_zone(i+1,epsilon_zone));
+      printf("  Multiplicity   %d\n",sp->epsilon[i]);
+    }
+}
+
+char *ccp4spg_describe_epsilon_zone(const int nzone, char *epsilon_zone) {
+
+  switch (nzone) {
+  case 1:
+    return ( strcpy(epsilon_zone,"h00") );
+  case 2:
+    return ( strcpy(epsilon_zone,"0k0") );
+  case 3:
+    return ( strcpy(epsilon_zone,"00l") );
+  case 4:
+    return ( strcpy(epsilon_zone,"hh0") );
+  case 5:
+    return ( strcpy(epsilon_zone,"h0h") );
+  case 6:
+    return ( strcpy(epsilon_zone,"0kk") );
+  case 7:
+    return ( strcpy(epsilon_zone,"h -h0") );
+  case 8:
+    return ( strcpy(epsilon_zone,"h0 -h") );
+  case 9:
+    return ( strcpy(epsilon_zone,"0k -k") );
+  case 10:
+    return ( strcpy(epsilon_zone,"-h 2h 0") );
+  case 11:
+    return ( strcpy(epsilon_zone,"2h -h 0") );
+  case 12:
+    return ( strcpy(epsilon_zone,"hhh") );
+  case 13:
+    return ( strcpy(epsilon_zone,"hkl") );
+  }
+  printf ("Invalid nzone ! \n");
+  return "null";
+}
+
+int ccp4spg_is_sysabs(const CCP4SPG* sp, const int h, const int k, const int l)
+{
+  int j,hnew,knew,lnew;
+  float del_phas;
+
+  if (!sp) {  
+    ccp4_signal(CSYM_ERRNO(CSYMERR_NullSpacegroup),"ccp4spg_is_sysabs",NULL); 
+    return -1;
+  }
+  if (sp->nsymop > 1) {
+   for (j = 1; j < sp->nsymop; ++j) {
+    hnew = (int) rint( h*sp->invsymop[j].rot[0][0] + k*sp->invsymop[j].rot[1][0] + 
+      l*sp->invsymop[j].rot[2][0] );
+    if (hnew == h) {
+     knew = (int) rint( h*sp->invsymop[j].rot[0][1] + k*sp->invsymop[j].rot[1][1] + 
+       l*sp->invsymop[j].rot[2][1] );
+     if (knew == k) {
+      lnew = (int) rint( h*sp->invsymop[j].rot[0][2] + k*sp->invsymop[j].rot[1][2] + 
+	l*sp->invsymop[j].rot[2][2] );
+      if (lnew == l) {
+	/* phase shift from translational component of sym op */
+        del_phas = h*sp->symop[j].trn[0] + k*sp->symop[j].trn[1] + 
+                   l*sp->symop[j].trn[2];
+        if ( fabs(del_phas - rint( del_phas )) > 0.05 ) return (1);
+      }
+     }
+    }
+   }
+  }
+  return (0);
+
+}
+
+int ccp4spg_generate_origins(const char *namspg, const int nsym, const float rsym[][4][4],
+			     float origins[][3], int *polarx, int *polary, int *polarz,
+			     const int iprint)
+{
+  int i,j,k,norigins,k1,k2,k3,alt_orig,ichk;
+  int id[6]={0,6,4,8,3,9},is[3];
+  float xin=0.13,yin=0.17,zin=0.19,xout,yout,zout,rsymd[3][3];
+
+  *polarx = *polary = *polarz = 1;
+
+  for (i = 1; i < nsym; ++i) {
+    xout = rsym[i][0][0]*xin + rsym[i][0][1]*yin + rsym[i][0][2]*zin;
+    if (fabs(xout-xin) > 0.01) *polarx = 0;
+    yout = rsym[i][1][0]*xin + rsym[i][1][1]*yin + rsym[i][1][2]*zin;
+    if (fabs(yout-yin) > 0.01) *polary = 0;
+    zout = rsym[i][2][0]*xin + rsym[i][2][1]*yin + rsym[i][2][2]*zin;
+    if (fabs(zout-zin) > 0.01) *polarz = 0;
+  }
+
+  /*  First origin is 0,0,0 */
+  norigins=1;
+  origins[0][0]=0.0;
+  origins[0][1]=0.0;
+  origins[0][2]=0.0;
+
+      /*  check which points can be an alternate origin.
+	  only six possibilities which are 0 1/2 1/3 2/3 1/4 3/4 
+          is/id expressed as twelfths */
+  for (k1 = 0; k1 < 6; ++k1) {
+    for (k2 = 0; k2 < 6; ++k2) {
+      for (k3 = 0; k3 < 6; ++k3) {
+        if (k1==0 && k2 == 0 && k3 ==0) continue;
+	is[0]=id[k1];
+	is[1]=id[k2];
+	is[2]=id[k3];
+        if ( *polarx && is[0] )  continue;
+        if ( *polary && is[1] )  continue;
+        if ( *polarz && is[2] )  continue;
+
+/*  Let [Si] =[RSYMi] be (3x4) symmetry operator.
+ Need to Check if the symmetry operator shifts of each alternate origin 
+ [ORx,ORy,ORz)  are preserved for each symmetry operator.
+ Origin (0,0,0) shifts to        Ti(1),     Ti(2)      Ti(3) 
+                           == RSYMi(1,4),RSYMi(2,4),RSYMi(3,4) 
+
+ [RSYMi] [OR]  =  [OR] + [Ti] + n[I]  = [1 0 0 RSYMi(1,4)] [OR1] +  n[I]
+                                       [0 1 0 RSYMi(2,4)] [OR2]
+                                       [0 0 1 RSYMi(3,4)] [OR3]
+
+ Hence [RSYMi(1,1) -1   RSYMi(1,2)      RSYMi(1,3)      0] [OR1]   = n[I]
+       [RSYMi(2,1)      RSYMi(2,2) -1   RSYMi(2,3)      0] [OR2] 
+       [RSYMi(3,1)      RSYMi(3,2)      RSYMi(3,3) -1   0] [OR3] 
+       [   0                0               0           1] [1  ]
+
+ Use RSYM(..1) to respresent indentity.. Enough to use 3x3 matrix.. */
+
+        alt_orig=1;
+	for (i = 1; i < nsym && alt_orig; ++i) {
+	  for (j = 0; j < 3; ++j) 
+	    for (k = 0; k < 3; ++k) 
+              rsymd[j][k] = rsym[i][j][k] - rsym[0][j][k];
+	  for (j = 0; j < 3; ++j) {
+            ichk = (int) rint( rsymd[j][0]*is[0]+rsymd[j][1]*is[1]+rsymd[j][2]*is[2] );
+            if ( ichk % 12 ) {
+              alt_orig=0;
+              break;
+	    }
+          }
+        }
+        if (alt_orig) {
+         norigins+=1;
+         origins[norigins-1][0]=is[0]/12.0;
+         origins[norigins-1][1]=is[1]/12.0;
+         origins[norigins-1][2]=is[2]/12.0;
+        }
+      }
+    }
+  }
+
+  if (iprint) {
+    if( *polarx && *polary && *polarz) {
+      printf(" this is p1: origin anywhere");
+      printf("\n %s %s %s \n",
+	     "Number of alternate origins for spacegroup:  ",namspg," is infinite.");
+    } else if( *polarx && *polary) {
+      printf(" this is a polar+ spacegroup: origin anywhere in a b plane");
+      printf("\n %s %s %s %d \n",
+     "Number of alternate origin containing planes for spacegroup:",
+       namspg, " is:",norigins);
+    } else if( *polarx && *polarz) {
+      printf(" this is a polar+ spacegroup: origin anywhere in a c plane");
+      printf("\n %s %s %s %d \n", 
+     "Number of alternate origin containing planes for spacegroup:",
+       namspg, " is:",norigins);
+    } else if( *polary && *polarz) {
+      printf(" this is a polar+ spacegroup: origin anywhere in b c plane");
+      printf("\n %s %s %s %d \n", 
+     "Number of alternate origin containing planes for spacegroup:",
+       namspg, " is:",norigins);
+    } else if( *polarx) {
+      printf(" this is a polar spacegroup: origin is not fixed along a axis");
+      printf("\n %s %s %s %d \n", 
+     "Number of alternate origin containing lines for spacegroup: ",
+       namspg, " is:",norigins);
+    } else if( *polary) {
+      printf(" this is a polar spacegroup: origin is not fixed along b axis");
+      printf("\n %s %s %s %d \n", 
+     "Number of alternate origin containing lines for spacegroup: ",
+       namspg, " is:",norigins);
+    } else if( *polarz) {
+      printf(" this is a polar spacegroup: origin is not fixed along c axis");
+      printf("\n %s %s %s %d \n", 
+     "Number of alternate origin containing lines for spacegroup: ",
+       namspg, " is:",norigins);
+    } else {
+      printf("\n %s %s %s %d \n",
+     "Number of alternate origins for spacegroup:  ",namspg,
+     " is:",norigins);
+    } 
+
+    printf("\n Norigin     Ox      Oy      Oz\n\n");
+    for (i = 0; i < norigins; ++i) {
+      if (*polary && *polarz && *polarx) {
+        printf("%8d     ??      ??      ?? \n", i+1);
+      } else if(*polarx && *polary) {
+        printf("%8d     ??      ?? %8.4f\n", i+1,origins[i][2]);
+      } else if(*polarx && *polarz) {
+        printf("%8d     ?? %8.4f     ?? \n", i+1,origins[i][1]);
+      } else if(*polary && *polarz) {
+        printf("%8d%8.4f     ??      ?? \n", i+1,origins[i][0]);
+      } else if( *polarx) {
+        printf("%8d     ?? %8.4f%8.4f\n", i+1,origins[i][1],origins[i][2]);
+      } else if(*polary) {
+        printf("%8d%8.4f     ?? %8.4f\n", i+1,origins[i][0],origins[i][2]);
+      } else if(*polarz) {
+        printf("%8d%8.4f%8.4f     ?? \n", i+1,origins[i][0],origins[i][1]);
+      } else  {
+        printf("%8d%8.4f%8.4f%8.4f\n", i+1,origins[i][0],origins[i][1],origins[i][2]);
+      }
+    }
+  }
+  return norigins;
+}
+
+void ccp4spg_print_recip_spgrp(const CCP4SPG* sp)
+{
+    printf("Reciprocal space symmetry: \n");
+    printf("Space group: \"%s\" Point group: \"%s\" Laue group: \"%s\" \n",
+       sp->symbol_xHM,sp->point_group,sp->laue_name); 
+    printf("Reference asymmetric unit: \"%s\" \n",sp->asu_descr); 
+    printf("  (change of basis may be applied) \n");
+    ccp4spg_print_recip_ops(sp);
+}
+
+void ccp4spg_print_recip_ops(const CCP4SPG* sp)
+{
+  int i,j,k,l,nrow, n_in_last_row,rsymop_len=80;
+  float tmp_symop[4][4];
+  char rsymop[80];
+
+  if (!sp) {  
+    ccp4_signal(CSYM_ERRNO(CSYMERR_NullSpacegroup),"ccp4spg_print_recip_ops",NULL); 
+    return;
+  }
+
+  nrow = (sp->nsymop_prim + 3)/ 4;
+  n_in_last_row = sp->nsymop_prim % 4;
+  if (n_in_last_row == 0) n_in_last_row = 4;
+
+  printf("\n Spacegroup %d \"%s\" \n",sp->spg_ccp4_num,sp->symbol_xHM);
+  printf(" Original indices for reflection hkl with symmetry number ISYM \n");
+  printf("\n                              Bijvoet positive \n");
+  printf("       %-18s%-18s%-18s%-18s\n","ISYM","ISYM","ISYM","ISYM");
+  for (i = 0 ; i < nrow-1 ; ++i) {
+    printf("  ISYM");
+    for (j = 0 ; j < 4 ; ++j) {
+      for (k = 0; k < 3; ++k) {
+	/* note we use the transpose for reciprocal space operators */
+        for (l = 0; l < 3; ++l) 
+          tmp_symop[k][l] = sp->invsymop[4*i+j].rot[l][k];
+        tmp_symop[k][3] = 0.0;
+        tmp_symop[3][k] = 0.0;
+      }
+      tmp_symop[3][3] = 1.0;
+      mat4_to_recip_symop(rsymop,rsymop+rsymop_len,(const float (*)[4])tmp_symop);
+      rsymop[12] = '\0';
+      printf(" %3d  %-12s",2*(4*i+j)+1,rsymop);
+    }
+    printf("\n");
+  }
+  printf("  ISYM");
+  for (j = 0 ; j < n_in_last_row ; ++j) {
+    for (k = 0; k < 3; ++k) {
+      for (l = 0; l < 3; ++l) 
+        tmp_symop[k][l] = sp->invsymop[4*i+j].rot[l][k];
+      tmp_symop[k][3] = 0.0;
+      tmp_symop[3][k] = 0.0;
+    }
+    tmp_symop[3][3] = 1.0;
+    mat4_to_recip_symop(rsymop,rsymop+rsymop_len,(const float (*)[4])tmp_symop);
+    rsymop[12] = '\0';
+    printf(" %3d  %-12s",2*(4*(nrow-1)+j)+1,rsymop);
+  }
+  printf("\n");
+
+  printf("\n                              Bijvoet negative \n");
+  printf("       %-18s%-18s%-18s%-18s\n","ISYM","ISYM","ISYM","ISYM");
+  for (i = 0 ; i < nrow-1 ; ++i) {
+    printf("  ISYM");
+    for (j = 0 ; j < 4 ; ++j) {
+      for (k = 0; k < 3; ++k) {
+        for (l = 0; l < 3; ++l) 
+          tmp_symop[k][l] = - sp->invsymop[4*i+j].rot[l][k];
+        tmp_symop[k][3] = 0.0;
+        tmp_symop[3][k] = 0.0;
+      }
+      tmp_symop[3][3] = 1.0;
+      mat4_to_recip_symop(rsymop,rsymop+rsymop_len,(const float (*)[4])tmp_symop);
+      rsymop[12] = '\0';
+      printf(" %3d  %-12s",2*(4*i+j)+2,rsymop);
+    }
+    printf("\n");
+  }
+  printf("  ISYM");
+  for (j = 0 ; j < n_in_last_row ; ++j) {
+    for (k = 0; k < 3; ++k) {
+      for (l = 0; l < 3; ++l) 
+        tmp_symop[k][l] = - sp->invsymop[4*i+j].rot[l][k];
+      tmp_symop[k][3] = 0.0;
+      tmp_symop[3][k] = 0.0;
+    }
+    tmp_symop[3][3] = 1.0;
+    mat4_to_recip_symop(rsymop,rsymop+rsymop_len,(const float (*)[4])tmp_symop);
+    rsymop[12] = '\0';
+    printf(" %3d  %-12s",2*(4*(nrow-1)+j)+2,rsymop);
+  }
+  printf("\n");
+}
+
+int range_to_limits(const char *range, float limits[2])
+{
+  int i,in_value=1,neg=0,frac=0,equal=0;
+  float value1,value2;
+  float delta=0.00001;
+  char ch;
+  char buf[2];
+  buf[1] = 0;
+
+  for (i = 0 ; i < strlen(range) ; ++i) {
+    ch = range[i];
+    if (ch == '<') {
+      if (in_value) {
+	/* finishing lower value */
+        limits[0] = value1;
+        if (frac) limits[0] = value1/value2;
+        if (neg) limits[0] = - limits[0];
+        limits[0] += delta;
+        neg = 0;
+        frac = 0;
+        in_value = 0;
+      } else {
+	/* starting upper value */
+
+        in_value = 1;
+      }
+    } else if (ch == '-') {
+      neg = 1;
+    } else if (ch == '/') {
+      frac = 1;
+    } else if (ch == '=') {
+      if (in_value) {
+        equal = 1;
+      } else {
+        limits[0] -= 2.0*delta;        
+      }
+    } else if (ch == ';' || ch == ' ') {
+      ;
+    } else {
+      if (in_value) {
+	buf[0] = ch;
+        if (frac) {
+          value2 = (float) atoi(buf);
+        } else {
+          value1 = (float) atoi(buf);
+        }
+      }
+    }
+  } 
+  /* finishing upper value */
+  limits[1] = value1;
+  if (frac) limits[1] = value1/value2;
+  if (neg) limits[1] = - limits[1];
+  limits[1] -= delta;
+  if (equal) limits[1] += 2.0*delta;        
+
+  return 0;
+}
+
+void set_fft_grid(CCP4SPG* sp, const int nxmin, const int nymin, const int nzmin, 
+     const float sample, int *nx, int *ny, int *nz) 
+{
+  if (!sp) {  
+    ccp4_signal(CSYM_ERRNO(CSYMERR_NullSpacegroup),"set_fft_grid",NULL); 
+    return;
+  }
+  *nx = get_grid_sample(nxmin, sp->laue_sampling[0], sample);
+  *ny = get_grid_sample(nymin, sp->laue_sampling[1], sample);
+  *nz = get_grid_sample(nzmin, sp->laue_sampling[2], sample);
+}
+
+int all_factors_le_19(const int n)
+{
+  int i,ifact[8]={2,3,5,7,11,13,17,19};
+
+  int nn = n;
+
+  for (i = 0 ; i < 8 ; ++i) {
+    while (nn % ifact[i] == 0) {
+      /* factor found, divide & continue if required */
+      nn = nn/ifact[i];
+      /* success */
+      if (nn == 1) 
+	return 1;
+    }
+  }
+  return 0;
+}
+
+int get_grid_sample(const int minsmp, const int nmul, const float sample)
+{
+  int n;
+  float r1min=1.0, r1max=1.6, r2min=1.4, r2max=4.0;
+
+  /*  check minsmp <= 0, if so set nsampl = nmul */
+  if (minsmp <= 0) 
+    return nmul;
+
+  /* set search limits */
+  if (sample >= 1.0) {
+    r1max = sample;
+    r2min = sample*0.95 < 1.0 ? 1.0 : sample*0.95;
+  }
+
+  /*  start with multiple of nmul */
+  n = (int) rint((r1max*minsmp)/nmul)*nmul;
+
+  while (n > (int) rint(r1min*minsmp)) {
+    /* suitable sample interval found, accept it */
+    if (all_factors_le_19(n)) 
+      return n;
+    /* decrement trial value & continue if still in range */
+    n -= nmul;
+  }
+
+  /*  now try 2nd search if 1st unsuccesful */
+  n = (int) rint((r2min*minsmp)/nmul)*nmul;
+
+  while (n < (int) rint(r2max*minsmp)) {
+    /* suitable sample interval found, accept it */
+    if (all_factors_le_19(n)) 
+      return n;
+    /* increment trial value & continue if still in range */
+    n += nmul;
+  }
+
+  /* failed */
+  return -1;
+}
+
+int ccp4spg_load_laue(CCP4SPG *spacegroup, const int nlaue)
+{
+  int ierr = 1;
+
+  if (!spacegroup) return ierr;
+
+  if ( nlaue == 3 ) {
+     spacegroup->asufn = &ASU_1b;
+     spacegroup->nlaue = 3;
+     strcpy(spacegroup->laue_name,"-1");
+     spacegroup->laue_sampling[0] = 2;
+     spacegroup->laue_sampling[1] = 2;
+     spacegroup->laue_sampling[2] = 2;
+     ierr = 0;
+  }
+  if ( nlaue == 4 ) {
+     spacegroup->nlaue = 4;
+     strcpy(spacegroup->laue_name,"2/m");
+     spacegroup->laue_sampling[0] = 2;
+     spacegroup->laue_sampling[1] = 4;
+     spacegroup->laue_sampling[2] = 2;
+     ierr = 0;
+  }
+  if ( nlaue == 5 ) {
+     spacegroup->nlaue = 5;
+     strcpy(spacegroup->laue_name,"2/m");
+     spacegroup->laue_sampling[0] = 2;
+     spacegroup->laue_sampling[1] = 8;
+     spacegroup->laue_sampling[2] = 4;
+     ierr = 0;
+  }
+  if ( nlaue == 6 ) {
+     spacegroup->nlaue = 6;
+     strcpy(spacegroup->laue_name,"mmm");
+     spacegroup->laue_sampling[0] = 4;
+     spacegroup->laue_sampling[1] = 4;
+     spacegroup->laue_sampling[2] = 4;
+     ierr = 0;
+  }
+  if ( nlaue == 7 ) {
+     spacegroup->nlaue = 7;
+     strcpy(spacegroup->laue_name,"4/m");
+     spacegroup->laue_sampling[0] = 4;
+     spacegroup->laue_sampling[1] = 4;
+     spacegroup->laue_sampling[2] = 8;
+     ierr = 0;
+  }
+  if ( nlaue == 8 ) {
+     spacegroup->nlaue = 8;
+     strcpy(spacegroup->laue_name,"4/mmm");
+     spacegroup->laue_sampling[0] = 4;
+     spacegroup->laue_sampling[1] = 4;
+     spacegroup->laue_sampling[2] = 8;
+     ierr = 0;
+  }
+  if ( nlaue == 9 ) {
+     spacegroup->nlaue = 9;
+     strcpy(spacegroup->laue_name,"-3");
+     spacegroup->laue_sampling[0] = 6;
+     spacegroup->laue_sampling[1] = 6;
+     spacegroup->laue_sampling[2] = 6;
+     ierr = 0;
+  }
+  if ( nlaue == 10 ) {
+     spacegroup->nlaue = 10;
+     strcpy(spacegroup->laue_name,"3bar1m");
+     spacegroup->laue_sampling[0] = 6;
+     spacegroup->laue_sampling[1] = 6;
+     spacegroup->laue_sampling[2] = 6;
+     ierr = 0;
+  }
+  if ( nlaue == 11 ) {
+     spacegroup->nlaue = 11;
+     strcpy(spacegroup->laue_name,"3barm");
+     spacegroup->laue_sampling[0] = 6;
+     spacegroup->laue_sampling[1] = 6;
+     spacegroup->laue_sampling[2] = 6;
+     ierr = 0;
+  }
+  if ( nlaue == 12 ) {
+     spacegroup->nlaue = 12;
+     strcpy(spacegroup->laue_name,"6/m");
+     spacegroup->laue_sampling[0] = 6;
+     spacegroup->laue_sampling[1] = 6;
+     spacegroup->laue_sampling[2] = 12;
+     ierr = 0;
+  }
+  if ( nlaue == 13 ) {
+     spacegroup->nlaue = 13;
+     strcpy(spacegroup->laue_name,"6/mmm");
+     spacegroup->laue_sampling[0] = 6;
+     spacegroup->laue_sampling[1] = 6;
+     spacegroup->laue_sampling[2] = 12;
+     ierr = 0;
+  }
+  if ( nlaue == 14 ) {
+     spacegroup->nlaue = 14;
+     strcpy(spacegroup->laue_name,"m3bar");
+     spacegroup->laue_sampling[0] = 4;
+     spacegroup->laue_sampling[1] = 4;
+     spacegroup->laue_sampling[2] = 4;
+     ierr = 0;
+  }
+  if ( nlaue == 15 ) {
+     spacegroup->nlaue = 15;
+     strcpy(spacegroup->laue_name,"m3barm");
+     spacegroup->laue_sampling[0] = 8;
+     spacegroup->laue_sampling[1] = 8;
+     spacegroup->laue_sampling[2] = 8;
+     ierr = 0;
+  }
+  return ierr;
+}
+
+int ccp4spg_check_symm_cell(int nsym, float rsym[][4][4], float cell[6]) {
+
+  CCP4SPG *spacegroup;
+  int i,k,l,status=1;
+  ccp4_symop *op1;
+
+  /* identify spacegroup from supplied symops */
+  op1 = (ccp4_symop *) ccp4_utils_malloc(nsym*sizeof(ccp4_symop));
+  for (i = 0; i < nsym; ++i) {
+    for (k = 0; k < 3; ++k) {
+      for (l = 0; l < 3; ++l) {
+	op1[i].rot[k][l] = rsym[i][k][l];
+      }
+      op1[i].trn[k] = rsym[i][k][3];
+    }
+  }
+  spacegroup = ccp4_spgrp_reverse_lookup(nsym,op1);
+
+  /* test cell against symmetry on case-by-case basis */
+  if (strstr(spacegroup->symbol_xHM,":R")) {
+    status = ccp4uc_is_rhombohedral(cell,0.01F);
+  } else if (strstr(spacegroup->symbol_xHM,":H")) {
+    status = ccp4uc_is_hexagonal(cell,0.01F);
+  } else if (spacegroup->spg_num >= 168 && spacegroup->spg_num <= 194) {
+    status = ccp4uc_is_hexagonal(cell,0.01F);
+  }
+
+  free(op1);
+
+  return status;
+}
diff -ruN ccp4-5.99.5-orig/lib/cctbx/cctbx_sources/ccp4io/lib/src/csymlib.h ccp4-5.99.5/lib/cctbx/cctbx_sources/ccp4io/lib/src/csymlib.h
--- ccp4-5.99.5-orig/lib/cctbx/cctbx_sources/ccp4io/lib/src/csymlib.h	1969-12-31 16:00:00.000000000 -0800
+++ ccp4-5.99.5/lib/cctbx/cctbx_sources/ccp4io/lib/src/csymlib.h	2005-11-30 17:40:04.000000000 -0800
@@ -0,0 +1,669 @@
+/*
+     csymlib.h: header file for csymlib.c
+     Copyright (C) 2001  CCLRC, Martyn Winn
+
+     This library is free software and is distributed under the terms and
+     conditions of the CCP4 licence agreement as `Part 0' (Annex 2)
+     software, which is version 2.1 of the GNU Lesser General Public
+     Licence (LGPL) with the following additional clause:
+
+        `You may also combine or link a "work that uses the Library" to
+        produce a work containing portions of the Library, and distribute
+        that work under terms of your choice, provided that you give
+        prominent notice with each copy of the work that the specified
+        version of the Library is used in it, and that you include or
+        provide public access to the complete corresponding
+        machine-readable source code for the Library including whatever
+        changes were used in the work. (i.e. If you make changes to the
+        Library you must distribute those, but you do not need to
+        distribute source or object code to those portions of the work
+        not covered by this licence.)'
+
+     Note that this clause grants an additional right and does not impose
+     any additional restriction, and so does not affect compatibility
+     with the GNU General Public Licence (GPL). If you wish to negotiate
+     other terms, please contact the maintainer.
+
+     You can redistribute it and/or modify the library under the terms of
+     the GNU Lesser General Public License as published by the Free Software
+     Foundation; either version 2.1 of the License, or (at your option) any
+     later version.
+
+     This library is distributed in the hope that it will be useful, but
+     WITHOUT ANY WARRANTY; without even the implied warranty of
+     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+     Lesser General Public License for more details.
+
+     You should have received a copy of the CCP4 licence and/or GNU
+     Lesser General Public License along with this library; if not, write
+     to the CCP4 Secretary, Daresbury Laboratory, Warrington WA4 4AD, UK.
+     The GNU Lesser General Public can also be obtained by writing to the
+     Free Software Foundation, Inc., 59 Temple Place, Suite 330, Boston,
+     MA 02111-1307 USA
+*/
+
+/** @page csym_page CSYM library
+ *
+ * @verbatim
+
+<!-- ::INDEX_INFO::CSYM library::Library::::C/C++ Software Library for symmetry information:::::::: -->
+
+   @endverbatim
+ *
+ *  @section csym_file_list File list
+
+<ul>
+<li>csymlib.h - contains details of the C/C++ API
+<li>ccp4_spg.h - contains details of the spacegroup data structure
+</ul>
+ *
+ *  @section csym_overview Overview
+ 
+The CSYM library is centred around a data file <tt>syminfo.lib</tt> which is
+auto-generated from sgtbx (the Space Group Toolbox of 
+<a href="http://cctbx.sourceforge.net/">cctbx</a>). A description of
+the contents of this file is given in the <a href="../symlib.html">
+documentation</a> of the Fortran API.
+
+<p>A particular spacegroup in a particular setting
+is loaded into an in-memory data structure by requesting a particular
+spacegroup name, number, or set of operators. See the functions
+<tt>ccp4spg_load_by_standard_num</tt>, <tt>ccp4spg_load_by_ccp4_num</tt>, 
+<tt>ccp4spg_load_by_spgname</tt>,  <tt>ccp4spg_load_by_ccp4_spgname</tt>
+and <tt>ccp4_spgrp_reverse_lookup</tt>. Information on the in-memory 
+data structure is given in ccp4_spg.h The memory can be freed by the
+function <tt>ccp4spg_free</tt>.
+
+<p>Functions are provided to:
+<ul>
+<li>Query the data structure, e.g. <tt>ccp4spg_symbol_Hall</tt>, etc. (members
+of the structure can of course be obtained directly)
+<li>Check reciprocal space indices for a particular spacegroup, 
+e.g. <tt>ccp4spg_is_in_asu</tt>, <tt>ccp4spg_is_centric</tt>, 
+<tt>ccp4spg_get_multiplicity</tt>, <tt>ccp4spg_is_sysabs</tt>, etc.
+<li>Set appropriate grids for FFT, e.g. <tt>set_fft_grid</tt>
+</ul>
+ *
+ *  @section csym_operators Symmetry operators
+
+Symmetry operators are expressed in a variety of ways:
+<ul>
+<li>Using the struct <tt>ccp4_symop</tt>, which consists of a 3 x 3 rotation
+matrix and a translation vector.
+<li>As a 4 x 4 matrix, in which the rotation matrix is in the top-left-hand
+corner and the translation vector is in elements [*][3]. Element [3][3] is
+set to 1.0
+<li>As a string, such as "-x+1/2,-y,z+1/2"
+</ul>
+Check the function description for which form is expected. Often, there 
+are alternative functions if you wish to supply the operators in a
+different form. There are also the following conversion functions:
+<ul>
+<li>rotandtrn_to_mat4
+<li>rotandtrn_to_symop
+<li>mat4_to_rotandtrn
+<li>mat4_to_symop
+<li>mat4_to_recip_symop
+<li>symop_to_rotandtrn
+<li>symop_to_mat4
+</ul>
+Note that the order of symmetry operators may be important in some cases, for
+example in MTZ files with a M/ISYM column where ISYM encodes the symmetry operation
+used.
+
+ *  @section csym_examples Examples
+
+See examples on <a href="ftp://ftp.ccp4.ac.uk/pub/mdw/csym">ftp area</a>
+
+*/
+
+/** @file csymlib.h
+ *
+ *  @brief C-level library for symmetry information.
+ *
+ *  Functions defining the C-level API for accessing spacegroup properties.
+ *  The primary spacegroup information comes from the data file syminfo.lib
+ *
+ *  @author Martyn Winn 
+ */
+
+#ifndef __CSymLib__
+#define __CSymLib__
+
+
+/* note that definitions in ccp4_spg.h are within the CSym namespace */
+#include "ccp4_spg.h"
+
+#ifdef  __cplusplus
+namespace CSym {
+extern "C" {
+#endif
+
+/** Look up spacegroup in standard setting by number, and load properties.
+ * Allocates memory for the spacegroup structure. This can be freed
+ * later by ccp4spg_free().
+ * @param numspg spacegroup number
+ * @return pointer to spacegroup
+ */
+CCP4SPG *ccp4spg_load_by_standard_num(const int numspg); 
+
+/** Look up spacegroup by CCP4 number, and load properties.
+ * Allocates memory for the spacegroup structure. This can be freed
+ * later by ccp4spg_free().
+ * @param ccp4numspg CCP4 spacegroup number
+ * @return pointer to spacegroup
+ */
+CCP4SPG *ccp4spg_load_by_ccp4_num(const int ccp4numspg); 
+
+/** Look up spacegroup by the extended Hermann Mauguin symbol.
+ * Allocates memory for the spacegroup structure. This can be freed
+ * later by ccp4spg_free().
+ * @param spgname Spacegroup name in form of extended Hermann Mauguin symbol.
+ * @return pointer to spacegroup
+ */
+CCP4SPG *ccp4spg_load_by_spgname(const char *spgname);
+
+/** Look up spacegroup by name. This is for use by CCP4 programs
+ * and is more complicated than ccp4spg_load_by_spgname. For each
+ * spacegroup in syminfo.lib it checks the CCP4 spacegroup name
+ * first, and then the extended Hermann Mauguin symbol.
+ * Allocates memory for the spacegroup structure. This can be freed
+ * later by ccp4spg_free().
+ * @param ccp4spgname Spacegroup name.
+ * @return pointer to spacegroup
+ */
+CCP4SPG *ccp4spg_load_by_ccp4_spgname(const char *ccp4spgname);
+
+/** Look up spacegroup by symmetry operators and load properties.
+ * Allocates memory for the spacegroup structure. This can be freed
+ * later by ccp4spg_free().
+ * @param nsym1 number of operators (including non-primitive)
+ * @param op1 pointer to array of operators
+ * @return pointer to spacegroup
+ */
+CCP4SPG * ccp4_spgrp_reverse_lookup(const int nsym1, const ccp4_symop *op1);
+
+/** Look up spacegroup from SYMOP.
+ *  This would not normally be called directly, but via one of
+ *  the wrapping functions. 
+ *  Allocates memory for the spacegroup structure. This can be freed
+ *  later by ccp4spg_free().
+ * @param numspg spacegroup number
+ * @param ccp4numspg CCP4 spacegroup number
+ * @param spgname Spacegroup name.
+ * @param ccp4spgname Spacegroup name.
+ * @param nsym1 number of operators (including non-primitive)
+ * @param op1 pointer to array of operators
+ * @return pointer to spacegroup
+ */
+CCP4SPG *ccp4spg_load_spacegroup(const int numspg, const int ccp4numspg,
+        const char *spgname, const char *ccp4spgname, 
+        const int nsym1, const ccp4_symop *op1); 
+
+/** Free all memory malloc'd from static pointers.
+ * To be called before program exit. The function can be
+ * registered with atexit.
+ */
+void ccp4spg_mem_tidy(void);
+
+/** Generate symop matrices from description strings
+ *  This would not normally be called directly, but via one of
+ *  the wrapping functions SYMFR2 and SYMFR3 in the Fortran API.
+ * @param line null-terminated string containing symop descriptions
+ * @param rot array of 4x4 matrices
+ * @return number of symops read, or -1 on failure
+ */
+int symfr_driver (const char *line, float rot[][4][4]);
+
+/** Free memory associated with spacegroup.
+ * @param sp pointer to spacegroup
+ */
+void ccp4spg_free(CCP4SPG **sp);
+
+/** Look up spacegroup in standard setting by number and load into
+ * static storage of csymlib_f.
+ * @param numspg spacegroup number
+ * @return void
+ */
+void ccp4spg_register_by_ccp4_num(int numspg);
+
+/** Look up spacegroup by set of symmetry operators and load into
+ * static storage of csymlib_f.
+ * @param nops number of symops
+ * @param rsm symmetry operators
+ * @return void
+ */
+void ccp4spg_register_by_symops(int nops, float rsm[][4][4]);
+
+/** Derive centering operators from Hall symbol (deprecated).
+ * Centering operators are now read from syminfo.lib
+ * @param symbol_Hall Hall symbol for spacegroup
+ * @param cent_ops centering operators
+ * @return number of centering operators (0 if none found)
+ */
+int ccp4_spg_get_centering(const char *symbol_Hall, float cent_ops[4][3]);
+
+/** Load Laue data into spacegroup structure.
+ * @param nlaue CCP4 code for Laue group
+ * @param spacegroup Pointer to CCP4 spacegroup structure
+ * @return 0 on success, 1 on failure to load Laue data
+ */
+int ccp4spg_load_laue(CCP4SPG* spacegroup, const int nlaue);
+
+/** Test if reflection is in asu of Laue group 1bar.
+ * @return 1 if in asu else 0
+ */
+int ASU_1b   (const int h, const int k, const int l);
+
+/** Test if reflection is in asu of Laue group 2/m.
+ * @return 1 if in asu else 0
+ */
+int ASU_2_m  (const int h, const int k, const int l);
+
+/** Test if reflection is in asu of Laue group mmm.
+ * @return 1 if in asu else 0
+ */
+int ASU_mmm  (const int h, const int k, const int l);
+
+/** Test if reflection is in asu of Laue group 4/m.
+ * @return 1 if in asu else 0
+ */
+int ASU_4_m  (const int h, const int k, const int l);
+
+/** Test if reflection is in asu of Laue group 4/mmm.
+ * @return 1 if in asu else 0
+ */
+int ASU_4_mmm(const int h, const int k, const int l);
+
+/** Test if reflection is in asu of Laue group 3bar.
+ * @return 1 if in asu else 0
+ */
+int ASU_3b   (const int h, const int k, const int l);
+
+/** Test if reflection is in asu of Laue group 3bar1m.
+ * @return 1 if in asu else 0
+ */
+int ASU_3bm  (const int h, const int k, const int l);
+
+/** Test if reflection is in asu of Laue group 3barm.
+ * @return 1 if in asu else 0
+ */
+int ASU_3bmx (const int h, const int k, const int l);
+
+/** Test if reflection is in asu of Laue group 6/m.
+ * @return 1 if in asu else 0
+ */
+int ASU_6_m  (const int h, const int k, const int l);
+
+/** Test if reflection is in asu of Laue group 6/mmm.
+ * @return 1 if in asu else 0
+ */
+int ASU_6_mmm(const int h, const int k, const int l);
+
+/** Test if reflection is in asu of Laue group m3bar.
+ * @return 1 if in asu else 0
+ */
+int ASU_m3b  (const int h, const int k, const int l);
+
+/** Test if reflection is in asu of Laue group m3barm.
+ * @return 1 if in asu else 0
+ */
+int ASU_m3bm  (const int h, const int k, const int l);
+
+/** Function to return Hall symbol for spacegroup.
+ * @param sp pointer to spacegroup
+ * @return pointer to Hall symbol for spacegroup
+ */
+char *ccp4spg_symbol_Hall(CCP4SPG* sp);
+
+/** inverts a symmetry operator. The input operator is
+ * converted to a 4 x 4 matrix, inverted, and converted back.
+ * @param ccp4_symop input symmetry operator
+ * @return inverted symmetry operator
+ */
+ccp4_symop ccp4_symop_invert( const ccp4_symop op1 );
+
+/** Compare two spacegroup names. Strings are converted to upper
+ * case before making the comparison, but otherwise match must be
+ * exact.
+ * @param spgname1 First spacegroup name.
+ * @param spgname2 Second spacegroup name.
+ * @return 1 if they are equal else 0.
+*/
+int ccp4spg_name_equal(const char *spgname1, const char *spgname2);
+
+/** Try to match a spacegroup name to one from SYMINFO. Blanks are 
+ * removed when making the comparison. Strings are converted to upper
+ * case before making the comparison. If spgname_lib has " 1 " and 
+ * spgname_match doesn't, then strip out " 1" to do "short" comparison.
+ * @param spgname1 First spacegroup name, assumed to be a standard one
+ *  obtained at some point from SYMINFO
+ * @param spgname2 Second spacegroup name that you are trying to match
+ *  to a standard SYMINFO one. E.g. it might have been provided by the
+ *  user.
+ * @return 1 if they are equal else 0.
+*/
+int ccp4spg_name_equal_to_lib(const char *spgname_lib, const char *spgname_match);
+
+/** Function to create "short" name of spacegroup. Blanks
+ * are removed, as are " 1" elements (except for the special case
+ * of "P 1").
+ * @param shortname String long enough to hold short name.
+ * @param longname Long version of spacegroup name.
+ * @return Pointer to shortname.
+*/
+char *ccp4spg_to_shortname(char *shortname, const char *longname);
+
+/** Function to deal with colon-specified spacegroup settings.
+ * E.g. 'R 3 :H' is converted to 'H 3   '. Note that spaces are
+ * returned and should be dealt with by the calling function.
+ * @param name Spacegroup name.
+ * @return void
+*/
+void ccp4spg_name_de_colon(char *name);
+
+/** Compare two point group names. Blanks are removed when
+ * making the comparison. Strings are converted to upper
+ * case before making the comparison. Any initial "PG" is ignored.
+ * @param pgname1 First point group name.
+ * @param pgname2 Second point group name.
+ * @return 1 if they are equal else 0.
+*/
+int ccp4spg_pgname_equal(const char *pgname1, const char *pgname2);
+
+/** Function to normalise translations of a symmetry operator,
+ * i.e. to ensure 0.0 <= op.trn[i] < 1.0.
+ * @param op pointer to symmetry operator.
+ * @return Pointer to normalised symmetry operator.
+*/
+ccp4_symop *ccp4spg_norm_trans(ccp4_symop *op);
+
+/** Sort and compare two symmetry operator lists.
+ * Kevin's code. The lists are coded as ints, which are then sorted and compared.
+ * Note that no changes are made to the input operators, so that operators
+ * differing by an integral number of unit cell translations are considered
+ * unequal. If this is not what you want, normalise the operators with 
+ * ccp4spg_norm_trans first.
+ * @param nsym1 number of symmetry operators in first list
+ * @param op1 first list of symmetry operators
+ * @param nsym2 number of symmetry operators in second list
+ * @param op2 second list of symmetry operators
+ * @return 1 if they are equal else 0.
+*/
+int ccp4_spgrp_equal( int nsym1, const ccp4_symop *op1, int nsym2, const ccp4_symop *op2);
+
+/** Compare two symmetry operator lists.
+ * Kevin's code. The lists are coded as ints, which are compared.
+ * Unlike ccp4_spgrp_equal, the lists are not sorted, so the same operators
+ * in a different order will be considered unequal.
+ * @param nsym1 number of symmetry operators in first list
+ * @param op1 first list of symmetry operators
+ * @param nsym2 number of symmetry operators in second list
+ * @param op2 second list of symmetry operators
+ * @return 1 if they are equal else 0.
+*/
+int ccp4_spgrp_equal_order( int nsym1, const ccp4_symop *op1, int nsym2, const ccp4_symop *op2);
+
+/** Make an integer coding of a symmetry operator.
+ * The coding takes 30 bits: 18 for the rotation and 12 for the translation.
+ * @param op symmetry operator
+ * @return int code.
+ */
+int ccp4_symop_code(ccp4_symop op);
+
+/** Comparison of symmetry operators encoded as integers.
+ * In ccp4_spgrp_equal, this is passed to the stdlib qsort.
+ * @param p1 pointer to first integer
+ * @param p1 pointer to second integer
+ * @return difference between integers
+*/
+int ccp4_int_compare( const void *p1, const void *p2 );
+
+/** Test whether reflection or it's Friedel mate is in asu.
+ * @param sp pointer to spacegroup
+ * @param h reflection index
+ * @param k reflection index
+ * @param l reflection index
+ * @return 1 if in asu, -1 if -h -k -l is in asu, 0 otherwise
+ */
+int ccp4spg_is_in_pm_asu(const CCP4SPG* sp, const int h, const int k, const int l);
+
+/** Test whether reflection is in asu.
+ * @param sp pointer to spacegroup
+ * @param h reflection index
+ * @param k reflection index
+ * @param l reflection index
+ * @return 1 if in asu, 0 otherwise
+ */
+int ccp4spg_is_in_asu(const CCP4SPG* sp, const int h, const int k, const int l);
+
+/** Place reflection (hin,kin,lin) in the asymmetric unit of spacegroup "sp".
+ * Resultant indices are placed in (hout,kout,lout).
+ * @param sp pointer to spacegroup
+ * @param hin input reflection index
+ * @param kin input reflection index
+ * @param lin input reflection index
+ * @param hout output reflection index
+ * @param kout output reflection index
+ * @param lout output reflection index
+ * @return "isym" if successful, 0 otherwise. "isym" = 2*isymop - 1 for 
+ * reflections placed in the positive asu, i.e. I+ of a Friedel pair, and
+ * "isym" = 2*isymop for reflections placed in the negative asu, i.e. I- of 
+ * a Friedel pair. Here "isymop" is the number of the symmetry operator used.
+ */
+int ccp4spg_put_in_asu(const CCP4SPG* sp, const int hin, const int kin, const int lin,
+		       int *hout, int *kout, int *lout );
+
+/** Transform reflection (hin,kin,lin) according to spacegroup "sp" and
+ * operation "isym". Resultant indices are placed in (hout,kout,lout).
+ * @param sp pointer to spacegroup
+ * @param isym required operation, see ccp4spg_put_in_asu
+ * @param hin input reflection index
+ * @param kin input reflection index
+ * @param lin input reflection index
+ * @param hout output reflection index
+ * @param kout output reflection index
+ * @param lout output reflection index
+ * @return void
+ */
+void ccp4spg_generate_indices(const CCP4SPG* sp, const int isym,
+                  const int hin, const int kin, const int lin,
+			      int *hout, int *kout, int *lout );
+
+/** Shift phase value associated with hin,kin,lin according to translation 
+and optional sign change. Return in range 0,360.
+ * @param hin reflection index
+ * @param kin reflection index
+ * @param lin reflection index
+ * @param phasin Input phase.
+ * @param trans Requested translation
+ * @param isign If -1, change sign of phase
+ * @return shifted phase
+ */
+float ccp4spg_phase_shift(const int hin, const int kin, const int lin,
+			  const float phasin, const float trans[3], const int isign);
+
+/** Check whether change of basis is necessary, i.e. whether the
+ * change of basis matrix is not the identity.
+ * @param chb change of basis matrix
+ * @return 1 if change of basis is necessary, 0 otherwise
+ */
+int ccp4spg_do_chb(const float chb[3][3]);
+
+/** Set up centric zones for a given spacegroup. This is called
+ * upon loading a spacegroup.
+ * @param sp pointer to spacegroup
+ * @return void
+ */
+void ccp4spg_set_centric_zones(CCP4SPG* sp);
+
+/** Function to determine whether or not h,k,l is a centric reflection
+ * in spacegroup "sp".
+ * @param sp pointer to spacegroup
+ * @param h input reflection index
+ * @param k input reflection index
+ * @param l input reflection index
+ * @return 1 if h,k,l is centric, 0 if not centric, and -1 if there is
+ *  an error.
+ */
+int ccp4spg_is_centric(const CCP4SPG* sp, const int h, const int k, const int l);
+
+/** Check indices against a centric zone for a given spacegroup.
+ * @param  nzone index of centric zone
+ * @param h reflection index
+ * @param k reflection index
+ * @param l reflection index
+ * @return 0 if in zone "nzone", non-zero otherwise
+ */
+int ccp4spg_check_centric_zone(const int nzone, const int h, const int k, const int l);
+
+/** Return phase of a centric reflection in the range 0.0 <= phase < 180.0.
+ * You should first check that reflection really is centric.
+ * @param sp pointer to spacegroup
+ * @param h reflection index
+ * @param k reflection index
+ * @param l reflection index
+ * @return phase of a centric reflection
+ */
+float ccp4spg_centric_phase(const CCP4SPG* sp, const int h, const int k, const int l);
+
+/** Print a summary of the centric zones of a spacegroup.
+ * @param sp pointer to spacegroup
+ * @return void
+ */
+void ccp4spg_print_centric_zones(const CCP4SPG* sp);
+
+/** Obtain string description of centric zone.
+ * @param nzone index of centric zone
+ * @param centric_zone string description of centric zone
+ * @return string description of centric zone
+ */
+char *ccp4spg_describe_centric_zone(const int nzone, char *centric_zone);
+
+/** Set up epsilon zones for a given spacegroup. This is called
+ * upon loading a spacegroup.
+ * @param sp pointer to spacegroup
+ * @return void
+ */
+void ccp4spg_set_epsilon_zones(CCP4SPG* sp);
+
+/** Return reflection multiplicity factor for a given hkl in a given
+ * spacegroup.
+ * @param sp pointer to spacegroup
+ * @param h reflection index
+ * @param k reflection index
+ * @param l reflection index
+ * @return reflection multiplicity factor
+ */
+int ccp4spg_get_multiplicity(const CCP4SPG* sp, const int h, const int k, const int l);
+
+/** Check indices against an epsilon zone for a given spacegroup.
+ * @param nzone index of epsilon zone (runs from 1 to 13)
+ * @param h reflection index
+ * @param k reflection index
+ * @param l reflection index
+ * @return 0 if in zone "nzone", non-zero otherwise
+ */
+int ccp4spg_check_epsilon_zone(const int nzone, const int h, const int k, const int l);
+
+/** Print a summary of the epsilon zones of a spacegroup.
+ * @param sp pointer to spacegroup
+ * @return void
+ */
+void ccp4spg_print_epsilon_zones(const CCP4SPG* sp);
+
+/** Obtain string description of epsilon zone.
+ * @param nzone index of epsilon zone
+ * @param epsilon_zone string description of epsilon zone
+ * @return string description of epsilon zone
+ */
+char *ccp4spg_describe_epsilon_zone(const int nzone, char *epsilon_zone);
+
+
+/** Check if reflection is a systematic absence.
+ * @param sp pointer to spacegroup
+ * @param h reflection index
+ * @param k reflection index
+ * @param l reflection index
+ * @return 1 if reflection is a systematic absence, 0 otherwise.
+ */
+int ccp4spg_is_sysabs(const CCP4SPG* sp, const int h, const int k, const int l);
+
+/** Translated from Alexei Vagin's CALC_ORIG_PS.
+ * @param namspg Spacegroup name for printing only.
+ * @param nsym Input number of symmetry operators.
+ * @param rsym Input symmetry operators.
+ * @param origins Array containing alternative origins on output.
+ * @param polarx Return whether polar along x axis.
+ * @param polary Return whether polar along y axis.
+ * @param polarz Return whether polar along z axis.
+ * @param iprint If true, print out list of alternative origins.
+ * @return Number of alternate origins for spacegroup.
+ */
+int ccp4spg_generate_origins(const char *namspg, const int nsym, const float rsym[][4][4],
+			     float origins[][3], int *polarx, int *polary, int *polarz,
+			     const int iprint);
+
+/** Print details on reciprocal spacegroup.
+ * @param sp pointer to spacegroup
+ * @return void
+ */
+void ccp4spg_print_recip_spgrp(const CCP4SPG* sp);
+
+/** Print reciprocal symops.
+ * @param sp pointer to spacegroup
+ * @return void
+ */
+void ccp4spg_print_recip_ops(const CCP4SPG* sp);
+
+/** Convert string of type 0<=y<=1/4 to 0.0-delta, 0.25+delta, where
+ * delta is set to 0.00001 Makes many assumptions about string.
+ * @param range input string.
+ * @param limits output range limits.
+ * @return 0 on success
+ */
+int range_to_limits(const char *range, float limits[2]);
+
+/** Sets an FFT grid for a spacegroup.
+ * @param sp pointer to spacegroup
+ * @param nxmin minimum sampling on x
+ * @param nymin minimum sampling on y
+ * @param nzmin minimum sampling on z
+ * @param sample default fineness of sample
+ * @param nx returns sampling intervals along x
+ * @param ny returns sampling intervals along y
+ * @param nz returns sampling intervals along z
+ * @return void
+ */
+void set_fft_grid(CCP4SPG* sp, const int nxmin, const int nymin, const int nzmin, 
+		  const float sample, int *nx, int *ny, int *nz);
+
+/** Checks whether all factors of a number n are less than or
+ * equal to 19.
+ * @param n Number to be tested.
+ * @return 1 on success, O on failure.
+ */
+int all_factors_le_19(const int n);
+
+/** Sets a grid sample greater than minsmp, which has no prime
+ * factors greater than 19, and contains the factor nmul.
+ * @param minsmp
+ * @param nmul
+ * @param sample
+ * @return Grid sample or -1 on failure.
+ */
+int get_grid_sample(const int minsmp, const int nmul, const float sample);
+
+/** Check for consistency between cell dimensions and spacegroup. Latter
+ * is identified from symmetry operators.
+ * @param nsym No. of symmetry operators.
+ * @param rsym Symmetry operators.
+ * @param cell Cell dimensions.
+ * @return 1 if they are consistent, 0 if there is a problem. 
+ */
+int ccp4spg_check_symm_cell(int nsym, float rsym[][4][4], float cell[6]);
+
+#ifdef __cplusplus
+} }
+#endif
+#endif
diff -ruN ccp4-5.99.5-orig/lib/cctbx/cctbx_sources/ccp4io/lib/src/cvecmat.c ccp4-5.99.5/lib/cctbx/cctbx_sources/ccp4io/lib/src/cvecmat.c
--- ccp4-5.99.5-orig/lib/cctbx/cctbx_sources/ccp4io/lib/src/cvecmat.c	1969-12-31 16:00:00.000000000 -0800
+++ ccp4-5.99.5/lib/cctbx/cctbx_sources/ccp4io/lib/src/cvecmat.c	2005-11-30 17:40:04.000000000 -0800
@@ -0,0 +1,183 @@
+/*
+     cvecmat.c: C library for vector and matrix manipulations
+     Copyright (C) 2001  CCLRC, Martyn Winn
+
+     This library is free software and is distributed under the terms and
+     conditions of the CCP4 licence agreement as `Part 0' (Annex 2)
+     software, which is version 2.1 of the GNU Lesser General Public
+     Licence (LGPL) with the following additional clause:
+
+        `You may also combine or link a "work that uses the Library" to
+        produce a work containing portions of the Library, and distribute
+        that work under terms of your choice, provided that you give
+        prominent notice with each copy of the work that the specified
+        version of the Library is used in it, and that you include or
+        provide public access to the complete corresponding
+        machine-readable source code for the Library including whatever
+        changes were used in the work. (i.e. If you make changes to the
+        Library you must distribute those, but you do not need to
+        distribute source or object code to those portions of the work
+        not covered by this licence.)'
+
+     Note that this clause grants an additional right and does not impose
+     any additional restriction, and so does not affect compatibility
+     with the GNU General Public Licence (GPL). If you wish to negotiate
+     other terms, please contact the maintainer.
+
+     You can redistribute it and/or modify the library under the terms of
+     the GNU Lesser General Public License as published by the Free Software
+     Foundation; either version 2.1 of the License, or (at your option) any
+     later version.
+
+     This library is distributed in the hope that it will be useful, but
+     WITHOUT ANY WARRANTY; without even the implied warranty of
+     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+     Lesser General Public License for more details.
+
+     You should have received a copy of the CCP4 licence and/or GNU
+     Lesser General Public License along with this library; if not, write
+     to the CCP4 Secretary, Daresbury Laboratory, Warrington WA4 4AD, UK.
+     The GNU Lesser General Public can also be obtained by writing to the
+     Free Software Foundation, Inc., 59 Temple Place, Suite 330, Boston,
+     MA 02111-1307 USA
+*/
+
+/** @file cvecmat.c
+ *  C library for vector and matrix manipulations.
+ *  Martyn Winn 
+ */
+
+#include "cvecmat.h"
+
+/*  c = a X b  */
+
+void ccp4_dcross(const double a[3], const double b[3], double c[3])
+{
+  c[0] = a[1]*b[2] - b[1]*a[2];
+  c[1] = a[2]*b[0] - b[2]*a[0];
+  c[2] = a[0]*b[1] - b[0]*a[1];
+}
+
+void ccp4_3matmul(double c[3][3], const double a[3][3], const double b[3][3])
+{
+  int i,j,k;
+
+  for ( i = 0; i < 3; i++ ) 
+    for ( j = 0; j < 3; j++ ) {
+      c[i][j] = 0.0;
+      for ( k = 0; k < 3; k++ ) 
+        c[i][j] += a[i][k]*b[k][j];
+    }
+}
+
+void ccp4_4matmul( float c[4][4], const float  a[4][4], const float b[4][4])
+{
+  int i,j,k;
+
+  for ( i = 0; i < 4; i++ ) 
+    for ( j = 0; j < 4; j++ ) {
+      c[i][j] = 0.0;
+      for ( k = 0; k < 4; k++ ) 
+        c[i][j] += a[i][k]*b[k][j];
+    }
+}
+
+/*   A (I)   3*3 matrix to be inverted */
+/*   AI (O)   inverse matrix */
+/*   returns determinant */
+
+double invert3matrix(const double a[3][3], double ai[3][3])
+
+{ int i,j;
+  double c[3][3],d;
+
+  ccp4_dcross(a[1],a[2],c[0]);
+  ccp4_dcross(a[2],a[0],c[1]);
+  ccp4_dcross(a[0],a[1],c[2]);
+
+  d = a[0][0]*c[0][0] + a[0][1]*c[0][1] + a[0][2]*c[0][2];
+
+  if (d > 1.0e-30) {
+    for ( i = 0; i < 3; i++ ) 
+      for ( j = 0; j < 3; j++ ) 
+        ai[i][j] = c[j][i] / d;
+  } else {
+    return 0;
+  }
+  return d;
+}
+
+/*   A (I)   4*4 matrix to be inverted */
+/*   AI (O)   inverse matrix */
+/*   returns determinant */
+
+float invert4matrix(const float a[4][4], float ai[4][4])
+
+{
+    float c[4][4], d;
+    int i, j;
+    float x[3][3];
+    int i1, j1, i2 ;
+    float am;
+    int ii, jj;
+
+    /* Function Body */
+    for (ii = 0; ii < 4; ++ii) {
+	for (jj = 0; jj < 4; ++jj) {
+	    i = -1;
+	    for (i1 = 0; i1 < 4; ++i1) {
+		if (i1 != ii) {
+		    ++i;
+		    j = -1;
+		    for (j1 = 0; j1 < 4; ++j1) {
+			if (j1 != jj) {
+			    ++j;
+			    x[i][j] = a[i1][j1];
+			}
+		    }
+		}
+	    }
+
+	    am = x[0][0]*x[1][1]*x[2][2] - x[0][0]*x[1][2]*x[2][1] +
+     +         x[0][1]*x[1][2]*x[2][0] - x[0][1]*x[1][0]*x[2][2] +
+     +         x[0][2]*x[1][0]*x[2][1] - x[0][2]*x[1][1]*x[2][0];
+	    i2 = ii + jj;
+	    c[ii][jj] = ccp4_pow_ii(-1.0, i2) * am;
+	}
+    }
+
+/* ---- Calculate determinant */
+
+    d = 0.0;
+
+    for (i = 0; i < 4; ++i) {
+	d = a[i][0] * c[i][0] + d;
+    }
+
+/* ---- Get inverse matrix */
+
+
+  if (d > 1.0e-30) {
+    for (i = 0; i < 4; ++i) {
+	for (j = 0; j < 4; ++j) {
+	    ai[i][j] = c[j][i] / d;
+	}
+    }
+  } else {
+    return 0;
+  }
+
+  return d;
+} 
+
+float ccp4_pow_ii(const float base, const int power) {
+
+  int i = 0;
+  float pow = 1;
+
+  while (++i <= power)
+    pow *= base;
+
+  return pow;
+}
+
diff -ruN ccp4-5.99.5-orig/lib/cctbx/cctbx_sources/ccp4io/lib/src/cvecmat.h ccp4-5.99.5/lib/cctbx/cctbx_sources/ccp4io/lib/src/cvecmat.h
--- ccp4-5.99.5-orig/lib/cctbx/cctbx_sources/ccp4io/lib/src/cvecmat.h	1969-12-31 16:00:00.000000000 -0800
+++ ccp4-5.99.5/lib/cctbx/cctbx_sources/ccp4io/lib/src/cvecmat.h	2005-11-30 17:40:04.000000000 -0800
@@ -0,0 +1,63 @@
+/*
+     cvecmat.h: header file for cvecmat.c
+     Copyright (C) 2001  CCLRC, Martyn Winn
+
+     This library is free software and is distributed under the terms and
+     conditions of the CCP4 licence agreement as `Part 0' (Annex 2)
+     software, which is version 2.1 of the GNU Lesser General Public
+     Licence (LGPL) with the following additional clause:
+
+        `You may also combine or link a "work that uses the Library" to
+        produce a work containing portions of the Library, and distribute
+        that work under terms of your choice, provided that you give
+        prominent notice with each copy of the work that the specified
+        version of the Library is used in it, and that you include or
+        provide public access to the complete corresponding
+        machine-readable source code for the Library including whatever
+        changes were used in the work. (i.e. If you make changes to the
+        Library you must distribute those, but you do not need to
+        distribute source or object code to those portions of the work
+        not covered by this licence.)'
+
+     Note that this clause grants an additional right and does not impose
+     any additional restriction, and so does not affect compatibility
+     with the GNU General Public Licence (GPL). If you wish to negotiate
+     other terms, please contact the maintainer.
+
+     You can redistribute it and/or modify the library under the terms of
+     the GNU Lesser General Public License as published by the Free Software
+     Foundation; either version 2.1 of the License, or (at your option) any
+     later version.
+
+     This library is distributed in the hope that it will be useful, but
+     WITHOUT ANY WARRANTY; without even the implied warranty of
+     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+     Lesser General Public License for more details.
+
+     You should have received a copy of the CCP4 licence and/or GNU
+     Lesser General Public License along with this library; if not, write
+     to the CCP4 Secretary, Daresbury Laboratory, Warrington WA4 4AD, UK.
+     The GNU Lesser General Public can also be obtained by writing to the
+     Free Software Foundation, Inc., 59 Temple Place, Suite 330, Boston,
+     MA 02111-1307 USA
+*/
+#ifndef __CCP4_VECMAT
+#define __CCP4_VECMAT
+
+#ifdef  __cplusplus
+extern "C" {
+#endif
+
+void ccp4_dcross(const double a[3], const double b[3], double c[3]);
+void ccp4_3matmul(double c[3][3], const double a[3][3], const double b[3][3]);
+void ccp4_4matmul( float c[4][4], const float  a[4][4], const float b[4][4]);
+double invert3matrix(const double a[3][3], double ai[3][3]);
+float invert4matrix(const float a[4][4], float ai[4][4]);
+
+float ccp4_pow_ii(const float base, const int power);
+
+#ifdef __cplusplus
+}
+#endif
+
+#endif  /*!CCP4_VECMAT */
diff -ruN ccp4-5.99.5-orig/lib/cctbx/cctbx_sources/ccp4io/lib/src/library_err.c ccp4-5.99.5/lib/cctbx/cctbx_sources/ccp4io/lib/src/library_err.c
--- ccp4-5.99.5-orig/lib/cctbx/cctbx_sources/ccp4io/lib/src/library_err.c	1969-12-31 16:00:00.000000000 -0800
+++ ccp4-5.99.5/lib/cctbx/cctbx_sources/ccp4io/lib/src/library_err.c	2005-11-30 17:40:04.000000000 -0800
@@ -0,0 +1,344 @@
+/*
+     library_err.c: Error handling library
+     Copyright (C) 2001  CCLRC, Charles Ballard
+
+     This library is free software and is distributed under the terms and
+     conditions of the CCP4 licence agreement as `Part 0' (Annex 2)
+     software, which is version 2.1 of the GNU Lesser General Public
+     Licence (LGPL) with the following additional clause:
+
+        `You may also combine or link a "work that uses the Library" to
+        produce a work containing portions of the Library, and distribute
+        that work under terms of your choice, provided that you give
+        prominent notice with each copy of the work that the specified
+        version of the Library is used in it, and that you include or
+        provide public access to the complete corresponding
+        machine-readable source code for the Library including whatever
+        changes were used in the work. (i.e. If you make changes to the
+        Library you must distribute those, but you do not need to
+        distribute source or object code to those portions of the work
+        not covered by this licence.)'
+
+     Note that this clause grants an additional right and does not impose
+     any additional restriction, and so does not affect compatibility
+     with the GNU General Public Licence (GPL). If you wish to negotiate
+     other terms, please contact the maintainer.
+
+     You can redistribute it and/or modify the library under the terms of
+     the GNU Lesser General Public License as published by the Free Software
+     Foundation; either version 2.1 of the License, or (at your option) any
+     later version.
+
+     This library is distributed in the hope that it will be useful, but
+     WITHOUT ANY WARRANTY; without even the implied warranty of
+     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+     Lesser General Public License for more details.
+
+     You should have received a copy of the CCP4 licence and/or GNU
+     Lesser General Public License along with this library; if not, write
+     to the CCP4 Secretary, Daresbury Laboratory, Warrington WA4 4AD, UK.
+     The GNU Lesser General Public can also be obtained by writing to the
+     Free Software Foundation, Inc., 59 Temple Place, Suite 330, Boston,
+     MA 02111-1307 USA
+*/
+
+/** @file library_err.c
+ *  Error handling library.
+ *  Charles Ballard
+ */
+
+#include <stdlib.h>
+#include <stdio.h>
+#include <string.h>
+#include "ccp4_errno.h"
+
+/** @global ccp4_errno: global to store data 
+*/
+int ccp4_errno = 0;
+
+/* error_levels: error level descriptions */
+static const char * const error_levels[] =
+  {
+    "Success",                                   /* 0 */
+    "Informational",                             /* 1 */
+    "Warning",                                   /* 2 */
+    "Error",                                     /* 3 */
+    "FATAL ERROR"                                /* 4 */
+};
+
+/* file io errors */
+static const char *const cfile_errlist[] =
+  {
+    "Error 0",                                   /* 0 = CIO_Ok */
+    "Bad mode",                                  /* 1 = CIO_BadMode */
+    "Cannot open file",                          /* 2 = CIO_CantOpenFile */
+    "Too many open files",                       /* 3 = CIO_MaxFile */
+    "Read failed",                               /* 4 = CIO_ReadFail */
+    "Write failed",                              /* 5 = CIO_WriteFail */
+    "Close fail",                                /* 6 = CIO_CloseFail */
+    "Seek fail",                                 /* 7 = CIO_SeekFail */
+    "Null pointer passed",                       /* 8 = CIO_NullPtr */
+    "End of File",                               /* 9 = CIO_EOF */
+    "No file"                                    /* 10 = CIO_NoFile */
+    "File not open",                             /* 11 = CIO_NotOpen */
+    "Unlink failed"                              /* 12 = CIO_UnlinkFail */
+  };
+
+/* map library errors */
+static const char *const cmap_errlist[] =
+  {
+    "Error 0",                                   /* 0 = CMERR_Ok */
+    "Unassigned unit",                           /* 1 = CMERR_NoChannel */
+    "Unassigned unit or disposed file",          /* 2 = CMERR_NoFile */
+    "Logical name does not exist",               /* 3 = CMERR_NoLogicalName */
+    "Cannot open file",                          /* 4 = CMERR_CantOpenFile */
+    "No associated header",                      /* 5 = CMERR_NoHeader */
+    "Read failed",                               /* 6 = CMERR_ReadFail */
+    "Write failed",                              /* 7 = CMERR_WriteFail */
+    "Parameter or dimension is incorrect    ",   /* 8 = CMERR_ParamError */
+    "Unrecognised keyword",                      /* 9 = CMERR_UnrecognK */
+    "File stamp error",                          /* 10 = CMERR_FileStamp */
+    "Symmetry",                                  /* 11 = CMERR_SymErr */
+    "Cannot allocate memory",                    /* 12 = CMERR_AllocFail */
+    "Too many open files",                       /* 13 = CMERR_MaxFile */
+  };
+
+/* mtz library errrors */
+static const char *const cmtz_errlist[] =
+  {
+    "Error 0",                                   /* 0 = CMTZERR_Ok */
+    "Unassigned unit",                           /* 1 = CMTZERR_NoChannel */
+    "Null file handle, file not opened",         /* 2 = CMTZERR_NoFile */
+    "Logical name does not exist",               /* 3 = CMTZERR_NoLogicalName */
+    "Cannot open file",                          /* 4 = CMTZERR_CantOpenFile */
+    "No associated header",                      /* 5 = CMTZERR_NoHeader */
+    "Read failed",                               /* 6 = CMTZERR_ReadFail */
+    "Write failed",                              /* 7 = CMTZERR_WriteFail */
+    "Function parameter is incorrect",           /* 8 = CMTZERR_ParamError */
+    "Invalid cell dimensions",                   /* 9 = CMTZERR_Cellerr */
+    "File stamp error",                          /* 10 = CMTZERR_FileStamp */
+    "Symmetry",                                  /* 11 = CMTZERR_SymErr */
+    "Cannot allocate memory",                    /* 12 = CMTZERR_AllocFail */
+    "Too many open files",                       /* 13 = CMTZERR_MaxFile */
+    "Failed to initialise parser",               /* 14 = CMTZERR_ParserFail */
+    "File not identified as MTZ",                /* 15 = CMTZERR_NotMTZ */
+    "Missing or incomplete dataset information in input file.", /* 16 = CMTZERR_DatasetIncomplete */
+    "No architecture information in file.",      /* 17 = CMTZERR_NoArch */
+    "Attempt to access unallocated dataset",     /* 18 = CMTZERR_NullDataset */
+    "Input MTZ file has incorrect major version for current library",      /* 19 = CMTZERR_BadVersion */
+    "MTZ header is corrupted: missing tokens in SYMINF record", /* 20 = CMTZERR_SYMINFIncomplete */
+    "MTZ header is corrupted: missing tokens in COLUMN record", /* 21 = CMTZERR_COLUMNIncomplete */
+    "Batch headers corrupted",                   /* 22 = CMTZERR_BadBatchHeader */
+    "Input MTZ file has different minor version to that supported by current library",      /* 23 = CMTZERR_DifferentVersion */
+  };
+
+/* parser library errors */
+static const char *const cpars_errlist[] =
+  {
+    "Error 0",                                   /* 0 = CPARSERR_Ok */
+    "Maximum number of tokens exceeded",         /* 1 = CPARSERR_MaxTokExceeded */
+    "Cannot allocate memory",                    /* 2 = CPARSERR_AllocFail */
+    "Null pointer",                              /* 3 = CPARSERR_NullPointer */
+    "Line is longer than allocated length, so truncated", /* 4 = CPARSERR_LongLine */
+    "Failed to open external command file",      /* 5 = CPARSERR_CantOpenFile */
+    "Failed to get name for external file",      /* 6 = CPARSERR_NoName */
+    "Overflow - exponent is too big to be evaluated",  /* 7 = CPARSERR_ExpOverflow */
+    "Underflow - exponent is too small to be evaluated", /* 8 = CPARSERR_ExpUnderflow */
+    "Problem in mat4_to_symop",                  /* 9 = CPARSERR_MatToSymop */
+    "Failed to interpret symop string",          /* 10 = CPARSERR_SymopToMat */
+  };
+
+/* symmetry library errors */
+static const char *const csym_errlist[] =
+  {
+    "Error 0",                                   /* 0 = CSYMERR_Ok */
+    "Failed to initialise parser",               /* 1 = CSYMERR_ParserFail */
+    "Cannot find SYMINFO file - no symmetry information", /* 2 = CSYMERR_NoSyminfoFile */
+    "Pointer to spacegroup structure is NULL",   /* 3 = CSYMERR_NullSpacegroup */
+    "ASU definition not found for this spacegroup", /* 4 = CSYMERR_NoAsuDefined */
+    "Undefined Laue code for this spacegroup",   /* 5 = CSYMERR_NoLaueCodeDefined */
+  };
+
+static const char *const cgen_errlist[] =
+  {
+    "Error 0",                                   /* 0 = CGENERR_Ok */
+    "Cannot allocate memory",                    /* 1 = CGENERR_AllocFail */
+    "Cannot set environment variable",           /* 2 = CGENERR_CantSetEnvironment */
+    "Maximum number of logical names exceeded",  /* 3 = CGENERR_MaxNamesExceeded */
+    "Use: -e filename",                          /* 4 = CGENERR_EOptionUseError */
+    "Use: -d filename",                          /* 5 = CGENERR_DOptionUseError */
+    "Use: <logical name> <file name>",           /* 6 = CGENERR_LogicalNameUseError */
+    "Cannot open environ.def",                   /* 7 = CGENERR_CantOpenEnvFile */
+    "Cannot open default.def",                   /* 8 = CGENERR_CantOpenDefFile */
+    "Cannot parse environ.def file",             /* 9 = CGENERR_ParseEnvFail */
+    "Cannot parse default.def file",             /* 10= CGENERR_ParseDefFail */
+    "Cannot find input file",                    /* 11= CGENERR_CantFindInFile */
+    "Failed to set path for environ.def file",   /* 12= CGENERR_EnvPathFail */
+    "Failed to set path for default.def file",   /* 13= CGENERR_DefPathFail */
+    "Cannot get CLIBD from environment",         /* 14= CGENERR_CantGetClibd */
+    "Cannot get CCP4_SCR from environment",      /* 15= CGENERR_CantGetCcp4Scr */
+  };
+
+struct error_system {
+  char system[32];
+  int system_nerr;
+  const char * const *error_list;
+};
+
+/* construct error list */
+static const struct error_system ccp4_errlist[] = {
+    {"system", 0, 0, },
+    {"library_file", CCP4_COUNT(cfile_errlist), cfile_errlist,},
+    {"mmdb", 0, 0,},
+    {"mtz", CCP4_COUNT(cmtz_errlist), cmtz_errlist,},
+    {"ccp4_map", CCP4_COUNT(cmap_errlist), cmap_errlist,},
+    {"utils", 0, 0},
+    {"ccp4_parser", CCP4_COUNT(cpars_errlist), cpars_errlist,},
+    {"csym", CCP4_COUNT(csym_errlist), csym_errlist,},
+    {"ccp4_general", CCP4_COUNT(cgen_errlist), cgen_errlist,}
+};
+
+static const int ccp4_system_nerr = CCP4_COUNT(ccp4_errlist);
+
+/* Obtain character string based upon error code.
+    Typical use ccp4_strerror(ccp4_errno)
+    The returned string is statically allocated in the
+    library_err.c file and should not be freed.
+    param error code (int)
+    returns const pointer to error message.
+*/
+const char *ccp4_strerror(int error)
+{
+  int system = CCP4_ERRGETSYS(error);
+  /* int level = CCP4_ERRGETLEVEL(error); */
+  int code = CCP4_ERRGETCODE(error);
+
+  if (error == -1 || system == 0)
+    return strerror(errno);
+
+  if (system >= ccp4_system_nerr)
+    return ("bad system error");
+  if (code >= ccp4_errlist[system].system_nerr)
+    return ("bad error code");
+  return (ccp4_errlist[system].error_list[code]);
+}
+
+/* Print out passed message and internal message based upon
+    ccp4_errno
+    "message : error message "
+    param message (const char *)
+    return void      
+*/
+void ccp4_error (const char *msg)
+{
+  const char *colon;
+
+  if (msg == 0 || *msg == '\0')
+    colon = "";
+  else
+    colon = ": ";
+ 
+  fprintf (stderr, "%s%s%s\n",
+           msg, colon, ccp4_strerror(ccp4_errno));
+  if(ccp4_errno != -1 && CCP4_ERRGETSYS(ccp4_errno)) {
+    fprintf (stderr, "System: %s\nLevel: %d\n", 
+             ccp4_errlist[CCP4_ERRGETSYS(ccp4_errno)].system,
+             CCP4_ERRGETLEVEL(ccp4_errno));
+    if (errno)
+      fprintf (stderr, "%s%s\n",
+               "Last system message: ",strerror(errno)); }
+}
+
+/* Wrapper for ccp4_error which also calls exit(1)
+   param message (const char *)
+*/
+void ccp4_fatal (const char *message)
+{
+  ccp4_error(message);
+  exit(1);
+}
+
+int CFile_Perror(const char *msg)
+{
+  const char * colon;
+  int error = CCP4_ERRGETCODE(ccp4_errno);
+  int cfile_nerr = ccp4_errlist[4].system_nerr;
+
+  if (msg == NULL || msg == '\0') colon = "";
+  else colon = ": ";
+
+  if (error > 0 && error <= cfile_nerr) {
+    fprintf(stderr,"%s%s%s \n",
+            msg,colon,cfile_errlist[error]);
+    return error; }
+  fprintf(stderr,"Unknown error code");
+  return -1;
+}
+
+int ccp4_liberr_verbosity(int iverb) {
+  static int verbosity_level=1;
+
+  if (iverb >= 0)
+    verbosity_level = iverb;
+
+  return verbosity_level;
+}
+
+/* Routine to set ccp4_errno and print out message for
+    error tracing. This should be the only way in
+    which ccp4_errno is set.
+    See error codes above for levels and systems.
+    A callback with prototype void function(void)
+    may also be passed to the routine.
+    Note: FATAL calls exit(1).
+    param error code (int)
+    param message (const char * const)
+    param callback (point to routine)
+*/
+void ccp4_signal(const int code, const char * const msg, 
+		 void (*callback) ())
+{
+  int severity = CCP4_ERRGETLEVEL(code),
+    system     = CCP4_ERRGETSYS(code),
+    msg_no     = CCP4_ERRGETCODE(code),
+    fatal_err  = (severity == 4);
+  static const char msg_fmt[] = ">>>>>> CCP4 library signal %s:%s (%s)\n\t raised in %s <<<<<<\n";
+   static const char sys_fmt[] = ">>>>>> System signal %d:%s (%s)\n\t raised in %s <<<<<<\n";
+  ccp4_errno = code;
+
+  /* use this function to control whether error messages are printed */
+  if (!ccp4_liberr_verbosity(-1)) return;
+
+  if (system == 0) {
+    if (msg) 
+      printf(sys_fmt,
+	     errno,
+	     strerror(errno),
+	     error_levels[severity],
+	     msg);
+    else 
+      printf(">>>>>> System signal %d:%s (%s) <<<<<<", 
+	     errno, 
+	     strerror(errno), 
+	     error_levels[severity]);
+    ccp4_errno = errno; }
+  else 
+    if (msg) 
+      printf(msg_fmt,
+	     ccp4_errlist[system].system,
+	     ccp4_errlist[system].error_list[msg_no],
+	     error_levels[severity],
+	     msg);
+    else
+      printf(">>>>>> CCP4 library signal %s:%s (%s) <<<<<<\n",
+	     ccp4_errlist[system].system,
+	     ccp4_errlist[system].error_list[msg_no],
+	     error_levels[severity]);
+  
+  if (callback)
+    (*callback)();
+
+  if (fatal_err) exit(1);
+}
+
+
diff -ruN ccp4-5.99.5-orig/lib/cctbx/cctbx_sources/ccp4io/lib/src/library_file.c ccp4-5.99.5/lib/cctbx/cctbx_sources/ccp4io/lib/src/library_file.c
--- ccp4-5.99.5-orig/lib/cctbx/cctbx_sources/ccp4io/lib/src/library_file.c	1969-12-31 16:00:00.000000000 -0800
+++ ccp4-5.99.5/lib/cctbx/cctbx_sources/ccp4io/lib/src/library_file.c	2005-11-30 17:40:04.000000000 -0800
@@ -0,0 +1,2252 @@
+/*
+     library_file.c: functions for file i/o
+     Copyright (C) 2001  CCLRC, Charles Ballard
+
+     This library is free software and is distributed under the terms and
+     conditions of the CCP4 licence agreement as `Part 0' (Annex 2)
+     software, which is version 2.1 of the GNU Lesser General Public
+     Licence (LGPL) with the following additional clause:
+
+        `You may also combine or link a "work that uses the Library" to
+        produce a work containing portions of the Library, and distribute
+        that work under terms of your choice, provided that you give
+        prominent notice with each copy of the work that the specified
+        version of the Library is used in it, and that you include or
+        provide public access to the complete corresponding
+        machine-readable source code for the Library including whatever
+        changes were used in the work. (i.e. If you make changes to the
+        Library you must distribute those, but you do not need to
+        distribute source or object code to those portions of the work
+        not covered by this licence.)'
+
+     Note that this clause grants an additional right and does not impose
+     any additional restriction, and so does not affect compatibility
+     with the GNU General Public Licence (GPL). If you wish to negotiate
+     other terms, please contact the maintainer.
+
+     You can redistribute it and/or modify the library under the terms of
+     the GNU Lesser General Public License as published by the Free Software
+     Foundation; either version 2.1 of the License, or (at your option) any
+     later version.
+
+     This library is distributed in the hope that it will be useful, but
+     WITHOUT ANY WARRANTY; without even the implied warranty of
+     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+     Lesser General Public License for more details.
+
+     You should have received a copy of the CCP4 licence and/or GNU
+     Lesser General Public License along with this library; if not, write
+     to the CCP4 Secretary, Daresbury Laboratory, Warrington WA4 4AD, UK.
+     The GNU Lesser General Public can also be obtained by writing to the
+     Free Software Foundation, Inc., 59 Temple Place, Suite 330, Boston,
+     MA 02111-1307 USA 
+*/
+
+/** @file library_file.c
+ *  Functions for file i/o.
+ *  Charles Ballard
+ */
+
+#include<string.h>
+#include <limits.h>
+#include <fcntl.h>
+#if defined _MSC_VER
+#include <io.h>
+#endif
+#include "library_file.h"
+#include "ccp4_errno.h"
+#include "ccp4_file_err.h"
+                                                        
+static uint16 nativeIT = NATIVEIT; /* machine integer type */ 
+static uint16 nativeFT = NATIVEFT; /* machine float type */
+
+static int _item_sizes[] = {
+  (int) sizeof (char),          /* 0: bytes */
+  (int) sizeof (short int),     /* 1: (integer) half words */
+  (int) sizeof (float),         /* 2: reals/words */
+  (int) sizeof (int),           /* 3: `short complex' (pairs of half words).
+                                   NB int rather than 2*short since must fit
+                                   into fortran integer */
+  (int) 2*sizeof (float),        /* 4: complex (pairs of words) */
+  (int) sizeof (int),           /* 5: not used */
+  (int) sizeof (int)            /* 6: integers */
+};
+
+static int (*_read_mode[])(CCP4File *, uint8 *, size_t) = {
+  ccp4_file_readchar,
+  ccp4_file_readshort,
+  ccp4_file_readfloat,
+  ccp4_file_readshortcomp,
+  ccp4_file_readcomp,
+  NULL,
+  ccp4_file_readint
+};
+
+static int (*_write_mode[])(CCP4File *, const uint8 *, size_t) = {
+  ccp4_file_writechar,
+  ccp4_file_writeshort,
+  ccp4_file_writefloat,
+  ccp4_file_writeshortcomp,
+  ccp4_file_writecomp,
+  NULL,
+  ccp4_file_writeint    
+};
+
+/**
+ * vaxF2ieeeF:
+ * @param buffer (float_uint_uchar *) vax order float array
+ * @param size (unsigned int) number of items
+ *
+ * Translation from Vax floating point format to ieee.
+ *
+ */
+static void vaxF2ieeeF(union float_uint_uchar *buffer, const unsigned int size)
+{
+  union float_uint_uchar out;
+  unsigned char exp;
+  unsigned int i;
+
+  if ( buffer == NULL || size == 0) return;
+  
+  for (i = 0; i < size; i++) {
+    exp = (buffer[i].c[1] << 1) | (buffer[i].c[0] >> 7); /* extract exponent */
+    if (!exp && !buffer[i].c[1])        /* zero value */
+      out.c[0] = out.c[1] = out.c[2] = out.c[3] = 0;
+    else if (exp > 2) {         /* normal value */
+      out.c[0] = buffer[i].c[1] - (uint8)1; /* subtracts 2 from exponent */
+      /* copy mantissa, LSB of exponent */
+      out.c[1] = buffer[i].c[0];
+      out.c[2] = buffer[i].c[3];
+      out.c[3] = buffer[i].c[2];
+    } else if (exp) {           /* denormalized number */
+      int shft;
+
+      out.c[0] = buffer[i].c[1] & 0x80; /* keep sign, zero exponent */
+      shft = 3 - exp;
+      /* shift original mant by 1 or 2 to get denormalized mant */
+      /* prefix mantissa with '1'b or '01'b as appropriate */
+      out.c[1] = (uint8)((buffer[i].c[0] & 0x7f) >> shft) |
+        (uint8)(0x10 << exp);
+      out.c[2] = (uint8)(buffer[i].c[0] << (8-shft)) |
+        (uint8)(buffer[i].c[3] >> shft);
+      out.c[3] = (uint8)(buffer[i].c[3] << (8-shft)) |
+        (uint8)(buffer[i].c[2] >> shft);
+    } else {                    /* sign=1 -> infinity or NaN */
+      out.c[0] = 0xff;          /* set exp to 255 */
+      /* copy mantissa */
+      out.c[1] = buffer[i].c[0] | (uint8)0x80; /* LSB of exp = 1 */
+      out.c[2] = buffer[i].c[3];
+      out.c[3] = buffer[i].c[2];
+    }
+    buffer[i] = out;            /* copy back result */
+  }
+}
+
+/**
+ * ieeeF2vaxF:
+ * @param buffer (float_uint_uchar *) big endian order float array
+ * @param size (unsigned int) number of items
+ *
+ * Translation from ieee floating point format to vax.
+ *
+ */
+static void ieeeF2vaxF(union float_uint_uchar *buffer, const unsigned int size)
+{
+  union float_uint_uchar out;
+  unsigned char exp;
+  unsigned int i;
+
+  if ( buffer == NULL || size == 0) return;
+
+  for (i=0; i<size; i++) {
+    exp = (buffer[i].c[0]<<1) | (buffer[i].c[1]>>7); /* extract exponent */
+    if (exp) {                  /* non-zero exponent */
+      /* copy mantissa, last bit of exponent */
+      out.c[0] = buffer[i].c[1];
+      out.c[2] = buffer[i].c[3];
+      out.c[3] = buffer[i].c[2];
+      if (exp < 254)            /* normal value */
+        out.c[1] = buffer[i].c[0] + (uint8)1; /* actually adds two to exp */
+      else {                    /* infinity or NaN */
+        if (exp == 254)         /* unrepresentable - OFL */
+          /* set mant=0 for overflow */
+          out.c[0] = out.c[1] = out.c[2] = out.c[3] = 0; 
+        out.c[0] &= 0x7f;       /* set last bit of exp to 0 */
+        out.c[1] = 0x80;        /* sign=1 exp=0 -> OFL or NaN.  this will raise
+                                   a reserved operand exception if used. */
+      }
+    } else if (buffer[i].c[1] & 0x60) { /* denormalized value */
+      int shft;
+      
+      shft = (buffer[i].c[1] & 0x40) ? 1 : 2; /* shift needed to normalize */
+      /* shift mantissa */
+      /* note last bit of exp set to 1 implicitly */
+      out.c[0] = (uint8)(buffer[i].c[1] << shft) |
+        (uint8)(buffer[i].c[2] >> (8-shft));
+      out.c[3] = (uint8)(buffer[i].c[2] << shft) |
+        (uint8)(buffer[i].c[3] >> (8-shft));
+      out.c[2] = (uint8)(buffer[i].c[3] << shft);
+      out.c[1] = (uint8)(buffer[i].c[0] & 0x80); /* sign */
+      if (shft==1) {            /* set exp to 2 */
+        out.c[1] |= 0x01;
+        out.c[0] &= 0x7f;       /* set LSB of exp to 0 */
+      }
+    } else                      /* zero */
+      out.c[0] = out.c[1] = out.c[2] = out.c[3] = 0;
+    buffer[i] = out;            /* copy back the result */
+  }
+}
+
+/**
+ * convexF2ieeeF:
+ * @param buffer (float_uint_uchar *) float array with convex byte ordering
+ * @param size (unsigned int) number of items
+ *
+ * Translation from convex floating point format to ieee.
+ *
+ */
+static void convexF2ieeeF(union float_uint_uchar *buffer, const unsigned int size)
+{
+  union float_uint_uchar out;
+  unsigned char exp;
+  unsigned int i;
+
+  if ( buffer == NULL || size == 0) return;
+  
+  for (i = 0; i < size; i++) {
+    exp = (buffer[i].c[0]<<1) | (buffer[i].c[1]>>7); /* extract exponent */
+    if (!exp && !buffer[i].c[0])        /* zero value */
+      out.c[0] = out.c[1] = out.c[2] = out.c[3] = 0;
+    else if (exp > 2) {         /* normal value */
+      out.c[0] = buffer[i].c[0] - (uint8)1; /* subtracts 2 from exponent */
+      /* copy mantissa, LSB of exponent */
+      out.c[1] = buffer[i].c[1];
+      out.c[2] = buffer[i].c[2];
+      out.c[3] = buffer[i].c[3];
+    } else if (exp) {           /* denormalized number */
+      int shft;
+      
+      out.c[0] = buffer[i].c[0] & 0x80; /* keep sign, zero exponent */
+      shft = 3 - exp;
+      /* shift original mant by 1 or 2 to get denormalized mant */
+      /* prefix mantissa with '1'b or '01'b as appropriate */
+      out.c[1] = (uint8)((buffer[i].c[1] & 0x7f) >> shft) |
+        (uint8)(0x10 << exp);
+      out.c[2] = (uint8)(buffer[i].c[1] << (8-shft)) |
+        (uint8)(buffer[i].c[2] >> shft);
+      out.c[3] = (uint8)(buffer[i].c[2] << (8-shft)) |
+        (uint8)(buffer[i].c[3] >> shft);
+    } else {                    /* sign=1 -> infinity or NaN */
+      out.c[0] = 0xff;          /* set exp to 255 */
+      /* copy mantissa */
+      out.c[1] = buffer[i].c[1] | (uint8)0x80; /* LSB of exp = 1 */
+      out.c[2] = buffer[i].c[2];
+      out.c[3] = buffer[i].c[3];
+    }
+    buffer[i] = out;            /* copy back result */
+  }
+}
+
+/**
+ * ieeeF2convexF:
+ * @param buffer (float_uint_uchar *) float array with big endian byte ordering
+ * @param size (const unsigned int) numnber of items
+ *
+ * Translation from ieee floating point format to convex.
+ *
+ */
+static void ieeeF2convexF(union float_uint_uchar *buffer, const unsigned int size)
+{
+  union float_uint_uchar out;
+  unsigned char exp;
+  unsigned int i;
+
+  if ( buffer == NULL || size == 0) return;
+
+  for (i=0; i < size; i++) {
+    exp = (uint8)(buffer[i].c[0] << 1) |
+      (uint8)(buffer[i].c[1] >> 7); /* extract exponent */
+    if (exp) {                  /* non-zero exponent */
+      /* copy mantissa, last bit of exponent */
+      out.c[1] = buffer[i].c[1];
+      out.c[3] = buffer[i].c[3];
+      out.c[2] = buffer[i].c[2];
+      if (exp < 254)            /* normal value */
+        out.c[0] = buffer[i].c[0] + (uint8)1; /* actually adds two to exp */
+      else {                    /* infinity or NaN */
+        if (exp == 254)         /* unrepresentable - OFL */
+          /* set mant=0 for overflow */
+          out.c[0] = out.c[1] = out.c[2] = out.c[3] = 0; 
+        out.c[1] &= 0x7f;       /* set last bit of exp to 0 */
+        out.c[0] = 0x80;        /* sign=1 exp=0 -> OFL or NaN.  this will raise
+                                   a reserved operand exception if used. */
+      }
+    } else if (buffer[i].c[1] & 0x60) { /* denormalized value */
+      int shft;
+      
+      shft = (buffer[i].c[1] & 0x40) ? 1 : 2; /* shift needed to normalize */
+      /* shift mantissa */
+      /* note last bit of exp set to 1 implicitly */
+      out.c[1] = (uint8)(buffer[i].c[1] << shft) |
+        (uint8)(buffer[i].c[2] >> (8-shft));
+      out.c[2] = (uint8)(buffer[i].c[2] << shft) |
+        (uint8)(buffer[i].c[3] >> (8-shft));
+      out.c[3] = (uint8)(buffer[i].c[3] << shft);
+      out.c[0] = (uint8)(buffer[i].c[0] & 0x80); /* sign */
+      if (shft==1) {            /* set exp to 2 */
+        out.c[0] |= 0x01;
+        out.c[1] &= 0x7f;       /* set LSB of exp to 0 */
+      }
+    } else                      /* zero */
+      out.c[0] = out.c[1] = out.c[2] = out.c[3] = 0;
+    buffer[i] = out;            /* copy back the result */
+  }
+}
+
+/**
+ * ccp4_file_raw_read:
+ * @param cfile *  (CCP4File *)
+ * @param buffer * (char *) input array
+ * @param n_items (size_t) number of items
+ *
+ * reads block of n_items bytes from cfile to buffer via
+ * FILE struct cfile->stream(fread) or file desc cfile->fd
+ * read/_read).  Increments location value cfile->loc. The
+ * cfile->iostat flag is set on failure.
+ * @return number of bytes read.
+ */
+int ccp4_file_raw_read(CCP4File *cfile, char *buffer, size_t n_items)
+{
+  int result;
+  
+  if (cfile->buffered && cfile->stream) {
+    result = fread (buffer, (size_t) sizeof(char), n_items,
+                    cfile->stream);
+    if (result != n_items && feof(cfile->stream)) {
+      ccp4_signal(CCP4_ERRLEVEL(3) | CCP4_ERRNO(CIO_EOF), 
+		  "ccp4_file_raw_read", NULL); 
+      cfile->iostat = CIO_EOF;
+      result = EOF;
+    } else if (result != n_items && ferror(cfile->stream)) {
+      ccp4_signal(CCP4_ERRLEVEL(3), "ccp4_file_raw_read", NULL);
+      cfile->iostat = CIO_ReadFail; 
+      result = 0; }
+  } else {
+#if defined _MSC_VER
+    result = _read (cfile->fd, buffer, n_items);
+#else
+    result = read (cfile->fd, buffer, n_items);
+#endif
+    if (n_items && result <= 0) {
+      ccp4_signal(CCP4_ERRLEVEL(3) | CCP4_ERRNO(CIO_ReadFail),
+		  "ccp4_file_raw_read", NULL);
+      cfile->iostat = CIO_ReadFail;
+      result = 0; } 
+  }
+  cfile->last_op = READ_OP;
+
+  cfile->loc += result; 
+  cfile->getbuff = 0;
+
+  return result;
+}
+
+/**
+ * ccp4_file_raw_write:
+ * @param cfile  (CCP4File *)
+ * @param buffer (char *) output array
+ * @param n_items (size_t) number of items
+ *
+ * writes block of @n_items bytes from @buffer to @cfile via FILE struct
+ * @cfile->stream(fwrite) or file desc @cfile->fd(write/_write).  Increments
+ * @cfile->loc on success, or resets on failure, which is then used to
+ * determine the file length.  On failure @cfile->iostat is set.
+ * @return number of bytes written.
+ */
+int ccp4_file_raw_write(CCP4File *cfile, const char *buffer, size_t n_items)
+{
+  int result;
+  
+  if (cfile->buffered && cfile->stream)
+    result = fwrite (buffer, (size_t) sizeof(char), n_items,
+                    cfile->stream);
+  else 
+#if defined _MSC_VER
+    result = _write (cfile->fd, buffer, n_items);
+#else
+    result = write (cfile->fd, buffer, n_items);
+#endif
+        
+  cfile->last_op = WRITE_OP;
+    
+  if (result == n_items) 
+    cfile->loc += n_items; 
+  else {
+    ccp4_signal(CCP4_ERRLEVEL(3) | CCP4_ERRNO(CIO_WriteFail),
+		"ccp4_file_raw_write", NULL);
+    cfile->iostat = CIO_WriteFail; 
+    ccp4_file_tell(cfile); }
+  cfile->length = MAX(cfile->loc,cfile->length);
+  cfile->getbuff = 0;
+
+  return result;
+}
+
+/**
+ * ccp4_file_raw_seek:
+ * @param cfile  (CCP4File *)
+ * @param offset (long) offset in bytes
+ * @param whence (int) SEEK_SET, SEEK_CUR, or SEEK_END
+ *
+ * if the file is "seekable" (not stdin) the function
+ * seeks on @cfile by offset bytes using fseek/ftell (@cfile->stream)
+ * or lseek (@cfile->fd).  %SEEK_SET is relative
+ * to start of file, %SEEK_CUR to current, %SEEK_END to
+ * end.
+ * @return offset in bytes on success, -1 on failure.
+ */
+int ccp4_file_raw_seek(CCP4File *cfile, long offset, int whence)
+{
+  int result = -1;
+      
+  if (!cfile->direct)  {
+    ccp4_signal(CCP4_ERRLEVEL(3) | CCP4_ERRNO(CIO_BadMode),
+		"ccp4_file_raw_seek", NULL);
+    return result; }
+  
+  if (cfile->buffered) {
+#if defined (__alpha) && defined (vms)
+    (void) fflush (cfile->stream);
+#endif
+    if (!(result = (fseek (cfile->stream,offset,whence))))
+      result = ftell(cfile->stream);   
+  } else {
+#if defined _MSC_VER
+     result = _lseek(cfile->fd,offset,whence);
+#else
+     result = lseek(cfile->fd, offset, whence);
+#endif
+  } 
+  
+  cfile->last_op = IRRELEVANT_OP;
+  
+  if (result ==  -1) {
+    ccp4_signal(CCP4_ERRLEVEL(3) | CCP4_ERRNO(CIO_SeekFail),
+		"ccp4_file_raw_seek", NULL);
+    cfile->iostat = CIO_SeekFail;
+  } else 
+    cfile->loc = result;
+  cfile->getbuff = 0;
+  
+  return (result);
+}
+
+/**
+ * _file_free:
+ * @param cfile  (CCP4File *)
+ *
+ * free up @cfile
+ */
+static void _file_free(CCP4File *cfile)
+{
+  if(cfile->name) free(cfile->name);
+  cfile->name = NULL;
+  free(cfile);
+}
+
+/**
+ * _file_init:
+ * @param cfile ()
+ * 
+ * initialise cfile struct
+ * @return cfile struct
+ */
+static CCP4File *_file_init()
+{
+  CCP4File *cfile = (CCP4File *) malloc(sizeof(CCP4File));
+  char *foreign = getenv ("CONVERT_FROM");
+  char *native = getenv ("NATIVEMTZ");
+  
+  memset(cfile,'\0',sizeof(CCP4File));
+  cfile->fd = -1;
+  cfile->buffered = 1;
+  cfile->binary = 1;
+  cfile->last_op = IRRELEVANT_OP;
+  cfile->mode = DEFMODE;
+  cfile->itemsize = _item_sizes[DEFMODE]; 
+  if (native == NULL && foreign != NULL) {
+    if (strcmp (foreign, "BEIEEE") == 0) {
+      cfile->fconvert = DFNTF_BEIEEE ;
+      cfile->iconvert = DFNTI_MBO ; }
+    else if (strcmp (foreign, "LEIEEE") == 0) {
+      cfile->fconvert = DFNTF_LEIEEE;
+      cfile->iconvert = DFNTI_IBO ; }
+    else if (strcmp (foreign, "VAX") == 0) {
+      cfile->fconvert = DFNTF_VAX ;
+      cfile->iconvert = DFNTI_IBO ; }
+    else if (strcmp (foreign, "CONVEXNATIVE") == 0) {
+      cfile->fconvert = DFNTF_CONVEXNATIVE ;
+      cfile->iconvert = DFNTI_MBO ; }  
+  } else {
+    cfile->fconvert = nativeFT;
+    cfile->iconvert = nativeIT;
+  }
+  cfile->_read=_read_mode[DEFMODE];
+  cfile->_write=_write_mode[DEFMODE]; 
+  return (cfile);
+}
+
+/** 
+ * _file_open_mode:
+ * @param cfile (CCP4File *)
+ * @param flag (const int) mode flag
+ *
+ * set file open mode elements of @cfile (see ccp4_sysdep.h)
+ *  O_TMP    = 0x0010
+ *  O_RDONLY = 0x0000
+ *  O_WRONLY = 0x0001
+ *  O_RDWR   = 0x0002
+ *  O_APPEND = 0x0008
+ */
+static void _file_open_mode(CCP4File * cfile, const int flag)
+{
+  if (flag & O_TMP)
+    cfile->scratch = 1;
+  if (flag & (O_WRONLY | O_RDWR | O_APPEND) ) {
+    cfile->write = 1; 
+    if (flag & O_RDWR)
+      cfile->read = 1;
+    if (flag & O_APPEND)
+      cfile->append = 1; 
+  } else 
+    cfile->read = 1; 
+}
+
+/**
+ * _file_close:
+ * @param cfile  (CCP4File *)
+ *
+ * close @cfile if it is "owned" (@cfile->own) using fclose or close.
+ * Reset @cfile to some safe value.  Note: flush anyway.
+ * @return 0 on success, -1 on failure.
+ */
+static int _file_close (CCP4File *cfile)
+{
+  int result = 0;
+  
+  if(cfile->buffered && cfile->stream) {
+    if (cfile->own)
+      result = fclose (cfile->stream); 
+    else
+      result = fflush(cfile->stream);
+  } else {
+    if (cfile->own)
+#if defined _MSC_VER
+      result = _close(cfile->fd);
+#else
+      result = close (cfile->fd);
+#endif
+  }
+  
+  if (result == EOF) 
+    cfile->iostat = CIO_CloseFail;
+  else 
+    cfile->stream = NULL; 
+
+  return (result);
+}
+
+/**
+ * ccp4_file_is_write:
+ * @param cfile  (CCP4File *)
+ *
+ * is the @cfile writeable
+ * @return 1 if true 
+ */
+int ccp4_file_is_write(const CCP4File *cfile)
+{
+  return (cfile->write);
+}
+
+/**
+ * ccp4_file_is_read:
+ * @param cfile  (CCP4File *)
+ *
+ * is the @cfile readable
+ * @return 1 if true.
+ */
+int ccp4_file_is_read(const CCP4File *cfile)
+{
+  return (cfile->read);
+}
+
+/**
+ * ccp4_file_is_append:
+ * @param cfile  (CCP4File *)
+ *
+ * is the @cfile in append mode
+ * @return 1 if true.
+ */
+int ccp4_file_is_append(const CCP4File *cfile)
+{
+  return (cfile->append);
+}
+
+/**
+ * ccp4_file_is_scratch:
+ * @param cfile  (CCP4File *)
+ *
+ * is scratch file
+ * @return 1 if true.
+ */
+int ccp4_file_is_scratch(const CCP4File *cfile)
+{
+  return (cfile->scratch);
+}
+
+/**
+ * ccp4_file_is_buffered:
+ * @param cfile  (CCP4File *)
+ *
+ * is the file buffered
+ * @return 1 if true
+ */
+int ccp4_file_is_buffered(const CCP4File *cfile)
+{
+  return (cfile->buffered);
+}
+
+/**
+ * ccp4_file_status:
+ * @param cfile  (CCP4File *)
+ *
+ * @return @cfile error status
+ */
+int ccp4_file_status(const CCP4File *cfile)
+{
+  return (cfile->iostat);
+}
+
+int ccp4_file_raw_setstamp(CCP4File *cfile, const size_t offset)
+{
+  cfile->stamp_loc = offset;
+  return 0;
+}
+
+/**
+ * ccp4_file_setstamp:
+ * @param cfile  (CCP4File *)
+ * @param stamp_loc (size_t) offset in items
+ *
+ * set the machine stamp offset in CCP4 items determined
+ * by the mode of @cfile.  See ccp4_file_setmode().
+ * @return 0 on success, %EOF on failure
+ */
+int ccp4_file_setstamp(CCP4File *cfile, const size_t offset)
+{
+  if (!cfile) {
+    ccp4_signal(CCP4_ERRLEVEL(3)| CCP4_ERRNO(CIO_NullPtr),
+		"ccp4_file_setstamp", NULL);
+    return EOF; }
+
+  return ccp4_file_raw_setstamp(cfile, offset*cfile->itemsize);
+}
+
+/**
+ * ccp4_file_setmode:
+ * @param cfile  (CCP4File *)
+ * @param mode (int) io_mode
+ *
+ * set the data mode of cfile to mode
+ * (BYTE (8 bit) = 0, 
+ *  INT16  (16 bit) = 1, 
+ *  INT32  (32 bit) = 6, 
+ *  FLOAT32 (32 bit) = 2, 
+ *  COMP32 (2*16 bit) = 3, 
+ *  COMP64 (2*32 bit) = 4).  
+ * @return 0 on success, EOF on failure.
+ */
+int ccp4_file_setmode (CCP4File *cfile, const int mode)
+{
+  if (!cfile) {
+    ccp4_signal(CCP4_ERRLEVEL(3)| CCP4_ERRNO(CIO_NullPtr),
+		"ccp4_file_mode", NULL);
+    return EOF; }
+
+  if (mode >= 0 && mode <= 6 && mode != 5) {
+    cfile->mode = mode;
+    cfile->itemsize = _item_sizes[mode];
+    cfile->_read=_read_mode[mode];
+    cfile->_write=_write_mode[mode];
+  } else {
+    ccp4_signal(CCP4_ERRLEVEL(3)| CCP4_ERRNO(CIO_BadMode),
+		"ccp4_file_mode", NULL);
+    return EOF; }
+
+  return  0;
+}
+
+/**
+ * ccp4_file_mode:
+ * @param cfile  (CCP4File *)
+ *
+ * get data mode of @cfile (BYTE =0, INT16 =1, INT32=6, FLOAT32 =2, 
+ * COMP32 =3, COMP64 =4)
+ * @return %mode
+ */
+int ccp4_file_mode (const CCP4File *cfile)
+{
+  if (!cfile) {
+    ccp4_signal(CCP4_ERRLEVEL(3)| CCP4_ERRNO(CIO_NullPtr),
+		"ccp4_file_mode", NULL);
+    return EOF; }
+    
+  return (cfile->mode);
+}
+
+/**
+ * ccp4_file_itemsize:
+ * @param cfile  (CCP4File *)
+ *
+ * @return %itemsize of @cfile.
+ */
+int ccp4_file_itemsize(const CCP4File *cfile)
+{
+  if (!cfile) {
+    ccp4_signal(CCP4_ERRLEVEL(3)| CCP4_ERRNO(CIO_BadMode),
+		"ccp4_file_itemsize", NULL);
+    return EOF; }
+
+  return (cfile->itemsize);
+}
+
+/**
+ * ccp4_file_name:
+ * @param cfile (CCP4File *)
+ *
+ * strdup @cfile->name
+ * @return name of file as const char *
+ */
+const char *ccp4_file_name( CCP4File *cfile)
+{
+#if defined _MSC_VER
+  return ( cfile == NULL ? NULL : _strdup(cfile->name));
+#else
+  return ( cfile == NULL ? NULL : strdup(cfile->name));
+#endif
+}
+
+/**
+ * ccp4_file_setbyte:
+ * @param cfile (CCP4File *)
+ * @param byte_order (int)
+ *
+ * set byte ordering for file
+ * Return:
+  */
+int ccp4_file_setbyte(CCP4File *cfile, const int byte_order)
+{
+  int result = (cfile->fconvert | (cfile->iconvert<<8));
+  
+  switch (byte_order) {
+  case DFNTF_BEIEEE:
+    cfile->fconvert = DFNTF_BEIEEE;
+    cfile->iconvert = DFNTI_MBO;
+    break;
+  case DFNTF_LEIEEE:
+    cfile->fconvert = DFNTF_LEIEEE;
+    cfile->iconvert = DFNTI_IBO ; 
+    break;
+  case DFNTF_VAX:
+    cfile->fconvert = DFNTF_VAX ;
+    cfile->iconvert = DFNTI_IBO ; 
+    break;
+  case DFNTF_CONVEXNATIVE:
+    cfile->fconvert = DFNTF_CONVEXNATIVE ;
+    cfile->iconvert = DFNTI_MBO ;
+    break;
+  default:
+    ccp4_signal(CCP4_ERRLEVEL(3)| CCP4_ERRNO(CIO_BadMode),
+		"ccp4_file_setbyte", NULL);
+    result = 0;
+  }
+  return result;
+}
+
+/**
+ * ccp4_file_byte:
+ * @param cfile (CCP4File *)
+ *
+ * get byte ordering for file
+ * @return byte ordering information
+  */
+int ccp4_file_byte(CCP4File *cfile)
+{
+  return (cfile->fconvert | (cfile->iconvert<<8));
+}
+
+/**
+ * ccp4_file_open_file:
+ * @param file (const FILE *) FILE struct
+ * @param flag (const int) io mode (O_RDONLY =0, O_WRONLY =1, O_RDWR =2,
+ *        O_TMP =, O_APPEND =)
+ *
+ * open @cfile with existing handle FILE struct file and mode @flag.
+ * The struct stat is check to determine if file is a regular file,
+ * if it is, and is not stdin, it is assumed to be direct access. 
+ * @return (CCP4File *) on success, NULL on failure
+ */
+CCP4File *ccp4_file_open_file (const FILE *file, const int flag)
+{
+  CCP4File *cfile;
+#if defined _MSC_VER
+  struct _stat st;
+#else
+  struct stat st;
+#endif
+
+  if (!file) {
+    ccp4_signal(CCP4_ERRLEVEL(3) | CCP4_ERRNO(CIO_NullPtr),
+                "ccp4_file_open_file", NULL);
+    return NULL; }
+
+  if (!(cfile = _file_init() ) ) {
+      ccp4_signal(CCP4_ERRLEVEL(3),
+                  "ccp4_file_open_file", NULL);    
+      return NULL; }
+          
+  /* set values in structure */
+  _file_open_mode(cfile,flag);
+  cfile->stream = (FILE *) file;
+  cfile->buffered = 1;
+  cfile->open = 1;   
+
+#if defined _MSC_VER
+  _fstat(_fileno(cfile->stream), &st);
+  if ( !(st.st_mode & S_IFREG) || file == stdin) {
+#else
+  fstat(fileno(cfile->stream), &st);
+  if ( !S_ISREG(st.st_mode) || file == stdin ) {
+#endif
+    cfile->length = INT_MAX;
+    cfile->direct = 0;
+  } else {
+    cfile->length = st.st_size;
+    cfile->direct = 1;
+  }
+  cfile->loc = ftell( (FILE *)file);
+  
+  return cfile;
+}
+
+/**
+ * ccp4_file_open_fd:
+ * @param fd (const int) file descriptor
+ * @param flag (const int) io mode (O_RDONLY =0, O_WRONLY =1, O_RDWR =2,
+ *        O_TMP =, O_APPEND =)
+ *
+ * initialise CCP4File struct with file descriptor @fd and mode @flag 
+ * The struct stat is check to determine if file is a regular file,
+ * if it is, and is not stdin, it is assumed to be direct access. 
+ * @return (CCP4File *) on success, NULL on failure
+ */
+CCP4File *ccp4_file_open_fd (const int fd, const int flag)
+{
+  CCP4File * cfile;
+#if defined _MSC_VER
+  struct _stat st;
+#else
+  struct stat st;
+#endif
+
+  if (!(cfile = _file_init() ) ) {
+      ccp4_signal(CCP4_ERRLEVEL(3),
+                  "ccp4_file_open_fd", NULL);    
+      return NULL; }
+      
+  _file_open_mode(cfile, flag);      
+  cfile->fd = fd;
+  cfile->open = 1;    
+  cfile->buffered = 0;
+
+#if defined _MSC_VER
+  _fstat(fd, &st);
+  if ( !(st.st_mode & S_IFREG) || fd == 0) {
+#else
+  fstat(fd, &st);
+  if ( !S_ISREG(st.st_mode) || fd == 0 ) {
+#endif
+    cfile->length = INT_MAX;
+    cfile->direct = 0;
+    cfile->loc = 0;
+  } else {
+    cfile->length = st.st_size;
+    cfile->direct = 1;
+#if defined _MSC_VER
+    cfile->loc = _lseek(fd, 0L, SEEK_CUR);
+#else
+    cfile->loc = lseek(fd, 0L, SEEK_CUR);
+#endif
+  }
+
+  return cfile;
+}
+
+/**
+ * ccp4_file_open:
+ * @param filename (const char *) filename
+ * @param flag (const int) i/o mode, possible values are O_RDONLY, O_WRONLY, 
+ *      O_RDWR, O_APPEND, O_TMP, O_CREAT, O_TRUNC - see ccp4_sysdep.h
+ *
+ * initialise CCP4File struct for file filename with mode @flag.
+ * If !buffered use open(), otherwise fopen()
+  * The struct stat is check to determine if file is a regular file,
+ * if it is, and is not stdin, it is assumed to be direct access. 
+ *
+ * @return (CCP4File *) on success, NULL on failure
+ */
+CCP4File *ccp4_file_open (const char *filename, const int flag)
+{
+  CCP4File *cfile; 
+  int openflags = O_RDONLY;
+  char fmode[5];
+#if defined _MSC_VER
+  struct _stat st;
+#else
+  struct stat st;
+#endif
+  
+  if (!(cfile = _file_init())) {
+    ccp4_signal(CCP4_ERRLEVEL(3), "ccp4_file_open", NULL);
+    return NULL; }
+  _file_open_mode(cfile, flag);
+
+  if (!cfile->buffered) {
+    if (cfile->read && cfile->write) openflags = (O_RDWR | O_CREAT);
+    else if (cfile->write)  openflags = (O_WRONLY | O_CREAT); 
+    if (cfile->append) openflags |= O_APPEND;
+    if (flag & O_TRUNC) openflags |= O_TRUNC;
+#if defined _MSC_VER
+    if (cfile->scratch) openflags |= O_TEMPORARY;
+#endif
+#if defined(__DECC) && defined(VMS) || defined (_MSC_VER)
+    openflags |= O_BINARY;
+#endif
+#if defined _MSC_VER
+    cfile->fd = _open(filename, openflags);
+#else
+    cfile->fd = open(filename, openflags);
+#endif
+    if (cfile->fd == -1) {
+      ccp4_signal(CCP4_ERRLEVEL(3) | CCP4_ERRNO(CIO_CantOpenFile),
+                  "ccp4_file_open1", NULL);
+      return NULL; 
+    } else {
+#if defined _MSC_VER
+      _fstat(cfile->fd, &st); }
+#else
+      fstat(cfile->fd, &st); }
+#endif
+  } else {
+    char *mptr = fmode;
+    if (cfile->append) {
+      *mptr++ = 'a';
+      if (cfile->read) *mptr++ = '+';
+    } else {
+      if (cfile->read && cfile->write) {
+        if (flag & O_TRUNC) {*mptr++ = 'w'; }
+        else *mptr++ = 'r';
+        *mptr++ = '+';
+      } else if (cfile->write) 
+        *mptr++ = 'w';
+      else 
+        *mptr++ = 'r';
+    }
+#if defined(__DECC) && defined(VMS) || defined (_WIN32)
+    *mptr++ = 'b';
+#endif
+    *mptr++ = '\0';
+#ifdef VMS
+    if (cfile->scratch)
+      cfile->stream = fopen (filename, fmode,
+                             "mbc=16",        /* bigger blocksize */
+                             "fop=tmd");      /* temporary, delete on close */
+    else
+      cfile->stream = fopen (filename, fmode,
+                             "mbc=16",        /* bigger blocksize */
+                             "ctx=stm", "mrs=0", "rat=cr", "rfm=stmlf");
+#else
+# ifdef _MSC_VER
+    if (cfile->scratch) 
+      cfile->stream = tmpfile();
+    else 
+      cfile->stream = fopen (filename, fmode);
+# else
+    cfile->stream = fopen (filename, fmode);
+    if (cfile->stream) 
+      if (cfile->scratch && unlink (filename)!=0) {
+        ccp4_signal(CCP4_ERRLEVEL(3) | CCP4_ERRNO(CIO_UnlinkFail),
+                    "ccp4_file_open(unlink)", NULL);
+        cfile->iostat = CIO_UnlinkFail; return NULL; }
+# endif
+#endif
+    if (!cfile->stream) {
+      ccp4_signal(CCP4_ERRLEVEL(3) | CCP4_ERRNO(CIO_CantOpenFile),
+                  "ccp4_file_open2", NULL);
+      cfile->iostat = CIO_CantOpenFile;
+      return NULL; } 
+#if defined (__alpha) && defined (vms)
+(void) fflush (cfile->stream);
+#endif
+#if defined _MSC_VER
+  _fstat(_fileno(cfile->stream), &st);
+#else
+  fstat(fileno(cfile->stream), &st);
+#endif
+  }
+#if defined _MSC_VER
+  cfile->name = _strdup(filename);
+#else
+  cfile->name = strdup(filename);
+#endif
+  cfile->open = 1;  
+  cfile->own = 1;  
+#if defined _MSC_VER
+  if ( !(st.st_mode & S_IFREG) ) {
+#else
+  if ( !S_ISREG(st.st_mode) ) {
+#endif
+    cfile->length = INT_MAX;
+    cfile->direct = 0;
+  } else {
+    cfile->length = st.st_size;
+    cfile->direct = 1;
+  }
+  cfile->loc = cfile->append ? cfile->length : 0;
+  
+  return cfile;
+}
+
+/**
+ * ccp4_file_close:
+ * @param cfile (CCP4File *) 
+ *
+ * close @cfile if owned, close (non-buffered) or 
+ * fclose (buffered),  or fflush if stream not owned.
+ * Free resources.
+ * @return 0 on success, EOF on failure
+ */
+int ccp4_file_close (CCP4File *cfile)
+{
+
+  if (!cfile) {
+    ccp4_signal(CCP4_ERRLEVEL(3)| CCP4_ERRNO(CIO_NullPtr),
+		"ccp4_file_close", NULL);
+    return EOF; }
+
+  if (_file_close (cfile) == EOF) {
+    ccp4_signal(CCP4_ERRLEVEL(3),"ccp4_file_close", NULL);
+    return EOF; }
+ 
+  _file_free(cfile);
+
+  return (0);
+}
+
+/**
+ * ccp4_file_rarch:
+ * @param cfile (CCP4File *) 
+ *
+ * read machine stamp from file @cfile->stream.
+ * The machine stamp is at @cfile->stamp_loc items, set
+ * by ccp4_file_setstamp() (default 0).
+ * NB. these values may be overrriden with the environmental
+ * variable CONVERT_FROM.
+ * @return fileFT | (fileIT<<8)
+ */
+int ccp4_file_rarch (CCP4File *cfile)
+{
+  unsigned char mtstring[4];    /* machine stamp */
+  char *native = getenv ("NATIVEMTZ");
+  char *foreign = getenv ("CONVERT_FROM");
+
+  if (!cfile) {
+    ccp4_signal(CCP4_ERRLEVEL(3)| CCP4_ERRNO(CIO_NullPtr),
+		"ccp4_file_rarch", NULL);
+    return EOF; }
+
+  if (native != NULL) return (nativeFT | (nativeIT<<8)); 
+  if (foreign == NULL) {
+    if (ccp4_file_raw_seek(cfile, cfile->stamp_loc, SEEK_SET) == -1) { 
+      ccp4_signal(CCP4_ERRLEVEL(3),"ccp4_file_rarch", NULL);
+      return EOF; }
+    
+    if (ccp4_file_raw_read(cfile, (char *) mtstring, 4UL) != 4) { 
+        ccp4_signal(CCP4_ERRLEVEL(3), "ccp4_file_rarch", NULL);
+        return EOF; }
+        
+    cfile->iconvert = (mtstring[1]>>4) & 0x0f;
+    cfile->fconvert = (mtstring[0]>>4) & 0x0f;
+  }
+  
+  return (cfile->fconvert | (cfile->iconvert<<8));
+}
+
+/**
+ * ccp4_file_warch:
+ * @param cfile (CCP4File *) 
+ *
+ * write machine stamp to file @cfile->stream.
+ * The machine stamp is placed at @cfile->stamp_loc items,
+ * set by ccp4_file_setstamp() (defaults to 0).
+ *
+ * @return 0 on success, EOF on failure
+ */
+int ccp4_file_warch (CCP4File *cfile)
+{
+  unsigned char mtstring[4];    /* machine stamp */
+
+  if (!cfile) {
+    ccp4_signal(CCP4_ERRLEVEL(3)| CCP4_ERRNO(CIO_NullPtr),
+		"ccp4_file_warch", NULL);
+    return EOF; }
+
+  if (ccp4_file_raw_seek(cfile, cfile->stamp_loc, SEEK_SET) == -1) { 
+      ccp4_signal(CCP4_ERRLEVEL(3), "ccp4_file_warch", NULL);
+      return EOF; }
+
+  mtstring[0] = cfile->fconvert | (cfile->fconvert << 4);
+  mtstring[1] = 1 | (cfile->iconvert << 4);
+  mtstring[2] = mtstring[3] = 0;
+
+  if (ccp4_file_raw_write(cfile, (const char *) mtstring, 4) != 4) { 
+      ccp4_signal(CCP4_ERRLEVEL(3), "ccp4_file_warch", NULL);
+    return EOF; }
+
+  return 0;
+}
+
+/**
+ * ccp4_file_read:
+ * @param cfile (CCP4File *)
+ * @param buffer (uint8 *) buffer
+ * @param nitems (size_t) number of items 
+ *
+ * mode dependent read function.  Reads @nitems items from stream
+ * @cfile->stream to @buffer as determined by cfile->mode.
+ *
+ * @return number of items read on success, EOF on failure
+ */
+int ccp4_file_read (CCP4File *cfile, uint8 *buffer, size_t nitems)
+{
+  int result;
+ 
+  result = cfile->_read(cfile,(uint8 *) buffer,nitems);
+  
+  if (result != nitems) 
+    ccp4_signal(CCP4_ERRLEVEL(3), 
+	       "ccp4_file_read", NULL);
+  return (result);
+}
+
+/**
+ * ccp4_file_readcomp:
+ * @param cfile (CCP4File *)
+ * @param buffer (uint8 *) buffer
+ * @param nitems (size_t) number of items 
+ *
+ * float complex {float,float} read function.  Reads @nitems complex from stream
+ * @cfile->stream to @buffer.  Allows short count when eof is detected (
+ * buffered input only).
+ *
+ * @return number of complex read on success, EOF on failure
+ */
+int ccp4_file_readcomp (CCP4File *cfile, uint8 *buffer, size_t nitems)
+{
+  int i, n, result;
+
+  if (!cfile)  {
+      ccp4_signal(CCP4_ERRLEVEL(3) | CCP4_ERRNO(CIO_NullPtr), 
+		  "ccp4_file_readcomp", NULL);
+    return EOF; }
+
+  if ( !cfile->read || cfile->iostat) {
+    ccp4_signal(CCP4_ERRLEVEL(3) | CCP4_ERRNO(CIO_BadMode), 
+		"ccp4_file_readcomp", NULL);
+    return EOF; }
+
+  if (cfile->last_op == WRITE_OP)
+    if (ccp4_file_raw_seek(cfile,0L,SEEK_CUR) == -1) {
+      ccp4_signal(CCP4_ERRLEVEL(3), "ccp4_file_readcomp", NULL);
+      return EOF; }   
+
+  n = _item_sizes[COMP64] * nitems;
+  if ( (result = ccp4_file_raw_read (cfile, (char *) buffer, n)) != n) {
+    ccp4_signal(CCP4_ERRLEVEL(3), "ccp4_file_readcomp", NULL);
+    if (cfile->stream && !feof(cfile->stream)) 
+      return EOF;  }  /* short count on stream is OK if EOF */
+
+  result /= _item_sizes[COMP64];
+  n = result;
+  if (cfile->fconvert != nativeFT) {
+    n *= 2;                        /* pairs of reals */
+    switch (cfile->fconvert) {     /* get to BE IEEE */
+    case DFNTF_VAX :
+        vaxF2ieeeF((union float_uint_uchar *) buffer, n);
+        break;   
+    case DFNTF_CONVEXNATIVE :
+        convexF2ieeeF((union float_uint_uchar *) buffer, n);
+        break;
+    case DFNTF_BEIEEE :
+        break;
+    case DFNTF_LEIEEE :
+        {
+            char j;
+            for (i=0; i < n*4; i+=4) {
+                j = buffer[i];
+                buffer[i] = buffer[i+3];
+                buffer[i+3] = j;
+                j = buffer[i+1];
+                buffer[i+1] = buffer[i+2];
+                buffer[i+2] =j; }
+        }
+        break;
+    default :
+      ccp4_signal(CCP4_ERRLEVEL(3) | CCP4_ERRNO(CIO_BadMode), 
+		  "ccp4_file_readcomp", NULL);
+      return EOF; 
+    }
+    switch (nativeFT) {              /* get to Native if not BE IEEE */
+    case DFNTF_BEIEEE :
+        break;                      
+    case DFNTF_LEIEEE :
+        {
+            char j;
+            for (i=0; i < n*4; i+=4) {
+                j = buffer[i];
+                buffer[i] = buffer[i+3];
+                buffer[i+3] = j;
+                j = buffer[i+1];
+                buffer[i+1] = buffer[i+2];
+                buffer[i+2] =j; }
+        }
+        break;
+    case DFNTF_CONVEXNATIVE :
+        ieeeF2convexF((union float_uint_uchar *) buffer, n);
+        break;
+    case DFNTF_VAX :
+        ieeeF2vaxF((union float_uint_uchar *) buffer, n);
+        break;
+    default :
+      ccp4_signal(CCP4_ERRLEVEL(3) | CCP4_ERRNO(CIO_BadMode), 
+		  "ccp4_file_readcomp", NULL);
+      return EOF; 
+    }
+  }
+  return (result);
+}
+
+/**
+ * ccp4_file_readshortcomp:
+ * @param cfile (CCP4File *)
+ * @param buffer (uint8 *) buffer
+ * @param nitems (size_t) number of items 
+ *
+ * short complex {short,short} read function.  Reads @nitems complex from stream
+ * @cfile->stream to @buffer. Allows short count when eof is detected (
+ * buffered input only).
+ *
+ * @return number of complex read on success, EOF on failure
+ */
+int ccp4_file_readshortcomp (CCP4File *cfile, uint8 *buffer, size_t nitems)
+{
+  int i, n, result;
+
+  if (!cfile)  {
+      ccp4_signal(CCP4_ERRLEVEL(3) | CCP4_ERRNO(CIO_NullPtr), 
+		  "ccp4_file_readshortcomp", NULL);
+    return EOF; }
+
+  if ( !cfile->read || cfile->iostat) {
+    ccp4_signal(CCP4_ERRLEVEL(3) | CCP4_ERRNO(CIO_BadMode), 
+		"ccp4_file_readshortcomp", NULL);
+    return EOF; }
+
+  if (cfile->last_op == WRITE_OP)
+    if (ccp4_file_raw_seek(cfile,0L,SEEK_CUR) == -1) {
+      ccp4_signal(CCP4_ERRLEVEL(3), "ccp4_file_readshortcomp", NULL);
+      return EOF; }   
+
+  n = _item_sizes[COMP32] * nitems;
+  if ( (result = ccp4_file_raw_read (cfile, (char *) buffer, n)) != n) {
+      ccp4_signal(CCP4_ERRLEVEL(3), "ccp4_file_readshortcomp", NULL);
+    if (cfile->stream && !feof(cfile->stream))
+      return EOF; } 
+
+  result /= _item_sizes[COMP32];
+
+  n = result;
+  if (cfile->iconvert != nativeIT) {
+    n *= 2;                  /* pairs of ints */
+    {
+      if ((cfile->iconvert==DFNTI_MBO && nativeIT==DFNTI_IBO) ||
+          (cfile->iconvert==DFNTI_IBO && nativeIT==DFNTI_MBO)) {
+        char j;
+        for (i=0; i < n*2; i+=2) {
+          j = buffer[i];
+          buffer[i] = buffer[i+1];
+          buffer[i+1] = j; } }
+      else {
+        ccp4_signal(CCP4_ERRLEVEL(3) | CCP4_ERRNO(CIO_BadMode), 
+                    "ccp4_file_readshortcomp", NULL);
+        return EOF; }
+    }
+  }
+  return (result);
+}
+
+/**
+ * ccp4_file_readfloat:
+ * @param cfile (CCP4File *)
+ * @param buffer (uint8 *) buffer
+ * @param nitems (size_t) number of items 
+ *
+ * float read function.  Reads @nitems floats from stream
+ * @cfile->stream to @buffer.
+ *
+ * @return number of floats read on success, EOF on failure
+ */
+int ccp4_file_readfloat (CCP4File *cfile, uint8 *buffer, size_t nitems)
+{
+  int i, n, result;
+
+  if (!cfile)  {
+      ccp4_signal(CCP4_ERRLEVEL(3) | CCP4_ERRNO(CIO_NullPtr), 
+		  "ccp4_file_readfloat", NULL);
+    return EOF; }
+
+  if (!cfile->read || cfile->iostat) {
+      ccp4_signal(CCP4_ERRLEVEL(3) | CCP4_ERRNO(CIO_BadMode), 
+		  "ccp4_file_readfloat", NULL);
+      return EOF; }
+
+  if (cfile->last_op == WRITE_OP)
+    if (ccp4_file_raw_seek(cfile,0L,SEEK_CUR) == -1) {
+      ccp4_signal(CCP4_ERRLEVEL(3), "ccp4_file_readfloat", NULL);
+      return EOF; }   
+
+  n = _item_sizes[FLOAT32] * nitems;
+  if ( (result = ccp4_file_raw_read (cfile, (char *) buffer, n)) != n) { 
+    ccp4_signal(CCP4_ERRLEVEL(3), "ccp4_file_readfloat", NULL);
+    if (cfile->stream && !feof(cfile->stream)) 
+      return EOF; } 
+
+  result /= _item_sizes[FLOAT32];
+
+  n = result;
+  if (cfile->fconvert != nativeFT) {
+    switch (cfile->fconvert) {     /* get to BE IEEE */
+    case DFNTF_VAX :
+      vaxF2ieeeF((union float_uint_uchar *) buffer, n);
+      break;   
+    case DFNTF_CONVEXNATIVE :
+      convexF2ieeeF((union float_uint_uchar *) buffer, n);
+      break;
+    case DFNTF_BEIEEE :
+      break;
+    case DFNTF_LEIEEE :
+      {
+	char j;
+	for (i=0; i < n*4; i+=4) {
+	  j = buffer[i];
+	  buffer[i] = buffer[i+3];
+	  buffer[i+3] = j;
+	  j = buffer[i+1];
+	  buffer[i+1] = buffer[i+2];
+	  buffer[i+2] =j; }
+      }
+      break;
+    default :
+      ccp4_signal(CCP4_ERRLEVEL(3) | CCP4_ERRNO(CIO_BadMode), 
+		  "ccp4_file_readfloat", NULL);
+      return EOF; 
+    }
+    switch (nativeFT) {
+    case DFNTF_BEIEEE :
+      break;                      /* done enough */
+    case DFNTF_LEIEEE :
+      {
+	char j;
+	for (i=0; i < n*4; i+=4) {
+	  j = buffer[i];
+	  buffer[i] = buffer[i+3];
+	  buffer[i+3] = j;
+	  j = buffer[i+1];
+	  buffer[i+1] = buffer[i+2];
+	  buffer[i+2] =j; }
+      }
+      break;
+    case DFNTF_CONVEXNATIVE :
+      ieeeF2convexF((union float_uint_uchar *) buffer, n);
+      break;
+    case DFNTF_VAX :
+      ieeeF2vaxF((union float_uint_uchar *) buffer, n);
+      break;
+    default :
+      ccp4_signal(CCP4_ERRLEVEL(3) | CCP4_ERRNO(CIO_BadMode), 
+		  "ccp4_file_readfloat", NULL);
+      return EOF; 
+    }
+  }
+  return (result);
+}
+
+/**
+ * ccp4_file_readint:
+ * @param cfile (CCP4File *)
+ * @param buffer (uint8 *) buffer
+ * @param nitems (size_t) number of items 
+ *
+ * integer read function.  Reads @nitems int from stream
+ * @cfile->stream to @buffer.
+ *
+ * @return number of int read on success, EOF on failure
+ */
+int ccp4_file_readint (CCP4File *cfile, uint8 *buffer, size_t nitems)
+{
+  int n, result;
+
+  if (!cfile)  {
+      ccp4_signal(CCP4_ERRLEVEL(3) | CCP4_ERRNO(CIO_NullPtr), 
+		  "ccp4_file_readint", NULL);
+    return EOF; }
+
+  if ( !cfile->read || cfile->iostat) {
+    ccp4_signal(CCP4_ERRLEVEL(3) | CCP4_ERRNO(CIO_BadMode), 
+		"ccp4_file_readint", NULL);
+    return EOF; }
+
+  if (cfile->last_op == WRITE_OP)
+    if (ccp4_file_raw_seek(cfile,0L,SEEK_CUR) == -1) {
+      ccp4_signal(CCP4_ERRLEVEL(3), "ccp4_file_readint", NULL);
+      return EOF; }   
+
+  n = _item_sizes[INT32] * nitems;
+  if ( (result = ccp4_file_raw_read (cfile, (char *) buffer, n)) != n) {
+    ccp4_signal(CCP4_ERRLEVEL(3), "ccp4_file_readint", NULL);
+    if (cfile->stream && !feof(cfile->stream)) 
+      return EOF; } 
+
+  result /= _item_sizes[INT32];
+
+  n = result;
+
+  if (cfile->iconvert != nativeIT) {
+    if ((cfile->iconvert==DFNTI_MBO && nativeIT==DFNTI_IBO) ||
+	(cfile->iconvert==DFNTI_IBO && nativeIT==DFNTI_MBO)) {
+      char j;
+      int i;
+      for (i=0; i < n*4; i+=4) {
+	j = buffer[i];
+	buffer[i] = buffer[i+3];
+	buffer[i+3] = j;
+	j = buffer[i+1];
+	buffer[i+1] = buffer[i+2];
+	buffer[i+2] =j; }
+    } else { 
+      ccp4_signal(CCP4_ERRLEVEL(3) | CCP4_ERRNO(CIO_BadMode), 
+		"ccp4_file_readint", NULL);
+      return EOF; }
+  }
+  return (result);
+}
+
+/**
+ * ccp4_file_readshort:
+ * @param cfile (CCP4File *)
+ * @param buffer (uint8 *) buffer
+ * @param nitems (size_t) number of items 
+ *
+ * short read function.  Reads @nitems shorts from stream
+ * @cfile->stream to @buffer.
+ *
+ * @return number of shorts read on success, EOF on failure
+ */
+int ccp4_file_readshort (CCP4File *cfile, uint8 *buffer, size_t nitems)
+{
+  int n, result;
+
+  if (!cfile)  {
+    ccp4_signal(CCP4_ERRLEVEL(3) | CCP4_ERRNO(CIO_NullPtr), 
+		"ccp4_file_readshort", NULL);
+    return EOF; }
+
+  if (!cfile->read || cfile->iostat) {
+    ccp4_signal(CCP4_ERRLEVEL(3) | CCP4_ERRNO(CIO_BadMode), 
+		"ccp4_file_readshort", NULL);
+    return EOF; }
+
+  if (cfile->last_op == WRITE_OP)
+    if (ccp4_file_raw_seek(cfile,0L,SEEK_CUR) == -1) {
+      ccp4_signal(CCP4_ERRLEVEL(3), "ccp4_file_readshort", NULL);
+      return EOF; }   
+
+  n = _item_sizes[INT16] * nitems;
+  if ( (result = ccp4_file_raw_read (cfile, (char *) buffer, n)) != n) {
+    ccp4_signal(CCP4_ERRLEVEL(3), "ccp4_file_readshort", NULL);
+    if (cfile->stream && !feof(cfile->stream)) 
+      return EOF; } 
+
+  result /= _item_sizes[INT16];
+
+  n = result;
+  if (cfile->iconvert != nativeIT) {
+    if ((cfile->iconvert==DFNTI_MBO && nativeIT==DFNTI_IBO) ||
+	(cfile->iconvert==DFNTI_IBO && nativeIT==DFNTI_MBO)) {
+      char j;
+      int i;
+      for (i=0; i < n*2; i+=2) {
+	j = buffer[i];
+	buffer[i] = buffer[i+1];
+	buffer[i+1] = j; } 
+    } else {
+      ccp4_signal(CCP4_ERRLEVEL(3) | CCP4_ERRNO(CIO_BadMode), 
+		  "ccp4_file_readshort", NULL);
+      return EOF; }
+  }
+  return (result);
+}
+
+/**
+ * ccp4_file_readchar:
+ * @param cfile (CCP4File *)
+ * @param buffer (uint8 *) buffer
+ * @param nitems (size_t) number of items 
+ *
+ * character read function.  Reads @nitems characters from stream
+ * @cfile->stream to @buffer.
+ *
+ * @return number of characters read on success, EOF on failure
+ */
+int ccp4_file_readchar (CCP4File *cfile, uint8 *buffer, size_t nitems)
+{
+  size_t result;
+
+  if (! cfile) {
+      ccp4_signal(CCP4_ERRLEVEL(3) | CCP4_ERRNO(CIO_NullPtr), 
+		  "ccp4_file_readchar", NULL);
+      return EOF; }
+
+  if (!cfile->read || cfile->iostat) {
+    ccp4_signal(CCP4_ERRLEVEL(3) | CCP4_ERRNO(CIO_BadMode), 
+		"ccp4_file_readchar", NULL);
+    return EOF; }
+
+  if (cfile->last_op == WRITE_OP)
+    if (ccp4_file_raw_seek(cfile,0L,SEEK_CUR) == -1) {
+      ccp4_signal(CCP4_ERRLEVEL(3), "ccp4_file_readchar", NULL);
+      return EOF; }   
+
+  if ( (result = ccp4_file_raw_read (cfile, (char *) buffer, nitems)) != nitems) {
+    ccp4_signal(CCP4_ERRLEVEL(3), "ccp4_file_readchar", NULL);
+    if (cfile->stream && !feof(cfile->stream))
+      return EOF; } 
+
+  return (result);
+}
+
+/**
+ * ccp4_file_write:
+ * @param cfile (CCP4File *)
+ * @param buffer (uint8 *) buffer
+ * @param nitems (size_t) number of items 
+ *
+ * mode dependent write function.  Write @nitems items from @buffer
+ * to @cfile->stream as determined by cfile->mode.
+ *
+ * @return number of items written on success, EOF on failure
+ */
+int ccp4_file_write (CCP4File *cfile, const uint8 *buffer, size_t nitems)
+{
+  size_t result;
+
+  result = cfile->_write(cfile, buffer, nitems);
+
+  if ( result != nitems) 
+    ccp4_signal(CCP4_ERRLEVEL(3), "ccp4_file_write", NULL);
+  
+  return (result);
+}
+
+/**
+ * ccp4_file_writecomp:
+ * @param cfile (CCP4File *)
+ * @param buffer (uint8 *) buffer
+ * @param nitems (size_t) number of items 
+ *
+ * complex {float,float} write function.  Write @nitems items from @buffer
+ * to @cfile->stream.
+ *
+ * @return number of complex items written on success, EOF on failure
+ */
+int ccp4_file_writecomp (CCP4File *cfile, const uint8 *buffer, size_t nitems)
+{
+  size_t result = 0, n;
+
+  if (!cfile) {
+    ccp4_signal(CCP4_ERRLEVEL(3) | CCP4_ERRNO(CIO_NullPtr), 
+		"ccp4_file_writecomp", NULL);
+    return EOF; }
+
+  if (!cfile->write ||cfile->iostat) {
+    ccp4_signal(CCP4_ERRLEVEL(3) | CCP4_ERRNO(CIO_BadMode), 
+		"ccp4_file_writecomp", NULL);
+    return EOF;}
+
+  if (cfile->last_op == READ_OP) 
+    if (ccp4_file_raw_seek(cfile,0L,SEEK_CUR) == -1) {
+      ccp4_signal(CCP4_ERRLEVEL(3), "ccp4_file_writecomp", NULL);
+      return EOF; }   
+      
+  n = nitems * _item_sizes[COMP64];
+  
+  if (cfile->fconvert != nativeFT) {
+    char out_buffer[8];
+    const char *out_ptr = (char *) buffer;
+    size_t i;
+    for (i = 0; i != nitems; i++) {
+      switch (nativeFT) {
+      case DFNTF_BEIEEE :
+        memcpy(out_buffer, out_ptr, _item_sizes[COMP64]);
+        out_ptr += _item_sizes[COMP64];
+        break;                      
+      case DFNTF_LEIEEE : 
+        out_buffer[3] = *out_ptr++;
+        out_buffer[2] = *out_ptr++;
+        out_buffer[1] = *out_ptr++;
+        out_buffer[0] = *out_ptr++;
+        out_buffer[7] = *out_ptr++;
+        out_buffer[6] = *out_ptr++;
+        out_buffer[5] = *out_ptr++;
+        out_buffer[4] = *out_ptr++;
+        break;
+    case DFNTF_CONVEXNATIVE :
+        memcpy(out_buffer, out_ptr, _item_sizes[COMP64]);
+        out_ptr += _item_sizes[COMP64];
+        ieeeF2convexF((union float_uint_uchar *) out_buffer, 2);
+        break;
+    case DFNTF_VAX :
+        memcpy(out_buffer, out_ptr, _item_sizes[COMP64]);
+        out_ptr += _item_sizes[COMP64];
+        ieeeF2vaxF((union float_uint_uchar *) out_buffer, 2);
+        break;
+    default :
+      ccp4_signal(CCP4_ERRLEVEL(3) | CCP4_ERRNO(CIO_BadMode), 
+		  "CCP4_File::writecomp", NULL);
+    }
+    switch (cfile->fconvert) {    
+    case DFNTF_VAX :
+        vaxF2ieeeF((union float_uint_uchar *) out_buffer, 2);
+        break;   
+    case DFNTF_CONVEXNATIVE :
+        convexF2ieeeF((union float_uint_uchar *) out_buffer, 2);
+        break;
+    case DFNTF_BEIEEE :
+        break;
+    case DFNTF_LEIEEE :
+        {
+          char j;
+          j = out_buffer[0];
+          out_buffer[0] = out_buffer[3];
+          out_buffer[3] = j;
+          j = out_buffer[1];
+          out_buffer[1] = out_buffer[2];
+          out_buffer[2] =j; 
+          j = out_buffer[4];
+          out_buffer[4] = out_buffer[7];
+          out_buffer[7] = j;
+          j = out_buffer[5];
+          out_buffer[5] = out_buffer[6];
+          out_buffer[6] =j; 
+        }
+        break;
+    default :
+      ccp4_signal(CCP4_ERRLEVEL(3) | CCP4_ERRNO(CIO_BadMode), 
+		  "ccp4_file_writecomp", NULL);
+      return EOF; 
+    }
+    result += ccp4_file_raw_write (cfile, out_buffer, _item_sizes[COMP64]);
+    }
+  } else {
+    result = ccp4_file_raw_write (cfile, (char *) buffer, n);
+  }
+
+  if (result != n)
+    ccp4_signal(CCP4_ERRLEVEL(3), "ccp4_file_writecomp", NULL);
+    
+  return (result / _item_sizes[COMP64]);
+}
+
+/**
+ * ccp4_file_writeshortcomp:
+ * @param cfile (CCP4File *)
+ * @param buffer (uint8 *) buffer
+ * @param nitems (size_t) number of items 
+ *
+ * short complex {short,short} write function.  Write @nitems items from @buffer
+ * to @cfile->stream.
+ *
+ * @return number of complex items written on success, EOF on failure
+ */
+int ccp4_file_writeshortcomp (CCP4File *cfile, const uint8 *buffer, size_t nitems)
+{
+  size_t result = 0, n;
+
+  if (!cfile) {
+    ccp4_signal(CCP4_ERRLEVEL(3) | CCP4_ERRNO(CIO_NullPtr), 
+		"ccp4_file_writeshortcomp", NULL);
+    return EOF; }
+
+  if (!cfile->write ||cfile->iostat) {
+    ccp4_signal(CCP4_ERRLEVEL(3) | CCP4_ERRNO(CIO_BadMode), 
+		"ccp4_file_writeshortcomp", NULL);
+    return EOF;}
+
+  if (cfile->last_op == READ_OP) 
+    if (ccp4_file_raw_seek(cfile,0L,SEEK_CUR) == -1) {
+      ccp4_signal(CCP4_ERRLEVEL(3), "ccp4_file_writeshortcomp", NULL);
+      return EOF; }   
+      
+  n = nitems * _item_sizes[COMP32];
+
+  if (cfile->iconvert != nativeIT) {
+    char out_buffer[4];
+    const char *out_ptr = (char *) buffer;
+    size_t i;
+    for (i = 0; i != nitems; i++) {
+      if ((cfile->iconvert==DFNTI_MBO && nativeIT==DFNTI_IBO) ||
+	  (cfile->iconvert==DFNTI_IBO && nativeIT==DFNTI_MBO)) {
+        out_buffer[1] = *out_ptr++;
+        out_buffer[0] = *out_ptr++;
+        out_buffer[3] = *out_ptr++;
+        out_buffer[2] = *out_ptr++; 
+      } else { 
+        ccp4_signal(CCP4_ERRLEVEL(3) | CCP4_ERRNO(CIO_BadMode), 
+		"ccp4_file_writeshortcomp", NULL);
+        return EOF; }
+    result += ccp4_file_raw_write (cfile, out_buffer, _item_sizes[COMP32]);
+    }
+   } else {
+    result = ccp4_file_raw_write (cfile, (char *) buffer, n);
+  }
+  
+  if ( result != n) 
+    ccp4_signal(CCP4_ERRLEVEL(3), "ccp4_file_writeshortcomp", NULL);
+
+  return (result / _item_sizes[COMP32]);
+}
+
+/**
+ * ccp4_file_writefloat:
+ * @param cfile (CCP4File *)
+ * @param buffer (uint8 *) buffer
+ * @param nitems (size_t) number of items 
+ *
+ * float write function.  Write @nitems items from @buffer
+ * to @cfile->stream.
+ *
+ * Returns number of floats written on success, EOF on failure
+ */
+int ccp4_file_writefloat (CCP4File *cfile, const uint8 *buffer, size_t nitems)
+{
+  size_t result = 0, n;
+
+  if (!cfile) {
+    ccp4_signal(CCP4_ERRLEVEL(3) | CCP4_ERRNO(CIO_NullPtr), 
+		"ccp4_file_writefloat", NULL);
+    return EOF; }
+
+  if (!cfile->write ||cfile->iostat) {
+    ccp4_signal(CCP4_ERRLEVEL(3) | CCP4_ERRNO(CIO_BadMode), 
+		"ccp4_file_writefloat", NULL);
+    return EOF;}
+
+  if (cfile->last_op == READ_OP) 
+    if (ccp4_file_raw_seek(cfile,0L,SEEK_CUR) == -1) {
+      ccp4_signal(CCP4_ERRLEVEL(3), "ccp4_file_writefloat", NULL);
+      return EOF; }   
+      
+  n = nitems * _item_sizes[FLOAT32];
+
+  if (cfile->fconvert != nativeFT) {
+    char out_buffer[4];
+    const char *out_ptr = (char *) buffer;
+    size_t i;
+    for (i = 0; i != nitems; i++) {
+      switch (nativeFT) {
+      case DFNTF_BEIEEE :
+        memcpy(out_buffer, out_ptr, _item_sizes[FLOAT32]);
+        out_ptr += _item_sizes[FLOAT32];
+        break;                      
+      case DFNTF_LEIEEE : 
+        out_buffer[3] = *out_ptr++;
+        out_buffer[2] = *out_ptr++;
+        out_buffer[1] = *out_ptr++;
+        out_buffer[0] = *out_ptr++;
+        break;
+    case DFNTF_CONVEXNATIVE :
+        memcpy(out_buffer, out_ptr, _item_sizes[FLOAT32]);
+        out_ptr += _item_sizes[FLOAT32];
+        ieeeF2convexF((union float_uint_uchar *) out_buffer, 1);
+        break;
+    case DFNTF_VAX :
+        memcpy(out_buffer, out_ptr, _item_sizes[FLOAT32]);
+        out_ptr += _item_sizes[FLOAT32];
+        ieeeF2vaxF((union float_uint_uchar *) out_buffer, 1);
+        break;
+    default :
+      ccp4_signal(CCP4_ERRLEVEL(3) | CCP4_ERRNO(CIO_BadMode), 
+		  "CCP4_File::writefloat", NULL);
+    }
+    switch (cfile->fconvert) {    
+    case DFNTF_VAX :
+        vaxF2ieeeF((union float_uint_uchar *) out_buffer, 1);
+        break;   
+    case DFNTF_CONVEXNATIVE :
+        convexF2ieeeF((union float_uint_uchar *) out_buffer, 1);
+        break;
+    case DFNTF_BEIEEE :
+        break;
+    case DFNTF_LEIEEE :
+        {
+          char j;
+          j = out_buffer[0];
+          out_buffer[0] = out_buffer[3];
+          out_buffer[3] = j;
+          j = out_buffer[1];
+          out_buffer[1] = out_buffer[2];
+          out_buffer[2] =j; 
+        }
+        break;
+    default :
+      ccp4_signal(CCP4_ERRLEVEL(3) | CCP4_ERRNO(CIO_BadMode), 
+		  "ccp4_file_writefloat", NULL);
+      return EOF; 
+    }
+    result += ccp4_file_raw_write (cfile, out_buffer, _item_sizes[FLOAT32]);
+    }
+  } else {
+    result = ccp4_file_raw_write (cfile, (char *) buffer, n);
+  }
+
+  if (result != n)
+    ccp4_signal(CCP4_ERRLEVEL(3), "ccp4_file_writefloat", NULL);
+    
+  return (result / _item_sizes[FLOAT32]);
+}
+  
+/**
+ * ccp4_file_writeint:
+ * @param cfile (CCP4File *)
+ * @param buffer (uint8 *) buffer
+ * @param nitems (size_t) number of items 
+ *
+ * int write function.  Write @nitems items from @buffer
+ * to @cfile->stream.
+ *
+ * @return number of int written on success, EOF on failure
+ */
+int ccp4_file_writeint (CCP4File *cfile, const uint8 *buffer, size_t nitems)
+{
+  size_t result = 0, n;
+
+  if (!cfile) {
+    ccp4_signal(CCP4_ERRLEVEL(3) | CCP4_ERRNO(CIO_NullPtr), 
+		"ccp4_file_writeint", NULL);
+    return EOF; }
+
+  if (!cfile->write ||cfile->iostat) {
+    ccp4_signal(CCP4_ERRLEVEL(3) | CCP4_ERRNO(CIO_BadMode), 
+		"ccp4_file_writeint", NULL);
+    return EOF;}
+
+  if (cfile->last_op == READ_OP) 
+    if (ccp4_file_raw_seek(cfile,0L,SEEK_CUR) == -1) {
+      ccp4_signal(CCP4_ERRLEVEL(3), "ccp4_file_writeint", NULL);
+      return EOF; }   
+      
+  n = nitems * _item_sizes[INT32];
+
+  if (cfile->iconvert != nativeIT) {
+    char out_buffer[4];
+    const char *out_ptr = (char *) buffer;
+    size_t i;
+    for (i = 0; i != nitems; i++) {
+      if ((cfile->iconvert==DFNTI_MBO && nativeIT==DFNTI_IBO) ||
+	  (cfile->iconvert==DFNTI_IBO && nativeIT==DFNTI_MBO)) {
+        out_buffer[3] = *out_ptr++;
+        out_buffer[2] = *out_ptr++;
+        out_buffer[1] = *out_ptr++;
+        out_buffer[0] = *out_ptr++; 
+      } else { 
+        ccp4_signal(CCP4_ERRLEVEL(3) | CCP4_ERRNO(CIO_BadMode), 
+		"ccp4_file_writeint", NULL);
+        return EOF; }
+    result += ccp4_file_raw_write (cfile, out_buffer, _item_sizes[INT32]);
+    }
+   } else {
+    result = ccp4_file_raw_write (cfile, (char *) buffer, n);
+  }
+
+  if ( result != n) 
+    ccp4_signal(CCP4_ERRLEVEL(3), "ccp4_file_writeint", NULL);
+
+  return (result / _item_sizes[INT32]);
+}
+
+/**
+ * ccp4_file_writeshort:
+ * @param cfile (CCP4File *)
+ * @param buffer (uint8 *) buffer
+ * @param nitems (size_t) number of items 
+ *
+ * short write function.  Write @nitems items from @buffer
+ * to @cfile->stream.
+ *
+ * @return number of short written on success, EOF on failure
+ */
+int ccp4_file_writeshort (CCP4File *cfile, const uint8 *buffer, size_t nitems)
+{
+  size_t result = 0, n;
+
+  if (!cfile) {
+    ccp4_signal(CCP4_ERRLEVEL(3) | CCP4_ERRNO(CIO_NullPtr), 
+		"ccp4_file_writeshort", NULL);
+    return EOF; }
+
+  if (!cfile->write ||cfile->iostat) {
+    ccp4_signal(CCP4_ERRLEVEL(3) | CCP4_ERRNO(CIO_BadMode), 
+		"ccp4_file_writeshort", NULL);
+    return EOF;}
+
+  if (cfile->last_op == READ_OP) 
+    if (ccp4_file_raw_seek(cfile,0L,SEEK_CUR) == -1) {
+      ccp4_signal(CCP4_ERRLEVEL(3), "ccp4_file_writeshort", NULL);
+      return EOF; }   
+      
+  n = nitems * _item_sizes[INT16];
+  
+  if (cfile->iconvert != nativeIT) {
+    char out_buffer[2];
+    const char *out_ptr = (char *) buffer;
+    size_t i;
+    for (i = 0; i != nitems; i++) {
+      if ((cfile->iconvert==DFNTI_MBO && nativeIT==DFNTI_IBO) ||
+	  (cfile->iconvert==DFNTI_IBO && nativeIT==DFNTI_MBO)) {
+        out_buffer[1] = *out_ptr++;
+        out_buffer[0] = *out_ptr++;
+      } else { 
+        ccp4_signal(CCP4_ERRLEVEL(3) | CCP4_ERRNO(CIO_BadMode), 
+		"ccp4_file_readint", NULL);
+        return EOF; }
+    result += ccp4_file_raw_write (cfile, out_buffer, _item_sizes[INT16]);
+    }
+   } else {
+    result = ccp4_file_raw_write (cfile, (char *) buffer, n);
+  }
+  
+  if ( result != n) 
+    ccp4_signal(CCP4_ERRLEVEL(3), "ccp4_file_writeshort", NULL);
+
+  return (result / _item_sizes[INT16]);
+}
+
+/**
+ * ccp4_file_writechar:
+ * @param cfile (CCP4File *)
+ * @param buffer (uint8 *) buffer
+ * @param nitems (size_t) number of items 
+ *
+ * char write function.  Write @nitems items from @buffer
+ * to @cfile->stream.
+ *
+ * @return number of bytes written on success, EOF on failure
+ */
+int ccp4_file_writechar (CCP4File *cfile, const uint8 *buffer, size_t nitems)
+{
+  size_t result;
+
+  if (!cfile) {
+    ccp4_signal(CCP4_ERRLEVEL(3) | CCP4_ERRNO(CIO_NullPtr), 
+		"ccp4_file_writechar", NULL);
+    return EOF; }
+
+  if (!cfile->write ||cfile->iostat) {
+    ccp4_signal(CCP4_ERRLEVEL(3) | CCP4_ERRNO(CIO_BadMode), 
+		"ccp4_file_writechar", NULL);
+    return EOF;}
+
+  if (cfile->last_op == READ_OP) 
+    if (ccp4_file_raw_seek(cfile,0L,SEEK_CUR) == -1) {
+      ccp4_signal(CCP4_ERRLEVEL(3), "ccp4_file_writechar", NULL);
+      return EOF; }   
+  
+  if ( (result = ccp4_file_raw_write (cfile, (char *) buffer, nitems)) != nitems) 
+    ccp4_signal(CCP4_ERRLEVEL(3), "ccp4_file_writechar", NULL);
+
+  return (result);
+}
+
+/**
+ * ccp4_file_seek:
+ * @param cfile (CCP4File *)
+ * @param offset (long) offset in items
+ * @param whence (int) SEEK_SET, SEEK_CUR, or SEEK_END
+ *
+ * seeks on file by offset items.  SEEK_SET is relative
+ * to start of file, SEEK_CUR to current, SEEK_END to
+ * end.
+ *
+ * @return 0 on success, -1 on failure
+ */
+int ccp4_file_seek (CCP4File *cfile, long offset, int whence)
+{
+  int result;
+
+  if (!cfile) {
+    ccp4_signal(CCP4_ERRLEVEL(3) | CCP4_ERRNO(CIO_NullPtr), 
+		"ccp4_file_seek", NULL);
+    return -1; }
+        
+  result = ccp4_file_raw_seek(cfile, offset*cfile->itemsize, whence);
+
+  if (result != -1) ccp4_file_clearerr(cfile);
+
+  return ((result == -1) ? -1 : 0);
+}
+
+/**
+ * ccp4_file_rewind:
+ * @param cfile (CCP4File *)
+ *
+ * Seek to start of file.  Clear error status.
+ *
+ * @return 0 on success, EOF on failure
+ */
+void ccp4_file_rewind (CCP4File *cfile)
+{
+  if (!cfile) {   
+    ccp4_signal(CCP4_ERRLEVEL(3) | CCP4_ERRNO(CIO_NullPtr), 
+		"ccp4_file_rewind", NULL);
+    return ; }
+   
+  if (ccp4_file_raw_seek(cfile, 0, SEEK_SET)) {
+      ccp4_signal(CCP4_ERRLEVEL(3), 
+	  	  "ccp4_file_rewind", NULL);
+  } else {
+    ccp4_file_clearerr(cfile);
+  }
+}
+
+/**
+ * ccp4_file_length:
+ * @param cfile (CCP4File *)
+ * 
+ * Length of file on disk.
+ * @return length of @cfile on success, EOF on failure
+ */
+long ccp4_file_length (CCP4File *cfile)
+{
+#if defined _MSC_VER
+  struct _stat st;
+#else
+  struct stat st;
+#endif
+
+  if (!cfile) {
+    ccp4_signal(CCP4_ERRLEVEL(3) | CCP4_ERRNO(CIO_NullPtr), 
+		"ccp4_file_length", NULL);
+    return EOF; } 
+        
+  cfile->last_op = IRRELEVANT_OP;
+  
+  if (cfile->buffered && cfile->stream)
+      fflush (cfile->stream);
+#if defined _MSC_VER
+    _fstat(cfile->stream ? _fileno(cfile->stream) : cfile->fd, &st);
+#else
+    fstat(cfile->stream ? fileno(cfile->stream) : cfile->fd, &st);
+#endif
+    cfile->length = st.st_size;
+
+  return (st.st_size);
+}
+
+/**
+ * ccp4_file_tell:
+ * @param cfile (CCP4File *)
+ *
+ * Current location in file, uses either ftell or lseek.
+ * @return current offset of @cfile in bytes.
+ */
+long ccp4_file_tell (CCP4File *cfile)
+{
+  long result;
+  
+  if (! cfile) {
+    ccp4_signal(CCP4_ERRLEVEL(3) | CCP4_ERRNO(CIO_NullPtr), 
+		"ccp4_file_tell", NULL);
+    return EOF; } 
+
+  cfile->last_op = IRRELEVANT_OP;
+
+  if (cfile->buffered && cfile->stream) {
+#if !defined (_MSC_VER)
+    fflush (cfile->stream);
+#endif	
+    result = (long) ftell(cfile->stream);
+  } else
+#if defined _MSC_VER
+    result = _lseek(cfile->fd, 0L, SEEK_CUR);
+#else
+    result = lseek(cfile->fd, 0L, SEEK_CUR);
+#endif
+  
+  cfile->loc = result;
+    
+  return (result);
+}
+
+/**
+ * ccp4_file_feof:
+ * @param cfile (CCP4File *)
+ *
+ * @return true if @cfile is at EoF.
+ *
+ */
+int ccp4_file_feof(CCP4File *cfile)
+{
+  if (!cfile) {
+    ccp4_signal(CCP4_ERRLEVEL(3) | CCP4_ERRNO(CIO_NullPtr), 
+		"ccp4_file_feof", NULL);
+    return EOF; } 
+
+  return (cfile->stream) ? feof(cfile->stream) : cfile->loc >= cfile->length;
+}
+
+/**
+ * ccp4_file_clearerr:
+ * @param cfile (CCP4File *)
+ *
+ * Clears error status of @cfile.
+ *
+ */
+void ccp4_file_clearerr(CCP4File *cfile)
+{
+  if (!cfile || !cfile->stream)
+    return;
+  cfile->iostat = CIO_Ok;
+  clearerr(cfile->stream);
+}
+
+/**
+ * ccp4_file_fatal:
+ * @param cfile (CCP4File *)
+ *
+ * Die with error message based on @cfile error status.
+ */
+void ccp4_file_fatal (CCP4File *cfile, char *message)
+{
+  char *buff;
+  size_t l;
+
+  if (!cfile)
+    ccp4_signal(CCP4_ERRLEVEL(4) | CCP4_ERRNO(CIO_NullPtr), "ccp4_file_fatal",
+                NULL);
+    
+  l = strlen (message) + strlen (cfile->name) + 1;
+  if ( !(buff = malloc(l)))
+      ccp4_signal(CCP4_ERRLEVEL(4), "ccp4_file_fatal", NULL);
+  buff[0] = '\0';
+  strcat (buff, message);
+  strcat (buff, cfile->name);
+  ccp4_fatal(buff);
+}
+
+/**
+ * ccp4_file_error:
+ * @param cfile (CCP4File *)
+ *
+ * print error mesage.
+ * @return associated error code
+ */
+int ccp4_file_error(CCP4File *cfile)
+{  
+  if (!cfile->iostat)
+    return 0;
+  fprintf(stderr,"%s %s \n",
+            cfile->name,ccp4_strerror(cfile->iostat));
+  return CCP4_ERRGETCODE(cfile->iostat); 
+}
+
+/**
+ * ccp4_file_flush:
+ * @param cfile (CCP4File *)
+ *
+ * flush buffer contents of @cfile
+ */
+void ccp4_file_flush(CCP4File *cfile)
+{
+   if (cfile && cfile->stream && cfile->buffered)
+     fflush(cfile->stream);
+}
+
+/**
+ * ccp4_file_print:
+ * @param cfile (CCP4File *)
+ *
+ * @return @cfile information in char array for printing.
+ */
+char *ccp4_file_print(CCP4File *cfile, char *msg_start, char *msg_end)
+{
+  char *msg_curr = msg_start;
+  
+  if (!cfile)
+    return msg_start;
+    
+  if (cfile->name)
+    if ((msg_end - msg_curr) > strlen(cfile->name)) {
+      strcpy(msg_curr,cfile->name);
+      msg_curr = strrchr(msg_curr,'\0'); }
+
+  if (cfile->open)
+    if ((msg_end - msg_curr) > 6 ) {
+      strcat(msg_start, " opened");
+      msg_curr = strrchr(msg_curr,'\0'); }
+  else
+    if ((msg_end - msg_curr) > 7 ) {
+      strcat(msg_start, " closed");
+      msg_curr = strrchr(msg_curr,'\0'); }
+
+  if (cfile->append) {
+    if ((msg_end - msg_curr) > 13 ) {
+      strcat(msg_start, ", append mode");
+      msg_curr = strrchr(msg_curr,'\0'); }
+  } else if (cfile->read && cfile->write) {
+    if ((msg_end - msg_curr) > 17 ) {
+      strcat(msg_start, ", read-write mode");
+      msg_curr = strrchr(msg_curr,'\0'); }
+  } else if (cfile->write) {
+    if ((msg_end - msg_curr) > 12 ) {
+      strcat(msg_start, ", write mode");
+      msg_curr = strrchr(msg_curr,'\0'); }
+  } else {
+    if ((msg_end - msg_curr) > 11 ) {
+      strcat(msg_start, ", read mode");
+      msg_curr = strrchr(msg_curr,'\0'); }
+  }
+
+  return msg_curr;
+}
+
+
diff -ruN ccp4-5.99.5-orig/lib/cctbx/cctbx_sources/ccp4io/lib/src/library_file.h ccp4-5.99.5/lib/cctbx/cctbx_sources/ccp4io/lib/src/library_file.h
--- ccp4-5.99.5-orig/lib/cctbx/cctbx_sources/ccp4io/lib/src/library_file.h	1969-12-31 16:00:00.000000000 -0800
+++ ccp4-5.99.5/lib/cctbx/cctbx_sources/ccp4io/lib/src/library_file.h	2005-11-30 17:40:04.000000000 -0800
@@ -0,0 +1,188 @@
+/*
+     library_file.h: header file for library_file.c
+     Copyright (C) 2001  CCLRC, Charles Ballard
+
+     This library is free software and is distributed under the terms and
+     conditions of the CCP4 licence agreement as `Part 0' (Annex 2)
+     software, which is version 2.1 of the GNU Lesser General Public
+     Licence (LGPL) with the following additional clause:
+
+        `You may also combine or link a "work that uses the Library" to
+        produce a work containing portions of the Library, and distribute
+        that work under terms of your choice, provided that you give
+        prominent notice with each copy of the work that the specified
+        version of the Library is used in it, and that you include or
+        provide public access to the complete corresponding
+        machine-readable source code for the Library including whatever
+        changes were used in the work. (i.e. If you make changes to the
+        Library you must distribute those, but you do not need to
+        distribute source or object code to those portions of the work
+        not covered by this licence.)'
+
+     Note that this clause grants an additional right and does not impose
+     any additional restriction, and so does not affect compatibility
+     with the GNU General Public Licence (GPL). If you wish to negotiate
+     other terms, please contact the maintainer.
+
+     You can redistribute it and/or modify the library under the terms of
+     the GNU Lesser General Public License as published by the Free Software
+     Foundation; either version 2.1 of the License, or (at your option) any
+     later version.
+
+     This library is distributed in the hope that it will be useful, but
+     WITHOUT ANY WARRANTY; without even the implied warranty of
+     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+     Lesser General Public License for more details.
+
+     You should have received a copy of the CCP4 licence and/or GNU
+     Lesser General Public License along with this library; if not, write
+     to the CCP4 Secretary, Daresbury Laboratory, Warrington WA4 4AD, UK.
+     The GNU Lesser General Public can also be obtained by writing to the
+     Free Software Foundation, Inc., 59 Temple Place, Suite 330, Boston,
+     MA 02111-1307 USA
+*/
+
+/** @file library_file.h
+ *  Functions for file i/o.
+ *  Charles Ballard
+ */
+
+#ifndef __CCP4_LIB_FILE
+#define __CCP4_LIB_FILE
+
+#include "ccp4_sysdep.h"
+#include "ccp4_types.h"
+
+#ifdef __cplusplus
+namespace CCP4 {
+extern "C" {
+#endif
+
+/** Generic CCP4 file. */
+typedef struct _CFileStruct CCP4File;
+
+struct _CFileStruct {
+  char *name;
+  FILE *stream;
+  int fd;
+  unsigned int read : 1;
+  unsigned int write : 1;
+  unsigned int append : 1;
+  unsigned int binary : 1;
+  unsigned int scratch : 1 , : 3;
+  unsigned int buffered : 1;
+  unsigned int sync : 1, : 6;
+  unsigned int direct : 1, : 7;
+  unsigned int open : 1;
+  unsigned int own : 1;
+  unsigned int last_op : 2;
+  unsigned int getbuff : 1, : 4;
+  int iostat;
+  unsigned int mode : 8;
+  unsigned int itemsize : 8;
+  unsigned int iconvert : 8;
+  unsigned int fconvert: 8;
+  off_t length;
+  off_t loc;
+  size_t stamp_loc;
+  int (*_read) (CCP4File *, uint8 *, size_t);
+  int (*_write) (CCP4File *, const uint8 *, size_t);
+  char buff[8];
+  void *priv;
+};
+
+
+CCP4File *ccp4_file_open (const char *, const int);
+
+CCP4File *ccp4_file_open_file (const FILE *, const int);
+
+CCP4File *ccp4_file_open_fd (const int, const int);
+
+int ccp4_file_rarch ( CCP4File*);
+
+int ccp4_file_warch ( CCP4File*);
+
+int ccp4_file_close ( CCP4File*);
+
+int ccp4_file_mode ( const CCP4File*);
+
+int ccp4_file_setmode ( CCP4File*, const int);
+
+int ccp4_file_setstamp( CCP4File *, const size_t);
+
+int ccp4_file_itemsize( const CCP4File*);
+
+int ccp4_file_setbyte( CCP4File *, const int);
+
+int ccp4_file_byteorder( CCP4File *);
+
+int ccp4_file_is_write(const CCP4File *);
+
+int ccp4_file_is_read(const CCP4File *);
+
+int ccp4_file_is_append(const CCP4File *);
+
+int ccp4_file_is_scratch(const CCP4File *);
+
+int ccp4_file_is_buffered(const CCP4File *);
+
+int ccp4_file_status(const CCP4File *);
+
+const char *ccp4_file_name( CCP4File *);
+
+int ccp4_file_read ( CCP4File*, uint8 *, size_t);
+
+int ccp4_file_readcomp ( CCP4File*, uint8 *, size_t);
+
+int ccp4_file_readshortcomp ( CCP4File*, uint8 *, size_t);
+
+int ccp4_file_readfloat ( CCP4File*, uint8 *, size_t);
+
+int ccp4_file_readint ( CCP4File*, uint8 *, size_t);
+
+int ccp4_file_readshort ( CCP4File*, uint8 *, size_t);
+
+int ccp4_file_readchar ( CCP4File*, uint8 *, size_t);
+
+int ccp4_file_write ( CCP4File*, const uint8 *, size_t);
+
+int ccp4_file_writecomp ( CCP4File*, const uint8 *, size_t);
+
+int ccp4_file_writeshortcomp ( CCP4File*, const uint8 *, size_t);
+
+int ccp4_file_writefloat ( CCP4File*, const uint8 *, size_t);
+
+int ccp4_file_writeint ( CCP4File*, const uint8 *, size_t);
+
+int ccp4_file_writeshort ( CCP4File*, const uint8 *, size_t);
+
+int ccp4_file_writechar ( CCP4File*, const uint8 *, size_t);
+
+int ccp4_file_seek ( CCP4File*, long, int);
+
+void ccp4_file_rewind ( CCP4File*);
+
+void ccp4_file_flush (CCP4File *);
+
+long ccp4_file_length ( CCP4File*);
+
+long ccp4_file_tell ( CCP4File*);
+
+int ccp4_file_feof(CCP4File *);
+
+void ccp4_file_clearerr(CCP4File *);
+
+void ccp4_file_fatal (CCP4File *, char *);
+
+char *ccp4_file_print(CCP4File *, char *, char *);
+
+int ccp4_file_raw_seek( CCP4File *, long, int);
+int ccp4_file_raw_read ( CCP4File*, char *, size_t);
+int ccp4_file_raw_write ( CCP4File*, const char *, size_t);
+int ccp4_file_raw_setstamp( CCP4File *, const size_t);
+#ifdef __cplusplus
+}
+}
+#endif
+
+#endif  /* __CCP4_LIB_FILE */
diff -ruN ccp4-5.99.5-orig/lib/cctbx/cctbx_sources/ccp4io/lib/src/library_utils.c ccp4-5.99.5/lib/cctbx/cctbx_sources/ccp4io/lib/src/library_utils.c
--- ccp4-5.99.5-orig/lib/cctbx/cctbx_sources/ccp4io/lib/src/library_utils.c	1969-12-31 16:00:00.000000000 -0800
+++ ccp4-5.99.5/lib/cctbx/cctbx_sources/ccp4io/lib/src/library_utils.c	2005-11-30 17:40:04.000000000 -0800
@@ -0,0 +1,727 @@
+/*
+     library_utils.c: CCP4 Library Utilities
+     Copyright (C) 2001  CCLRC, Charles Ballard
+
+     This library is free software and is distributed under the terms and
+     conditions of the CCP4 licence agreement as `Part 0' (Annex 2)
+     software, which is version 2.1 of the GNU Lesser General Public
+     Licence (LGPL) with the following additional clause:
+
+        `You may also combine or link a "work that uses the Library" to
+        produce a work containing portions of the Library, and distribute
+        that work under terms of your choice, provided that you give
+        prominent notice with each copy of the work that the specified
+        version of the Library is used in it, and that you include or
+        provide public access to the complete corresponding
+        machine-readable source code for the Library including whatever
+        changes were used in the work. (i.e. If you make changes to the
+        Library you must distribute those, but you do not need to
+        distribute source or object code to those portions of the work
+        not covered by this licence.)'
+
+     Note that this clause grants an additional right and does not impose
+     any additional restriction, and so does not affect compatibility
+     with the GNU General Public Licence (GPL). If you wish to negotiate
+     other terms, please contact the maintainer.
+
+     You can redistribute it and/or modify the library under the terms of
+     the GNU Lesser General Public License as published by the Free Software
+     Foundation; either version 2.1 of the License, or (at your option) any
+     later version.
+
+     This library is distributed in the hope that it will be useful, but
+     WITHOUT ANY WARRANTY; without even the implied warranty of
+     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+     Lesser General Public License for more details.
+
+     You should have received a copy of the CCP4 licence and/or GNU
+     Lesser General Public License along with this library; if not, write
+     to the CCP4 Secretary, Daresbury Laboratory, Warrington WA4 4AD, UK.
+     The GNU Lesser General Public can also be obtained by writing to the
+     Free Software Foundation, Inc., 59 Temple Place, Suite 330, Boston,
+     MA 02111-1307 USA
+*/
+
+/** @page utilities_page CCP4 Library Utilities
+ *
+ *  @section utilities_list File list
+
+<ul>
+<li>library_utils.c
+<li>ccp4_general.c
+<li>ccp4_parser.c
+<li>ccp4_program.c
+</ul>
+
+ *  @section utilities_overview Overview
+ 
+The CCP4 C-library provides many utility functions which either give
+specific CCP4 functionality (e.g. traditional keyword parsing) or
+are just generally useful (platform independent date).
+
+ */
+
+/** @file library_utils.c
+ *  @brief   Utility functions.
+ *  @author  Charles Ballard
+ */
+
+#include "ccp4_sysdep.h"
+#include <time.h>
+#include <math.h>
+#include "ccp4_utils.h"
+#include "ccp4_errno.h"
+
+#if defined (_MSC_VER)
+#include <tchar.h>
+#include <wchar.h>
+#include <direct.h>
+#include <io.h>
+#endif
+
+#if !defined (_MSC_VER)
+#include <pwd.h>
+#endif
+
+#define CCP4_ERRNO(y) (CCP4_ERR_UTILS | (y))          
+                                       
+
+/* static uint16 nativeIT = NATIVEIT; */ /* machine integer type - currently unused here */
+static uint16 nativeFT = NATIVEFT; /* machine float type */
+
+/** .
+ * 
+ * @return 
+ */
+int ccp4_utils_translate_mode_float(float *out, const void *buffer, int dim, int mode)
+{
+  unsigned char *ucp;
+  unsigned short *usp;
+  float *fp = out, *ufp, tmp1, tmp2;
+  register int ctr=0;
+
+  switch(mode) {
+  case 0:
+    ucp = (unsigned char *)buffer;
+    for(ctr = 0; ctr < dim ; ++ctr)
+      *fp++ = (float) *ucp++;
+    break;
+  case 1:
+    usp = (unsigned short *)buffer;
+    for(ctr = 0; ctr < dim ; ++ctr)
+      *fp++ = (float) *usp++;
+    break;
+  case 3:
+    /* complex short (define type ?) */
+    usp = (unsigned short *)buffer;
+    for(ctr = 0; ctr < dim ; ++ctr) {
+      tmp1 = (float) *usp++;
+      tmp2 = (float) *usp++;
+      *fp++ = (float) sqrt(tmp1*tmp1 + tmp2*tmp2);
+    }
+    break;
+  case 4:
+    /* complex real (define type ?) */
+    ufp = (float *)buffer;
+    for(ctr = 0; ctr < dim ; ++ctr) {
+      tmp1 = *ufp++;
+      tmp2 = *ufp++;
+      *fp++ = (float) sqrt(tmp1*tmp1 + tmp2*tmp2);
+    }
+    break;
+  case 2:
+  default:
+    break;
+  }
+  
+  return (ctr);
+}
+
+/** Gets the length of a Fortran string with trailing blanks removed.
+ * 
+ * @return length of string
+ */
+size_t ccp4_utils_flength (char *s, int len)
+{
+  while (s[--len] == ' ')
+    if (len == 0) return 0;
+  return (++len);
+}
+
+/** .
+ * 
+ * @return 
+ */
+void ccp4_utils_print (const char *message)
+{
+  printf ("%s\n",message);
+ }
+
+#if ! defined (VMS)
+/** .
+ * 
+ * @return 
+ */
+int ccp4_utils_setenv (char *str)
+{
+#if defined (sgi) || defined (sun) || defined (__hpux) || \
+    defined(_AIX) || defined (__OSF1__) || \
+    defined (__osf__) || defined (__FreeBSD__) || defined (linux) || \
+    defined (_WIN32) || defined __linux__
+  /* putenv is the POSIX.1, draft 3 proposed mechanism */
+  int putenv ();
+  char *param;
+
+  if ( (param = (char *) ccp4_utils_malloc( (strlen(str)+1)*sizeof(char) )) == NULL) {
+    ccp4_errno = CCP4_ERRNO(errno);
+    return -1; }
+  strcpy(param,str);
+  return (putenv (param));
+  /* note the necessary lack of free() */
+#else
+  /* setenv is not POSIX, BSD might have to use `index' */
+  int setenv ();
+  char *param1,*param2;
+
+  if ( (param1 = (char *) ccp4_utils_malloc( (strlen(str)+1)*sizeof(char) )) == NULL) {
+    ccp4_errno = CCP4_ERRNO(errno);
+    return -1; }
+  strcpy(param1,str);
+  if ((param2 = (char *) strchr(param1, '=')) == NULL) {
+    ccp4_errno = CCP4_ERRNO(errno);
+    return -1; }
+  *param2++ = '\0';
+  return (setenv (param1, param2, 1));
+#endif
+}
+#endif
+
+#if ! defined (VMS)
+/** .
+ * 
+ * @return 
+ */
+int ccp4_utils_outbuf(void)
+{
+#if defined (sgi) || defined (sun) || \
+    defined (__OSF1__) || \
+    defined (__FreeBSD__)
+  return setlinebuf(stdout);
+#else
+#if defined (_MSC_VER)
+  return setvbuf(stdout, NULL, _IONBF, 80);
+#else
+#  if defined (_AIX)
+  return -1;
+#  else
+  /* Windows requires size argument, though 0 works on unix */
+  return setvbuf(stdout, NULL, _IOLBF, 80);
+#  endif
+#endif
+#endif
+}
+
+/** .
+ * 
+ * @return 
+ */
+int ccp4_utils_noinpbuf(void)
+{
+  return setvbuf(stdin, NULL, _IONBF, 0);
+}
+#endif
+
+union float_uint_uchar ccp4_nan ()
+
+#if NATIVEFT == DFNTF_BEIEEE || NATIVEFT == DFNTF_LEIEEE
+#  define NAN 0xfffa5a5a
+#endif
+/* For \idx{Convex} native mode and \idx{VAX} use a \idx{Rop} value:        */
+/*                                                                          */
+/* <magic numbers>=                                                         */
+#if NATIVEFT == DFNTF_CONVEXNATIVE
+#  define NAN 0x80000000
+#endif
+#if NATIVEFT == DFNTF_VAX
+#  define NAN 0x00008000
+#endif
+#ifndef NAN
+#  error "NAN isn't defined (needs NATIVEFT)"
+#endif
+{
+  union float_uint_uchar realnum;
+
+  realnum.i = NAN;
+  return (realnum);
+}
+
+/** .
+ * 
+ * @return 
+ */
+int ccp4_utils_isnan (const union float_uint_uchar *realnum)
+{
+    switch (nativeFT) {
+    case DFNTF_BEIEEE :
+    case DFNTF_LEIEEE :
+      return ((realnum->i & 0x7f800000) == 0x7f800000); /* exponent all 1s */
+    case DFNTF_CONVEXNATIVE :
+      return ((realnum->i & 0xff800000) == 0x80000000);      
+    case DFNTF_VAX :
+      return ((realnum->i & 0x0000ff80) == 0x00008000);
+    default :
+      ccp4_fatal("CCP4_UTILS_ISNAN: bad nativeFT");
+      return 0;                   /* avoid compiler warning */
+    }
+}
+
+#define MDFBIG -1.0E10          /* BIOMOL absence flag value */
+/** .
+ * 
+ * @return 
+ */
+void ccp4_utils_bml (int ncols, union float_uint_uchar cols[])
+{
+  int i;
+  for (i=0; i<ncols; i++)
+    if (cols[i].i != NAN)
+      if (cols[i].f <= MDFBIG) cols[i].f = 0.0;
+}
+
+/** .
+ * 
+ * @return 
+ */
+void ccp4_utils_wrg (int ncols, union float_uint_uchar cols[], float wminmax[])
+{
+  int i;
+  for (i=0; i<ncols; i++)
+    if (cols[i].i != NAN)
+       if (cols[i].f > MDFBIG) {
+         if (cols[i].f < wminmax[2*i]) wminmax[2*i] = cols[i].f;
+         if (cols[i].f > wminmax[1+2*i]) wminmax[1+2*i] = cols[i].f; }
+}
+
+/** .
+ * 
+ * @return 
+ */
+void ccp4_utils_hgetlimits (int *IValueNotDet, float *ValueNotDet)
+{
+  *IValueNotDet = INT_MAX;
+  *ValueNotDet  = FLT_MAX;
+}
+
+/** .
+ * 
+ * @return 
+ */
+int ccp4_utils_mkdir (const char *path, const char *cmode)
+#if !defined (_MSC_VER) && !defined(_WIN32)
+{  
+  mode_t mode = 0;
+  int result; 
+#if defined (__APPLE__)
+  static const unsigned short TBM = 0x07;
+
+  switch (strlen(cmode)) {
+  case 4:
+    mode |= (*cmode & TBM) << 9 ;
+    mode |= (*(cmode+1) & TBM) << 6 ;
+    mode |= (*(cmode+2) & TBM) << 3 ;
+    mode |= (*(cmode+3) & TBM) ;
+    break;
+  case 3:
+    mode |= (*cmode & TBM) << 6 ;
+    mode |= (*(cmode+1) & TBM) << 3 ; 
+    mode |= (*(cmode+2) & TBM) ;      
+    break;
+  case 2:
+    mode |= (*cmode & TBM) << 3 ;
+    mode |= (*(cmode+1) & TBM) ;
+    break;
+  case 1:
+    mode |= (*cmode & TBM) ;
+    break;
+  default:
+    mode = 0x0fff ;
+  }
+#else 
+/* Possible modes (see stat.h)
+  Currently pass 3-character string and interpret as octal.
+  Try also S_IRWXU, S_IRWXG, etc. */
+  sscanf(cmode,"%o",&mode);
+#endif   
+  result = mkdir(path,mode); 
+
+  if (result == -1) {
+    if (errno == EEXIST) {
+      result = 1;
+    }
+  }
+  return (result); 
+}
+#else
+   {
+     /*printf("No harvesting on NT.");
+       return (-1);*/
+     int result;
+     result = mkdir(path);
+     
+     if (result == -1) {
+       if (errno == EEXIST) {
+	 result = 1;
+       }
+     }
+     return (result);
+   }
+#endif
+
+/** .
+ * 
+ * @return 
+ */
+int ccp4_utils_chmod (const char *path, const char *cmode)
+#if !defined (_MSC_VER) || !defined(_WIN32)
+{ mode_t mode = 0;
+#if defined (__APPLE__)
+  static const unsigned short TBM = 0x07;
+
+  switch (strlen(cmode)) {
+  case 4:
+    mode |= (*cmode & TBM) << 9 ;
+    mode |= (*(cmode+1) & TBM) << 6 ;
+    mode |= (*(cmode+2) & TBM) << 3 ;
+    mode |= (*(cmode+3) & TBM) ;
+    break;
+  case 3:
+    mode |= (*cmode & TBM) << 6 ;
+    mode |= (*(cmode+1) & TBM) << 3 ; 
+    mode |= (*(cmode+2) & TBM) ;      
+    break;
+  case 2:
+    mode |= (*cmode & TBM) << 3 ;
+    mode |= (*(cmode+1) & TBM) ;
+    break;
+  case 1:
+    mode |= (*cmode & TBM) ;
+    break;
+  default:
+    mode = 0x0fff ;
+  }
+#else 
+/* Possible modes (see stat.h)
+  Currently pass 3-character string and interpret as octal.
+  Try also S_IRWXU, S_IRWXG, etc. */
+  sscanf(cmode,"%o",&mode);
+#endif
+  return (chmod(path,mode)); 
+}
+#else
+   {
+     /*printf("No harvesting on NT.");
+       return (-1);*/
+     return (chmod(path,0x0fff));
+   }
+#endif
+
+/** This is a wrapper for the malloc function, which adds some
+ * error trapping.
+ * 
+ * @return void
+ */
+void *ccp4_utils_malloc(size_t size)
+
+{ void *val; 
+
+  val = malloc (size);
+  if (!val && size)
+    {
+      perror ("Failure in ccp4_utils_malloc");
+      abort ();
+    }
+  return val;}
+
+/** This is a wrapper for the realloc function, which adds some
+ * error trapping.
+ * 
+ * @return 
+ */
+void *ccp4_utils_realloc(void *ptr, size_t size)
+{ void *val; 
+
+  val = realloc (ptr, size);
+  if (!val && size)
+    {
+      perror ("Failure in ccp4_utils_realloc");
+      abort ();
+    }
+  return val;}
+
+/** This is a wrapper for the calloc function, which adds some
+ * error trapping.
+ * 
+ * @return 
+ */
+void *ccp4_utils_calloc(size_t nelem , size_t elsize)
+{ void *val; 
+
+  val = calloc (nelem, elsize);
+  if (!val && elsize)
+    {
+      perror ("Failure in ccp4_utils_calloc");
+      abort ();
+    }
+  return val;}
+
+
+/** Return the user's login name.
+ * (MVisualStudio version in w32mvs.c)
+ * Note that getlogin only works for processes attached to
+ * a terminal (and hence won't work from the GUI).
+ * In these instances use getpwuid instead.
+ * @return pointer to character string containing login name.
+ */
+#if ! defined (_MSC_VER)
+char *ccp4_utils_username(void)
+{ 
+  struct passwd *passwd_struct=NULL;
+  char *userid=NULL;
+  if (!(userid = getlogin())) {
+    passwd_struct = getpwuid(getuid());
+    userid = passwd_struct->pw_name;
+  }
+  return(userid); 
+}
+#endif
+
+/** Extracts the basename from a full file name.
+ * Separators for directories and extensions are OS-specific.
+ * @param filename full file name string.
+ * @return pointer to basename
+ */
+char *ccp4_utils_basename(char *filename)
+{
+  int i, indx1=-1, length;
+  char *basename;
+
+  for ( i = strlen(filename)-1; i >= 0; i-- ) {
+    if (filename[i] == PATH_SEPARATOR) {
+      indx1 = i; 
+      break;
+    }
+  }
+  length = strlen(filename) - indx1;
+  /* Search for extension separators must be performed backwards
+     in case filename has multiple extension separators */
+  for ( i = strlen(filename)-1; i >= (indx1 < 0 ? 0 : indx1) ; i-- ) {
+    if (filename[i] == EXT_SEPARATOR) {
+      length = i - indx1; 
+      break;
+    }
+  }
+  basename = ccp4_utils_malloc(length*sizeof(char));
+  strncpy(basename,filename+indx1+1,length-1);
+  basename[length-1]='\0';
+  return basename;
+}
+
+/** Extracts the pathname from a full file name.
+ * Separators for directories and extensions are OS-specific.
+ * @param filename full file name string.
+ * @return pointer to pathname with trailing separator.
+ */
+char *ccp4_utils_pathname(char *filename)
+{
+  int i, indx1=-1, length;
+  char *pathname;
+
+  for ( i = strlen(filename)-1; i >= 0; i-- ) {
+    if (filename[i] == PATH_SEPARATOR) {
+      indx1 = i; 
+      break;
+    }
+  }
+  length = indx1+2;
+  pathname = ccp4_utils_malloc(length*sizeof(char));
+  strncpy(pathname,filename,length-1);
+  pathname[length-1]='\0';
+  return pathname;
+}
+
+/** Extracts the extension from a full file name.
+ * Separators for directories and extensions are OS-specific.
+ * @param filename full file name string.
+ * @return pointer to extension
+ */
+char *ccp4_utils_extension(char *filename)
+{
+  int i, indx1=-1, length=1;
+  char *extension;
+
+  for ( i = strlen(filename)-1; i >= 0; i-- ) {
+    if (filename[i] == EXT_SEPARATOR) {
+      indx1 = i; 
+      length = strlen(filename) - indx1;
+      break;
+    } else if (filename[i] == PATH_SEPARATOR) {
+      indx1 = i; 
+      length = 1;
+      break;
+    }
+  }
+  extension = ccp4_utils_malloc(length*sizeof(char));
+  strncpy(extension,filename+indx1+1,length-1);
+  extension[length-1]='\0';
+  return extension;
+}
+
+/** Joins a leading directory with a filename.
+ * Separators for directories and extensions are OS-specific.
+ * @param dir  directory path.
+ * @param file file name string.
+ * @return pointer to joined directory-filename path.
+ */
+char *ccp4_utils_joinfilenames(char *dir, char *file)
+{
+  char *join=NULL;
+  int  lendir,lenfile,lenjoin;
+
+  lendir = strlen(dir);
+  lenfile = strlen(file);
+  lenjoin = lendir + lenfile + 2;
+
+  join = (char *) ccp4_utils_malloc(sizeof(char)*lenjoin);
+  if (!join) {
+    return NULL;
+  }
+
+  strncpy(join,dir,lendir);
+  join[lendir] = PATH_SEPARATOR;
+  join[lendir+1] = '\0';
+  strncat(join,file,lenfile);
+  join[lenjoin-1] = '\0';
+
+  return join;
+}
+
+/** .
+ * 
+ * @return 
+ */
+void ccp4_utils_idate (int iarray[3])
+{
+     struct tm *lt=NULL;
+     time_t tim;
+     tim = time(NULL);
+     lt = localtime(&tim);
+     iarray[0] = lt->tm_mday;
+     iarray[1] = lt->tm_mon+1;  /* need range 1-12 */
+     iarray[2] = lt->tm_year + 1900;
+}
+
+/** .
+ * 
+ * @return 
+ */
+char *ccp4_utils_date(char *date)
+{
+  int iarray[3];
+
+  ccp4_utils_idate(iarray);
+  sprintf(date,"%2d/%2d/%4d",iarray[0],iarray[1],iarray[2]);
+  date[10] = '\0';
+
+  return (date);
+}
+
+/** Function to obtain current time.
+ * @param iarray Array containing hours, minutes and seconds.
+ * @return void.
+ */
+void ccp4_utils_itime (int iarray[3])
+{
+     struct tm *lt;
+     time_t tim;
+     tim = time(NULL);
+     lt = localtime(&tim);
+     iarray[0] = lt->tm_hour; 
+     iarray[1] = lt->tm_min; 
+     iarray[2] = lt->tm_sec;
+}
+
+/** Alternative to ccp4_utils_itime with time as character string.
+ * @param time Character string of form HH:MM:SS
+ * @return pointer to character string.
+ */
+char *ccp4_utils_time(char *time)
+{
+  int iarray[3];
+
+  ccp4_utils_itime(iarray);
+  sprintf(time,"%2.2d:%2.2d:%2.2d",iarray[0],iarray[1],iarray[2]);
+  time[8] = '\0';
+
+  return (time);
+}
+
+/** Function to obtain User and System times.
+ * @param tarray Array containing User and System times.
+ * @return Sum of User and System times.
+ */
+#if ! defined (_MSC_VER) 
+float ccp4_utils_etime (float tarray[2])
+{
+  static long clk_tck = 0;
+
+  struct tms buffer;
+  if (! clk_tck) clk_tck = sysconf(_SC_CLK_TCK);
+  (void) times(&buffer);
+  tarray[0] = (float) buffer.tms_utime / (float)clk_tck;
+  tarray[1] = (float) buffer.tms_stime / (float)clk_tck;
+  return (tarray[0]+tarray[1]);
+}
+#endif
+
+#if defined (_MSC_VER)
+double ccp4_erfc( double x )
+{
+  double t,z,ans;
+
+  z=fabs(x);
+  t=1.0/(1.0+0.5*z);
+  ans=t*exp(-z*z-1.26551223+t*(1.00002368+t*(0.37409196+t*(0.09678418+
+      t*(-0.18628806+t*(0.27886807+t*(-1.13520398+t*(1.48851587+
+      t*(-0.82215223+t*0.17087277)))))))));
+  return  x >= 0.0 ? ans : 2.0-ans;
+}
+#endif
+
+#if defined (__APPLE__) && defined (__GNUC__) && ( __GNUC__ < 3 )
+void _carbon_init(int argc, char **argv) {}
+void _objcInit(void) {}
+#endif
+
+#if defined (__APPLE__) && defined (__GNUC__) && ( __GNUC__ == 3 ) && (__GNUC_MINOR__ == 1)
+float acosf(float x) {
+  return (float) acos( (double) x);
+}
+
+float atanf(float x) {       
+  return (float) atan( (double) x);
+}
+
+float asinf(float x) {       
+  return (float) asin( (double) x);
+}
+
+#endif
+
+#  if (defined _MSC_VER)
+double rint(double x) { 
+  if (x >= 0.) {
+   return (double)(int)(x+.5);
+  }
+  return (double)(int)(x-.5);
+}
+#endif
diff -ruN ccp4-5.99.5-orig/lib/cctbx/cctbx_sources/ccp4io/lib/src/mtzdata.h ccp4-5.99.5/lib/cctbx/cctbx_sources/ccp4io/lib/src/mtzdata.h
--- ccp4-5.99.5-orig/lib/cctbx/cctbx_sources/ccp4io/lib/src/mtzdata.h	1969-12-31 16:00:00.000000000 -0800
+++ ccp4-5.99.5/lib/cctbx/cctbx_sources/ccp4io/lib/src/mtzdata.h	2005-11-30 17:40:04.000000000 -0800
@@ -0,0 +1,202 @@
+/*
+     mtzdata.h: Definition of MTZ data structure.
+     Copyright (C) 2001  CCLRC, Martyn Winn
+
+     This library is free software and is distributed under the terms and
+     conditions of the CCP4 licence agreement as `Part 0' (Annex 2)
+     software, which is version 2.1 of the GNU Lesser General Public
+     Licence (LGPL) with the following additional clause:
+
+        `You may also combine or link a "work that uses the Library" to
+        produce a work containing portions of the Library, and distribute
+        that work under terms of your choice, provided that you give
+        prominent notice with each copy of the work that the specified
+        version of the Library is used in it, and that you include or
+        provide public access to the complete corresponding
+        machine-readable source code for the Library including whatever
+        changes were used in the work. (i.e. If you make changes to the
+        Library you must distribute those, but you do not need to
+        distribute source or object code to those portions of the work
+        not covered by this licence.)'
+
+     Note that this clause grants an additional right and does not impose
+     any additional restriction, and so does not affect compatibility
+     with the GNU General Public Licence (GPL). If you wish to negotiate
+     other terms, please contact the maintainer.
+
+     You can redistribute it and/or modify the library under the terms of
+     the GNU Lesser General Public License as published by the Free Software
+     Foundation; either version 2.1 of the License, or (at your option) any
+     later version.
+
+     This library is distributed in the hope that it will be useful, but
+     WITHOUT ANY WARRANTY; without even the implied warranty of
+     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+     Lesser General Public License for more details.
+
+     You should have received a copy of the CCP4 licence and/or GNU
+     Lesser General Public License along with this library; if not, write
+     to the CCP4 Secretary, Daresbury Laboratory, Warrington WA4 4AD, UK.
+     The GNU Lesser General Public can also be obtained by writing to the
+     Free Software Foundation, Inc., 59 Temple Place, Suite 330, Boston,
+     MA 02111-1307 USA
+*/
+
+/** @file mtzdata.h
+ *
+ *  @brief Definition of MTZ data structure.
+ *
+ *  The file defines a hierarchy of structs which hold the
+ *  MTZ data structure.
+ *
+ *  @author Martyn Winn 
+ */
+
+#ifndef __CMTZData__
+#define __CMTZData__
+
+#define MTZVERSN "MTZ:V1.1"         /**< traditional version number! */
+#define MTZ_MAJOR_VERSN 1      /**< MTZ file major version - keep to single digit */
+#define MTZ_MINOR_VERSN 1      /**< MTZ file minor version - keep to single digit */
+
+/** defines for sizes in MTZ structure */
+#define SIZE1 20                    /**< size of pre-reflection block */
+#define MTZRECORDLENGTH 80          /**< length of records */
+#define MAXSPGNAMELENGTH 20         /**< max length of a spacegroup name */
+
+#define NBATCHWORDS 185       /**< total size of batch header buffer */
+#define NBATCHINTEGERS 29     /**< size of integer section of batch header buffer */
+#define NBATCHREALS 156       /**< size of float section of batch header buffer */
+
+#define MXTALS      100      /**< maximum number of crystals (for a few arrays - to be removed!) */
+#define MSETS      1000      /**< maximum number of datasets (for a few arrays - to be removed!) */
+#define MCOLUMNS  10000      /**< maximum number of columns (for a few arrays - to be removed!) */
+
+/** MTZ column struct. */
+typedef struct { char label[31];       /**< column name as given by user */
+		 char type[3];         /**< column type */
+                 int active;           /**< whether column in active list */
+                 unsigned int source;  /**< column index in input file */
+ 		 float min;            /**< minimum data element */
+		 float max;            /**< maximum data element */
+		 float *ref;           /**< data array */
+	       } MTZCOL;
+
+/** MTZ dataset struct. */
+typedef struct { int setid;            /**< Dataset id */
+		 char dname[65];       /**< Dataset name */
+		 float wavelength;     /**< Dataset wavelength */
+		 int ncol;             /**< number of columns */
+		 MTZCOL **col;         /**< columns */
+	       } MTZSET;
+
+/** MTZ crystal struct. */
+typedef struct { int xtalid;           /**< Crystal id */
+		 char xname[65];       /**< Crystal name */
+		 char pname[65];       /**< Project name */
+		 float cell[6];        /**< Crystal cell */
+                 float resmin;         /**< Low resolution limit */
+                 float resmax;         /**< High resolution limit */
+		 int nset;             /**< number of datasets */
+		 MTZSET **set;         /**< datasets */
+	       } MTZXTAL;
+
+/** MTZ batch struct. */
+typedef struct bathead { int num;              /**< batch number */
+		 char title[71];       /**< batch title */
+		 char gonlab[3][9];    /**< names of the three axes */
+                 int iortyp;           /**< type of orientation block (for 
+                                          possible future use, now = 0) */
+		 int lbcell[6];        /**< refinement flags for cell */
+		 int misflg;           /**< number of phixyz used (0, 1, or 2) */
+		 int jumpax;           /**< reciprocal axis closest to rotation
+					  axis */
+		 int ncryst;           /**< crystal number */
+		 int lcrflg;           /**< mosaicity model: 0 = isotropic, 
+					  1 = anisotropic */
+		 int ldtype;           /**< type of data: 2D (1), 3D (2), or 
+					  Laue (3) */
+		 int jsaxs;            /**< goniostat scan axis number */
+		 int nbscal;           /**< number of batch scales & Bfactors
+					  (0 if unset) */
+		 int ngonax;           /**< number of goniostat axes */
+		 int lbmflg;           /**< flag for type of beam info:
+					  = 0 for alambd, delamb
+					  = 1 also delcor, divhd, divvd */
+		 int ndet;             /**< number of detectors (current maximum
+					  2) */
+                 int nbsetid;          /**< dataset id - should be pointer? */
+                 float cell[6];        /**< cell dimensions */
+		 float umat[9];        /**< orientation matrix U in Fortranic order,
+                                         i.e. U(1,1), U(2,1) ... */
+		 float phixyz[2][3];   /**< missetting angles at beginning and
+					  end of oscillation */
+		 float crydat[12];     /**< mosaicity */
+		 float datum[3];       /**< datum values of goniostat axes */
+		 float phistt;         /**< start of phi relative to datum */
+		 float phiend;         /**< end of phi relative to datum */
+		 float scanax[3];      /**< rotation axis in lab frame */
+		 float time1;          /**< start time */
+		 float time2;          /**< stop time */
+		 float bscale;         /**< batch scale */
+		 float bbfac;          /**< batch temperature factor */
+		 float sdbscale;       /**< sd bscale */
+		 float sdbfac;         /**< sd bbfac */
+                 float phirange;       /**< phi range */
+		 float e1[3];          /**< vector 1 ("Cambridge" laboratory axes)
+					  defining ngonax goniostat axes */
+		 float e2[3];          /**< vector 2 ("Cambridge" laboratory axes)
+					  defining ngonax goniostat axes */
+		 float e3[3];          /**< vector 3 ("Cambridge" laboratory axes)
+					  defining ngonax goniostat axes */
+		 float source[3];      /**< idealised source vector */
+		 float so[3];          /**< source vector */
+		 float alambd;         /**< wavelength (A) */
+		 float delamb;         /**< dispersion (deltalambda / lambda) */
+		 float delcor;         /**< correlated component */
+		 float divhd;          /**< horizontal beam divergence */
+		 float divvd;          /**< vertical beam divergence */
+		 float dx[2];          /**< xtal to detector distance */
+		 float theta[2];       /**< detector tilt angle */
+		 float detlm[2][2][2]; /**< min & max values of detector coords
+					  (pixels) */
+		 struct bathead *next; /**< next batch in list */
+	       } MTZBAT;
+
+/** MTZ symmetry struct. */
+typedef struct { int spcgrp;           /**< spacegroup number */
+		 char spcgrpname[MAXSPGNAMELENGTH+1];  /**< spacegroup name */
+		 int nsym;             /**< number of symmetry operations */
+		 float sym[192][4][4]; /**< symmetry operations 
+                                          (translations in [*][3]) */
+		 int nsymp;            /**< number of primitive symmetry ops. */
+		 char symtyp;          /**< lattice type (P,A,B,C,I,F,R) */
+		 char pgname[11];      /**< pointgroup name */
+               } SYMGRP;
+
+typedef union { char amnf[4]; 
+                float fmnf;
+              } MNF;
+
+/** Top level of MTZ struct. */
+typedef struct { CCP4File *filein;     /**< file for reading */
+                 CCP4File *fileout;    /**< file for writing */
+		 char title[71];       /**< title of mtz structure */
+		 char *hist;           /**< history of mtz file */
+		 int histlines;        /**< number of lines in hist */
+		 int nxtal;            /**< number of crystals */
+                 int ncol_read;        /**< number of columns from file */
+		 int nref;             /**< total number of reflections */
+		 int nref_filein;      /**< number of reflections from input file */
+                 int refs_in_memory;   /**< whether reflections are held in memory */
+		 int n_orig_bat;       /**< original number of batches */
+                 float resmax_out;     /**< output file max res */
+                 float resmin_out;     /**< output file min res */
+                 MNF mnf;              /**< value of missing number flag */
+                 SYMGRP mtzsymm;       /**< symmetry information */
+		 MTZXTAL **xtal;       /**< crystals */
+		 MTZBAT *batch;        /**< first batch header */
+		 MTZCOL *order[5];     /**< sort order */
+	       } MTZ;
+
+#endif
diff -ruN ccp4-5.99.5-orig/lib/clipper/configure ccp4-5.99.5/lib/clipper/configure
--- ccp4-5.99.5-orig/lib/clipper/configure	2005-11-30 15:22:09.000000000 -0800
+++ ccp4-5.99.5/lib/clipper/configure	2005-11-30 16:27:46.000000000 -0800
@@ -7170,27 +7170,27 @@
       link_all_deplibs=yes
     if test "$GCC" = yes ; then
     	output_verbose_link_cmd='echo'
-        archive_cmds='$CC -dynamiclib $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags -install_name $rpath/$soname $verstring'
+        archive_cmds='$CC -dynamiclib $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags -install_name SW_PREFIX/lib/ccp4-5.99.5/$soname $verstring'
       module_cmds='$CC $allow_undefined_flag -o $lib -bundle $libobjs $deplibs$compiler_flags'
       # Don't fix this by using the ld -exported_symbols_list flag, it doesn't exist in older darwin lds
-      archive_expsym_cmds='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC -dynamiclib $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags -install_name $rpath/$soname $verstring~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
+      archive_expsym_cmds='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC -dynamiclib $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags -install_name SW_PREFIX/lib/ccp4-5.99.5/$soname $verstring~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
       module_expsym_cmds='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC $allow_undefined_flag  -o $lib -bundle $libobjs $deplibs$compiler_flags~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
     else
       case $cc_basename in
         xlc* )
          output_verbose_link_cmd='echo'
-         archive_cmds='$CC -qmkshrobj $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-install_name ${wl}`echo $rpath/$soname` $verstring'
+         archive_cmds='$CC -qmkshrobj $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-install_name ${wl}`echo SW_PREFIX/lib/ccp4-5.99.5/$soname` $verstring'
          module_cmds='$CC $allow_undefined_flag -o $lib -bundle $libobjs $deplibs$compiler_flags'
           # Don't fix this by using the ld -exported_symbols_list flag, it doesn't exist in older darwin lds
-         archive_expsym_cmds='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC -qmkshrobj $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-install_name ${wl}$rpath/$soname $verstring~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
+         archive_expsym_cmds='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC -qmkshrobj $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-install_name ${wl}SW_PREFIX/lib/ccp4-5.99.5/$soname $verstring~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
           module_expsym_cmds='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC $allow_undefined_flag  -o $lib -bundle $libobjs $deplibs$compiler_flags~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
           ;;
         xlf* )
          output_verbose_link_cmd='echo'
-         archive_cmds='$CC -qmkshrobj $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-dylib_install_name ${wl}`echo $rpath/$soname` $verstring'
+         archive_cmds='$CC -qmkshrobj $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-dylib_install_name ${wl}`echo SW_PREFIX/lib/ccp4-5.99.5/$soname` $verstring'
          module_cmds='$CC $allow_undefined_flag -o $lib -bundle $libobjs $deplibs$compiler_flags'
           # Don't fix this by using the ld -exported_symbols_list flag, it doesn't exist in older darwin lds
-         archive_expsym_cmds='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC -qmkshrobj $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-dylib_install_name ${wl}$rpath/$soname $verstring~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
+         archive_expsym_cmds='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC -qmkshrobj $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-dylib_install_name ${wl}SW_PREFIX/lib/ccp4-5.99.5/$soname $verstring~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
           module_expsym_cmds='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC $allow_undefined_flag  -o $lib -bundle $libobjs $deplibs$compiler_flags~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
           ;;
        *)
@@ -10171,26 +10171,26 @@
        lt_int_apple_cc_single_mod=yes
       fi
       if test "X$lt_int_apple_cc_single_mod" = Xyes ; then
-       archive_cmds_CXX='$CC -dynamiclib -single_module $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags -install_name $rpath/$soname $verstring'
+       archive_cmds_CXX='$CC -dynamiclib -single_module $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags -install_name SW_PREFIX/lib/ccp4-5.99.5/$soname $verstring'
       else
-          archive_cmds_CXX='$CC -r -keep_private_externs -nostdlib -o ${lib}-master.o $libobjs~$CC -dynamiclib $allow_undefined_flag -o $lib ${lib}-master.o $deplibs $compiler_flags -install_name $rpath/$soname $verstring'
+          archive_cmds_CXX='$CC -r -keep_private_externs -nostdlib -o ${lib}-master.o $libobjs~$CC -dynamiclib $allow_undefined_flag -o $lib ${lib}-master.o $deplibs $compiler_flags -install_name SW_PREFIX/lib/ccp4-5.99.5/$soname $verstring'
         fi
         module_cmds_CXX='$CC $allow_undefined_flag -o $lib -bundle $libobjs $deplibs$compiler_flags'
         # Don't fix this by using the ld -exported_symbols_list flag, it doesn't exist in older darwin lds
           if test "X$lt_int_apple_cc_single_mod" = Xyes ; then
-            archive_expsym_cmds_CXX='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC -dynamiclib -single_module $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags -install_name $rpath/$soname $verstring~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
+            archive_expsym_cmds_CXX='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC -dynamiclib -single_module $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags -install_name SW_PREFIX/lib/ccp4-5.99.5/$soname $verstring~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
           else
-            archive_expsym_cmds_CXX='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC -r -keep_private_externs -nostdlib -o ${lib}-master.o $libobjs~$CC -dynamiclib $allow_undefined_flag -o $lib ${lib}-master.o $deplibs $compiler_flags -install_name $rpath/$soname $verstring~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
+            archive_expsym_cmds_CXX='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC -r -keep_private_externs -nostdlib -o ${lib}-master.o $libobjs~$CC -dynamiclib $allow_undefined_flag -o $lib ${lib}-master.o $deplibs $compiler_flags -install_name SW_PREFIX/lib/ccp4-5.99.5/$soname $verstring~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
           fi
             module_expsym_cmds_CXX='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC $allow_undefined_flag  -o $lib -bundle $libobjs $deplibs$compiler_flags~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
       else
       case $cc_basename in
         xlc*)
          output_verbose_link_cmd='echo'
-          archive_cmds_CXX='$CC -qmkshrobj ${wl}-single_module $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-install_name ${wl}`echo $rpath/$soname` $verstring'
+          archive_cmds_CXX='$CC -qmkshrobj ${wl}-single_module $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-install_name ${wl}`echo SW_PREFIX/lib/ccp4-5.99.5/$soname` $verstring'
           module_cmds_CXX='$CC $allow_undefined_flag -o $lib -bundle $libobjs $deplibs$compiler_flags'
           # Don't fix this by using the ld -exported_symbols_list flag, it doesn't exist in older darwin lds
-          archive_expsym_cmds_CXX='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC -qmkshrobj ${wl}-single_module $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-install_name ${wl}$rpath/$soname $verstring~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
+          archive_expsym_cmds_CXX='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC -qmkshrobj ${wl}-single_module $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-install_name ${wl}SW_PREFIX/lib/ccp4-5.99.5/$soname $verstring~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
           module_expsym_cmds_CXX='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC $allow_undefined_flag  -o $lib -bundle $libobjs $deplibs$compiler_flags~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
           ;;
        *)
@@ -14249,27 +14249,27 @@
       link_all_deplibs_F77=yes
     if test "$GCC" = yes ; then
     	output_verbose_link_cmd='echo'
-        archive_cmds_F77='$CC -dynamiclib $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags -install_name $rpath/$soname $verstring'
+        archive_cmds_F77='$CC -dynamiclib $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags -install_name SW_PREFIX/lib/ccp4-5.99.5/$soname $verstring'
       module_cmds_F77='$CC $allow_undefined_flag -o $lib -bundle $libobjs $deplibs$compiler_flags'
       # Don't fix this by using the ld -exported_symbols_list flag, it doesn't exist in older darwin lds
-      archive_expsym_cmds_F77='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC -dynamiclib $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags -install_name $rpath/$soname $verstring~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
+      archive_expsym_cmds_F77='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC -dynamiclib $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags -install_name SW_PREFIX/lib/ccp4-5.99.5/$soname $verstring~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
       module_expsym_cmds_F77='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC $allow_undefined_flag  -o $lib -bundle $libobjs $deplibs$compiler_flags~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
     else
       case $cc_basename in
         xlc* )
          output_verbose_link_cmd='echo'
-         archive_cmds_F77='$CC -qmkshrobj $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-install_name ${wl}`echo $rpath/$soname` $verstring'
+         archive_cmds_F77='$CC -qmkshrobj $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-install_name ${wl}`echo SW_PREFIX/lib/ccp4-5.99.5/$soname` $verstring'
          module_cmds_F77='$CC $allow_undefined_flag -o $lib -bundle $libobjs $deplibs$compiler_flags'
           # Don't fix this by using the ld -exported_symbols_list flag, it doesn't exist in older darwin lds
-         archive_expsym_cmds_F77='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC -qmkshrobj $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-install_name ${wl}$rpath/$soname $verstring~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
+         archive_expsym_cmds_F77='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC -qmkshrobj $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-install_name ${wl}SW_PREFIX/lib/ccp4-5.99.5/$soname $verstring~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
           module_expsym_cmds_F77='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC $allow_undefined_flag  -o $lib -bundle $libobjs $deplibs$compiler_flags~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
           ;;
         xlf* )
          output_verbose_link_cmd='echo'
-         archive_cmds_F77='$CC -qmkshrobj $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-dylib_install_name ${wl}`echo $rpath/$soname` $verstring'
+         archive_cmds_F77='$CC -qmkshrobj $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-dylib_install_name ${wl}`echo SW_PREFIX/lib/ccp4-5.99.5/$soname` $verstring'
          module_cmds_F77='$CC $allow_undefined_flag -o $lib -bundle $libobjs $deplibs$compiler_flags'
           # Don't fix this by using the ld -exported_symbols_list flag, it doesn't exist in older darwin lds
-         archive_expsym_cmds_F77='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC -qmkshrobj $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-dylib_install_name ${wl}$rpath/$soname $verstring~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
+         archive_expsym_cmds_F77='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC -qmkshrobj $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-dylib_install_name ${wl}SW_PREFIX/lib/ccp4-5.99.5/$soname $verstring~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
           module_expsym_cmds_F77='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC $allow_undefined_flag  -o $lib -bundle $libobjs $deplibs$compiler_flags~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
           ;;
        *)
@@ -16737,27 +16737,27 @@
       link_all_deplibs_GCJ=yes
     if test "$GCC" = yes ; then
     	output_verbose_link_cmd='echo'
-        archive_cmds_GCJ='$CC -dynamiclib $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags -install_name $rpath/$soname $verstring'
+        archive_cmds_GCJ='$CC -dynamiclib $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags -install_name SW_PREFIX/lib/ccp4-5.99.5/$soname $verstring'
       module_cmds_GCJ='$CC $allow_undefined_flag -o $lib -bundle $libobjs $deplibs$compiler_flags'
       # Don't fix this by using the ld -exported_symbols_list flag, it doesn't exist in older darwin lds
-      archive_expsym_cmds_GCJ='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC -dynamiclib $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags -install_name $rpath/$soname $verstring~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
+      archive_expsym_cmds_GCJ='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC -dynamiclib $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags -install_name SW_PREFIX/lib/ccp4-5.99.5/$soname $verstring~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
       module_expsym_cmds_GCJ='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC $allow_undefined_flag  -o $lib -bundle $libobjs $deplibs$compiler_flags~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
     else
       case $cc_basename in
         xlc* )
          output_verbose_link_cmd='echo'
-         archive_cmds_GCJ='$CC -qmkshrobj $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-install_name ${wl}`echo $rpath/$soname` $verstring'
+         archive_cmds_GCJ='$CC -qmkshrobj $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-install_name ${wl}`echo SW_PREFIX/lib/ccp4-5.99.5/$soname` $verstring'
          module_cmds_GCJ='$CC $allow_undefined_flag -o $lib -bundle $libobjs $deplibs$compiler_flags'
           # Don't fix this by using the ld -exported_symbols_list flag, it doesn't exist in older darwin lds
-         archive_expsym_cmds_GCJ='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC -qmkshrobj $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-install_name ${wl}$rpath/$soname $verstring~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
+         archive_expsym_cmds_GCJ='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC -qmkshrobj $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-install_name ${wl}SW_PREFIX/lib/ccp4-5.99.5/$soname $verstring~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
           module_expsym_cmds_GCJ='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC $allow_undefined_flag  -o $lib -bundle $libobjs $deplibs$compiler_flags~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
           ;;
         xlf* )
          output_verbose_link_cmd='echo'
-         archive_cmds_GCJ='$CC -qmkshrobj $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-dylib_install_name ${wl}`echo $rpath/$soname` $verstring'
+         archive_cmds_GCJ='$CC -qmkshrobj $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-dylib_install_name ${wl}`echo SW_PREFIX/lib/ccp4-5.99.5/$soname` $verstring'
          module_cmds_GCJ='$CC $allow_undefined_flag -o $lib -bundle $libobjs $deplibs$compiler_flags'
           # Don't fix this by using the ld -exported_symbols_list flag, it doesn't exist in older darwin lds
-         archive_expsym_cmds_GCJ='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC -qmkshrobj $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-dylib_install_name ${wl}$rpath/$soname $verstring~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
+         archive_expsym_cmds_GCJ='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC -qmkshrobj $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-dylib_install_name ${wl}SW_PREFIX/lib/ccp4-5.99.5/$soname $verstring~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
           module_expsym_cmds_GCJ='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC $allow_undefined_flag  -o $lib -bundle $libobjs $deplibs$compiler_flags~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
           ;;
        *)
diff -ruN ccp4-5.99.5-orig/lib/fftw/configure ccp4-5.99.5/lib/fftw/configure
--- ccp4-5.99.5-orig/lib/fftw/configure	2005-11-30 15:22:13.000000000 -0800
+++ ccp4-5.99.5/lib/fftw/configure	2005-11-30 16:27:47.000000000 -0800
@@ -7501,27 +7501,27 @@
       link_all_deplibs=yes
     if test "$GCC" = yes ; then
     	output_verbose_link_cmd='echo'
-        archive_cmds='$CC -dynamiclib $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags -install_name $rpath/$soname $verstring'
+        archive_cmds='$CC -dynamiclib $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags -install_name SW_PREFIX/lib/ccp4-5.99.5/$soname $verstring'
       module_cmds='$CC $allow_undefined_flag -o $lib -bundle $libobjs $deplibs$compiler_flags'
       # Don't fix this by using the ld -exported_symbols_list flag, it doesn't exist in older darwin lds
-      archive_expsym_cmds='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC -dynamiclib $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags -install_name $rpath/$soname $verstring~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
+      archive_expsym_cmds='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC -dynamiclib $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags -install_name SW_PREFIX/lib/ccp4-5.99.5/$soname $verstring~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
       module_expsym_cmds='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC $allow_undefined_flag  -o $lib -bundle $libobjs $deplibs$compiler_flags~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
     else
       case $cc_basename in
         xlc* )
          output_verbose_link_cmd='echo'
-         archive_cmds='$CC -qmkshrobj $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-install_name ${wl}`echo $rpath/$soname` $verstring'
+         archive_cmds='$CC -qmkshrobj $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-install_name ${wl}`echo SW_PREFIX/lib/ccp4-5.99.5/$soname` $verstring'
          module_cmds='$CC $allow_undefined_flag -o $lib -bundle $libobjs $deplibs$compiler_flags'
           # Don't fix this by using the ld -exported_symbols_list flag, it doesn't exist in older darwin lds
-         archive_expsym_cmds='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC -qmkshrobj $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-install_name ${wl}$rpath/$soname $verstring~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
+         archive_expsym_cmds='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC -qmkshrobj $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-install_name ${wl}SW_PREFIX/lib/ccp4-5.99.5/$soname $verstring~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
           module_expsym_cmds='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC $allow_undefined_flag  -o $lib -bundle $libobjs $deplibs$compiler_flags~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
           ;;
         xlf* )
          output_verbose_link_cmd='echo'
-         archive_cmds='$CC -qmkshrobj $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-dylib_install_name ${wl}`echo $rpath/$soname` $verstring'
+         archive_cmds='$CC -qmkshrobj $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-dylib_install_name ${wl}`echo SW_PREFIX/lib/ccp4-5.99.5/$soname` $verstring'
          module_cmds='$CC $allow_undefined_flag -o $lib -bundle $libobjs $deplibs$compiler_flags'
           # Don't fix this by using the ld -exported_symbols_list flag, it doesn't exist in older darwin lds
-         archive_expsym_cmds='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC -qmkshrobj $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-dylib_install_name ${wl}$rpath/$soname $verstring~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
+         archive_expsym_cmds='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC -qmkshrobj $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-dylib_install_name ${wl}SW_PREFIX/lib/ccp4-5.99.5/$soname $verstring~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
           module_expsym_cmds='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC $allow_undefined_flag  -o $lib -bundle $libobjs $deplibs$compiler_flags~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
           ;;
        *)
@@ -10502,26 +10502,26 @@
        lt_int_apple_cc_single_mod=yes
       fi
       if test "X$lt_int_apple_cc_single_mod" = Xyes ; then
-       archive_cmds_CXX='$CC -dynamiclib -single_module $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags -install_name $rpath/$soname $verstring'
+       archive_cmds_CXX='$CC -dynamiclib -single_module $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags -install_name SW_PREFIX/lib/ccp4-5.99.5/$soname $verstring'
       else
-          archive_cmds_CXX='$CC -r -keep_private_externs -nostdlib -o ${lib}-master.o $libobjs~$CC -dynamiclib $allow_undefined_flag -o $lib ${lib}-master.o $deplibs $compiler_flags -install_name $rpath/$soname $verstring'
+          archive_cmds_CXX='$CC -r -keep_private_externs -nostdlib -o ${lib}-master.o $libobjs~$CC -dynamiclib $allow_undefined_flag -o $lib ${lib}-master.o $deplibs $compiler_flags -install_name SW_PREFIX/lib/ccp4-5.99.5/$soname $verstring'
         fi
         module_cmds_CXX='$CC $allow_undefined_flag -o $lib -bundle $libobjs $deplibs$compiler_flags'
         # Don't fix this by using the ld -exported_symbols_list flag, it doesn't exist in older darwin lds
           if test "X$lt_int_apple_cc_single_mod" = Xyes ; then
-            archive_expsym_cmds_CXX='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC -dynamiclib -single_module $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags -install_name $rpath/$soname $verstring~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
+            archive_expsym_cmds_CXX='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC -dynamiclib -single_module $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags -install_name SW_PREFIX/lib/ccp4-5.99.5/$soname $verstring~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
           else
-            archive_expsym_cmds_CXX='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC -r -keep_private_externs -nostdlib -o ${lib}-master.o $libobjs~$CC -dynamiclib $allow_undefined_flag -o $lib ${lib}-master.o $deplibs $compiler_flags -install_name $rpath/$soname $verstring~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
+            archive_expsym_cmds_CXX='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC -r -keep_private_externs -nostdlib -o ${lib}-master.o $libobjs~$CC -dynamiclib $allow_undefined_flag -o $lib ${lib}-master.o $deplibs $compiler_flags -install_name SW_PREFIX/lib/ccp4-5.99.5/$soname $verstring~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
           fi
             module_expsym_cmds_CXX='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC $allow_undefined_flag  -o $lib -bundle $libobjs $deplibs$compiler_flags~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
       else
       case $cc_basename in
         xlc*)
          output_verbose_link_cmd='echo'
-          archive_cmds_CXX='$CC -qmkshrobj ${wl}-single_module $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-install_name ${wl}`echo $rpath/$soname` $verstring'
+          archive_cmds_CXX='$CC -qmkshrobj ${wl}-single_module $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-install_name ${wl}`echo SW_PREFIX/lib/ccp4-5.99.5/$soname` $verstring'
           module_cmds_CXX='$CC $allow_undefined_flag -o $lib -bundle $libobjs $deplibs$compiler_flags'
           # Don't fix this by using the ld -exported_symbols_list flag, it doesn't exist in older darwin lds
-          archive_expsym_cmds_CXX='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC -qmkshrobj ${wl}-single_module $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-install_name ${wl}$rpath/$soname $verstring~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
+          archive_expsym_cmds_CXX='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC -qmkshrobj ${wl}-single_module $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-install_name ${wl}SW_PREFIX/lib/ccp4-5.99.5/$soname $verstring~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
           module_expsym_cmds_CXX='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC $allow_undefined_flag  -o $lib -bundle $libobjs $deplibs$compiler_flags~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
           ;;
        *)
@@ -14580,27 +14580,27 @@
       link_all_deplibs_F77=yes
     if test "$GCC" = yes ; then
     	output_verbose_link_cmd='echo'
-        archive_cmds_F77='$CC -dynamiclib $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags -install_name $rpath/$soname $verstring'
+        archive_cmds_F77='$CC -dynamiclib $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags -install_name SW_PREFIX/lib/ccp4-5.99.5/$soname $verstring'
       module_cmds_F77='$CC $allow_undefined_flag -o $lib -bundle $libobjs $deplibs$compiler_flags'
       # Don't fix this by using the ld -exported_symbols_list flag, it doesn't exist in older darwin lds
-      archive_expsym_cmds_F77='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC -dynamiclib $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags -install_name $rpath/$soname $verstring~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
+      archive_expsym_cmds_F77='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC -dynamiclib $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags -install_name SW_PREFIX/lib/ccp4-5.99.5/$soname $verstring~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
       module_expsym_cmds_F77='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC $allow_undefined_flag  -o $lib -bundle $libobjs $deplibs$compiler_flags~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
     else
       case $cc_basename in
         xlc* )
          output_verbose_link_cmd='echo'
-         archive_cmds_F77='$CC -qmkshrobj $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-install_name ${wl}`echo $rpath/$soname` $verstring'
+         archive_cmds_F77='$CC -qmkshrobj $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-install_name ${wl}`echo SW_PREFIX/lib/ccp4-5.99.5/$soname` $verstring'
          module_cmds_F77='$CC $allow_undefined_flag -o $lib -bundle $libobjs $deplibs$compiler_flags'
           # Don't fix this by using the ld -exported_symbols_list flag, it doesn't exist in older darwin lds
-         archive_expsym_cmds_F77='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC -qmkshrobj $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-install_name ${wl}$rpath/$soname $verstring~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
+         archive_expsym_cmds_F77='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC -qmkshrobj $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-install_name ${wl}SW_PREFIX/lib/ccp4-5.99.5/$soname $verstring~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
           module_expsym_cmds_F77='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC $allow_undefined_flag  -o $lib -bundle $libobjs $deplibs$compiler_flags~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
           ;;
         xlf* )
          output_verbose_link_cmd='echo'
-         archive_cmds_F77='$CC -qmkshrobj $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-dylib_install_name ${wl}`echo $rpath/$soname` $verstring'
+         archive_cmds_F77='$CC -qmkshrobj $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-dylib_install_name ${wl}`echo SW_PREFIX/lib/ccp4-5.99.5/$soname` $verstring'
          module_cmds_F77='$CC $allow_undefined_flag -o $lib -bundle $libobjs $deplibs$compiler_flags'
           # Don't fix this by using the ld -exported_symbols_list flag, it doesn't exist in older darwin lds
-         archive_expsym_cmds_F77='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC -qmkshrobj $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-dylib_install_name ${wl}$rpath/$soname $verstring~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
+         archive_expsym_cmds_F77='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC -qmkshrobj $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-dylib_install_name ${wl}SW_PREFIX/lib/ccp4-5.99.5/$soname $verstring~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
           module_expsym_cmds_F77='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC $allow_undefined_flag  -o $lib -bundle $libobjs $deplibs$compiler_flags~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
           ;;
        *)
@@ -17068,27 +17068,27 @@
       link_all_deplibs_GCJ=yes
     if test "$GCC" = yes ; then
     	output_verbose_link_cmd='echo'
-        archive_cmds_GCJ='$CC -dynamiclib $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags -install_name $rpath/$soname $verstring'
+        archive_cmds_GCJ='$CC -dynamiclib $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags -install_name SW_PREFIX/lib/ccp4-5.99.5/$soname $verstring'
       module_cmds_GCJ='$CC $allow_undefined_flag -o $lib -bundle $libobjs $deplibs$compiler_flags'
       # Don't fix this by using the ld -exported_symbols_list flag, it doesn't exist in older darwin lds
-      archive_expsym_cmds_GCJ='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC -dynamiclib $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags -install_name $rpath/$soname $verstring~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
+      archive_expsym_cmds_GCJ='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC -dynamiclib $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags -install_name SW_PREFIX/lib/ccp4-5.99.5/$soname $verstring~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
       module_expsym_cmds_GCJ='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC $allow_undefined_flag  -o $lib -bundle $libobjs $deplibs$compiler_flags~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
     else
       case $cc_basename in
         xlc* )
          output_verbose_link_cmd='echo'
-         archive_cmds_GCJ='$CC -qmkshrobj $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-install_name ${wl}`echo $rpath/$soname` $verstring'
+         archive_cmds_GCJ='$CC -qmkshrobj $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-install_name ${wl}`echo SW_PREFIX/lib/ccp4-5.99.5/$soname` $verstring'
          module_cmds_GCJ='$CC $allow_undefined_flag -o $lib -bundle $libobjs $deplibs$compiler_flags'
           # Don't fix this by using the ld -exported_symbols_list flag, it doesn't exist in older darwin lds
-         archive_expsym_cmds_GCJ='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC -qmkshrobj $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-install_name ${wl}$rpath/$soname $verstring~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
+         archive_expsym_cmds_GCJ='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC -qmkshrobj $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-install_name ${wl}SW_PREFIX/lib/ccp4-5.99.5/$soname $verstring~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
           module_expsym_cmds_GCJ='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC $allow_undefined_flag  -o $lib -bundle $libobjs $deplibs$compiler_flags~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
           ;;
         xlf* )
          output_verbose_link_cmd='echo'
-         archive_cmds_GCJ='$CC -qmkshrobj $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-dylib_install_name ${wl}`echo $rpath/$soname` $verstring'
+         archive_cmds_GCJ='$CC -qmkshrobj $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-dylib_install_name ${wl}`echo SW_PREFIX/lib/ccp4-5.99.5/$soname` $verstring'
          module_cmds_GCJ='$CC $allow_undefined_flag -o $lib -bundle $libobjs $deplibs$compiler_flags'
           # Don't fix this by using the ld -exported_symbols_list flag, it doesn't exist in older darwin lds
-         archive_expsym_cmds_GCJ='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC -qmkshrobj $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-dylib_install_name ${wl}$rpath/$soname $verstring~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
+         archive_expsym_cmds_GCJ='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC -qmkshrobj $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-dylib_install_name ${wl}SW_PREFIX/lib/ccp4-5.99.5/$soname $verstring~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
           module_expsym_cmds_GCJ='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC $allow_undefined_flag  -o $lib -bundle $libobjs $deplibs$compiler_flags~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
           ;;
        *)
diff -ruN ccp4-5.99.5-orig/lib/src/g2c.h ccp4-5.99.5/lib/src/g2c.h
--- ccp4-5.99.5-orig/lib/src/g2c.h	1969-12-31 16:00:00.000000000 -0800
+++ ccp4-5.99.5/lib/src/g2c.h	2005-11-30 16:27:29.000000000 -0800
@@ -0,0 +1,385 @@
+/* f2c.h  --  Standard Fortran to C header file */
+
+/**  barf  [ba:rf]  2.  "He suggested using FORTRAN, and everybody barfed."
+
+	- From The Shogakukan DICTIONARY OF NEW ENGLISH (Second edition) */
+
+#ifndef F2C_INCLUDE
+#define F2C_INCLUDE
+
+typedef long int integer;
+typedef unsigned long int uinteger;
+typedef char *address;
+typedef short int shortint;
+typedef float real;
+typedef double doublereal;
+typedef struct { real r, i; } complex;
+typedef struct { doublereal r, i; } doublecomplex;
+typedef long int logical;
+typedef short int shortlogical;
+typedef char logical1;
+typedef char integer1;
+#ifdef INTEGER_STAR_8	/* Adjust for integer*8. */
+typedef long long longint;		/* system-dependent */
+typedef unsigned long long ulongint;	/* system-dependent */
+#define qbit_clear(a,b)	((a) & ~((ulongint)1 << (b)))
+#define qbit_set(a,b)	((a) |  ((ulongint)1 << (b)))
+#endif
+
+#define TRUE_ (1)
+#define FALSE_ (0)
+
+/* Extern is for use with -E */
+#ifndef Extern
+#define Extern extern
+#endif
+
+/* I/O stuff */
+
+#ifdef f2c_i2
+/* for -i2 */
+typedef short flag;
+typedef short ftnlen;
+typedef short ftnint;
+#else
+typedef long int flag;
+typedef long int ftnlen;
+typedef long int ftnint;
+#endif
+
+/*external read, write*/
+typedef struct
+{	flag cierr;
+	ftnint ciunit;
+	flag ciend;
+	char *cifmt;
+	ftnint cirec;
+} cilist;
+
+/*internal read, write*/
+typedef struct
+{	flag icierr;
+	char *iciunit;
+	flag iciend;
+	char *icifmt;
+	ftnint icirlen;
+	ftnint icirnum;
+} icilist;
+
+/*open*/
+typedef struct
+{	flag oerr;
+	ftnint ounit;
+	char *ofnm;
+	ftnlen ofnmlen;
+	char *osta;
+	char *oacc;
+	char *ofm;
+	ftnint orl;
+	char *oblnk;
+} olist;
+
+/*close*/
+typedef struct
+{	flag cerr;
+	ftnint cunit;
+	char *csta;
+} cllist;
+
+/*rewind, backspace, endfile*/
+typedef struct
+{	flag aerr;
+	ftnint aunit;
+} alist;
+
+/* inquire */
+typedef struct
+{	flag inerr;
+	ftnint inunit;
+	char *infile;
+	ftnlen infilen;
+	ftnint	*inex;	/*parameters in standard's order*/
+	ftnint	*inopen;
+	ftnint	*innum;
+	ftnint	*innamed;
+	char	*inname;
+	ftnlen	innamlen;
+	char	*inacc;
+	ftnlen	inacclen;
+	char	*inseq;
+	ftnlen	inseqlen;
+	char 	*indir;
+	ftnlen	indirlen;
+	char	*infmt;
+	ftnlen	infmtlen;
+	char	*inform;
+	ftnint	informlen;
+	char	*inunf;
+	ftnlen	inunflen;
+	ftnint	*inrecl;
+	ftnint	*innrec;
+	char	*inblank;
+	ftnlen	inblanklen;
+} inlist;
+
+#define VOID void
+
+union Multitype {	/* for multiple entry points */
+	integer1 g;
+	shortint h;
+	integer i;
+	/* longint j; */
+	real r;
+	doublereal d;
+	complex c;
+	doublecomplex z;
+	};
+
+typedef union Multitype Multitype;
+
+/*typedef long int Long;*/	/* No longer used; formerly in Namelist */
+
+struct Vardesc {	/* for Namelist */
+	char *name;
+	char *addr;
+	ftnlen *dims;
+	int  type;
+	};
+typedef struct Vardesc Vardesc;
+
+struct Namelist {
+	char *name;
+	Vardesc **vars;
+	int nvars;
+	};
+typedef struct Namelist Namelist;
+
+#define abs(x) ((x) >= 0 ? (x) : -(x))
+#define dabs(x) (doublereal)abs(x)
+#define min(a,b) ((a) <= (b) ? (a) : (b))
+#define max(a,b) ((a) >= (b) ? (a) : (b))
+#define dmin(a,b) (doublereal)min(a,b)
+#define dmax(a,b) (doublereal)max(a,b)
+#define bit_test(a,b)	((a) >> (b) & 1)
+#define bit_clear(a,b)	((a) & ~((uinteger)1 << (b)))
+#define bit_set(a,b)	((a) |  ((uinteger)1 << (b)))
+
+/* procedure parameter types for -A and -C++ */
+
+#define F2C_proc_par_types 1
+#ifdef __cplusplus
+typedef int /* Unknown procedure type */ (*U_fp)(...);
+typedef shortint (*J_fp)(...);
+typedef integer (*I_fp)(...);
+typedef real (*R_fp)(...);
+typedef doublereal (*D_fp)(...), (*E_fp)(...);
+typedef /* Complex */ VOID (*C_fp)(...);
+typedef /* Double Complex */ VOID (*Z_fp)(...);
+typedef logical (*L_fp)(...);
+typedef shortlogical (*K_fp)(...);
+typedef /* Character */ VOID (*H_fp)(...);
+typedef /* Subroutine */ int (*S_fp)(...);
+#else
+typedef int /* Unknown procedure type */ (*U_fp)();
+typedef shortint (*J_fp)();
+typedef integer (*I_fp)();
+typedef real (*R_fp)();
+typedef doublereal (*D_fp)(), (*E_fp)();
+typedef /* Complex */ VOID (*C_fp)();
+typedef /* Double Complex */ VOID (*Z_fp)();
+typedef logical (*L_fp)();
+typedef shortlogical (*K_fp)();
+typedef /* Character */ VOID (*H_fp)();
+typedef /* Subroutine */ int (*S_fp)();
+#endif
+/* E_fp is for real functions when -R is not specified */
+typedef VOID C_f;	/* complex function */
+typedef VOID H_f;	/* character function */
+typedef VOID Z_f;	/* double complex function */
+typedef doublereal E_f;	/* real function with -R not specified */
+
+/* undef any lower-case symbols that your C compiler predefines, e.g.: */
+
+#ifndef Skip_f2c_Undefs
+#undef cray
+#undef gcos
+#undef mc68010
+#undef mc68020
+#undef mips
+#undef pdp11
+#undef sgi
+#undef sparc
+#undef sun
+#undef sun2
+#undef sun3
+#undef sun4
+#undef u370
+#undef u3b
+#undef u3b2
+#undef u3b5
+#undef unix
+#undef vax
+#endif
+#endif
+/* If you are using a C++ compiler, append the following to f2c.h
+   for compiling libF77 and libI77. */
+
+#ifdef __cplusplus
+extern "C" {
+extern int abort_(void);
+extern double c_abs(complex *);
+extern void c_cos(complex *, complex *);
+extern void c_div(complex *, complex *, complex *);
+extern void c_exp(complex *, complex *);
+extern void c_log(complex *, complex *);
+extern void c_sin(complex *, complex *);
+extern void c_sqrt(complex *, complex *);
+extern double d_abs(double *);
+extern double d_acos(double *);
+extern double d_asin(double *);
+extern double d_atan(double *);
+extern double d_atn2(double *, double *);
+extern void d_cnjg(doublecomplex *, doublecomplex *);
+extern double d_cos(double *);
+extern double d_cosh(double *);
+extern double d_dim(double *, double *);
+extern double d_exp(double *);
+extern double d_imag(doublecomplex *);
+extern double d_int(double *);
+extern double d_lg10(double *);
+extern double d_log(double *);
+extern double d_mod(double *, double *);
+extern double d_nint(double *);
+extern double d_prod(float *, float *);
+extern double d_sign(double *, double *);
+extern double d_sin(double *);
+extern double d_sinh(double *);
+extern double d_sqrt(double *);
+extern double d_tan(double *);
+extern double d_tanh(double *);
+extern double derf_(double *);
+extern double derfc_(double *);
+extern integer do_fio(ftnint *, char *, ftnlen);
+extern integer do_lio(ftnint *, ftnint *, char *, ftnlen);
+extern integer do_uio(ftnint *, char *, ftnlen);
+extern integer e_rdfe(void);
+extern integer e_rdue(void);
+extern integer e_rsfe(void);
+extern integer e_rsfi(void);
+extern integer e_rsle(void);
+extern integer e_rsli(void);
+extern integer e_rsue(void);
+extern integer e_wdfe(void);
+extern integer e_wdue(void);
+extern integer e_wsfe(void);
+extern integer e_wsfi(void);
+extern integer e_wsle(void);
+extern integer e_wsli(void);
+extern integer e_wsue(void);
+extern int ef1asc_(ftnint *, ftnlen *, ftnint *, ftnlen *);
+extern integer ef1cmc_(ftnint *, ftnlen *, ftnint *, ftnlen *);
+extern double erf(double);
+extern double erf_(float *);
+extern double erfc(double);
+extern double erfc_(float *);
+extern integer f_back(alist *);
+extern integer f_clos(cllist *);
+extern integer f_end(alist *);
+extern void f_exit(void);
+extern integer f_inqu(inlist *);
+extern integer f_open(olist *);
+extern integer f_rew(alist *);
+extern int flush_(void);
+extern void getarg_(integer *, char *, ftnlen);
+extern void getenv_(char *, char *, ftnlen, ftnlen);
+extern short h_abs(short *);
+extern short h_dim(short *, short *);
+extern short h_dnnt(double *);
+extern short h_indx(char *, char *, ftnlen, ftnlen);
+extern short h_len(char *, ftnlen);
+extern short h_mod(short *, short *);
+extern short h_nint(float *);
+extern short h_sign(short *, short *);
+extern short hl_ge(char *, char *, ftnlen, ftnlen);
+extern short hl_gt(char *, char *, ftnlen, ftnlen);
+extern short hl_le(char *, char *, ftnlen, ftnlen);
+extern short hl_lt(char *, char *, ftnlen, ftnlen);
+extern integer i_abs(integer *);
+extern integer i_dim(integer *, integer *);
+extern integer i_dnnt(double *);
+extern integer i_indx(char *, char *, ftnlen, ftnlen);
+extern integer i_len(char *, ftnlen);
+extern integer i_mod(integer *, integer *);
+extern integer i_nint(float *);
+extern integer i_sign(integer *, integer *);
+extern integer iargc_(void);
+extern ftnlen l_ge(char *, char *, ftnlen, ftnlen);
+extern ftnlen l_gt(char *, char *, ftnlen, ftnlen);
+extern ftnlen l_le(char *, char *, ftnlen, ftnlen);
+extern ftnlen l_lt(char *, char *, ftnlen, ftnlen);
+extern void pow_ci(complex *, complex *, integer *);
+extern double pow_dd(double *, double *);
+extern double pow_di(double *, integer *);
+extern short pow_hh(short *, shortint *);
+extern integer pow_ii(integer *, integer *);
+extern double pow_ri(float *, integer *);
+extern void pow_zi(doublecomplex *, doublecomplex *, integer *);
+extern void pow_zz(doublecomplex *, doublecomplex *, doublecomplex *);
+extern double r_abs(float *);
+extern double r_acos(float *);
+extern double r_asin(float *);
+extern double r_atan(float *);
+extern double r_atn2(float *, float *);
+extern void r_cnjg(complex *, complex *);
+extern double r_cos(float *);
+extern double r_cosh(float *);
+extern double r_dim(float *, float *);
+extern double r_exp(float *);
+extern double r_imag(complex *);
+extern double r_int(float *);
+extern double r_lg10(float *);
+extern double r_log(float *);
+extern double r_mod(float *, float *);
+extern double r_nint(float *);
+extern double r_sign(float *, float *);
+extern double r_sin(float *);
+extern double r_sinh(float *);
+extern double r_sqrt(float *);
+extern double r_tan(float *);
+extern double r_tanh(float *);
+extern void s_cat(char *, char **, integer *, integer *, ftnlen);
+extern integer s_cmp(char *, char *, ftnlen, ftnlen);
+extern void s_copy(char *, char *, ftnlen, ftnlen);
+extern int s_paus(char *, ftnlen);
+extern integer s_rdfe(cilist *);
+extern integer s_rdue(cilist *);
+extern integer s_rnge(char *, integer, char *, integer);
+extern integer s_rsfe(cilist *);
+extern integer s_rsfi(icilist *);
+extern integer s_rsle(cilist *);
+extern integer s_rsli(icilist *);
+extern integer s_rsne(cilist *);
+extern integer s_rsni(icilist *);
+extern integer s_rsue(cilist *);
+extern int s_stop(char *, ftnlen);
+extern integer s_wdfe(cilist *);
+extern integer s_wdue(cilist *);
+extern integer s_wsfe(cilist *);
+extern integer s_wsfi(icilist *);
+extern integer s_wsle(cilist *);
+extern integer s_wsli(icilist *);
+extern integer s_wsne(cilist *);
+extern integer s_wsni(icilist *);
+extern integer s_wsue(cilist *);
+extern void sig_die(char *, int);
+extern integer signal_(integer *, void (*)(int));
+extern integer system_(char *, ftnlen);
+extern double z_abs(doublecomplex *);
+extern void z_cos(doublecomplex *, doublecomplex *);
+extern void z_div(doublecomplex *, doublecomplex *, doublecomplex *);
+extern void z_exp(doublecomplex *, doublecomplex *);
+extern void z_log(doublecomplex *, doublecomplex *);
+extern void z_sin(doublecomplex *, doublecomplex *);
+extern void z_sqrt(doublecomplex *, doublecomplex *);
+	}
+#endif
diff -ruN ccp4-5.99.5-orig/lib/ssm/configure ccp4-5.99.5/lib/ssm/configure
--- ccp4-5.99.5-orig/lib/ssm/configure	2005-11-30 15:22:14.000000000 -0800
+++ ccp4-5.99.5/lib/ssm/configure	2005-11-30 16:27:47.000000000 -0800
@@ -7138,27 +7138,27 @@
       link_all_deplibs=yes
     if test "$GCC" = yes ; then
     	output_verbose_link_cmd='echo'
-        archive_cmds='$CC -dynamiclib $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags -install_name $rpath/$soname $verstring'
+        archive_cmds='$CC -dynamiclib $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags -install_name SW_PREFIX/lib/ccp4-5.99.5/$soname $verstring'
       module_cmds='$CC $allow_undefined_flag -o $lib -bundle $libobjs $deplibs$compiler_flags'
       # Don't fix this by using the ld -exported_symbols_list flag, it doesn't exist in older darwin lds
-      archive_expsym_cmds='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC -dynamiclib $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags -install_name $rpath/$soname $verstring~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
+      archive_expsym_cmds='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC -dynamiclib $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags -install_name SW_PREFIX/lib/ccp4-5.99.5/$soname $verstring~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
       module_expsym_cmds='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC $allow_undefined_flag  -o $lib -bundle $libobjs $deplibs$compiler_flags~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
     else
       case $cc_basename in
         xlc* )
          output_verbose_link_cmd='echo'
-         archive_cmds='$CC -qmkshrobj $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-install_name ${wl}`echo $rpath/$soname` $verstring'
+         archive_cmds='$CC -qmkshrobj $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-install_name ${wl}`echo SW_PREFIX/lib/ccp4-5.99.5/$soname` $verstring'
          module_cmds='$CC $allow_undefined_flag -o $lib -bundle $libobjs $deplibs$compiler_flags'
           # Don't fix this by using the ld -exported_symbols_list flag, it doesn't exist in older darwin lds
-         archive_expsym_cmds='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC -qmkshrobj $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-install_name ${wl}$rpath/$soname $verstring~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
+         archive_expsym_cmds='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC -qmkshrobj $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-install_name ${wl}SW_PREFIX/lib/ccp4-5.99.5/$soname $verstring~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
           module_expsym_cmds='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC $allow_undefined_flag  -o $lib -bundle $libobjs $deplibs$compiler_flags~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
           ;;
         xlf* )
          output_verbose_link_cmd='echo'
-         archive_cmds='$CC -qmkshrobj $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-dylib_install_name ${wl}`echo $rpath/$soname` $verstring'
+         archive_cmds='$CC -qmkshrobj $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-dylib_install_name ${wl}`echo SW_PREFIX/lib/ccp4-5.99.5/$soname` $verstring'
          module_cmds='$CC $allow_undefined_flag -o $lib -bundle $libobjs $deplibs$compiler_flags'
           # Don't fix this by using the ld -exported_symbols_list flag, it doesn't exist in older darwin lds
-         archive_expsym_cmds='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC -qmkshrobj $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-dylib_install_name ${wl}$rpath/$soname $verstring~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
+         archive_expsym_cmds='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC -qmkshrobj $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-dylib_install_name ${wl}SW_PREFIX/lib/ccp4-5.99.5/$soname $verstring~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
           module_expsym_cmds='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC $allow_undefined_flag  -o $lib -bundle $libobjs $deplibs$compiler_flags~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
           ;;
        *)
@@ -10139,26 +10139,26 @@
        lt_int_apple_cc_single_mod=yes
       fi
       if test "X$lt_int_apple_cc_single_mod" = Xyes ; then
-       archive_cmds_CXX='$CC -dynamiclib -single_module $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags -install_name $rpath/$soname $verstring'
+       archive_cmds_CXX='$CC -dynamiclib -single_module $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags -install_name SW_PREFIX/lib/ccp4-5.99.5/$soname $verstring'
       else
-          archive_cmds_CXX='$CC -r -keep_private_externs -nostdlib -o ${lib}-master.o $libobjs~$CC -dynamiclib $allow_undefined_flag -o $lib ${lib}-master.o $deplibs $compiler_flags -install_name $rpath/$soname $verstring'
+          archive_cmds_CXX='$CC -r -keep_private_externs -nostdlib -o ${lib}-master.o $libobjs~$CC -dynamiclib $allow_undefined_flag -o $lib ${lib}-master.o $deplibs $compiler_flags -install_name SW_PREFIX/lib/ccp4-5.99.5/$soname $verstring'
         fi
         module_cmds_CXX='$CC $allow_undefined_flag -o $lib -bundle $libobjs $deplibs$compiler_flags'
         # Don't fix this by using the ld -exported_symbols_list flag, it doesn't exist in older darwin lds
           if test "X$lt_int_apple_cc_single_mod" = Xyes ; then
-            archive_expsym_cmds_CXX='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC -dynamiclib -single_module $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags -install_name $rpath/$soname $verstring~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
+            archive_expsym_cmds_CXX='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC -dynamiclib -single_module $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags -install_name SW_PREFIX/lib/ccp4-5.99.5/$soname $verstring~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
           else
-            archive_expsym_cmds_CXX='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC -r -keep_private_externs -nostdlib -o ${lib}-master.o $libobjs~$CC -dynamiclib $allow_undefined_flag -o $lib ${lib}-master.o $deplibs $compiler_flags -install_name $rpath/$soname $verstring~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
+            archive_expsym_cmds_CXX='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC -r -keep_private_externs -nostdlib -o ${lib}-master.o $libobjs~$CC -dynamiclib $allow_undefined_flag -o $lib ${lib}-master.o $deplibs $compiler_flags -install_name SW_PREFIX/lib/ccp4-5.99.5/$soname $verstring~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
           fi
             module_expsym_cmds_CXX='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC $allow_undefined_flag  -o $lib -bundle $libobjs $deplibs$compiler_flags~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
       else
       case $cc_basename in
         xlc*)
          output_verbose_link_cmd='echo'
-          archive_cmds_CXX='$CC -qmkshrobj ${wl}-single_module $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-install_name ${wl}`echo $rpath/$soname` $verstring'
+          archive_cmds_CXX='$CC -qmkshrobj ${wl}-single_module $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-install_name ${wl}`echo SW_PREFIX/lib/ccp4-5.99.5/$soname` $verstring'
           module_cmds_CXX='$CC $allow_undefined_flag -o $lib -bundle $libobjs $deplibs$compiler_flags'
           # Don't fix this by using the ld -exported_symbols_list flag, it doesn't exist in older darwin lds
-          archive_expsym_cmds_CXX='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC -qmkshrobj ${wl}-single_module $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-install_name ${wl}$rpath/$soname $verstring~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
+          archive_expsym_cmds_CXX='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC -qmkshrobj ${wl}-single_module $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-install_name ${wl}SW_PREFIX/lib/ccp4-5.99.5/$soname $verstring~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
           module_expsym_cmds_CXX='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC $allow_undefined_flag  -o $lib -bundle $libobjs $deplibs$compiler_flags~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
           ;;
        *)
@@ -14217,27 +14217,27 @@
       link_all_deplibs_F77=yes
     if test "$GCC" = yes ; then
     	output_verbose_link_cmd='echo'
-        archive_cmds_F77='$CC -dynamiclib $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags -install_name $rpath/$soname $verstring'
+        archive_cmds_F77='$CC -dynamiclib $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags -install_name SW_PREFIX/lib/ccp4-5.99.5/$soname $verstring'
       module_cmds_F77='$CC $allow_undefined_flag -o $lib -bundle $libobjs $deplibs$compiler_flags'
       # Don't fix this by using the ld -exported_symbols_list flag, it doesn't exist in older darwin lds
-      archive_expsym_cmds_F77='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC -dynamiclib $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags -install_name $rpath/$soname $verstring~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
+      archive_expsym_cmds_F77='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC -dynamiclib $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags -install_name SW_PREFIX/lib/ccp4-5.99.5/$soname $verstring~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
       module_expsym_cmds_F77='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC $allow_undefined_flag  -o $lib -bundle $libobjs $deplibs$compiler_flags~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
     else
       case $cc_basename in
         xlc* )
          output_verbose_link_cmd='echo'
-         archive_cmds_F77='$CC -qmkshrobj $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-install_name ${wl}`echo $rpath/$soname` $verstring'
+         archive_cmds_F77='$CC -qmkshrobj $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-install_name ${wl}`echo SW_PREFIX/lib/ccp4-5.99.5/$soname` $verstring'
          module_cmds_F77='$CC $allow_undefined_flag -o $lib -bundle $libobjs $deplibs$compiler_flags'
           # Don't fix this by using the ld -exported_symbols_list flag, it doesn't exist in older darwin lds
-         archive_expsym_cmds_F77='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC -qmkshrobj $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-install_name ${wl}$rpath/$soname $verstring~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
+         archive_expsym_cmds_F77='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC -qmkshrobj $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-install_name ${wl}SW_PREFIX/lib/ccp4-5.99.5/$soname $verstring~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
           module_expsym_cmds_F77='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC $allow_undefined_flag  -o $lib -bundle $libobjs $deplibs$compiler_flags~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
           ;;
         xlf* )
          output_verbose_link_cmd='echo'
-         archive_cmds_F77='$CC -qmkshrobj $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-dylib_install_name ${wl}`echo $rpath/$soname` $verstring'
+         archive_cmds_F77='$CC -qmkshrobj $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-dylib_install_name ${wl}`echo SW_PREFIX/lib/ccp4-5.99.5/$soname` $verstring'
          module_cmds_F77='$CC $allow_undefined_flag -o $lib -bundle $libobjs $deplibs$compiler_flags'
           # Don't fix this by using the ld -exported_symbols_list flag, it doesn't exist in older darwin lds
-         archive_expsym_cmds_F77='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC -qmkshrobj $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-dylib_install_name ${wl}$rpath/$soname $verstring~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
+         archive_expsym_cmds_F77='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC -qmkshrobj $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-dylib_install_name ${wl}SW_PREFIX/lib/ccp4-5.99.5/$soname $verstring~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
           module_expsym_cmds_F77='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC $allow_undefined_flag  -o $lib -bundle $libobjs $deplibs$compiler_flags~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
           ;;
        *)
@@ -16705,27 +16705,27 @@
       link_all_deplibs_GCJ=yes
     if test "$GCC" = yes ; then
     	output_verbose_link_cmd='echo'
-        archive_cmds_GCJ='$CC -dynamiclib $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags -install_name $rpath/$soname $verstring'
+        archive_cmds_GCJ='$CC -dynamiclib $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags -install_name SW_PREFIX/lib/ccp4-5.99.5/$soname $verstring'
       module_cmds_GCJ='$CC $allow_undefined_flag -o $lib -bundle $libobjs $deplibs$compiler_flags'
       # Don't fix this by using the ld -exported_symbols_list flag, it doesn't exist in older darwin lds
-      archive_expsym_cmds_GCJ='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC -dynamiclib $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags -install_name $rpath/$soname $verstring~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
+      archive_expsym_cmds_GCJ='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC -dynamiclib $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags -install_name SW_PREFIX/lib/ccp4-5.99.5/$soname $verstring~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
       module_expsym_cmds_GCJ='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC $allow_undefined_flag  -o $lib -bundle $libobjs $deplibs$compiler_flags~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
     else
       case $cc_basename in
         xlc* )
          output_verbose_link_cmd='echo'
-         archive_cmds_GCJ='$CC -qmkshrobj $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-install_name ${wl}`echo $rpath/$soname` $verstring'
+         archive_cmds_GCJ='$CC -qmkshrobj $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-install_name ${wl}`echo SW_PREFIX/lib/ccp4-5.99.5/$soname` $verstring'
          module_cmds_GCJ='$CC $allow_undefined_flag -o $lib -bundle $libobjs $deplibs$compiler_flags'
           # Don't fix this by using the ld -exported_symbols_list flag, it doesn't exist in older darwin lds
-         archive_expsym_cmds_GCJ='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC -qmkshrobj $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-install_name ${wl}$rpath/$soname $verstring~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
+         archive_expsym_cmds_GCJ='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC -qmkshrobj $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-install_name ${wl}SW_PREFIX/lib/ccp4-5.99.5/$soname $verstring~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
           module_expsym_cmds_GCJ='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC $allow_undefined_flag  -o $lib -bundle $libobjs $deplibs$compiler_flags~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
           ;;
         xlf* )
          output_verbose_link_cmd='echo'
-         archive_cmds_GCJ='$CC -qmkshrobj $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-dylib_install_name ${wl}`echo $rpath/$soname` $verstring'
+         archive_cmds_GCJ='$CC -qmkshrobj $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-dylib_install_name ${wl}`echo SW_PREFIX/lib/ccp4-5.99.5/$soname` $verstring'
          module_cmds_GCJ='$CC $allow_undefined_flag -o $lib -bundle $libobjs $deplibs$compiler_flags'
           # Don't fix this by using the ld -exported_symbols_list flag, it doesn't exist in older darwin lds
-         archive_expsym_cmds_GCJ='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC -qmkshrobj $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-dylib_install_name ${wl}$rpath/$soname $verstring~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
+         archive_expsym_cmds_GCJ='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC -qmkshrobj $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-dylib_install_name ${wl}SW_PREFIX/lib/ccp4-5.99.5/$soname $verstring~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
           module_expsym_cmds_GCJ='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC $allow_undefined_flag  -o $lib -bundle $libobjs $deplibs$compiler_flags~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
           ;;
        *)
diff -ruN ccp4-5.99.5-orig/x-windows/Mosflm/jpg/configure ccp4-5.99.5/x-windows/Mosflm/jpg/configure
--- ccp4-5.99.5-orig/x-windows/Mosflm/jpg/configure	2005-11-30 15:22:19.000000000 -0800
+++ ccp4-5.99.5/x-windows/Mosflm/jpg/configure	2005-11-30 16:27:47.000000000 -0800
@@ -7152,27 +7152,27 @@
       link_all_deplibs=yes
     if test "$GCC" = yes ; then
     	output_verbose_link_cmd='echo'
-        archive_cmds='$CC -dynamiclib $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags -install_name $rpath/$soname $verstring'
+        archive_cmds='$CC -dynamiclib $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags -install_name SW_PREFIX/lib/ccp4-5.99.5/$soname $verstring'
       module_cmds='$CC $allow_undefined_flag -o $lib -bundle $libobjs $deplibs$compiler_flags'
       # Don't fix this by using the ld -exported_symbols_list flag, it doesn't exist in older darwin lds
-      archive_expsym_cmds='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC -dynamiclib $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags -install_name $rpath/$soname $verstring~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
+      archive_expsym_cmds='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC -dynamiclib $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags -install_name SW_PREFIX/lib/ccp4-5.99.5/$soname $verstring~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
       module_expsym_cmds='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC $allow_undefined_flag  -o $lib -bundle $libobjs $deplibs$compiler_flags~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
     else
       case $cc_basename in
         xlc* )
          output_verbose_link_cmd='echo'
-         archive_cmds='$CC -qmkshrobj $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-install_name ${wl}`echo $rpath/$soname` $verstring'
+         archive_cmds='$CC -qmkshrobj $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-install_name ${wl}`echo SW_PREFIX/lib/ccp4-5.99.5/$soname` $verstring'
          module_cmds='$CC $allow_undefined_flag -o $lib -bundle $libobjs $deplibs$compiler_flags'
           # Don't fix this by using the ld -exported_symbols_list flag, it doesn't exist in older darwin lds
-         archive_expsym_cmds='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC -qmkshrobj $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-install_name ${wl}$rpath/$soname $verstring~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
+         archive_expsym_cmds='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC -qmkshrobj $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-install_name ${wl}SW_PREFIX/lib/ccp4-5.99.5/$soname $verstring~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
           module_expsym_cmds='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC $allow_undefined_flag  -o $lib -bundle $libobjs $deplibs$compiler_flags~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
           ;;
         xlf* )
          output_verbose_link_cmd='echo'
-         archive_cmds='$CC -qmkshrobj $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-dylib_install_name ${wl}`echo $rpath/$soname` $verstring'
+         archive_cmds='$CC -qmkshrobj $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-dylib_install_name ${wl}`echo SW_PREFIX/lib/ccp4-5.99.5/$soname` $verstring'
          module_cmds='$CC $allow_undefined_flag -o $lib -bundle $libobjs $deplibs$compiler_flags'
           # Don't fix this by using the ld -exported_symbols_list flag, it doesn't exist in older darwin lds
-         archive_expsym_cmds='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC -qmkshrobj $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-dylib_install_name ${wl}$rpath/$soname $verstring~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
+         archive_expsym_cmds='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC -qmkshrobj $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-dylib_install_name ${wl}SW_PREFIX/lib/ccp4-5.99.5/$soname $verstring~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
           module_expsym_cmds='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC $allow_undefined_flag  -o $lib -bundle $libobjs $deplibs$compiler_flags~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
           ;;
        *)
@@ -10153,26 +10153,26 @@
        lt_int_apple_cc_single_mod=yes
       fi
       if test "X$lt_int_apple_cc_single_mod" = Xyes ; then
-       archive_cmds_CXX='$CC -dynamiclib -single_module $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags -install_name $rpath/$soname $verstring'
+       archive_cmds_CXX='$CC -dynamiclib -single_module $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags -install_name SW_PREFIX/lib/ccp4-5.99.5/$soname $verstring'
       else
-          archive_cmds_CXX='$CC -r -keep_private_externs -nostdlib -o ${lib}-master.o $libobjs~$CC -dynamiclib $allow_undefined_flag -o $lib ${lib}-master.o $deplibs $compiler_flags -install_name $rpath/$soname $verstring'
+          archive_cmds_CXX='$CC -r -keep_private_externs -nostdlib -o ${lib}-master.o $libobjs~$CC -dynamiclib $allow_undefined_flag -o $lib ${lib}-master.o $deplibs $compiler_flags -install_name SW_PREFIX/lib/ccp4-5.99.5/$soname $verstring'
         fi
         module_cmds_CXX='$CC $allow_undefined_flag -o $lib -bundle $libobjs $deplibs$compiler_flags'
         # Don't fix this by using the ld -exported_symbols_list flag, it doesn't exist in older darwin lds
           if test "X$lt_int_apple_cc_single_mod" = Xyes ; then
-            archive_expsym_cmds_CXX='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC -dynamiclib -single_module $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags -install_name $rpath/$soname $verstring~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
+            archive_expsym_cmds_CXX='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC -dynamiclib -single_module $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags -install_name SW_PREFIX/lib/ccp4-5.99.5/$soname $verstring~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
           else
-            archive_expsym_cmds_CXX='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC -r -keep_private_externs -nostdlib -o ${lib}-master.o $libobjs~$CC -dynamiclib $allow_undefined_flag -o $lib ${lib}-master.o $deplibs $compiler_flags -install_name $rpath/$soname $verstring~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
+            archive_expsym_cmds_CXX='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC -r -keep_private_externs -nostdlib -o ${lib}-master.o $libobjs~$CC -dynamiclib $allow_undefined_flag -o $lib ${lib}-master.o $deplibs $compiler_flags -install_name SW_PREFIX/lib/ccp4-5.99.5/$soname $verstring~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
           fi
             module_expsym_cmds_CXX='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC $allow_undefined_flag  -o $lib -bundle $libobjs $deplibs$compiler_flags~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
       else
       case $cc_basename in
         xlc*)
          output_verbose_link_cmd='echo'
-          archive_cmds_CXX='$CC -qmkshrobj ${wl}-single_module $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-install_name ${wl}`echo $rpath/$soname` $verstring'
+          archive_cmds_CXX='$CC -qmkshrobj ${wl}-single_module $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-install_name ${wl}`echo SW_PREFIX/lib/ccp4-5.99.5/$soname` $verstring'
           module_cmds_CXX='$CC $allow_undefined_flag -o $lib -bundle $libobjs $deplibs$compiler_flags'
           # Don't fix this by using the ld -exported_symbols_list flag, it doesn't exist in older darwin lds
-          archive_expsym_cmds_CXX='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC -qmkshrobj ${wl}-single_module $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-install_name ${wl}$rpath/$soname $verstring~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
+          archive_expsym_cmds_CXX='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC -qmkshrobj ${wl}-single_module $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-install_name ${wl}SW_PREFIX/lib/ccp4-5.99.5/$soname $verstring~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
           module_expsym_cmds_CXX='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC $allow_undefined_flag  -o $lib -bundle $libobjs $deplibs$compiler_flags~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
           ;;
        *)
@@ -14231,27 +14231,27 @@
       link_all_deplibs_F77=yes
     if test "$GCC" = yes ; then
     	output_verbose_link_cmd='echo'
-        archive_cmds_F77='$CC -dynamiclib $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags -install_name $rpath/$soname $verstring'
+        archive_cmds_F77='$CC -dynamiclib $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags -install_name SW_PREFIX/lib/ccp4-5.99.5/$soname $verstring'
       module_cmds_F77='$CC $allow_undefined_flag -o $lib -bundle $libobjs $deplibs$compiler_flags'
       # Don't fix this by using the ld -exported_symbols_list flag, it doesn't exist in older darwin lds
-      archive_expsym_cmds_F77='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC -dynamiclib $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags -install_name $rpath/$soname $verstring~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
+      archive_expsym_cmds_F77='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC -dynamiclib $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags -install_name SW_PREFIX/lib/ccp4-5.99.5/$soname $verstring~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
       module_expsym_cmds_F77='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC $allow_undefined_flag  -o $lib -bundle $libobjs $deplibs$compiler_flags~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
     else
       case $cc_basename in
         xlc* )
          output_verbose_link_cmd='echo'
-         archive_cmds_F77='$CC -qmkshrobj $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-install_name ${wl}`echo $rpath/$soname` $verstring'
+         archive_cmds_F77='$CC -qmkshrobj $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-install_name ${wl}`echo SW_PREFIX/lib/ccp4-5.99.5/$soname` $verstring'
          module_cmds_F77='$CC $allow_undefined_flag -o $lib -bundle $libobjs $deplibs$compiler_flags'
           # Don't fix this by using the ld -exported_symbols_list flag, it doesn't exist in older darwin lds
-         archive_expsym_cmds_F77='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC -qmkshrobj $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-install_name ${wl}$rpath/$soname $verstring~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
+         archive_expsym_cmds_F77='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC -qmkshrobj $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-install_name ${wl}SW_PREFIX/lib/ccp4-5.99.5/$soname $verstring~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
           module_expsym_cmds_F77='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC $allow_undefined_flag  -o $lib -bundle $libobjs $deplibs$compiler_flags~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
           ;;
         xlf* )
          output_verbose_link_cmd='echo'
-         archive_cmds_F77='$CC -qmkshrobj $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-dylib_install_name ${wl}`echo $rpath/$soname` $verstring'
+         archive_cmds_F77='$CC -qmkshrobj $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-dylib_install_name ${wl}`echo SW_PREFIX/lib/ccp4-5.99.5/$soname` $verstring'
          module_cmds_F77='$CC $allow_undefined_flag -o $lib -bundle $libobjs $deplibs$compiler_flags'
           # Don't fix this by using the ld -exported_symbols_list flag, it doesn't exist in older darwin lds
-         archive_expsym_cmds_F77='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC -qmkshrobj $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-dylib_install_name ${wl}$rpath/$soname $verstring~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
+         archive_expsym_cmds_F77='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC -qmkshrobj $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-dylib_install_name ${wl}SW_PREFIX/lib/ccp4-5.99.5/$soname $verstring~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
           module_expsym_cmds_F77='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC $allow_undefined_flag  -o $lib -bundle $libobjs $deplibs$compiler_flags~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
           ;;
        *)
@@ -16719,27 +16719,27 @@
       link_all_deplibs_GCJ=yes
     if test "$GCC" = yes ; then
     	output_verbose_link_cmd='echo'
-        archive_cmds_GCJ='$CC -dynamiclib $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags -install_name $rpath/$soname $verstring'
+        archive_cmds_GCJ='$CC -dynamiclib $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags -install_name SW_PREFIX/lib/ccp4-5.99.5/$soname $verstring'
       module_cmds_GCJ='$CC $allow_undefined_flag -o $lib -bundle $libobjs $deplibs$compiler_flags'
       # Don't fix this by using the ld -exported_symbols_list flag, it doesn't exist in older darwin lds
-      archive_expsym_cmds_GCJ='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC -dynamiclib $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags -install_name $rpath/$soname $verstring~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
+      archive_expsym_cmds_GCJ='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC -dynamiclib $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags -install_name SW_PREFIX/lib/ccp4-5.99.5/$soname $verstring~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
       module_expsym_cmds_GCJ='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC $allow_undefined_flag  -o $lib -bundle $libobjs $deplibs$compiler_flags~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
     else
       case $cc_basename in
         xlc* )
          output_verbose_link_cmd='echo'
-         archive_cmds_GCJ='$CC -qmkshrobj $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-install_name ${wl}`echo $rpath/$soname` $verstring'
+         archive_cmds_GCJ='$CC -qmkshrobj $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-install_name ${wl}`echo SW_PREFIX/lib/ccp4-5.99.5/$soname` $verstring'
          module_cmds_GCJ='$CC $allow_undefined_flag -o $lib -bundle $libobjs $deplibs$compiler_flags'
           # Don't fix this by using the ld -exported_symbols_list flag, it doesn't exist in older darwin lds
-         archive_expsym_cmds_GCJ='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC -qmkshrobj $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-install_name ${wl}$rpath/$soname $verstring~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
+         archive_expsym_cmds_GCJ='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC -qmkshrobj $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-install_name ${wl}SW_PREFIX/lib/ccp4-5.99.5/$soname $verstring~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
           module_expsym_cmds_GCJ='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC $allow_undefined_flag  -o $lib -bundle $libobjs $deplibs$compiler_flags~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
           ;;
         xlf* )
          output_verbose_link_cmd='echo'
-         archive_cmds_GCJ='$CC -qmkshrobj $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-dylib_install_name ${wl}`echo $rpath/$soname` $verstring'
+         archive_cmds_GCJ='$CC -qmkshrobj $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-dylib_install_name ${wl}`echo SW_PREFIX/lib/ccp4-5.99.5/$soname` $verstring'
          module_cmds_GCJ='$CC $allow_undefined_flag -o $lib -bundle $libobjs $deplibs$compiler_flags'
           # Don't fix this by using the ld -exported_symbols_list flag, it doesn't exist in older darwin lds
-         archive_expsym_cmds_GCJ='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC -qmkshrobj $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-dylib_install_name ${wl}$rpath/$soname $verstring~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
+         archive_expsym_cmds_GCJ='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC -qmkshrobj $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-dylib_install_name ${wl}SW_PREFIX/lib/ccp4-5.99.5/$soname $verstring~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
           module_expsym_cmds_GCJ='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC $allow_undefined_flag  -o $lib -bundle $libobjs $deplibs$compiler_flags~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
           ;;
        *)
diff -ruN ccp4-5.99.5-orig/x-windows/XCCPJIFFY/Imakefile.in ccp4-5.99.5/x-windows/XCCPJIFFY/Imakefile.in
--- ccp4-5.99.5-orig/x-windows/XCCPJIFFY/Imakefile.in	2005-11-30 15:22:21.000000000 -0800
+++ ccp4-5.99.5/x-windows/XCCPJIFFY/Imakefile.in	2005-12-01 06:03:49.000000000 -0800
@@ -95,7 +95,7 @@
 #if (__GNUC__ >= 4)
  CC=gcc
  CCOPTIONS = -I/usr/include/X11R6
- EXTRA_LOAD_FLAGS = -lgfortran
+ EXTRA_LOAD_FLAGS =
  EXTRA_LIBRARIES =
  DEPLIBS =
  FC= gfortran -fno-second-underscore
diff -ruN ccp4-5.99.5-orig/x-windows/libjwc/libjwc_c/configure ccp4-5.99.5/x-windows/libjwc/libjwc_c/configure
--- ccp4-5.99.5-orig/x-windows/libjwc/libjwc_c/configure	2005-11-30 15:22:20.000000000 -0800
+++ ccp4-5.99.5/x-windows/libjwc/libjwc_c/configure	2005-11-30 16:27:47.000000000 -0800
@@ -7200,27 +7200,27 @@
       link_all_deplibs=yes
     if test "$GCC" = yes ; then
     	output_verbose_link_cmd='echo'
-        archive_cmds='$CC -dynamiclib $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags -install_name $rpath/$soname $verstring'
+        archive_cmds='$CC -dynamiclib $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags -install_name SW_PREFIX/lib/ccp4-5.99.5/$soname $verstring'
       module_cmds='$CC $allow_undefined_flag -o $lib -bundle $libobjs $deplibs$compiler_flags'
       # Don't fix this by using the ld -exported_symbols_list flag, it doesn't exist in older darwin lds
-      archive_expsym_cmds='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC -dynamiclib $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags -install_name $rpath/$soname $verstring~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
+      archive_expsym_cmds='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC -dynamiclib $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags -install_name SW_PREFIX/lib/ccp4-5.99.5/$soname $verstring~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
       module_expsym_cmds='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC $allow_undefined_flag  -o $lib -bundle $libobjs $deplibs$compiler_flags~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
     else
       case $cc_basename in
         xlc* )
          output_verbose_link_cmd='echo'
-         archive_cmds='$CC -qmkshrobj $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-install_name ${wl}`echo $rpath/$soname` $verstring'
+         archive_cmds='$CC -qmkshrobj $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-install_name ${wl}`echo SW_PREFIX/lib/ccp4-5.99.5/$soname` $verstring'
          module_cmds='$CC $allow_undefined_flag -o $lib -bundle $libobjs $deplibs$compiler_flags'
           # Don't fix this by using the ld -exported_symbols_list flag, it doesn't exist in older darwin lds
-         archive_expsym_cmds='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC -qmkshrobj $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-install_name ${wl}$rpath/$soname $verstring~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
+         archive_expsym_cmds='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC -qmkshrobj $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-install_name ${wl}SW_PREFIX/lib/ccp4-5.99.5/$soname $verstring~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
           module_expsym_cmds='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC $allow_undefined_flag  -o $lib -bundle $libobjs $deplibs$compiler_flags~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
           ;;
         xlf* )
          output_verbose_link_cmd='echo'
-         archive_cmds='$CC -qmkshrobj $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-dylib_install_name ${wl}`echo $rpath/$soname` $verstring'
+         archive_cmds='$CC -qmkshrobj $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-dylib_install_name ${wl}`echo SW_PREFIX/lib/ccp4-5.99.5/$soname` $verstring'
          module_cmds='$CC $allow_undefined_flag -o $lib -bundle $libobjs $deplibs$compiler_flags'
           # Don't fix this by using the ld -exported_symbols_list flag, it doesn't exist in older darwin lds
-         archive_expsym_cmds='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC -qmkshrobj $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-dylib_install_name ${wl}$rpath/$soname $verstring~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
+         archive_expsym_cmds='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC -qmkshrobj $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-dylib_install_name ${wl}SW_PREFIX/lib/ccp4-5.99.5/$soname $verstring~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
           module_expsym_cmds='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC $allow_undefined_flag  -o $lib -bundle $libobjs $deplibs$compiler_flags~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
           ;;
        *)
@@ -10201,26 +10201,26 @@
        lt_int_apple_cc_single_mod=yes
       fi
       if test "X$lt_int_apple_cc_single_mod" = Xyes ; then
-       archive_cmds_CXX='$CC -dynamiclib -single_module $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags -install_name $rpath/$soname $verstring'
+       archive_cmds_CXX='$CC -dynamiclib -single_module $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags -install_name SW_PREFIX/lib/ccp4-5.99.5/$soname $verstring'
       else
-          archive_cmds_CXX='$CC -r -keep_private_externs -nostdlib -o ${lib}-master.o $libobjs~$CC -dynamiclib $allow_undefined_flag -o $lib ${lib}-master.o $deplibs $compiler_flags -install_name $rpath/$soname $verstring'
+          archive_cmds_CXX='$CC -r -keep_private_externs -nostdlib -o ${lib}-master.o $libobjs~$CC -dynamiclib $allow_undefined_flag -o $lib ${lib}-master.o $deplibs $compiler_flags -install_name SW_PREFIX/lib/ccp4-5.99.5/$soname $verstring'
         fi
         module_cmds_CXX='$CC $allow_undefined_flag -o $lib -bundle $libobjs $deplibs$compiler_flags'
         # Don't fix this by using the ld -exported_symbols_list flag, it doesn't exist in older darwin lds
           if test "X$lt_int_apple_cc_single_mod" = Xyes ; then
-            archive_expsym_cmds_CXX='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC -dynamiclib -single_module $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags -install_name $rpath/$soname $verstring~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
+            archive_expsym_cmds_CXX='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC -dynamiclib -single_module $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags -install_name SW_PREFIX/lib/ccp4-5.99.5/$soname $verstring~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
           else
-            archive_expsym_cmds_CXX='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC -r -keep_private_externs -nostdlib -o ${lib}-master.o $libobjs~$CC -dynamiclib $allow_undefined_flag -o $lib ${lib}-master.o $deplibs $compiler_flags -install_name $rpath/$soname $verstring~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
+            archive_expsym_cmds_CXX='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC -r -keep_private_externs -nostdlib -o ${lib}-master.o $libobjs~$CC -dynamiclib $allow_undefined_flag -o $lib ${lib}-master.o $deplibs $compiler_flags -install_name SW_PREFIX/lib/ccp4-5.99.5/$soname $verstring~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
           fi
             module_expsym_cmds_CXX='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC $allow_undefined_flag  -o $lib -bundle $libobjs $deplibs$compiler_flags~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
       else
       case $cc_basename in
         xlc*)
          output_verbose_link_cmd='echo'
-          archive_cmds_CXX='$CC -qmkshrobj ${wl}-single_module $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-install_name ${wl}`echo $rpath/$soname` $verstring'
+          archive_cmds_CXX='$CC -qmkshrobj ${wl}-single_module $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-install_name ${wl}`echo SW_PREFIX/lib/ccp4-5.99.5/$soname` $verstring'
           module_cmds_CXX='$CC $allow_undefined_flag -o $lib -bundle $libobjs $deplibs$compiler_flags'
           # Don't fix this by using the ld -exported_symbols_list flag, it doesn't exist in older darwin lds
-          archive_expsym_cmds_CXX='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC -qmkshrobj ${wl}-single_module $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-install_name ${wl}$rpath/$soname $verstring~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
+          archive_expsym_cmds_CXX='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC -qmkshrobj ${wl}-single_module $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-install_name ${wl}SW_PREFIX/lib/ccp4-5.99.5/$soname $verstring~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
           module_expsym_cmds_CXX='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC $allow_undefined_flag  -o $lib -bundle $libobjs $deplibs$compiler_flags~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
           ;;
        *)
@@ -14279,27 +14279,27 @@
       link_all_deplibs_F77=yes
     if test "$GCC" = yes ; then
     	output_verbose_link_cmd='echo'
-        archive_cmds_F77='$CC -dynamiclib $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags -install_name $rpath/$soname $verstring'
+        archive_cmds_F77='$CC -dynamiclib $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags -install_name SW_PREFIX/lib/ccp4-5.99.5/$soname $verstring'
       module_cmds_F77='$CC $allow_undefined_flag -o $lib -bundle $libobjs $deplibs$compiler_flags'
       # Don't fix this by using the ld -exported_symbols_list flag, it doesn't exist in older darwin lds
-      archive_expsym_cmds_F77='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC -dynamiclib $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags -install_name $rpath/$soname $verstring~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
+      archive_expsym_cmds_F77='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC -dynamiclib $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags -install_name SW_PREFIX/lib/ccp4-5.99.5/$soname $verstring~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
       module_expsym_cmds_F77='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC $allow_undefined_flag  -o $lib -bundle $libobjs $deplibs$compiler_flags~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
     else
       case $cc_basename in
         xlc* )
          output_verbose_link_cmd='echo'
-         archive_cmds_F77='$CC -qmkshrobj $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-install_name ${wl}`echo $rpath/$soname` $verstring'
+         archive_cmds_F77='$CC -qmkshrobj $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-install_name ${wl}`echo SW_PREFIX/lib/ccp4-5.99.5/$soname` $verstring'
          module_cmds_F77='$CC $allow_undefined_flag -o $lib -bundle $libobjs $deplibs$compiler_flags'
           # Don't fix this by using the ld -exported_symbols_list flag, it doesn't exist in older darwin lds
-         archive_expsym_cmds_F77='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC -qmkshrobj $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-install_name ${wl}$rpath/$soname $verstring~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
+         archive_expsym_cmds_F77='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC -qmkshrobj $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-install_name ${wl}SW_PREFIX/lib/ccp4-5.99.5/$soname $verstring~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
           module_expsym_cmds_F77='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC $allow_undefined_flag  -o $lib -bundle $libobjs $deplibs$compiler_flags~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
           ;;
         xlf* )
          output_verbose_link_cmd='echo'
-         archive_cmds_F77='$CC -qmkshrobj $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-dylib_install_name ${wl}`echo $rpath/$soname` $verstring'
+         archive_cmds_F77='$CC -qmkshrobj $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-dylib_install_name ${wl}`echo SW_PREFIX/lib/ccp4-5.99.5/$soname` $verstring'
          module_cmds_F77='$CC $allow_undefined_flag -o $lib -bundle $libobjs $deplibs$compiler_flags'
           # Don't fix this by using the ld -exported_symbols_list flag, it doesn't exist in older darwin lds
-         archive_expsym_cmds_F77='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC -qmkshrobj $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-dylib_install_name ${wl}$rpath/$soname $verstring~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
+         archive_expsym_cmds_F77='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC -qmkshrobj $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-dylib_install_name ${wl}SW_PREFIX/lib/ccp4-5.99.5/$soname $verstring~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
           module_expsym_cmds_F77='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC $allow_undefined_flag  -o $lib -bundle $libobjs $deplibs$compiler_flags~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
           ;;
        *)
@@ -16767,27 +16767,27 @@
       link_all_deplibs_GCJ=yes
     if test "$GCC" = yes ; then
     	output_verbose_link_cmd='echo'
-        archive_cmds_GCJ='$CC -dynamiclib $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags -install_name $rpath/$soname $verstring'
+        archive_cmds_GCJ='$CC -dynamiclib $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags -install_name SW_PREFIX/lib/ccp4-5.99.5/$soname $verstring'
       module_cmds_GCJ='$CC $allow_undefined_flag -o $lib -bundle $libobjs $deplibs$compiler_flags'
       # Don't fix this by using the ld -exported_symbols_list flag, it doesn't exist in older darwin lds
-      archive_expsym_cmds_GCJ='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC -dynamiclib $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags -install_name $rpath/$soname $verstring~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
+      archive_expsym_cmds_GCJ='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC -dynamiclib $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags -install_name SW_PREFIX/lib/ccp4-5.99.5/$soname $verstring~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
       module_expsym_cmds_GCJ='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC $allow_undefined_flag  -o $lib -bundle $libobjs $deplibs$compiler_flags~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
     else
       case $cc_basename in
         xlc* )
          output_verbose_link_cmd='echo'
-         archive_cmds_GCJ='$CC -qmkshrobj $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-install_name ${wl}`echo $rpath/$soname` $verstring'
+         archive_cmds_GCJ='$CC -qmkshrobj $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-install_name ${wl}`echo SW_PREFIX/lib/ccp4-5.99.5/$soname` $verstring'
          module_cmds_GCJ='$CC $allow_undefined_flag -o $lib -bundle $libobjs $deplibs$compiler_flags'
           # Don't fix this by using the ld -exported_symbols_list flag, it doesn't exist in older darwin lds
-         archive_expsym_cmds_GCJ='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC -qmkshrobj $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-install_name ${wl}$rpath/$soname $verstring~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
+         archive_expsym_cmds_GCJ='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC -qmkshrobj $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-install_name ${wl}SW_PREFIX/lib/ccp4-5.99.5/$soname $verstring~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
           module_expsym_cmds_GCJ='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC $allow_undefined_flag  -o $lib -bundle $libobjs $deplibs$compiler_flags~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
           ;;
         xlf* )
          output_verbose_link_cmd='echo'
-         archive_cmds_GCJ='$CC -qmkshrobj $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-dylib_install_name ${wl}`echo $rpath/$soname` $verstring'
+         archive_cmds_GCJ='$CC -qmkshrobj $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-dylib_install_name ${wl}`echo SW_PREFIX/lib/ccp4-5.99.5/$soname` $verstring'
          module_cmds_GCJ='$CC $allow_undefined_flag -o $lib -bundle $libobjs $deplibs$compiler_flags'
           # Don't fix this by using the ld -exported_symbols_list flag, it doesn't exist in older darwin lds
-         archive_expsym_cmds_GCJ='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC -qmkshrobj $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-dylib_install_name ${wl}$rpath/$soname $verstring~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
+         archive_expsym_cmds_GCJ='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC -qmkshrobj $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-dylib_install_name ${wl}SW_PREFIX/lib/ccp4-5.99.5/$soname $verstring~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
           module_expsym_cmds_GCJ='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC $allow_undefined_flag  -o $lib -bundle $libobjs $deplibs$compiler_flags~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
           ;;
        *)
diff -ruN ccp4-5.99.5-orig/x-windows/libjwc/libjwc_f/configure ccp4-5.99.5/x-windows/libjwc/libjwc_f/configure
--- ccp4-5.99.5-orig/x-windows/libjwc/libjwc_f/configure	2005-11-30 15:22:20.000000000 -0800
+++ ccp4-5.99.5/x-windows/libjwc/libjwc_f/configure	2005-11-30 21:07:31.000000000 -0800
@@ -1,8 +1,9 @@
 #! /bin/sh
 # Guess values for system-dependent variables and create Makefiles.
-# Generated by GNU Autoconf 2.59.
+# Generated by GNU Autoconf 2.57.
 #
-# Copyright (C) 2003 Free Software Foundation, Inc.
+# Copyright 1992, 1993, 1994, 1995, 1996, 1998, 1999, 2000, 2001, 2002
+# Free Software Foundation, Inc.
 # This configure script is free software; the Free Software Foundation
 # gives unlimited permission to copy, distribute and modify it.
 ## --------------------- ##
@@ -19,10 +20,9 @@
 elif test -n "${BASH_VERSION+set}" && (set -o posix) >/dev/null 2>&1; then
   set -o posix
 fi
-DUALCASE=1; export DUALCASE # for MKS sh
 
 # Support unset when possible.
-if ( (MAIL=60; unset MAIL) || exit) >/dev/null 2>&1; then
+if (FOO=FOO; unset FOO) >/dev/null 2>&1; then
   as_unset=unset
 else
   as_unset=false
@@ -41,7 +41,7 @@
   LC_MEASUREMENT LC_MESSAGES LC_MONETARY LC_NAME LC_NUMERIC LC_PAPER \
   LC_TELEPHONE LC_TIME
 do
-  if (set +x; test -z "`(eval $as_var=C; export $as_var) 2>&1`"); then
+  if (set +x; test -n "`(eval $as_var=C; export $as_var) 2>&1`"); then
     eval $as_var=C; export $as_var
   else
     $as_unset $as_var
@@ -218,17 +218,16 @@
 if mkdir -p . 2>/dev/null; then
   as_mkdir_p=:
 else
-  test -d ./-p && rmdir ./-p
   as_mkdir_p=false
 fi
 
 as_executable_p="test -f"
 
 # Sed expression to map a string onto a valid CPP name.
-as_tr_cpp="eval sed 'y%*$as_cr_letters%P$as_cr_LETTERS%;s%[^_$as_cr_alnum]%_%g'"
+as_tr_cpp="sed y%*$as_cr_letters%P$as_cr_LETTERS%;s%[^_$as_cr_alnum]%_%g"
 
 # Sed expression to map a string onto a valid variable name.
-as_tr_sh="eval sed 'y%*+%pp%;s%[^_$as_cr_alnum]%_%g'"
+as_tr_sh="sed y%*+%pp%;s%[^_$as_cr_alnum]%_%g"
 
 
 # IFS
@@ -278,15 +277,15 @@
 
 # The HP-UX ksh and POSIX shell print the target directory to stdout
 # if CDPATH is set.
-(unset CDPATH) >/dev/null 2>&1 && unset CDPATH
+if test "X${CDPATH+set}" = Xset; then CDPATH=:; export CDPATH; fi
 
 if test -z "$ECHO"; then
 if test "X${echo_test_string+set}" != Xset; then
 # find a string as large as possible, as long as the shell can cope with it
   for cmd in 'sed 50q "$0"' 'sed 20q "$0"' 'sed 10q "$0"' 'sed 2q "$0"' 'echo test'; do
     # expected sizes: less than 2Kb, 1Kb, 512 bytes, 16 bytes, ...
-    if (echo_test_string=`eval $cmd`) 2>/dev/null &&
-       echo_test_string=`eval $cmd` &&
+    if (echo_test_string="`eval $cmd`") 2>/dev/null &&
+       echo_test_string="`eval $cmd`" &&
        (test "X$echo_test_string" = "X$echo_test_string") 2>/dev/null
     then
       break
@@ -391,9 +390,9 @@
 
 
 
-tagnames=${tagnames+${tagnames},}CXX
+tagnames=`echo "$tagnames,CXX" | sed 's/^,//'`
 
-tagnames=${tagnames+${tagnames},}F77
+tagnames=`echo "$tagnames,F77" | sed 's/^,//'`
 
 # Name of the host.
 # hostname on some systems (SVR3.2, Linux) returns a bogus exit status,
@@ -822,7 +821,7 @@
 
 # Be sure to have absolute paths.
 for ac_var in bindir sbindir libexecdir datadir sysconfdir sharedstatedir \
-	      localstatedir libdir includedir oldincludedir infodir mandir
+              localstatedir libdir includedir oldincludedir infodir mandir
 do
   eval ac_val=$`echo $ac_var`
   case $ac_val in
@@ -862,10 +861,10 @@
   # Try the directory containing this script, then its parent.
   ac_confdir=`(dirname "$0") 2>/dev/null ||
 $as_expr X"$0" : 'X\(.*[^/]\)//*[^/][^/]*/*$' \| \
-	 X"$0" : 'X\(//\)[^/]' \| \
-	 X"$0" : 'X\(//\)$' \| \
-	 X"$0" : 'X\(/\)' \| \
-	 .     : '\(.\)' 2>/dev/null ||
+         X"$0" : 'X\(//\)[^/]' \| \
+         X"$0" : 'X\(//\)$' \| \
+         X"$0" : 'X\(/\)' \| \
+         .     : '\(.\)' 2>/dev/null ||
 echo X"$0" |
     sed '/^X\(.*[^/]\)\/\/*[^/][^/]*\/*$/{ s//\1/; q; }
   	  /^X\(\/\/\)[^/].*/{ s//\1/; q; }
@@ -977,9 +976,9 @@
   cat <<_ACEOF
 Installation directories:
   --prefix=PREFIX         install architecture-independent files in PREFIX
-			  [$ac_default_prefix]
+                          [$ac_default_prefix]
   --exec-prefix=EPREFIX   install architecture-dependent files in EPREFIX
-			  [PREFIX]
+                          [PREFIX]
 
 By default, \`make install' will install all the files in
 \`$ac_default_prefix/bin', \`$ac_default_prefix/lib' etc.  You can specify
@@ -1097,45 +1096,12 @@
     ac_srcdir=$ac_top_builddir$srcdir$ac_dir_suffix
     ac_top_srcdir=$ac_top_builddir$srcdir ;;
 esac
-
-# Do not use `cd foo && pwd` to compute absolute paths, because
-# the directories may not exist.
-case `pwd` in
-.) ac_abs_builddir="$ac_dir";;
-*)
-  case "$ac_dir" in
-  .) ac_abs_builddir=`pwd`;;
-  [\\/]* | ?:[\\/]* ) ac_abs_builddir="$ac_dir";;
-  *) ac_abs_builddir=`pwd`/"$ac_dir";;
-  esac;;
-esac
-case $ac_abs_builddir in
-.) ac_abs_top_builddir=${ac_top_builddir}.;;
-*)
-  case ${ac_top_builddir}. in
-  .) ac_abs_top_builddir=$ac_abs_builddir;;
-  [\\/]* | ?:[\\/]* ) ac_abs_top_builddir=${ac_top_builddir}.;;
-  *) ac_abs_top_builddir=$ac_abs_builddir/${ac_top_builddir}.;;
-  esac;;
-esac
-case $ac_abs_builddir in
-.) ac_abs_srcdir=$ac_srcdir;;
-*)
-  case $ac_srcdir in
-  .) ac_abs_srcdir=$ac_abs_builddir;;
-  [\\/]* | ?:[\\/]* ) ac_abs_srcdir=$ac_srcdir;;
-  *) ac_abs_srcdir=$ac_abs_builddir/$ac_srcdir;;
-  esac;;
-esac
-case $ac_abs_builddir in
-.) ac_abs_top_srcdir=$ac_top_srcdir;;
-*)
-  case $ac_top_srcdir in
-  .) ac_abs_top_srcdir=$ac_abs_builddir;;
-  [\\/]* | ?:[\\/]* ) ac_abs_top_srcdir=$ac_top_srcdir;;
-  *) ac_abs_top_srcdir=$ac_abs_builddir/$ac_top_srcdir;;
-  esac;;
-esac
+# Don't blindly perform a `cd "$ac_dir"/$ac_foo && pwd` since $ac_foo can be
+# absolute.
+ac_abs_builddir=`cd "$ac_dir" && cd $ac_builddir && pwd`
+ac_abs_top_builddir=`cd "$ac_dir" && cd ${ac_top_builddir}. && pwd`
+ac_abs_srcdir=`cd "$ac_dir" && cd $ac_srcdir && pwd`
+ac_abs_top_srcdir=`cd "$ac_dir" && cd $ac_top_srcdir && pwd`
 
     cd $ac_dir
     # Check for guested configure; otherwise get Cygnus style configure.
@@ -1146,7 +1112,7 @@
       echo
       $SHELL $ac_srcdir/configure  --help=recursive
     elif test -f $ac_srcdir/configure.ac ||
-	   test -f $ac_srcdir/configure.in; then
+           test -f $ac_srcdir/configure.in; then
       echo
       $ac_configure --help
     else
@@ -1160,7 +1126,8 @@
 if $ac_init_version; then
   cat <<\_ACEOF
 
-Copyright (C) 2003 Free Software Foundation, Inc.
+Copyright 1992, 1993, 1994, 1995, 1996, 1998, 1999, 2000, 2001, 2002
+Free Software Foundation, Inc.
 This configure script is free software; the Free Software Foundation
 gives unlimited permission to copy, distribute and modify it.
 _ACEOF
@@ -1172,7 +1139,7 @@
 running configure, to aid debugging if configure makes a mistake.
 
 It was created by $as_me, which was
-generated by GNU Autoconf 2.59.  Invocation command line was
+generated by GNU Autoconf 2.57.  Invocation command line was
 
   $ $0 $@
 
@@ -1249,19 +1216,19 @@
     2)
       ac_configure_args1="$ac_configure_args1 '$ac_arg'"
       if test $ac_must_keep_next = true; then
-	ac_must_keep_next=false # Got value, back to normal.
+        ac_must_keep_next=false # Got value, back to normal.
       else
-	case $ac_arg in
-	  *=* | --config-cache | -C | -disable-* | --disable-* \
-	  | -enable-* | --enable-* | -gas | --g* | -nfp | --nf* \
-	  | -q | -quiet | --q* | -silent | --sil* | -v | -verb* \
-	  | -with-* | --with-* | -without-* | --without-* | --x)
-	    case "$ac_configure_args0 " in
-	      "$ac_configure_args1"*" '$ac_arg' "* ) continue ;;
-	    esac
-	    ;;
-	  -* ) ac_must_keep_next=true ;;
-	esac
+        case $ac_arg in
+          *=* | --config-cache | -C | -disable-* | --disable-* \
+          | -enable-* | --enable-* | -gas | --g* | -nfp | --nf* \
+          | -q | -quiet | --q* | -silent | --sil* | -v | -verb* \
+          | -with-* | --with-* | -without-* | --without-* | --x)
+            case "$ac_configure_args0 " in
+              "$ac_configure_args1"*" '$ac_arg' "* ) continue ;;
+            esac
+            ;;
+          -* ) ac_must_keep_next=true ;;
+        esac
       fi
       ac_configure_args="$ac_configure_args$ac_sep'$ac_arg'"
       # Get rid of the leading space.
@@ -1295,12 +1262,12 @@
     case `(ac_space='"'"' '"'"'; set | grep ac_space) 2>&1` in
     *ac_space=\ *)
       sed -n \
-	"s/'"'"'/'"'"'\\\\'"'"''"'"'/g;
-	  s/^\\([_$as_cr_alnum]*_cv_[_$as_cr_alnum]*\\)=\\(.*\\)/\\1='"'"'\\2'"'"'/p"
+        "s/'"'"'/'"'"'\\\\'"'"''"'"'/g;
+    	  s/^\\([_$as_cr_alnum]*_cv_[_$as_cr_alnum]*\\)=\\(.*\\)/\\1='"'"'\\2'"'"'/p"
       ;;
     *)
       sed -n \
-	"s/^\\([_$as_cr_alnum]*_cv_[_$as_cr_alnum]*\\)=\\(.*\\)/\\1=\\2/p"
+        "s/^\\([_$as_cr_alnum]*_cv_[_$as_cr_alnum]*\\)=\\(.*\\)/\\1=\\2/p"
       ;;
     esac;
 }
@@ -1329,7 +1296,7 @@
       for ac_var in $ac_subst_files
       do
 	eval ac_val=$`echo $ac_var`
-	echo "$ac_var='"'"'$ac_val'"'"'"
+        echo "$ac_var='"'"'$ac_val'"'"'"
       done | sort
       echo
     fi
@@ -1348,7 +1315,7 @@
       echo "$as_me: caught signal $ac_signal"
     echo "$as_me: exit $exit_status"
   } >&5
-  rm -f core *.core &&
+  rm -f core core.* *.core &&
   rm -rf conftest* confdefs* conf$$* $ac_clean_files &&
     exit $exit_status
      ' 0
@@ -1428,7 +1395,7 @@
 # value.
 ac_cache_corrupted=false
 for ac_var in `(set) 2>&1 |
-	       sed -n 's/^ac_env_\([a-zA-Z_0-9]*\)_set=.*/\1/p'`; do
+               sed -n 's/^ac_env_\([a-zA-Z_0-9]*\)_set=.*/\1/p'`; do
   eval ac_old_set=\$ac_cv_env_${ac_var}_set
   eval ac_new_set=\$ac_env_${ac_var}_set
   eval ac_old_val="\$ac_cv_env_${ac_var}_value"
@@ -1445,13 +1412,13 @@
     ,);;
     *)
       if test "x$ac_old_val" != "x$ac_new_val"; then
-	{ echo "$as_me:$LINENO: error: \`$ac_var' has changed since the previous run:" >&5
+        { echo "$as_me:$LINENO: error: \`$ac_var' has changed since the previous run:" >&5
 echo "$as_me: error: \`$ac_var' has changed since the previous run:" >&2;}
-	{ echo "$as_me:$LINENO:   former value:  $ac_old_val" >&5
+        { echo "$as_me:$LINENO:   former value:  $ac_old_val" >&5
 echo "$as_me:   former value:  $ac_old_val" >&2;}
-	{ echo "$as_me:$LINENO:   current value: $ac_new_val" >&5
+        { echo "$as_me:$LINENO:   current value: $ac_new_val" >&5
 echo "$as_me:   current value: $ac_new_val" >&2;}
-	ac_cache_corrupted=:
+        ac_cache_corrupted=:
       fi;;
   esac
   # Pass precious variables to config.status.
@@ -1627,7 +1594,6 @@
 # AIX 4 /usr/bin/installbsd, which doesn't work without a -g flag
 # AFS /usr/afsws/bin/install, which mishandles nonexistent args
 # SVR4 /usr/ucb/install, which tries to use the nonexistent group "staff"
-# OS/2's system install, which has a completely different semantic
 # ./install, which can be erroneously created by make from ./install.sh.
 echo "$as_me:$LINENO: checking for a BSD-compatible install" >&5
 echo $ECHO_N "checking for a BSD-compatible install... $ECHO_C" >&6
@@ -1644,7 +1610,6 @@
 case $as_dir/ in
   ./ | .// | /cC/* | \
   /etc/* | /usr/sbin/* | /usr/etc/* | /sbin/* | /usr/afsws/bin/* | \
-  ?:\\/os2\\/install\\/* | ?:\\/OS2\\/INSTALL\\/* | \
   /usr/ucb/* ) ;;
   *)
     # OSF1 and SCO ODT 3.0 have their own names for install.
@@ -1652,20 +1617,20 @@
     # by default.
     for ac_prog in ginstall scoinst install; do
       for ac_exec_ext in '' $ac_executable_extensions; do
-	if $as_executable_p "$as_dir/$ac_prog$ac_exec_ext"; then
-	  if test $ac_prog = install &&
-	    grep dspmsg "$as_dir/$ac_prog$ac_exec_ext" >/dev/null 2>&1; then
-	    # AIX install.  It has an incompatible calling convention.
-	    :
-	  elif test $ac_prog = install &&
-	    grep pwplus "$as_dir/$ac_prog$ac_exec_ext" >/dev/null 2>&1; then
-	    # program-specific install script used by HP pwplus--don't use.
-	    :
-	  else
-	    ac_cv_path_install="$as_dir/$ac_prog$ac_exec_ext -c"
-	    break 3
-	  fi
-	fi
+        if $as_executable_p "$as_dir/$ac_prog$ac_exec_ext"; then
+          if test $ac_prog = install &&
+            grep dspmsg "$as_dir/$ac_prog$ac_exec_ext" >/dev/null 2>&1; then
+            # AIX install.  It has an incompatible calling convention.
+            :
+          elif test $ac_prog = install &&
+            grep pwplus "$as_dir/$ac_prog$ac_exec_ext" >/dev/null 2>&1; then
+            # program-specific install script used by HP pwplus--don't use.
+            :
+          else
+            ac_cv_path_install="$as_dir/$ac_prog$ac_exec_ext -c"
+            break 3
+          fi
+        fi
       done
     done
     ;;
@@ -1809,7 +1774,7 @@
 
 echo "$as_me:$LINENO: checking whether ${MAKE-make} sets \$(MAKE)" >&5
 echo $ECHO_N "checking whether ${MAKE-make} sets \$(MAKE)... $ECHO_C" >&6
-set dummy ${MAKE-make}; ac_make=`echo "$2" | sed 'y,:./+-,___p_,'`
+set dummy ${MAKE-make}; ac_make=`echo "$2" | sed 'y,./+-,__p_,'`
 if eval "test \"\${ac_cv_prog_make_${ac_make}_set+set}\" = set"; then
   echo $ECHO_N "(cached) $ECHO_C" >&6
 else
@@ -2007,7 +1972,7 @@
 ac_link='$F77 -o conftest$ac_exeext $FFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
 ac_compiler_gnu=$ac_cv_f77_compiler_gnu
 if test -n "$ac_tool_prefix"; then
-  for ac_prog in g77 f77 xlf frt pgf77 fort77 fl32 af77 f90 xlf90 pgf90 epcf90 f95 fort xlf95 ifc efc pgf95 lf95 gfortran
+  for ac_prog in g77 f77 xlf frt pgf77 fl32 af77 fort77 f90 xlf90 pgf90 epcf90 f95 fort xlf95 lf95 g95
   do
     # Extract the first word of "$ac_tool_prefix$ac_prog", so it can be a program name with args.
 set dummy $ac_tool_prefix$ac_prog; ac_word=$2
@@ -2049,7 +2014,7 @@
 fi
 if test -z "$F77"; then
   ac_ct_F77=$F77
-  for ac_prog in g77 f77 xlf frt pgf77 fort77 fl32 af77 f90 xlf90 pgf90 epcf90 f95 fort xlf95 ifc efc pgf95 lf95 gfortran
+  for ac_prog in g77 f77 xlf frt pgf77 fl32 af77 fort77 f90 xlf90 pgf90 epcf90 f95 fort xlf95 lf95 g95
 do
   # Extract the first word of "$ac_prog", so it can be a program name with args.
 set dummy $ac_prog; ac_word=$2
@@ -2094,7 +2059,7 @@
 
 
 # Provide some information about the compiler.
-echo "$as_me:2097:" \
+echo "$as_me:2062:" \
      "checking for Fortran 77 compiler version" >&5
 ac_compiler=`set X $ac_compile; echo $2`
 { (eval echo "$as_me:$LINENO: \"$ac_compiler --version </dev/null >&5\"") >&5
@@ -2112,7 +2077,6 @@
   ac_status=$?
   echo "$as_me:$LINENO: \$? = $ac_status" >&5
   (exit $ac_status); }
-rm -f a.out
 
 cat >conftest.$ac_ext <<_ACEOF
       program main
@@ -2124,8 +2088,8 @@
 # Try to create an executable without -o first, disregard a.out.
 # It will help us diagnose broken compilers, and finding out an intuition
 # of exeext.
-echo "$as_me:$LINENO: checking for Fortran 77 compiler default output file name" >&5
-echo $ECHO_N "checking for Fortran 77 compiler default output file name... $ECHO_C" >&6
+echo "$as_me:$LINENO: checking for Fortran 77 compiler default output" >&5
+echo $ECHO_N "checking for Fortran 77 compiler default output... $ECHO_C" >&6
 ac_link_default=`echo "$ac_link" | sed 's/ -o *conftest[^ ]*//'`
 if { (eval echo "$as_me:$LINENO: \"$ac_link_default\"") >&5
   (eval $ac_link_default) 2>&5
@@ -2145,23 +2109,23 @@
   test -f "$ac_file" || continue
   case $ac_file in
     *.$ac_ext | *.xcoff | *.tds | *.d | *.pdb | *.xSYM | *.bb | *.bbg | *.o | *.obj )
-	;;
+        ;;
     conftest.$ac_ext )
-	# This is the source file.
-	;;
+        # This is the source file.
+        ;;
     [ab].out )
-	# We found the default executable, but exeext='' is most
-	# certainly right.
-	break;;
+        # We found the default executable, but exeext='' is most
+        # certainly right.
+        break;;
     *.* )
-	ac_cv_exeext=`expr "$ac_file" : '[^.]*\(\..*\)'`
-	# FIXME: I believe we export ac_cv_exeext for Libtool,
-	# but it would be cool to find out if it's true.  Does anybody
-	# maintain Libtool? --akim.
-	export ac_cv_exeext
-	break;;
+        ac_cv_exeext=`expr "$ac_file" : '[^.]*\(\..*\)'`
+        # FIXME: I believe we export ac_cv_exeext for Libtool,
+        # but it would be cool to find out if it's true.  Does anybody
+        # maintain Libtool? --akim.
+        export ac_cv_exeext
+        break;;
     * )
-	break;;
+        break;;
   esac
 done
 else
@@ -2235,8 +2199,8 @@
   case $ac_file in
     *.$ac_ext | *.xcoff | *.tds | *.d | *.pdb | *.xSYM | *.bb | *.bbg | *.o | *.obj ) ;;
     *.* ) ac_cv_exeext=`expr "$ac_file" : '[^.]*\(\..*\)'`
-	  export ac_cv_exeext
-	  break;;
+          export ac_cv_exeext
+          break;;
     * ) break;;
   esac
 done
@@ -2296,7 +2260,7 @@
 OBJEXT=$ac_cv_objext
 ac_objext=$OBJEXT
 # If we don't use `.F' as extension, the preprocessor is not run on the
-# input file.  (Note that this only needs to work for GNU compilers.)
+# input file.
 ac_save_ext=$ac_ext
 ac_ext=F
 echo "$as_me:$LINENO: checking whether we are using the GNU Fortran 77 compiler" >&5
@@ -2314,21 +2278,11 @@
 _ACEOF
 rm -f conftest.$ac_objext
 if { (eval echo "$as_me:$LINENO: \"$ac_compile\"") >&5
-  (eval $ac_compile) 2>conftest.er1
+  (eval $ac_compile) 2>&5
   ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
   echo "$as_me:$LINENO: \$? = $ac_status" >&5
   (exit $ac_status); } &&
-	 { ac_try='test -z "$ac_f77_werror_flag"
-			 || test ! -s conftest.err'
-  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
-  (eval $ac_try) 2>&5
-  ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; } &&
-	 { ac_try='test -s conftest.$ac_objext'
+         { ac_try='test -s conftest.$ac_objext'
   { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
@@ -2341,13 +2295,14 @@
 
 ac_compiler_gnu=no
 fi
-rm -f conftest.err conftest.$ac_objext conftest.$ac_ext
+rm -f conftest.$ac_objext conftest.$ac_ext
 ac_cv_f77_compiler_gnu=$ac_compiler_gnu
 
 fi
 echo "$as_me:$LINENO: result: $ac_cv_f77_compiler_gnu" >&5
 echo "${ECHO_T}$ac_cv_f77_compiler_gnu" >&6
 ac_ext=$ac_save_ext
+G77=`test $ac_compiler_gnu = yes && echo yes`
 ac_test_FFLAGS=${FFLAGS+set}
 ac_save_FFLAGS=$FFLAGS
 FFLAGS=
@@ -2364,21 +2319,11 @@
 _ACEOF
 rm -f conftest.$ac_objext
 if { (eval echo "$as_me:$LINENO: \"$ac_compile\"") >&5
-  (eval $ac_compile) 2>conftest.er1
+  (eval $ac_compile) 2>&5
   ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
   echo "$as_me:$LINENO: \$? = $ac_status" >&5
   (exit $ac_status); } &&
-	 { ac_try='test -z "$ac_f77_werror_flag"
-			 || test ! -s conftest.err'
-  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
-  (eval $ac_try) 2>&5
-  ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; } &&
-	 { ac_try='test -s conftest.$ac_objext'
+         { ac_try='test -s conftest.$ac_objext'
   { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
@@ -2391,7 +2336,7 @@
 
 ac_cv_prog_f77_g=no
 fi
-rm -f conftest.err conftest.$ac_objext conftest.$ac_ext
+rm -f conftest.$ac_objext conftest.$ac_ext
 
 fi
 echo "$as_me:$LINENO: result: $ac_cv_prog_f77_g" >&5
@@ -2399,20 +2344,18 @@
 if test "$ac_test_FFLAGS" = set; then
   FFLAGS=$ac_save_FFLAGS
 elif test $ac_cv_prog_f77_g = yes; then
-  if test "x$ac_cv_f77_compiler_gnu" = xyes; then
+  if test "$G77" = yes; then
     FFLAGS="-g -O2"
   else
     FFLAGS="-g"
   fi
 else
-  if test "x$ac_cv_f77_compiler_gnu" = xyes; then
+  if test "$G77" = yes; then
     FFLAGS="-O2"
   else
     FFLAGS=
   fi
 fi
-
-G77=`test $ac_compiler_gnu = yes && echo yes`
 ac_ext=c
 ac_cpp='$CPP $CPPFLAGS'
 ac_compile='$CC -c $CFLAGS $CPPFLAGS conftest.$ac_ext >&5'
@@ -2431,7 +2374,6 @@
 # AIX 4 /usr/bin/installbsd, which doesn't work without a -g flag
 # AFS /usr/afsws/bin/install, which mishandles nonexistent args
 # SVR4 /usr/ucb/install, which tries to use the nonexistent group "staff"
-# OS/2's system install, which has a completely different semantic
 # ./install, which can be erroneously created by make from ./install.sh.
 echo "$as_me:$LINENO: checking for a BSD-compatible install" >&5
 echo $ECHO_N "checking for a BSD-compatible install... $ECHO_C" >&6
@@ -2448,7 +2390,6 @@
 case $as_dir/ in
   ./ | .// | /cC/* | \
   /etc/* | /usr/sbin/* | /usr/etc/* | /sbin/* | /usr/afsws/bin/* | \
-  ?:\\/os2\\/install\\/* | ?:\\/OS2\\/INSTALL\\/* | \
   /usr/ucb/* ) ;;
   *)
     # OSF1 and SCO ODT 3.0 have their own names for install.
@@ -2456,20 +2397,20 @@
     # by default.
     for ac_prog in ginstall scoinst install; do
       for ac_exec_ext in '' $ac_executable_extensions; do
-	if $as_executable_p "$as_dir/$ac_prog$ac_exec_ext"; then
-	  if test $ac_prog = install &&
-	    grep dspmsg "$as_dir/$ac_prog$ac_exec_ext" >/dev/null 2>&1; then
-	    # AIX install.  It has an incompatible calling convention.
-	    :
-	  elif test $ac_prog = install &&
-	    grep pwplus "$as_dir/$ac_prog$ac_exec_ext" >/dev/null 2>&1; then
-	    # program-specific install script used by HP pwplus--don't use.
-	    :
-	  else
-	    ac_cv_path_install="$as_dir/$ac_prog$ac_exec_ext -c"
-	    break 3
-	  fi
-	fi
+        if $as_executable_p "$as_dir/$ac_prog$ac_exec_ext"; then
+          if test $ac_prog = install &&
+            grep dspmsg "$as_dir/$ac_prog$ac_exec_ext" >/dev/null 2>&1; then
+            # AIX install.  It has an incompatible calling convention.
+            :
+          elif test $ac_prog = install &&
+            grep pwplus "$as_dir/$ac_prog$ac_exec_ext" >/dev/null 2>&1; then
+            # program-specific install script used by HP pwplus--don't use.
+            :
+          else
+            ac_cv_path_install="$as_dir/$ac_prog$ac_exec_ext -c"
+            break 3
+          fi
+        fi
       done
     done
     ;;
@@ -2985,6 +2926,7 @@
   echo $ECHO_N "(cached) $ECHO_C" >&6
 else
   cat >conftest.$ac_ext <<_ACEOF
+#line $LINENO "configure"
 /* confdefs.h.  */
 _ACEOF
 cat confdefs.h >>conftest.$ac_ext
@@ -3004,21 +2946,11 @@
 _ACEOF
 rm -f conftest.$ac_objext
 if { (eval echo "$as_me:$LINENO: \"$ac_compile\"") >&5
-  (eval $ac_compile) 2>conftest.er1
+  (eval $ac_compile) 2>&5
   ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
   echo "$as_me:$LINENO: \$? = $ac_status" >&5
   (exit $ac_status); } &&
-	 { ac_try='test -z "$ac_c_werror_flag"
-			 || test ! -s conftest.err'
-  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
-  (eval $ac_try) 2>&5
-  ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; } &&
-	 { ac_try='test -s conftest.$ac_objext'
+         { ac_try='test -s conftest.$ac_objext'
   { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
@@ -3031,7 +2963,7 @@
 
 ac_compiler_gnu=no
 fi
-rm -f conftest.err conftest.$ac_objext conftest.$ac_ext
+rm -f conftest.$ac_objext conftest.$ac_ext
 ac_cv_c_compiler_gnu=$ac_compiler_gnu
 
 fi
@@ -3047,6 +2979,7 @@
   echo $ECHO_N "(cached) $ECHO_C" >&6
 else
   cat >conftest.$ac_ext <<_ACEOF
+#line $LINENO "configure"
 /* confdefs.h.  */
 _ACEOF
 cat confdefs.h >>conftest.$ac_ext
@@ -3063,21 +2996,11 @@
 _ACEOF
 rm -f conftest.$ac_objext
 if { (eval echo "$as_me:$LINENO: \"$ac_compile\"") >&5
-  (eval $ac_compile) 2>conftest.er1
+  (eval $ac_compile) 2>&5
   ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
   echo "$as_me:$LINENO: \$? = $ac_status" >&5
   (exit $ac_status); } &&
-	 { ac_try='test -z "$ac_c_werror_flag"
-			 || test ! -s conftest.err'
-  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
-  (eval $ac_try) 2>&5
-  ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; } &&
-	 { ac_try='test -s conftest.$ac_objext'
+         { ac_try='test -s conftest.$ac_objext'
   { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
@@ -3090,7 +3013,7 @@
 
 ac_cv_prog_cc_g=no
 fi
-rm -f conftest.err conftest.$ac_objext conftest.$ac_ext
+rm -f conftest.$ac_objext conftest.$ac_ext
 fi
 echo "$as_me:$LINENO: result: $ac_cv_prog_cc_g" >&5
 echo "${ECHO_T}$ac_cv_prog_cc_g" >&6
@@ -3117,6 +3040,7 @@
   ac_cv_prog_cc_stdc=no
 ac_save_CC=$CC
 cat >conftest.$ac_ext <<_ACEOF
+#line $LINENO "configure"
 /* confdefs.h.  */
 _ACEOF
 cat confdefs.h >>conftest.$ac_ext
@@ -3144,16 +3068,6 @@
   va_end (v);
   return s;
 }
-
-/* OSF 4.0 Compaq cc is some sort of almost-ANSI by default.  It has
-   function prototypes and stuff, but not '\xHH' hex character constants.
-   These don't provoke an error unfortunately, instead are silently treated
-   as 'x'.  The following induces an error, until -std1 is added to get
-   proper ANSI mode.  Curiously '\x00'!='x' always comes out true, for an
-   array size at least.  It's necessary to write '\x00'==0 to get something
-   that's true only with -std1.  */
-int osf4_cc_array ['\x00' == 0 ? 1 : -1];
-
 int test (int i, double x);
 struct s1 {int (*f) (int a);};
 struct s2 {int (*f) (double a);};
@@ -3180,21 +3094,11 @@
   CC="$ac_save_CC $ac_arg"
   rm -f conftest.$ac_objext
 if { (eval echo "$as_me:$LINENO: \"$ac_compile\"") >&5
-  (eval $ac_compile) 2>conftest.er1
+  (eval $ac_compile) 2>&5
   ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
   echo "$as_me:$LINENO: \$? = $ac_status" >&5
   (exit $ac_status); } &&
-	 { ac_try='test -z "$ac_c_werror_flag"
-			 || test ! -s conftest.err'
-  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
-  (eval $ac_try) 2>&5
-  ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; } &&
-	 { ac_try='test -s conftest.$ac_objext'
+         { ac_try='test -s conftest.$ac_objext'
   { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
@@ -3207,7 +3111,7 @@
 sed 's/^/| /' conftest.$ac_ext >&5
 
 fi
-rm -f conftest.err conftest.$ac_objext
+rm -f conftest.$ac_objext
 done
 rm -f conftest.$ac_ext conftest.$ac_objext
 CC=$ac_save_CC
@@ -3235,28 +3139,19 @@
 _ACEOF
 rm -f conftest.$ac_objext
 if { (eval echo "$as_me:$LINENO: \"$ac_compile\"") >&5
-  (eval $ac_compile) 2>conftest.er1
+  (eval $ac_compile) 2>&5
   ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
   echo "$as_me:$LINENO: \$? = $ac_status" >&5
   (exit $ac_status); } &&
-	 { ac_try='test -z "$ac_c_werror_flag"
-			 || test ! -s conftest.err'
-  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
-  (eval $ac_try) 2>&5
-  ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; } &&
-	 { ac_try='test -s conftest.$ac_objext'
+         { ac_try='test -s conftest.$ac_objext'
   { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
   echo "$as_me:$LINENO: \$? = $ac_status" >&5
   (exit $ac_status); }; }; then
   for ac_declaration in \
-   '' \
+   ''\
+   '#include <stdlib.h>' \
    'extern "C" void std::exit (int) throw (); using std::exit;' \
    'extern "C" void std::exit (int); using std::exit;' \
    'extern "C" void exit (int) throw ();' \
@@ -3264,13 +3159,14 @@
    'void exit (int);'
 do
   cat >conftest.$ac_ext <<_ACEOF
+#line $LINENO "configure"
 /* confdefs.h.  */
 _ACEOF
 cat confdefs.h >>conftest.$ac_ext
 cat >>conftest.$ac_ext <<_ACEOF
 /* end confdefs.h.  */
-$ac_declaration
 #include <stdlib.h>
+$ac_declaration
 int
 main ()
 {
@@ -3281,21 +3177,11 @@
 _ACEOF
 rm -f conftest.$ac_objext
 if { (eval echo "$as_me:$LINENO: \"$ac_compile\"") >&5
-  (eval $ac_compile) 2>conftest.er1
+  (eval $ac_compile) 2>&5
   ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
   echo "$as_me:$LINENO: \$? = $ac_status" >&5
   (exit $ac_status); } &&
-	 { ac_try='test -z "$ac_c_werror_flag"
-			 || test ! -s conftest.err'
-  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
-  (eval $ac_try) 2>&5
-  ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; } &&
-	 { ac_try='test -s conftest.$ac_objext'
+         { ac_try='test -s conftest.$ac_objext'
   { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
@@ -3308,8 +3194,9 @@
 
 continue
 fi
-rm -f conftest.err conftest.$ac_objext conftest.$ac_ext
+rm -f conftest.$ac_objext conftest.$ac_ext
   cat >conftest.$ac_ext <<_ACEOF
+#line $LINENO "configure"
 /* confdefs.h.  */
 _ACEOF
 cat confdefs.h >>conftest.$ac_ext
@@ -3326,21 +3213,11 @@
 _ACEOF
 rm -f conftest.$ac_objext
 if { (eval echo "$as_me:$LINENO: \"$ac_compile\"") >&5
-  (eval $ac_compile) 2>conftest.er1
+  (eval $ac_compile) 2>&5
   ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
   echo "$as_me:$LINENO: \$? = $ac_status" >&5
   (exit $ac_status); } &&
-	 { ac_try='test -z "$ac_c_werror_flag"
-			 || test ! -s conftest.err'
-  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
-  (eval $ac_try) 2>&5
-  ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; } &&
-	 { ac_try='test -s conftest.$ac_objext'
+         { ac_try='test -s conftest.$ac_objext'
   { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
@@ -3352,7 +3229,7 @@
 sed 's/^/| /' conftest.$ac_ext >&5
 
 fi
-rm -f conftest.err conftest.$ac_objext conftest.$ac_ext
+rm -f conftest.$ac_objext conftest.$ac_ext
 done
 rm -f conftest*
 if test -n "$ac_declaration"; then
@@ -3366,7 +3243,7 @@
 sed 's/^/| /' conftest.$ac_ext >&5
 
 fi
-rm -f conftest.err conftest.$ac_objext conftest.$ac_ext
+rm -f conftest.$ac_objext conftest.$ac_ext
 ac_ext=c
 ac_cpp='$CPP $CPPFLAGS'
 ac_compile='$CC -c $CFLAGS $CPPFLAGS conftest.$ac_ext >&5'
@@ -3467,7 +3344,7 @@
 # Add /usr/xpg4/bin/sed as it is typically found on Solaris
 # along with /bin/sed that truncates output.
 for lt_ac_sed in $lt_ac_sed_list /usr/xpg4/bin/sed; do
-  test ! -f $lt_ac_sed && continue
+  test ! -f $lt_ac_sed && break
   cat /dev/null > conftest.in
   lt_ac_count=0
   echo $ECHO_N "0123456789$ECHO_C" >conftest.in
@@ -3492,10 +3369,10 @@
     fi
   done
 done
+SED=$lt_cv_path_SED
 
 fi
 
-SED=$lt_cv_path_SED
 echo "$as_me:$LINENO: result: $SED" >&5
 echo "${ECHO_T}$SED" >&6
 
@@ -3538,7 +3415,7 @@
     # Accept absolute paths.
     [\\/]* | ?:[\\/]*)
       re_direlt='/[^/][^/]*/\.\./'
-      # Canonicalize the pathname of ld
+      # Canonicalize the path of ld
       ac_prog=`echo $ac_prog| $SED 's%\\\\%/%g'`
       while echo $ac_prog | grep "$re_direlt" > /dev/null 2>&1; do
 	ac_prog=`echo $ac_prog| $SED "s%$re_direlt%/%"`
@@ -3572,7 +3449,7 @@
     if test -f "$ac_dir/$ac_prog" || test -f "$ac_dir/$ac_prog$ac_exeext"; then
       lt_cv_path_LD="$ac_dir/$ac_prog"
       # Check to see if the program is GNU ld.  I'd rather use --version,
-      # but apparently some variants of GNU ld only accept -v.
+      # but apparently some GNU ld's only accept -v.
       # Break only if it was the GNU/non-GNU ld that we prefer.
       case `"$lt_cv_path_LD" -v 2>&1 </dev/null` in
       *GNU* | *'with BFD'*)
@@ -3606,8 +3483,8 @@
 if test "${lt_cv_prog_gnu_ld+set}" = set; then
   echo $ECHO_N "(cached) $ECHO_C" >&6
 else
-  # I'd rather use --version here, but apparently some GNU lds only accept -v.
-case `$LD -v 2>&1 </dev/null` in
+  # I'd rather use --version here, but apparently some GNU ld's only accept -v.
+case `"$LD" -v 2>&1 </dev/null` in
 *GNU* | *'with BFD'*)
   lt_cv_prog_gnu_ld=yes
   ;;
@@ -3635,16 +3512,7 @@
 "" | " "*) ;;
 *) reload_flag=" $reload_flag" ;;
 esac
-reload_cmds='$LD$reload_flag -o $output$reload_objs'
-case $host_os in
-  darwin*)
-    if test "$GCC" = yes; then
-      reload_cmds='$CC -nostdlib ${wl}-r -o $output$reload_objs'
-    else
-      reload_cmds='$LD$reload_flag -o $output$reload_objs'
-    fi
-    ;;
-esac
+reload_cmds='$CC -nostdlib -Xlinker$reload_flag $archargs -o $output$reload_objs'
 
 echo "$as_me:$LINENO: checking for BSD-compatible nm" >&5
 echo $ECHO_N "checking for BSD-compatible nm... $ECHO_C" >&6
@@ -3731,36 +3599,40 @@
   lt_cv_deplibs_check_method=pass_all
   ;;
 
-bsdi[45]*)
+bsdi4*)
   lt_cv_deplibs_check_method='file_magic ELF [0-9][0-9]*-bit [ML]SB (shared object|dynamic lib)'
   lt_cv_file_magic_cmd='/usr/bin/file -L'
   lt_cv_file_magic_test_file=/shlib/libc.so
   ;;
 
-cygwin*)
-  # func_win32_libid is a shell function defined in ltmain.sh
+cygwin* | mingw* | pw32*)
+  # win32_libid is a shell function defined in ltmain.sh
   lt_cv_deplibs_check_method='file_magic ^x86 archive import|^x86 DLL'
-  lt_cv_file_magic_cmd='func_win32_libid'
-  ;;
-
-mingw* | pw32*)
-  # Base MSYS/MinGW do not provide the 'file' command needed by
-  # func_win32_libid shell function, so use a weaker test based on 'objdump'.
-  lt_cv_deplibs_check_method='file_magic file format pei*-i386(.*architecture: i386)?'
-  lt_cv_file_magic_cmd='$OBJDUMP -f'
+  lt_cv_file_magic_cmd='win32_libid'
   ;;
 
 darwin* | rhapsody*)
+  # this will be overwritten by pass_all, but leave it in just in case
+  lt_cv_deplibs_check_method='file_magic Mach-O dynamically linked shared library'
+  lt_cv_file_magic_cmd='/usr/bin/file -L'
+  case "$host_os" in
+  rhapsody* | darwin1.[012])
+    lt_cv_file_magic_test_file=`/System/Library/Frameworks/System.framework/System`
+    ;;
+  *) # Darwin 1.3 on
+    lt_cv_file_magic_test_file='/usr/lib/libSystem.dylib'
+    ;;
+  esac
   lt_cv_deplibs_check_method=pass_all
   ;;
 
-freebsd* | kfreebsd*-gnu | dragonfly*)
+freebsd*)
   if echo __ELF__ | $CC -E - | grep __ELF__ > /dev/null; then
     case $host_cpu in
     i*86 )
       # Not sure whether the presence of OpenBSD here was a mistake.
       # Let's accept both of them until this is cleared up.
-      lt_cv_deplibs_check_method='file_magic (FreeBSD|OpenBSD|DragonFly)/i[3-9]86 (compact )?demand paged shared library'
+      lt_cv_deplibs_check_method='file_magic (FreeBSD|OpenBSD)/i[3-9]86 (compact )?demand paged shared library'
       lt_cv_file_magic_cmd=/usr/bin/file
       lt_cv_file_magic_test_file=`echo /usr/lib/libc.so.*`
       ;;
@@ -3776,7 +3648,7 @@
 
 hpux10.20* | hpux11*)
   lt_cv_file_magic_cmd=/usr/bin/file
-  case $host_cpu in
+  case "$host_cpu" in
   ia64*)
     lt_cv_deplibs_check_method='file_magic (s[0-9][0-9][0-9]|ELF-[0-9][0-9]) shared object file - IA64'
     lt_cv_file_magic_test_file=/usr/lib/hpux32/libc.so
@@ -3793,18 +3665,36 @@
   ;;
 
 irix5* | irix6* | nonstopux*)
-  case $LD in
-  *-32|*"-32 ") libmagic=32-bit;;
-  *-n32|*"-n32 ") libmagic=N32;;
-  *-64|*"-64 ") libmagic=64-bit;;
-  *) libmagic=never-match;;
+  case $host_os in
+  irix5* | nonstopux*)
+    # this will be overridden with pass_all, but let us keep it just in case
+    lt_cv_deplibs_check_method="file_magic ELF 32-bit MSB dynamic lib MIPS - version 1"
+    ;;
+  *)
+    case $LD in
+    *-32|*"-32 ") libmagic=32-bit;;
+    *-n32|*"-n32 ") libmagic=N32;;
+    *-64|*"-64 ") libmagic=64-bit;;
+    *) libmagic=never-match;;
+    esac
+    # this will be overridden with pass_all, but let us keep it just in case
+    lt_cv_deplibs_check_method="file_magic ELF ${libmagic} MSB mips-[1234] dynamic lib MIPS - version 1"
+    ;;
   esac
+  lt_cv_file_magic_test_file=`echo /lib${libsuff}/libc.so*`
   lt_cv_deplibs_check_method=pass_all
   ;;
 
 # This must be Linux ELF.
 linux*)
-  lt_cv_deplibs_check_method=pass_all
+  case $host_cpu in
+  alpha* | hppa* | i*86 | ia64* | m68* | mips | mipsel | powerpc* | sparc* | s390* | sh*)
+    lt_cv_deplibs_check_method=pass_all ;;
+  *)
+    # glibc up to 2.1.1 does not perform some relocations on ARM
+    lt_cv_deplibs_check_method='file_magic ELF [0-9][0-9]*-bit [LM]SB (shared object|dynamic lib )' ;;
+  esac
+  lt_cv_file_magic_test_file=`echo /lib/libc.so* /lib/libc-*.so`
   ;;
 
 netbsd*)
@@ -3821,19 +3711,24 @@
   lt_cv_file_magic_test_file=/usr/lib/libnls.so
   ;;
 
-nto-qnx*)
+nto-qnx)
   lt_cv_deplibs_check_method=unknown
   ;;
 
 openbsd*)
+  lt_cv_file_magic_cmd=/usr/bin/file
+  lt_cv_file_magic_test_file=`echo /usr/lib/libc.so.*`
   if test -z "`echo __ELF__ | $CC -E - | grep __ELF__`" || test "$host_os-$host_cpu" = "openbsd2.8-powerpc"; then
-    lt_cv_deplibs_check_method='match_pattern /lib[^/]+(\.so\.[0-9]+\.[0-9]+|\.so|_pic\.a)$'
+    lt_cv_deplibs_check_method='file_magic ELF [0-9][0-9]*-bit [LM]SB shared object'
   else
-    lt_cv_deplibs_check_method='match_pattern /lib[^/]+(\.so\.[0-9]+\.[0-9]+|_pic\.a)$'
+    lt_cv_deplibs_check_method='file_magic OpenBSD.* shared library'
   fi
   ;;
 
 osf3* | osf4* | osf5*)
+  # this will be overridden with pass_all, but let us keep it just in case
+  lt_cv_deplibs_check_method='file_magic COFF format alpha shared library'
+  lt_cv_file_magic_test_file=/shlib/libc.so
   lt_cv_deplibs_check_method=pass_all
   ;;
 
@@ -3843,6 +3738,7 @@
 
 solaris*)
   lt_cv_deplibs_check_method=pass_all
+  lt_cv_file_magic_test_file=/lib/libc.so
   ;;
 
 sysv4 | sysv4.2uw2* | sysv4.3* | sysv5*)
@@ -3922,7 +3818,7 @@
   ;;
 *-*-irix6*)
   # Find out which ABI we are using.
-  echo '#line 3925 "configure"' > conftest.$ac_ext
+  echo '#line 3821 "configure"' > conftest.$ac_ext
   if { (eval echo "$as_me:$LINENO: \"$ac_compile\"") >&5
   (eval $ac_compile) 2>&5
   ac_status=$?
@@ -3965,13 +3861,13 @@
   ac_status=$?
   echo "$as_me:$LINENO: \$? = $ac_status" >&5
   (exit $ac_status); }; then
-    case `/usr/bin/file conftest.o` in
+    case "`/usr/bin/file conftest.o`" in
     *32-bit*)
       case $host in
         x86_64-*linux*)
           LD="${LD-ld} -m elf_i386"
           ;;
-        ppc64-*linux*|powerpc64-*linux*)
+        ppc64-*linux*)
           LD="${LD-ld} -m elf32ppclinux"
           ;;
         s390x-*linux*)
@@ -4019,6 +3915,7 @@
 ac_compiler_gnu=$ac_cv_c_compiler_gnu
 
      cat >conftest.$ac_ext <<_ACEOF
+#line $LINENO "configure"
 /* confdefs.h.  */
 _ACEOF
 cat confdefs.h >>conftest.$ac_ext
@@ -4035,21 +3932,11 @@
 _ACEOF
 rm -f conftest.$ac_objext conftest$ac_exeext
 if { (eval echo "$as_me:$LINENO: \"$ac_link\"") >&5
-  (eval $ac_link) 2>conftest.er1
+  (eval $ac_link) 2>&5
   ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
   echo "$as_me:$LINENO: \$? = $ac_status" >&5
   (exit $ac_status); } &&
-	 { ac_try='test -z "$ac_c_werror_flag"
-			 || test ! -s conftest.err'
-  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
-  (eval $ac_try) 2>&5
-  ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; } &&
-	 { ac_try='test -s conftest$ac_exeext'
+         { ac_try='test -s conftest$ac_exeext'
   { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
@@ -4062,8 +3949,7 @@
 
 lt_cv_cc_needs_belf=no
 fi
-rm -f conftest.err conftest.$ac_objext \
-      conftest$ac_exeext conftest.$ac_ext
+rm -f conftest.$ac_objext conftest$ac_exeext conftest.$ac_ext
      ac_ext=c
 ac_cpp='$CPP $CPPFLAGS'
 ac_compile='$CC -c $CFLAGS $CPPFLAGS conftest.$ac_ext >&5'
@@ -4112,6 +3998,7 @@
   # On the NeXT, cc -E runs the code through the compiler's parser,
   # not just through cpp. "Syntax error" is here to catch this case.
   cat >conftest.$ac_ext <<_ACEOF
+#line $LINENO "configure"
 /* confdefs.h.  */
 _ACEOF
 cat confdefs.h >>conftest.$ac_ext
@@ -4122,7 +4009,7 @@
 #else
 # include <assert.h>
 #endif
-		     Syntax error
+                     Syntax error
 _ACEOF
 if { (eval echo "$as_me:$LINENO: \"$ac_cpp conftest.$ac_ext\"") >&5
   (eval $ac_cpp conftest.$ac_ext) 2>conftest.er1
@@ -4134,7 +4021,6 @@
   (exit $ac_status); } >/dev/null; then
   if test -s conftest.err; then
     ac_cpp_err=$ac_c_preproc_warn_flag
-    ac_cpp_err=$ac_cpp_err$ac_c_werror_flag
   else
     ac_cpp_err=
   fi
@@ -4155,6 +4041,7 @@
   # OK, works on sane cases.  Now check whether non-existent headers
   # can be detected and how.
   cat >conftest.$ac_ext <<_ACEOF
+#line $LINENO "configure"
 /* confdefs.h.  */
 _ACEOF
 cat confdefs.h >>conftest.$ac_ext
@@ -4172,7 +4059,6 @@
   (exit $ac_status); } >/dev/null; then
   if test -s conftest.err; then
     ac_cpp_err=$ac_c_preproc_warn_flag
-    ac_cpp_err=$ac_cpp_err$ac_c_werror_flag
   else
     ac_cpp_err=
   fi
@@ -4219,6 +4105,7 @@
   # On the NeXT, cc -E runs the code through the compiler's parser,
   # not just through cpp. "Syntax error" is here to catch this case.
   cat >conftest.$ac_ext <<_ACEOF
+#line $LINENO "configure"
 /* confdefs.h.  */
 _ACEOF
 cat confdefs.h >>conftest.$ac_ext
@@ -4229,7 +4116,7 @@
 #else
 # include <assert.h>
 #endif
-		     Syntax error
+                     Syntax error
 _ACEOF
 if { (eval echo "$as_me:$LINENO: \"$ac_cpp conftest.$ac_ext\"") >&5
   (eval $ac_cpp conftest.$ac_ext) 2>conftest.er1
@@ -4241,7 +4128,6 @@
   (exit $ac_status); } >/dev/null; then
   if test -s conftest.err; then
     ac_cpp_err=$ac_c_preproc_warn_flag
-    ac_cpp_err=$ac_cpp_err$ac_c_werror_flag
   else
     ac_cpp_err=
   fi
@@ -4262,6 +4148,7 @@
   # OK, works on sane cases.  Now check whether non-existent headers
   # can be detected and how.
   cat >conftest.$ac_ext <<_ACEOF
+#line $LINENO "configure"
 /* confdefs.h.  */
 _ACEOF
 cat confdefs.h >>conftest.$ac_ext
@@ -4279,7 +4166,6 @@
   (exit $ac_status); } >/dev/null; then
   if test -s conftest.err; then
     ac_cpp_err=$ac_c_preproc_warn_flag
-    ac_cpp_err=$ac_cpp_err$ac_c_werror_flag
   else
     ac_cpp_err=
   fi
@@ -4325,6 +4211,7 @@
   echo $ECHO_N "(cached) $ECHO_C" >&6
 else
   cat >conftest.$ac_ext <<_ACEOF
+#line $LINENO "configure"
 /* confdefs.h.  */
 _ACEOF
 cat confdefs.h >>conftest.$ac_ext
@@ -4345,21 +4232,11 @@
 _ACEOF
 rm -f conftest.$ac_objext
 if { (eval echo "$as_me:$LINENO: \"$ac_compile\"") >&5
-  (eval $ac_compile) 2>conftest.er1
+  (eval $ac_compile) 2>&5
   ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
   echo "$as_me:$LINENO: \$? = $ac_status" >&5
   (exit $ac_status); } &&
-	 { ac_try='test -z "$ac_c_werror_flag"
-			 || test ! -s conftest.err'
-  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
-  (eval $ac_try) 2>&5
-  ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; } &&
-	 { ac_try='test -s conftest.$ac_objext'
+         { ac_try='test -s conftest.$ac_objext'
   { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
@@ -4372,11 +4249,12 @@
 
 ac_cv_header_stdc=no
 fi
-rm -f conftest.err conftest.$ac_objext conftest.$ac_ext
+rm -f conftest.$ac_objext conftest.$ac_ext
 
 if test $ac_cv_header_stdc = yes; then
   # SunOS 4.x string.h does not declare mem*, contrary to ANSI.
   cat >conftest.$ac_ext <<_ACEOF
+#line $LINENO "configure"
 /* confdefs.h.  */
 _ACEOF
 cat confdefs.h >>conftest.$ac_ext
@@ -4398,6 +4276,7 @@
 if test $ac_cv_header_stdc = yes; then
   # ISC 2.0.2 stdlib.h does not declare free, contrary to ANSI.
   cat >conftest.$ac_ext <<_ACEOF
+#line $LINENO "configure"
 /* confdefs.h.  */
 _ACEOF
 cat confdefs.h >>conftest.$ac_ext
@@ -4422,6 +4301,7 @@
   :
 else
   cat >conftest.$ac_ext <<_ACEOF
+#line $LINENO "configure"
 /* confdefs.h.  */
 _ACEOF
 cat confdefs.h >>conftest.$ac_ext
@@ -4433,9 +4313,9 @@
 # define TOUPPER(c) (ISLOWER(c) ? 'A' + ((c) - 'a') : (c))
 #else
 # define ISLOWER(c) \
-		   (('a' <= (c) && (c) <= 'i') \
-		     || ('j' <= (c) && (c) <= 'r') \
-		     || ('s' <= (c) && (c) <= 'z'))
+                   (('a' <= (c) && (c) <= 'i') \
+                     || ('j' <= (c) && (c) <= 'r') \
+                     || ('s' <= (c) && (c) <= 'z'))
 # define TOUPPER(c) (ISLOWER(c) ? ((c) | 0x40) : (c))
 #endif
 
@@ -4446,7 +4326,7 @@
   int i;
   for (i = 0; i < 256; i++)
     if (XOR (islower (i), ISLOWER (i))
-	|| toupper (i) != TOUPPER (i))
+        || toupper (i) != TOUPPER (i))
       exit(2);
   exit (0);
 }
@@ -4471,7 +4351,7 @@
 ( exit $ac_status )
 ac_cv_header_stdc=no
 fi
-rm -f core *.core gmon.out bb.out conftest$ac_exeext conftest.$ac_objext conftest.$ac_ext
+rm -f core core.* *.core gmon.out bb.out conftest$ac_exeext conftest.$ac_objext conftest.$ac_ext
 fi
 fi
 fi
@@ -4496,7 +4376,7 @@
 
 
 for ac_header in sys/types.h sys/stat.h stdlib.h string.h memory.h strings.h \
-		  inttypes.h stdint.h unistd.h
+                  inttypes.h stdint.h unistd.h
 do
 as_ac_Header=`echo "ac_cv_header_$ac_header" | $as_tr_sh`
 echo "$as_me:$LINENO: checking for $ac_header" >&5
@@ -4505,6 +4385,7 @@
   echo $ECHO_N "(cached) $ECHO_C" >&6
 else
   cat >conftest.$ac_ext <<_ACEOF
+#line $LINENO "configure"
 /* confdefs.h.  */
 _ACEOF
 cat confdefs.h >>conftest.$ac_ext
@@ -4516,21 +4397,11 @@
 _ACEOF
 rm -f conftest.$ac_objext
 if { (eval echo "$as_me:$LINENO: \"$ac_compile\"") >&5
-  (eval $ac_compile) 2>conftest.er1
+  (eval $ac_compile) 2>&5
   ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
   echo "$as_me:$LINENO: \$? = $ac_status" >&5
   (exit $ac_status); } &&
-	 { ac_try='test -z "$ac_c_werror_flag"
-			 || test ! -s conftest.err'
-  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
-  (eval $ac_try) 2>&5
-  ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; } &&
-	 { ac_try='test -s conftest.$ac_objext'
+         { ac_try='test -s conftest.$ac_objext'
   { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
@@ -4543,7 +4414,7 @@
 
 eval "$as_ac_Header=no"
 fi
-rm -f conftest.err conftest.$ac_objext conftest.$ac_ext
+rm -f conftest.$ac_objext conftest.$ac_ext
 fi
 echo "$as_me:$LINENO: result: `eval echo '${'$as_ac_Header'}'`" >&5
 echo "${ECHO_T}`eval echo '${'$as_ac_Header'}'`" >&6
@@ -4574,6 +4445,7 @@
 echo "$as_me:$LINENO: checking $ac_header usability" >&5
 echo $ECHO_N "checking $ac_header usability... $ECHO_C" >&6
 cat >conftest.$ac_ext <<_ACEOF
+#line $LINENO "configure"
 /* confdefs.h.  */
 _ACEOF
 cat confdefs.h >>conftest.$ac_ext
@@ -4584,21 +4456,11 @@
 _ACEOF
 rm -f conftest.$ac_objext
 if { (eval echo "$as_me:$LINENO: \"$ac_compile\"") >&5
-  (eval $ac_compile) 2>conftest.er1
+  (eval $ac_compile) 2>&5
   ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
   echo "$as_me:$LINENO: \$? = $ac_status" >&5
   (exit $ac_status); } &&
-	 { ac_try='test -z "$ac_c_werror_flag"
-			 || test ! -s conftest.err'
-  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
-  (eval $ac_try) 2>&5
-  ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; } &&
-	 { ac_try='test -s conftest.$ac_objext'
+         { ac_try='test -s conftest.$ac_objext'
   { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
@@ -4611,7 +4473,7 @@
 
 ac_header_compiler=no
 fi
-rm -f conftest.err conftest.$ac_objext conftest.$ac_ext
+rm -f conftest.$ac_objext conftest.$ac_ext
 echo "$as_me:$LINENO: result: $ac_header_compiler" >&5
 echo "${ECHO_T}$ac_header_compiler" >&6
 
@@ -4619,6 +4481,7 @@
 echo "$as_me:$LINENO: checking $ac_header presence" >&5
 echo $ECHO_N "checking $ac_header presence... $ECHO_C" >&6
 cat >conftest.$ac_ext <<_ACEOF
+#line $LINENO "configure"
 /* confdefs.h.  */
 _ACEOF
 cat confdefs.h >>conftest.$ac_ext
@@ -4636,7 +4499,6 @@
   (exit $ac_status); } >/dev/null; then
   if test -s conftest.err; then
     ac_cpp_err=$ac_c_preproc_warn_flag
-    ac_cpp_err=$ac_cpp_err$ac_c_werror_flag
   else
     ac_cpp_err=
   fi
@@ -4656,32 +4518,33 @@
 echo "${ECHO_T}$ac_header_preproc" >&6
 
 # So?  What about this header?
-case $ac_header_compiler:$ac_header_preproc:$ac_c_preproc_warn_flag in
-  yes:no: )
+case $ac_header_compiler:$ac_header_preproc in
+  yes:no )
     { echo "$as_me:$LINENO: WARNING: $ac_header: accepted by the compiler, rejected by the preprocessor!" >&5
 echo "$as_me: WARNING: $ac_header: accepted by the compiler, rejected by the preprocessor!" >&2;}
-    { echo "$as_me:$LINENO: WARNING: $ac_header: proceeding with the compiler's result" >&5
-echo "$as_me: WARNING: $ac_header: proceeding with the compiler's result" >&2;}
-    ac_header_preproc=yes
+    { echo "$as_me:$LINENO: WARNING: $ac_header: proceeding with the preprocessor's result" >&5
+echo "$as_me: WARNING: $ac_header: proceeding with the preprocessor's result" >&2;}
+    (
+      cat <<\_ASBOX
+## ------------------------------------ ##
+## Report this to bug-autoconf@gnu.org. ##
+## ------------------------------------ ##
+_ASBOX
+    ) |
+      sed "s/^/$as_me: WARNING:     /" >&2
     ;;
-  no:yes:* )
+  no:yes )
     { echo "$as_me:$LINENO: WARNING: $ac_header: present but cannot be compiled" >&5
 echo "$as_me: WARNING: $ac_header: present but cannot be compiled" >&2;}
-    { echo "$as_me:$LINENO: WARNING: $ac_header:     check for missing prerequisite headers?" >&5
-echo "$as_me: WARNING: $ac_header:     check for missing prerequisite headers?" >&2;}
-    { echo "$as_me:$LINENO: WARNING: $ac_header: see the Autoconf documentation" >&5
-echo "$as_me: WARNING: $ac_header: see the Autoconf documentation" >&2;}
-    { echo "$as_me:$LINENO: WARNING: $ac_header:     section \"Present But Cannot Be Compiled\"" >&5
-echo "$as_me: WARNING: $ac_header:     section \"Present But Cannot Be Compiled\"" >&2;}
+    { echo "$as_me:$LINENO: WARNING: $ac_header: check for missing prerequisite headers?" >&5
+echo "$as_me: WARNING: $ac_header: check for missing prerequisite headers?" >&2;}
     { echo "$as_me:$LINENO: WARNING: $ac_header: proceeding with the preprocessor's result" >&5
 echo "$as_me: WARNING: $ac_header: proceeding with the preprocessor's result" >&2;}
-    { echo "$as_me:$LINENO: WARNING: $ac_header: in the future, the compiler will take precedence" >&5
-echo "$as_me: WARNING: $ac_header: in the future, the compiler will take precedence" >&2;}
     (
       cat <<\_ASBOX
-## ------------------------------------------ ##
-## Report this to the AC_PACKAGE_NAME lists.  ##
-## ------------------------------------------ ##
+## ------------------------------------ ##
+## Report this to bug-autoconf@gnu.org. ##
+## ------------------------------------ ##
 _ASBOX
     ) |
       sed "s/^/$as_me: WARNING:     /" >&2
@@ -4692,7 +4555,7 @@
 if eval "test \"\${$as_ac_Header+set}\" = set"; then
   echo $ECHO_N "(cached) $ECHO_C" >&6
 else
-  eval "$as_ac_Header=\$ac_header_preproc"
+  eval "$as_ac_Header=$ac_header_preproc"
 fi
 echo "$as_me:$LINENO: result: `eval echo '${'$as_ac_Header'}'`" >&5
 echo "${ECHO_T}`eval echo '${'$as_ac_Header'}'`" >&6
@@ -4826,6 +4689,7 @@
   echo $ECHO_N "(cached) $ECHO_C" >&6
 else
   cat >conftest.$ac_ext <<_ACEOF
+#line $LINENO "configure"
 /* confdefs.h.  */
 _ACEOF
 cat confdefs.h >>conftest.$ac_ext
@@ -4845,21 +4709,11 @@
 _ACEOF
 rm -f conftest.$ac_objext
 if { (eval echo "$as_me:$LINENO: \"$ac_compile\"") >&5
-  (eval $ac_compile) 2>conftest.er1
+  (eval $ac_compile) 2>&5
   ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
   echo "$as_me:$LINENO: \$? = $ac_status" >&5
   (exit $ac_status); } &&
-	 { ac_try='test -z "$ac_cxx_werror_flag"
-			 || test ! -s conftest.err'
-  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
-  (eval $ac_try) 2>&5
-  ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; } &&
-	 { ac_try='test -s conftest.$ac_objext'
+         { ac_try='test -s conftest.$ac_objext'
   { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
@@ -4872,7 +4726,7 @@
 
 ac_compiler_gnu=no
 fi
-rm -f conftest.err conftest.$ac_objext conftest.$ac_ext
+rm -f conftest.$ac_objext conftest.$ac_ext
 ac_cv_cxx_compiler_gnu=$ac_compiler_gnu
 
 fi
@@ -4888,6 +4742,7 @@
   echo $ECHO_N "(cached) $ECHO_C" >&6
 else
   cat >conftest.$ac_ext <<_ACEOF
+#line $LINENO "configure"
 /* confdefs.h.  */
 _ACEOF
 cat confdefs.h >>conftest.$ac_ext
@@ -4904,21 +4759,11 @@
 _ACEOF
 rm -f conftest.$ac_objext
 if { (eval echo "$as_me:$LINENO: \"$ac_compile\"") >&5
-  (eval $ac_compile) 2>conftest.er1
+  (eval $ac_compile) 2>&5
   ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
   echo "$as_me:$LINENO: \$? = $ac_status" >&5
   (exit $ac_status); } &&
-	 { ac_try='test -z "$ac_cxx_werror_flag"
-			 || test ! -s conftest.err'
-  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
-  (eval $ac_try) 2>&5
-  ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; } &&
-	 { ac_try='test -s conftest.$ac_objext'
+         { ac_try='test -s conftest.$ac_objext'
   { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
@@ -4931,7 +4776,7 @@
 
 ac_cv_prog_cxx_g=no
 fi
-rm -f conftest.err conftest.$ac_objext conftest.$ac_ext
+rm -f conftest.$ac_objext conftest.$ac_ext
 fi
 echo "$as_me:$LINENO: result: $ac_cv_prog_cxx_g" >&5
 echo "${ECHO_T}$ac_cv_prog_cxx_g" >&6
@@ -4951,7 +4796,8 @@
   fi
 fi
 for ac_declaration in \
-   '' \
+   ''\
+   '#include <stdlib.h>' \
    'extern "C" void std::exit (int) throw (); using std::exit;' \
    'extern "C" void std::exit (int); using std::exit;' \
    'extern "C" void exit (int) throw ();' \
@@ -4959,13 +4805,14 @@
    'void exit (int);'
 do
   cat >conftest.$ac_ext <<_ACEOF
+#line $LINENO "configure"
 /* confdefs.h.  */
 _ACEOF
 cat confdefs.h >>conftest.$ac_ext
 cat >>conftest.$ac_ext <<_ACEOF
 /* end confdefs.h.  */
-$ac_declaration
 #include <stdlib.h>
+$ac_declaration
 int
 main ()
 {
@@ -4976,21 +4823,11 @@
 _ACEOF
 rm -f conftest.$ac_objext
 if { (eval echo "$as_me:$LINENO: \"$ac_compile\"") >&5
-  (eval $ac_compile) 2>conftest.er1
+  (eval $ac_compile) 2>&5
   ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
   echo "$as_me:$LINENO: \$? = $ac_status" >&5
   (exit $ac_status); } &&
-	 { ac_try='test -z "$ac_cxx_werror_flag"
-			 || test ! -s conftest.err'
-  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
-  (eval $ac_try) 2>&5
-  ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; } &&
-	 { ac_try='test -s conftest.$ac_objext'
+         { ac_try='test -s conftest.$ac_objext'
   { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
@@ -5003,8 +4840,9 @@
 
 continue
 fi
-rm -f conftest.err conftest.$ac_objext conftest.$ac_ext
+rm -f conftest.$ac_objext conftest.$ac_ext
   cat >conftest.$ac_ext <<_ACEOF
+#line $LINENO "configure"
 /* confdefs.h.  */
 _ACEOF
 cat confdefs.h >>conftest.$ac_ext
@@ -5021,21 +4859,11 @@
 _ACEOF
 rm -f conftest.$ac_objext
 if { (eval echo "$as_me:$LINENO: \"$ac_compile\"") >&5
-  (eval $ac_compile) 2>conftest.er1
+  (eval $ac_compile) 2>&5
   ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
   echo "$as_me:$LINENO: \$? = $ac_status" >&5
   (exit $ac_status); } &&
-	 { ac_try='test -z "$ac_cxx_werror_flag"
-			 || test ! -s conftest.err'
-  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
-  (eval $ac_try) 2>&5
-  ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; } &&
-	 { ac_try='test -s conftest.$ac_objext'
+         { ac_try='test -s conftest.$ac_objext'
   { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
@@ -5047,7 +4875,7 @@
 sed 's/^/| /' conftest.$ac_ext >&5
 
 fi
-rm -f conftest.err conftest.$ac_objext conftest.$ac_ext
+rm -f conftest.$ac_objext conftest.$ac_ext
 done
 rm -f conftest*
 if test -n "$ac_declaration"; then
@@ -5131,12 +4959,7 @@
 CXXDEPMODE=depmode=$am_cv_CXX_dependencies_compiler_type
 
 
-
-
-if test -n "$CXX" && ( test "X$CXX" != "Xno" &&
-    ( (test "X$CXX" = "Xg++" && `g++ -v >/dev/null 2>&1` ) ||
-    (test "X$CXX" != "Xg++"))) ; then
-  ac_ext=cc
+ac_ext=cc
 ac_cpp='$CXXCPP $CPPFLAGS'
 ac_compile='$CXX -c $CXXFLAGS $CPPFLAGS conftest.$ac_ext >&5'
 ac_link='$CXX -o conftest$ac_exeext $CXXFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
@@ -5160,6 +4983,7 @@
   # On the NeXT, cc -E runs the code through the compiler's parser,
   # not just through cpp. "Syntax error" is here to catch this case.
   cat >conftest.$ac_ext <<_ACEOF
+#line $LINENO "configure"
 /* confdefs.h.  */
 _ACEOF
 cat confdefs.h >>conftest.$ac_ext
@@ -5170,7 +4994,7 @@
 #else
 # include <assert.h>
 #endif
-		     Syntax error
+                     Syntax error
 _ACEOF
 if { (eval echo "$as_me:$LINENO: \"$ac_cpp conftest.$ac_ext\"") >&5
   (eval $ac_cpp conftest.$ac_ext) 2>conftest.er1
@@ -5182,7 +5006,6 @@
   (exit $ac_status); } >/dev/null; then
   if test -s conftest.err; then
     ac_cpp_err=$ac_cxx_preproc_warn_flag
-    ac_cpp_err=$ac_cpp_err$ac_cxx_werror_flag
   else
     ac_cpp_err=
   fi
@@ -5203,6 +5026,7 @@
   # OK, works on sane cases.  Now check whether non-existent headers
   # can be detected and how.
   cat >conftest.$ac_ext <<_ACEOF
+#line $LINENO "configure"
 /* confdefs.h.  */
 _ACEOF
 cat confdefs.h >>conftest.$ac_ext
@@ -5220,7 +5044,6 @@
   (exit $ac_status); } >/dev/null; then
   if test -s conftest.err; then
     ac_cpp_err=$ac_cxx_preproc_warn_flag
-    ac_cpp_err=$ac_cpp_err$ac_cxx_werror_flag
   else
     ac_cpp_err=
   fi
@@ -5267,6 +5090,7 @@
   # On the NeXT, cc -E runs the code through the compiler's parser,
   # not just through cpp. "Syntax error" is here to catch this case.
   cat >conftest.$ac_ext <<_ACEOF
+#line $LINENO "configure"
 /* confdefs.h.  */
 _ACEOF
 cat confdefs.h >>conftest.$ac_ext
@@ -5277,7 +5101,7 @@
 #else
 # include <assert.h>
 #endif
-		     Syntax error
+                     Syntax error
 _ACEOF
 if { (eval echo "$as_me:$LINENO: \"$ac_cpp conftest.$ac_ext\"") >&5
   (eval $ac_cpp conftest.$ac_ext) 2>conftest.er1
@@ -5289,7 +5113,6 @@
   (exit $ac_status); } >/dev/null; then
   if test -s conftest.err; then
     ac_cpp_err=$ac_cxx_preproc_warn_flag
-    ac_cpp_err=$ac_cpp_err$ac_cxx_werror_flag
   else
     ac_cpp_err=
   fi
@@ -5310,6 +5133,7 @@
   # OK, works on sane cases.  Now check whether non-existent headers
   # can be detected and how.
   cat >conftest.$ac_ext <<_ACEOF
+#line $LINENO "configure"
 /* confdefs.h.  */
 _ACEOF
 cat confdefs.h >>conftest.$ac_ext
@@ -5327,7 +5151,6 @@
   (exit $ac_status); } >/dev/null; then
   if test -s conftest.err; then
     ac_cpp_err=$ac_cxx_preproc_warn_flag
-    ac_cpp_err=$ac_cpp_err$ac_cxx_werror_flag
   else
     ac_cpp_err=
   fi
@@ -5366,8 +5189,6 @@
 ac_link='$CXX -o conftest$ac_exeext $CXXFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
 ac_compiler_gnu=$ac_cv_cxx_compiler_gnu
 
-fi
-
 
 
 
@@ -5380,7 +5201,7 @@
   echo $ECHO_N "(cached) $ECHO_C" >&6
 else
     i=0
-  teststring="ABCD"
+  testring="ABCD"
 
   case $build_os in
   msdosdjgpp*)
@@ -5409,53 +5230,20 @@
     lt_cv_sys_max_cmd_len=8192;
     ;;
 
-  amigaos*)
-    # On AmigaOS with pdksh, this test takes hours, literally.
-    # So we just punt and use a minimum line length of 8192.
-    lt_cv_sys_max_cmd_len=8192;
-    ;;
-
-  netbsd* | freebsd* | openbsd* | darwin* | dragonfly*)
-    # This has been around since 386BSD, at least.  Likely further.
-    if test -x /sbin/sysctl; then
-      lt_cv_sys_max_cmd_len=`/sbin/sysctl -n kern.argmax`
-    elif test -x /usr/sbin/sysctl; then
-      lt_cv_sys_max_cmd_len=`/usr/sbin/sysctl -n kern.argmax`
-    else
-      lt_cv_sys_max_cmd_len=65536	# usable default for all BSDs
-    fi
-    # And add a safety zone
-    lt_cv_sys_max_cmd_len=`expr $lt_cv_sys_max_cmd_len \/ 4`
-    lt_cv_sys_max_cmd_len=`expr $lt_cv_sys_max_cmd_len \* 3`
-    ;;
-  osf*)
-    # Dr. Hans Ekkehard Plesser reports seeing a kernel panic running configure
-    # due to this test when exec_disable_arg_limit is 1 on Tru64. It is not
-    # nice to cause kernel panics so lets avoid the loop below.
-    # First set a reasonable default.
-    lt_cv_sys_max_cmd_len=16384
-    #
-    if test -x /sbin/sysconfig; then
-      case `/sbin/sysconfig -q proc exec_disable_arg_limit` in
-        *1*) lt_cv_sys_max_cmd_len=-1 ;;
-      esac
-    fi
-    ;;
-  *)
+ *)
     # If test is not a shell built-in, we'll probably end up computing a
     # maximum length that is only half of the actual maximum length, but
     # we can't tell.
-    SHELL=${SHELL-${CONFIG_SHELL-/bin/sh}}
-    while (test "X"`$SHELL $0 --fallback-echo "X$teststring" 2>/dev/null` \
-	       = "XX$teststring") >/dev/null 2>&1 &&
-	    new_result=`expr "X$teststring" : ".*" 2>&1` &&
+    while (test "X"`$CONFIG_SHELL $0 --fallback-echo "X$testring" 2>/dev/null` \
+	       = "XX$testring") >/dev/null 2>&1 &&
+	    new_result=`expr "X$testring" : ".*" 2>&1` &&
 	    lt_cv_sys_max_cmd_len=$new_result &&
 	    test $i != 17 # 1/2 MB should be enough
     do
       i=`expr $i + 1`
-      teststring=$teststring$teststring
+      testring=$testring$testring
     done
-    teststring=
+    testring=
     # Add a significant safety factor because C++ compilers can tack on massive
     # amounts of additional arguments before passing them to the linker.
     # It appears as though 1/2 is a usable value.
@@ -5492,6 +5280,9 @@
 # Regexp to match symbols that can be accessed directly from C.
 sympat='\([_A-Za-z][_A-Za-z0-9]*\)'
 
+# Transform the above into a raw symbol and a C symbol.
+symxfrm='\1 \2\3 \3'
+
 # Transform an extracted symbol line into a proper C declaration
 lt_cv_sys_global_symbol_to_cdecl="sed -n -e 's/^. .* \(.*\)$/extern int \1;/p'"
 
@@ -5513,13 +5304,6 @@
   lt_cv_sys_global_symbol_to_cdecl="sed -n -e 's/^T .* \(.*\)$/extern int \1();/p' -e 's/^$symcode* .* \(.*\)$/extern char \1;/p'"
   lt_cv_sys_global_symbol_to_c_name_address="sed -n -e 's/^: \([^ ]*\) $/  {\\\"\1\\\", (lt_ptr) 0},/p' -e 's/^$symcode* \([^ ]*\) \([^ ]*\)$/  {\"\2\", (lt_ptr) \&\2},/p'"
   ;;
-linux*)
-  if test "$host_cpu" = ia64; then
-    symcode='[ABCDGIRSTW]'
-    lt_cv_sys_global_symbol_to_cdecl="sed -n -e 's/^T .* \(.*\)$/extern int \1();/p' -e 's/^$symcode* .* \(.*\)$/extern char \1;/p'"
-    lt_cv_sys_global_symbol_to_c_name_address="sed -n -e 's/^: \([^ ]*\) $/  {\\\"\1\\\", (lt_ptr) 0},/p' -e 's/^$symcode* \([^ ]*\) \([^ ]*\)$/  {\"\2\", (lt_ptr) \&\2},/p'"
-  fi
-  ;;
 irix* | nonstopux*)
   symcode='[BCDEGRST]'
   ;;
@@ -5527,7 +5311,7 @@
   symcode='[BCDEGQRST]'
   ;;
 solaris* | sysv5*)
-  symcode='[BDRT]'
+  symcode='[BDT]'
   ;;
 sysv4)
   symcode='[DFNSTU]'
@@ -5545,17 +5329,14 @@
 # If we're using GNU nm, then use its standard symbol codes.
 case `$NM -V 2>&1` in
 *GNU* | *'with BFD'*)
-  symcode='[ABCDGIRSTW]' ;;
+  symcode='[ABCDGISTW]' ;;
 esac
 
 # Try without a prefix undercore, then with it.
 for ac_symprfx in "" "_"; do
 
-  # Transform symcode, sympat, and symprfx into a raw symbol and a C symbol.
-  symxfrm="\\1 $ac_symprfx\\2 \\2"
-
   # Write the raw and C identifiers.
-  lt_cv_sys_global_symbol_pipe="sed -n -e 's/^.*[ 	]\($symcode$symcode*\)[ 	][ 	]*$ac_symprfx$sympat$opt_cr$/$symxfrm/p'"
+  lt_cv_sys_global_symbol_pipe="sed -n -e 's/^.*[ 	]\($symcode$symcode*\)[ 	][ 	]*\($ac_symprfx\)$sympat$opt_cr$/$symxfrm/p'"
 
   # Check to see that the pipe works correctly.
   pipe_works=no
@@ -5717,7 +5498,7 @@
 
 # Sed substitution that helps us do robust quoting.  It backslashifies
 # metacharacters that are still active within double-quoted strings.
-Xsed='sed -e 1s/^X//'
+Xsed='sed -e s/^X//'
 sed_quote_subst='s/\([\\"\\`$\\\\]\)/\\\1/g'
 
 # Same as above, but do not quote variable references.
@@ -5727,6 +5508,9 @@
 # double_quote_subst'ed string.
 delay_variable_subst='s/\\\\\\\\\\\$/\\\\\\$/g'
 
+# Sed substitution to undo escaping of the cmd sep variable
+unescape_variable_subst='s/\\\(${_S_}\)/\1/g'
+
 # Sed substitution to avoid accidental globbing in evaled expressions
 no_glob_subst='s/\*/\\\*/g'
 
@@ -5737,7 +5521,7 @@
 default_ofile=libtool
 can_build_shared=yes
 
-# All known linkers require a `.a' archive for static linking (except MSVC,
+# All known linkers require a `.a' archive for static linking (except M$VC,
 # which needs '.lib').
 libext=a
 ltmain="$ac_aux_dir/ltmain.sh"
@@ -6013,26 +5797,15 @@
 if test -n "$RANLIB"; then
   case $host_os in
   openbsd*)
-    old_postinstall_cmds="\$RANLIB -t \$oldlib~$old_postinstall_cmds"
+    old_postinstall_cmds="\$RANLIB -t \$oldlib\${_S_}$old_postinstall_cmds"
     ;;
   *)
-    old_postinstall_cmds="\$RANLIB \$oldlib~$old_postinstall_cmds"
+    old_postinstall_cmds="\$RANLIB \$oldlib\${_S_}$old_postinstall_cmds"
     ;;
   esac
-  old_archive_cmds="$old_archive_cmds~\$RANLIB \$oldlib"
+  old_archive_cmds="$old_archive_cmds\${_S_}\$RANLIB \$oldlib"
 fi
 
-for cc_temp in $compiler""; do
-  case $cc_temp in
-    compile | *[\\/]compile | ccache | *[\\/]ccache ) ;;
-    distcc | *[\\/]distcc | purify | *[\\/]purify ) ;;
-    \-*) ;;
-    *) break;;
-  esac
-done
-cc_basename=`$echo "X$cc_temp" | $Xsed -e 's%.*/%%' -e "s%^$host_alias-%%"`
-
-
 # Only perform the check for file, if the check method requires it
 case $deplibs_check_method in
 file_magic*)
@@ -6058,7 +5831,7 @@
       if test -n "$file_magic_test_file"; then
 	case $deplibs_check_method in
 	"file_magic "*)
-	  file_magic_regex=`expr "$deplibs_check_method" : "file_magic \(.*\)"`
+	  file_magic_regex="`expr \"$deplibs_check_method\" : \"file_magic \(.*\)\"`"
 	  MAGIC_CMD="$lt_cv_path_MAGIC_CMD"
 	  if eval $file_magic_cmd \$file_magic_test_file 2> /dev/null |
 	    $EGREP "$file_magic_regex" > /dev/null; then
@@ -6120,7 +5893,7 @@
       if test -n "$file_magic_test_file"; then
 	case $deplibs_check_method in
 	"file_magic "*)
-	  file_magic_regex=`expr "$deplibs_check_method" : "file_magic \(.*\)"`
+	  file_magic_regex="`expr \"$deplibs_check_method\" : \"file_magic \(.*\)\"`"
 	  MAGIC_CMD="$lt_cv_path_MAGIC_CMD"
 	  if eval $file_magic_cmd \$file_magic_test_file 2> /dev/null |
 	    $EGREP "$file_magic_regex" > /dev/null; then
@@ -6219,20 +5992,6 @@
 compiler=$CC
 
 
-# save warnings/boilerplate of simple test code
-ac_outfile=conftest.$ac_objext
-printf "$lt_simple_compile_test_code" >conftest.$ac_ext
-eval "$ac_compile" 2>&1 >/dev/null | $SED '/^$/d' >conftest.err
-_lt_compiler_boilerplate=`cat conftest.err`
-$rm conftest*
-
-ac_outfile=conftest.$ac_objext
-printf "$lt_simple_link_test_code" >conftest.$ac_ext
-eval "$ac_link" 2>&1 >/dev/null | $SED '/^$/d' >conftest.err
-_lt_linker_boilerplate=`cat conftest.err`
-$rm conftest*
-
-
 #
 # Check for any special shared library compilation flags.
 #
@@ -6269,16 +6028,11 @@
    LDFLAGS="$LDFLAGS $lt_prog_compiler_static"
    printf "$lt_simple_link_test_code" > conftest.$ac_ext
    if (eval $ac_link 2>conftest.err) && test -s conftest$ac_exeext; then
-     # The linker can only warn and ignore the option if not recognized
+     # The compiler can only warn and ignore the option if not recognized
      # So say no if there are warnings
      if test -s conftest.err; then
        # Append any errors to the config.log.
        cat conftest.err 1>&5
-       $echo "X$_lt_linker_boilerplate" | $Xsed > conftest.exp
-       $SED '/^$/d' conftest.err >conftest.er2
-       if diff conftest.exp conftest.er2 >/dev/null; then
-         lt_prog_compiler_static_works=yes
-       fi
      else
        lt_prog_compiler_static_works=yes
      fi
@@ -6304,8 +6058,7 @@
 if test "$GCC" = yes; then
   lt_prog_compiler_no_builtin_flag=' -fno-builtin'
 
-
-echo "$as_me:$LINENO: checking if $compiler supports -fno-rtti -fno-exceptions" >&5
+  echo "$as_me:$LINENO: checking if $compiler supports -fno-rtti -fno-exceptions" >&5
 echo $ECHO_N "checking if $compiler supports -fno-rtti -fno-exceptions... $ECHO_C" >&6
 if test "${lt_cv_prog_compiler_rtti_exceptions+set}" = set; then
   echo $ECHO_N "(cached) $ECHO_C" >&6
@@ -6320,20 +6073,18 @@
    # with a dollar sign (not a hyphen), so the echo should work correctly.
    # The option is referenced via a variable to avoid confusing sed.
    lt_compile=`echo "$ac_compile" | $SED \
-   -e 's:.*FLAGS}\{0,1\} :&$lt_compiler_flag :; t' \
+   -e 's:.*FLAGS}? :&$lt_compiler_flag :; t' \
    -e 's: [^ ]*conftest\.: $lt_compiler_flag&:; t' \
    -e 's:$: $lt_compiler_flag:'`
-   (eval echo "\"\$as_me:6326: $lt_compile\"" >&5)
+   (eval echo "\"\$as_me:6079: $lt_compile\"" >&5)
    (eval "$lt_compile" 2>conftest.err)
    ac_status=$?
    cat conftest.err >&5
-   echo "$as_me:6330: \$? = $ac_status" >&5
+   echo "$as_me:6083: \$? = $ac_status" >&5
    if (exit $ac_status) && test -s "$ac_outfile"; then
      # The compiler can only warn and ignore the option if not recognized
-     # So say no if there are warnings other than the usual output.
-     $echo "X$_lt_compiler_boilerplate" | $Xsed >conftest.exp
-     $SED '/^$/d' conftest.err >conftest.er2
-     if test ! -s conftest.err || diff conftest.exp conftest.er2 >/dev/null; then
+     # So say no if there are warnings
+     if test ! -s conftest.err; then
        lt_cv_prog_compiler_rtti_exceptions=yes
      fi
    fi
@@ -6410,7 +6161,7 @@
     hpux*)
       # PIC is the default for IA64 HP-UX and 64-bit HP-UX, but
       # not for PA HP-UX.
-      case $host_cpu in
+      case "$host_cpu" in
       hppa*64*|ia64*)
 	# +Z the default
 	;;
@@ -6436,16 +6187,6 @@
 	lt_prog_compiler_static='-bnso -bI:/lib/syscalls.exp'
       fi
       ;;
-      darwin*)
-        # PIC is the default on this platform
-        # Common symbols not allowed in MH_DYLIB files
-       case $cc_basename in
-         xlc* | xlf* )
-         lt_prog_compiler_pic='-qnocommon'
-         lt_prog_compiler_wl='-Wl,'
-         ;;
-       esac
-       ;;
 
     mingw* | pw32* | os2*)
       # This hack is so that the source file can tell whether it is being
@@ -6453,11 +6194,24 @@
       lt_prog_compiler_pic='-DDLL_EXPORT'
       ;;
 
+    darwin* | rhapsody*)
+      # PIC is the default on this platform
+      # Common symbols not allowed in MH_DYLIB files
+        case $CC in
+          *xlc* )
+          lt_prog_compiler_pic='-qpic -qnocommon'
+          ;;
+          *xlf* )
+          lt_prog_compiler_pic='-qpic -qnocommon'
+          ;;
+        esac
+      ;;
+
     hpux9* | hpux10* | hpux11*)
       lt_prog_compiler_wl='-Wl,'
       # PIC is the default for IA64 HP-UX and 64-bit HP-UX, but
       # not for PA HP-UX.
-      case $host_cpu in
+      case "$host_cpu" in
       hppa*64*|ia64*)
 	# +Z the default
 	;;
@@ -6481,20 +6235,13 @@
       ;;
 
     linux*)
-      case $cc_basename in
-      icc* | ecc*)
+      case $CC in
+      icc|ecc)
 	lt_prog_compiler_wl='-Wl,'
 	lt_prog_compiler_pic='-KPIC'
 	lt_prog_compiler_static='-static'
         ;;
-      pgcc* | pgf77* | pgf90* | pgf95*)
-        # Portland Group compilers (*not* the Pentium gcc compiler,
-	# which looks to be a dead project)
-	lt_prog_compiler_wl='-Wl,'
-	lt_prog_compiler_pic='-fpic'
-	lt_prog_compiler_static='-Bstatic'
-        ;;
-      ccc*)
+      ccc)
         lt_prog_compiler_wl='-Wl,'
         # All Alpha code is PIC.
         lt_prog_compiler_static='-non_shared'
@@ -6514,14 +6261,9 @@
       ;;
 
     solaris*)
+      lt_prog_compiler_wl='-Wl,'
       lt_prog_compiler_pic='-KPIC'
       lt_prog_compiler_static='-Bstatic'
-      case $cc_basename in
-      f77* | f90* | f95*)
-	lt_prog_compiler_wl='-Qoption ld ';;
-      *)
-	lt_prog_compiler_wl='-Wl,';;
-      esac
       ;;
 
     sunos4*)
@@ -6543,11 +6285,6 @@
       fi
       ;;
 
-    unicos*)
-      lt_prog_compiler_wl='-Wl,'
-      lt_prog_compiler_can_build_shared=no
-      ;;
-
     uts4*)
       lt_prog_compiler_pic='-pic'
       lt_prog_compiler_static='-Bstatic'
@@ -6566,8 +6303,7 @@
 # Check to make sure the PIC flag actually works.
 #
 if test -n "$lt_prog_compiler_pic"; then
-
-echo "$as_me:$LINENO: checking if $compiler PIC flag $lt_prog_compiler_pic works" >&5
+  echo "$as_me:$LINENO: checking if $compiler PIC flag $lt_prog_compiler_pic works" >&5
 echo $ECHO_N "checking if $compiler PIC flag $lt_prog_compiler_pic works... $ECHO_C" >&6
 if test "${lt_prog_compiler_pic_works+set}" = set; then
   echo $ECHO_N "(cached) $ECHO_C" >&6
@@ -6582,20 +6318,18 @@
    # with a dollar sign (not a hyphen), so the echo should work correctly.
    # The option is referenced via a variable to avoid confusing sed.
    lt_compile=`echo "$ac_compile" | $SED \
-   -e 's:.*FLAGS}\{0,1\} :&$lt_compiler_flag :; t' \
+   -e 's:.*FLAGS}? :&$lt_compiler_flag :; t' \
    -e 's: [^ ]*conftest\.: $lt_compiler_flag&:; t' \
    -e 's:$: $lt_compiler_flag:'`
-   (eval echo "\"\$as_me:6588: $lt_compile\"" >&5)
+   (eval echo "\"\$as_me:6324: $lt_compile\"" >&5)
    (eval "$lt_compile" 2>conftest.err)
    ac_status=$?
    cat conftest.err >&5
-   echo "$as_me:6592: \$? = $ac_status" >&5
+   echo "$as_me:6328: \$? = $ac_status" >&5
    if (exit $ac_status) && test -s "$ac_outfile"; then
      # The compiler can only warn and ignore the option if not recognized
-     # So say no if there are warnings other than the usual output.
-     $echo "X$_lt_compiler_boilerplate" | $Xsed >conftest.exp
-     $SED '/^$/d' conftest.err >conftest.er2
-     if test ! -s conftest.err || diff conftest.exp conftest.er2 >/dev/null; then
+     # So say no if there are warnings
+     if test ! -s conftest.err; then
        lt_prog_compiler_pic_works=yes
      fi
    fi
@@ -6616,7 +6350,7 @@
 fi
 
 fi
-case $host_os in
+case "$host_os" in
   # For platforms which do not support PIC, -DPIC is meaningless:
   *djgpp*)
     lt_prog_compiler_pic=
@@ -6638,36 +6372,38 @@
    mkdir out
    printf "$lt_simple_compile_test_code" > conftest.$ac_ext
 
+   # According to Tom Tromey, Ian Lance Taylor reported there are C compilers
+   # that will create temporary files in the current directory regardless of
+   # the output directory.  Thus, making CWD read-only will cause this test
+   # to fail, enabling locking or at least warning the user not to do parallel
+   # builds.
+   chmod -w .
+
    lt_compiler_flag="-o out/conftest2.$ac_objext"
    # Insert the option either (1) after the last *FLAGS variable, or
    # (2) before a word containing "conftest.", or (3) at the end.
    # Note that $ac_compile itself does not contain backslashes and begins
    # with a dollar sign (not a hyphen), so the echo should work correctly.
    lt_compile=`echo "$ac_compile" | $SED \
-   -e 's:.*FLAGS}\{0,1\} :&$lt_compiler_flag :; t' \
+   -e 's:.*FLAGS}? :&$lt_compiler_flag :; t' \
    -e 's: [^ ]*conftest\.: $lt_compiler_flag&:; t' \
    -e 's:$: $lt_compiler_flag:'`
-   (eval echo "\"\$as_me:6650: $lt_compile\"" >&5)
+   (eval echo "\"\$as_me:6391: $lt_compile\"" >&5)
    (eval "$lt_compile" 2>out/conftest.err)
    ac_status=$?
    cat out/conftest.err >&5
-   echo "$as_me:6654: \$? = $ac_status" >&5
+   echo "$as_me:6395: \$? = $ac_status" >&5
    if (exit $ac_status) && test -s out/conftest2.$ac_objext
    then
      # The compiler can only warn and ignore the option if not recognized
      # So say no if there are warnings
-     $echo "X$_lt_compiler_boilerplate" | $Xsed > out/conftest.exp
-     $SED '/^$/d' out/conftest.err >out/conftest.er2
-     if test ! -s out/conftest.err || diff out/conftest.exp out/conftest.er2 >/dev/null; then
+     if test ! -s out/conftest.err; then
        lt_cv_prog_compiler_c_o=yes
      fi
    fi
-   chmod u+w . 2>&5
-   $rm conftest*
-   # SGI C++ compiler will create directory out/ii_files/ for
-   # template instantiation
-   test -d out/ii_files && $rm out/ii_files/* && rmdir out/ii_files
-   $rm out/* && rmdir out
+   chmod u+w .
+   $rm conftest* out/*
+   rmdir out
    cd ..
    rmdir conftest
    $rm conftest*
@@ -6738,16 +6474,6 @@
   # rely on this symbol name, it's probably fine to never include it in
   # preloaded symbol tables.
   extract_expsyms_cmds=
-  # Just being paranoid about ensuring that cc_basename is set.
-  for cc_temp in $compiler""; do
-  case $cc_temp in
-    compile | *[\\/]compile | ccache | *[\\/]ccache ) ;;
-    distcc | *[\\/]distcc | purify | *[\\/]purify ) ;;
-    \-*) ;;
-    *) break;;
-  esac
-done
-cc_basename=`$echo "X$cc_temp" | $Xsed -e 's%.*/%%' -e "s%^$host_alias-%%"`
 
   case $host_os in
   cygwin* | mingw* | pw32*)
@@ -6768,27 +6494,6 @@
     # If archive_cmds runs LD, not CC, wlarc should be empty
     wlarc='${wl}'
 
-    # Set some defaults for GNU ld with shared library support. These
-    # are reset later if shared libraries are not supported. Putting them
-    # here allows them to be overridden if necessary.
-    runpath_var=LD_RUN_PATH
-    hardcode_libdir_flag_spec='${wl}--rpath ${wl}$libdir'
-    export_dynamic_flag_spec='${wl}--export-dynamic'
-    # ancient GNU ld didn't support --whole-archive et. al.
-    if $LD --help 2>&1 | grep 'no-whole-archive' > /dev/null; then
-	whole_archive_flag_spec="$wlarc"'--whole-archive$convenience '"$wlarc"'--no-whole-archive'
-      else
-  	whole_archive_flag_spec=
-    fi
-    supports_anon_versioning=no
-    case `$LD -v 2>/dev/null` in
-      *\ [01].* | *\ 2.[0-9].* | *\ 2.10.*) ;; # catch versions < 2.11
-      *\ 2.11.93.0.2\ *) supports_anon_versioning=yes ;; # RH7.3 ...
-      *\ 2.11.92.0.12\ *) supports_anon_versioning=yes ;; # Mandrake 8.2 ...
-      *\ 2.11.*) ;; # other 2.11 versions
-      *) supports_anon_versioning=yes ;;
-    esac
-
     # See if GNU ld supports shared libraries.
     case $host_os in
     aix3* | aix4* | aix5*)
@@ -6808,7 +6513,7 @@
       ;;
 
     amigaos*)
-      archive_cmds='$rm $output_objdir/a2ixlibrary.data~$echo "#define NAME $libname" > $output_objdir/a2ixlibrary.data~$echo "#define LIBRARY_ID 1" >> $output_objdir/a2ixlibrary.data~$echo "#define VERSION $major" >> $output_objdir/a2ixlibrary.data~$echo "#define REVISION $revision" >> $output_objdir/a2ixlibrary.data~$AR $AR_FLAGS $lib $libobjs~$RANLIB $lib~(cd $output_objdir && a2ixlibrary -32)'
+      archive_cmds='$rm $output_objdir/a2ixlibrary.data${_S_}$echo "#define NAME $libname" > $output_objdir/a2ixlibrary.data${_S_}$echo "#define LIBRARY_ID 1" >> $output_objdir/a2ixlibrary.data${_S_}$echo "#define VERSION $major" >> $output_objdir/a2ixlibrary.data${_S_}$echo "#define REVISION $revision" >> $output_objdir/a2ixlibrary.data${_S_}$AR $AR_FLAGS $lib $libobjs${_S_}$RANLIB $lib${_S_}(cd $output_objdir && a2ixlibrary -32)'
       hardcode_libdir_flag_spec='-L$libdir'
       hardcode_minus_L=yes
 
@@ -6839,7 +6544,7 @@
       allow_undefined_flag=unsupported
       always_export_symbols=no
       enable_shared_with_static_runtimes=yes
-      export_symbols_cmds='$NM $libobjs $convenience | $global_symbol_pipe | $SED -e '\''/^[BCDGRS] /s/.* \([^ ]*\)/\1 DATA/'\'' | $SED -e '\''/^[AITW] /s/.* //'\'' | sort | uniq > $export_symbols'
+      export_symbols_cmds='$NM $libobjs $convenience | $global_symbol_pipe | $SED -e '\''/^[BCDGS] /s/.* \([^ ]*\)/\1 DATA/'\'' | $SED -e '\''/^[AITW] /s/.* //'\'' | sort | uniq > $export_symbols'
 
       if $LD --help 2>&1 | grep 'auto-import' > /dev/null; then
         archive_cmds='$CC -shared $libobjs $deplibs $compiler_flags -o $output_objdir/$soname ${wl}--image-base=0x10000000 ${wl}--out-implib,$lib'
@@ -6850,50 +6555,13 @@
 	else
 	  echo EXPORTS > $output_objdir/$soname.def;
 	  cat $export_symbols >> $output_objdir/$soname.def;
-	fi~
+	fi${_S_}
 	$CC -shared $output_objdir/$soname.def $libobjs $deplibs $compiler_flags -o $output_objdir/$soname ${wl}--image-base=0x10000000  ${wl}--out-implib,$lib'
       else
 	ld_shlibs=no
       fi
       ;;
 
-    linux*)
-      if $LD --help 2>&1 | grep ': supported targets:.* elf' > /dev/null; then
-	tmp_addflag=
-	case $cc_basename,$host_cpu in
-	pgcc*)				# Portland Group C compiler
-	  whole_archive_flag_spec='${wl}--whole-archive`for conv in $convenience\"\"; do test  -n \"$conv\" && new_convenience=\"$new_convenience,$conv\"; done; $echo \"$new_convenience\"` ${wl}--no-whole-archive'
-	  tmp_addflag=' $pic_flag'
-	  ;;
-	pgf77* | pgf90* | pgf95*)	# Portland Group f77 and f90 compilers
-	  whole_archive_flag_spec='${wl}--whole-archive`for conv in $convenience\"\"; do test  -n \"$conv\" && new_convenience=\"$new_convenience,$conv\"; done; $echo \"$new_convenience\"` ${wl}--no-whole-archive'
-	  tmp_addflag=' $pic_flag -Mnomain' ;;
-	ecc*,ia64* | icc*,ia64*)		# Intel C compiler on ia64
-	  tmp_addflag=' -i_dynamic' ;;
-	efc*,ia64* | ifort*,ia64*)	# Intel Fortran compiler on ia64
-	  tmp_addflag=' -i_dynamic -nofor_main' ;;
-	ifc* | ifort*)			# Intel Fortran compiler
-	  tmp_addflag=' -nofor_main' ;;
-	esac
-	archive_cmds='$CC -shared'"$tmp_addflag"' $libobjs $deplibs $compiler_flags ${wl}-soname $wl$soname -o $lib'
-
-	if test $supports_anon_versioning = yes; then
-	  archive_expsym_cmds='$echo "{ global:" > $output_objdir/$libname.ver~
-  cat $export_symbols | sed -e "s/\(.*\)/\1;/" >> $output_objdir/$libname.ver~
-  $echo "local: *; };" >> $output_objdir/$libname.ver~
-	  $CC -shared'"$tmp_addflag"' $libobjs $deplibs $compiler_flags ${wl}-soname $wl$soname ${wl}-version-script ${wl}$output_objdir/$libname.ver -o $lib'
-	fi
-
-# icc does not like -lc for shared libraries
-        case $cc_basename in
-          ecc* | icc* ) archive_cmds_need_lc=no ;;
-        esac
-
-      else
-	ld_shlibs=no
-      fi
-      ;;
-
     netbsd*)
       if echo __ELF__ | $CC -E - | grep __ELF__ >/dev/null; then
 	archive_cmds='$LD -Bshareable $libobjs $deplibs $linker_flags -o $lib'
@@ -6942,11 +6610,16 @@
       ;;
     esac
 
-    if test "$ld_shlibs" = no; then
-      runpath_var=
-      hardcode_libdir_flag_spec=
-      export_dynamic_flag_spec=
-      whole_archive_flag_spec=
+    if test "$ld_shlibs" = yes; then
+      runpath_var=LD_RUN_PATH
+      hardcode_libdir_flag_spec='${wl}--rpath ${wl}$libdir'
+      export_dynamic_flag_spec='${wl}--export-dynamic'
+      # ancient GNU ld didn't support --whole-archive et. al.
+      if $LD --help 2>&1 | grep 'no-whole-archive' > /dev/null; then
+ 	whole_archive_flag_spec="$wlarc"'--whole-archive$convenience '"$wlarc"'--no-whole-archive'
+      else
+  	whole_archive_flag_spec=
+      fi
     fi
   else
     # PORTME fill in a description of your system's linker (not GNU ld)
@@ -6954,7 +6627,7 @@
     aix3*)
       allow_undefined_flag=unsupported
       always_export_symbols=yes
-      archive_expsym_cmds='$LD -o $output_objdir/$soname $libobjs $deplibs $linker_flags -bE:$export_symbols -T512 -H512 -bM:SRE~$AR $AR_FLAGS $lib $output_objdir/$soname'
+      archive_expsym_cmds='$LD -o $output_objdir/$soname $libobjs $deplibs $linker_flags -bE:$export_symbols -T512 -H512 -bM:SRE${_S_}$AR $AR_FLAGS $lib $output_objdir/$soname'
       # Note: this linker hardcodes the directories in LIBPATH if there
       # are no directories specified by -L.
       hardcode_minus_L=yes
@@ -7010,7 +6683,7 @@
       link_all_deplibs=yes
 
       if test "$GCC" = yes; then
-	case $host_os in aix4.[012]|aix4.[012].*)
+	case $host_os in aix4.012|aix4.012.*)
 	# We only want to do this on AIX 4.2 and lower, the check
 	# below for broken collect2 doesn't work under 4.3+
 	  collect2name=`${CC} -print-prog-name=collect2`
@@ -7031,9 +6704,6 @@
 	  fi
 	esac
 	shared_flag='-shared'
-	if test "$aix_use_runtimelinking" = yes; then
-	  shared_flag="$shared_flag "'${wl}-G'
-	fi
       else
 	# not using gcc
 	if test "$host_cpu" = ia64; then
@@ -7058,6 +6728,7 @@
 	allow_undefined_flag='-berok'
        # Determine the default libpath from the value encoded in an empty executable.
        cat >conftest.$ac_ext <<_ACEOF
+#line $LINENO "configure"
 /* confdefs.h.  */
 _ACEOF
 cat confdefs.h >>conftest.$ac_ext
@@ -7074,21 +6745,11 @@
 _ACEOF
 rm -f conftest.$ac_objext conftest$ac_exeext
 if { (eval echo "$as_me:$LINENO: \"$ac_link\"") >&5
-  (eval $ac_link) 2>conftest.er1
+  (eval $ac_link) 2>&5
   ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
   echo "$as_me:$LINENO: \$? = $ac_status" >&5
   (exit $ac_status); } &&
-	 { ac_try='test -z "$ac_c_werror_flag"
-			 || test ! -s conftest.err'
-  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
-  (eval $ac_try) 2>&5
-  ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; } &&
-	 { ac_try='test -s conftest$ac_exeext'
+         { ac_try='test -s conftest$ac_exeext'
   { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
@@ -7105,8 +6766,7 @@
 sed 's/^/| /' conftest.$ac_ext >&5
 
 fi
-rm -f conftest.err conftest.$ac_objext \
-      conftest$ac_exeext conftest.$ac_ext
+rm -f conftest.$ac_objext conftest$ac_exeext conftest.$ac_ext
 if test -z "$aix_libpath"; then aix_libpath="/usr/lib:/lib"; fi
 
        hardcode_libdir_flag_spec='${wl}-blibpath:$libdir:'"$aix_libpath"
@@ -7119,6 +6779,7 @@
 	else
 	 # Determine the default libpath from the value encoded in an empty executable.
 	 cat >conftest.$ac_ext <<_ACEOF
+#line $LINENO "configure"
 /* confdefs.h.  */
 _ACEOF
 cat confdefs.h >>conftest.$ac_ext
@@ -7135,21 +6796,11 @@
 _ACEOF
 rm -f conftest.$ac_objext conftest$ac_exeext
 if { (eval echo "$as_me:$LINENO: \"$ac_link\"") >&5
-  (eval $ac_link) 2>conftest.er1
+  (eval $ac_link) 2>&5
   ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
   echo "$as_me:$LINENO: \$? = $ac_status" >&5
   (exit $ac_status); } &&
-	 { ac_try='test -z "$ac_c_werror_flag"
-			 || test ! -s conftest.err'
-  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
-  (eval $ac_try) 2>&5
-  ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; } &&
-	 { ac_try='test -s conftest$ac_exeext'
+         { ac_try='test -s conftest$ac_exeext'
   { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
@@ -7166,8 +6817,7 @@
 sed 's/^/| /' conftest.$ac_ext >&5
 
 fi
-rm -f conftest.err conftest.$ac_objext \
-      conftest$ac_exeext conftest.$ac_ext
+rm -f conftest.$ac_objext conftest$ac_exeext conftest.$ac_ext
 if test -z "$aix_libpath"; then aix_libpath="/usr/lib:/lib"; fi
 
 	 hardcode_libdir_flag_spec='${wl}-blibpath:$libdir:'"$aix_libpath"
@@ -7180,21 +6830,21 @@
 	  # Exported symbols can be pulled into shared objects from archives
 	  whole_archive_flag_spec=' '
 	  archive_cmds_need_lc=yes
-	  # This is similar to how AIX traditionally builds its shared libraries.
-	  archive_expsym_cmds="\$CC $shared_flag"' -o $output_objdir/$soname $libobjs $deplibs $compiler_flags ${wl}-bE:$export_symbols ${wl}-bnoentry${allow_undefined_flag}~$AR $AR_FLAGS $output_objdir/$libname$release.a $output_objdir/$soname'
+	  # This is similar to how AIX traditionally builds it's shared libraries.
+	  archive_expsym_cmds="\$CC $shared_flag"' -o $output_objdir/$soname $libobjs $deplibs $compiler_flags ${wl}-bE:$export_symbols ${wl}-bnoentry${allow_undefined_flag}\${_S_}$AR $AR_FLAGS $output_objdir/$libname$release.a $output_objdir/$soname'
 	fi
       fi
       ;;
 
     amigaos*)
-      archive_cmds='$rm $output_objdir/a2ixlibrary.data~$echo "#define NAME $libname" > $output_objdir/a2ixlibrary.data~$echo "#define LIBRARY_ID 1" >> $output_objdir/a2ixlibrary.data~$echo "#define VERSION $major" >> $output_objdir/a2ixlibrary.data~$echo "#define REVISION $revision" >> $output_objdir/a2ixlibrary.data~$AR $AR_FLAGS $lib $libobjs~$RANLIB $lib~(cd $output_objdir && a2ixlibrary -32)'
+      archive_cmds='$rm $output_objdir/a2ixlibrary.data${_S_}$echo "#define NAME $libname" > $output_objdir/a2ixlibrary.data${_S_}$echo "#define LIBRARY_ID 1" >> $output_objdir/a2ixlibrary.data${_S_}$echo "#define VERSION $major" >> $output_objdir/a2ixlibrary.data${_S_}$echo "#define REVISION $revision" >> $output_objdir/a2ixlibrary.data${_S_}$AR $AR_FLAGS $lib $libobjs${_S_}$RANLIB $lib${_S_}(cd $output_objdir && a2ixlibrary -32)'
       hardcode_libdir_flag_spec='-L$libdir'
       hardcode_minus_L=yes
       # see comment about different semantics on the GNU ld section
       ld_shlibs=no
       ;;
 
-    bsdi[45]*)
+    bsdi4*)
       export_dynamic_flag_spec=-rdynamic
       ;;
 
@@ -7208,9 +6858,9 @@
       # Tell ltmain to make .lib files, not .a files.
       libext=lib
       # Tell ltmain to make .dll files, not .so files.
-      shrext_cmds=".dll"
+      shrext=".dll"
       # FIXME: Setting linknames here is a bad hack.
-      archive_cmds='$CC -o $lib $libobjs $compiler_flags `echo "$deplibs" | $SED -e '\''s/ -lc$//'\''` -link -dll~linknames='
+      archive_cmds='$CC -o $lib $libobjs $compiler_flags `echo "$deplibs" | $SED -e '\''s/ -lc$//'\''` -link -dll${_S_}linknames='
       # The linker will automatically build a .lib file if we build a DLL.
       old_archive_From_new_cmds='true'
       # FIXME: Should let the user specify the lib program.
@@ -7220,62 +6870,108 @@
       ;;
 
     darwin* | rhapsody*)
-      case $host_os in
-        rhapsody* | darwin1.[012])
-         allow_undefined_flag='${wl}-undefined ${wl}suppress'
-         ;;
-       *) # Darwin 1.3 on
-         if test -z ${MACOSX_DEPLOYMENT_TARGET} ; then
-           allow_undefined_flag='${wl}-flat_namespace ${wl}-undefined ${wl}suppress'
-         else
-           case ${MACOSX_DEPLOYMENT_TARGET} in
-             10.[012])
-               allow_undefined_flag='${wl}-flat_namespace ${wl}-undefined ${wl}suppress'
-               ;;
-             10.*)
-               allow_undefined_flag='${wl}-undefined ${wl}dynamic_lookup'
-               ;;
-           esac
-         fi
-         ;;
-      esac
       archive_cmds_need_lc=no
+      case "$host_os" in
+      rhapsody* | darwin1.[012])
+	allow_undefined_flag='-undefined suppress'
+	;;
+      darwin1.* | darwin[2-6].*) # Darwin 1.3 on, but less than 7.0
+	test -z ${LD_TWOLEVEL_NAMESPACE} && allow_undefined_flag='-flat_namespace -undefined suppress'
+	;;
+      *) # Darwin 7.0 on
+	case "${MACOSX_DEPLOYMENT_TARGET-10.1}" in
+	10.[012])
+	  test -z ${LD_TWOLEVEL_NAMESPACE} && allow_undefined_flag='-flat_namespace -undefined suppress'
+	  ;;
+	*) # 10.3 on
+	  if test -z ${LD_TWOLEVEL_NAMESPACE}; then
+	    allow_undefined_flag='-flat_namespace -undefined suppress'
+	  else
+	    allow_undefined_flag='-undefined dynamic_lookup'
+	  fi
+	  ;;
+	esac
+	;;
+      esac
+
+cat >conftest.$ac_ext <<_ACEOF
+#line $LINENO "configure"
+#include "confdefs.h"
+
+#ifdef F77_DUMMY_MAIN
+#  ifdef __cplusplus
+     extern "C"
+#  endif
+int F77_DUMMY_MAIN() { return 1; }
+#endif
+int
+main (){
+  ;
+  return 0;}
+_ACEOF
+
+  if $CC -v conftest.$ac_ext -o conftest$ac_exeext 2>&1 | grep 'Apple' >/dev/null ; then
+      # FIXME: Relying on posixy $() will cause problems for
+      #        cross-compilation, but unfortunately the echo tests do not
+      #        yet detect zsh echo's removal of \ escapes.  Also zsh mangles
+      #	       `"' quotes if we put them in here... so don't!
+    	lt_int_apple_cc_single_mod=no
+    	output_verbose_link_cmd='echo'
+    	if $CC -dumpspecs 2>&1 | grep 'single_module' >/dev/null ; then
+    	  lt_int_apple_cc_single_mod=yes
+    	fi
+    	if test "X$lt_int_apple_cc_single_mod" = Xyes ; then
+    	  archive_cmds='$CC -dynamiclib $archargs -single_module $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags -install_name SW_PREFIX/lib/ccp4-5.99.5/$soname $verstring'
+    	else
+        archive_cmds='$CC -r ${wl}-bind_at_load -keep_private_externs -nostdlib -o ${lib}-master.o $libobjs${_S_}$CC -dynamiclib $archargs $allow_undefined_flag -o $lib ${lib}-master.o $deplibs $compiler_flags -install_name SW_PREFIX/lib/ccp4-5.99.5/$soname $verstring'
+      fi
+      module_cmds='$CC -bundle $archargs ${wl}-bind_at_load $allow_undefined_flag -o $lib $libobjs $deplibs$compiler_flags'
+      # Don't fix this by using the ld -exported_symbols_list flag, it doesn't exist in older darwin ld's
+        if test "X$lt_int_apple_cc_single_mod" = Xyes ; then
+          archive_expsym_cmds='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym${_S_}$CC -dynamiclib $archargs -single_module $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags -install_name SW_PREFIX/lib/ccp4-5.99.5/$soname $verstring${_S_}nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
+        else
+          archive_expsym_cmds='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym${_S_}$CC -r ${wl}-bind_at_load -keep_private_externs -nostdlib -o ${lib}-master.o $libobjs${_S_}$CC -dynamiclib $archargs $allow_undefined_flag -o $lib ${lib}-master.o $deplibs $compiler_flags -install_name SW_PREFIX/lib/ccp4-5.99.5/$soname $verstring${_S_}nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
+        fi
+          module_expsym_cmds='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym${_S_}$CC -bundle $archargs $allow_undefined_flag  -o $lib $libobjs $deplibs$compiler_flags${_S_}nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
       hardcode_direct=no
       hardcode_automatic=yes
       hardcode_shlibpath_var=unsupported
-      whole_archive_flag_spec=''
+      whole_archive_flag_spec='-all_load $convenience'
       link_all_deplibs=yes
-    if test "$GCC" = yes ; then
-    	output_verbose_link_cmd='echo'
-        archive_cmds='$CC -dynamiclib $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags -install_name $rpath/$soname $verstring'
-      module_cmds='$CC $allow_undefined_flag -o $lib -bundle $libobjs $deplibs$compiler_flags'
-      # Don't fix this by using the ld -exported_symbols_list flag, it doesn't exist in older darwin lds
-      archive_expsym_cmds='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC -dynamiclib $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags -install_name $rpath/$soname $verstring~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
-      module_expsym_cmds='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC $allow_undefined_flag  -o $lib -bundle $libobjs $deplibs$compiler_flags~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
-    else
-      case $cc_basename in
-        xlc* )
-         output_verbose_link_cmd='echo'
-         archive_cmds='$CC -qmkshrobj $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-install_name ${wl}`echo $rpath/$soname` $verstring'
-         module_cmds='$CC $allow_undefined_flag -o $lib -bundle $libobjs $deplibs$compiler_flags'
-          # Don't fix this by using the ld -exported_symbols_list flag, it doesn't exist in older darwin lds
-         archive_expsym_cmds='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC -qmkshrobj $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-install_name ${wl}$rpath/$soname $verstring~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
-          module_expsym_cmds='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC $allow_undefined_flag  -o $lib -bundle $libobjs $deplibs$compiler_flags~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
-          ;;
-        xlf* )
-         output_verbose_link_cmd='echo'
-         archive_cmds='$CC -qmkshrobj $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-dylib_install_name ${wl}`echo $rpath/$soname` $verstring'
-         module_cmds='$CC $allow_undefined_flag -o $lib -bundle $libobjs $deplibs$compiler_flags'
-          # Don't fix this by using the ld -exported_symbols_list flag, it doesn't exist in older darwin lds
-         archive_expsym_cmds='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC -qmkshrobj $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-dylib_install_name ${wl}$rpath/$soname $verstring~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
-          module_expsym_cmds='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC $allow_undefined_flag  -o $lib -bundle $libobjs $deplibs$compiler_flags~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
+
+    elif $CC -v conftest.$ac_ext -o conftest$ac_exeext 2>&1 | grep 'XL_CONFIG' >/dev/null ; then
+    # FIXME: Relying on posixy $() will cause problems for
+    #        cross-compilation, but unfortunately the echo tests do not
+    #        yet detect zsh echo's removal of \ escapes.  Also zsh mangles
+    #          `"' quotes if we put them in here... so don't!
+    output_verbose_link_cmd='echo'
+    archive_cmds='$LD -dynamic -dylib $allow_undefined_flag -o $lib $libobjs -ldylib1.o $deplibs$compiler_flags -dylib_install_name $soname $verstring'
+    module_cmds='$LD -bundle $allow_undefined_flag -o $lib $libobjs $deplibs$compiler_flags'
+    # Don't fix this by using the ld -exported_symbols_list flag, it doesn't exist in older darwin ld's
+    archive_expsym_cmds='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$LD -dynamic -dylib $allow_undefined_flag -o $lib $libobjs $deplibs$compiler_flags -dylib_install_name $soname $verstring~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
+    module_expsym_cmds='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$LD -bundle $allow_undefined_flag  -o $lib $libobjs $deplibs$compiler_flags~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
+    hardcode_direct=no
+    hardcode_automatic=yes
+    hardcode_shlibpath_var=unsupported
+    whole_archive_flag_spec='-all_load $convenience'
+    link_all_deplibs=yes
+    if test "" = F77 ; then
+      case "${MACOSX_DEPLOYMENT_TARGET-10.1}" in
+        10.[012])
+          test -z ${LD_TWOLEVEL_NAMESPACE} && allow_undefined_flag='-flat_namespace -undefined suppress -single_module'
           ;;
-       *)
-         ld_shlibs=no
+        *) # 10.3 on
+          if test -z ${LD_TWOLEVEL_NAMESPACE}; then
+            allow_undefined_flag='-flat_namespace -undefined suppress -single_module'
+          else
+            allow_undefined_flag='-undefined dynamic_lookup -single_module'
+          fi
           ;;
-      esac
+        esac
     fi
-      ;;
+    fi
+    rm -f conftest.$ac_ext conftest$ac_exeext
+    ;;
 
     dgux*)
       archive_cmds='$LD -G -h $soname -o $lib $libobjs $deplibs $linker_flags'
@@ -7307,7 +7003,7 @@
       ;;
 
     # FreeBSD 3 and greater uses gcc -shared to do shared libraries.
-    freebsd* | kfreebsd*-gnu | dragonfly*)
+    freebsd*)
       archive_cmds='$CC -shared -o $lib $libobjs $deplibs $compiler_flags'
       hardcode_libdir_flag_spec='-R$libdir'
       hardcode_direct=yes
@@ -7316,9 +7012,9 @@
 
     hpux9*)
       if test "$GCC" = yes; then
-	archive_cmds='$rm $output_objdir/$soname~$CC -shared -fPIC ${wl}+b ${wl}$install_libdir -o $output_objdir/$soname $libobjs $deplibs $compiler_flags~test $output_objdir/$soname = $lib || mv $output_objdir/$soname $lib'
+	archive_cmds='$rm $output_objdir/$soname${_S_}$CC -shared -fPIC ${wl}+b ${wl}$install_libdir -o $output_objdir/$soname $libobjs $deplibs $compiler_flags${_S_}test $output_objdir/$soname = $lib || mv $output_objdir/$soname $lib'
       else
-	archive_cmds='$rm $output_objdir/$soname~$LD -b +b $install_libdir -o $output_objdir/$soname $libobjs $deplibs $linker_flags~test $output_objdir/$soname = $lib || mv $output_objdir/$soname $lib'
+	archive_cmds='$rm $output_objdir/$soname${_S_}$LD -b +b $install_libdir -o $output_objdir/$soname $libobjs $deplibs $linker_flags${_S_}test $output_objdir/$soname = $lib || mv $output_objdir/$soname $lib'
       fi
       hardcode_libdir_flag_spec='${wl}+b ${wl}$libdir'
       hardcode_libdir_separator=:
@@ -7332,7 +7028,7 @@
 
     hpux10* | hpux11*)
       if test "$GCC" = yes -a "$with_gnu_ld" = no; then
-	case $host_cpu in
+	case "$host_cpu" in
 	hppa*64*|ia64*)
 	  archive_cmds='$CC -shared ${wl}+h ${wl}$soname -o $lib $libobjs $deplibs $compiler_flags'
 	  ;;
@@ -7341,7 +7037,7 @@
 	  ;;
 	esac
       else
-	case $host_cpu in
+	case "$host_cpu" in
 	hppa*64*|ia64*)
 	  archive_cmds='$LD -b +h $soname -o $lib $libobjs $deplibs $linker_flags'
 	  ;;
@@ -7351,7 +7047,7 @@
 	esac
       fi
       if test "$with_gnu_ld" = no; then
-	case $host_cpu in
+	case "$host_cpu" in
 	hppa*64*)
 	  hardcode_libdir_flag_spec='${wl}+b ${wl}$libdir'
 	  hardcode_libdir_flag_spec_ld='+b $libdir'
@@ -7418,7 +7114,6 @@
       hardcode_shlibpath_var=no
       if test -z "`echo __ELF__ | $CC -E - | grep __ELF__`" || test "$host_os-$host_cpu" = "openbsd2.8-powerpc"; then
 	archive_cmds='$CC -shared $pic_flag -o $lib $libobjs $deplibs $compiler_flags'
-	archive_expsym_cmds='$CC -shared $pic_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-retain-symbols-file,$export_symbols'
 	hardcode_libdir_flag_spec='${wl}-rpath,$libdir'
 	export_dynamic_flag_spec='${wl}-E'
       else
@@ -7439,7 +7134,7 @@
       hardcode_libdir_flag_spec='-L$libdir'
       hardcode_minus_L=yes
       allow_undefined_flag=unsupported
-      archive_cmds='$echo "LIBRARY $libname INITINSTANCE" > $output_objdir/$libname.def~$echo "DESCRIPTION \"$libname\"" >> $output_objdir/$libname.def~$echo DATA >> $output_objdir/$libname.def~$echo " SINGLE NONSHARED" >> $output_objdir/$libname.def~$echo EXPORTS >> $output_objdir/$libname.def~emxexp $libobjs >> $output_objdir/$libname.def~$CC -Zdll -Zcrtdll -o $lib $libobjs $deplibs $compiler_flags $output_objdir/$libname.def'
+      archive_cmds='$echo "LIBRARY $libname INITINSTANCE" > $output_objdir/$libname.def${_S_}$echo "DESCRIPTION \"$libname\"" >> $output_objdir/$libname.def${_S_}$echo DATA >> $output_objdir/$libname.def${_S_}$echo " SINGLE NONSHARED" >> $output_objdir/$libname.def${_S_}$echo EXPORTS >> $output_objdir/$libname.def${_S_}emxexp $libobjs >> $output_objdir/$libname.def${_S_}$CC -Zdll -Zcrtdll -o $lib $libobjs $deplibs $compiler_flags $output_objdir/$libname.def'
       old_archive_From_new_cmds='emximp -o $output_objdir/$libname.a $output_objdir/$libname.def'
       ;;
 
@@ -7463,8 +7158,8 @@
       else
 	allow_undefined_flag=' -expect_unresolved \*'
 	archive_cmds='$LD -shared${allow_undefined_flag} $libobjs $deplibs $linker_flags -msym -soname $soname `test -n "$verstring" && echo -set_version $verstring` -update_registry ${output_objdir}/so_locations -o $lib'
-	archive_expsym_cmds='for i in `cat $export_symbols`; do printf "%s %s\\n" -exported_symbol "\$i" >> $lib.exp; done; echo "-hidden">> $lib.exp~
-	$LD -shared${allow_undefined_flag} -input $lib.exp $linker_flags $libobjs $deplibs -soname $soname `test -n "$verstring" && echo -set_version $verstring` -update_registry ${output_objdir}/so_locations -o $lib~$rm $lib.exp'
+	archive_expsym_cmds='for i in `cat $export_symbols`; do printf "%s %s\\n" -exported_symbol "\$i" >> $lib.exp; done; echo "-hidden">> $lib.exp${_S_}
+	$LD -shared${allow_undefined_flag} -input $lib.exp $linker_flags $libobjs $deplibs -soname $soname `test -n "$verstring" && echo -set_version $verstring` -update_registry ${objdir}/so_locations -o $lib${_S_}$rm $lib.exp'
 
 	# Both c and cxx compiler support -rpath directly
 	hardcode_libdir_flag_spec='-rpath $libdir'
@@ -7483,32 +7178,20 @@
     solaris*)
       no_undefined_flag=' -z text'
       if test "$GCC" = yes; then
-	wlarc='${wl}'
 	archive_cmds='$CC -shared ${wl}-h ${wl}$soname -o $lib $libobjs $deplibs $compiler_flags'
-	archive_expsym_cmds='$echo "{ global:" > $lib.exp~cat $export_symbols | $SED -e "s/\(.*\)/\1;/" >> $lib.exp~$echo "local: *; };" >> $lib.exp~
-	  $CC -shared ${wl}-M ${wl}$lib.exp ${wl}-h ${wl}$soname -o $lib $libobjs $deplibs $compiler_flags~$rm $lib.exp'
+	archive_expsym_cmds='$echo "{ global:" > $lib.exp${_S_}cat $export_symbols | $SED -e "s/\(.*\)/\1;/" >> $lib.exp${_S_}$echo "local: *; };" >> $lib.exp${_S_}
+	  $CC -shared ${wl}-M ${wl}$lib.exp ${wl}-h ${wl}$soname -o $lib $libobjs $deplibs $compiler_flags${_S_}$rm $lib.exp'
       else
-	wlarc=''
 	archive_cmds='$LD -G${allow_undefined_flag} -h $soname -o $lib $libobjs $deplibs $linker_flags'
-	archive_expsym_cmds='$echo "{ global:" > $lib.exp~cat $export_symbols | $SED -e "s/\(.*\)/\1;/" >> $lib.exp~$echo "local: *; };" >> $lib.exp~
-  	$LD -G${allow_undefined_flag} -M $lib.exp -h $soname -o $lib $libobjs $deplibs $linker_flags~$rm $lib.exp'
+	archive_expsym_cmds='$echo "{ global:" > $lib.exp${_S_}cat $export_symbols | $SED -e "s/\(.*\)/\1;/" >> $lib.exp${_S_}$echo "local: *; };" >> $lib.exp${_S_}
+  	$LD -G${allow_undefined_flag} -M $lib.exp -h $soname -o $lib $libobjs $deplibs $linker_flags${_S_}$rm $lib.exp'
       fi
       hardcode_libdir_flag_spec='-R$libdir'
       hardcode_shlibpath_var=no
       case $host_os in
       solaris2.[0-5] | solaris2.[0-5].*) ;;
-      *)
- 	# The compiler driver will combine linker options so we
- 	# cannot just pass the convience library names through
- 	# without $wl, iff we do not link with $LD.
- 	# Luckily, gcc supports the same syntax we need for Sun Studio.
- 	# Supported since Solaris 2.6 (maybe 2.5.1?)
- 	case $wlarc in
- 	'')
- 	  whole_archive_flag_spec='-z allextract$convenience -z defaultextract' ;;
- 	*)
- 	  whole_archive_flag_spec='${wl}-z ${wl}allextract`for conv in $convenience\"\"; do test -n \"$conv\" && new_convenience=\"$new_convenience,$conv\"; done; $echo \"$new_convenience\"` ${wl}-z ${wl}defaultextract' ;;
- 	esac ;;
+      *) # Supported since Solaris 2.6 (maybe 2.5.1?)
+	whole_archive_flag_spec='-z allextract$convenience -z defaultextract' ;;
       esac
       link_all_deplibs=yes
       ;;
@@ -7590,8 +7273,8 @@
       # $CC -shared without GNU ld will not create a library from C++
       # object files and a static libstdc++, better avoid it by now
       archive_cmds='$LD -G${allow_undefined_flag} -h $soname -o $lib $libobjs $deplibs $linker_flags'
-      archive_expsym_cmds='$echo "{ global:" > $lib.exp~cat $export_symbols | $SED -e "s/\(.*\)/\1;/" >> $lib.exp~$echo "local: *; };" >> $lib.exp~
-  		$LD -G${allow_undefined_flag} -M $lib.exp -h $soname -o $lib $libobjs $deplibs $linker_flags~$rm $lib.exp'
+      archive_expsym_cmds='$echo "{ global:" > $lib.exp${_S_}cat $export_symbols | $SED -e "s/\(.*\)/\1;/" >> $lib.exp${_S_}$echo "local: *; };" >> $lib.exp${_S_}
+  		$LD -G${allow_undefined_flag} -M $lib.exp -h $soname -o $lib $libobjs $deplibs $linker_flags${_S_}$rm $lib.exp'
       hardcode_libdir_flag_spec=
       hardcode_shlibpath_var=no
       runpath_var='LD_RUN_PATH'
@@ -7628,7 +7311,7 @@
 
   if test "$enable_shared" = yes && test "$GCC" = yes; then
     case $archive_cmds in
-    *'~'*)
+    *"$_S_"*)
       # FIXME: we may have to deal with multi-command sequences.
       ;;
     '$CC '*)
@@ -7680,12 +7363,78 @@
   ;;
 esac
 
+echo "$as_me:$LINENO: checking how to hardcode library paths into programs" >&5
+echo $ECHO_N "checking how to hardcode library paths into programs... $ECHO_C" >&6
+hardcode_action=
+if test -n "$hardcode_libdir_flag_spec" || \
+   test -n "$runpath_var " || \
+   test "X$hardcode_automatic"="Xyes" ; then
+
+  # We can hardcode non-existant directories.
+  if test "$hardcode_direct" != no &&
+     # If the only mechanism to avoid hardcoding is shlibpath_var, we
+     # have to relink, otherwise we might link with an installed library
+     # when we should be linking with a yet-to-be-installed one
+     ## test "$_LT_AC_TAGVAR(hardcode_shlibpath_var, )" != no &&
+     test "$hardcode_minus_L" != no; then
+    # Linking always hardcodes the temporary library directory.
+    hardcode_action=relink
+  else
+    # We can link without hardcoding, and we can hardcode nonexisting dirs.
+    hardcode_action=immediate
+  fi
+else
+  # We cannot hardcode anything, or else we can only hardcode existing
+  # directories.
+  hardcode_action=unsupported
+fi
+echo "$as_me:$LINENO: result: $hardcode_action" >&5
+echo "${ECHO_T}$hardcode_action" >&6
+
+if test "$hardcode_action" = relink; then
+  # Fast installation is not supported
+  enable_fast_install=no
+elif test "$shlibpath_overrides_runpath" = yes ||
+     test "$enable_shared" = no; then
+  # Fast installation is not necessary
+  enable_fast_install=needless
+fi
+
+striplib=
+old_striplib=
+echo "$as_me:$LINENO: checking whether stripping libraries is possible" >&5
+echo $ECHO_N "checking whether stripping libraries is possible... $ECHO_C" >&6
+if test -n "$STRIP" && $STRIP -V 2>&1 | grep "GNU strip" >/dev/null; then
+  test -z "$old_striplib" && old_striplib="$STRIP --strip-debug"
+  test -z "$striplib" && striplib="$STRIP --strip-unneeded"
+  echo "$as_me:$LINENO: result: yes" >&5
+echo "${ECHO_T}yes" >&6
+else
+# FIXME - insert some real tests, host_os isn't really good enough
+  case $host_os in
+   NOT-darwin*)
+       if test -n "$STRIP" ; then
+         striplib="$STRIP -x"
+         echo "$as_me:$LINENO: result: yes" >&5
+echo "${ECHO_T}yes" >&6
+       else
+  echo "$as_me:$LINENO: result: no" >&5
+echo "${ECHO_T}no" >&6
+fi
+       ;;
+   *)
+  echo "$as_me:$LINENO: result: no" >&5
+echo "${ECHO_T}no" >&6
+    ;;
+  esac
+fi
+
 echo "$as_me:$LINENO: checking dynamic linker characteristics" >&5
 echo $ECHO_N "checking dynamic linker characteristics... $ECHO_C" >&6
 library_names_spec=
 libname_spec='lib$name'
 soname_spec=
-shrext_cmds=".so"
+shrext=".so"
 postinstall_cmds=
 postuninstall_cmds=
 finish_cmds=
@@ -7773,7 +7522,7 @@
 amigaos*)
   library_names_spec='$libname.ixlibrary $libname.a'
   # Create ${libname}_ixlibrary.a entries in /sys/libs.
-  finish_eval='for lib in `ls $libdir/*.ixlibrary 2>/dev/null`; do libname=`$echo "X$lib" | $Xsed -e '\''s%^.*/\([^/]*\)\.ixlibrary$%\1%'\''`; test $rm /sys/libs/${libname}_ixlibrary.a; $show "cd /sys/libs && $LN_S $lib ${libname}_ixlibrary.a"; cd /sys/libs && $LN_S $lib ${libname}_ixlibrary.a || exit 1; done'
+  finish_eval='for lib in `ls $libdir/*.ixlibrary 2>/dev/null`; do libname=`$echo "X$lib" | $Xsed -e '\''s%^.*/\([^/]*\)\.ixlibrary$%\1%'\''`; test $rm /sys/libs/${libname}_ixlibrary.a; $show "(cd /sys/libs && $LN_S $lib ${libname}_ixlibrary.a)"; (cd /sys/libs && $LN_S $lib ${libname}_ixlibrary.a) || exit 1; done'
   ;;
 
 beos*)
@@ -7782,7 +7531,7 @@
   shlibpath_var=LIBRARY_PATH
   ;;
 
-bsdi[45]*)
+bsdi4*)
   version_type=linux
   need_version=no
   library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major $libname${shared_ext}'
@@ -7798,7 +7547,7 @@
 
 cygwin* | mingw* | pw32*)
   version_type=windows
-  shrext_cmds=".dll"
+  shrext=".dll"
   need_version=no
   need_lib_prefix=no
 
@@ -7806,14 +7555,13 @@
   yes,cygwin* | yes,mingw* | yes,pw32*)
     library_names_spec='$libname.dll.a'
     # DLL is installed to $(libdir)/../bin by postinstall_cmds
-    postinstall_cmds='base_file=`basename \${file}`~
-      dlpath=`$SHELL 2>&1 -c '\''. $dir/'\''\${base_file}'\''i;echo \$dlname'\''`~
-      dldir=$destdir/`dirname \$dlpath`~
-      test -d \$dldir || mkdir -p \$dldir~
-      $install_prog $dir/$dlname \$dldir/$dlname~
-      chmod a+x \$dldir/$dlname'
-    postuninstall_cmds='dldll=`$SHELL 2>&1 -c '\''. $file; echo \$dlname'\''`~
-      dlpath=$dir/\$dldll~
+    postinstall_cmds='base_file=`basename \${file}`${_S_}
+      dlpath=`$SHELL 2>&1 -c '\''. $dir/'\''\${base_file}'\''i;echo \$dlname'\''`${_S_}
+      dldir=$destdir/`dirname \$dlpath`${_S_}
+      test -d \$dldir || mkdir -p \$dldir${_S_}
+      $install_prog $dir/$dlname \$dldir/$dlname'
+    postuninstall_cmds='dldll=`$SHELL 2>&1 -c '\''. $file; echo \$dlname'\''`${_S_}
+      dlpath=$dir/\$dldll${_S_}
        $rm \$dlpath'
     shlibpath_overrides_runpath=yes
 
@@ -7821,7 +7569,7 @@
     cygwin*)
       # Cygwin DLLs use 'cyg' prefix rather than 'lib'
       soname_spec='`echo ${libname} | sed -e 's/^lib/cyg/'``echo ${release} | $SED -e 's/[.]/-/g'`${versuffix}${shared_ext}'
-      sys_lib_search_path_spec="/usr/lib /lib/w32api /lib /usr/local/lib"
+      sys_lib_search_path_spec="/lib /lib/w32api /usr/lib /usr/local/lib"
       ;;
     mingw*)
       # MinGW DLLs use traditional 'lib' prefix
@@ -7841,7 +7589,7 @@
       ;;
     pw32*)
       # pw32 DLLs use 'pw' prefix rather than 'lib'
-      library_names_spec='`echo ${libname} | sed -e 's/^lib/pw/'``echo ${release} | $SED -e 's/[.]/-/g'`${versuffix}${shared_ext}'
+      library_names_spec='`echo ${libname} | sed -e 's/^lib/pw/'``echo ${release} | $SED -e 's/./-/g'`${versuffix}${shared_ext}'
       ;;
     esac
     ;;
@@ -7860,16 +7608,17 @@
   version_type=darwin
   need_lib_prefix=no
   need_version=no
-  library_names_spec='${libname}${release}${versuffix}$shared_ext ${libname}${release}${major}$shared_ext ${libname}$shared_ext'
+  # FIXME: Relying on posixy $() will cause problems for
+  #        cross-compilation, but unfortunately the echo tests do not
+  #        yet detect zsh echo's removal of \ escapes.
+  library_names_spec='${libname}${release}${major}$shared_ext ${libname}$shared_ext ${libname}${release}${versuffix}$shared_ext'
   soname_spec='${libname}${release}${major}$shared_ext'
   shlibpath_overrides_runpath=yes
   shlibpath_var=DYLD_LIBRARY_PATH
-  shrext_cmds='`test .$module = .yes && echo .so || echo .dylib`'
+  shrext='$(test .$module = .yes && echo .so || echo .dylib)'
   # Apple's gcc prints 'gcc -print-search-dirs' doesn't operate the same.
-  if test "$GCC" = yes; then
-    sys_lib_search_path_spec=`$CC -print-search-dirs | tr "\n" "$PATH_SEPARATOR" | sed -e 's/libraries:/@libraries:/' | tr "@" "\n" | grep "^libraries:" | sed -e "s/^libraries://" -e "s,=/,/,g" -e "s,$PATH_SEPARATOR, ,g" -e "s,.*,& /lib /usr/lib /usr/local/lib,g"`
-  else
-    sys_lib_search_path_spec='/lib /usr/lib /usr/local/lib'
+  if $CC -v 2>&1 | grep 'Apple' >/dev/null ; then
+  sys_lib_search_path_spec=`$CC -print-search-dirs | tr "\n" "$PATH_SEPARATOR" | sed -e 's/libraries:/@libraries:/' | tr "@" "\n" | grep "^libraries:" | sed -e "s/^libraries://" -e "s,=/,/,g" -e "s,$PATH_SEPARATOR, ,g" -e "s,.*,& /lib /usr/lib /usr/local/lib,g"`
   fi
   sys_lib_dlsearch_path_spec='/usr/local/lib /lib /usr/lib'
   ;;
@@ -7887,29 +7636,8 @@
   dynamic_linker=no
   ;;
 
-kfreebsd*-gnu)
-  version_type=linux
-  need_lib_prefix=no
-  need_version=no
-  library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major ${libname}${shared_ext}'
-  soname_spec='${libname}${release}${shared_ext}$major'
-  shlibpath_var=LD_LIBRARY_PATH
-  shlibpath_overrides_runpath=no
-  hardcode_into_libs=yes
-  dynamic_linker='GNU ld.so'
-  ;;
-
-freebsd* | dragonfly*)
-  # DragonFly does not have aout.  When/if they implement a new
-  # versioning mechanism, adjust this.
-  if test -x /usr/bin/objformat; then
-    objformat=`/usr/bin/objformat`
-  else
-    case $host_os in
-    freebsd[123]*) objformat=aout ;;
-    *) objformat=elf ;;
-    esac
-  fi
+freebsd*)
+  objformat=`test -x /usr/bin/objformat && /usr/bin/objformat || echo aout`
   version_type=freebsd-$objformat
   case $version_type in
     freebsd-elf*)
@@ -7927,7 +7655,7 @@
   freebsd2*)
     shlibpath_overrides_runpath=yes
     ;;
-  freebsd3.[01]* | freebsdelf3.[01]*)
+  freebsd3.01* | freebsdelf3.01*)
     shlibpath_overrides_runpath=yes
     hardcode_into_libs=yes
     ;;
@@ -7954,9 +7682,9 @@
   version_type=sunos
   need_lib_prefix=no
   need_version=no
-  case $host_cpu in
+  case "$host_cpu" in
   ia64*)
-    shrext_cmds='.so'
+    shrext='.so'
     hardcode_into_libs=yes
     dynamic_linker="$host_os dld.so"
     shlibpath_var=LD_LIBRARY_PATH
@@ -7971,7 +7699,7 @@
     sys_lib_dlsearch_path_spec=$sys_lib_search_path_spec
     ;;
    hppa*64*)
-     shrext_cmds='.sl'
+     shrext='.sl'
      hardcode_into_libs=yes
      dynamic_linker="$host_os dld.sl"
      shlibpath_var=LD_LIBRARY_PATH # How should we handle SHLIB_PATH
@@ -7982,7 +7710,7 @@
      sys_lib_dlsearch_path_spec=$sys_lib_search_path_spec
      ;;
    *)
-    shrext_cmds='.sl'
+    shrext='.sl'
     dynamic_linker="$host_os dld.sl"
     shlibpath_var=SHLIB_PATH
     shlibpath_overrides_runpath=no # +s is required to enable SHLIB_PATH
@@ -8051,12 +7779,6 @@
   # before this can be enabled.
   hardcode_into_libs=yes
 
-  # Append ld.so.conf contents to the search path
-  if test -f /etc/ld.so.conf; then
-    lt_ld_extra=`awk '/^include / { system(sprintf("cd /etc; cat %s", \$2)); skip = 1; } { if (!skip) print \$0; skip = 0; }' < /etc/ld.so.conf | $SED -e 's/#.*//;s/[:,	]/ /g;s/=[^=]*$//;s/=[^= ]* / /g;/^$/d' | tr '\n' ' '`
-    sys_lib_dlsearch_path_spec="/lib /usr/lib $lt_ld_extra"
-  fi
-
   # We used to test for /lib/ld.so.1 and disable shared libraries on
   # powerpc, because MkLinux only supported shared libraries with the
   # GNU dynamic linker.  Since this was broken with cross compilers,
@@ -8066,18 +7788,6 @@
   dynamic_linker='GNU/Linux ld.so'
   ;;
 
-knetbsd*-gnu)
-  version_type=linux
-  need_lib_prefix=no
-  need_version=no
-  library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major ${libname}${shared_ext}'
-  soname_spec='${libname}${release}${shared_ext}$major'
-  shlibpath_var=LD_LIBRARY_PATH
-  shlibpath_overrides_runpath=no
-  hardcode_into_libs=yes
-  dynamic_linker='GNU ld.so'
-  ;;
-
 netbsd*)
   version_type=sunos
   need_lib_prefix=no
@@ -8087,7 +7797,7 @@
     finish_cmds='PATH="\$PATH:/sbin" ldconfig -m $libdir'
     dynamic_linker='NetBSD (a.out) ld.so'
   else
-    library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major ${libname}${shared_ext}'
+    library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major ${libname}${release}${shared_ext} ${libname}${shared_ext}'
     soname_spec='${libname}${release}${shared_ext}$major'
     dynamic_linker='NetBSD ld.elf_so'
   fi
@@ -8103,7 +7813,7 @@
   shlibpath_overrides_runpath=yes
   ;;
 
-nto-qnx*)
+nto-qnx)
   version_type=linux
   need_lib_prefix=no
   need_version=no
@@ -8116,11 +7826,7 @@
 openbsd*)
   version_type=sunos
   need_lib_prefix=no
-  # Some older versions of OpenBSD (3.3 at least) *do* need versioned libs.
-  case $host_os in
-    openbsd3.3 | openbsd3.3.*) need_version=yes ;;
-    *)                         need_version=no  ;;
-  esac
+  need_version=no
   library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${shared_ext}$versuffix'
   finish_cmds='PATH="\$PATH:/sbin" ldconfig -m $libdir'
   shlibpath_var=LD_LIBRARY_PATH
@@ -8140,7 +7846,7 @@
 
 os2*)
   libname_spec='$name'
-  shrext_cmds=".dll"
+  shrext=".dll"
   need_lib_prefix=no
   library_names_spec='$libname${shared_ext} $libname.a'
   dynamic_linker='OS/2 ld.exe'
@@ -8238,72 +7944,6 @@
 echo "${ECHO_T}$dynamic_linker" >&6
 test "$dynamic_linker" = no && can_build_shared=no
 
-echo "$as_me:$LINENO: checking how to hardcode library paths into programs" >&5
-echo $ECHO_N "checking how to hardcode library paths into programs... $ECHO_C" >&6
-hardcode_action=
-if test -n "$hardcode_libdir_flag_spec" || \
-   test -n "$runpath_var" || \
-   test "X$hardcode_automatic" = "Xyes" ; then
-
-  # We can hardcode non-existant directories.
-  if test "$hardcode_direct" != no &&
-     # If the only mechanism to avoid hardcoding is shlibpath_var, we
-     # have to relink, otherwise we might link with an installed library
-     # when we should be linking with a yet-to-be-installed one
-     ## test "$_LT_AC_TAGVAR(hardcode_shlibpath_var, )" != no &&
-     test "$hardcode_minus_L" != no; then
-    # Linking always hardcodes the temporary library directory.
-    hardcode_action=relink
-  else
-    # We can link without hardcoding, and we can hardcode nonexisting dirs.
-    hardcode_action=immediate
-  fi
-else
-  # We cannot hardcode anything, or else we can only hardcode existing
-  # directories.
-  hardcode_action=unsupported
-fi
-echo "$as_me:$LINENO: result: $hardcode_action" >&5
-echo "${ECHO_T}$hardcode_action" >&6
-
-if test "$hardcode_action" = relink; then
-  # Fast installation is not supported
-  enable_fast_install=no
-elif test "$shlibpath_overrides_runpath" = yes ||
-     test "$enable_shared" = no; then
-  # Fast installation is not necessary
-  enable_fast_install=needless
-fi
-
-striplib=
-old_striplib=
-echo "$as_me:$LINENO: checking whether stripping libraries is possible" >&5
-echo $ECHO_N "checking whether stripping libraries is possible... $ECHO_C" >&6
-if test -n "$STRIP" && $STRIP -V 2>&1 | grep "GNU strip" >/dev/null; then
-  test -z "$old_striplib" && old_striplib="$STRIP --strip-debug"
-  test -z "$striplib" && striplib="$STRIP --strip-unneeded"
-  echo "$as_me:$LINENO: result: yes" >&5
-echo "${ECHO_T}yes" >&6
-else
-# FIXME - insert some real tests, host_os isn't really good enough
-  case $host_os in
-   darwin*)
-       if test -n "$STRIP" ; then
-         striplib="$STRIP -x"
-         echo "$as_me:$LINENO: result: yes" >&5
-echo "${ECHO_T}yes" >&6
-       else
-  echo "$as_me:$LINENO: result: no" >&5
-echo "${ECHO_T}no" >&6
-fi
-       ;;
-   *)
-  echo "$as_me:$LINENO: result: no" >&5
-echo "${ECHO_T}no" >&6
-    ;;
-  esac
-fi
-
 if test "x$enable_dlopen" != xyes; then
   enable_dlopen=unknown
   enable_dlopen_self=unknown
@@ -8339,6 +7979,7 @@
   ac_check_lib_save_LIBS=$LIBS
 LIBS="-ldl  $LIBS"
 cat >conftest.$ac_ext <<_ACEOF
+#line $LINENO "configure"
 /* confdefs.h.  */
 _ACEOF
 cat confdefs.h >>conftest.$ac_ext
@@ -8362,21 +8003,11 @@
 _ACEOF
 rm -f conftest.$ac_objext conftest$ac_exeext
 if { (eval echo "$as_me:$LINENO: \"$ac_link\"") >&5
-  (eval $ac_link) 2>conftest.er1
+  (eval $ac_link) 2>&5
   ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
   echo "$as_me:$LINENO: \$? = $ac_status" >&5
   (exit $ac_status); } &&
-	 { ac_try='test -z "$ac_c_werror_flag"
-			 || test ! -s conftest.err'
-  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
-  (eval $ac_try) 2>&5
-  ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; } &&
-	 { ac_try='test -s conftest$ac_exeext'
+         { ac_try='test -s conftest$ac_exeext'
   { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
@@ -8389,8 +8020,7 @@
 
 ac_cv_lib_dl_dlopen=no
 fi
-rm -f conftest.err conftest.$ac_objext \
-      conftest$ac_exeext conftest.$ac_ext
+rm -f conftest.$ac_objext conftest$ac_exeext conftest.$ac_ext
 LIBS=$ac_check_lib_save_LIBS
 fi
 echo "$as_me:$LINENO: result: $ac_cv_lib_dl_dlopen" >&5
@@ -8414,28 +8044,21 @@
   echo $ECHO_N "(cached) $ECHO_C" >&6
 else
   cat >conftest.$ac_ext <<_ACEOF
+#line $LINENO "configure"
 /* confdefs.h.  */
 _ACEOF
 cat confdefs.h >>conftest.$ac_ext
 cat >>conftest.$ac_ext <<_ACEOF
 /* end confdefs.h.  */
-/* Define shl_load to an innocuous variant, in case <limits.h> declares shl_load.
-   For example, HP-UX 11i <limits.h> declares gettimeofday.  */
-#define shl_load innocuous_shl_load
-
 /* System header to define __stub macros and hopefully few prototypes,
     which can conflict with char shl_load (); below.
     Prefer <limits.h> to <assert.h> if __STDC__ is defined, since
     <limits.h> exists even on freestanding compilers.  */
-
 #ifdef __STDC__
 # include <limits.h>
 #else
 # include <assert.h>
 #endif
-
-#undef shl_load
-
 /* Override any gcc2 internal prototype to avoid an error.  */
 #ifdef __cplusplus
 extern "C"
@@ -8466,21 +8089,11 @@
 _ACEOF
 rm -f conftest.$ac_objext conftest$ac_exeext
 if { (eval echo "$as_me:$LINENO: \"$ac_link\"") >&5
-  (eval $ac_link) 2>conftest.er1
+  (eval $ac_link) 2>&5
   ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
   echo "$as_me:$LINENO: \$? = $ac_status" >&5
   (exit $ac_status); } &&
-	 { ac_try='test -z "$ac_c_werror_flag"
-			 || test ! -s conftest.err'
-  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
-  (eval $ac_try) 2>&5
-  ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; } &&
-	 { ac_try='test -s conftest$ac_exeext'
+         { ac_try='test -s conftest$ac_exeext'
   { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
@@ -8493,8 +8106,7 @@
 
 ac_cv_func_shl_load=no
 fi
-rm -f conftest.err conftest.$ac_objext \
-      conftest$ac_exeext conftest.$ac_ext
+rm -f conftest.$ac_objext conftest$ac_exeext conftest.$ac_ext
 fi
 echo "$as_me:$LINENO: result: $ac_cv_func_shl_load" >&5
 echo "${ECHO_T}$ac_cv_func_shl_load" >&6
@@ -8509,6 +8121,7 @@
   ac_check_lib_save_LIBS=$LIBS
 LIBS="-ldld  $LIBS"
 cat >conftest.$ac_ext <<_ACEOF
+#line $LINENO "configure"
 /* confdefs.h.  */
 _ACEOF
 cat confdefs.h >>conftest.$ac_ext
@@ -8532,21 +8145,11 @@
 _ACEOF
 rm -f conftest.$ac_objext conftest$ac_exeext
 if { (eval echo "$as_me:$LINENO: \"$ac_link\"") >&5
-  (eval $ac_link) 2>conftest.er1
+  (eval $ac_link) 2>&5
   ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
   echo "$as_me:$LINENO: \$? = $ac_status" >&5
   (exit $ac_status); } &&
-	 { ac_try='test -z "$ac_c_werror_flag"
-			 || test ! -s conftest.err'
-  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
-  (eval $ac_try) 2>&5
-  ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; } &&
-	 { ac_try='test -s conftest$ac_exeext'
+         { ac_try='test -s conftest$ac_exeext'
   { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
@@ -8559,8 +8162,7 @@
 
 ac_cv_lib_dld_shl_load=no
 fi
-rm -f conftest.err conftest.$ac_objext \
-      conftest$ac_exeext conftest.$ac_ext
+rm -f conftest.$ac_objext conftest$ac_exeext conftest.$ac_ext
 LIBS=$ac_check_lib_save_LIBS
 fi
 echo "$as_me:$LINENO: result: $ac_cv_lib_dld_shl_load" >&5
@@ -8574,28 +8176,21 @@
   echo $ECHO_N "(cached) $ECHO_C" >&6
 else
   cat >conftest.$ac_ext <<_ACEOF
+#line $LINENO "configure"
 /* confdefs.h.  */
 _ACEOF
 cat confdefs.h >>conftest.$ac_ext
 cat >>conftest.$ac_ext <<_ACEOF
 /* end confdefs.h.  */
-/* Define dlopen to an innocuous variant, in case <limits.h> declares dlopen.
-   For example, HP-UX 11i <limits.h> declares gettimeofday.  */
-#define dlopen innocuous_dlopen
-
 /* System header to define __stub macros and hopefully few prototypes,
     which can conflict with char dlopen (); below.
     Prefer <limits.h> to <assert.h> if __STDC__ is defined, since
     <limits.h> exists even on freestanding compilers.  */
-
 #ifdef __STDC__
 # include <limits.h>
 #else
 # include <assert.h>
 #endif
-
-#undef dlopen
-
 /* Override any gcc2 internal prototype to avoid an error.  */
 #ifdef __cplusplus
 extern "C"
@@ -8626,21 +8221,11 @@
 _ACEOF
 rm -f conftest.$ac_objext conftest$ac_exeext
 if { (eval echo "$as_me:$LINENO: \"$ac_link\"") >&5
-  (eval $ac_link) 2>conftest.er1
+  (eval $ac_link) 2>&5
   ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
   echo "$as_me:$LINENO: \$? = $ac_status" >&5
   (exit $ac_status); } &&
-	 { ac_try='test -z "$ac_c_werror_flag"
-			 || test ! -s conftest.err'
-  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
-  (eval $ac_try) 2>&5
-  ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; } &&
-	 { ac_try='test -s conftest$ac_exeext'
+         { ac_try='test -s conftest$ac_exeext'
   { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
@@ -8653,8 +8238,7 @@
 
 ac_cv_func_dlopen=no
 fi
-rm -f conftest.err conftest.$ac_objext \
-      conftest$ac_exeext conftest.$ac_ext
+rm -f conftest.$ac_objext conftest$ac_exeext conftest.$ac_ext
 fi
 echo "$as_me:$LINENO: result: $ac_cv_func_dlopen" >&5
 echo "${ECHO_T}$ac_cv_func_dlopen" >&6
@@ -8669,6 +8253,7 @@
   ac_check_lib_save_LIBS=$LIBS
 LIBS="-ldl  $LIBS"
 cat >conftest.$ac_ext <<_ACEOF
+#line $LINENO "configure"
 /* confdefs.h.  */
 _ACEOF
 cat confdefs.h >>conftest.$ac_ext
@@ -8692,21 +8277,11 @@
 _ACEOF
 rm -f conftest.$ac_objext conftest$ac_exeext
 if { (eval echo "$as_me:$LINENO: \"$ac_link\"") >&5
-  (eval $ac_link) 2>conftest.er1
+  (eval $ac_link) 2>&5
   ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
   echo "$as_me:$LINENO: \$? = $ac_status" >&5
   (exit $ac_status); } &&
-	 { ac_try='test -z "$ac_c_werror_flag"
-			 || test ! -s conftest.err'
-  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
-  (eval $ac_try) 2>&5
-  ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; } &&
-	 { ac_try='test -s conftest$ac_exeext'
+         { ac_try='test -s conftest$ac_exeext'
   { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
@@ -8719,8 +8294,7 @@
 
 ac_cv_lib_dl_dlopen=no
 fi
-rm -f conftest.err conftest.$ac_objext \
-      conftest$ac_exeext conftest.$ac_ext
+rm -f conftest.$ac_objext conftest$ac_exeext conftest.$ac_ext
 LIBS=$ac_check_lib_save_LIBS
 fi
 echo "$as_me:$LINENO: result: $ac_cv_lib_dl_dlopen" >&5
@@ -8736,6 +8310,7 @@
   ac_check_lib_save_LIBS=$LIBS
 LIBS="-lsvld  $LIBS"
 cat >conftest.$ac_ext <<_ACEOF
+#line $LINENO "configure"
 /* confdefs.h.  */
 _ACEOF
 cat confdefs.h >>conftest.$ac_ext
@@ -8759,21 +8334,11 @@
 _ACEOF
 rm -f conftest.$ac_objext conftest$ac_exeext
 if { (eval echo "$as_me:$LINENO: \"$ac_link\"") >&5
-  (eval $ac_link) 2>conftest.er1
+  (eval $ac_link) 2>&5
   ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
   echo "$as_me:$LINENO: \$? = $ac_status" >&5
   (exit $ac_status); } &&
-	 { ac_try='test -z "$ac_c_werror_flag"
-			 || test ! -s conftest.err'
-  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
-  (eval $ac_try) 2>&5
-  ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; } &&
-	 { ac_try='test -s conftest$ac_exeext'
+         { ac_try='test -s conftest$ac_exeext'
   { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
@@ -8786,8 +8351,7 @@
 
 ac_cv_lib_svld_dlopen=no
 fi
-rm -f conftest.err conftest.$ac_objext \
-      conftest$ac_exeext conftest.$ac_ext
+rm -f conftest.$ac_objext conftest$ac_exeext conftest.$ac_ext
 LIBS=$ac_check_lib_save_LIBS
 fi
 echo "$as_me:$LINENO: result: $ac_cv_lib_svld_dlopen" >&5
@@ -8803,6 +8367,7 @@
   ac_check_lib_save_LIBS=$LIBS
 LIBS="-ldld  $LIBS"
 cat >conftest.$ac_ext <<_ACEOF
+#line $LINENO "configure"
 /* confdefs.h.  */
 _ACEOF
 cat confdefs.h >>conftest.$ac_ext
@@ -8826,21 +8391,11 @@
 _ACEOF
 rm -f conftest.$ac_objext conftest$ac_exeext
 if { (eval echo "$as_me:$LINENO: \"$ac_link\"") >&5
-  (eval $ac_link) 2>conftest.er1
+  (eval $ac_link) 2>&5
   ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
   echo "$as_me:$LINENO: \$? = $ac_status" >&5
   (exit $ac_status); } &&
-	 { ac_try='test -z "$ac_c_werror_flag"
-			 || test ! -s conftest.err'
-  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
-  (eval $ac_try) 2>&5
-  ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; } &&
-	 { ac_try='test -s conftest$ac_exeext'
+         { ac_try='test -s conftest$ac_exeext'
   { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
@@ -8853,8 +8408,7 @@
 
 ac_cv_lib_dld_dld_link=no
 fi
-rm -f conftest.err conftest.$ac_objext \
-      conftest$ac_exeext conftest.$ac_ext
+rm -f conftest.$ac_objext conftest$ac_exeext conftest.$ac_ext
 LIBS=$ac_check_lib_save_LIBS
 fi
 echo "$as_me:$LINENO: result: $ac_cv_lib_dld_dld_link" >&5
@@ -8909,7 +8463,7 @@
   lt_dlunknown=0; lt_dlno_uscore=1; lt_dlneed_uscore=2
   lt_status=$lt_dlunknown
   cat > conftest.$ac_ext <<EOF
-#line 8912 "configure"
+#line 8466 "configure"
 #include "confdefs.h"
 
 #if HAVE_DLFCN_H
@@ -8975,7 +8529,7 @@
   ac_status=$?
   echo "$as_me:$LINENO: \$? = $ac_status" >&5
   (exit $ac_status); } && test -s conftest${ac_exeext} 2>/dev/null; then
-    (./conftest; exit; ) >&5 2>/dev/null
+    (./conftest; exit; ) 2>/dev/null
     lt_status=$?
     case x$lt_status in
       x$lt_dlno_uscore) lt_cv_dlopen_self=yes ;;
@@ -9007,7 +8561,7 @@
   lt_dlunknown=0; lt_dlno_uscore=1; lt_dlneed_uscore=2
   lt_status=$lt_dlunknown
   cat > conftest.$ac_ext <<EOF
-#line 9010 "configure"
+#line 8564 "configure"
 #include "confdefs.h"
 
 #if HAVE_DLFCN_H
@@ -9073,7 +8627,7 @@
   ac_status=$?
   echo "$as_me:$LINENO: \$? = $ac_status" >&5
   (exit $ac_status); } && test -s conftest${ac_exeext} 2>/dev/null; then
-    (./conftest; exit; ) >&5 2>/dev/null
+    (./conftest; exit; ) 2>/dev/null
     lt_status=$?
     case x$lt_status in
       x$lt_dlno_uscore) lt_cv_dlopen_self_static=yes ;;
@@ -9123,20 +8677,21 @@
 
 # On AIX, shared libraries and static libraries use the same namespace, and
 # are all built from PIC.
-case $host_os in
+case "$host_os" in
 aix3*)
   test "$enable_shared" = yes && enable_static=no
   if test -n "$RANLIB"; then
-    archive_cmds="$archive_cmds~\$RANLIB \$lib"
+    archive_cmds="$archive_cmds\${_S_}\$RANLIB \$lib"
     postinstall_cmds='$RANLIB $lib'
   fi
   ;;
 
-aix4* | aix5*)
+aix4*)
   if test "$host_cpu" != ia64 && test "$aix_use_runtimelinking" = no ; then
     test "$enable_shared" = yes && enable_static=no
   fi
-    ;;
+  ;;
+
 esac
 echo "$as_me:$LINENO: result: $enable_shared" >&5
 echo "${ECHO_T}$enable_shared" >&6
@@ -9161,8 +8716,7 @@
   # Now quote all the things that may contain metacharacters while being
   # careful not to overquote the AC_SUBSTed values.  We take copies of the
   # variables and quote the copies for generation of the libtool script.
-  for var in echo old_CC old_CFLAGS AR AR_FLAGS EGREP RANLIB LN_S LTCC NM \
-    SED SHELL STRIP \
+  for var in echo old_CC old_CFLAGS AR AR_FLAGS EGREP RANLIB LN_S LTCC NM SED SHELL \
     libname_spec library_names_spec soname_spec extract_expsyms_cmds \
     old_striplib striplib file_magic_cmd finish_cmds finish_eval \
     deplibs_check_method reload_flag reload_cmds need_locks \
@@ -9220,7 +8774,7 @@
     old_postinstall_cmds | old_postuninstall_cmds | \
     sys_lib_search_path_spec | sys_lib_dlsearch_path_spec)
       # Double-quote double-evaled strings.
-      eval "lt_$var=\\\"\`\$echo \"X\$$var\" | \$Xsed -e \"\$double_quote_subst\" -e \"\$sed_quote_subst\" -e \"\$delay_variable_subst\"\`\\\""
+      eval "lt_$var=\\\"\`\$echo \"X\$$var\" | \$Xsed -e \"\$double_quote_subst\" -e \"\$sed_quote_subst\" -e \"\$delay_variable_subst\" -e \"\$unescape_variable_subst\"\`\\\""
       ;;
     *)
       eval "lt_$var=\\\"\`\$echo \"X\$$var\" | \$Xsed -e \"\$sed_quote_subst\"\`\\\""
@@ -9265,7 +8819,7 @@
 #
 # You should have received a copy of the GNU General Public License
 # along with this program; if not, write to the Free Software
-# Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.
+# Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.
 #
 # As a special exception to the GNU General Public License, if you
 # distribute this file as part of a program that contains a
@@ -9276,11 +8830,11 @@
 SED=$lt_SED
 
 # Sed that helps us avoid accidentally triggering echo(1) options like -n.
-Xsed="$SED -e 1s/^X//"
+Xsed="$SED -e s/^X//"
 
 # The HP-UX ksh and POSIX shell print the target directory to stdout
 # if CDPATH is set.
-(unset CDPATH) >/dev/null 2>&1 && unset CDPATH
+if test "X\${CDPATH+set}" = Xset; then CDPATH=:; export CDPATH; fi
 
 # The names of the tagged configurations supported by this script.
 available_tags=
@@ -9289,6 +8843,9 @@
 
 # Libtool was configured on host `(hostname || uname -n) 2>/dev/null | sed 1q`:
 
+# Set the command separator (default: ~)
+_S_=\${LIBTOOL_CMD_SEP-\~}
+
 # Shell to use when invoking shell scripts.
 SHELL=$lt_SHELL
 
@@ -9310,12 +8867,6 @@
 # The host system.
 host_alias=$host_alias
 host=$host
-host_os=$host_os
-
-# The build system.
-build_alias=$build_alias
-build=$build
-build_os=$build_os
 
 # An echo program that does not interpret backslashes.
 echo=$lt_echo
@@ -9346,7 +8897,7 @@
 NM=$lt_NM
 
 # A symbol stripping program
-STRIP=$lt_STRIP
+STRIP=$STRIP
 
 # Used to examine libraries when file_magic_cmd begins "file"
 MAGIC_CMD=$MAGIC_CMD
@@ -9377,7 +8928,7 @@
 libext="$libext"
 
 # Shared library suffix (normally ".so").
-shrext_cmds='$shrext_cmds'
+shrext='$shrext'
 
 # Executable file suffix (normally "").
 exeext="$exeext"
@@ -9392,7 +8943,7 @@
 # Does compiler simultaneously support -c and -o options?
 compiler_c_o=$lt_lt_cv_prog_compiler_c_o
 
-# Must we lock files when doing compilation?
+# Must we lock files when doing compilation ?
 need_locks=$lt_need_locks
 
 # Do we need the lib prefix for modules?
@@ -9619,10 +9170,7 @@
   # If there is no Makefile yet, we rely on a make rule to execute
   # `config.status --recheck' to rerun these tests and create the
   # libtool script then.
-  ltmain_in=`echo $ltmain | sed -e 's/\.sh$/.in/'`
-  if test -f "$ltmain_in"; then
-    test -f Makefile && make "$ltmain"
-  fi
+  test -f Makefile && make "$ltmain"
 fi
 
 
@@ -9687,9 +9235,7 @@
 
       case $tagname in
       CXX)
-	if test -n "$CXX" && ( test "X$CXX" != "Xno" &&
-	    ( (test "X$CXX" = "Xg++" && `g++ -v >/dev/null 2>&1` ) ||
-	    (test "X$CXX" != "Xg++"))) ; then
+	if test -n "$CXX" && test "X$CXX" != "Xno"; then
 	  ac_ext=cc
 ac_cpp='$CXXCPP $CPPFLAGS'
 ac_compile='$CXX -c $CXXFLAGS $CPPFLAGS conftest.$ac_ext >&5'
@@ -9726,7 +9272,7 @@
 compiler_lib_search_path_CXX=
 
 # Source file extension for C++ test sources.
-ac_ext=cpp
+ac_ext=cc
 
 # Object file extension for compiled C++ test sources.
 objext=o
@@ -9747,20 +9293,6 @@
 compiler=$CC
 
 
-# save warnings/boilerplate of simple test code
-ac_outfile=conftest.$ac_objext
-printf "$lt_simple_compile_test_code" >conftest.$ac_ext
-eval "$ac_compile" 2>&1 >/dev/null | $SED '/^$/d' >conftest.err
-_lt_compiler_boilerplate=`cat conftest.err`
-$rm conftest*
-
-ac_outfile=conftest.$ac_objext
-printf "$lt_simple_link_test_code" >conftest.$ac_ext
-eval "$ac_link" 2>&1 >/dev/null | $SED '/^$/d' >conftest.err
-_lt_linker_boilerplate=`cat conftest.err`
-$rm conftest*
-
-
 # Allow CC to be a program name with arguments.
 lt_save_CC=$CC
 lt_save_LD=$LD
@@ -9782,16 +9314,7 @@
 CC=${CXX-"c++"}
 compiler=$CC
 compiler_CXX=$CC
-for cc_temp in $compiler""; do
-  case $cc_temp in
-    compile | *[\\/]compile | ccache | *[\\/]ccache ) ;;
-    distcc | *[\\/]distcc | purify | *[\\/]purify ) ;;
-    \-*) ;;
-    *) break;;
-  esac
-done
-cc_basename=`$echo "X$cc_temp" | $Xsed -e 's%.*/%%' -e "s%^$host_alias-%%"`
-
+cc_basename=`$echo X"$compiler" | $Xsed -e 's%^.*/%%'`
 
 # We don't want -fno-exception wen compiling C++ code, so set the
 # no_builtin_flag separately
@@ -9828,7 +9351,7 @@
     # Accept absolute paths.
     [\\/]* | ?:[\\/]*)
       re_direlt='/[^/][^/]*/\.\./'
-      # Canonicalize the pathname of ld
+      # Canonicalize the path of ld
       ac_prog=`echo $ac_prog| $SED 's%\\\\%/%g'`
       while echo $ac_prog | grep "$re_direlt" > /dev/null 2>&1; do
 	ac_prog=`echo $ac_prog| $SED "s%$re_direlt%/%"`
@@ -9862,7 +9385,7 @@
     if test -f "$ac_dir/$ac_prog" || test -f "$ac_dir/$ac_prog$ac_exeext"; then
       lt_cv_path_LD="$ac_dir/$ac_prog"
       # Check to see if the program is GNU ld.  I'd rather use --version,
-      # but apparently some variants of GNU ld only accept -v.
+      # but apparently some GNU ld's only accept -v.
       # Break only if it was the GNU/non-GNU ld that we prefer.
       case `"$lt_cv_path_LD" -v 2>&1 </dev/null` in
       *GNU* | *'with BFD'*)
@@ -9896,8 +9419,8 @@
 if test "${lt_cv_prog_gnu_ld+set}" = set; then
   echo $ECHO_N "(cached) $ECHO_C" >&6
 else
-  # I'd rather use --version here, but apparently some GNU lds only accept -v.
-case `$LD -v 2>&1 </dev/null` in
+  # I'd rather use --version here, but apparently some GNU ld's only accept -v.
+case `"$LD" -v 2>&1 </dev/null` in
 *GNU* | *'with BFD'*)
   lt_cv_prog_gnu_ld=yes
   ;;
@@ -9942,7 +9465,7 @@
     # linker, instead of GNU ld.  If possible, this setting should
     # overridden to take advantage of the native linker features on
     # the platform it is being used on.
-    archive_cmds_CXX='$CC -shared -nostdlib $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags -o $lib'
+    archive_cmds_CXX='$CC -shared $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags -o $lib'
   fi
 
   # Commands to make compiler produce verbose output that lists
@@ -10005,7 +9528,7 @@
     link_all_deplibs_CXX=yes
 
     if test "$GXX" = yes; then
-      case $host_os in aix4.[012]|aix4.[012].*)
+      case $host_os in aix4.012|aix4.012.*)
       # We only want to do this on AIX 4.2 and lower, the check
       # below for broken collect2 doesn't work under 4.3+
 	collect2name=`${CC} -print-prog-name=collect2`
@@ -10026,9 +9549,6 @@
 	fi
       esac
       shared_flag='-shared'
-      if test "$aix_use_runtimelinking" = yes; then
-	shared_flag="$shared_flag "'${wl}-G'
-      fi
     else
       # not using gcc
       if test "$host_cpu" = ia64; then
@@ -10053,6 +9573,7 @@
       allow_undefined_flag_CXX='-berok'
       # Determine the default libpath from the value encoded in an empty executable.
       cat >conftest.$ac_ext <<_ACEOF
+#line $LINENO "configure"
 /* confdefs.h.  */
 _ACEOF
 cat confdefs.h >>conftest.$ac_ext
@@ -10069,21 +9590,11 @@
 _ACEOF
 rm -f conftest.$ac_objext conftest$ac_exeext
 if { (eval echo "$as_me:$LINENO: \"$ac_link\"") >&5
-  (eval $ac_link) 2>conftest.er1
+  (eval $ac_link) 2>&5
   ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
   echo "$as_me:$LINENO: \$? = $ac_status" >&5
   (exit $ac_status); } &&
-	 { ac_try='test -z "$ac_cxx_werror_flag"
-			 || test ! -s conftest.err'
-  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
-  (eval $ac_try) 2>&5
-  ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; } &&
-	 { ac_try='test -s conftest$ac_exeext'
+         { ac_try='test -s conftest$ac_exeext'
   { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
@@ -10100,8 +9611,7 @@
 sed 's/^/| /' conftest.$ac_ext >&5
 
 fi
-rm -f conftest.err conftest.$ac_objext \
-      conftest$ac_exeext conftest.$ac_ext
+rm -f conftest.$ac_objext conftest$ac_exeext conftest.$ac_ext
 if test -z "$aix_libpath"; then aix_libpath="/usr/lib:/lib"; fi
 
       hardcode_libdir_flag_spec_CXX='${wl}-blibpath:$libdir:'"$aix_libpath"
@@ -10115,6 +9625,7 @@
       else
 	# Determine the default libpath from the value encoded in an empty executable.
 	cat >conftest.$ac_ext <<_ACEOF
+#line $LINENO "configure"
 /* confdefs.h.  */
 _ACEOF
 cat confdefs.h >>conftest.$ac_ext
@@ -10131,21 +9642,11 @@
 _ACEOF
 rm -f conftest.$ac_objext conftest$ac_exeext
 if { (eval echo "$as_me:$LINENO: \"$ac_link\"") >&5
-  (eval $ac_link) 2>conftest.er1
+  (eval $ac_link) 2>&5
   ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
   echo "$as_me:$LINENO: \$? = $ac_status" >&5
   (exit $ac_status); } &&
-	 { ac_try='test -z "$ac_cxx_werror_flag"
-			 || test ! -s conftest.err'
-  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
-  (eval $ac_try) 2>&5
-  ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; } &&
-	 { ac_try='test -s conftest$ac_exeext'
+         { ac_try='test -s conftest$ac_exeext'
   { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
@@ -10162,8 +9663,7 @@
 sed 's/^/| /' conftest.$ac_ext >&5
 
 fi
-rm -f conftest.err conftest.$ac_objext \
-      conftest$ac_exeext conftest.$ac_ext
+rm -f conftest.$ac_objext conftest$ac_exeext conftest.$ac_ext
 if test -z "$aix_libpath"; then aix_libpath="/usr/lib:/lib"; fi
 
 	hardcode_libdir_flag_spec_CXX='${wl}-blibpath:$libdir:'"$aix_libpath"
@@ -10176,8 +9676,8 @@
 	# Exported symbols can be pulled into shared objects from archives
 	whole_archive_flag_spec_CXX=' '
 	archive_cmds_need_lc_CXX=yes
-	# This is similar to how AIX traditionally builds its shared libraries.
-	archive_expsym_cmds_CXX="\$CC $shared_flag"' -o $output_objdir/$soname $libobjs $deplibs $compiler_flags ${wl}-bE:$export_symbols ${wl}-bnoentry${allow_undefined_flag}~$AR $AR_FLAGS $output_objdir/$libname$release.a $output_objdir/$soname'
+	# This is similar to how AIX traditionally builds it's shared libraries.
+	archive_expsym_cmds_CXX="\$CC $shared_flag"' -o $output_objdir/$soname $libobjs $deplibs $compiler_flags ${wl}-bE:$export_symbols ${wl}-bnoentry${allow_undefined_flag}\${_S_}$AR $AR_FLAGS $output_objdir/$libname$release.a $output_objdir/$soname'
       fi
     fi
     ;;
@@ -10190,7 +9690,6 @@
     esac
     ;;
 
-
   cygwin* | mingw* | pw32*)
     # _LT_AC_TAGVAR(hardcode_libdir_flag_spec, CXX) is actually meaningless,
     # as there is no search path for DLLs.
@@ -10208,82 +9707,106 @@
       else
 	echo EXPORTS > $output_objdir/$soname.def;
 	cat $export_symbols >> $output_objdir/$soname.def;
-      fi~
+      fi${_S_}
       $CC -shared -nostdlib $output_objdir/$soname.def $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags -o $output_objdir/$soname ${wl}--image-base=0x10000000 ${wl}--out-implib,$lib'
     else
       ld_shlibs_CXX=no
     fi
   ;;
-      darwin* | rhapsody*)
-        case $host_os in
-        rhapsody* | darwin1.[012])
-         allow_undefined_flag_CXX='${wl}-undefined ${wl}suppress'
-         ;;
-       *) # Darwin 1.3 on
-         if test -z ${MACOSX_DEPLOYMENT_TARGET} ; then
-           allow_undefined_flag_CXX='${wl}-flat_namespace ${wl}-undefined ${wl}suppress'
-         else
-           case ${MACOSX_DEPLOYMENT_TARGET} in
-             10.[012])
-               allow_undefined_flag_CXX='${wl}-flat_namespace ${wl}-undefined ${wl}suppress'
-               ;;
-             10.*)
-               allow_undefined_flag_CXX='${wl}-undefined ${wl}dynamic_lookup'
-               ;;
-           esac
-         fi
-         ;;
-        esac
-      archive_cmds_need_lc_CXX=no
-      hardcode_direct_CXX=no
-      hardcode_automatic_CXX=yes
-      hardcode_shlibpath_var_CXX=unsupported
-      whole_archive_flag_spec_CXX=''
-      link_all_deplibs_CXX=yes
-
-    if test "$GXX" = yes ; then
-      lt_int_apple_cc_single_mod=no
-      output_verbose_link_cmd='echo'
-      if $CC -dumpspecs 2>&1 | $EGREP 'single_module' >/dev/null ; then
-       lt_int_apple_cc_single_mod=yes
+
+  darwin* | rhapsody*)
+    archive_cmds_need_lc_CXX=no
+    case "$host_os" in
+    rhapsody* | darwin1.[012])
+      allow_undefined_flag_CXX='-undefined suppress'
+      ;;
+    darwin1.* | darwin[2-6].*) # Darwin 1.3 on, but less than 7.0
+      test -z ${LD_TWOLEVEL_NAMESPACE} && allow_undefined_flag_CXX='-flat_namespace -undefined suppress'
+      ;;
+    *) # Darwin 7.0 on
+      case "${MACOSX_DEPLOYMENT_TARGET-10.1}" in
+      10.[012])
+	test -z ${LD_TWOLEVEL_NAMESPACE} && allow_undefined_flag_CXX='-flat_namespace -undefined suppress'
+	;;
+      *) # 10.3 on
+	if test -z ${LD_TWOLEVEL_NAMESPACE}; then
+	  allow_undefined_flag_CXX='-flat_namespace -undefined suppress'
+	else
+	  allow_undefined_flag_CXX='-undefined dynamic_lookup'
+	fi
+	;;
+      esac
+      ;;
+    esac
+
+cat >conftest.$ac_ext <<_ACEOF
+#line $LINENO "configure"
+#include "confdefs.h"
+
+#ifdef F77_DUMMY_MAIN
+#  ifdef __cplusplus
+     extern "C"#  endif
+   int F77_DUMMY_MAIN() { return 1; }
+#endif
+int
+main (){
+  ;
+  return 0;}
+_ACEOF
+
+  if $CC -v conftest.$ac_ext -o conftest$ac_exeext 2>&1 | grep 'Apple' >/dev/null ; then
+
+    	lt_int_apple_cc_single_mod=no
+    	output_verbose_link_cmd='echo'
+    	if $CC -dumpspecs 2>&1 | grep 'single_module' >/dev/null ; then
+    	  lt_int_apple_cc_single_mod=yes
+    	fi
+    	if test "X$lt_int_apple_cc_single_mod" = Xyes ; then
+    	  archive_cmds_CXX='$CC -dynamiclib $archargs -single_module $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags -install_name SW_PREFIX/lib/ccp4-5.99.5/$soname $verstring'
+    	else
+        archive_cmds_CXX='$CC -r ${wl}-bind_at_load -keep_private_externs -nostdlib -o ${lib}-master.o $libobjs${_S_}$CC -dynamiclib $archargs $allow_undefined_flag -o $lib ${lib}-master.o $deplibs $compiler_flags -install_name SW_PREFIX/lib/ccp4-5.99.5/$soname $verstring'
       fi
+      module_cmds_CXX='$CC -bundle $archargs ${wl}-bind_at_load $allow_undefined_flag -o $lib $libobjs $deplibs$compiler_flags'
+
+    # Don't fix this by using the ld -exported_symbols_list flag, it doesn't exist in older darwin ld's
       if test "X$lt_int_apple_cc_single_mod" = Xyes ; then
-       archive_cmds_CXX='$CC -dynamiclib -single_module $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags -install_name $rpath/$soname $verstring'
+        archive_expsym_cmds_CXX='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym${_S_}$CC -dynamiclib $archargs -single_module $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags -install_name SW_PREFIX/lib/ccp4-5.99.5/$soname $verstring${_S_}nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
       else
-          archive_cmds_CXX='$CC -r -keep_private_externs -nostdlib -o ${lib}-master.o $libobjs~$CC -dynamiclib $allow_undefined_flag -o $lib ${lib}-master.o $deplibs $compiler_flags -install_name $rpath/$soname $verstring'
-        fi
-        module_cmds_CXX='$CC $allow_undefined_flag -o $lib -bundle $libobjs $deplibs$compiler_flags'
-        # Don't fix this by using the ld -exported_symbols_list flag, it doesn't exist in older darwin lds
-          if test "X$lt_int_apple_cc_single_mod" = Xyes ; then
-            archive_expsym_cmds_CXX='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC -dynamiclib -single_module $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags -install_name $rpath/$soname $verstring~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
-          else
-            archive_expsym_cmds_CXX='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC -r -keep_private_externs -nostdlib -o ${lib}-master.o $libobjs~$CC -dynamiclib $allow_undefined_flag -o $lib ${lib}-master.o $deplibs $compiler_flags -install_name $rpath/$soname $verstring~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
-          fi
-            module_expsym_cmds_CXX='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC $allow_undefined_flag  -o $lib -bundle $libobjs $deplibs$compiler_flags~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
-      else
-      case $cc_basename in
-        xlc*)
-         output_verbose_link_cmd='echo'
-          archive_cmds_CXX='$CC -qmkshrobj ${wl}-single_module $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-install_name ${wl}`echo $rpath/$soname` $verstring'
-          module_cmds_CXX='$CC $allow_undefined_flag -o $lib -bundle $libobjs $deplibs$compiler_flags'
-          # Don't fix this by using the ld -exported_symbols_list flag, it doesn't exist in older darwin lds
-          archive_expsym_cmds_CXX='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC -qmkshrobj ${wl}-single_module $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-install_name ${wl}$rpath/$soname $verstring~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
-          module_expsym_cmds_CXX='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC $allow_undefined_flag  -o $lib -bundle $libobjs $deplibs$compiler_flags~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
-          ;;
-       *)
-         ld_shlibs_CXX=no
-          ;;
-      esac
+        archive_expsym_cmds_CXX='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym${_S_}$CC -r ${wl}-bind_at_load -keep_private_externs -nostdlib -o ${lib}-master.o $libobjs${_S_}$CC -dynamiclib $archargs $allow_undefined_flag -o $lib ${lib}-master.o $deplibs $compiler_flags -install_name SW_PREFIX/lib/ccp4-5.99.5/$soname $verstring${_S_}nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
       fi
-        ;;
+        module_expsym_cmds_CXX='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym${_S_}$CC -bundle $archargs $allow_undefined_flag  -o $lib $libobjs $deplibs$compiler_flags${_S_}nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
+    hardcode_direct_CXX=no
+    hardcode_automatic_CXX=yes
+    hardcode_shlibpath_var_CXX=unsupported
+    whole_archive_flag_spec_CXX='-all_load $convenience'
+    link_all_deplibs_CXX=yes
+
+    elif $CC -v conftest.$ac_ext -o conftest$ac_exeext 2>&1 | grep 'XL_CONFIG' >/dev/null ; then
+    # FIXME: Relying on posixy $() will cause problems for    #        cross-compilation, but unfortunately the echo tests do not
+    #        yet detect zsh echo's removal of \ escapes.  Also zsh mangles
+    #          `"' quotes if we put them in here... so don't!
+    output_verbose_link_cmd='echo'
+    archive_cmds_CXX='$LD -dynamic -dylib $allow_undefined_flag -o $lib $libobjs -ldylib1.o $deplibs$compiler_flags -dylib_install_name $soname $verstring'
+    module_cmds_CXX='$LD -bundle $allow_undefined_flag -o $lib $libobjs $deplibs$compiler_flags'
+    # Don't fix this by using the ld -exported_symbols_list flag, it doesn't exist in older darwin ld's
+    archive_expsym_cmds_CXX='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$LD -dynamic -dylib $allow_undefined_flag -o $lib $libobjs $deplibs$compiler_flags -dylib_install_name $soname $verstring~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
+    module_expsym_cmds_CXX='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$LD -bundle $allow_undefined_flag  -o $lib $libobjs $deplibs$compiler_flags~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
+    hardcode_direct_CXX=no
+    hardcode_automatic_CXX=yes
+    hardcode_shlibpath_var_CXX=unsupported
+    whole_archive_flag_spec_CXX='-all_load $convenience'
+    link_all_deplibs_CXX=yes
+    fi
+    rm -f conftest.$ac_ext conftest$ac_exeext
+    ;;
 
   dgux*)
     case $cc_basename in
-      ec++*)
+      ec++)
 	# FIXME: insert proper C++ library support
 	ld_shlibs_CXX=no
 	;;
-      ghcx*)
+      ghcx)
 	# Green Hills C++ Compiler
 	# FIXME: insert proper C++ library support
 	ld_shlibs_CXX=no
@@ -10294,14 +9817,14 @@
 	;;
     esac
     ;;
-  freebsd[12]*)
+  freebsd12*)
     # C++ shared libraries reported to be fairly broken before switch to ELF
     ld_shlibs_CXX=no
     ;;
   freebsd-elf*)
     archive_cmds_need_lc_CXX=no
     ;;
-  freebsd* | kfreebsd*-gnu | dragonfly*)
+  freebsd*)
     # FreeBSD 3 and later use GNU C++ and GNU ld with standard ELF
     # conventions
     ld_shlibs_CXX=yes
@@ -10318,12 +9841,12 @@
 				# location of the library.
 
     case $cc_basename in
-    CC*)
+    CC)
       # FIXME: insert proper C++ library support
       ld_shlibs_CXX=no
       ;;
-    aCC*)
-      archive_cmds_CXX='$rm $output_objdir/$soname~$CC -b ${wl}+b ${wl}$install_libdir -o $output_objdir/$soname $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags~test $output_objdir/$soname = $lib || mv $output_objdir/$soname $lib'
+    aCC)
+      archive_cmds_CXX='$rm $output_objdir/$soname${_S_}$CC -b ${wl}+b ${wl}$install_libdir -o $output_objdir/$soname $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags${_S_}test $output_objdir/$soname = $lib || mv $output_objdir/$soname $lib'
       # Commands to make compiler produce verbose output that lists
       # what "hidden" libraries, object files and flags are used when
       # linking a shared library.
@@ -10332,11 +9855,11 @@
       # explicitly linking system object files so we need to strip them
       # from the output so that they don't get included in the library
       # dependencies.
-      output_verbose_link_cmd='templist=`($CC -b $CFLAGS -v conftest.$objext 2>&1) | grep "[-]L"`; list=""; for z in $templist; do case $z in conftest.$objext) list="$list $z";; *.$objext);; *) list="$list $z";;esac; done; echo $list'
+      output_verbose_link_cmd='templist=`($CC -b $CFLAGS -v conftest.$objext 2>&1) | egrep "\-L"`; list=""; for z in $templist; do case $z in conftest.$objext) list="$list $z";; *.$objext);; *) list="$list $z";;esac; done; echo $list'
       ;;
     *)
       if test "$GXX" = yes; then
-        archive_cmds_CXX='$rm $output_objdir/$soname~$CC -shared -nostdlib -fPIC ${wl}+b ${wl}$install_libdir -o $output_objdir/$soname $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags~test $output_objdir/$soname = $lib || mv $output_objdir/$soname $lib'
+        archive_cmds_CXX='$rm $output_objdir/$soname${_S_}$CC -shared -nostdlib -fPIC ${wl}+b ${wl}$install_libdir -o $output_objdir/$soname $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags${_S_}test $output_objdir/$soname = $lib || mv $output_objdir/$soname $lib'
       else
         # FIXME: insert proper C++ library support
         ld_shlibs_CXX=no
@@ -10346,7 +9869,7 @@
     ;;
   hpux10*|hpux11*)
     if test $with_gnu_ld = no; then
-      case $host_cpu in
+      case "$host_cpu" in
       hppa*64*)
 	hardcode_libdir_flag_spec_CXX='${wl}+b ${wl}$libdir'
 	hardcode_libdir_flag_spec_ld_CXX='+b $libdir'
@@ -10362,7 +9885,7 @@
         ;;
       esac
     fi
-    case $host_cpu in
+    case "$host_cpu" in
     hppa*64*)
       hardcode_direct_CXX=no
       hardcode_shlibpath_var_CXX=no
@@ -10383,12 +9906,12 @@
     esac
 
     case $cc_basename in
-      CC*)
+      CC)
 	# FIXME: insert proper C++ library support
 	ld_shlibs_CXX=no
 	;;
-      aCC*)
-	case $host_cpu in
+      aCC)
+	case "$host_cpu" in
 	hppa*64*|ia64*)
 	  archive_cmds_CXX='$LD -b +h $soname -o $lib $linker_flags $libobjs $deplibs'
 	  ;;
@@ -10409,7 +9932,7 @@
       *)
 	if test "$GXX" = yes; then
 	  if test $with_gnu_ld = no; then
-	    case $host_cpu in
+	    case "$host_cpu" in
 	    ia64*|hppa*64*)
 	      archive_cmds_CXX='$LD -b +h $soname -o $lib $linker_flags $libobjs $deplibs'
 	      ;;
@@ -10427,9 +9950,9 @@
     ;;
   irix5* | irix6*)
     case $cc_basename in
-      CC*)
+      CC)
 	# SGI C++
-	archive_cmds_CXX='$CC -shared -all -multigot $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags -soname $soname `test -n "$verstring" && echo -set_version $verstring` -update_registry ${output_objdir}/so_locations -o $lib'
+	archive_cmds_CXX='$CC -shared -all -multigot $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags -soname $soname `test -n "$verstring" && echo -set_version $verstring` -update_registry ${objdir}/so_locations -o $lib'
 
 	# Archives containing C++ object files must be created using
 	# "CC -ar", where "CC" is the IRIX C++ compiler.  This is
@@ -10440,7 +9963,7 @@
       *)
 	if test "$GXX" = yes; then
 	  if test "$with_gnu_ld" = no; then
-	    archive_cmds_CXX='$CC -shared -nostdlib $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags ${wl}-soname ${wl}$soname `test -n "$verstring" && echo ${wl}-set_version ${wl}$verstring` ${wl}-update_registry ${wl}${output_objdir}/so_locations -o $lib'
+	    archive_cmds_CXX='$CC -shared -nostdlib $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags ${wl}-soname ${wl}$soname `test -n "$verstring" && echo ${wl}-set_version ${wl}$verstring` ${wl}-update_registry ${wl}${objdir}/so_locations -o $lib'
 	  else
 	    archive_cmds_CXX='$CC -shared -nostdlib $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags ${wl}-soname ${wl}$soname `test -n "$verstring" && echo ${wl}-set_version ${wl}$verstring` -o $lib'
 	  fi
@@ -10453,7 +9976,7 @@
     ;;
   linux*)
     case $cc_basename in
-      KCC*)
+      KCC)
 	# Kuck and Associates, Inc. (KAI) C++ Compiler
 
 	# KCC will only create a shared library if the output file
@@ -10478,41 +10001,17 @@
 	# "CC -Bstatic", where "CC" is the KAI C++ compiler.
 	old_archive_cmds_CXX='$CC -Bstatic -o $oldlib $oldobjs'
 	;;
-      icpc*)
+      icpc)
 	# Intel C++
 	with_gnu_ld=yes
-	# version 8.0 and above of icpc choke on multiply defined symbols
-	# if we add $predep_objects and $postdep_objects, however 7.1 and
-	# earlier do not add the objects themselves.
-	case `$CC -V 2>&1` in
-	*"Version 7."*)
-  	  archive_cmds_CXX='$CC -shared $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags ${wl}-soname $wl$soname -o $lib'
-  	  archive_expsym_cmds_CXX='$CC -shared $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags ${wl}-soname $wl$soname ${wl}-retain-symbols-file $wl$export_symbols -o $lib'
-	  ;;
-	*)  # Version 8.0 or newer
-	  tmp_idyn=
-	  case $host_cpu in
-	    ia64*) tmp_idyn=' -i_dynamic';;
-	  esac
-  	  archive_cmds_CXX='$CC -shared'"$tmp_idyn"' $libobjs $deplibs $compiler_flags ${wl}-soname $wl$soname -o $lib'
-	  archive_expsym_cmds_CXX='$CC -shared'"$tmp_idyn"' $libobjs $deplibs $compiler_flags ${wl}-soname $wl$soname ${wl}-retain-symbols-file $wl$export_symbols -o $lib'
-	  ;;
-	esac
 	archive_cmds_need_lc_CXX=no
+	archive_cmds_CXX='$CC -shared $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags ${wl}-soname $wl$soname -o $lib'
+	archive_expsym_cmds_CXX='$CC -shared $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags ${wl}-soname $wl$soname ${wl}-retain-symbols-file $wl$export_symbols -o $lib'
 	hardcode_libdir_flag_spec_CXX='${wl}-rpath,$libdir'
 	export_dynamic_flag_spec_CXX='${wl}--export-dynamic'
 	whole_archive_flag_spec_CXX='${wl}--whole-archive$convenience ${wl}--no-whole-archive'
 	;;
-      pgCC*)
-        # Portland Group C++ compiler
-	archive_cmds_CXX='$CC -shared $pic_flag $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags ${wl}-soname ${wl}$soname -o $lib'
-  	archive_expsym_cmds_CXX='$CC -shared $pic_flag $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags ${wl}-soname ${wl}$soname ${wl}-retain-symbols-file ${wl}$export_symbols -o $lib'
-
-	hardcode_libdir_flag_spec_CXX='${wl}--rpath ${wl}$libdir'
-	export_dynamic_flag_spec_CXX='${wl}--export-dynamic'
-	whole_archive_flag_spec_CXX='${wl}--whole-archive`for conv in $convenience\"\"; do test  -n \"$conv\" && new_convenience=\"$new_convenience,$conv\"; done; $echo \"$new_convenience\"` ${wl}--no-whole-archive'
-        ;;
-      cxx*)
+      cxx)
 	# Compaq C++
 	archive_cmds_CXX='$CC -shared $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags ${wl}-soname $wl$soname -o $lib'
 	archive_expsym_cmds_CXX='$CC -shared $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags ${wl}-soname $wl$soname  -o $lib ${wl}-retain-symbols-file $wl$export_symbols'
@@ -10543,7 +10042,7 @@
     ;;
   mvs*)
     case $cc_basename in
-      cxx*)
+      cxx)
 	# FIXME: insert proper C++ library support
 	ld_shlibs_CXX=no
 	;;
@@ -10564,25 +10063,9 @@
     # Workaround some broken pre-1.5 toolchains
     output_verbose_link_cmd='$CC -shared $CFLAGS -v conftest.$objext 2>&1 | grep conftest.$objext | $SED -e "s:-lgcc -lc -lgcc::"'
     ;;
-  openbsd2*)
-    # C++ shared libraries are fairly broken
-    ld_shlibs_CXX=no
-    ;;
-  openbsd*)
-    hardcode_direct_CXX=yes
-    hardcode_shlibpath_var_CXX=no
-    archive_cmds_CXX='$CC -shared $pic_flag $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags -o $lib'
-    hardcode_libdir_flag_spec_CXX='${wl}-rpath,$libdir'
-    if test -z "`echo __ELF__ | $CC -E - | grep __ELF__`" || test "$host_os-$host_cpu" = "openbsd2.8-powerpc"; then
-      archive_expsym_cmds_CXX='$CC -shared $pic_flag $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags ${wl}-retain-symbols-file,$export_symbols -o $lib'
-      export_dynamic_flag_spec_CXX='${wl}-E'
-      whole_archive_flag_spec_CXX="$wlarc"'--whole-archive$convenience '"$wlarc"'--no-whole-archive'
-    fi
-    output_verbose_link_cmd='echo'
-    ;;
   osf3*)
     case $cc_basename in
-      KCC*)
+      KCC)
 	# Kuck and Associates, Inc. (KAI) C++ Compiler
 
 	# KCC will only create a shared library if the output file
@@ -10598,14 +10081,14 @@
 	old_archive_cmds_CXX='$CC -Bstatic -o $oldlib $oldobjs'
 
 	;;
-      RCC*)
+      RCC)
 	# Rational C++ 2.4.1
 	# FIXME: insert proper C++ library support
 	ld_shlibs_CXX=no
 	;;
-      cxx*)
+      cxx)
 	allow_undefined_flag_CXX=' ${wl}-expect_unresolved ${wl}\*'
-	archive_cmds_CXX='$CC -shared${allow_undefined_flag} $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags ${wl}-soname $soname `test -n "$verstring" && echo ${wl}-set_version $verstring` -update_registry ${output_objdir}/so_locations -o $lib'
+	archive_cmds_CXX='$CC -shared${allow_undefined_flag} $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags ${wl}-soname $soname `test -n "$verstring" && echo ${wl}-set_version $verstring` -update_registry ${objdir}/so_locations -o $lib'
 
 	hardcode_libdir_flag_spec_CXX='${wl}-rpath ${wl}$libdir'
 	hardcode_libdir_separator_CXX=:
@@ -10623,7 +10106,7 @@
       *)
 	if test "$GXX" = yes && test "$with_gnu_ld" = no; then
 	  allow_undefined_flag_CXX=' ${wl}-expect_unresolved ${wl}\*'
-	  archive_cmds_CXX='$CC -shared -nostdlib ${allow_undefined_flag} $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags ${wl}-soname ${wl}$soname `test -n "$verstring" && echo ${wl}-set_version ${wl}$verstring` ${wl}-update_registry ${wl}${output_objdir}/so_locations -o $lib'
+	  archive_cmds_CXX='$CC -shared -nostdlib ${allow_undefined_flag} $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags ${wl}-soname ${wl}$soname `test -n "$verstring" && echo ${wl}-set_version ${wl}$verstring` ${wl}-update_registry ${wl}${objdir}/so_locations -o $lib'
 
 	  hardcode_libdir_flag_spec_CXX='${wl}-rpath ${wl}$libdir'
 	  hardcode_libdir_separator_CXX=:
@@ -10642,7 +10125,7 @@
     ;;
   osf4* | osf5*)
     case $cc_basename in
-      KCC*)
+      KCC)
 	# Kuck and Associates, Inc. (KAI) C++ Compiler
 
 	# KCC will only create a shared library if the output file
@@ -10657,17 +10140,17 @@
 	# the KAI C++ compiler.
 	old_archive_cmds_CXX='$CC -o $oldlib $oldobjs'
 	;;
-      RCC*)
+      RCC)
 	# Rational C++ 2.4.1
 	# FIXME: insert proper C++ library support
 	ld_shlibs_CXX=no
 	;;
-      cxx*)
+      cxx)
 	allow_undefined_flag_CXX=' -expect_unresolved \*'
-	archive_cmds_CXX='$CC -shared${allow_undefined_flag} $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags -msym -soname $soname `test -n "$verstring" && echo -set_version $verstring` -update_registry ${output_objdir}/so_locations -o $lib'
-	archive_expsym_cmds_CXX='for i in `cat $export_symbols`; do printf "%s %s\\n" -exported_symbol "\$i" >> $lib.exp; done~
-	  echo "-hidden">> $lib.exp~
-	  $CC -shared$allow_undefined_flag $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags -msym -soname $soname -Wl,-input -Wl,$lib.exp  `test -n "$verstring" && echo -set_version	$verstring` -update_registry ${output_objdir}/so_locations -o $lib~
+	archive_cmds_CXX='$CC -shared${allow_undefined_flag} $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags -msym -soname $soname `test -n "$verstring" && echo -set_version $verstring` -update_registry ${objdir}/so_locations -o $lib'
+	archive_expsym_cmds_CXX='for i in `cat $export_symbols`; do printf "%s %s\\n" -exported_symbol "\$i" >> $lib.exp; done${_S_}
+	  echo "-hidden">> $lib.exp${_S_}
+	  $CC -shared$allow_undefined_flag $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags -msym -soname $soname -Wl,-input -Wl,$lib.exp  `test -n "$verstring" && echo -set_version	$verstring` -update_registry $objdir/so_locations -o $lib${_S_}
 	  $rm $lib.exp'
 
 	hardcode_libdir_flag_spec_CXX='-rpath $libdir'
@@ -10686,7 +10169,7 @@
       *)
 	if test "$GXX" = yes && test "$with_gnu_ld" = no; then
 	  allow_undefined_flag_CXX=' ${wl}-expect_unresolved ${wl}\*'
-	 archive_cmds_CXX='$CC -shared -nostdlib ${allow_undefined_flag} $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags ${wl}-msym ${wl}-soname ${wl}$soname `test -n "$verstring" && echo ${wl}-set_version ${wl}$verstring` ${wl}-update_registry ${wl}${output_objdir}/so_locations -o $lib'
+	 archive_cmds_CXX='$CC -shared -nostdlib ${allow_undefined_flag} $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags ${wl}-msym ${wl}-soname ${wl}$soname `test -n "$verstring" && echo ${wl}-set_version ${wl}$verstring` ${wl}-update_registry ${wl}${objdir}/so_locations -o $lib'
 
 	  hardcode_libdir_flag_spec_CXX='${wl}-rpath ${wl}$libdir'
 	  hardcode_libdir_separator_CXX=:
@@ -10710,7 +10193,7 @@
   sco*)
     archive_cmds_need_lc_CXX=no
     case $cc_basename in
-      CC*)
+      CC)
 	# FIXME: insert proper C++ library support
 	ld_shlibs_CXX=no
 	;;
@@ -10722,12 +10205,12 @@
     ;;
   sunos4*)
     case $cc_basename in
-      CC*)
+      CC)
 	# Sun C++ 4.x
 	# FIXME: insert proper C++ library support
 	ld_shlibs_CXX=no
 	;;
-      lcc*)
+      lcc)
 	# Lucid
 	# FIXME: insert proper C++ library support
 	ld_shlibs_CXX=no
@@ -10740,33 +10223,36 @@
     ;;
   solaris*)
     case $cc_basename in
-      CC*)
+      CC)
 	# Sun C++ 4.2, 5.x and Centerline C++
-        archive_cmds_need_lc_CXX=yes
 	no_undefined_flag_CXX=' -zdefs'
-	archive_cmds_CXX='$CC -G${allow_undefined_flag}  -h$soname -o $lib $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags'
-	archive_expsym_cmds_CXX='$echo "{ global:" > $lib.exp~cat $export_symbols | $SED -e "s/\(.*\)/\1;/" >> $lib.exp~$echo "local: *; };" >> $lib.exp~
-	$CC -G${allow_undefined_flag}  ${wl}-M ${wl}$lib.exp -h$soname -o $lib $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags~$rm $lib.exp'
+	archive_cmds_CXX='$CC -G${allow_undefined_flag} -nolib -h$soname -o $lib $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags'
+	archive_expsym_cmds_CXX='$echo "{ global:" > $lib.exp${_S_}cat $export_symbols | $SED -e "s/\(.*\)/\1;/" >> $lib.exp${_S_}$echo "local: *; };" >> $lib.exp${_S_}
+	$CC -G${allow_undefined_flag} -nolib ${wl}-M ${wl}$lib.exp -h$soname -o $lib $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags${_S_}$rm $lib.exp'
 
 	hardcode_libdir_flag_spec_CXX='-R$libdir'
 	hardcode_shlibpath_var_CXX=no
 	case $host_os in
-	  solaris2.[0-5] | solaris2.[0-5].*) ;;
+	  solaris2.0-5 | solaris2.0-5.*) ;;
 	  *)
 	    # The C++ compiler is used as linker so we must use $wl
 	    # flag to pass the commands to the underlying system
-	    # linker. We must also pass each convience library through
-	    # to the system linker between allextract/defaultextract.
-	    # The C++ compiler will combine linker options so we
-	    # cannot just pass the convience library names through
-	    # without $wl.
+	    # linker.
 	    # Supported since Solaris 2.6 (maybe 2.5.1?)
-	    whole_archive_flag_spec_CXX='${wl}-z ${wl}allextract`for conv in $convenience\"\"; do test -n \"$conv\" && new_convenience=\"$new_convenience,$conv\"; done; $echo \"$new_convenience\"` ${wl}-z ${wl}defaultextract'
+	    whole_archive_flag_spec_CXX='${wl}-z ${wl}allextract$convenience ${wl}-z ${wl}defaultextract'
 	    ;;
 	esac
 	link_all_deplibs_CXX=yes
 
-	output_verbose_link_cmd='echo'
+	# Commands to make compiler produce verbose output that lists
+	# what "hidden" libraries, object files and flags are used when
+	# linking a shared library.
+	#
+	# There doesn't appear to be a way to prevent this compiler from
+	# explicitly linking system object files so we need to strip them
+	# from the output so that they don't get included in the library
+	# dependencies.
+	output_verbose_link_cmd='templist=`$CC -G $CFLAGS -v conftest.$objext 2>&1 | grep "\-[LR]"`; list=""; for z in $templist; do case $z in conftest.$objext) list="$list $z";; *.$objext);; *) list="$list $z";;esac; done; echo $list'
 
 	# Archives containing C++ object files must be created using
 	# "CC -xar", where "CC" is the Sun C++ compiler.  This is
@@ -10774,7 +10260,7 @@
 	# in the archive.
 	old_archive_cmds_CXX='$CC -xar -o $oldlib $oldobjs'
 	;;
-      gcx*)
+      gcx)
 	# Green Hills C++ Compiler
 	archive_cmds_CXX='$CC -shared $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags ${wl}-h $wl$soname -o $lib'
 
@@ -10787,8 +10273,8 @@
 	  no_undefined_flag_CXX=' ${wl}-z ${wl}defs'
 	  if $CC --version | grep -v '^2\.7' > /dev/null; then
 	    archive_cmds_CXX='$CC -shared -nostdlib $LDFLAGS $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags ${wl}-h $wl$soname -o $lib'
-	    archive_expsym_cmds_CXX='$echo "{ global:" > $lib.exp~cat $export_symbols | $SED -e "s/\(.*\)/\1;/" >> $lib.exp~$echo "local: *; };" >> $lib.exp~
-		$CC -shared -nostdlib ${wl}-M $wl$lib.exp -o $lib $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags~$rm $lib.exp'
+	    archive_expsym_cmds_CXX='$echo "{ global:" > $lib.exp${_S_}cat $export_symbols | $SED -e "s/\(.*\)/\1;/" >> $lib.exp${_S_}$echo "local: *; };" >> $lib.exp${_S_}
+		$CC -shared -nostdlib ${wl}-M $wl$lib.exp -o $lib $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags${_S_}$rm $lib.exp'
 
 	    # Commands to make compiler produce verbose output that lists
 	    # what "hidden" libraries, object files and flags are used when
@@ -10798,8 +10284,8 @@
 	    # g++ 2.7 appears to require `-G' NOT `-shared' on this
 	    # platform.
 	    archive_cmds_CXX='$CC -G -nostdlib $LDFLAGS $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags ${wl}-h $wl$soname -o $lib'
-	    archive_expsym_cmds_CXX='$echo "{ global:" > $lib.exp~cat $export_symbols | $SED -e "s/\(.*\)/\1;/" >> $lib.exp~$echo "local: *; };" >> $lib.exp~
-		$CC -G -nostdlib ${wl}-M $wl$lib.exp -o $lib $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags~$rm $lib.exp'
+	    archive_expsym_cmds_CXX='$echo "{ global:" > $lib.exp${_S_}cat $export_symbols | $SED -e "s/\(.*\)/\1;/" >> $lib.exp${_S_}$echo "local: *; };" >> $lib.exp${_S_}
+		$CC -G -nostdlib ${wl}-M $wl$lib.exp -o $lib $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags${_S_}$rm $lib.exp'
 
 	    # Commands to make compiler produce verbose output that lists
 	    # what "hidden" libraries, object files and flags are used when
@@ -10817,7 +10303,7 @@
     ;;
   tandem*)
     case $cc_basename in
-      NCC*)
+      NCC)
 	# NonStop-UX NCC 3.20
 	# FIXME: insert proper C++ library support
 	ld_shlibs_CXX=no
@@ -10870,7 +10356,7 @@
   # The `*' in the case matches for architectures that use `case' in
   # $output_verbose_cmd can trigger glob expansion during the loop
   # eval without this substitution.
-  output_verbose_link_cmd=`$echo "X$output_verbose_link_cmd" | $Xsed -e "$no_glob_subst"`
+  output_verbose_link_cmd="`$echo \"X$output_verbose_link_cmd\" | $Xsed -e \"$no_glob_subst\"`"
 
   for p in `eval $output_verbose_link_cmd`; do
     case $p in
@@ -10946,20 +10432,6 @@
 
 $rm -f confest.$objext
 
-# PORTME: override above test on systems where it is broken
-case $host_os in
-solaris*)
-  case $cc_basename in
-  CC*)
-    # Adding this requires a known-good setup of shared libraries for
-    # Sun compiler versions before 5.6, else PIC objects from an old
-    # archive will be linked into the output, leading to subtle bugs.
-    postdeps_CXX='-lCstd -lCrun'
-    ;;
-  esac
-esac
-
-
 case " $postdeps_CXX " in
 *" -lc "*) archive_cmds_need_lc_CXX=no ;;
 esac
@@ -11015,7 +10487,7 @@
     hpux*)
       # PIC is the default for IA64 HP-UX and 64-bit HP-UX, but
       # not for PA HP-UX.
-      case $host_cpu in
+      case "$host_cpu" in
       hppa*64*|ia64*)
 	;;
       *)
@@ -11040,28 +10512,27 @@
 	;;
       chorus*)
 	case $cc_basename in
-	cxch68*)
+	cxch68)
 	  # Green Hills C++ Compiler
 	  # _LT_AC_TAGVAR(lt_prog_compiler_static, CXX)="--no_auto_instantiation -u __main -u __premain -u _abort -r $COOL_DIR/lib/libOrb.a $MVME_DIR/lib/CC/libC.a $MVME_DIR/lib/classix/libcx.s.a"
 	  ;;
 	esac
 	;;
-       darwin*)
-         # PIC is the default on this platform
-         # Common symbols not allowed in MH_DYLIB files
-         case $cc_basename in
-           xlc*)
-           lt_prog_compiler_pic_CXX='-qnocommon'
-           lt_prog_compiler_wl_CXX='-Wl,'
-           ;;
-         esac
-       ;;
+      darwin* | rhapsody*)
+      # PIC is the default on this platform
+      # Common symbols not allowed in MH_DYLIB files
+        case $cc_basename in
+          xlc*)
+          lt_prog_compiler_pic_CXX='-qpic -qnocommon'
+          ;;
+        esac
+        ;;
       dgux*)
 	case $cc_basename in
-	  ec++*)
+	  ec++)
 	    lt_prog_compiler_pic_CXX='-KPIC'
 	    ;;
-	  ghcx*)
+	  ghcx)
 	    # Green Hills C++ Compiler
 	    lt_prog_compiler_pic_CXX='-pic'
 	    ;;
@@ -11069,22 +10540,22 @@
 	    ;;
 	esac
 	;;
-      freebsd* | kfreebsd*-gnu | dragonfly*)
+      freebsd*)
 	# FreeBSD uses GNU C++
 	;;
       hpux9* | hpux10* | hpux11*)
 	case $cc_basename in
-	  CC*)
+	  CC)
 	    lt_prog_compiler_wl_CXX='-Wl,'
 	    lt_prog_compiler_static_CXX="${ac_cv_prog_cc_wl}-a ${ac_cv_prog_cc_wl}archive"
 	    if test "$host_cpu" != ia64; then
 	      lt_prog_compiler_pic_CXX='+Z'
 	    fi
 	    ;;
-	  aCC*)
+	  aCC)
 	    lt_prog_compiler_wl_CXX='-Wl,'
 	    lt_prog_compiler_static_CXX="${ac_cv_prog_cc_wl}-a ${ac_cv_prog_cc_wl}archive"
-	    case $host_cpu in
+	    case "$host_cpu" in
 	    hppa*64*|ia64*)
 	      # +Z the default
 	      ;;
@@ -11099,7 +10570,7 @@
 	;;
       irix5* | irix6* | nonstopux*)
 	case $cc_basename in
-	  CC*)
+	  CC)
 	    lt_prog_compiler_wl_CXX='-Wl,'
 	    lt_prog_compiler_static_CXX='-non_shared'
 	    # CC pic flag -KPIC is the default.
@@ -11110,24 +10581,18 @@
 	;;
       linux*)
 	case $cc_basename in
-	  KCC*)
+	  KCC)
 	    # KAI C++ Compiler
 	    lt_prog_compiler_wl_CXX='--backend -Wl,'
 	    lt_prog_compiler_pic_CXX='-fPIC'
 	    ;;
-	  icpc* | ecpc*)
+	  icpc)
 	    # Intel C++
 	    lt_prog_compiler_wl_CXX='-Wl,'
 	    lt_prog_compiler_pic_CXX='-KPIC'
 	    lt_prog_compiler_static_CXX='-static'
 	    ;;
-	  pgCC*)
-	    # Portland Group C++ compiler.
-	    lt_prog_compiler_wl_CXX='-Wl,'
-	    lt_prog_compiler_pic_CXX='-fpic'
-	    lt_prog_compiler_static_CXX='-Bstatic'
-	    ;;
-	  cxx*)
+	  cxx)
 	    # Compaq C++
 	    # Make sure the PIC flag is empty.  It appears that all Alpha
 	    # Linux and Compaq Tru64 Unix objects are PIC.
@@ -11144,7 +10609,7 @@
 	;;
       mvs*)
 	case $cc_basename in
-	  cxx*)
+	  cxx)
 	    lt_prog_compiler_pic_CXX='-W c,exportall'
 	    ;;
 	  *)
@@ -11155,14 +10620,14 @@
 	;;
       osf3* | osf4* | osf5*)
 	case $cc_basename in
-	  KCC*)
+	  KCC)
 	    lt_prog_compiler_wl_CXX='--backend -Wl,'
 	    ;;
-	  RCC*)
+	  RCC)
 	    # Rational C++ 2.4.1
 	    lt_prog_compiler_pic_CXX='-pic'
 	    ;;
-	  cxx*)
+	  cxx)
 	    # Digital/Compaq C++
 	    lt_prog_compiler_wl_CXX='-Wl,'
 	    # Make sure the PIC flag is empty.  It appears that all Alpha
@@ -11178,7 +10643,7 @@
 	;;
       sco*)
 	case $cc_basename in
-	  CC*)
+	  CC)
 	    lt_prog_compiler_pic_CXX='-fPIC'
 	    ;;
 	  *)
@@ -11187,13 +10652,13 @@
 	;;
       solaris*)
 	case $cc_basename in
-	  CC*)
+	  CC)
 	    # Sun C++ 4.2, 5.x and Centerline C++
 	    lt_prog_compiler_pic_CXX='-KPIC'
 	    lt_prog_compiler_static_CXX='-Bstatic'
 	    lt_prog_compiler_wl_CXX='-Qoption ld '
 	    ;;
-	  gcx*)
+	  gcx)
 	    # Green Hills C++ Compiler
 	    lt_prog_compiler_pic_CXX='-PIC'
 	    ;;
@@ -11203,12 +10668,12 @@
 	;;
       sunos4*)
 	case $cc_basename in
-	  CC*)
+	  CC)
 	    # Sun C++ 4.x
 	    lt_prog_compiler_pic_CXX='-pic'
 	    lt_prog_compiler_static_CXX='-Bstatic'
 	    ;;
-	  lcc*)
+	  lcc)
 	    # Lucid
 	    lt_prog_compiler_pic_CXX='-pic'
 	    ;;
@@ -11218,7 +10683,7 @@
 	;;
       tandem*)
 	case $cc_basename in
-	  NCC*)
+	  NCC)
 	    # NonStop-UX NCC 3.20
 	    lt_prog_compiler_pic_CXX='-KPIC'
 	    ;;
@@ -11243,8 +10708,7 @@
 # Check to make sure the PIC flag actually works.
 #
 if test -n "$lt_prog_compiler_pic_CXX"; then
-
-echo "$as_me:$LINENO: checking if $compiler PIC flag $lt_prog_compiler_pic_CXX works" >&5
+  echo "$as_me:$LINENO: checking if $compiler PIC flag $lt_prog_compiler_pic_CXX works" >&5
 echo $ECHO_N "checking if $compiler PIC flag $lt_prog_compiler_pic_CXX works... $ECHO_C" >&6
 if test "${lt_prog_compiler_pic_works_CXX+set}" = set; then
   echo $ECHO_N "(cached) $ECHO_C" >&6
@@ -11259,20 +10723,18 @@
    # with a dollar sign (not a hyphen), so the echo should work correctly.
    # The option is referenced via a variable to avoid confusing sed.
    lt_compile=`echo "$ac_compile" | $SED \
-   -e 's:.*FLAGS}\{0,1\} :&$lt_compiler_flag :; t' \
+   -e 's:.*FLAGS}? :&$lt_compiler_flag :; t' \
    -e 's: [^ ]*conftest\.: $lt_compiler_flag&:; t' \
    -e 's:$: $lt_compiler_flag:'`
-   (eval echo "\"\$as_me:11265: $lt_compile\"" >&5)
+   (eval echo "\"\$as_me:10729: $lt_compile\"" >&5)
    (eval "$lt_compile" 2>conftest.err)
    ac_status=$?
    cat conftest.err >&5
-   echo "$as_me:11269: \$? = $ac_status" >&5
+   echo "$as_me:10733: \$? = $ac_status" >&5
    if (exit $ac_status) && test -s "$ac_outfile"; then
      # The compiler can only warn and ignore the option if not recognized
-     # So say no if there are warnings other than the usual output.
-     $echo "X$_lt_compiler_boilerplate" | $Xsed >conftest.exp
-     $SED '/^$/d' conftest.err >conftest.er2
-     if test ! -s conftest.err || diff conftest.exp conftest.er2 >/dev/null; then
+     # So say no if there are warnings
+     if test ! -s conftest.err; then
        lt_prog_compiler_pic_works_CXX=yes
      fi
    fi
@@ -11293,7 +10755,7 @@
 fi
 
 fi
-case $host_os in
+case "$host_os" in
   # For platforms which do not support PIC, -DPIC is meaningless:
   *djgpp*)
     lt_prog_compiler_pic_CXX=
@@ -11315,36 +10777,38 @@
    mkdir out
    printf "$lt_simple_compile_test_code" > conftest.$ac_ext
 
+   # According to Tom Tromey, Ian Lance Taylor reported there are C compilers
+   # that will create temporary files in the current directory regardless of
+   # the output directory.  Thus, making CWD read-only will cause this test
+   # to fail, enabling locking or at least warning the user not to do parallel
+   # builds.
+   chmod -w .
+
    lt_compiler_flag="-o out/conftest2.$ac_objext"
    # Insert the option either (1) after the last *FLAGS variable, or
    # (2) before a word containing "conftest.", or (3) at the end.
    # Note that $ac_compile itself does not contain backslashes and begins
    # with a dollar sign (not a hyphen), so the echo should work correctly.
    lt_compile=`echo "$ac_compile" | $SED \
-   -e 's:.*FLAGS}\{0,1\} :&$lt_compiler_flag :; t' \
+   -e 's:.*FLAGS}? :&$lt_compiler_flag :; t' \
    -e 's: [^ ]*conftest\.: $lt_compiler_flag&:; t' \
    -e 's:$: $lt_compiler_flag:'`
-   (eval echo "\"\$as_me:11327: $lt_compile\"" >&5)
+   (eval echo "\"\$as_me:10796: $lt_compile\"" >&5)
    (eval "$lt_compile" 2>out/conftest.err)
    ac_status=$?
    cat out/conftest.err >&5
-   echo "$as_me:11331: \$? = $ac_status" >&5
+   echo "$as_me:10800: \$? = $ac_status" >&5
    if (exit $ac_status) && test -s out/conftest2.$ac_objext
    then
      # The compiler can only warn and ignore the option if not recognized
      # So say no if there are warnings
-     $echo "X$_lt_compiler_boilerplate" | $Xsed > out/conftest.exp
-     $SED '/^$/d' out/conftest.err >out/conftest.er2
-     if test ! -s out/conftest.err || diff out/conftest.exp out/conftest.er2 >/dev/null; then
+     if test ! -s out/conftest.err; then
        lt_cv_prog_compiler_c_o_CXX=yes
      fi
    fi
-   chmod u+w . 2>&5
-   $rm conftest*
-   # SGI C++ compiler will create directory out/ii_files/ for
-   # template instantiation
-   test -d out/ii_files && $rm out/ii_files/* && rmdir out/ii_files
-   $rm out/* && rmdir out
+   chmod u+w .
+   $rm conftest* out/*
+   rmdir out
    cd ..
    rmdir conftest
    $rm conftest*
@@ -11394,7 +10858,7 @@
     export_symbols_cmds_CXX="$ltdll_cmds"
   ;;
   cygwin* | mingw*)
-    export_symbols_cmds_CXX='$NM $libobjs $convenience | $global_symbol_pipe | $SED -e '\''/^[BCDGRS] /s/.* \([^ ]*\)/\1 DATA/;/^.* __nm__/s/^.* __nm__\([^ ]*\) [^ ]*/\1 DATA/;/^I /d;/^[AITW] /s/.* //'\'' | sort | uniq > $export_symbols'
+    export_symbols_cmds_CXX='$NM $libobjs $convenience | $global_symbol_pipe | $SED -e '\''/^[BCDGS] /s/.* \([^ ]*\)/\1 DATA/'\'' | $SED -e '\''/^[AITW] /s/.* //'\'' | sort | uniq > $export_symbols'
   ;;
   *)
     export_symbols_cmds_CXX='$NM $libobjs $convenience | $global_symbol_pipe | $SED '\''s/.* //'\'' | sort | uniq > $export_symbols'
@@ -11420,7 +10884,7 @@
 
   if test "$enable_shared" = yes && test "$GCC" = yes; then
     case $archive_cmds_CXX in
-    *'~'*)
+    *"$_S_"*)
       # FIXME: we may have to deal with multi-command sequences.
       ;;
     '$CC '*)
@@ -11472,12 +10936,78 @@
   ;;
 esac
 
+echo "$as_me:$LINENO: checking how to hardcode library paths into programs" >&5
+echo $ECHO_N "checking how to hardcode library paths into programs... $ECHO_C" >&6
+hardcode_action_CXX=
+if test -n "$hardcode_libdir_flag_spec_CXX" || \
+   test -n "$runpath_var CXX" || \
+   test "X$hardcode_automatic_CXX"="Xyes" ; then
+
+  # We can hardcode non-existant directories.
+  if test "$hardcode_direct_CXX" != no &&
+     # If the only mechanism to avoid hardcoding is shlibpath_var, we
+     # have to relink, otherwise we might link with an installed library
+     # when we should be linking with a yet-to-be-installed one
+     ## test "$_LT_AC_TAGVAR(hardcode_shlibpath_var, CXX)" != no &&
+     test "$hardcode_minus_L_CXX" != no; then
+    # Linking always hardcodes the temporary library directory.
+    hardcode_action_CXX=relink
+  else
+    # We can link without hardcoding, and we can hardcode nonexisting dirs.
+    hardcode_action_CXX=immediate
+  fi
+else
+  # We cannot hardcode anything, or else we can only hardcode existing
+  # directories.
+  hardcode_action_CXX=unsupported
+fi
+echo "$as_me:$LINENO: result: $hardcode_action_CXX" >&5
+echo "${ECHO_T}$hardcode_action_CXX" >&6
+
+if test "$hardcode_action_CXX" = relink; then
+  # Fast installation is not supported
+  enable_fast_install=no
+elif test "$shlibpath_overrides_runpath" = yes ||
+     test "$enable_shared" = no; then
+  # Fast installation is not necessary
+  enable_fast_install=needless
+fi
+
+striplib=
+old_striplib=
+echo "$as_me:$LINENO: checking whether stripping libraries is possible" >&5
+echo $ECHO_N "checking whether stripping libraries is possible... $ECHO_C" >&6
+if test -n "$STRIP" && $STRIP -V 2>&1 | grep "GNU strip" >/dev/null; then
+  test -z "$old_striplib" && old_striplib="$STRIP --strip-debug"
+  test -z "$striplib" && striplib="$STRIP --strip-unneeded"
+  echo "$as_me:$LINENO: result: yes" >&5
+echo "${ECHO_T}yes" >&6
+else
+# FIXME - insert some real tests, host_os isn't really good enough
+  case $host_os in
+   NOT-darwin*)
+       if test -n "$STRIP" ; then
+         striplib="$STRIP -x"
+         echo "$as_me:$LINENO: result: yes" >&5
+echo "${ECHO_T}yes" >&6
+       else
+  echo "$as_me:$LINENO: result: no" >&5
+echo "${ECHO_T}no" >&6
+fi
+       ;;
+   *)
+  echo "$as_me:$LINENO: result: no" >&5
+echo "${ECHO_T}no" >&6
+    ;;
+  esac
+fi
+
 echo "$as_me:$LINENO: checking dynamic linker characteristics" >&5
 echo $ECHO_N "checking dynamic linker characteristics... $ECHO_C" >&6
 library_names_spec=
 libname_spec='lib$name'
 soname_spec=
-shrext_cmds=".so"
+shrext=".so"
 postinstall_cmds=
 postuninstall_cmds=
 finish_cmds=
@@ -11565,7 +11095,7 @@
 amigaos*)
   library_names_spec='$libname.ixlibrary $libname.a'
   # Create ${libname}_ixlibrary.a entries in /sys/libs.
-  finish_eval='for lib in `ls $libdir/*.ixlibrary 2>/dev/null`; do libname=`$echo "X$lib" | $Xsed -e '\''s%^.*/\([^/]*\)\.ixlibrary$%\1%'\''`; test $rm /sys/libs/${libname}_ixlibrary.a; $show "cd /sys/libs && $LN_S $lib ${libname}_ixlibrary.a"; cd /sys/libs && $LN_S $lib ${libname}_ixlibrary.a || exit 1; done'
+  finish_eval='for lib in `ls $libdir/*.ixlibrary 2>/dev/null`; do libname=`$echo "X$lib" | $Xsed -e '\''s%^.*/\([^/]*\)\.ixlibrary$%\1%'\''`; test $rm /sys/libs/${libname}_ixlibrary.a; $show "(cd /sys/libs && $LN_S $lib ${libname}_ixlibrary.a)"; (cd /sys/libs && $LN_S $lib ${libname}_ixlibrary.a) || exit 1; done'
   ;;
 
 beos*)
@@ -11574,7 +11104,7 @@
   shlibpath_var=LIBRARY_PATH
   ;;
 
-bsdi[45]*)
+bsdi4*)
   version_type=linux
   need_version=no
   library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major $libname${shared_ext}'
@@ -11590,7 +11120,7 @@
 
 cygwin* | mingw* | pw32*)
   version_type=windows
-  shrext_cmds=".dll"
+  shrext=".dll"
   need_version=no
   need_lib_prefix=no
 
@@ -11598,14 +11128,13 @@
   yes,cygwin* | yes,mingw* | yes,pw32*)
     library_names_spec='$libname.dll.a'
     # DLL is installed to $(libdir)/../bin by postinstall_cmds
-    postinstall_cmds='base_file=`basename \${file}`~
-      dlpath=`$SHELL 2>&1 -c '\''. $dir/'\''\${base_file}'\''i;echo \$dlname'\''`~
-      dldir=$destdir/`dirname \$dlpath`~
-      test -d \$dldir || mkdir -p \$dldir~
-      $install_prog $dir/$dlname \$dldir/$dlname~
-      chmod a+x \$dldir/$dlname'
-    postuninstall_cmds='dldll=`$SHELL 2>&1 -c '\''. $file; echo \$dlname'\''`~
-      dlpath=$dir/\$dldll~
+    postinstall_cmds='base_file=`basename \${file}`${_S_}
+      dlpath=`$SHELL 2>&1 -c '\''. $dir/'\''\${base_file}'\''i;echo \$dlname'\''`${_S_}
+      dldir=$destdir/`dirname \$dlpath`${_S_}
+      test -d \$dldir || mkdir -p \$dldir${_S_}
+      $install_prog $dir/$dlname \$dldir/$dlname'
+    postuninstall_cmds='dldll=`$SHELL 2>&1 -c '\''. $file; echo \$dlname'\''`${_S_}
+      dlpath=$dir/\$dldll${_S_}
        $rm \$dlpath'
     shlibpath_overrides_runpath=yes
 
@@ -11613,7 +11142,7 @@
     cygwin*)
       # Cygwin DLLs use 'cyg' prefix rather than 'lib'
       soname_spec='`echo ${libname} | sed -e 's/^lib/cyg/'``echo ${release} | $SED -e 's/[.]/-/g'`${versuffix}${shared_ext}'
-      sys_lib_search_path_spec="/usr/lib /lib/w32api /lib /usr/local/lib"
+      sys_lib_search_path_spec="/lib /lib/w32api /usr/lib /usr/local/lib"
       ;;
     mingw*)
       # MinGW DLLs use traditional 'lib' prefix
@@ -11633,7 +11162,7 @@
       ;;
     pw32*)
       # pw32 DLLs use 'pw' prefix rather than 'lib'
-      library_names_spec='`echo ${libname} | sed -e 's/^lib/pw/'``echo ${release} | $SED -e 's/[.]/-/g'`${versuffix}${shared_ext}'
+      library_names_spec='`echo ${libname} | sed -e 's/^lib/pw/'``echo ${release} | $SED -e 's/./-/g'`${versuffix}${shared_ext}'
       ;;
     esac
     ;;
@@ -11652,16 +11181,17 @@
   version_type=darwin
   need_lib_prefix=no
   need_version=no
-  library_names_spec='${libname}${release}${versuffix}$shared_ext ${libname}${release}${major}$shared_ext ${libname}$shared_ext'
+  # FIXME: Relying on posixy $() will cause problems for
+  #        cross-compilation, but unfortunately the echo tests do not
+  #        yet detect zsh echo's removal of \ escapes.
+  library_names_spec='${libname}${release}${major}$shared_ext ${libname}$shared_ext ${libname}${release}${versuffix}$shared_ext'
   soname_spec='${libname}${release}${major}$shared_ext'
   shlibpath_overrides_runpath=yes
   shlibpath_var=DYLD_LIBRARY_PATH
-  shrext_cmds='`test .$module = .yes && echo .so || echo .dylib`'
+  shrext='$(test .$module = .yes && echo .so || echo .dylib)'
   # Apple's gcc prints 'gcc -print-search-dirs' doesn't operate the same.
-  if test "$GCC" = yes; then
-    sys_lib_search_path_spec=`$CC -print-search-dirs | tr "\n" "$PATH_SEPARATOR" | sed -e 's/libraries:/@libraries:/' | tr "@" "\n" | grep "^libraries:" | sed -e "s/^libraries://" -e "s,=/,/,g" -e "s,$PATH_SEPARATOR, ,g" -e "s,.*,& /lib /usr/lib /usr/local/lib,g"`
-  else
-    sys_lib_search_path_spec='/lib /usr/lib /usr/local/lib'
+  if $CC -v 2>&1 | grep 'Apple' >/dev/null ; then
+  sys_lib_search_path_spec=`$CC -print-search-dirs | tr "\n" "$PATH_SEPARATOR" | sed -e 's/libraries:/@libraries:/' | tr "@" "\n" | grep "^libraries:" | sed -e "s/^libraries://" -e "s,=/,/,g" -e "s,$PATH_SEPARATOR, ,g" -e "s,.*,& /lib /usr/lib /usr/local/lib,g"`
   fi
   sys_lib_dlsearch_path_spec='/usr/local/lib /lib /usr/lib'
   ;;
@@ -11679,29 +11209,8 @@
   dynamic_linker=no
   ;;
 
-kfreebsd*-gnu)
-  version_type=linux
-  need_lib_prefix=no
-  need_version=no
-  library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major ${libname}${shared_ext}'
-  soname_spec='${libname}${release}${shared_ext}$major'
-  shlibpath_var=LD_LIBRARY_PATH
-  shlibpath_overrides_runpath=no
-  hardcode_into_libs=yes
-  dynamic_linker='GNU ld.so'
-  ;;
-
-freebsd* | dragonfly*)
-  # DragonFly does not have aout.  When/if they implement a new
-  # versioning mechanism, adjust this.
-  if test -x /usr/bin/objformat; then
-    objformat=`/usr/bin/objformat`
-  else
-    case $host_os in
-    freebsd[123]*) objformat=aout ;;
-    *) objformat=elf ;;
-    esac
-  fi
+freebsd*)
+  objformat=`test -x /usr/bin/objformat && /usr/bin/objformat || echo aout`
   version_type=freebsd-$objformat
   case $version_type in
     freebsd-elf*)
@@ -11719,7 +11228,7 @@
   freebsd2*)
     shlibpath_overrides_runpath=yes
     ;;
-  freebsd3.[01]* | freebsdelf3.[01]*)
+  freebsd3.01* | freebsdelf3.01*)
     shlibpath_overrides_runpath=yes
     hardcode_into_libs=yes
     ;;
@@ -11746,9 +11255,9 @@
   version_type=sunos
   need_lib_prefix=no
   need_version=no
-  case $host_cpu in
+  case "$host_cpu" in
   ia64*)
-    shrext_cmds='.so'
+    shrext='.so'
     hardcode_into_libs=yes
     dynamic_linker="$host_os dld.so"
     shlibpath_var=LD_LIBRARY_PATH
@@ -11763,7 +11272,7 @@
     sys_lib_dlsearch_path_spec=$sys_lib_search_path_spec
     ;;
    hppa*64*)
-     shrext_cmds='.sl'
+     shrext='.sl'
      hardcode_into_libs=yes
      dynamic_linker="$host_os dld.sl"
      shlibpath_var=LD_LIBRARY_PATH # How should we handle SHLIB_PATH
@@ -11774,7 +11283,7 @@
      sys_lib_dlsearch_path_spec=$sys_lib_search_path_spec
      ;;
    *)
-    shrext_cmds='.sl'
+    shrext='.sl'
     dynamic_linker="$host_os dld.sl"
     shlibpath_var=SHLIB_PATH
     shlibpath_overrides_runpath=no # +s is required to enable SHLIB_PATH
@@ -11843,12 +11352,6 @@
   # before this can be enabled.
   hardcode_into_libs=yes
 
-  # Append ld.so.conf contents to the search path
-  if test -f /etc/ld.so.conf; then
-    lt_ld_extra=`awk '/^include / { system(sprintf("cd /etc; cat %s", \$2)); skip = 1; } { if (!skip) print \$0; skip = 0; }' < /etc/ld.so.conf | $SED -e 's/#.*//;s/[:,	]/ /g;s/=[^=]*$//;s/=[^= ]* / /g;/^$/d' | tr '\n' ' '`
-    sys_lib_dlsearch_path_spec="/lib /usr/lib $lt_ld_extra"
-  fi
-
   # We used to test for /lib/ld.so.1 and disable shared libraries on
   # powerpc, because MkLinux only supported shared libraries with the
   # GNU dynamic linker.  Since this was broken with cross compilers,
@@ -11858,18 +11361,6 @@
   dynamic_linker='GNU/Linux ld.so'
   ;;
 
-knetbsd*-gnu)
-  version_type=linux
-  need_lib_prefix=no
-  need_version=no
-  library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major ${libname}${shared_ext}'
-  soname_spec='${libname}${release}${shared_ext}$major'
-  shlibpath_var=LD_LIBRARY_PATH
-  shlibpath_overrides_runpath=no
-  hardcode_into_libs=yes
-  dynamic_linker='GNU ld.so'
-  ;;
-
 netbsd*)
   version_type=sunos
   need_lib_prefix=no
@@ -11879,7 +11370,7 @@
     finish_cmds='PATH="\$PATH:/sbin" ldconfig -m $libdir'
     dynamic_linker='NetBSD (a.out) ld.so'
   else
-    library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major ${libname}${shared_ext}'
+    library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major ${libname}${release}${shared_ext} ${libname}${shared_ext}'
     soname_spec='${libname}${release}${shared_ext}$major'
     dynamic_linker='NetBSD ld.elf_so'
   fi
@@ -11895,7 +11386,7 @@
   shlibpath_overrides_runpath=yes
   ;;
 
-nto-qnx*)
+nto-qnx)
   version_type=linux
   need_lib_prefix=no
   need_version=no
@@ -11908,11 +11399,7 @@
 openbsd*)
   version_type=sunos
   need_lib_prefix=no
-  # Some older versions of OpenBSD (3.3 at least) *do* need versioned libs.
-  case $host_os in
-    openbsd3.3 | openbsd3.3.*) need_version=yes ;;
-    *)                         need_version=no  ;;
-  esac
+  need_version=no
   library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${shared_ext}$versuffix'
   finish_cmds='PATH="\$PATH:/sbin" ldconfig -m $libdir'
   shlibpath_var=LD_LIBRARY_PATH
@@ -11932,7 +11419,7 @@
 
 os2*)
   libname_spec='$name'
-  shrext_cmds=".dll"
+  shrext=".dll"
   need_lib_prefix=no
   library_names_spec='$libname${shared_ext} $libname.a'
   dynamic_linker='OS/2 ld.exe'
@@ -12010,91 +11497,25 @@
   if test -d /usr/nec ;then
     version_type=linux
     library_names_spec='$libname${shared_ext}.$versuffix $libname${shared_ext}.$major $libname${shared_ext}'
-    soname_spec='$libname${shared_ext}.$major'
-    shlibpath_var=LD_LIBRARY_PATH
-  fi
-  ;;
-
-uts4*)
-  version_type=linux
-  library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major $libname${shared_ext}'
-  soname_spec='${libname}${release}${shared_ext}$major'
-  shlibpath_var=LD_LIBRARY_PATH
-  ;;
-
-*)
-  dynamic_linker=no
-  ;;
-esac
-echo "$as_me:$LINENO: result: $dynamic_linker" >&5
-echo "${ECHO_T}$dynamic_linker" >&6
-test "$dynamic_linker" = no && can_build_shared=no
-
-echo "$as_me:$LINENO: checking how to hardcode library paths into programs" >&5
-echo $ECHO_N "checking how to hardcode library paths into programs... $ECHO_C" >&6
-hardcode_action_CXX=
-if test -n "$hardcode_libdir_flag_spec_CXX" || \
-   test -n "$runpath_var_CXX" || \
-   test "X$hardcode_automatic_CXX" = "Xyes" ; then
-
-  # We can hardcode non-existant directories.
-  if test "$hardcode_direct_CXX" != no &&
-     # If the only mechanism to avoid hardcoding is shlibpath_var, we
-     # have to relink, otherwise we might link with an installed library
-     # when we should be linking with a yet-to-be-installed one
-     ## test "$_LT_AC_TAGVAR(hardcode_shlibpath_var, CXX)" != no &&
-     test "$hardcode_minus_L_CXX" != no; then
-    # Linking always hardcodes the temporary library directory.
-    hardcode_action_CXX=relink
-  else
-    # We can link without hardcoding, and we can hardcode nonexisting dirs.
-    hardcode_action_CXX=immediate
-  fi
-else
-  # We cannot hardcode anything, or else we can only hardcode existing
-  # directories.
-  hardcode_action_CXX=unsupported
-fi
-echo "$as_me:$LINENO: result: $hardcode_action_CXX" >&5
-echo "${ECHO_T}$hardcode_action_CXX" >&6
-
-if test "$hardcode_action_CXX" = relink; then
-  # Fast installation is not supported
-  enable_fast_install=no
-elif test "$shlibpath_overrides_runpath" = yes ||
-     test "$enable_shared" = no; then
-  # Fast installation is not necessary
-  enable_fast_install=needless
-fi
-
-striplib=
-old_striplib=
-echo "$as_me:$LINENO: checking whether stripping libraries is possible" >&5
-echo $ECHO_N "checking whether stripping libraries is possible... $ECHO_C" >&6
-if test -n "$STRIP" && $STRIP -V 2>&1 | grep "GNU strip" >/dev/null; then
-  test -z "$old_striplib" && old_striplib="$STRIP --strip-debug"
-  test -z "$striplib" && striplib="$STRIP --strip-unneeded"
-  echo "$as_me:$LINENO: result: yes" >&5
-echo "${ECHO_T}yes" >&6
-else
-# FIXME - insert some real tests, host_os isn't really good enough
-  case $host_os in
-   darwin*)
-       if test -n "$STRIP" ; then
-         striplib="$STRIP -x"
-         echo "$as_me:$LINENO: result: yes" >&5
-echo "${ECHO_T}yes" >&6
-       else
-  echo "$as_me:$LINENO: result: no" >&5
-echo "${ECHO_T}no" >&6
-fi
-       ;;
-   *)
-  echo "$as_me:$LINENO: result: no" >&5
-echo "${ECHO_T}no" >&6
-    ;;
-  esac
-fi
+    soname_spec='$libname${shared_ext}.$major'
+    shlibpath_var=LD_LIBRARY_PATH
+  fi
+  ;;
+
+uts4*)
+  version_type=linux
+  library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major $libname${shared_ext}'
+  soname_spec='${libname}${release}${shared_ext}$major'
+  shlibpath_var=LD_LIBRARY_PATH
+  ;;
+
+*)
+  dynamic_linker=no
+  ;;
+esac
+echo "$as_me:$LINENO: result: $dynamic_linker" >&5
+echo "${ECHO_T}$dynamic_linker" >&6
+test "$dynamic_linker" = no && can_build_shared=no
 
 if test "x$enable_dlopen" != xyes; then
   enable_dlopen=unknown
@@ -12131,6 +11552,7 @@
   ac_check_lib_save_LIBS=$LIBS
 LIBS="-ldl  $LIBS"
 cat >conftest.$ac_ext <<_ACEOF
+#line $LINENO "configure"
 /* confdefs.h.  */
 _ACEOF
 cat confdefs.h >>conftest.$ac_ext
@@ -12154,21 +11576,11 @@
 _ACEOF
 rm -f conftest.$ac_objext conftest$ac_exeext
 if { (eval echo "$as_me:$LINENO: \"$ac_link\"") >&5
-  (eval $ac_link) 2>conftest.er1
+  (eval $ac_link) 2>&5
   ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
   echo "$as_me:$LINENO: \$? = $ac_status" >&5
   (exit $ac_status); } &&
-	 { ac_try='test -z "$ac_cxx_werror_flag"
-			 || test ! -s conftest.err'
-  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
-  (eval $ac_try) 2>&5
-  ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; } &&
-	 { ac_try='test -s conftest$ac_exeext'
+         { ac_try='test -s conftest$ac_exeext'
   { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
@@ -12181,8 +11593,7 @@
 
 ac_cv_lib_dl_dlopen=no
 fi
-rm -f conftest.err conftest.$ac_objext \
-      conftest$ac_exeext conftest.$ac_ext
+rm -f conftest.$ac_objext conftest$ac_exeext conftest.$ac_ext
 LIBS=$ac_check_lib_save_LIBS
 fi
 echo "$as_me:$LINENO: result: $ac_cv_lib_dl_dlopen" >&5
@@ -12206,28 +11617,21 @@
   echo $ECHO_N "(cached) $ECHO_C" >&6
 else
   cat >conftest.$ac_ext <<_ACEOF
+#line $LINENO "configure"
 /* confdefs.h.  */
 _ACEOF
 cat confdefs.h >>conftest.$ac_ext
 cat >>conftest.$ac_ext <<_ACEOF
 /* end confdefs.h.  */
-/* Define shl_load to an innocuous variant, in case <limits.h> declares shl_load.
-   For example, HP-UX 11i <limits.h> declares gettimeofday.  */
-#define shl_load innocuous_shl_load
-
 /* System header to define __stub macros and hopefully few prototypes,
     which can conflict with char shl_load (); below.
     Prefer <limits.h> to <assert.h> if __STDC__ is defined, since
     <limits.h> exists even on freestanding compilers.  */
-
 #ifdef __STDC__
 # include <limits.h>
 #else
 # include <assert.h>
 #endif
-
-#undef shl_load
-
 /* Override any gcc2 internal prototype to avoid an error.  */
 #ifdef __cplusplus
 extern "C"
@@ -12258,21 +11662,11 @@
 _ACEOF
 rm -f conftest.$ac_objext conftest$ac_exeext
 if { (eval echo "$as_me:$LINENO: \"$ac_link\"") >&5
-  (eval $ac_link) 2>conftest.er1
+  (eval $ac_link) 2>&5
   ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
   echo "$as_me:$LINENO: \$? = $ac_status" >&5
   (exit $ac_status); } &&
-	 { ac_try='test -z "$ac_cxx_werror_flag"
-			 || test ! -s conftest.err'
-  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
-  (eval $ac_try) 2>&5
-  ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; } &&
-	 { ac_try='test -s conftest$ac_exeext'
+         { ac_try='test -s conftest$ac_exeext'
   { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
@@ -12285,8 +11679,7 @@
 
 ac_cv_func_shl_load=no
 fi
-rm -f conftest.err conftest.$ac_objext \
-      conftest$ac_exeext conftest.$ac_ext
+rm -f conftest.$ac_objext conftest$ac_exeext conftest.$ac_ext
 fi
 echo "$as_me:$LINENO: result: $ac_cv_func_shl_load" >&5
 echo "${ECHO_T}$ac_cv_func_shl_load" >&6
@@ -12301,6 +11694,7 @@
   ac_check_lib_save_LIBS=$LIBS
 LIBS="-ldld  $LIBS"
 cat >conftest.$ac_ext <<_ACEOF
+#line $LINENO "configure"
 /* confdefs.h.  */
 _ACEOF
 cat confdefs.h >>conftest.$ac_ext
@@ -12324,21 +11718,11 @@
 _ACEOF
 rm -f conftest.$ac_objext conftest$ac_exeext
 if { (eval echo "$as_me:$LINENO: \"$ac_link\"") >&5
-  (eval $ac_link) 2>conftest.er1
+  (eval $ac_link) 2>&5
   ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
   echo "$as_me:$LINENO: \$? = $ac_status" >&5
   (exit $ac_status); } &&
-	 { ac_try='test -z "$ac_cxx_werror_flag"
-			 || test ! -s conftest.err'
-  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
-  (eval $ac_try) 2>&5
-  ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; } &&
-	 { ac_try='test -s conftest$ac_exeext'
+         { ac_try='test -s conftest$ac_exeext'
   { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
@@ -12351,8 +11735,7 @@
 
 ac_cv_lib_dld_shl_load=no
 fi
-rm -f conftest.err conftest.$ac_objext \
-      conftest$ac_exeext conftest.$ac_ext
+rm -f conftest.$ac_objext conftest$ac_exeext conftest.$ac_ext
 LIBS=$ac_check_lib_save_LIBS
 fi
 echo "$as_me:$LINENO: result: $ac_cv_lib_dld_shl_load" >&5
@@ -12366,28 +11749,21 @@
   echo $ECHO_N "(cached) $ECHO_C" >&6
 else
   cat >conftest.$ac_ext <<_ACEOF
+#line $LINENO "configure"
 /* confdefs.h.  */
 _ACEOF
 cat confdefs.h >>conftest.$ac_ext
 cat >>conftest.$ac_ext <<_ACEOF
 /* end confdefs.h.  */
-/* Define dlopen to an innocuous variant, in case <limits.h> declares dlopen.
-   For example, HP-UX 11i <limits.h> declares gettimeofday.  */
-#define dlopen innocuous_dlopen
-
 /* System header to define __stub macros and hopefully few prototypes,
     which can conflict with char dlopen (); below.
     Prefer <limits.h> to <assert.h> if __STDC__ is defined, since
     <limits.h> exists even on freestanding compilers.  */
-
 #ifdef __STDC__
 # include <limits.h>
 #else
 # include <assert.h>
 #endif
-
-#undef dlopen
-
 /* Override any gcc2 internal prototype to avoid an error.  */
 #ifdef __cplusplus
 extern "C"
@@ -12418,21 +11794,11 @@
 _ACEOF
 rm -f conftest.$ac_objext conftest$ac_exeext
 if { (eval echo "$as_me:$LINENO: \"$ac_link\"") >&5
-  (eval $ac_link) 2>conftest.er1
+  (eval $ac_link) 2>&5
   ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
   echo "$as_me:$LINENO: \$? = $ac_status" >&5
   (exit $ac_status); } &&
-	 { ac_try='test -z "$ac_cxx_werror_flag"
-			 || test ! -s conftest.err'
-  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
-  (eval $ac_try) 2>&5
-  ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; } &&
-	 { ac_try='test -s conftest$ac_exeext'
+         { ac_try='test -s conftest$ac_exeext'
   { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
@@ -12445,8 +11811,7 @@
 
 ac_cv_func_dlopen=no
 fi
-rm -f conftest.err conftest.$ac_objext \
-      conftest$ac_exeext conftest.$ac_ext
+rm -f conftest.$ac_objext conftest$ac_exeext conftest.$ac_ext
 fi
 echo "$as_me:$LINENO: result: $ac_cv_func_dlopen" >&5
 echo "${ECHO_T}$ac_cv_func_dlopen" >&6
@@ -12461,6 +11826,7 @@
   ac_check_lib_save_LIBS=$LIBS
 LIBS="-ldl  $LIBS"
 cat >conftest.$ac_ext <<_ACEOF
+#line $LINENO "configure"
 /* confdefs.h.  */
 _ACEOF
 cat confdefs.h >>conftest.$ac_ext
@@ -12484,21 +11850,11 @@
 _ACEOF
 rm -f conftest.$ac_objext conftest$ac_exeext
 if { (eval echo "$as_me:$LINENO: \"$ac_link\"") >&5
-  (eval $ac_link) 2>conftest.er1
+  (eval $ac_link) 2>&5
   ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
   echo "$as_me:$LINENO: \$? = $ac_status" >&5
   (exit $ac_status); } &&
-	 { ac_try='test -z "$ac_cxx_werror_flag"
-			 || test ! -s conftest.err'
-  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
-  (eval $ac_try) 2>&5
-  ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; } &&
-	 { ac_try='test -s conftest$ac_exeext'
+         { ac_try='test -s conftest$ac_exeext'
   { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
@@ -12511,8 +11867,7 @@
 
 ac_cv_lib_dl_dlopen=no
 fi
-rm -f conftest.err conftest.$ac_objext \
-      conftest$ac_exeext conftest.$ac_ext
+rm -f conftest.$ac_objext conftest$ac_exeext conftest.$ac_ext
 LIBS=$ac_check_lib_save_LIBS
 fi
 echo "$as_me:$LINENO: result: $ac_cv_lib_dl_dlopen" >&5
@@ -12528,6 +11883,7 @@
   ac_check_lib_save_LIBS=$LIBS
 LIBS="-lsvld  $LIBS"
 cat >conftest.$ac_ext <<_ACEOF
+#line $LINENO "configure"
 /* confdefs.h.  */
 _ACEOF
 cat confdefs.h >>conftest.$ac_ext
@@ -12551,21 +11907,11 @@
 _ACEOF
 rm -f conftest.$ac_objext conftest$ac_exeext
 if { (eval echo "$as_me:$LINENO: \"$ac_link\"") >&5
-  (eval $ac_link) 2>conftest.er1
+  (eval $ac_link) 2>&5
   ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
   echo "$as_me:$LINENO: \$? = $ac_status" >&5
   (exit $ac_status); } &&
-	 { ac_try='test -z "$ac_cxx_werror_flag"
-			 || test ! -s conftest.err'
-  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
-  (eval $ac_try) 2>&5
-  ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; } &&
-	 { ac_try='test -s conftest$ac_exeext'
+         { ac_try='test -s conftest$ac_exeext'
   { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
@@ -12578,8 +11924,7 @@
 
 ac_cv_lib_svld_dlopen=no
 fi
-rm -f conftest.err conftest.$ac_objext \
-      conftest$ac_exeext conftest.$ac_ext
+rm -f conftest.$ac_objext conftest$ac_exeext conftest.$ac_ext
 LIBS=$ac_check_lib_save_LIBS
 fi
 echo "$as_me:$LINENO: result: $ac_cv_lib_svld_dlopen" >&5
@@ -12595,6 +11940,7 @@
   ac_check_lib_save_LIBS=$LIBS
 LIBS="-ldld  $LIBS"
 cat >conftest.$ac_ext <<_ACEOF
+#line $LINENO "configure"
 /* confdefs.h.  */
 _ACEOF
 cat confdefs.h >>conftest.$ac_ext
@@ -12618,21 +11964,11 @@
 _ACEOF
 rm -f conftest.$ac_objext conftest$ac_exeext
 if { (eval echo "$as_me:$LINENO: \"$ac_link\"") >&5
-  (eval $ac_link) 2>conftest.er1
+  (eval $ac_link) 2>&5
   ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
   echo "$as_me:$LINENO: \$? = $ac_status" >&5
   (exit $ac_status); } &&
-	 { ac_try='test -z "$ac_cxx_werror_flag"
-			 || test ! -s conftest.err'
-  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
-  (eval $ac_try) 2>&5
-  ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; } &&
-	 { ac_try='test -s conftest$ac_exeext'
+         { ac_try='test -s conftest$ac_exeext'
   { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
@@ -12645,8 +11981,7 @@
 
 ac_cv_lib_dld_dld_link=no
 fi
-rm -f conftest.err conftest.$ac_objext \
-      conftest$ac_exeext conftest.$ac_ext
+rm -f conftest.$ac_objext conftest$ac_exeext conftest.$ac_ext
 LIBS=$ac_check_lib_save_LIBS
 fi
 echo "$as_me:$LINENO: result: $ac_cv_lib_dld_dld_link" >&5
@@ -12701,7 +12036,7 @@
   lt_dlunknown=0; lt_dlno_uscore=1; lt_dlneed_uscore=2
   lt_status=$lt_dlunknown
   cat > conftest.$ac_ext <<EOF
-#line 12704 "configure"
+#line 12039 "configure"
 #include "confdefs.h"
 
 #if HAVE_DLFCN_H
@@ -12767,7 +12102,7 @@
   ac_status=$?
   echo "$as_me:$LINENO: \$? = $ac_status" >&5
   (exit $ac_status); } && test -s conftest${ac_exeext} 2>/dev/null; then
-    (./conftest; exit; ) >&5 2>/dev/null
+    (./conftest; exit; ) 2>/dev/null
     lt_status=$?
     case x$lt_status in
       x$lt_dlno_uscore) lt_cv_dlopen_self=yes ;;
@@ -12799,7 +12134,7 @@
   lt_dlunknown=0; lt_dlno_uscore=1; lt_dlneed_uscore=2
   lt_status=$lt_dlunknown
   cat > conftest.$ac_ext <<EOF
-#line 12802 "configure"
+#line 12137 "configure"
 #include "confdefs.h"
 
 #if HAVE_DLFCN_H
@@ -12865,7 +12200,7 @@
   ac_status=$?
   echo "$as_me:$LINENO: \$? = $ac_status" >&5
   (exit $ac_status); } && test -s conftest${ac_exeext} 2>/dev/null; then
-    (./conftest; exit; ) >&5 2>/dev/null
+    (./conftest; exit; ) 2>/dev/null
     lt_status=$?
     case x$lt_status in
       x$lt_dlno_uscore) lt_cv_dlopen_self_static=yes ;;
@@ -12916,8 +12251,7 @@
   # Now quote all the things that may contain metacharacters while being
   # careful not to overquote the AC_SUBSTed values.  We take copies of the
   # variables and quote the copies for generation of the libtool script.
-  for var in echo old_CC old_CFLAGS AR AR_FLAGS EGREP RANLIB LN_S LTCC NM \
-    SED SHELL STRIP \
+  for var in echo old_CC old_CFLAGS AR AR_FLAGS EGREP RANLIB LN_S LTCC NM SED SHELL \
     libname_spec library_names_spec soname_spec extract_expsyms_cmds \
     old_striplib striplib file_magic_cmd finish_cmds finish_eval \
     deplibs_check_method reload_flag reload_cmds need_locks \
@@ -12975,7 +12309,7 @@
     old_postinstall_cmds | old_postuninstall_cmds | \
     sys_lib_search_path_spec | sys_lib_dlsearch_path_spec)
       # Double-quote double-evaled strings.
-      eval "lt_$var=\\\"\`\$echo \"X\$$var\" | \$Xsed -e \"\$double_quote_subst\" -e \"\$sed_quote_subst\" -e \"\$delay_variable_subst\"\`\\\""
+      eval "lt_$var=\\\"\`\$echo \"X\$$var\" | \$Xsed -e \"\$double_quote_subst\" -e \"\$sed_quote_subst\" -e \"\$delay_variable_subst\" -e \"\$unescape_variable_subst\"\`\\\""
       ;;
     *)
       eval "lt_$var=\\\"\`\$echo \"X\$$var\" | \$Xsed -e \"\$sed_quote_subst\"\`\\\""
@@ -12996,6 +12330,9 @@
 
 # Libtool was configured on host `(hostname || uname -n) 2>/dev/null | sed 1q`:
 
+# Set the command separator (default: ~)
+_S_=\${LIBTOOL_CMD_SEP-\~}
+
 # Shell to use when invoking shell scripts.
 SHELL=$lt_SHELL
 
@@ -13017,12 +12354,6 @@
 # The host system.
 host_alias=$host_alias
 host=$host
-host_os=$host_os
-
-# The build system.
-build_alias=$build_alias
-build=$build
-build_os=$build_os
 
 # An echo program that does not interpret backslashes.
 echo=$lt_echo
@@ -13053,7 +12384,7 @@
 NM=$lt_NM
 
 # A symbol stripping program
-STRIP=$lt_STRIP
+STRIP=$STRIP
 
 # Used to examine libraries when file_magic_cmd begins "file"
 MAGIC_CMD=$MAGIC_CMD
@@ -13084,7 +12415,7 @@
 libext="$libext"
 
 # Shared library suffix (normally ".so").
-shrext_cmds='$shrext_cmds'
+shrext='$shrext'
 
 # Executable file suffix (normally "").
 exeext="$exeext"
@@ -13099,7 +12430,7 @@
 # Does compiler simultaneously support -c and -o options?
 compiler_c_o=$lt_lt_cv_prog_compiler_c_o_CXX
 
-# Must we lock files when doing compilation?
+# Must we lock files when doing compilation ?
 need_locks=$lt_need_locks
 
 # Do we need the lib prefix for modules?
@@ -13301,10 +12632,7 @@
   # If there is no Makefile yet, we rely on a make rule to execute
   # `config.status --recheck' to rerun these tests and create the
   # libtool script then.
-  ltmain_in=`echo $ltmain | sed -e 's/\.sh$/.in/'`
-  if test -f "$ltmain_in"; then
-    test -f Makefile && make "$ltmain"
-  fi
+  test -f Makefile && make "$ltmain"
 fi
 
 
@@ -13380,35 +12708,12 @@
 compiler=$CC
 
 
-# save warnings/boilerplate of simple test code
-ac_outfile=conftest.$ac_objext
-printf "$lt_simple_compile_test_code" >conftest.$ac_ext
-eval "$ac_compile" 2>&1 >/dev/null | $SED '/^$/d' >conftest.err
-_lt_compiler_boilerplate=`cat conftest.err`
-$rm conftest*
-
-ac_outfile=conftest.$ac_objext
-printf "$lt_simple_link_test_code" >conftest.$ac_ext
-eval "$ac_link" 2>&1 >/dev/null | $SED '/^$/d' >conftest.err
-_lt_linker_boilerplate=`cat conftest.err`
-$rm conftest*
-
-
 # Allow CC to be a program name with arguments.
 lt_save_CC="$CC"
 CC=${F77-"f77"}
 compiler=$CC
 compiler_F77=$CC
-for cc_temp in $compiler""; do
-  case $cc_temp in
-    compile | *[\\/]compile | ccache | *[\\/]ccache ) ;;
-    distcc | *[\\/]distcc | purify | *[\\/]purify ) ;;
-    \-*) ;;
-    *) break;;
-  esac
-done
-cc_basename=`$echo "X$cc_temp" | $Xsed -e 's%.*/%%' -e "s%^$host_alias-%%"`
-
+cc_basename=`$echo X"$compiler" | $Xsed -e 's%^.*/%%'`
 
 echo "$as_me:$LINENO: checking if libtool supports shared libraries" >&5
 echo $ECHO_N "checking if libtool supports shared libraries... $ECHO_C" >&6
@@ -13421,18 +12726,16 @@
 
 # On AIX, shared libraries and static libraries use the same namespace, and
 # are all built from PIC.
-case $host_os in
+case "$host_os" in
 aix3*)
   test "$enable_shared" = yes && enable_static=no
   if test -n "$RANLIB"; then
-    archive_cmds="$archive_cmds~\$RANLIB \$lib"
+    archive_cmds="$archive_cmds\${_S_}\$RANLIB \$lib"
     postinstall_cmds='$RANLIB $lib'
   fi
   ;;
-aix4* | aix5*)
-  if test "$host_cpu" != ia64 && test "$aix_use_runtimelinking" = no ; then
-    test "$enable_shared" = yes && enable_static=no
-  fi
+aix4*)
+  test "$enable_shared" = yes && enable_static=no
   ;;
 esac
 echo "$as_me:$LINENO: result: $enable_shared" >&5
@@ -13509,7 +12812,7 @@
     hpux*)
       # PIC is the default for IA64 HP-UX and 64-bit HP-UX, but
       # not for PA HP-UX.
-      case $host_cpu in
+      case "$host_cpu" in
       hppa*64*|ia64*)
 	# +Z the default
 	;;
@@ -13535,16 +12838,6 @@
 	lt_prog_compiler_static_F77='-bnso -bI:/lib/syscalls.exp'
       fi
       ;;
-      darwin*)
-        # PIC is the default on this platform
-        # Common symbols not allowed in MH_DYLIB files
-       case $cc_basename in
-         xlc* | xlf* )
-         lt_prog_compiler_pic_F77='-qnocommon'
-         lt_prog_compiler_wl_F77='-Wl,'
-         ;;
-       esac
-       ;;
 
     mingw* | pw32* | os2*)
       # This hack is so that the source file can tell whether it is being
@@ -13552,11 +12845,24 @@
       lt_prog_compiler_pic_F77='-DDLL_EXPORT'
       ;;
 
+    darwin* | rhapsody*)
+      # PIC is the default on this platform
+      # Common symbols not allowed in MH_DYLIB files
+        case $CC in
+          *xlc* )
+          lt_prog_compiler_pic_F77='-qpic -qnocommon'
+          ;;
+          *xlf* )
+          lt_prog_compiler_pic_F77='-qpic -qnocommon'
+          ;;
+        esac
+      ;;
+
     hpux9* | hpux10* | hpux11*)
       lt_prog_compiler_wl_F77='-Wl,'
       # PIC is the default for IA64 HP-UX and 64-bit HP-UX, but
       # not for PA HP-UX.
-      case $host_cpu in
+      case "$host_cpu" in
       hppa*64*|ia64*)
 	# +Z the default
 	;;
@@ -13580,20 +12886,13 @@
       ;;
 
     linux*)
-      case $cc_basename in
-      icc* | ecc*)
+      case $CC in
+      ifc*|efc*|ifort*)
 	lt_prog_compiler_wl_F77='-Wl,'
 	lt_prog_compiler_pic_F77='-KPIC'
 	lt_prog_compiler_static_F77='-static'
         ;;
-      pgcc* | pgf77* | pgf90* | pgf95*)
-        # Portland Group compilers (*not* the Pentium gcc compiler,
-	# which looks to be a dead project)
-	lt_prog_compiler_wl_F77='-Wl,'
-	lt_prog_compiler_pic_F77='-fpic'
-	lt_prog_compiler_static_F77='-Bstatic'
-        ;;
-      ccc*)
+      ccc)
         lt_prog_compiler_wl_F77='-Wl,'
         # All Alpha code is PIC.
         lt_prog_compiler_static_F77='-non_shared'
@@ -13613,14 +12912,9 @@
       ;;
 
     solaris*)
+      lt_prog_compiler_wl_F77='-Wl,'
       lt_prog_compiler_pic_F77='-KPIC'
       lt_prog_compiler_static_F77='-Bstatic'
-      case $cc_basename in
-      f77* | f90* | f95*)
-	lt_prog_compiler_wl_F77='-Qoption ld ';;
-      *)
-	lt_prog_compiler_wl_F77='-Wl,';;
-      esac
       ;;
 
     sunos4*)
@@ -13642,11 +12936,6 @@
       fi
       ;;
 
-    unicos*)
-      lt_prog_compiler_wl_F77='-Wl,'
-      lt_prog_compiler_can_build_shared_F77=no
-      ;;
-
     uts4*)
       lt_prog_compiler_pic_F77='-pic'
       lt_prog_compiler_static_F77='-Bstatic'
@@ -13665,8 +12954,7 @@
 # Check to make sure the PIC flag actually works.
 #
 if test -n "$lt_prog_compiler_pic_F77"; then
-
-echo "$as_me:$LINENO: checking if $compiler PIC flag $lt_prog_compiler_pic_F77 works" >&5
+  echo "$as_me:$LINENO: checking if $compiler PIC flag $lt_prog_compiler_pic_F77 works" >&5
 echo $ECHO_N "checking if $compiler PIC flag $lt_prog_compiler_pic_F77 works... $ECHO_C" >&6
 if test "${lt_prog_compiler_pic_works_F77+set}" = set; then
   echo $ECHO_N "(cached) $ECHO_C" >&6
@@ -13681,22 +12969,25 @@
    # with a dollar sign (not a hyphen), so the echo should work correctly.
    # The option is referenced via a variable to avoid confusing sed.
    lt_compile=`echo "$ac_compile" | $SED \
-   -e 's:.*FLAGS}\{0,1\} :&$lt_compiler_flag :; t' \
+   -e 's:.*FLAGS}? :&$lt_compiler_flag :; t' \
    -e 's: [^ ]*conftest\.: $lt_compiler_flag&:; t' \
    -e 's:$: $lt_compiler_flag:'`
-   (eval echo "\"\$as_me:13687: $lt_compile\"" >&5)
+   (eval echo "\"\$as_me:12975: $lt_compile\"" >&5)
    (eval "$lt_compile" 2>conftest.err)
    ac_status=$?
    cat conftest.err >&5
-   echo "$as_me:13691: \$? = $ac_status" >&5
+   echo "$as_me:12979: \$? = $ac_status" >&5
    if (exit $ac_status) && test -s "$ac_outfile"; then
      # The compiler can only warn and ignore the option if not recognized
-     # So say no if there are warnings other than the usual output.
-     $echo "X$_lt_compiler_boilerplate" | $Xsed >conftest.exp
-     $SED '/^$/d' conftest.err >conftest.er2
-     if test ! -s conftest.err || diff conftest.exp conftest.er2 >/dev/null; then
+     # So say no if there are warnings
+     case $CC in
+      #compilers which pring to stderr on success
+      *xlf* ) lt_prog_compiler_pic_works_F77=yes
+        ;;
+      *) if test ! -s conftest.err; then
        lt_prog_compiler_pic_works_F77=yes
-     fi
+       fi
+     esac
    fi
    $rm conftest*
 
@@ -13715,7 +13006,7 @@
 fi
 
 fi
-case $host_os in
+case "$host_os" in
   # For platforms which do not support PIC, -DPIC is meaningless:
   *djgpp*)
     lt_prog_compiler_pic_F77=
@@ -13737,36 +13028,38 @@
    mkdir out
    printf "$lt_simple_compile_test_code" > conftest.$ac_ext
 
+   # According to Tom Tromey, Ian Lance Taylor reported there are C compilers
+   # that will create temporary files in the current directory regardless of
+   # the output directory.  Thus, making CWD read-only will cause this test
+   # to fail, enabling locking or at least warning the user not to do parallel
+   # builds.
+   chmod -w .
+
    lt_compiler_flag="-o out/conftest2.$ac_objext"
    # Insert the option either (1) after the last *FLAGS variable, or
    # (2) before a word containing "conftest.", or (3) at the end.
    # Note that $ac_compile itself does not contain backslashes and begins
    # with a dollar sign (not a hyphen), so the echo should work correctly.
    lt_compile=`echo "$ac_compile" | $SED \
-   -e 's:.*FLAGS}\{0,1\} :&$lt_compiler_flag :; t' \
+   -e 's:.*FLAGS}? :&$lt_compiler_flag :; t' \
    -e 's: [^ ]*conftest\.: $lt_compiler_flag&:; t' \
    -e 's:$: $lt_compiler_flag:'`
-   (eval echo "\"\$as_me:13749: $lt_compile\"" >&5)
+   (eval echo "\"\$as_me:13042: $lt_compile\"" >&5)
    (eval "$lt_compile" 2>out/conftest.err)
    ac_status=$?
    cat out/conftest.err >&5
-   echo "$as_me:13753: \$? = $ac_status" >&5
+   echo "$as_me:13046: \$? = $ac_status" >&5
    if (exit $ac_status) && test -s out/conftest2.$ac_objext
    then
      # The compiler can only warn and ignore the option if not recognized
      # So say no if there are warnings
-     $echo "X$_lt_compiler_boilerplate" | $Xsed > out/conftest.exp
-     $SED '/^$/d' out/conftest.err >out/conftest.er2
-     if test ! -s out/conftest.err || diff out/conftest.exp out/conftest.er2 >/dev/null; then
+     if test ! -s out/conftest.err; then
        lt_cv_prog_compiler_c_o_F77=yes
      fi
    fi
-   chmod u+w . 2>&5
-   $rm conftest*
-   # SGI C++ compiler will create directory out/ii_files/ for
-   # template instantiation
-   test -d out/ii_files && $rm out/ii_files/* && rmdir out/ii_files
-   $rm out/* && rmdir out
+   chmod u+w .
+   $rm conftest* out/*
+   rmdir out
    cd ..
    rmdir conftest
    $rm conftest*
@@ -13837,16 +13130,6 @@
   # rely on this symbol name, it's probably fine to never include it in
   # preloaded symbol tables.
   extract_expsyms_cmds=
-  # Just being paranoid about ensuring that cc_basename is set.
-  for cc_temp in $compiler""; do
-  case $cc_temp in
-    compile | *[\\/]compile | ccache | *[\\/]ccache ) ;;
-    distcc | *[\\/]distcc | purify | *[\\/]purify ) ;;
-    \-*) ;;
-    *) break;;
-  esac
-done
-cc_basename=`$echo "X$cc_temp" | $Xsed -e 's%.*/%%' -e "s%^$host_alias-%%"`
 
   case $host_os in
   cygwin* | mingw* | pw32*)
@@ -13867,27 +13150,6 @@
     # If archive_cmds runs LD, not CC, wlarc should be empty
     wlarc='${wl}'
 
-    # Set some defaults for GNU ld with shared library support. These
-    # are reset later if shared libraries are not supported. Putting them
-    # here allows them to be overridden if necessary.
-    runpath_var=LD_RUN_PATH
-    hardcode_libdir_flag_spec_F77='${wl}--rpath ${wl}$libdir'
-    export_dynamic_flag_spec_F77='${wl}--export-dynamic'
-    # ancient GNU ld didn't support --whole-archive et. al.
-    if $LD --help 2>&1 | grep 'no-whole-archive' > /dev/null; then
-	whole_archive_flag_spec_F77="$wlarc"'--whole-archive$convenience '"$wlarc"'--no-whole-archive'
-      else
-  	whole_archive_flag_spec_F77=
-    fi
-    supports_anon_versioning=no
-    case `$LD -v 2>/dev/null` in
-      *\ [01].* | *\ 2.[0-9].* | *\ 2.10.*) ;; # catch versions < 2.11
-      *\ 2.11.93.0.2\ *) supports_anon_versioning=yes ;; # RH7.3 ...
-      *\ 2.11.92.0.12\ *) supports_anon_versioning=yes ;; # Mandrake 8.2 ...
-      *\ 2.11.*) ;; # other 2.11 versions
-      *) supports_anon_versioning=yes ;;
-    esac
-
     # See if GNU ld supports shared libraries.
     case $host_os in
     aix3* | aix4* | aix5*)
@@ -13907,7 +13169,7 @@
       ;;
 
     amigaos*)
-      archive_cmds_F77='$rm $output_objdir/a2ixlibrary.data~$echo "#define NAME $libname" > $output_objdir/a2ixlibrary.data~$echo "#define LIBRARY_ID 1" >> $output_objdir/a2ixlibrary.data~$echo "#define VERSION $major" >> $output_objdir/a2ixlibrary.data~$echo "#define REVISION $revision" >> $output_objdir/a2ixlibrary.data~$AR $AR_FLAGS $lib $libobjs~$RANLIB $lib~(cd $output_objdir && a2ixlibrary -32)'
+      archive_cmds_F77='$rm $output_objdir/a2ixlibrary.data${_S_}$echo "#define NAME $libname" > $output_objdir/a2ixlibrary.data${_S_}$echo "#define LIBRARY_ID 1" >> $output_objdir/a2ixlibrary.data${_S_}$echo "#define VERSION $major" >> $output_objdir/a2ixlibrary.data${_S_}$echo "#define REVISION $revision" >> $output_objdir/a2ixlibrary.data${_S_}$AR $AR_FLAGS $lib $libobjs${_S_}$RANLIB $lib${_S_}(cd $output_objdir && a2ixlibrary -32)'
       hardcode_libdir_flag_spec_F77='-L$libdir'
       hardcode_minus_L_F77=yes
 
@@ -13938,7 +13200,7 @@
       allow_undefined_flag_F77=unsupported
       always_export_symbols_F77=no
       enable_shared_with_static_runtimes_F77=yes
-      export_symbols_cmds_F77='$NM $libobjs $convenience | $global_symbol_pipe | $SED -e '\''/^[BCDGRS] /s/.* \([^ ]*\)/\1 DATA/'\'' | $SED -e '\''/^[AITW] /s/.* //'\'' | sort | uniq > $export_symbols'
+      export_symbols_cmds_F77='$NM $libobjs $convenience | $global_symbol_pipe | $SED -e '\''/^[BCDGS] /s/.* \([^ ]*\)/\1 DATA/'\'' | $SED -e '\''/^[AITW] /s/.* //'\'' | sort | uniq > $export_symbols'
 
       if $LD --help 2>&1 | grep 'auto-import' > /dev/null; then
         archive_cmds_F77='$CC -shared $libobjs $deplibs $compiler_flags -o $output_objdir/$soname ${wl}--image-base=0x10000000 ${wl}--out-implib,$lib'
@@ -13949,47 +13211,10 @@
 	else
 	  echo EXPORTS > $output_objdir/$soname.def;
 	  cat $export_symbols >> $output_objdir/$soname.def;
-	fi~
+	fi${_S_}
 	$CC -shared $output_objdir/$soname.def $libobjs $deplibs $compiler_flags -o $output_objdir/$soname ${wl}--image-base=0x10000000  ${wl}--out-implib,$lib'
       else
-	ld_shlibs_F77=no
-      fi
-      ;;
-
-    linux*)
-      if $LD --help 2>&1 | grep ': supported targets:.* elf' > /dev/null; then
-	tmp_addflag=
-	case $cc_basename,$host_cpu in
-	pgcc*)				# Portland Group C compiler
-	  whole_archive_flag_spec_F77='${wl}--whole-archive`for conv in $convenience\"\"; do test  -n \"$conv\" && new_convenience=\"$new_convenience,$conv\"; done; $echo \"$new_convenience\"` ${wl}--no-whole-archive'
-	  tmp_addflag=' $pic_flag'
-	  ;;
-	pgf77* | pgf90* | pgf95*)	# Portland Group f77 and f90 compilers
-	  whole_archive_flag_spec_F77='${wl}--whole-archive`for conv in $convenience\"\"; do test  -n \"$conv\" && new_convenience=\"$new_convenience,$conv\"; done; $echo \"$new_convenience\"` ${wl}--no-whole-archive'
-	  tmp_addflag=' $pic_flag -Mnomain' ;;
-	ecc*,ia64* | icc*,ia64*)		# Intel C compiler on ia64
-	  tmp_addflag=' -i_dynamic' ;;
-	efc*,ia64* | ifort*,ia64*)	# Intel Fortran compiler on ia64
-	  tmp_addflag=' -i_dynamic -nofor_main' ;;
-	ifc* | ifort*)			# Intel Fortran compiler
-	  tmp_addflag=' -nofor_main' ;;
-	esac
-	archive_cmds_F77='$CC -shared'"$tmp_addflag"' $libobjs $deplibs $compiler_flags ${wl}-soname $wl$soname -o $lib'
-
-	if test $supports_anon_versioning = yes; then
-	  archive_expsym_cmds_F77='$echo "{ global:" > $output_objdir/$libname.ver~
-  cat $export_symbols | sed -e "s/\(.*\)/\1;/" >> $output_objdir/$libname.ver~
-  $echo "local: *; };" >> $output_objdir/$libname.ver~
-	  $CC -shared'"$tmp_addflag"' $libobjs $deplibs $compiler_flags ${wl}-soname $wl$soname ${wl}-version-script ${wl}$output_objdir/$libname.ver -o $lib'
-	fi
-
-# icc does not like -lc for shared libraries
-        case $cc_basename in
-          ecc* | icc* ) archive_cmds_need_lc_F77=no ;;
-        esac
-
-      else
-	ld_shlibs_F77=no
+	ld_shlibs=no
       fi
       ;;
 
@@ -14041,11 +13266,16 @@
       ;;
     esac
 
-    if test "$ld_shlibs_F77" = no; then
-      runpath_var=
-      hardcode_libdir_flag_spec_F77=
-      export_dynamic_flag_spec_F77=
-      whole_archive_flag_spec_F77=
+    if test "$ld_shlibs_F77" = yes; then
+      runpath_var=LD_RUN_PATH
+      hardcode_libdir_flag_spec_F77='${wl}--rpath ${wl}$libdir'
+      export_dynamic_flag_spec_F77='${wl}--export-dynamic'
+      # ancient GNU ld didn't support --whole-archive et. al.
+      if $LD --help 2>&1 | grep 'no-whole-archive' > /dev/null; then
+ 	whole_archive_flag_spec_F77="$wlarc"'--whole-archive$convenience '"$wlarc"'--no-whole-archive'
+      else
+  	whole_archive_flag_spec_F77=
+      fi
     fi
   else
     # PORTME fill in a description of your system's linker (not GNU ld)
@@ -14053,7 +13283,7 @@
     aix3*)
       allow_undefined_flag_F77=unsupported
       always_export_symbols_F77=yes
-      archive_expsym_cmds_F77='$LD -o $output_objdir/$soname $libobjs $deplibs $linker_flags -bE:$export_symbols -T512 -H512 -bM:SRE~$AR $AR_FLAGS $lib $output_objdir/$soname'
+      archive_expsym_cmds_F77='$LD -o $output_objdir/$soname $libobjs $deplibs $linker_flags -bE:$export_symbols -T512 -H512 -bM:SRE${_S_}$AR $AR_FLAGS $lib $output_objdir/$soname'
       # Note: this linker hardcodes the directories in LIBPATH if there
       # are no directories specified by -L.
       hardcode_minus_L_F77=yes
@@ -14109,7 +13339,7 @@
       link_all_deplibs_F77=yes
 
       if test "$GCC" = yes; then
-	case $host_os in aix4.[012]|aix4.[012].*)
+	case $host_os in aix4.012|aix4.012.*)
 	# We only want to do this on AIX 4.2 and lower, the check
 	# below for broken collect2 doesn't work under 4.3+
 	  collect2name=`${CC} -print-prog-name=collect2`
@@ -14130,9 +13360,6 @@
 	  fi
 	esac
 	shared_flag='-shared'
-	if test "$aix_use_runtimelinking" = yes; then
-	  shared_flag="$shared_flag "'${wl}-G'
-	fi
       else
 	# not using gcc
 	if test "$host_cpu" = ia64; then
@@ -14163,21 +13390,11 @@
 _ACEOF
 rm -f conftest.$ac_objext conftest$ac_exeext
 if { (eval echo "$as_me:$LINENO: \"$ac_link\"") >&5
-  (eval $ac_link) 2>conftest.er1
+  (eval $ac_link) 2>&5
   ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
   echo "$as_me:$LINENO: \$? = $ac_status" >&5
   (exit $ac_status); } &&
-	 { ac_try='test -z "$ac_f77_werror_flag"
-			 || test ! -s conftest.err'
-  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
-  (eval $ac_try) 2>&5
-  ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; } &&
-	 { ac_try='test -s conftest$ac_exeext'
+         { ac_try='test -s conftest$ac_exeext'
   { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
@@ -14194,8 +13411,7 @@
 sed 's/^/| /' conftest.$ac_ext >&5
 
 fi
-rm -f conftest.err conftest.$ac_objext \
-      conftest$ac_exeext conftest.$ac_ext
+rm -f conftest.$ac_objext conftest$ac_exeext conftest.$ac_ext
 if test -z "$aix_libpath"; then aix_libpath="/usr/lib:/lib"; fi
 
        hardcode_libdir_flag_spec_F77='${wl}-blibpath:$libdir:'"$aix_libpath"
@@ -14214,21 +13430,11 @@
 _ACEOF
 rm -f conftest.$ac_objext conftest$ac_exeext
 if { (eval echo "$as_me:$LINENO: \"$ac_link\"") >&5
-  (eval $ac_link) 2>conftest.er1
+  (eval $ac_link) 2>&5
   ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
   echo "$as_me:$LINENO: \$? = $ac_status" >&5
   (exit $ac_status); } &&
-	 { ac_try='test -z "$ac_f77_werror_flag"
-			 || test ! -s conftest.err'
-  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
-  (eval $ac_try) 2>&5
-  ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; } &&
-	 { ac_try='test -s conftest$ac_exeext'
+         { ac_try='test -s conftest$ac_exeext'
   { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
@@ -14245,8 +13451,7 @@
 sed 's/^/| /' conftest.$ac_ext >&5
 
 fi
-rm -f conftest.err conftest.$ac_objext \
-      conftest$ac_exeext conftest.$ac_ext
+rm -f conftest.$ac_objext conftest$ac_exeext conftest.$ac_ext
 if test -z "$aix_libpath"; then aix_libpath="/usr/lib:/lib"; fi
 
 	 hardcode_libdir_flag_spec_F77='${wl}-blibpath:$libdir:'"$aix_libpath"
@@ -14259,21 +13464,21 @@
 	  # Exported symbols can be pulled into shared objects from archives
 	  whole_archive_flag_spec_F77=' '
 	  archive_cmds_need_lc_F77=yes
-	  # This is similar to how AIX traditionally builds its shared libraries.
-	  archive_expsym_cmds_F77="\$CC $shared_flag"' -o $output_objdir/$soname $libobjs $deplibs $compiler_flags ${wl}-bE:$export_symbols ${wl}-bnoentry${allow_undefined_flag}~$AR $AR_FLAGS $output_objdir/$libname$release.a $output_objdir/$soname'
+	  # This is similar to how AIX traditionally builds it's shared libraries.
+	  archive_expsym_cmds_F77="\$CC $shared_flag"' -o $output_objdir/$soname $libobjs $deplibs $compiler_flags ${wl}-bE:$export_symbols ${wl}-bnoentry${allow_undefined_flag}\${_S_}$AR $AR_FLAGS $output_objdir/$libname$release.a $output_objdir/$soname'
 	fi
       fi
       ;;
 
     amigaos*)
-      archive_cmds_F77='$rm $output_objdir/a2ixlibrary.data~$echo "#define NAME $libname" > $output_objdir/a2ixlibrary.data~$echo "#define LIBRARY_ID 1" >> $output_objdir/a2ixlibrary.data~$echo "#define VERSION $major" >> $output_objdir/a2ixlibrary.data~$echo "#define REVISION $revision" >> $output_objdir/a2ixlibrary.data~$AR $AR_FLAGS $lib $libobjs~$RANLIB $lib~(cd $output_objdir && a2ixlibrary -32)'
+      archive_cmds_F77='$rm $output_objdir/a2ixlibrary.data${_S_}$echo "#define NAME $libname" > $output_objdir/a2ixlibrary.data${_S_}$echo "#define LIBRARY_ID 1" >> $output_objdir/a2ixlibrary.data${_S_}$echo "#define VERSION $major" >> $output_objdir/a2ixlibrary.data${_S_}$echo "#define REVISION $revision" >> $output_objdir/a2ixlibrary.data${_S_}$AR $AR_FLAGS $lib $libobjs${_S_}$RANLIB $lib${_S_}(cd $output_objdir && a2ixlibrary -32)'
       hardcode_libdir_flag_spec_F77='-L$libdir'
       hardcode_minus_L_F77=yes
       # see comment about different semantics on the GNU ld section
       ld_shlibs_F77=no
       ;;
 
-    bsdi[45]*)
+    bsdi4*)
       export_dynamic_flag_spec_F77=-rdynamic
       ;;
 
@@ -14287,74 +13492,120 @@
       # Tell ltmain to make .lib files, not .a files.
       libext=lib
       # Tell ltmain to make .dll files, not .so files.
-      shrext_cmds=".dll"
+      shrext=".dll"
       # FIXME: Setting linknames here is a bad hack.
-      archive_cmds_F77='$CC -o $lib $libobjs $compiler_flags `echo "$deplibs" | $SED -e '\''s/ -lc$//'\''` -link -dll~linknames='
+      archive_cmds_F77='$CC -o $lib $libobjs $compiler_flags `echo "$deplibs" | $SED -e '\''s/ -lc$//'\''` -link -dll${_S_}linknames='
       # The linker will automatically build a .lib file if we build a DLL.
       old_archive_From_new_cmds_F77='true'
       # FIXME: Should let the user specify the lib program.
       old_archive_cmds_F77='lib /OUT:$oldlib$oldobjs$old_deplibs'
-      fix_srcfile_path_F77='`cygpath -w "$srcfile"`'
+      fix_srcfile_path='`cygpath -w "$srcfile"`'
       enable_shared_with_static_runtimes_F77=yes
       ;;
 
     darwin* | rhapsody*)
-      case $host_os in
-        rhapsody* | darwin1.[012])
-         allow_undefined_flag_F77='${wl}-undefined ${wl}suppress'
-         ;;
-       *) # Darwin 1.3 on
-         if test -z ${MACOSX_DEPLOYMENT_TARGET} ; then
-           allow_undefined_flag_F77='${wl}-flat_namespace ${wl}-undefined ${wl}suppress'
-         else
-           case ${MACOSX_DEPLOYMENT_TARGET} in
-             10.[012])
-               allow_undefined_flag_F77='${wl}-flat_namespace ${wl}-undefined ${wl}suppress'
-               ;;
-             10.*)
-               allow_undefined_flag_F77='${wl}-undefined ${wl}dynamic_lookup'
-               ;;
-           esac
-         fi
-         ;;
-      esac
       archive_cmds_need_lc_F77=no
+      case "$host_os" in
+      rhapsody* | darwin1.[012])
+	allow_undefined_flag_F77='-undefined suppress'
+	;;
+      darwin1.* | darwin[2-6].*) # Darwin 1.3 on, but less than 7.0
+	test -z ${LD_TWOLEVEL_NAMESPACE} && allow_undefined_flag_F77='-flat_namespace -undefined suppress'
+	;;
+      *) # Darwin 7.0 on
+	case "${MACOSX_DEPLOYMENT_TARGET-10.1}" in
+	10.[012])
+	  test -z ${LD_TWOLEVEL_NAMESPACE} && allow_undefined_flag_F77='-flat_namespace -undefined suppress'
+	  ;;
+	*) # 10.3 on
+	  if test -z ${LD_TWOLEVEL_NAMESPACE}; then
+	    allow_undefined_flag_F77='-flat_namespace -undefined suppress'
+	  else
+	    allow_undefined_flag_F77='-undefined dynamic_lookup'
+	  fi
+	  ;;
+	esac
+	;;
+      esac
+
+cat >conftest.$ac_ext <<_ACEOF
+#line $LINENO "configure"
+#include "confdefs.h"
+
+#ifdef F77_DUMMY_MAIN
+#  ifdef __cplusplus
+     extern "C"
+#  endif
+int F77_DUMMY_MAIN() { return 1; }
+#endif
+int
+main (){
+  ;
+  return 0;}
+_ACEOF
+
+  if $CC -v conftest.$ac_ext -o conftest$ac_exeext 2>&1 | grep 'Apple' >/dev/null || $CC -v conftest.$ac_ext -o conftest$ac_exeext 2>&1 | grep 'powerpc-apple-darwin' >/dev/null; then
+      # FIXME: Relying on posixy $() will cause problems for
+      #        cross-compilation, but unfortunately the echo tests do not
+      #        yet detect zsh echo's removal of \ escapes.  Also zsh mangles
+      #	       `"' quotes if we put them in here... so don't!
+    	lt_int_apple_cc_single_mod=no
+    	output_verbose_link_cmd='echo'
+    	if $CC -dumpspecs 2>&1 | grep 'single_module' >/dev/null ; then
+    	  lt_int_apple_cc_single_mod=yes
+    	fi
+    	if test "X$lt_int_apple_cc_single_mod" = Xyes ; then
+    	  archive_cmds_F77='$CC -dynamiclib $archargs -single_module $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags -install_name SW_PREFIX/lib/ccp4-5.99.5/$soname $verstring'
+    	else
+        archive_cmds_F77='$CC -r ${wl}-bind_at_load -keep_private_externs -nostdlib -o ${lib}-master.o $libobjs${_S_}$CC -dynamiclib $archargs $allow_undefined_flag -o $lib ${lib}-master.o $deplibs $compiler_flags -install_name SW_PREFIX/lib/ccp4-5.99.5/$soname $verstring'
+      fi
+      module_cmds_F77='$CC -bundle $archargs ${wl}-bind_at_load $allow_undefined_flag -o $lib $libobjs $deplibs$compiler_flags'
+      # Don't fix this by using the ld -exported_symbols_list flag, it doesn't exist in older darwin ld's
+        if test "X$lt_int_apple_cc_single_mod" = Xyes ; then
+          archive_expsym_cmds_F77='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym${_S_}$CC -dynamiclib $archargs -single_module $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags -install_name SW_PREFIX/lib/ccp4-5.99.5/$soname $verstring${_S_}nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
+        else
+          archive_expsym_cmds_F77='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym${_S_}$CC -r ${wl}-bind_at_load -keep_private_externs -nostdlib -o ${lib}-master.o $libobjs${_S_}$CC -dynamiclib $archargs $allow_undefined_flag -o $lib ${lib}-master.o $deplibs $compiler_flags -install_name SW_PREFIX/lib/ccp4-5.99.5/$soname $verstring${_S_}nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
+        fi
+          module_expsym_cmds_F77='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym${_S_}$CC -bundle $archargs $allow_undefined_flag  -o $lib $libobjs $deplibs$compiler_flags${_S_}nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
       hardcode_direct_F77=no
       hardcode_automatic_F77=yes
       hardcode_shlibpath_var_F77=unsupported
-      whole_archive_flag_spec_F77=''
+      whole_archive_flag_spec_F77='-all_load $convenience'
       link_all_deplibs_F77=yes
-    if test "$GCC" = yes ; then
-    	output_verbose_link_cmd='echo'
-        archive_cmds_F77='$CC -dynamiclib $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags -install_name $rpath/$soname $verstring'
-      module_cmds_F77='$CC $allow_undefined_flag -o $lib -bundle $libobjs $deplibs$compiler_flags'
-      # Don't fix this by using the ld -exported_symbols_list flag, it doesn't exist in older darwin lds
-      archive_expsym_cmds_F77='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC -dynamiclib $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags -install_name $rpath/$soname $verstring~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
-      module_expsym_cmds_F77='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC $allow_undefined_flag  -o $lib -bundle $libobjs $deplibs$compiler_flags~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
-    else
-      case $cc_basename in
-        xlc* )
-         output_verbose_link_cmd='echo'
-         archive_cmds_F77='$CC -qmkshrobj $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-install_name ${wl}`echo $rpath/$soname` $verstring'
-         module_cmds_F77='$CC $allow_undefined_flag -o $lib -bundle $libobjs $deplibs$compiler_flags'
-          # Don't fix this by using the ld -exported_symbols_list flag, it doesn't exist in older darwin lds
-         archive_expsym_cmds_F77='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC -qmkshrobj $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-install_name ${wl}$rpath/$soname $verstring~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
-          module_expsym_cmds_F77='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC $allow_undefined_flag  -o $lib -bundle $libobjs $deplibs$compiler_flags~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
-          ;;
-        xlf* )
-         output_verbose_link_cmd='echo'
-         archive_cmds_F77='$CC -qmkshrobj $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-dylib_install_name ${wl}`echo $rpath/$soname` $verstring'
-         module_cmds_F77='$CC $allow_undefined_flag -o $lib -bundle $libobjs $deplibs$compiler_flags'
-          # Don't fix this by using the ld -exported_symbols_list flag, it doesn't exist in older darwin lds
-         archive_expsym_cmds_F77='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC -qmkshrobj $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-dylib_install_name ${wl}$rpath/$soname $verstring~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
-          module_expsym_cmds_F77='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC $allow_undefined_flag  -o $lib -bundle $libobjs $deplibs$compiler_flags~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
+
+    elif $CC -v conftest.$ac_ext -o conftest$ac_exeext 2>&1 | grep 'XL_CONFIG' >/dev/null ; then
+    # FIXME: Relying on posixy $() will cause problems for
+    #        cross-compilation, but unfortunately the echo tests do not
+    #        yet detect zsh echo's removal of \ escapes.  Also zsh mangles
+    #          `"' quotes if we put them in here... so don't!
+    output_verbose_link_cmd='echo'
+    archive_cmds_F77='$LD -dynamic -dylib $allow_undefined_flag -o $lib $libobjs -ldylib1.o $deplibs$compiler_flags -dylib_install_name $soname $verstring'
+    module_cmds_F77='$LD -bundle $allow_undefined_flag -o $lib $libobjs $deplibs$compiler_flags'
+    # Don't fix this by using the ld -exported_symbols_list flag, it doesn't exist in older darwin ld's
+    archive_expsym_cmds_F77='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$LD -dynamic -dylib $allow_undefined_flag -o $lib $libobjs $deplibs$compiler_flags -dylib_install_name $soname $verstring~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
+    module_expsym_cmds_F77='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$LD -bundle $allow_undefined_flag  -o $lib $libobjs $deplibs$compiler_flags~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
+    hardcode_direct_F77=no
+    hardcode_automatic_F77=yes
+    hardcode_shlibpath_var_F77=unsupported
+    whole_archive_flag_spec_F77='-all_load $convenience'
+    link_all_deplibs_F77=yes
+    if test "F77" = F77 ; then
+      case "${MACOSX_DEPLOYMENT_TARGET-10.1}" in
+        10.[012])
+          test -z ${LD_TWOLEVEL_NAMESPACE} && allow_undefined_flag_F77='-flat_namespace -undefined suppress -single_module'
           ;;
-       *)
-         ld_shlibs_F77=no
+        *) # 10.3 on
+          if test -z ${LD_TWOLEVEL_NAMESPACE}; then
+            allow_undefined_flag_F77='-flat_namespace -undefined suppress -single_module'
+          else
+            allow_undefined_flag_F77='-undefined dynamic_lookup -single_module'
+          fi
           ;;
-      esac
+        esac
     fi
-      ;;
+    fi
+    rm -f conftest.$ac_ext conftest$ac_exeext
+    ;;
 
     dgux*)
       archive_cmds_F77='$LD -G -h $soname -o $lib $libobjs $deplibs $linker_flags'
@@ -14386,7 +13637,7 @@
       ;;
 
     # FreeBSD 3 and greater uses gcc -shared to do shared libraries.
-    freebsd* | kfreebsd*-gnu | dragonfly*)
+    freebsd*)
       archive_cmds_F77='$CC -shared -o $lib $libobjs $deplibs $compiler_flags'
       hardcode_libdir_flag_spec_F77='-R$libdir'
       hardcode_direct_F77=yes
@@ -14395,9 +13646,9 @@
 
     hpux9*)
       if test "$GCC" = yes; then
-	archive_cmds_F77='$rm $output_objdir/$soname~$CC -shared -fPIC ${wl}+b ${wl}$install_libdir -o $output_objdir/$soname $libobjs $deplibs $compiler_flags~test $output_objdir/$soname = $lib || mv $output_objdir/$soname $lib'
+	archive_cmds_F77='$rm $output_objdir/$soname${_S_}$CC -shared -fPIC ${wl}+b ${wl}$install_libdir -o $output_objdir/$soname $libobjs $deplibs $compiler_flags${_S_}test $output_objdir/$soname = $lib || mv $output_objdir/$soname $lib'
       else
-	archive_cmds_F77='$rm $output_objdir/$soname~$LD -b +b $install_libdir -o $output_objdir/$soname $libobjs $deplibs $linker_flags~test $output_objdir/$soname = $lib || mv $output_objdir/$soname $lib'
+	archive_cmds_F77='$rm $output_objdir/$soname${_S_}$LD -b +b $install_libdir -o $output_objdir/$soname $libobjs $deplibs $linker_flags${_S_}test $output_objdir/$soname = $lib || mv $output_objdir/$soname $lib'
       fi
       hardcode_libdir_flag_spec_F77='${wl}+b ${wl}$libdir'
       hardcode_libdir_separator_F77=:
@@ -14411,7 +13662,7 @@
 
     hpux10* | hpux11*)
       if test "$GCC" = yes -a "$with_gnu_ld" = no; then
-	case $host_cpu in
+	case "$host_cpu" in
 	hppa*64*|ia64*)
 	  archive_cmds_F77='$CC -shared ${wl}+h ${wl}$soname -o $lib $libobjs $deplibs $compiler_flags'
 	  ;;
@@ -14420,7 +13671,7 @@
 	  ;;
 	esac
       else
-	case $host_cpu in
+	case "$host_cpu" in
 	hppa*64*|ia64*)
 	  archive_cmds_F77='$LD -b +h $soname -o $lib $libobjs $deplibs $linker_flags'
 	  ;;
@@ -14430,7 +13681,7 @@
 	esac
       fi
       if test "$with_gnu_ld" = no; then
-	case $host_cpu in
+	case "$host_cpu" in
 	hppa*64*)
 	  hardcode_libdir_flag_spec_F77='${wl}+b ${wl}$libdir'
 	  hardcode_libdir_flag_spec_ld_F77='+b $libdir'
@@ -14497,7 +13748,6 @@
       hardcode_shlibpath_var_F77=no
       if test -z "`echo __ELF__ | $CC -E - | grep __ELF__`" || test "$host_os-$host_cpu" = "openbsd2.8-powerpc"; then
 	archive_cmds_F77='$CC -shared $pic_flag -o $lib $libobjs $deplibs $compiler_flags'
-	archive_expsym_cmds_F77='$CC -shared $pic_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-retain-symbols-file,$export_symbols'
 	hardcode_libdir_flag_spec_F77='${wl}-rpath,$libdir'
 	export_dynamic_flag_spec_F77='${wl}-E'
       else
@@ -14518,7 +13768,7 @@
       hardcode_libdir_flag_spec_F77='-L$libdir'
       hardcode_minus_L_F77=yes
       allow_undefined_flag_F77=unsupported
-      archive_cmds_F77='$echo "LIBRARY $libname INITINSTANCE" > $output_objdir/$libname.def~$echo "DESCRIPTION \"$libname\"" >> $output_objdir/$libname.def~$echo DATA >> $output_objdir/$libname.def~$echo " SINGLE NONSHARED" >> $output_objdir/$libname.def~$echo EXPORTS >> $output_objdir/$libname.def~emxexp $libobjs >> $output_objdir/$libname.def~$CC -Zdll -Zcrtdll -o $lib $libobjs $deplibs $compiler_flags $output_objdir/$libname.def'
+      archive_cmds_F77='$echo "LIBRARY $libname INITINSTANCE" > $output_objdir/$libname.def${_S_}$echo "DESCRIPTION \"$libname\"" >> $output_objdir/$libname.def${_S_}$echo DATA >> $output_objdir/$libname.def${_S_}$echo " SINGLE NONSHARED" >> $output_objdir/$libname.def${_S_}$echo EXPORTS >> $output_objdir/$libname.def${_S_}emxexp $libobjs >> $output_objdir/$libname.def${_S_}$CC -Zdll -Zcrtdll -o $lib $libobjs $deplibs $compiler_flags $output_objdir/$libname.def'
       old_archive_From_new_cmds_F77='emximp -o $output_objdir/$libname.a $output_objdir/$libname.def'
       ;;
 
@@ -14542,8 +13792,8 @@
       else
 	allow_undefined_flag_F77=' -expect_unresolved \*'
 	archive_cmds_F77='$LD -shared${allow_undefined_flag} $libobjs $deplibs $linker_flags -msym -soname $soname `test -n "$verstring" && echo -set_version $verstring` -update_registry ${output_objdir}/so_locations -o $lib'
-	archive_expsym_cmds_F77='for i in `cat $export_symbols`; do printf "%s %s\\n" -exported_symbol "\$i" >> $lib.exp; done; echo "-hidden">> $lib.exp~
-	$LD -shared${allow_undefined_flag} -input $lib.exp $linker_flags $libobjs $deplibs -soname $soname `test -n "$verstring" && echo -set_version $verstring` -update_registry ${output_objdir}/so_locations -o $lib~$rm $lib.exp'
+	archive_expsym_cmds_F77='for i in `cat $export_symbols`; do printf "%s %s\\n" -exported_symbol "\$i" >> $lib.exp; done; echo "-hidden">> $lib.exp${_S_}
+	$LD -shared${allow_undefined_flag} -input $lib.exp $linker_flags $libobjs $deplibs -soname $soname `test -n "$verstring" && echo -set_version $verstring` -update_registry ${objdir}/so_locations -o $lib${_S_}$rm $lib.exp'
 
 	# Both c and cxx compiler support -rpath directly
 	hardcode_libdir_flag_spec_F77='-rpath $libdir'
@@ -14562,32 +13812,20 @@
     solaris*)
       no_undefined_flag_F77=' -z text'
       if test "$GCC" = yes; then
-	wlarc='${wl}'
 	archive_cmds_F77='$CC -shared ${wl}-h ${wl}$soname -o $lib $libobjs $deplibs $compiler_flags'
-	archive_expsym_cmds_F77='$echo "{ global:" > $lib.exp~cat $export_symbols | $SED -e "s/\(.*\)/\1;/" >> $lib.exp~$echo "local: *; };" >> $lib.exp~
-	  $CC -shared ${wl}-M ${wl}$lib.exp ${wl}-h ${wl}$soname -o $lib $libobjs $deplibs $compiler_flags~$rm $lib.exp'
+	archive_expsym_cmds_F77='$echo "{ global:" > $lib.exp${_S_}cat $export_symbols | $SED -e "s/\(.*\)/\1;/" >> $lib.exp${_S_}$echo "local: *; };" >> $lib.exp${_S_}
+	  $CC -shared ${wl}-M ${wl}$lib.exp ${wl}-h ${wl}$soname -o $lib $libobjs $deplibs $compiler_flags${_S_}$rm $lib.exp'
       else
-	wlarc=''
 	archive_cmds_F77='$LD -G${allow_undefined_flag} -h $soname -o $lib $libobjs $deplibs $linker_flags'
-	archive_expsym_cmds_F77='$echo "{ global:" > $lib.exp~cat $export_symbols | $SED -e "s/\(.*\)/\1;/" >> $lib.exp~$echo "local: *; };" >> $lib.exp~
-  	$LD -G${allow_undefined_flag} -M $lib.exp -h $soname -o $lib $libobjs $deplibs $linker_flags~$rm $lib.exp'
+	archive_expsym_cmds_F77='$echo "{ global:" > $lib.exp${_S_}cat $export_symbols | $SED -e "s/\(.*\)/\1;/" >> $lib.exp${_S_}$echo "local: *; };" >> $lib.exp${_S_}
+  	$LD -G${allow_undefined_flag} -M $lib.exp -h $soname -o $lib $libobjs $deplibs $linker_flags${_S_}$rm $lib.exp'
       fi
       hardcode_libdir_flag_spec_F77='-R$libdir'
       hardcode_shlibpath_var_F77=no
       case $host_os in
       solaris2.[0-5] | solaris2.[0-5].*) ;;
-      *)
- 	# The compiler driver will combine linker options so we
- 	# cannot just pass the convience library names through
- 	# without $wl, iff we do not link with $LD.
- 	# Luckily, gcc supports the same syntax we need for Sun Studio.
- 	# Supported since Solaris 2.6 (maybe 2.5.1?)
- 	case $wlarc in
- 	'')
- 	  whole_archive_flag_spec_F77='-z allextract$convenience -z defaultextract' ;;
- 	*)
- 	  whole_archive_flag_spec_F77='${wl}-z ${wl}allextract`for conv in $convenience\"\"; do test -n \"$conv\" && new_convenience=\"$new_convenience,$conv\"; done; $echo \"$new_convenience\"` ${wl}-z ${wl}defaultextract' ;;
- 	esac ;;
+      *) # Supported since Solaris 2.6 (maybe 2.5.1?)
+	whole_archive_flag_spec_F77='-z allextract$convenience -z defaultextract' ;;
       esac
       link_all_deplibs_F77=yes
       ;;
@@ -14669,8 +13907,8 @@
       # $CC -shared without GNU ld will not create a library from C++
       # object files and a static libstdc++, better avoid it by now
       archive_cmds_F77='$LD -G${allow_undefined_flag} -h $soname -o $lib $libobjs $deplibs $linker_flags'
-      archive_expsym_cmds_F77='$echo "{ global:" > $lib.exp~cat $export_symbols | $SED -e "s/\(.*\)/\1;/" >> $lib.exp~$echo "local: *; };" >> $lib.exp~
-  		$LD -G${allow_undefined_flag} -M $lib.exp -h $soname -o $lib $libobjs $deplibs $linker_flags~$rm $lib.exp'
+      archive_expsym_cmds_F77='$echo "{ global:" > $lib.exp${_S_}cat $export_symbols | $SED -e "s/\(.*\)/\1;/" >> $lib.exp${_S_}$echo "local: *; };" >> $lib.exp${_S_}
+  		$LD -G${allow_undefined_flag} -M $lib.exp -h $soname -o $lib $libobjs $deplibs $linker_flags${_S_}$rm $lib.exp'
       hardcode_libdir_flag_spec_F77=
       hardcode_shlibpath_var_F77=no
       runpath_var='LD_RUN_PATH'
@@ -14707,7 +13945,7 @@
 
   if test "$enable_shared" = yes && test "$GCC" = yes; then
     case $archive_cmds_F77 in
-    *'~'*)
+    *"$_S_"*)
       # FIXME: we may have to deal with multi-command sequences.
       ;;
     '$CC '*)
@@ -14759,12 +13997,78 @@
   ;;
 esac
 
+echo "$as_me:$LINENO: checking how to hardcode library paths into programs" >&5
+echo $ECHO_N "checking how to hardcode library paths into programs... $ECHO_C" >&6
+hardcode_action_F77=
+if test -n "$hardcode_libdir_flag_spec_F77" || \
+   test -n "$runpath_var F77" || \
+   test "X$hardcode_automatic_F77"="Xyes" ; then
+
+  # We can hardcode non-existant directories.
+  if test "$hardcode_direct_F77" != no &&
+     # If the only mechanism to avoid hardcoding is shlibpath_var, we
+     # have to relink, otherwise we might link with an installed library
+     # when we should be linking with a yet-to-be-installed one
+     ## test "$_LT_AC_TAGVAR(hardcode_shlibpath_var, F77)" != no &&
+     test "$hardcode_minus_L_F77" != no; then
+    # Linking always hardcodes the temporary library directory.
+    hardcode_action_F77=relink
+  else
+    # We can link without hardcoding, and we can hardcode nonexisting dirs.
+    hardcode_action_F77=immediate
+  fi
+else
+  # We cannot hardcode anything, or else we can only hardcode existing
+  # directories.
+  hardcode_action_F77=unsupported
+fi
+echo "$as_me:$LINENO: result: $hardcode_action_F77" >&5
+echo "${ECHO_T}$hardcode_action_F77" >&6
+
+if test "$hardcode_action_F77" = relink; then
+  # Fast installation is not supported
+  enable_fast_install=no
+elif test "$shlibpath_overrides_runpath" = yes ||
+     test "$enable_shared" = no; then
+  # Fast installation is not necessary
+  enable_fast_install=needless
+fi
+
+striplib=
+old_striplib=
+echo "$as_me:$LINENO: checking whether stripping libraries is possible" >&5
+echo $ECHO_N "checking whether stripping libraries is possible... $ECHO_C" >&6
+if test -n "$STRIP" && $STRIP -V 2>&1 | grep "GNU strip" >/dev/null; then
+  test -z "$old_striplib" && old_striplib="$STRIP --strip-debug"
+  test -z "$striplib" && striplib="$STRIP --strip-unneeded"
+  echo "$as_me:$LINENO: result: yes" >&5
+echo "${ECHO_T}yes" >&6
+else
+# FIXME - insert some real tests, host_os isn't really good enough
+  case $host_os in
+   NOT-darwin*)
+       if test -n "$STRIP" ; then
+         striplib="$STRIP -x"
+         echo "$as_me:$LINENO: result: yes" >&5
+echo "${ECHO_T}yes" >&6
+       else
+  echo "$as_me:$LINENO: result: no" >&5
+echo "${ECHO_T}no" >&6
+fi
+       ;;
+   *)
+  echo "$as_me:$LINENO: result: no" >&5
+echo "${ECHO_T}no" >&6
+    ;;
+  esac
+fi
+
 echo "$as_me:$LINENO: checking dynamic linker characteristics" >&5
 echo $ECHO_N "checking dynamic linker characteristics... $ECHO_C" >&6
 library_names_spec=
 libname_spec='lib$name'
 soname_spec=
-shrext_cmds=".so"
+shrext=".so"
 postinstall_cmds=
 postuninstall_cmds=
 finish_cmds=
@@ -14852,7 +14156,7 @@
 amigaos*)
   library_names_spec='$libname.ixlibrary $libname.a'
   # Create ${libname}_ixlibrary.a entries in /sys/libs.
-  finish_eval='for lib in `ls $libdir/*.ixlibrary 2>/dev/null`; do libname=`$echo "X$lib" | $Xsed -e '\''s%^.*/\([^/]*\)\.ixlibrary$%\1%'\''`; test $rm /sys/libs/${libname}_ixlibrary.a; $show "cd /sys/libs && $LN_S $lib ${libname}_ixlibrary.a"; cd /sys/libs && $LN_S $lib ${libname}_ixlibrary.a || exit 1; done'
+  finish_eval='for lib in `ls $libdir/*.ixlibrary 2>/dev/null`; do libname=`$echo "X$lib" | $Xsed -e '\''s%^.*/\([^/]*\)\.ixlibrary$%\1%'\''`; test $rm /sys/libs/${libname}_ixlibrary.a; $show "(cd /sys/libs && $LN_S $lib ${libname}_ixlibrary.a)"; (cd /sys/libs && $LN_S $lib ${libname}_ixlibrary.a) || exit 1; done'
   ;;
 
 beos*)
@@ -14861,7 +14165,7 @@
   shlibpath_var=LIBRARY_PATH
   ;;
 
-bsdi[45]*)
+bsdi4*)
   version_type=linux
   need_version=no
   library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major $libname${shared_ext}'
@@ -14877,7 +14181,7 @@
 
 cygwin* | mingw* | pw32*)
   version_type=windows
-  shrext_cmds=".dll"
+  shrext=".dll"
   need_version=no
   need_lib_prefix=no
 
@@ -14885,14 +14189,13 @@
   yes,cygwin* | yes,mingw* | yes,pw32*)
     library_names_spec='$libname.dll.a'
     # DLL is installed to $(libdir)/../bin by postinstall_cmds
-    postinstall_cmds='base_file=`basename \${file}`~
-      dlpath=`$SHELL 2>&1 -c '\''. $dir/'\''\${base_file}'\''i;echo \$dlname'\''`~
-      dldir=$destdir/`dirname \$dlpath`~
-      test -d \$dldir || mkdir -p \$dldir~
-      $install_prog $dir/$dlname \$dldir/$dlname~
-      chmod a+x \$dldir/$dlname'
-    postuninstall_cmds='dldll=`$SHELL 2>&1 -c '\''. $file; echo \$dlname'\''`~
-      dlpath=$dir/\$dldll~
+    postinstall_cmds='base_file=`basename \${file}`${_S_}
+      dlpath=`$SHELL 2>&1 -c '\''. $dir/'\''\${base_file}'\''i;echo \$dlname'\''`${_S_}
+      dldir=$destdir/`dirname \$dlpath`${_S_}
+      test -d \$dldir || mkdir -p \$dldir${_S_}
+      $install_prog $dir/$dlname \$dldir/$dlname'
+    postuninstall_cmds='dldll=`$SHELL 2>&1 -c '\''. $file; echo \$dlname'\''`${_S_}
+      dlpath=$dir/\$dldll${_S_}
        $rm \$dlpath'
     shlibpath_overrides_runpath=yes
 
@@ -14900,7 +14203,7 @@
     cygwin*)
       # Cygwin DLLs use 'cyg' prefix rather than 'lib'
       soname_spec='`echo ${libname} | sed -e 's/^lib/cyg/'``echo ${release} | $SED -e 's/[.]/-/g'`${versuffix}${shared_ext}'
-      sys_lib_search_path_spec="/usr/lib /lib/w32api /lib /usr/local/lib"
+      sys_lib_search_path_spec="/lib /lib/w32api /usr/lib /usr/local/lib"
       ;;
     mingw*)
       # MinGW DLLs use traditional 'lib' prefix
@@ -14920,7 +14223,7 @@
       ;;
     pw32*)
       # pw32 DLLs use 'pw' prefix rather than 'lib'
-      library_names_spec='`echo ${libname} | sed -e 's/^lib/pw/'``echo ${release} | $SED -e 's/[.]/-/g'`${versuffix}${shared_ext}'
+      library_names_spec='`echo ${libname} | sed -e 's/^lib/pw/'``echo ${release} | $SED -e 's/./-/g'`${versuffix}${shared_ext}'
       ;;
     esac
     ;;
@@ -14939,16 +14242,17 @@
   version_type=darwin
   need_lib_prefix=no
   need_version=no
-  library_names_spec='${libname}${release}${versuffix}$shared_ext ${libname}${release}${major}$shared_ext ${libname}$shared_ext'
+  # FIXME: Relying on posixy $() will cause problems for
+  #        cross-compilation, but unfortunately the echo tests do not
+  #        yet detect zsh echo's removal of \ escapes.
+  library_names_spec='${libname}${release}${major}$shared_ext ${libname}$shared_ext ${libname}${release}${versuffix}$shared_ext'
   soname_spec='${libname}${release}${major}$shared_ext'
   shlibpath_overrides_runpath=yes
   shlibpath_var=DYLD_LIBRARY_PATH
-  shrext_cmds='`test .$module = .yes && echo .so || echo .dylib`'
+  shrext='$(test .$module = .yes && echo .so || echo .dylib)'
   # Apple's gcc prints 'gcc -print-search-dirs' doesn't operate the same.
-  if test "$GCC" = yes; then
-    sys_lib_search_path_spec=`$CC -print-search-dirs | tr "\n" "$PATH_SEPARATOR" | sed -e 's/libraries:/@libraries:/' | tr "@" "\n" | grep "^libraries:" | sed -e "s/^libraries://" -e "s,=/,/,g" -e "s,$PATH_SEPARATOR, ,g" -e "s,.*,& /lib /usr/lib /usr/local/lib,g"`
-  else
-    sys_lib_search_path_spec='/lib /usr/lib /usr/local/lib'
+  if $CC -v 2>&1 | grep 'Apple' >/dev/null ; then
+  sys_lib_search_path_spec=`$CC -print-search-dirs | tr "\n" "$PATH_SEPARATOR" | sed -e 's/libraries:/@libraries:/' | tr "@" "\n" | grep "^libraries:" | sed -e "s/^libraries://" -e "s,=/,/,g" -e "s,$PATH_SEPARATOR, ,g" -e "s,.*,& /lib /usr/lib /usr/local/lib,g"`
   fi
   sys_lib_dlsearch_path_spec='/usr/local/lib /lib /usr/lib'
   ;;
@@ -14966,29 +14270,8 @@
   dynamic_linker=no
   ;;
 
-kfreebsd*-gnu)
-  version_type=linux
-  need_lib_prefix=no
-  need_version=no
-  library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major ${libname}${shared_ext}'
-  soname_spec='${libname}${release}${shared_ext}$major'
-  shlibpath_var=LD_LIBRARY_PATH
-  shlibpath_overrides_runpath=no
-  hardcode_into_libs=yes
-  dynamic_linker='GNU ld.so'
-  ;;
-
-freebsd* | dragonfly*)
-  # DragonFly does not have aout.  When/if they implement a new
-  # versioning mechanism, adjust this.
-  if test -x /usr/bin/objformat; then
-    objformat=`/usr/bin/objformat`
-  else
-    case $host_os in
-    freebsd[123]*) objformat=aout ;;
-    *) objformat=elf ;;
-    esac
-  fi
+freebsd*)
+  objformat=`test -x /usr/bin/objformat && /usr/bin/objformat || echo aout`
   version_type=freebsd-$objformat
   case $version_type in
     freebsd-elf*)
@@ -15006,7 +14289,7 @@
   freebsd2*)
     shlibpath_overrides_runpath=yes
     ;;
-  freebsd3.[01]* | freebsdelf3.[01]*)
+  freebsd3.01* | freebsdelf3.01*)
     shlibpath_overrides_runpath=yes
     hardcode_into_libs=yes
     ;;
@@ -15033,9 +14316,9 @@
   version_type=sunos
   need_lib_prefix=no
   need_version=no
-  case $host_cpu in
+  case "$host_cpu" in
   ia64*)
-    shrext_cmds='.so'
+    shrext='.so'
     hardcode_into_libs=yes
     dynamic_linker="$host_os dld.so"
     shlibpath_var=LD_LIBRARY_PATH
@@ -15050,7 +14333,7 @@
     sys_lib_dlsearch_path_spec=$sys_lib_search_path_spec
     ;;
    hppa*64*)
-     shrext_cmds='.sl'
+     shrext='.sl'
      hardcode_into_libs=yes
      dynamic_linker="$host_os dld.sl"
      shlibpath_var=LD_LIBRARY_PATH # How should we handle SHLIB_PATH
@@ -15061,7 +14344,7 @@
      sys_lib_dlsearch_path_spec=$sys_lib_search_path_spec
      ;;
    *)
-    shrext_cmds='.sl'
+    shrext='.sl'
     dynamic_linker="$host_os dld.sl"
     shlibpath_var=SHLIB_PATH
     shlibpath_overrides_runpath=no # +s is required to enable SHLIB_PATH
@@ -15130,12 +14413,6 @@
   # before this can be enabled.
   hardcode_into_libs=yes
 
-  # Append ld.so.conf contents to the search path
-  if test -f /etc/ld.so.conf; then
-    lt_ld_extra=`awk '/^include / { system(sprintf("cd /etc; cat %s", \$2)); skip = 1; } { if (!skip) print \$0; skip = 0; }' < /etc/ld.so.conf | $SED -e 's/#.*//;s/[:,	]/ /g;s/=[^=]*$//;s/=[^= ]* / /g;/^$/d' | tr '\n' ' '`
-    sys_lib_dlsearch_path_spec="/lib /usr/lib $lt_ld_extra"
-  fi
-
   # We used to test for /lib/ld.so.1 and disable shared libraries on
   # powerpc, because MkLinux only supported shared libraries with the
   # GNU dynamic linker.  Since this was broken with cross compilers,
@@ -15145,18 +14422,6 @@
   dynamic_linker='GNU/Linux ld.so'
   ;;
 
-knetbsd*-gnu)
-  version_type=linux
-  need_lib_prefix=no
-  need_version=no
-  library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major ${libname}${shared_ext}'
-  soname_spec='${libname}${release}${shared_ext}$major'
-  shlibpath_var=LD_LIBRARY_PATH
-  shlibpath_overrides_runpath=no
-  hardcode_into_libs=yes
-  dynamic_linker='GNU ld.so'
-  ;;
-
 netbsd*)
   version_type=sunos
   need_lib_prefix=no
@@ -15166,7 +14431,7 @@
     finish_cmds='PATH="\$PATH:/sbin" ldconfig -m $libdir'
     dynamic_linker='NetBSD (a.out) ld.so'
   else
-    library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major ${libname}${shared_ext}'
+    library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major ${libname}${release}${shared_ext} ${libname}${shared_ext}'
     soname_spec='${libname}${release}${shared_ext}$major'
     dynamic_linker='NetBSD ld.elf_so'
   fi
@@ -15182,7 +14447,7 @@
   shlibpath_overrides_runpath=yes
   ;;
 
-nto-qnx*)
+nto-qnx)
   version_type=linux
   need_lib_prefix=no
   need_version=no
@@ -15195,11 +14460,7 @@
 openbsd*)
   version_type=sunos
   need_lib_prefix=no
-  # Some older versions of OpenBSD (3.3 at least) *do* need versioned libs.
-  case $host_os in
-    openbsd3.3 | openbsd3.3.*) need_version=yes ;;
-    *)                         need_version=no  ;;
-  esac
+  need_version=no
   library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${shared_ext}$versuffix'
   finish_cmds='PATH="\$PATH:/sbin" ldconfig -m $libdir'
   shlibpath_var=LD_LIBRARY_PATH
@@ -15219,7 +14480,7 @@
 
 os2*)
   libname_spec='$name'
-  shrext_cmds=".dll"
+  shrext=".dll"
   need_lib_prefix=no
   library_names_spec='$libname${shared_ext} $libname.a'
   dynamic_linker='OS/2 ld.exe'
@@ -15317,73 +14578,6 @@
 echo "${ECHO_T}$dynamic_linker" >&6
 test "$dynamic_linker" = no && can_build_shared=no
 
-echo "$as_me:$LINENO: checking how to hardcode library paths into programs" >&5
-echo $ECHO_N "checking how to hardcode library paths into programs... $ECHO_C" >&6
-hardcode_action_F77=
-if test -n "$hardcode_libdir_flag_spec_F77" || \
-   test -n "$runpath_var_F77" || \
-   test "X$hardcode_automatic_F77" = "Xyes" ; then
-
-  # We can hardcode non-existant directories.
-  if test "$hardcode_direct_F77" != no &&
-     # If the only mechanism to avoid hardcoding is shlibpath_var, we
-     # have to relink, otherwise we might link with an installed library
-     # when we should be linking with a yet-to-be-installed one
-     ## test "$_LT_AC_TAGVAR(hardcode_shlibpath_var, F77)" != no &&
-     test "$hardcode_minus_L_F77" != no; then
-    # Linking always hardcodes the temporary library directory.
-    hardcode_action_F77=relink
-  else
-    # We can link without hardcoding, and we can hardcode nonexisting dirs.
-    hardcode_action_F77=immediate
-  fi
-else
-  # We cannot hardcode anything, or else we can only hardcode existing
-  # directories.
-  hardcode_action_F77=unsupported
-fi
-echo "$as_me:$LINENO: result: $hardcode_action_F77" >&5
-echo "${ECHO_T}$hardcode_action_F77" >&6
-
-if test "$hardcode_action_F77" = relink; then
-  # Fast installation is not supported
-  enable_fast_install=no
-elif test "$shlibpath_overrides_runpath" = yes ||
-     test "$enable_shared" = no; then
-  # Fast installation is not necessary
-  enable_fast_install=needless
-fi
-
-striplib=
-old_striplib=
-echo "$as_me:$LINENO: checking whether stripping libraries is possible" >&5
-echo $ECHO_N "checking whether stripping libraries is possible... $ECHO_C" >&6
-if test -n "$STRIP" && $STRIP -V 2>&1 | grep "GNU strip" >/dev/null; then
-  test -z "$old_striplib" && old_striplib="$STRIP --strip-debug"
-  test -z "$striplib" && striplib="$STRIP --strip-unneeded"
-  echo "$as_me:$LINENO: result: yes" >&5
-echo "${ECHO_T}yes" >&6
-else
-# FIXME - insert some real tests, host_os isn't really good enough
-  case $host_os in
-   darwin*)
-       if test -n "$STRIP" ; then
-         striplib="$STRIP -x"
-         echo "$as_me:$LINENO: result: yes" >&5
-echo "${ECHO_T}yes" >&6
-       else
-  echo "$as_me:$LINENO: result: no" >&5
-echo "${ECHO_T}no" >&6
-fi
-       ;;
-   *)
-  echo "$as_me:$LINENO: result: no" >&5
-echo "${ECHO_T}no" >&6
-    ;;
-  esac
-fi
-
-
 
 # The else clause should only fire when bootstrapping the
 # libtool distribution, otherwise you forgot to ship ltmain.sh
@@ -15398,8 +14592,7 @@
   # Now quote all the things that may contain metacharacters while being
   # careful not to overquote the AC_SUBSTed values.  We take copies of the
   # variables and quote the copies for generation of the libtool script.
-  for var in echo old_CC old_CFLAGS AR AR_FLAGS EGREP RANLIB LN_S LTCC NM \
-    SED SHELL STRIP \
+  for var in echo old_CC old_CFLAGS AR AR_FLAGS EGREP RANLIB LN_S LTCC NM SED SHELL \
     libname_spec library_names_spec soname_spec extract_expsyms_cmds \
     old_striplib striplib file_magic_cmd finish_cmds finish_eval \
     deplibs_check_method reload_flag reload_cmds need_locks \
@@ -15457,7 +14650,7 @@
     old_postinstall_cmds | old_postuninstall_cmds | \
     sys_lib_search_path_spec | sys_lib_dlsearch_path_spec)
       # Double-quote double-evaled strings.
-      eval "lt_$var=\\\"\`\$echo \"X\$$var\" | \$Xsed -e \"\$double_quote_subst\" -e \"\$sed_quote_subst\" -e \"\$delay_variable_subst\"\`\\\""
+      eval "lt_$var=\\\"\`\$echo \"X\$$var\" | \$Xsed -e \"\$double_quote_subst\" -e \"\$sed_quote_subst\" -e \"\$delay_variable_subst\" -e \"\$unescape_variable_subst\"\`\\\""
       ;;
     *)
       eval "lt_$var=\\\"\`\$echo \"X\$$var\" | \$Xsed -e \"\$sed_quote_subst\"\`\\\""
@@ -15478,6 +14671,9 @@
 
 # Libtool was configured on host `(hostname || uname -n) 2>/dev/null | sed 1q`:
 
+# Set the command separator (default: ~)
+_S_=\${LIBTOOL_CMD_SEP-\~}
+
 # Shell to use when invoking shell scripts.
 SHELL=$lt_SHELL
 
@@ -15499,12 +14695,6 @@
 # The host system.
 host_alias=$host_alias
 host=$host
-host_os=$host_os
-
-# The build system.
-build_alias=$build_alias
-build=$build
-build_os=$build_os
 
 # An echo program that does not interpret backslashes.
 echo=$lt_echo
@@ -15535,7 +14725,7 @@
 NM=$lt_NM
 
 # A symbol stripping program
-STRIP=$lt_STRIP
+STRIP=$STRIP
 
 # Used to examine libraries when file_magic_cmd begins "file"
 MAGIC_CMD=$MAGIC_CMD
@@ -15566,7 +14756,7 @@
 libext="$libext"
 
 # Shared library suffix (normally ".so").
-shrext_cmds='$shrext_cmds'
+shrext='$shrext'
 
 # Executable file suffix (normally "").
 exeext="$exeext"
@@ -15581,7 +14771,7 @@
 # Does compiler simultaneously support -c and -o options?
 compiler_c_o=$lt_lt_cv_prog_compiler_c_o_F77
 
-# Must we lock files when doing compilation?
+# Must we lock files when doing compilation ?
 need_locks=$lt_need_locks
 
 # Do we need the lib prefix for modules?
@@ -15783,10 +14973,7 @@
   # If there is no Makefile yet, we rely on a make rule to execute
   # `config.status --recheck' to rerun these tests and create the
   # libtool script then.
-  ltmain_in=`echo $ltmain | sed -e 's/\.sh$/.in/'`
-  if test -f "$ltmain_in"; then
-    test -f Makefile && make "$ltmain"
-  fi
+  test -f Makefile && make "$ltmain"
 fi
 
 
@@ -15819,7 +15006,7 @@
 lt_simple_compile_test_code="class foo {}\n"
 
 # Code to be used in simple link tests
-lt_simple_link_test_code='public class conftest { public static void main(String[] argv) {}; }\n'
+lt_simple_link_test_code='public class conftest { public static void main(String argv) {}; }\n'
 
 # ltmain only uses $CC for tagged configurations so make sure $CC is set.
 
@@ -15830,49 +15017,22 @@
 compiler=$CC
 
 
-# save warnings/boilerplate of simple test code
-ac_outfile=conftest.$ac_objext
-printf "$lt_simple_compile_test_code" >conftest.$ac_ext
-eval "$ac_compile" 2>&1 >/dev/null | $SED '/^$/d' >conftest.err
-_lt_compiler_boilerplate=`cat conftest.err`
-$rm conftest*
-
-ac_outfile=conftest.$ac_objext
-printf "$lt_simple_link_test_code" >conftest.$ac_ext
-eval "$ac_link" 2>&1 >/dev/null | $SED '/^$/d' >conftest.err
-_lt_linker_boilerplate=`cat conftest.err`
-$rm conftest*
-
-
 # Allow CC to be a program name with arguments.
 lt_save_CC="$CC"
 CC=${GCJ-"gcj"}
 compiler=$CC
 compiler_GCJ=$CC
-for cc_temp in $compiler""; do
-  case $cc_temp in
-    compile | *[\\/]compile | ccache | *[\\/]ccache ) ;;
-    distcc | *[\\/]distcc | purify | *[\\/]purify ) ;;
-    \-*) ;;
-    *) break;;
-  esac
-done
-cc_basename=`$echo "X$cc_temp" | $Xsed -e 's%.*/%%' -e "s%^$host_alias-%%"`
-
 
 # GCJ did not exist at the time GCC didn't implicitly link libc in.
 archive_cmds_need_lc_GCJ=no
 
-old_archive_cmds_GCJ=$old_archive_cmds
-
 
 lt_prog_compiler_no_builtin_flag_GCJ=
 
 if test "$GCC" = yes; then
   lt_prog_compiler_no_builtin_flag_GCJ=' -fno-builtin'
 
-
-echo "$as_me:$LINENO: checking if $compiler supports -fno-rtti -fno-exceptions" >&5
+  echo "$as_me:$LINENO: checking if $compiler supports -fno-rtti -fno-exceptions" >&5
 echo $ECHO_N "checking if $compiler supports -fno-rtti -fno-exceptions... $ECHO_C" >&6
 if test "${lt_cv_prog_compiler_rtti_exceptions+set}" = set; then
   echo $ECHO_N "(cached) $ECHO_C" >&6
@@ -15887,20 +15047,18 @@
    # with a dollar sign (not a hyphen), so the echo should work correctly.
    # The option is referenced via a variable to avoid confusing sed.
    lt_compile=`echo "$ac_compile" | $SED \
-   -e 's:.*FLAGS}\{0,1\} :&$lt_compiler_flag :; t' \
+   -e 's:.*FLAGS}? :&$lt_compiler_flag :; t' \
    -e 's: [^ ]*conftest\.: $lt_compiler_flag&:; t' \
    -e 's:$: $lt_compiler_flag:'`
-   (eval echo "\"\$as_me:15893: $lt_compile\"" >&5)
+   (eval echo "\"\$as_me:15048: $lt_compile\"" >&5)
    (eval "$lt_compile" 2>conftest.err)
    ac_status=$?
    cat conftest.err >&5
-   echo "$as_me:15897: \$? = $ac_status" >&5
+   echo "$as_me:15052: \$? = $ac_status" >&5
    if (exit $ac_status) && test -s "$ac_outfile"; then
      # The compiler can only warn and ignore the option if not recognized
-     # So say no if there are warnings other than the usual output.
-     $echo "X$_lt_compiler_boilerplate" | $Xsed >conftest.exp
-     $SED '/^$/d' conftest.err >conftest.er2
-     if test ! -s conftest.err || diff conftest.exp conftest.er2 >/dev/null; then
+     # So say no if there are warnings
+     if test ! -s conftest.err; then
        lt_cv_prog_compiler_rtti_exceptions=yes
      fi
    fi
@@ -15977,7 +15135,7 @@
     hpux*)
       # PIC is the default for IA64 HP-UX and 64-bit HP-UX, but
       # not for PA HP-UX.
-      case $host_cpu in
+      case "$host_cpu" in
       hppa*64*|ia64*)
 	# +Z the default
 	;;
@@ -16003,16 +15161,6 @@
 	lt_prog_compiler_static_GCJ='-bnso -bI:/lib/syscalls.exp'
       fi
       ;;
-      darwin*)
-        # PIC is the default on this platform
-        # Common symbols not allowed in MH_DYLIB files
-       case $cc_basename in
-         xlc* | xlf* )
-         lt_prog_compiler_pic_GCJ='-qnocommon'
-         lt_prog_compiler_wl_GCJ='-Wl,'
-         ;;
-       esac
-       ;;
 
     mingw* | pw32* | os2*)
       # This hack is so that the source file can tell whether it is being
@@ -16020,11 +15168,24 @@
       lt_prog_compiler_pic_GCJ='-DDLL_EXPORT'
       ;;
 
+    darwin* | rhapsody*)
+      # PIC is the default on this platform
+      # Common symbols not allowed in MH_DYLIB files
+        case $CC in
+          *xlc* )
+          lt_prog_compiler_pic_GCJ='-qpic -qnocommon'
+          ;;
+          *xlf* )
+          lt_prog_compiler_pic_GCJ='-qpic -qnocommon'
+          ;;
+        esac
+      ;;
+
     hpux9* | hpux10* | hpux11*)
       lt_prog_compiler_wl_GCJ='-Wl,'
       # PIC is the default for IA64 HP-UX and 64-bit HP-UX, but
       # not for PA HP-UX.
-      case $host_cpu in
+      case "$host_cpu" in
       hppa*64*|ia64*)
 	# +Z the default
 	;;
@@ -16048,20 +15209,13 @@
       ;;
 
     linux*)
-      case $cc_basename in
-      icc* | ecc*)
+      case $CC in
+      icc|ecc)
 	lt_prog_compiler_wl_GCJ='-Wl,'
 	lt_prog_compiler_pic_GCJ='-KPIC'
 	lt_prog_compiler_static_GCJ='-static'
         ;;
-      pgcc* | pgf77* | pgf90* | pgf95*)
-        # Portland Group compilers (*not* the Pentium gcc compiler,
-	# which looks to be a dead project)
-	lt_prog_compiler_wl_GCJ='-Wl,'
-	lt_prog_compiler_pic_GCJ='-fpic'
-	lt_prog_compiler_static_GCJ='-Bstatic'
-        ;;
-      ccc*)
+      ccc)
         lt_prog_compiler_wl_GCJ='-Wl,'
         # All Alpha code is PIC.
         lt_prog_compiler_static_GCJ='-non_shared'
@@ -16081,14 +15235,9 @@
       ;;
 
     solaris*)
+      lt_prog_compiler_wl_GCJ='-Wl,'
       lt_prog_compiler_pic_GCJ='-KPIC'
       lt_prog_compiler_static_GCJ='-Bstatic'
-      case $cc_basename in
-      f77* | f90* | f95*)
-	lt_prog_compiler_wl_GCJ='-Qoption ld ';;
-      *)
-	lt_prog_compiler_wl_GCJ='-Wl,';;
-      esac
       ;;
 
     sunos4*)
@@ -16110,11 +15259,6 @@
       fi
       ;;
 
-    unicos*)
-      lt_prog_compiler_wl_GCJ='-Wl,'
-      lt_prog_compiler_can_build_shared_GCJ=no
-      ;;
-
     uts4*)
       lt_prog_compiler_pic_GCJ='-pic'
       lt_prog_compiler_static_GCJ='-Bstatic'
@@ -16133,8 +15277,7 @@
 # Check to make sure the PIC flag actually works.
 #
 if test -n "$lt_prog_compiler_pic_GCJ"; then
-
-echo "$as_me:$LINENO: checking if $compiler PIC flag $lt_prog_compiler_pic_GCJ works" >&5
+  echo "$as_me:$LINENO: checking if $compiler PIC flag $lt_prog_compiler_pic_GCJ works" >&5
 echo $ECHO_N "checking if $compiler PIC flag $lt_prog_compiler_pic_GCJ works... $ECHO_C" >&6
 if test "${lt_prog_compiler_pic_works_GCJ+set}" = set; then
   echo $ECHO_N "(cached) $ECHO_C" >&6
@@ -16149,20 +15292,18 @@
    # with a dollar sign (not a hyphen), so the echo should work correctly.
    # The option is referenced via a variable to avoid confusing sed.
    lt_compile=`echo "$ac_compile" | $SED \
-   -e 's:.*FLAGS}\{0,1\} :&$lt_compiler_flag :; t' \
+   -e 's:.*FLAGS}? :&$lt_compiler_flag :; t' \
    -e 's: [^ ]*conftest\.: $lt_compiler_flag&:; t' \
    -e 's:$: $lt_compiler_flag:'`
-   (eval echo "\"\$as_me:16155: $lt_compile\"" >&5)
+   (eval echo "\"\$as_me:15293: $lt_compile\"" >&5)
    (eval "$lt_compile" 2>conftest.err)
    ac_status=$?
    cat conftest.err >&5
-   echo "$as_me:16159: \$? = $ac_status" >&5
+   echo "$as_me:15297: \$? = $ac_status" >&5
    if (exit $ac_status) && test -s "$ac_outfile"; then
      # The compiler can only warn and ignore the option if not recognized
-     # So say no if there are warnings other than the usual output.
-     $echo "X$_lt_compiler_boilerplate" | $Xsed >conftest.exp
-     $SED '/^$/d' conftest.err >conftest.er2
-     if test ! -s conftest.err || diff conftest.exp conftest.er2 >/dev/null; then
+     # So say no if there are warnings
+     if test ! -s conftest.err; then
        lt_prog_compiler_pic_works_GCJ=yes
      fi
    fi
@@ -16183,7 +15324,7 @@
 fi
 
 fi
-case $host_os in
+case "$host_os" in
   # For platforms which do not support PIC, -DPIC is meaningless:
   *djgpp*)
     lt_prog_compiler_pic_GCJ=
@@ -16205,36 +15346,38 @@
    mkdir out
    printf "$lt_simple_compile_test_code" > conftest.$ac_ext
 
+   # According to Tom Tromey, Ian Lance Taylor reported there are C compilers
+   # that will create temporary files in the current directory regardless of
+   # the output directory.  Thus, making CWD read-only will cause this test
+   # to fail, enabling locking or at least warning the user not to do parallel
+   # builds.
+   chmod -w .
+
    lt_compiler_flag="-o out/conftest2.$ac_objext"
    # Insert the option either (1) after the last *FLAGS variable, or
    # (2) before a word containing "conftest.", or (3) at the end.
    # Note that $ac_compile itself does not contain backslashes and begins
    # with a dollar sign (not a hyphen), so the echo should work correctly.
    lt_compile=`echo "$ac_compile" | $SED \
-   -e 's:.*FLAGS}\{0,1\} :&$lt_compiler_flag :; t' \
+   -e 's:.*FLAGS}? :&$lt_compiler_flag :; t' \
    -e 's: [^ ]*conftest\.: $lt_compiler_flag&:; t' \
    -e 's:$: $lt_compiler_flag:'`
-   (eval echo "\"\$as_me:16217: $lt_compile\"" >&5)
+   (eval echo "\"\$as_me:15360: $lt_compile\"" >&5)
    (eval "$lt_compile" 2>out/conftest.err)
    ac_status=$?
    cat out/conftest.err >&5
-   echo "$as_me:16221: \$? = $ac_status" >&5
+   echo "$as_me:15364: \$? = $ac_status" >&5
    if (exit $ac_status) && test -s out/conftest2.$ac_objext
    then
      # The compiler can only warn and ignore the option if not recognized
      # So say no if there are warnings
-     $echo "X$_lt_compiler_boilerplate" | $Xsed > out/conftest.exp
-     $SED '/^$/d' out/conftest.err >out/conftest.er2
-     if test ! -s out/conftest.err || diff out/conftest.exp out/conftest.er2 >/dev/null; then
+     if test ! -s out/conftest.err; then
        lt_cv_prog_compiler_c_o_GCJ=yes
      fi
    fi
-   chmod u+w . 2>&5
-   $rm conftest*
-   # SGI C++ compiler will create directory out/ii_files/ for
-   # template instantiation
-   test -d out/ii_files && $rm out/ii_files/* && rmdir out/ii_files
-   $rm out/* && rmdir out
+   chmod u+w .
+   $rm conftest* out/*
+   rmdir out
    cd ..
    rmdir conftest
    $rm conftest*
@@ -16305,16 +15448,6 @@
   # rely on this symbol name, it's probably fine to never include it in
   # preloaded symbol tables.
   extract_expsyms_cmds=
-  # Just being paranoid about ensuring that cc_basename is set.
-  for cc_temp in $compiler""; do
-  case $cc_temp in
-    compile | *[\\/]compile | ccache | *[\\/]ccache ) ;;
-    distcc | *[\\/]distcc | purify | *[\\/]purify ) ;;
-    \-*) ;;
-    *) break;;
-  esac
-done
-cc_basename=`$echo "X$cc_temp" | $Xsed -e 's%.*/%%' -e "s%^$host_alias-%%"`
 
   case $host_os in
   cygwin* | mingw* | pw32*)
@@ -16335,27 +15468,6 @@
     # If archive_cmds runs LD, not CC, wlarc should be empty
     wlarc='${wl}'
 
-    # Set some defaults for GNU ld with shared library support. These
-    # are reset later if shared libraries are not supported. Putting them
-    # here allows them to be overridden if necessary.
-    runpath_var=LD_RUN_PATH
-    hardcode_libdir_flag_spec_GCJ='${wl}--rpath ${wl}$libdir'
-    export_dynamic_flag_spec_GCJ='${wl}--export-dynamic'
-    # ancient GNU ld didn't support --whole-archive et. al.
-    if $LD --help 2>&1 | grep 'no-whole-archive' > /dev/null; then
-	whole_archive_flag_spec_GCJ="$wlarc"'--whole-archive$convenience '"$wlarc"'--no-whole-archive'
-      else
-  	whole_archive_flag_spec_GCJ=
-    fi
-    supports_anon_versioning=no
-    case `$LD -v 2>/dev/null` in
-      *\ [01].* | *\ 2.[0-9].* | *\ 2.10.*) ;; # catch versions < 2.11
-      *\ 2.11.93.0.2\ *) supports_anon_versioning=yes ;; # RH7.3 ...
-      *\ 2.11.92.0.12\ *) supports_anon_versioning=yes ;; # Mandrake 8.2 ...
-      *\ 2.11.*) ;; # other 2.11 versions
-      *) supports_anon_versioning=yes ;;
-    esac
-
     # See if GNU ld supports shared libraries.
     case $host_os in
     aix3* | aix4* | aix5*)
@@ -16375,7 +15487,7 @@
       ;;
 
     amigaos*)
-      archive_cmds_GCJ='$rm $output_objdir/a2ixlibrary.data~$echo "#define NAME $libname" > $output_objdir/a2ixlibrary.data~$echo "#define LIBRARY_ID 1" >> $output_objdir/a2ixlibrary.data~$echo "#define VERSION $major" >> $output_objdir/a2ixlibrary.data~$echo "#define REVISION $revision" >> $output_objdir/a2ixlibrary.data~$AR $AR_FLAGS $lib $libobjs~$RANLIB $lib~(cd $output_objdir && a2ixlibrary -32)'
+      archive_cmds_GCJ='$rm $output_objdir/a2ixlibrary.data${_S_}$echo "#define NAME $libname" > $output_objdir/a2ixlibrary.data${_S_}$echo "#define LIBRARY_ID 1" >> $output_objdir/a2ixlibrary.data${_S_}$echo "#define VERSION $major" >> $output_objdir/a2ixlibrary.data${_S_}$echo "#define REVISION $revision" >> $output_objdir/a2ixlibrary.data${_S_}$AR $AR_FLAGS $lib $libobjs${_S_}$RANLIB $lib${_S_}(cd $output_objdir && a2ixlibrary -32)'
       hardcode_libdir_flag_spec_GCJ='-L$libdir'
       hardcode_minus_L_GCJ=yes
 
@@ -16406,7 +15518,7 @@
       allow_undefined_flag_GCJ=unsupported
       always_export_symbols_GCJ=no
       enable_shared_with_static_runtimes_GCJ=yes
-      export_symbols_cmds_GCJ='$NM $libobjs $convenience | $global_symbol_pipe | $SED -e '\''/^[BCDGRS] /s/.* \([^ ]*\)/\1 DATA/'\'' | $SED -e '\''/^[AITW] /s/.* //'\'' | sort | uniq > $export_symbols'
+      export_symbols_cmds_GCJ='$NM $libobjs $convenience | $global_symbol_pipe | $SED -e '\''/^[BCDGS] /s/.* \([^ ]*\)/\1 DATA/'\'' | $SED -e '\''/^[AITW] /s/.* //'\'' | sort | uniq > $export_symbols'
 
       if $LD --help 2>&1 | grep 'auto-import' > /dev/null; then
         archive_cmds_GCJ='$CC -shared $libobjs $deplibs $compiler_flags -o $output_objdir/$soname ${wl}--image-base=0x10000000 ${wl}--out-implib,$lib'
@@ -16417,47 +15529,10 @@
 	else
 	  echo EXPORTS > $output_objdir/$soname.def;
 	  cat $export_symbols >> $output_objdir/$soname.def;
-	fi~
+	fi${_S_}
 	$CC -shared $output_objdir/$soname.def $libobjs $deplibs $compiler_flags -o $output_objdir/$soname ${wl}--image-base=0x10000000  ${wl}--out-implib,$lib'
       else
-	ld_shlibs_GCJ=no
-      fi
-      ;;
-
-    linux*)
-      if $LD --help 2>&1 | grep ': supported targets:.* elf' > /dev/null; then
-	tmp_addflag=
-	case $cc_basename,$host_cpu in
-	pgcc*)				# Portland Group C compiler
-	  whole_archive_flag_spec_GCJ='${wl}--whole-archive`for conv in $convenience\"\"; do test  -n \"$conv\" && new_convenience=\"$new_convenience,$conv\"; done; $echo \"$new_convenience\"` ${wl}--no-whole-archive'
-	  tmp_addflag=' $pic_flag'
-	  ;;
-	pgf77* | pgf90* | pgf95*)	# Portland Group f77 and f90 compilers
-	  whole_archive_flag_spec_GCJ='${wl}--whole-archive`for conv in $convenience\"\"; do test  -n \"$conv\" && new_convenience=\"$new_convenience,$conv\"; done; $echo \"$new_convenience\"` ${wl}--no-whole-archive'
-	  tmp_addflag=' $pic_flag -Mnomain' ;;
-	ecc*,ia64* | icc*,ia64*)		# Intel C compiler on ia64
-	  tmp_addflag=' -i_dynamic' ;;
-	efc*,ia64* | ifort*,ia64*)	# Intel Fortran compiler on ia64
-	  tmp_addflag=' -i_dynamic -nofor_main' ;;
-	ifc* | ifort*)			# Intel Fortran compiler
-	  tmp_addflag=' -nofor_main' ;;
-	esac
-	archive_cmds_GCJ='$CC -shared'"$tmp_addflag"' $libobjs $deplibs $compiler_flags ${wl}-soname $wl$soname -o $lib'
-
-	if test $supports_anon_versioning = yes; then
-	  archive_expsym_cmds_GCJ='$echo "{ global:" > $output_objdir/$libname.ver~
-  cat $export_symbols | sed -e "s/\(.*\)/\1;/" >> $output_objdir/$libname.ver~
-  $echo "local: *; };" >> $output_objdir/$libname.ver~
-	  $CC -shared'"$tmp_addflag"' $libobjs $deplibs $compiler_flags ${wl}-soname $wl$soname ${wl}-version-script ${wl}$output_objdir/$libname.ver -o $lib'
-	fi
-
-# icc does not like -lc for shared libraries
-        case $cc_basename in
-          ecc* | icc* ) archive_cmds_need_lc_GCJ=no ;;
-        esac
-
-      else
-	ld_shlibs_GCJ=no
+	ld_shlibs=no
       fi
       ;;
 
@@ -16509,11 +15584,16 @@
       ;;
     esac
 
-    if test "$ld_shlibs_GCJ" = no; then
-      runpath_var=
-      hardcode_libdir_flag_spec_GCJ=
-      export_dynamic_flag_spec_GCJ=
-      whole_archive_flag_spec_GCJ=
+    if test "$ld_shlibs_GCJ" = yes; then
+      runpath_var=LD_RUN_PATH
+      hardcode_libdir_flag_spec_GCJ='${wl}--rpath ${wl}$libdir'
+      export_dynamic_flag_spec_GCJ='${wl}--export-dynamic'
+      # ancient GNU ld didn't support --whole-archive et. al.
+      if $LD --help 2>&1 | grep 'no-whole-archive' > /dev/null; then
+ 	whole_archive_flag_spec_GCJ="$wlarc"'--whole-archive$convenience '"$wlarc"'--no-whole-archive'
+      else
+  	whole_archive_flag_spec_GCJ=
+      fi
     fi
   else
     # PORTME fill in a description of your system's linker (not GNU ld)
@@ -16521,7 +15601,7 @@
     aix3*)
       allow_undefined_flag_GCJ=unsupported
       always_export_symbols_GCJ=yes
-      archive_expsym_cmds_GCJ='$LD -o $output_objdir/$soname $libobjs $deplibs $linker_flags -bE:$export_symbols -T512 -H512 -bM:SRE~$AR $AR_FLAGS $lib $output_objdir/$soname'
+      archive_expsym_cmds_GCJ='$LD -o $output_objdir/$soname $libobjs $deplibs $linker_flags -bE:$export_symbols -T512 -H512 -bM:SRE${_S_}$AR $AR_FLAGS $lib $output_objdir/$soname'
       # Note: this linker hardcodes the directories in LIBPATH if there
       # are no directories specified by -L.
       hardcode_minus_L_GCJ=yes
@@ -16577,7 +15657,7 @@
       link_all_deplibs_GCJ=yes
 
       if test "$GCC" = yes; then
-	case $host_os in aix4.[012]|aix4.[012].*)
+	case $host_os in aix4.012|aix4.012.*)
 	# We only want to do this on AIX 4.2 and lower, the check
 	# below for broken collect2 doesn't work under 4.3+
 	  collect2name=`${CC} -print-prog-name=collect2`
@@ -16598,9 +15678,6 @@
 	  fi
 	esac
 	shared_flag='-shared'
-	if test "$aix_use_runtimelinking" = yes; then
-	  shared_flag="$shared_flag "'${wl}-G'
-	fi
       else
 	# not using gcc
 	if test "$host_cpu" = ia64; then
@@ -16625,6 +15702,7 @@
 	allow_undefined_flag_GCJ='-berok'
        # Determine the default libpath from the value encoded in an empty executable.
        cat >conftest.$ac_ext <<_ACEOF
+#line $LINENO "configure"
 /* confdefs.h.  */
 _ACEOF
 cat confdefs.h >>conftest.$ac_ext
@@ -16641,21 +15719,11 @@
 _ACEOF
 rm -f conftest.$ac_objext conftest$ac_exeext
 if { (eval echo "$as_me:$LINENO: \"$ac_link\"") >&5
-  (eval $ac_link) 2>conftest.er1
+  (eval $ac_link) 2>&5
   ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
   echo "$as_me:$LINENO: \$? = $ac_status" >&5
   (exit $ac_status); } &&
-	 { ac_try='test -z "$ac_c_werror_flag"
-			 || test ! -s conftest.err'
-  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
-  (eval $ac_try) 2>&5
-  ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; } &&
-	 { ac_try='test -s conftest$ac_exeext'
+         { ac_try='test -s conftest$ac_exeext'
   { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
@@ -16672,8 +15740,7 @@
 sed 's/^/| /' conftest.$ac_ext >&5
 
 fi
-rm -f conftest.err conftest.$ac_objext \
-      conftest$ac_exeext conftest.$ac_ext
+rm -f conftest.$ac_objext conftest$ac_exeext conftest.$ac_ext
 if test -z "$aix_libpath"; then aix_libpath="/usr/lib:/lib"; fi
 
        hardcode_libdir_flag_spec_GCJ='${wl}-blibpath:$libdir:'"$aix_libpath"
@@ -16686,6 +15753,7 @@
 	else
 	 # Determine the default libpath from the value encoded in an empty executable.
 	 cat >conftest.$ac_ext <<_ACEOF
+#line $LINENO "configure"
 /* confdefs.h.  */
 _ACEOF
 cat confdefs.h >>conftest.$ac_ext
@@ -16702,21 +15770,11 @@
 _ACEOF
 rm -f conftest.$ac_objext conftest$ac_exeext
 if { (eval echo "$as_me:$LINENO: \"$ac_link\"") >&5
-  (eval $ac_link) 2>conftest.er1
+  (eval $ac_link) 2>&5
   ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
   echo "$as_me:$LINENO: \$? = $ac_status" >&5
   (exit $ac_status); } &&
-	 { ac_try='test -z "$ac_c_werror_flag"
-			 || test ! -s conftest.err'
-  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
-  (eval $ac_try) 2>&5
-  ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; } &&
-	 { ac_try='test -s conftest$ac_exeext'
+         { ac_try='test -s conftest$ac_exeext'
   { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
@@ -16733,8 +15791,7 @@
 sed 's/^/| /' conftest.$ac_ext >&5
 
 fi
-rm -f conftest.err conftest.$ac_objext \
-      conftest$ac_exeext conftest.$ac_ext
+rm -f conftest.$ac_objext conftest$ac_exeext conftest.$ac_ext
 if test -z "$aix_libpath"; then aix_libpath="/usr/lib:/lib"; fi
 
 	 hardcode_libdir_flag_spec_GCJ='${wl}-blibpath:$libdir:'"$aix_libpath"
@@ -16747,21 +15804,21 @@
 	  # Exported symbols can be pulled into shared objects from archives
 	  whole_archive_flag_spec_GCJ=' '
 	  archive_cmds_need_lc_GCJ=yes
-	  # This is similar to how AIX traditionally builds its shared libraries.
-	  archive_expsym_cmds_GCJ="\$CC $shared_flag"' -o $output_objdir/$soname $libobjs $deplibs $compiler_flags ${wl}-bE:$export_symbols ${wl}-bnoentry${allow_undefined_flag}~$AR $AR_FLAGS $output_objdir/$libname$release.a $output_objdir/$soname'
+	  # This is similar to how AIX traditionally builds it's shared libraries.
+	  archive_expsym_cmds_GCJ="\$CC $shared_flag"' -o $output_objdir/$soname $libobjs $deplibs $compiler_flags ${wl}-bE:$export_symbols ${wl}-bnoentry${allow_undefined_flag}\${_S_}$AR $AR_FLAGS $output_objdir/$libname$release.a $output_objdir/$soname'
 	fi
       fi
       ;;
 
     amigaos*)
-      archive_cmds_GCJ='$rm $output_objdir/a2ixlibrary.data~$echo "#define NAME $libname" > $output_objdir/a2ixlibrary.data~$echo "#define LIBRARY_ID 1" >> $output_objdir/a2ixlibrary.data~$echo "#define VERSION $major" >> $output_objdir/a2ixlibrary.data~$echo "#define REVISION $revision" >> $output_objdir/a2ixlibrary.data~$AR $AR_FLAGS $lib $libobjs~$RANLIB $lib~(cd $output_objdir && a2ixlibrary -32)'
+      archive_cmds_GCJ='$rm $output_objdir/a2ixlibrary.data${_S_}$echo "#define NAME $libname" > $output_objdir/a2ixlibrary.data${_S_}$echo "#define LIBRARY_ID 1" >> $output_objdir/a2ixlibrary.data${_S_}$echo "#define VERSION $major" >> $output_objdir/a2ixlibrary.data${_S_}$echo "#define REVISION $revision" >> $output_objdir/a2ixlibrary.data${_S_}$AR $AR_FLAGS $lib $libobjs${_S_}$RANLIB $lib${_S_}(cd $output_objdir && a2ixlibrary -32)'
       hardcode_libdir_flag_spec_GCJ='-L$libdir'
       hardcode_minus_L_GCJ=yes
       # see comment about different semantics on the GNU ld section
       ld_shlibs_GCJ=no
       ;;
 
-    bsdi[45]*)
+    bsdi4*)
       export_dynamic_flag_spec_GCJ=-rdynamic
       ;;
 
@@ -16775,74 +15832,120 @@
       # Tell ltmain to make .lib files, not .a files.
       libext=lib
       # Tell ltmain to make .dll files, not .so files.
-      shrext_cmds=".dll"
+      shrext=".dll"
       # FIXME: Setting linknames here is a bad hack.
-      archive_cmds_GCJ='$CC -o $lib $libobjs $compiler_flags `echo "$deplibs" | $SED -e '\''s/ -lc$//'\''` -link -dll~linknames='
+      archive_cmds_GCJ='$CC -o $lib $libobjs $compiler_flags `echo "$deplibs" | $SED -e '\''s/ -lc$//'\''` -link -dll${_S_}linknames='
       # The linker will automatically build a .lib file if we build a DLL.
       old_archive_From_new_cmds_GCJ='true'
       # FIXME: Should let the user specify the lib program.
       old_archive_cmds_GCJ='lib /OUT:$oldlib$oldobjs$old_deplibs'
-      fix_srcfile_path_GCJ='`cygpath -w "$srcfile"`'
+      fix_srcfile_path='`cygpath -w "$srcfile"`'
       enable_shared_with_static_runtimes_GCJ=yes
       ;;
 
     darwin* | rhapsody*)
-      case $host_os in
-        rhapsody* | darwin1.[012])
-         allow_undefined_flag_GCJ='${wl}-undefined ${wl}suppress'
-         ;;
-       *) # Darwin 1.3 on
-         if test -z ${MACOSX_DEPLOYMENT_TARGET} ; then
-           allow_undefined_flag_GCJ='${wl}-flat_namespace ${wl}-undefined ${wl}suppress'
-         else
-           case ${MACOSX_DEPLOYMENT_TARGET} in
-             10.[012])
-               allow_undefined_flag_GCJ='${wl}-flat_namespace ${wl}-undefined ${wl}suppress'
-               ;;
-             10.*)
-               allow_undefined_flag_GCJ='${wl}-undefined ${wl}dynamic_lookup'
-               ;;
-           esac
-         fi
-         ;;
-      esac
       archive_cmds_need_lc_GCJ=no
+      case "$host_os" in
+      rhapsody* | darwin1.[012])
+	allow_undefined_flag_GCJ='-undefined suppress'
+	;;
+      darwin1.* | darwin[2-6].*) # Darwin 1.3 on, but less than 7.0
+	test -z ${LD_TWOLEVEL_NAMESPACE} && allow_undefined_flag_GCJ='-flat_namespace -undefined suppress'
+	;;
+      *) # Darwin 7.0 on
+	case "${MACOSX_DEPLOYMENT_TARGET-10.1}" in
+	10.[012])
+	  test -z ${LD_TWOLEVEL_NAMESPACE} && allow_undefined_flag_GCJ='-flat_namespace -undefined suppress'
+	  ;;
+	*) # 10.3 on
+	  if test -z ${LD_TWOLEVEL_NAMESPACE}; then
+	    allow_undefined_flag_GCJ='-flat_namespace -undefined suppress'
+	  else
+	    allow_undefined_flag_GCJ='-undefined dynamic_lookup'
+	  fi
+	  ;;
+	esac
+	;;
+      esac
+
+cat >conftest.$ac_ext <<_ACEOF
+#line $LINENO "configure"
+#include "confdefs.h"
+
+#ifdef F77_DUMMY_MAIN
+#  ifdef __cplusplus
+     extern "C"
+#  endif
+int F77_DUMMY_MAIN() { return 1; }
+#endif
+int
+main (){
+  ;
+  return 0;}
+_ACEOF
+
+  if $CC -v conftest.$ac_ext -o conftest$ac_exeext 2>&1 | grep 'Apple' >/dev/null ; then
+      # FIXME: Relying on posixy $() will cause problems for
+      #        cross-compilation, but unfortunately the echo tests do not
+      #        yet detect zsh echo's removal of \ escapes.  Also zsh mangles
+      #	       `"' quotes if we put them in here... so don't!
+    	lt_int_apple_cc_single_mod=no
+    	output_verbose_link_cmd='echo'
+    	if $CC -dumpspecs 2>&1 | grep 'single_module' >/dev/null ; then
+    	  lt_int_apple_cc_single_mod=yes
+    	fi
+    	if test "X$lt_int_apple_cc_single_mod" = Xyes ; then
+    	  archive_cmds_GCJ='$CC -dynamiclib $archargs -single_module $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags -install_name SW_PREFIX/lib/ccp4-5.99.5/$soname $verstring'
+    	else
+        archive_cmds_GCJ='$CC -r ${wl}-bind_at_load -keep_private_externs -nostdlib -o ${lib}-master.o $libobjs${_S_}$CC -dynamiclib $archargs $allow_undefined_flag -o $lib ${lib}-master.o $deplibs $compiler_flags -install_name SW_PREFIX/lib/ccp4-5.99.5/$soname $verstring'
+      fi
+      module_cmds_GCJ='$CC -bundle $archargs ${wl}-bind_at_load $allow_undefined_flag -o $lib $libobjs $deplibs$compiler_flags'
+      # Don't fix this by using the ld -exported_symbols_list flag, it doesn't exist in older darwin ld's
+        if test "X$lt_int_apple_cc_single_mod" = Xyes ; then
+          archive_expsym_cmds_GCJ='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym${_S_}$CC -dynamiclib $archargs -single_module $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags -install_name SW_PREFIX/lib/ccp4-5.99.5/$soname $verstring${_S_}nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
+        else
+          archive_expsym_cmds_GCJ='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym${_S_}$CC -r ${wl}-bind_at_load -keep_private_externs -nostdlib -o ${lib}-master.o $libobjs${_S_}$CC -dynamiclib $archargs $allow_undefined_flag -o $lib ${lib}-master.o $deplibs $compiler_flags -install_name SW_PREFIX/lib/ccp4-5.99.5/$soname $verstring${_S_}nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
+        fi
+          module_expsym_cmds_GCJ='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym${_S_}$CC -bundle $archargs $allow_undefined_flag  -o $lib $libobjs $deplibs$compiler_flags${_S_}nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
       hardcode_direct_GCJ=no
       hardcode_automatic_GCJ=yes
       hardcode_shlibpath_var_GCJ=unsupported
-      whole_archive_flag_spec_GCJ=''
+      whole_archive_flag_spec_GCJ='-all_load $convenience'
       link_all_deplibs_GCJ=yes
-    if test "$GCC" = yes ; then
-    	output_verbose_link_cmd='echo'
-        archive_cmds_GCJ='$CC -dynamiclib $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags -install_name $rpath/$soname $verstring'
-      module_cmds_GCJ='$CC $allow_undefined_flag -o $lib -bundle $libobjs $deplibs$compiler_flags'
-      # Don't fix this by using the ld -exported_symbols_list flag, it doesn't exist in older darwin lds
-      archive_expsym_cmds_GCJ='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC -dynamiclib $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags -install_name $rpath/$soname $verstring~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
-      module_expsym_cmds_GCJ='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC $allow_undefined_flag  -o $lib -bundle $libobjs $deplibs$compiler_flags~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
-    else
-      case $cc_basename in
-        xlc* )
-         output_verbose_link_cmd='echo'
-         archive_cmds_GCJ='$CC -qmkshrobj $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-install_name ${wl}`echo $rpath/$soname` $verstring'
-         module_cmds_GCJ='$CC $allow_undefined_flag -o $lib -bundle $libobjs $deplibs$compiler_flags'
-          # Don't fix this by using the ld -exported_symbols_list flag, it doesn't exist in older darwin lds
-         archive_expsym_cmds_GCJ='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC -qmkshrobj $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-install_name ${wl}$rpath/$soname $verstring~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
-          module_expsym_cmds_GCJ='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC $allow_undefined_flag  -o $lib -bundle $libobjs $deplibs$compiler_flags~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
-          ;;
-        xlf* )
-         output_verbose_link_cmd='echo'
-         archive_cmds_GCJ='$CC -qmkshrobj $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-dylib_install_name ${wl}`echo $rpath/$soname` $verstring'
-         module_cmds_GCJ='$CC $allow_undefined_flag -o $lib -bundle $libobjs $deplibs$compiler_flags'
-          # Don't fix this by using the ld -exported_symbols_list flag, it doesn't exist in older darwin lds
-         archive_expsym_cmds_GCJ='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC -qmkshrobj $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-dylib_install_name ${wl}$rpath/$soname $verstring~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
-          module_expsym_cmds_GCJ='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC $allow_undefined_flag  -o $lib -bundle $libobjs $deplibs$compiler_flags~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
+
+    elif $CC -v conftest.$ac_ext -o conftest$ac_exeext 2>&1 | grep 'XL_CONFIG' >/dev/null ; then
+    # FIXME: Relying on posixy $() will cause problems for
+    #        cross-compilation, but unfortunately the echo tests do not
+    #        yet detect zsh echo's removal of \ escapes.  Also zsh mangles
+    #          `"' quotes if we put them in here... so don't!
+    output_verbose_link_cmd='echo'
+    archive_cmds_GCJ='$LD -dynamic -dylib $allow_undefined_flag -o $lib $libobjs -ldylib1.o $deplibs$compiler_flags -dylib_install_name $soname $verstring'
+    module_cmds_GCJ='$LD -bundle $allow_undefined_flag -o $lib $libobjs $deplibs$compiler_flags'
+    # Don't fix this by using the ld -exported_symbols_list flag, it doesn't exist in older darwin ld's
+    archive_expsym_cmds_GCJ='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$LD -dynamic -dylib $allow_undefined_flag -o $lib $libobjs $deplibs$compiler_flags -dylib_install_name $soname $verstring~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
+    module_expsym_cmds_GCJ='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$LD -bundle $allow_undefined_flag  -o $lib $libobjs $deplibs$compiler_flags~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
+    hardcode_direct_GCJ=no
+    hardcode_automatic_GCJ=yes
+    hardcode_shlibpath_var_GCJ=unsupported
+    whole_archive_flag_spec_GCJ='-all_load $convenience'
+    link_all_deplibs_GCJ=yes
+    if test "GCJ" = F77 ; then
+      case "${MACOSX_DEPLOYMENT_TARGET-10.1}" in
+        10.[012])
+          test -z ${LD_TWOLEVEL_NAMESPACE} && allow_undefined_flag_GCJ='-flat_namespace -undefined suppress -single_module'
           ;;
-       *)
-         ld_shlibs_GCJ=no
+        *) # 10.3 on
+          if test -z ${LD_TWOLEVEL_NAMESPACE}; then
+            allow_undefined_flag_GCJ='-flat_namespace -undefined suppress -single_module'
+          else
+            allow_undefined_flag_GCJ='-undefined dynamic_lookup -single_module'
+          fi
           ;;
-      esac
+        esac
     fi
-      ;;
+    fi
+    rm -f conftest.$ac_ext conftest$ac_exeext
+    ;;
 
     dgux*)
       archive_cmds_GCJ='$LD -G -h $soname -o $lib $libobjs $deplibs $linker_flags'
@@ -16874,7 +15977,7 @@
       ;;
 
     # FreeBSD 3 and greater uses gcc -shared to do shared libraries.
-    freebsd* | kfreebsd*-gnu | dragonfly*)
+    freebsd*)
       archive_cmds_GCJ='$CC -shared -o $lib $libobjs $deplibs $compiler_flags'
       hardcode_libdir_flag_spec_GCJ='-R$libdir'
       hardcode_direct_GCJ=yes
@@ -16883,9 +15986,9 @@
 
     hpux9*)
       if test "$GCC" = yes; then
-	archive_cmds_GCJ='$rm $output_objdir/$soname~$CC -shared -fPIC ${wl}+b ${wl}$install_libdir -o $output_objdir/$soname $libobjs $deplibs $compiler_flags~test $output_objdir/$soname = $lib || mv $output_objdir/$soname $lib'
+	archive_cmds_GCJ='$rm $output_objdir/$soname${_S_}$CC -shared -fPIC ${wl}+b ${wl}$install_libdir -o $output_objdir/$soname $libobjs $deplibs $compiler_flags${_S_}test $output_objdir/$soname = $lib || mv $output_objdir/$soname $lib'
       else
-	archive_cmds_GCJ='$rm $output_objdir/$soname~$LD -b +b $install_libdir -o $output_objdir/$soname $libobjs $deplibs $linker_flags~test $output_objdir/$soname = $lib || mv $output_objdir/$soname $lib'
+	archive_cmds_GCJ='$rm $output_objdir/$soname${_S_}$LD -b +b $install_libdir -o $output_objdir/$soname $libobjs $deplibs $linker_flags${_S_}test $output_objdir/$soname = $lib || mv $output_objdir/$soname $lib'
       fi
       hardcode_libdir_flag_spec_GCJ='${wl}+b ${wl}$libdir'
       hardcode_libdir_separator_GCJ=:
@@ -16899,7 +16002,7 @@
 
     hpux10* | hpux11*)
       if test "$GCC" = yes -a "$with_gnu_ld" = no; then
-	case $host_cpu in
+	case "$host_cpu" in
 	hppa*64*|ia64*)
 	  archive_cmds_GCJ='$CC -shared ${wl}+h ${wl}$soname -o $lib $libobjs $deplibs $compiler_flags'
 	  ;;
@@ -16908,7 +16011,7 @@
 	  ;;
 	esac
       else
-	case $host_cpu in
+	case "$host_cpu" in
 	hppa*64*|ia64*)
 	  archive_cmds_GCJ='$LD -b +h $soname -o $lib $libobjs $deplibs $linker_flags'
 	  ;;
@@ -16918,7 +16021,7 @@
 	esac
       fi
       if test "$with_gnu_ld" = no; then
-	case $host_cpu in
+	case "$host_cpu" in
 	hppa*64*)
 	  hardcode_libdir_flag_spec_GCJ='${wl}+b ${wl}$libdir'
 	  hardcode_libdir_flag_spec_ld_GCJ='+b $libdir'
@@ -16985,7 +16088,6 @@
       hardcode_shlibpath_var_GCJ=no
       if test -z "`echo __ELF__ | $CC -E - | grep __ELF__`" || test "$host_os-$host_cpu" = "openbsd2.8-powerpc"; then
 	archive_cmds_GCJ='$CC -shared $pic_flag -o $lib $libobjs $deplibs $compiler_flags'
-	archive_expsym_cmds_GCJ='$CC -shared $pic_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-retain-symbols-file,$export_symbols'
 	hardcode_libdir_flag_spec_GCJ='${wl}-rpath,$libdir'
 	export_dynamic_flag_spec_GCJ='${wl}-E'
       else
@@ -17006,7 +16108,7 @@
       hardcode_libdir_flag_spec_GCJ='-L$libdir'
       hardcode_minus_L_GCJ=yes
       allow_undefined_flag_GCJ=unsupported
-      archive_cmds_GCJ='$echo "LIBRARY $libname INITINSTANCE" > $output_objdir/$libname.def~$echo "DESCRIPTION \"$libname\"" >> $output_objdir/$libname.def~$echo DATA >> $output_objdir/$libname.def~$echo " SINGLE NONSHARED" >> $output_objdir/$libname.def~$echo EXPORTS >> $output_objdir/$libname.def~emxexp $libobjs >> $output_objdir/$libname.def~$CC -Zdll -Zcrtdll -o $lib $libobjs $deplibs $compiler_flags $output_objdir/$libname.def'
+      archive_cmds_GCJ='$echo "LIBRARY $libname INITINSTANCE" > $output_objdir/$libname.def${_S_}$echo "DESCRIPTION \"$libname\"" >> $output_objdir/$libname.def${_S_}$echo DATA >> $output_objdir/$libname.def${_S_}$echo " SINGLE NONSHARED" >> $output_objdir/$libname.def${_S_}$echo EXPORTS >> $output_objdir/$libname.def${_S_}emxexp $libobjs >> $output_objdir/$libname.def${_S_}$CC -Zdll -Zcrtdll -o $lib $libobjs $deplibs $compiler_flags $output_objdir/$libname.def'
       old_archive_From_new_cmds_GCJ='emximp -o $output_objdir/$libname.a $output_objdir/$libname.def'
       ;;
 
@@ -17030,8 +16132,8 @@
       else
 	allow_undefined_flag_GCJ=' -expect_unresolved \*'
 	archive_cmds_GCJ='$LD -shared${allow_undefined_flag} $libobjs $deplibs $linker_flags -msym -soname $soname `test -n "$verstring" && echo -set_version $verstring` -update_registry ${output_objdir}/so_locations -o $lib'
-	archive_expsym_cmds_GCJ='for i in `cat $export_symbols`; do printf "%s %s\\n" -exported_symbol "\$i" >> $lib.exp; done; echo "-hidden">> $lib.exp~
-	$LD -shared${allow_undefined_flag} -input $lib.exp $linker_flags $libobjs $deplibs -soname $soname `test -n "$verstring" && echo -set_version $verstring` -update_registry ${output_objdir}/so_locations -o $lib~$rm $lib.exp'
+	archive_expsym_cmds_GCJ='for i in `cat $export_symbols`; do printf "%s %s\\n" -exported_symbol "\$i" >> $lib.exp; done; echo "-hidden">> $lib.exp${_S_}
+	$LD -shared${allow_undefined_flag} -input $lib.exp $linker_flags $libobjs $deplibs -soname $soname `test -n "$verstring" && echo -set_version $verstring` -update_registry ${objdir}/so_locations -o $lib${_S_}$rm $lib.exp'
 
 	# Both c and cxx compiler support -rpath directly
 	hardcode_libdir_flag_spec_GCJ='-rpath $libdir'
@@ -17050,32 +16152,20 @@
     solaris*)
       no_undefined_flag_GCJ=' -z text'
       if test "$GCC" = yes; then
-	wlarc='${wl}'
 	archive_cmds_GCJ='$CC -shared ${wl}-h ${wl}$soname -o $lib $libobjs $deplibs $compiler_flags'
-	archive_expsym_cmds_GCJ='$echo "{ global:" > $lib.exp~cat $export_symbols | $SED -e "s/\(.*\)/\1;/" >> $lib.exp~$echo "local: *; };" >> $lib.exp~
-	  $CC -shared ${wl}-M ${wl}$lib.exp ${wl}-h ${wl}$soname -o $lib $libobjs $deplibs $compiler_flags~$rm $lib.exp'
+	archive_expsym_cmds_GCJ='$echo "{ global:" > $lib.exp${_S_}cat $export_symbols | $SED -e "s/\(.*\)/\1;/" >> $lib.exp${_S_}$echo "local: *; };" >> $lib.exp${_S_}
+	  $CC -shared ${wl}-M ${wl}$lib.exp ${wl}-h ${wl}$soname -o $lib $libobjs $deplibs $compiler_flags${_S_}$rm $lib.exp'
       else
-	wlarc=''
 	archive_cmds_GCJ='$LD -G${allow_undefined_flag} -h $soname -o $lib $libobjs $deplibs $linker_flags'
-	archive_expsym_cmds_GCJ='$echo "{ global:" > $lib.exp~cat $export_symbols | $SED -e "s/\(.*\)/\1;/" >> $lib.exp~$echo "local: *; };" >> $lib.exp~
-  	$LD -G${allow_undefined_flag} -M $lib.exp -h $soname -o $lib $libobjs $deplibs $linker_flags~$rm $lib.exp'
+	archive_expsym_cmds_GCJ='$echo "{ global:" > $lib.exp${_S_}cat $export_symbols | $SED -e "s/\(.*\)/\1;/" >> $lib.exp${_S_}$echo "local: *; };" >> $lib.exp${_S_}
+  	$LD -G${allow_undefined_flag} -M $lib.exp -h $soname -o $lib $libobjs $deplibs $linker_flags${_S_}$rm $lib.exp'
       fi
       hardcode_libdir_flag_spec_GCJ='-R$libdir'
       hardcode_shlibpath_var_GCJ=no
       case $host_os in
       solaris2.[0-5] | solaris2.[0-5].*) ;;
-      *)
- 	# The compiler driver will combine linker options so we
- 	# cannot just pass the convience library names through
- 	# without $wl, iff we do not link with $LD.
- 	# Luckily, gcc supports the same syntax we need for Sun Studio.
- 	# Supported since Solaris 2.6 (maybe 2.5.1?)
- 	case $wlarc in
- 	'')
- 	  whole_archive_flag_spec_GCJ='-z allextract$convenience -z defaultextract' ;;
- 	*)
- 	  whole_archive_flag_spec_GCJ='${wl}-z ${wl}allextract`for conv in $convenience\"\"; do test -n \"$conv\" && new_convenience=\"$new_convenience,$conv\"; done; $echo \"$new_convenience\"` ${wl}-z ${wl}defaultextract' ;;
- 	esac ;;
+      *) # Supported since Solaris 2.6 (maybe 2.5.1?)
+	whole_archive_flag_spec_GCJ='-z allextract$convenience -z defaultextract' ;;
       esac
       link_all_deplibs_GCJ=yes
       ;;
@@ -17157,8 +16247,8 @@
       # $CC -shared without GNU ld will not create a library from C++
       # object files and a static libstdc++, better avoid it by now
       archive_cmds_GCJ='$LD -G${allow_undefined_flag} -h $soname -o $lib $libobjs $deplibs $linker_flags'
-      archive_expsym_cmds_GCJ='$echo "{ global:" > $lib.exp~cat $export_symbols | $SED -e "s/\(.*\)/\1;/" >> $lib.exp~$echo "local: *; };" >> $lib.exp~
-  		$LD -G${allow_undefined_flag} -M $lib.exp -h $soname -o $lib $libobjs $deplibs $linker_flags~$rm $lib.exp'
+      archive_expsym_cmds_GCJ='$echo "{ global:" > $lib.exp${_S_}cat $export_symbols | $SED -e "s/\(.*\)/\1;/" >> $lib.exp${_S_}$echo "local: *; };" >> $lib.exp${_S_}
+  		$LD -G${allow_undefined_flag} -M $lib.exp -h $soname -o $lib $libobjs $deplibs $linker_flags${_S_}$rm $lib.exp'
       hardcode_libdir_flag_spec_GCJ=
       hardcode_shlibpath_var_GCJ=no
       runpath_var='LD_RUN_PATH'
@@ -17195,7 +16285,7 @@
 
   if test "$enable_shared" = yes && test "$GCC" = yes; then
     case $archive_cmds_GCJ in
-    *'~'*)
+    *"$_S_"*)
       # FIXME: we may have to deal with multi-command sequences.
       ;;
     '$CC '*)
@@ -17247,12 +16337,78 @@
   ;;
 esac
 
+echo "$as_me:$LINENO: checking how to hardcode library paths into programs" >&5
+echo $ECHO_N "checking how to hardcode library paths into programs... $ECHO_C" >&6
+hardcode_action_GCJ=
+if test -n "$hardcode_libdir_flag_spec_GCJ" || \
+   test -n "$runpath_var GCJ" || \
+   test "X$hardcode_automatic_GCJ"="Xyes" ; then
+
+  # We can hardcode non-existant directories.
+  if test "$hardcode_direct_GCJ" != no &&
+     # If the only mechanism to avoid hardcoding is shlibpath_var, we
+     # have to relink, otherwise we might link with an installed library
+     # when we should be linking with a yet-to-be-installed one
+     ## test "$_LT_AC_TAGVAR(hardcode_shlibpath_var, GCJ)" != no &&
+     test "$hardcode_minus_L_GCJ" != no; then
+    # Linking always hardcodes the temporary library directory.
+    hardcode_action_GCJ=relink
+  else
+    # We can link without hardcoding, and we can hardcode nonexisting dirs.
+    hardcode_action_GCJ=immediate
+  fi
+else
+  # We cannot hardcode anything, or else we can only hardcode existing
+  # directories.
+  hardcode_action_GCJ=unsupported
+fi
+echo "$as_me:$LINENO: result: $hardcode_action_GCJ" >&5
+echo "${ECHO_T}$hardcode_action_GCJ" >&6
+
+if test "$hardcode_action_GCJ" = relink; then
+  # Fast installation is not supported
+  enable_fast_install=no
+elif test "$shlibpath_overrides_runpath" = yes ||
+     test "$enable_shared" = no; then
+  # Fast installation is not necessary
+  enable_fast_install=needless
+fi
+
+striplib=
+old_striplib=
+echo "$as_me:$LINENO: checking whether stripping libraries is possible" >&5
+echo $ECHO_N "checking whether stripping libraries is possible... $ECHO_C" >&6
+if test -n "$STRIP" && $STRIP -V 2>&1 | grep "GNU strip" >/dev/null; then
+  test -z "$old_striplib" && old_striplib="$STRIP --strip-debug"
+  test -z "$striplib" && striplib="$STRIP --strip-unneeded"
+  echo "$as_me:$LINENO: result: yes" >&5
+echo "${ECHO_T}yes" >&6
+else
+# FIXME - insert some real tests, host_os isn't really good enough
+  case $host_os in
+   NOT-darwin*)
+       if test -n "$STRIP" ; then
+         striplib="$STRIP -x"
+         echo "$as_me:$LINENO: result: yes" >&5
+echo "${ECHO_T}yes" >&6
+       else
+  echo "$as_me:$LINENO: result: no" >&5
+echo "${ECHO_T}no" >&6
+fi
+       ;;
+   *)
+  echo "$as_me:$LINENO: result: no" >&5
+echo "${ECHO_T}no" >&6
+    ;;
+  esac
+fi
+
 echo "$as_me:$LINENO: checking dynamic linker characteristics" >&5
 echo $ECHO_N "checking dynamic linker characteristics... $ECHO_C" >&6
 library_names_spec=
 libname_spec='lib$name'
 soname_spec=
-shrext_cmds=".so"
+shrext=".so"
 postinstall_cmds=
 postuninstall_cmds=
 finish_cmds=
@@ -17340,7 +16496,7 @@
 amigaos*)
   library_names_spec='$libname.ixlibrary $libname.a'
   # Create ${libname}_ixlibrary.a entries in /sys/libs.
-  finish_eval='for lib in `ls $libdir/*.ixlibrary 2>/dev/null`; do libname=`$echo "X$lib" | $Xsed -e '\''s%^.*/\([^/]*\)\.ixlibrary$%\1%'\''`; test $rm /sys/libs/${libname}_ixlibrary.a; $show "cd /sys/libs && $LN_S $lib ${libname}_ixlibrary.a"; cd /sys/libs && $LN_S $lib ${libname}_ixlibrary.a || exit 1; done'
+  finish_eval='for lib in `ls $libdir/*.ixlibrary 2>/dev/null`; do libname=`$echo "X$lib" | $Xsed -e '\''s%^.*/\([^/]*\)\.ixlibrary$%\1%'\''`; test $rm /sys/libs/${libname}_ixlibrary.a; $show "(cd /sys/libs && $LN_S $lib ${libname}_ixlibrary.a)"; (cd /sys/libs && $LN_S $lib ${libname}_ixlibrary.a) || exit 1; done'
   ;;
 
 beos*)
@@ -17349,7 +16505,7 @@
   shlibpath_var=LIBRARY_PATH
   ;;
 
-bsdi[45]*)
+bsdi4*)
   version_type=linux
   need_version=no
   library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major $libname${shared_ext}'
@@ -17365,7 +16521,7 @@
 
 cygwin* | mingw* | pw32*)
   version_type=windows
-  shrext_cmds=".dll"
+  shrext=".dll"
   need_version=no
   need_lib_prefix=no
 
@@ -17373,14 +16529,13 @@
   yes,cygwin* | yes,mingw* | yes,pw32*)
     library_names_spec='$libname.dll.a'
     # DLL is installed to $(libdir)/../bin by postinstall_cmds
-    postinstall_cmds='base_file=`basename \${file}`~
-      dlpath=`$SHELL 2>&1 -c '\''. $dir/'\''\${base_file}'\''i;echo \$dlname'\''`~
-      dldir=$destdir/`dirname \$dlpath`~
-      test -d \$dldir || mkdir -p \$dldir~
-      $install_prog $dir/$dlname \$dldir/$dlname~
-      chmod a+x \$dldir/$dlname'
-    postuninstall_cmds='dldll=`$SHELL 2>&1 -c '\''. $file; echo \$dlname'\''`~
-      dlpath=$dir/\$dldll~
+    postinstall_cmds='base_file=`basename \${file}`${_S_}
+      dlpath=`$SHELL 2>&1 -c '\''. $dir/'\''\${base_file}'\''i;echo \$dlname'\''`${_S_}
+      dldir=$destdir/`dirname \$dlpath`${_S_}
+      test -d \$dldir || mkdir -p \$dldir${_S_}
+      $install_prog $dir/$dlname \$dldir/$dlname'
+    postuninstall_cmds='dldll=`$SHELL 2>&1 -c '\''. $file; echo \$dlname'\''`${_S_}
+      dlpath=$dir/\$dldll${_S_}
        $rm \$dlpath'
     shlibpath_overrides_runpath=yes
 
@@ -17388,7 +16543,7 @@
     cygwin*)
       # Cygwin DLLs use 'cyg' prefix rather than 'lib'
       soname_spec='`echo ${libname} | sed -e 's/^lib/cyg/'``echo ${release} | $SED -e 's/[.]/-/g'`${versuffix}${shared_ext}'
-      sys_lib_search_path_spec="/usr/lib /lib/w32api /lib /usr/local/lib"
+      sys_lib_search_path_spec="/lib /lib/w32api /usr/lib /usr/local/lib"
       ;;
     mingw*)
       # MinGW DLLs use traditional 'lib' prefix
@@ -17408,7 +16563,7 @@
       ;;
     pw32*)
       # pw32 DLLs use 'pw' prefix rather than 'lib'
-      library_names_spec='`echo ${libname} | sed -e 's/^lib/pw/'``echo ${release} | $SED -e 's/[.]/-/g'`${versuffix}${shared_ext}'
+      library_names_spec='`echo ${libname} | sed -e 's/^lib/pw/'``echo ${release} | $SED -e 's/./-/g'`${versuffix}${shared_ext}'
       ;;
     esac
     ;;
@@ -17427,16 +16582,17 @@
   version_type=darwin
   need_lib_prefix=no
   need_version=no
-  library_names_spec='${libname}${release}${versuffix}$shared_ext ${libname}${release}${major}$shared_ext ${libname}$shared_ext'
+  # FIXME: Relying on posixy $() will cause problems for
+  #        cross-compilation, but unfortunately the echo tests do not
+  #        yet detect zsh echo's removal of \ escapes.
+  library_names_spec='${libname}${release}${major}$shared_ext ${libname}$shared_ext ${libname}${release}${versuffix}$shared_ext'
   soname_spec='${libname}${release}${major}$shared_ext'
   shlibpath_overrides_runpath=yes
   shlibpath_var=DYLD_LIBRARY_PATH
-  shrext_cmds='`test .$module = .yes && echo .so || echo .dylib`'
+  shrext='$(test .$module = .yes && echo .so || echo .dylib)'
   # Apple's gcc prints 'gcc -print-search-dirs' doesn't operate the same.
-  if test "$GCC" = yes; then
-    sys_lib_search_path_spec=`$CC -print-search-dirs | tr "\n" "$PATH_SEPARATOR" | sed -e 's/libraries:/@libraries:/' | tr "@" "\n" | grep "^libraries:" | sed -e "s/^libraries://" -e "s,=/,/,g" -e "s,$PATH_SEPARATOR, ,g" -e "s,.*,& /lib /usr/lib /usr/local/lib,g"`
-  else
-    sys_lib_search_path_spec='/lib /usr/lib /usr/local/lib'
+  if $CC -v 2>&1 | grep 'Apple' >/dev/null ; then
+  sys_lib_search_path_spec=`$CC -print-search-dirs | tr "\n" "$PATH_SEPARATOR" | sed -e 's/libraries:/@libraries:/' | tr "@" "\n" | grep "^libraries:" | sed -e "s/^libraries://" -e "s,=/,/,g" -e "s,$PATH_SEPARATOR, ,g" -e "s,.*,& /lib /usr/lib /usr/local/lib,g"`
   fi
   sys_lib_dlsearch_path_spec='/usr/local/lib /lib /usr/lib'
   ;;
@@ -17454,29 +16610,8 @@
   dynamic_linker=no
   ;;
 
-kfreebsd*-gnu)
-  version_type=linux
-  need_lib_prefix=no
-  need_version=no
-  library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major ${libname}${shared_ext}'
-  soname_spec='${libname}${release}${shared_ext}$major'
-  shlibpath_var=LD_LIBRARY_PATH
-  shlibpath_overrides_runpath=no
-  hardcode_into_libs=yes
-  dynamic_linker='GNU ld.so'
-  ;;
-
-freebsd* | dragonfly*)
-  # DragonFly does not have aout.  When/if they implement a new
-  # versioning mechanism, adjust this.
-  if test -x /usr/bin/objformat; then
-    objformat=`/usr/bin/objformat`
-  else
-    case $host_os in
-    freebsd[123]*) objformat=aout ;;
-    *) objformat=elf ;;
-    esac
-  fi
+freebsd*)
+  objformat=`test -x /usr/bin/objformat && /usr/bin/objformat || echo aout`
   version_type=freebsd-$objformat
   case $version_type in
     freebsd-elf*)
@@ -17494,7 +16629,7 @@
   freebsd2*)
     shlibpath_overrides_runpath=yes
     ;;
-  freebsd3.[01]* | freebsdelf3.[01]*)
+  freebsd3.01* | freebsdelf3.01*)
     shlibpath_overrides_runpath=yes
     hardcode_into_libs=yes
     ;;
@@ -17521,9 +16656,9 @@
   version_type=sunos
   need_lib_prefix=no
   need_version=no
-  case $host_cpu in
+  case "$host_cpu" in
   ia64*)
-    shrext_cmds='.so'
+    shrext='.so'
     hardcode_into_libs=yes
     dynamic_linker="$host_os dld.so"
     shlibpath_var=LD_LIBRARY_PATH
@@ -17538,7 +16673,7 @@
     sys_lib_dlsearch_path_spec=$sys_lib_search_path_spec
     ;;
    hppa*64*)
-     shrext_cmds='.sl'
+     shrext='.sl'
      hardcode_into_libs=yes
      dynamic_linker="$host_os dld.sl"
      shlibpath_var=LD_LIBRARY_PATH # How should we handle SHLIB_PATH
@@ -17549,7 +16684,7 @@
      sys_lib_dlsearch_path_spec=$sys_lib_search_path_spec
      ;;
    *)
-    shrext_cmds='.sl'
+    shrext='.sl'
     dynamic_linker="$host_os dld.sl"
     shlibpath_var=SHLIB_PATH
     shlibpath_overrides_runpath=no # +s is required to enable SHLIB_PATH
@@ -17618,12 +16753,6 @@
   # before this can be enabled.
   hardcode_into_libs=yes
 
-  # Append ld.so.conf contents to the search path
-  if test -f /etc/ld.so.conf; then
-    lt_ld_extra=`awk '/^include / { system(sprintf("cd /etc; cat %s", \$2)); skip = 1; } { if (!skip) print \$0; skip = 0; }' < /etc/ld.so.conf | $SED -e 's/#.*//;s/[:,	]/ /g;s/=[^=]*$//;s/=[^= ]* / /g;/^$/d' | tr '\n' ' '`
-    sys_lib_dlsearch_path_spec="/lib /usr/lib $lt_ld_extra"
-  fi
-
   # We used to test for /lib/ld.so.1 and disable shared libraries on
   # powerpc, because MkLinux only supported shared libraries with the
   # GNU dynamic linker.  Since this was broken with cross compilers,
@@ -17633,18 +16762,6 @@
   dynamic_linker='GNU/Linux ld.so'
   ;;
 
-knetbsd*-gnu)
-  version_type=linux
-  need_lib_prefix=no
-  need_version=no
-  library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major ${libname}${shared_ext}'
-  soname_spec='${libname}${release}${shared_ext}$major'
-  shlibpath_var=LD_LIBRARY_PATH
-  shlibpath_overrides_runpath=no
-  hardcode_into_libs=yes
-  dynamic_linker='GNU ld.so'
-  ;;
-
 netbsd*)
   version_type=sunos
   need_lib_prefix=no
@@ -17654,7 +16771,7 @@
     finish_cmds='PATH="\$PATH:/sbin" ldconfig -m $libdir'
     dynamic_linker='NetBSD (a.out) ld.so'
   else
-    library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major ${libname}${shared_ext}'
+    library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major ${libname}${release}${shared_ext} ${libname}${shared_ext}'
     soname_spec='${libname}${release}${shared_ext}$major'
     dynamic_linker='NetBSD ld.elf_so'
   fi
@@ -17670,7 +16787,7 @@
   shlibpath_overrides_runpath=yes
   ;;
 
-nto-qnx*)
+nto-qnx)
   version_type=linux
   need_lib_prefix=no
   need_version=no
@@ -17683,11 +16800,7 @@
 openbsd*)
   version_type=sunos
   need_lib_prefix=no
-  # Some older versions of OpenBSD (3.3 at least) *do* need versioned libs.
-  case $host_os in
-    openbsd3.3 | openbsd3.3.*) need_version=yes ;;
-    *)                         need_version=no  ;;
-  esac
+  need_version=no
   library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${shared_ext}$versuffix'
   finish_cmds='PATH="\$PATH:/sbin" ldconfig -m $libdir'
   shlibpath_var=LD_LIBRARY_PATH
@@ -17707,7 +16820,7 @@
 
 os2*)
   libname_spec='$name'
-  shrext_cmds=".dll"
+  shrext=".dll"
   need_lib_prefix=no
   library_names_spec='$libname${shared_ext} $libname.a'
   dynamic_linker='OS/2 ld.exe'
@@ -17805,72 +16918,6 @@
 echo "${ECHO_T}$dynamic_linker" >&6
 test "$dynamic_linker" = no && can_build_shared=no
 
-echo "$as_me:$LINENO: checking how to hardcode library paths into programs" >&5
-echo $ECHO_N "checking how to hardcode library paths into programs... $ECHO_C" >&6
-hardcode_action_GCJ=
-if test -n "$hardcode_libdir_flag_spec_GCJ" || \
-   test -n "$runpath_var_GCJ" || \
-   test "X$hardcode_automatic_GCJ" = "Xyes" ; then
-
-  # We can hardcode non-existant directories.
-  if test "$hardcode_direct_GCJ" != no &&
-     # If the only mechanism to avoid hardcoding is shlibpath_var, we
-     # have to relink, otherwise we might link with an installed library
-     # when we should be linking with a yet-to-be-installed one
-     ## test "$_LT_AC_TAGVAR(hardcode_shlibpath_var, GCJ)" != no &&
-     test "$hardcode_minus_L_GCJ" != no; then
-    # Linking always hardcodes the temporary library directory.
-    hardcode_action_GCJ=relink
-  else
-    # We can link without hardcoding, and we can hardcode nonexisting dirs.
-    hardcode_action_GCJ=immediate
-  fi
-else
-  # We cannot hardcode anything, or else we can only hardcode existing
-  # directories.
-  hardcode_action_GCJ=unsupported
-fi
-echo "$as_me:$LINENO: result: $hardcode_action_GCJ" >&5
-echo "${ECHO_T}$hardcode_action_GCJ" >&6
-
-if test "$hardcode_action_GCJ" = relink; then
-  # Fast installation is not supported
-  enable_fast_install=no
-elif test "$shlibpath_overrides_runpath" = yes ||
-     test "$enable_shared" = no; then
-  # Fast installation is not necessary
-  enable_fast_install=needless
-fi
-
-striplib=
-old_striplib=
-echo "$as_me:$LINENO: checking whether stripping libraries is possible" >&5
-echo $ECHO_N "checking whether stripping libraries is possible... $ECHO_C" >&6
-if test -n "$STRIP" && $STRIP -V 2>&1 | grep "GNU strip" >/dev/null; then
-  test -z "$old_striplib" && old_striplib="$STRIP --strip-debug"
-  test -z "$striplib" && striplib="$STRIP --strip-unneeded"
-  echo "$as_me:$LINENO: result: yes" >&5
-echo "${ECHO_T}yes" >&6
-else
-# FIXME - insert some real tests, host_os isn't really good enough
-  case $host_os in
-   darwin*)
-       if test -n "$STRIP" ; then
-         striplib="$STRIP -x"
-         echo "$as_me:$LINENO: result: yes" >&5
-echo "${ECHO_T}yes" >&6
-       else
-  echo "$as_me:$LINENO: result: no" >&5
-echo "${ECHO_T}no" >&6
-fi
-       ;;
-   *)
-  echo "$as_me:$LINENO: result: no" >&5
-echo "${ECHO_T}no" >&6
-    ;;
-  esac
-fi
-
 if test "x$enable_dlopen" != xyes; then
   enable_dlopen=unknown
   enable_dlopen_self=unknown
@@ -17906,6 +16953,7 @@
   ac_check_lib_save_LIBS=$LIBS
 LIBS="-ldl  $LIBS"
 cat >conftest.$ac_ext <<_ACEOF
+#line $LINENO "configure"
 /* confdefs.h.  */
 _ACEOF
 cat confdefs.h >>conftest.$ac_ext
@@ -17929,21 +16977,11 @@
 _ACEOF
 rm -f conftest.$ac_objext conftest$ac_exeext
 if { (eval echo "$as_me:$LINENO: \"$ac_link\"") >&5
-  (eval $ac_link) 2>conftest.er1
+  (eval $ac_link) 2>&5
   ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
   echo "$as_me:$LINENO: \$? = $ac_status" >&5
   (exit $ac_status); } &&
-	 { ac_try='test -z "$ac_c_werror_flag"
-			 || test ! -s conftest.err'
-  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
-  (eval $ac_try) 2>&5
-  ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; } &&
-	 { ac_try='test -s conftest$ac_exeext'
+         { ac_try='test -s conftest$ac_exeext'
   { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
@@ -17956,8 +16994,7 @@
 
 ac_cv_lib_dl_dlopen=no
 fi
-rm -f conftest.err conftest.$ac_objext \
-      conftest$ac_exeext conftest.$ac_ext
+rm -f conftest.$ac_objext conftest$ac_exeext conftest.$ac_ext
 LIBS=$ac_check_lib_save_LIBS
 fi
 echo "$as_me:$LINENO: result: $ac_cv_lib_dl_dlopen" >&5
@@ -17981,28 +17018,21 @@
   echo $ECHO_N "(cached) $ECHO_C" >&6
 else
   cat >conftest.$ac_ext <<_ACEOF
+#line $LINENO "configure"
 /* confdefs.h.  */
 _ACEOF
 cat confdefs.h >>conftest.$ac_ext
 cat >>conftest.$ac_ext <<_ACEOF
 /* end confdefs.h.  */
-/* Define shl_load to an innocuous variant, in case <limits.h> declares shl_load.
-   For example, HP-UX 11i <limits.h> declares gettimeofday.  */
-#define shl_load innocuous_shl_load
-
 /* System header to define __stub macros and hopefully few prototypes,
     which can conflict with char shl_load (); below.
     Prefer <limits.h> to <assert.h> if __STDC__ is defined, since
     <limits.h> exists even on freestanding compilers.  */
-
 #ifdef __STDC__
 # include <limits.h>
 #else
 # include <assert.h>
 #endif
-
-#undef shl_load
-
 /* Override any gcc2 internal prototype to avoid an error.  */
 #ifdef __cplusplus
 extern "C"
@@ -18033,21 +17063,11 @@
 _ACEOF
 rm -f conftest.$ac_objext conftest$ac_exeext
 if { (eval echo "$as_me:$LINENO: \"$ac_link\"") >&5
-  (eval $ac_link) 2>conftest.er1
+  (eval $ac_link) 2>&5
   ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
   echo "$as_me:$LINENO: \$? = $ac_status" >&5
   (exit $ac_status); } &&
-	 { ac_try='test -z "$ac_c_werror_flag"
-			 || test ! -s conftest.err'
-  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
-  (eval $ac_try) 2>&5
-  ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; } &&
-	 { ac_try='test -s conftest$ac_exeext'
+         { ac_try='test -s conftest$ac_exeext'
   { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
@@ -18060,8 +17080,7 @@
 
 ac_cv_func_shl_load=no
 fi
-rm -f conftest.err conftest.$ac_objext \
-      conftest$ac_exeext conftest.$ac_ext
+rm -f conftest.$ac_objext conftest$ac_exeext conftest.$ac_ext
 fi
 echo "$as_me:$LINENO: result: $ac_cv_func_shl_load" >&5
 echo "${ECHO_T}$ac_cv_func_shl_load" >&6
@@ -18076,6 +17095,7 @@
   ac_check_lib_save_LIBS=$LIBS
 LIBS="-ldld  $LIBS"
 cat >conftest.$ac_ext <<_ACEOF
+#line $LINENO "configure"
 /* confdefs.h.  */
 _ACEOF
 cat confdefs.h >>conftest.$ac_ext
@@ -18099,21 +17119,11 @@
 _ACEOF
 rm -f conftest.$ac_objext conftest$ac_exeext
 if { (eval echo "$as_me:$LINENO: \"$ac_link\"") >&5
-  (eval $ac_link) 2>conftest.er1
+  (eval $ac_link) 2>&5
   ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
   echo "$as_me:$LINENO: \$? = $ac_status" >&5
   (exit $ac_status); } &&
-	 { ac_try='test -z "$ac_c_werror_flag"
-			 || test ! -s conftest.err'
-  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
-  (eval $ac_try) 2>&5
-  ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; } &&
-	 { ac_try='test -s conftest$ac_exeext'
+         { ac_try='test -s conftest$ac_exeext'
   { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
@@ -18126,8 +17136,7 @@
 
 ac_cv_lib_dld_shl_load=no
 fi
-rm -f conftest.err conftest.$ac_objext \
-      conftest$ac_exeext conftest.$ac_ext
+rm -f conftest.$ac_objext conftest$ac_exeext conftest.$ac_ext
 LIBS=$ac_check_lib_save_LIBS
 fi
 echo "$as_me:$LINENO: result: $ac_cv_lib_dld_shl_load" >&5
@@ -18141,28 +17150,21 @@
   echo $ECHO_N "(cached) $ECHO_C" >&6
 else
   cat >conftest.$ac_ext <<_ACEOF
+#line $LINENO "configure"
 /* confdefs.h.  */
 _ACEOF
 cat confdefs.h >>conftest.$ac_ext
 cat >>conftest.$ac_ext <<_ACEOF
 /* end confdefs.h.  */
-/* Define dlopen to an innocuous variant, in case <limits.h> declares dlopen.
-   For example, HP-UX 11i <limits.h> declares gettimeofday.  */
-#define dlopen innocuous_dlopen
-
 /* System header to define __stub macros and hopefully few prototypes,
     which can conflict with char dlopen (); below.
     Prefer <limits.h> to <assert.h> if __STDC__ is defined, since
     <limits.h> exists even on freestanding compilers.  */
-
 #ifdef __STDC__
 # include <limits.h>
 #else
 # include <assert.h>
 #endif
-
-#undef dlopen
-
 /* Override any gcc2 internal prototype to avoid an error.  */
 #ifdef __cplusplus
 extern "C"
@@ -18193,21 +17195,11 @@
 _ACEOF
 rm -f conftest.$ac_objext conftest$ac_exeext
 if { (eval echo "$as_me:$LINENO: \"$ac_link\"") >&5
-  (eval $ac_link) 2>conftest.er1
+  (eval $ac_link) 2>&5
   ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
   echo "$as_me:$LINENO: \$? = $ac_status" >&5
   (exit $ac_status); } &&
-	 { ac_try='test -z "$ac_c_werror_flag"
-			 || test ! -s conftest.err'
-  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
-  (eval $ac_try) 2>&5
-  ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; } &&
-	 { ac_try='test -s conftest$ac_exeext'
+         { ac_try='test -s conftest$ac_exeext'
   { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
@@ -18220,8 +17212,7 @@
 
 ac_cv_func_dlopen=no
 fi
-rm -f conftest.err conftest.$ac_objext \
-      conftest$ac_exeext conftest.$ac_ext
+rm -f conftest.$ac_objext conftest$ac_exeext conftest.$ac_ext
 fi
 echo "$as_me:$LINENO: result: $ac_cv_func_dlopen" >&5
 echo "${ECHO_T}$ac_cv_func_dlopen" >&6
@@ -18236,6 +17227,7 @@
   ac_check_lib_save_LIBS=$LIBS
 LIBS="-ldl  $LIBS"
 cat >conftest.$ac_ext <<_ACEOF
+#line $LINENO "configure"
 /* confdefs.h.  */
 _ACEOF
 cat confdefs.h >>conftest.$ac_ext
@@ -18259,21 +17251,11 @@
 _ACEOF
 rm -f conftest.$ac_objext conftest$ac_exeext
 if { (eval echo "$as_me:$LINENO: \"$ac_link\"") >&5
-  (eval $ac_link) 2>conftest.er1
+  (eval $ac_link) 2>&5
   ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
   echo "$as_me:$LINENO: \$? = $ac_status" >&5
   (exit $ac_status); } &&
-	 { ac_try='test -z "$ac_c_werror_flag"
-			 || test ! -s conftest.err'
-  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
-  (eval $ac_try) 2>&5
-  ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; } &&
-	 { ac_try='test -s conftest$ac_exeext'
+         { ac_try='test -s conftest$ac_exeext'
   { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
@@ -18286,8 +17268,7 @@
 
 ac_cv_lib_dl_dlopen=no
 fi
-rm -f conftest.err conftest.$ac_objext \
-      conftest$ac_exeext conftest.$ac_ext
+rm -f conftest.$ac_objext conftest$ac_exeext conftest.$ac_ext
 LIBS=$ac_check_lib_save_LIBS
 fi
 echo "$as_me:$LINENO: result: $ac_cv_lib_dl_dlopen" >&5
@@ -18303,6 +17284,7 @@
   ac_check_lib_save_LIBS=$LIBS
 LIBS="-lsvld  $LIBS"
 cat >conftest.$ac_ext <<_ACEOF
+#line $LINENO "configure"
 /* confdefs.h.  */
 _ACEOF
 cat confdefs.h >>conftest.$ac_ext
@@ -18326,21 +17308,11 @@
 _ACEOF
 rm -f conftest.$ac_objext conftest$ac_exeext
 if { (eval echo "$as_me:$LINENO: \"$ac_link\"") >&5
-  (eval $ac_link) 2>conftest.er1
+  (eval $ac_link) 2>&5
   ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
   echo "$as_me:$LINENO: \$? = $ac_status" >&5
   (exit $ac_status); } &&
-	 { ac_try='test -z "$ac_c_werror_flag"
-			 || test ! -s conftest.err'
-  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
-  (eval $ac_try) 2>&5
-  ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; } &&
-	 { ac_try='test -s conftest$ac_exeext'
+         { ac_try='test -s conftest$ac_exeext'
   { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
@@ -18353,8 +17325,7 @@
 
 ac_cv_lib_svld_dlopen=no
 fi
-rm -f conftest.err conftest.$ac_objext \
-      conftest$ac_exeext conftest.$ac_ext
+rm -f conftest.$ac_objext conftest$ac_exeext conftest.$ac_ext
 LIBS=$ac_check_lib_save_LIBS
 fi
 echo "$as_me:$LINENO: result: $ac_cv_lib_svld_dlopen" >&5
@@ -18370,6 +17341,7 @@
   ac_check_lib_save_LIBS=$LIBS
 LIBS="-ldld  $LIBS"
 cat >conftest.$ac_ext <<_ACEOF
+#line $LINENO "configure"
 /* confdefs.h.  */
 _ACEOF
 cat confdefs.h >>conftest.$ac_ext
@@ -18393,21 +17365,11 @@
 _ACEOF
 rm -f conftest.$ac_objext conftest$ac_exeext
 if { (eval echo "$as_me:$LINENO: \"$ac_link\"") >&5
-  (eval $ac_link) 2>conftest.er1
+  (eval $ac_link) 2>&5
   ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
   echo "$as_me:$LINENO: \$? = $ac_status" >&5
   (exit $ac_status); } &&
-	 { ac_try='test -z "$ac_c_werror_flag"
-			 || test ! -s conftest.err'
-  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
-  (eval $ac_try) 2>&5
-  ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; } &&
-	 { ac_try='test -s conftest$ac_exeext'
+         { ac_try='test -s conftest$ac_exeext'
   { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
@@ -18420,8 +17382,7 @@
 
 ac_cv_lib_dld_dld_link=no
 fi
-rm -f conftest.err conftest.$ac_objext \
-      conftest$ac_exeext conftest.$ac_ext
+rm -f conftest.$ac_objext conftest$ac_exeext conftest.$ac_ext
 LIBS=$ac_check_lib_save_LIBS
 fi
 echo "$as_me:$LINENO: result: $ac_cv_lib_dld_dld_link" >&5
@@ -18476,7 +17437,7 @@
   lt_dlunknown=0; lt_dlno_uscore=1; lt_dlneed_uscore=2
   lt_status=$lt_dlunknown
   cat > conftest.$ac_ext <<EOF
-#line 18479 "configure"
+#line 17435 "configure"
 #include "confdefs.h"
 
 #if HAVE_DLFCN_H
@@ -18542,7 +17503,7 @@
   ac_status=$?
   echo "$as_me:$LINENO: \$? = $ac_status" >&5
   (exit $ac_status); } && test -s conftest${ac_exeext} 2>/dev/null; then
-    (./conftest; exit; ) >&5 2>/dev/null
+    (./conftest; exit; ) 2>/dev/null
     lt_status=$?
     case x$lt_status in
       x$lt_dlno_uscore) lt_cv_dlopen_self=yes ;;
@@ -18574,7 +17535,7 @@
   lt_dlunknown=0; lt_dlno_uscore=1; lt_dlneed_uscore=2
   lt_status=$lt_dlunknown
   cat > conftest.$ac_ext <<EOF
-#line 18577 "configure"
+#line 17533 "configure"
 #include "confdefs.h"
 
 #if HAVE_DLFCN_H
@@ -18640,7 +17601,7 @@
   ac_status=$?
   echo "$as_me:$LINENO: \$? = $ac_status" >&5
   (exit $ac_status); } && test -s conftest${ac_exeext} 2>/dev/null; then
-    (./conftest; exit; ) >&5 2>/dev/null
+    (./conftest; exit; ) 2>/dev/null
     lt_status=$?
     case x$lt_status in
       x$lt_dlno_uscore) lt_cv_dlopen_self_static=yes ;;
@@ -18691,8 +17652,7 @@
   # Now quote all the things that may contain metacharacters while being
   # careful not to overquote the AC_SUBSTed values.  We take copies of the
   # variables and quote the copies for generation of the libtool script.
-  for var in echo old_CC old_CFLAGS AR AR_FLAGS EGREP RANLIB LN_S LTCC NM \
-    SED SHELL STRIP \
+  for var in echo old_CC old_CFLAGS AR AR_FLAGS EGREP RANLIB LN_S LTCC NM SED SHELL \
     libname_spec library_names_spec soname_spec extract_expsyms_cmds \
     old_striplib striplib file_magic_cmd finish_cmds finish_eval \
     deplibs_check_method reload_flag reload_cmds need_locks \
@@ -18750,7 +17710,7 @@
     old_postinstall_cmds | old_postuninstall_cmds | \
     sys_lib_search_path_spec | sys_lib_dlsearch_path_spec)
       # Double-quote double-evaled strings.
-      eval "lt_$var=\\\"\`\$echo \"X\$$var\" | \$Xsed -e \"\$double_quote_subst\" -e \"\$sed_quote_subst\" -e \"\$delay_variable_subst\"\`\\\""
+      eval "lt_$var=\\\"\`\$echo \"X\$$var\" | \$Xsed -e \"\$double_quote_subst\" -e \"\$sed_quote_subst\" -e \"\$delay_variable_subst\" -e \"\$unescape_variable_subst\"\`\\\""
       ;;
     *)
       eval "lt_$var=\\\"\`\$echo \"X\$$var\" | \$Xsed -e \"\$sed_quote_subst\"\`\\\""
@@ -18771,6 +17731,9 @@
 
 # Libtool was configured on host `(hostname || uname -n) 2>/dev/null | sed 1q`:
 
+# Set the command separator (default: ~)
+_S_=\${LIBTOOL_CMD_SEP-\~}
+
 # Shell to use when invoking shell scripts.
 SHELL=$lt_SHELL
 
@@ -18792,12 +17755,6 @@
 # The host system.
 host_alias=$host_alias
 host=$host
-host_os=$host_os
-
-# The build system.
-build_alias=$build_alias
-build=$build
-build_os=$build_os
 
 # An echo program that does not interpret backslashes.
 echo=$lt_echo
@@ -18828,7 +17785,7 @@
 NM=$lt_NM
 
 # A symbol stripping program
-STRIP=$lt_STRIP
+STRIP=$STRIP
 
 # Used to examine libraries when file_magic_cmd begins "file"
 MAGIC_CMD=$MAGIC_CMD
@@ -18859,7 +17816,7 @@
 libext="$libext"
 
 # Shared library suffix (normally ".so").
-shrext_cmds='$shrext_cmds'
+shrext='$shrext'
 
 # Executable file suffix (normally "").
 exeext="$exeext"
@@ -18874,7 +17831,7 @@
 # Does compiler simultaneously support -c and -o options?
 compiler_c_o=$lt_lt_cv_prog_compiler_c_o_GCJ
 
-# Must we lock files when doing compilation?
+# Must we lock files when doing compilation ?
 need_locks=$lt_need_locks
 
 # Do we need the lib prefix for modules?
@@ -19076,10 +18033,7 @@
   # If there is no Makefile yet, we rely on a make rule to execute
   # `config.status --recheck' to rerun these tests and create the
   # libtool script then.
-  ltmain_in=`echo $ltmain | sed -e 's/\.sh$/.in/'`
-  if test -f "$ltmain_in"; then
-    test -f Makefile && make "$ltmain"
-  fi
+  test -f Makefile && make "$ltmain"
 fi
 
 
@@ -19122,35 +18076,11 @@
 compiler=$CC
 
 
-# save warnings/boilerplate of simple test code
-ac_outfile=conftest.$ac_objext
-printf "$lt_simple_compile_test_code" >conftest.$ac_ext
-eval "$ac_compile" 2>&1 >/dev/null | $SED '/^$/d' >conftest.err
-_lt_compiler_boilerplate=`cat conftest.err`
-$rm conftest*
-
-ac_outfile=conftest.$ac_objext
-printf "$lt_simple_link_test_code" >conftest.$ac_ext
-eval "$ac_link" 2>&1 >/dev/null | $SED '/^$/d' >conftest.err
-_lt_linker_boilerplate=`cat conftest.err`
-$rm conftest*
-
-
 # Allow CC to be a program name with arguments.
 lt_save_CC="$CC"
 CC=${RC-"windres"}
 compiler=$CC
 compiler_RC=$CC
-for cc_temp in $compiler""; do
-  case $cc_temp in
-    compile | *[\\/]compile | ccache | *[\\/]ccache ) ;;
-    distcc | *[\\/]distcc | purify | *[\\/]purify ) ;;
-    \-*) ;;
-    *) break;;
-  esac
-done
-cc_basename=`$echo "X$cc_temp" | $Xsed -e 's%.*/%%' -e "s%^$host_alias-%%"`
-
 lt_cv_prog_compiler_c_o_RC=yes
 
 # The else clause should only fire when bootstrapping the
@@ -19166,8 +18096,7 @@
   # Now quote all the things that may contain metacharacters while being
   # careful not to overquote the AC_SUBSTed values.  We take copies of the
   # variables and quote the copies for generation of the libtool script.
-  for var in echo old_CC old_CFLAGS AR AR_FLAGS EGREP RANLIB LN_S LTCC NM \
-    SED SHELL STRIP \
+  for var in echo old_CC old_CFLAGS AR AR_FLAGS EGREP RANLIB LN_S LTCC NM SED SHELL \
     libname_spec library_names_spec soname_spec extract_expsyms_cmds \
     old_striplib striplib file_magic_cmd finish_cmds finish_eval \
     deplibs_check_method reload_flag reload_cmds need_locks \
@@ -19225,7 +18154,7 @@
     old_postinstall_cmds | old_postuninstall_cmds | \
     sys_lib_search_path_spec | sys_lib_dlsearch_path_spec)
       # Double-quote double-evaled strings.
-      eval "lt_$var=\\\"\`\$echo \"X\$$var\" | \$Xsed -e \"\$double_quote_subst\" -e \"\$sed_quote_subst\" -e \"\$delay_variable_subst\"\`\\\""
+      eval "lt_$var=\\\"\`\$echo \"X\$$var\" | \$Xsed -e \"\$double_quote_subst\" -e \"\$sed_quote_subst\" -e \"\$delay_variable_subst\" -e \"\$unescape_variable_subst\"\`\\\""
       ;;
     *)
       eval "lt_$var=\\\"\`\$echo \"X\$$var\" | \$Xsed -e \"\$sed_quote_subst\"\`\\\""
@@ -19246,6 +18175,9 @@
 
 # Libtool was configured on host `(hostname || uname -n) 2>/dev/null | sed 1q`:
 
+# Set the command separator (default: ~)
+_S_=\${LIBTOOL_CMD_SEP-\~}
+
 # Shell to use when invoking shell scripts.
 SHELL=$lt_SHELL
 
@@ -19267,12 +18199,6 @@
 # The host system.
 host_alias=$host_alias
 host=$host
-host_os=$host_os
-
-# The build system.
-build_alias=$build_alias
-build=$build
-build_os=$build_os
 
 # An echo program that does not interpret backslashes.
 echo=$lt_echo
@@ -19303,7 +18229,7 @@
 NM=$lt_NM
 
 # A symbol stripping program
-STRIP=$lt_STRIP
+STRIP=$STRIP
 
 # Used to examine libraries when file_magic_cmd begins "file"
 MAGIC_CMD=$MAGIC_CMD
@@ -19334,7 +18260,7 @@
 libext="$libext"
 
 # Shared library suffix (normally ".so").
-shrext_cmds='$shrext_cmds'
+shrext='$shrext'
 
 # Executable file suffix (normally "").
 exeext="$exeext"
@@ -19349,7 +18275,7 @@
 # Does compiler simultaneously support -c and -o options?
 compiler_c_o=$lt_lt_cv_prog_compiler_c_o_RC
 
-# Must we lock files when doing compilation?
+# Must we lock files when doing compilation ?
 need_locks=$lt_need_locks
 
 # Do we need the lib prefix for modules?
@@ -19551,10 +18477,7 @@
   # If there is no Makefile yet, we rely on a make rule to execute
   # `config.status --recheck' to rerun these tests and create the
   # libtool script then.
-  ltmain_in=`echo $ltmain | sed -e 's/\.sh$/.in/'`
-  if test -f "$ltmain_in"; then
-    test -f Makefile && make "$ltmain"
-  fi
+  test -f Makefile && make "$ltmain"
 fi
 
 
@@ -19728,13 +18651,13 @@
       # `set' does not quote correctly, so add quotes (double-quote
       # substitution turns \\\\ into \\, and sed turns \\ into \).
       sed -n \
-	"s/'/'\\\\''/g;
-	  s/^\\([_$as_cr_alnum]*_cv_[_$as_cr_alnum]*\\)=\\(.*\\)/\\1='\\2'/p"
+        "s/'/'\\\\''/g;
+    	  s/^\\([_$as_cr_alnum]*_cv_[_$as_cr_alnum]*\\)=\\(.*\\)/\\1='\\2'/p"
       ;;
     *)
       # `set' quotes correctly as required by POSIX, so do not add quotes.
       sed -n \
-	"s/^\\([_$as_cr_alnum]*_cv_[_$as_cr_alnum]*\\)=\\(.*\\)/\\1=\\2/p"
+        "s/^\\([_$as_cr_alnum]*_cv_[_$as_cr_alnum]*\\)=\\(.*\\)/\\1=\\2/p"
       ;;
     esac;
 } |
@@ -19764,13 +18687,13 @@
 # trailing colons and then remove the whole line if VPATH becomes empty
 # (actually we leave an empty line to preserve line numbers).
 if test "x$srcdir" = x.; then
-  ac_vpsub='/^[	 ]*VPATH[	 ]*=/{
+  ac_vpsub='/^[ 	]*VPATH[ 	]*=/{
 s/:*\$(srcdir):*/:/;
 s/:*\${srcdir}:*/:/;
 s/:*@srcdir@:*/:/;
-s/^\([^=]*=[	 ]*\):*/\1/;
+s/^\([^=]*=[ 	]*\):*/\1/;
 s/:*$//;
-s/^[^=]*=[	 ]*$//;
+s/^[^=]*=[ 	]*$//;
 }'
 fi
 
@@ -19784,13 +18707,13 @@
 cat >confdef2opt.sed <<\_ACEOF
 t clear
 : clear
-s,^[	 ]*#[	 ]*define[	 ][	 ]*\([^	 (][^	 (]*([^)]*)\)[	 ]*\(.*\),-D\1=\2,g
+s,^[ 	]*#[ 	]*define[ 	][ 	]*\([^ 	(][^ 	(]*([^)]*)\)[ 	]*\(.*\),-D\1=\2,g
 t quote
-s,^[	 ]*#[	 ]*define[	 ][	 ]*\([^	 ][^	 ]*\)[	 ]*\(.*\),-D\1=\2,g
+s,^[ 	]*#[ 	]*define[ 	][ 	]*\([^ 	][^ 	]*\)[ 	]*\(.*\),-D\1=\2,g
 t quote
 d
 : quote
-s,[	 `~#$^&*(){}\\|;'"<>?],\\&,g
+s,[ 	`~#$^&*(){}\\|;'"<>?],\\&,g
 s,\[,\\&,g
 s,\],\\&,g
 s,\$,$$,g
@@ -19812,7 +18735,7 @@
 for ac_i in : $LIBOBJS; do test "x$ac_i" = x: && continue
   # 1. Remove the extension, and $U if already installed.
   ac_i=`echo "$ac_i" |
-	 sed 's/\$U\././;s/\.o$//;s/\.obj$//'`
+         sed 's/\$U\././;s/\.o$//;s/\.obj$//'`
   # 2. Add them.
   ac_libobjs="$ac_libobjs $ac_i\$U.$ac_objext"
   ac_ltlibobjs="$ac_ltlibobjs $ac_i"'$U.lo'
@@ -19870,10 +18793,9 @@
 elif test -n "${BASH_VERSION+set}" && (set -o posix) >/dev/null 2>&1; then
   set -o posix
 fi
-DUALCASE=1; export DUALCASE # for MKS sh
 
 # Support unset when possible.
-if ( (MAIL=60; unset MAIL) || exit) >/dev/null 2>&1; then
+if (FOO=FOO; unset FOO) >/dev/null 2>&1; then
   as_unset=unset
 else
   as_unset=false
@@ -19892,7 +18814,7 @@
   LC_MEASUREMENT LC_MESSAGES LC_MONETARY LC_NAME LC_NUMERIC LC_PAPER \
   LC_TELEPHONE LC_TIME
 do
-  if (set +x; test -z "`(eval $as_var=C; export $as_var) 2>&1`"); then
+  if (set +x; test -n "`(eval $as_var=C; export $as_var) 2>&1`"); then
     eval $as_var=C; export $as_var
   else
     $as_unset $as_var
@@ -20071,17 +18993,16 @@
 if mkdir -p . 2>/dev/null; then
   as_mkdir_p=:
 else
-  test -d ./-p && rmdir ./-p
   as_mkdir_p=false
 fi
 
 as_executable_p="test -f"
 
 # Sed expression to map a string onto a valid CPP name.
-as_tr_cpp="eval sed 'y%*$as_cr_letters%P$as_cr_LETTERS%;s%[^_$as_cr_alnum]%_%g'"
+as_tr_cpp="sed y%*$as_cr_letters%P$as_cr_LETTERS%;s%[^_$as_cr_alnum]%_%g"
 
 # Sed expression to map a string onto a valid variable name.
-as_tr_sh="eval sed 'y%*+%pp%;s%[^_$as_cr_alnum]%_%g'"
+as_tr_sh="sed y%*+%pp%;s%[^_$as_cr_alnum]%_%g"
 
 
 # IFS
@@ -20108,7 +19029,7 @@
 cat >&5 <<_CSEOF
 
 This file was extended by $as_me, which was
-generated by GNU Autoconf 2.59.  Invocation command line was
+generated by GNU Autoconf 2.57.  Invocation command line was
 
   CONFIG_FILES    = $CONFIG_FILES
   CONFIG_HEADERS  = $CONFIG_HEADERS
@@ -20152,7 +19073,7 @@
   -d, --debug      don't remove temporary files
       --recheck    update $as_me by reconfiguring in the same conditions
   --file=FILE[:TEMPLATE]
-		   instantiate the configuration file FILE
+                   instantiate the configuration file FILE
 
 Configuration files:
 $config_files
@@ -20166,10 +19087,11 @@
 cat >>$CONFIG_STATUS <<_ACEOF
 ac_cs_version="\\
 config.status
-configured by $0, generated by GNU Autoconf 2.59,
+configured by $0, generated by GNU Autoconf 2.57,
   with options \\"`echo "$ac_configure_args" | sed 's/[\\""\`\$]/\\\\&/g'`\\"
 
-Copyright (C) 2003 Free Software Foundation, Inc.
+Copyright 1992, 1993, 1994, 1995, 1996, 1998, 1999, 2000, 2001
+Free Software Foundation, Inc.
 This config.status script is free software; the Free Software Foundation
 gives unlimited permission to copy, distribute and modify it."
 srcdir=$srcdir
@@ -20456,9 +19378,9 @@
       (echo ':t
   /@[a-zA-Z_][a-zA-Z_0-9]*@/!b' && cat $tmp/subs.frag) >$tmp/subs-$ac_sed_frag.sed
       if test -z "$ac_sed_cmds"; then
-	ac_sed_cmds="sed -f $tmp/subs-$ac_sed_frag.sed"
+  	ac_sed_cmds="sed -f $tmp/subs-$ac_sed_frag.sed"
       else
-	ac_sed_cmds="$ac_sed_cmds | sed -f $tmp/subs-$ac_sed_frag.sed"
+  	ac_sed_cmds="$ac_sed_cmds | sed -f $tmp/subs-$ac_sed_frag.sed"
       fi
       ac_sed_frag=`expr $ac_sed_frag + 1`
       ac_beg=$ac_end
@@ -20476,21 +19398,21 @@
   # Support "outfile[:infile[:infile...]]", defaulting infile="outfile.in".
   case $ac_file in
   - | *:- | *:-:* ) # input from stdin
-	cat >$tmp/stdin
-	ac_file_in=`echo "$ac_file" | sed 's,[^:]*:,,'`
-	ac_file=`echo "$ac_file" | sed 's,:.*,,'` ;;
+        cat >$tmp/stdin
+        ac_file_in=`echo "$ac_file" | sed 's,[^:]*:,,'`
+        ac_file=`echo "$ac_file" | sed 's,:.*,,'` ;;
   *:* ) ac_file_in=`echo "$ac_file" | sed 's,[^:]*:,,'`
-	ac_file=`echo "$ac_file" | sed 's,:.*,,'` ;;
+        ac_file=`echo "$ac_file" | sed 's,:.*,,'` ;;
   * )   ac_file_in=$ac_file.in ;;
   esac
 
   # Compute @srcdir@, @top_srcdir@, and @INSTALL@ for subdirectories.
   ac_dir=`(dirname "$ac_file") 2>/dev/null ||
 $as_expr X"$ac_file" : 'X\(.*[^/]\)//*[^/][^/]*/*$' \| \
-	 X"$ac_file" : 'X\(//\)[^/]' \| \
-	 X"$ac_file" : 'X\(//\)$' \| \
-	 X"$ac_file" : 'X\(/\)' \| \
-	 .     : '\(.\)' 2>/dev/null ||
+         X"$ac_file" : 'X\(//\)[^/]' \| \
+         X"$ac_file" : 'X\(//\)$' \| \
+         X"$ac_file" : 'X\(/\)' \| \
+         .     : '\(.\)' 2>/dev/null ||
 echo X"$ac_file" |
     sed '/^X\(.*[^/]\)\/\/*[^/][^/]*\/*$/{ s//\1/; q; }
   	  /^X\(\/\/\)[^/].*/{ s//\1/; q; }
@@ -20506,10 +19428,10 @@
       as_dirs="$as_dir $as_dirs"
       as_dir=`(dirname "$as_dir") 2>/dev/null ||
 $as_expr X"$as_dir" : 'X\(.*[^/]\)//*[^/][^/]*/*$' \| \
-	 X"$as_dir" : 'X\(//\)[^/]' \| \
-	 X"$as_dir" : 'X\(//\)$' \| \
-	 X"$as_dir" : 'X\(/\)' \| \
-	 .     : '\(.\)' 2>/dev/null ||
+         X"$as_dir" : 'X\(//\)[^/]' \| \
+         X"$as_dir" : 'X\(//\)$' \| \
+         X"$as_dir" : 'X\(/\)' \| \
+         .     : '\(.\)' 2>/dev/null ||
 echo X"$as_dir" |
     sed '/^X\(.*[^/]\)\/\/*[^/][^/]*\/*$/{ s//\1/; q; }
   	  /^X\(\/\/\)[^/].*/{ s//\1/; q; }
@@ -20547,45 +19469,12 @@
     ac_srcdir=$ac_top_builddir$srcdir$ac_dir_suffix
     ac_top_srcdir=$ac_top_builddir$srcdir ;;
 esac
-
-# Do not use `cd foo && pwd` to compute absolute paths, because
-# the directories may not exist.
-case `pwd` in
-.) ac_abs_builddir="$ac_dir";;
-*)
-  case "$ac_dir" in
-  .) ac_abs_builddir=`pwd`;;
-  [\\/]* | ?:[\\/]* ) ac_abs_builddir="$ac_dir";;
-  *) ac_abs_builddir=`pwd`/"$ac_dir";;
-  esac;;
-esac
-case $ac_abs_builddir in
-.) ac_abs_top_builddir=${ac_top_builddir}.;;
-*)
-  case ${ac_top_builddir}. in
-  .) ac_abs_top_builddir=$ac_abs_builddir;;
-  [\\/]* | ?:[\\/]* ) ac_abs_top_builddir=${ac_top_builddir}.;;
-  *) ac_abs_top_builddir=$ac_abs_builddir/${ac_top_builddir}.;;
-  esac;;
-esac
-case $ac_abs_builddir in
-.) ac_abs_srcdir=$ac_srcdir;;
-*)
-  case $ac_srcdir in
-  .) ac_abs_srcdir=$ac_abs_builddir;;
-  [\\/]* | ?:[\\/]* ) ac_abs_srcdir=$ac_srcdir;;
-  *) ac_abs_srcdir=$ac_abs_builddir/$ac_srcdir;;
-  esac;;
-esac
-case $ac_abs_builddir in
-.) ac_abs_top_srcdir=$ac_top_srcdir;;
-*)
-  case $ac_top_srcdir in
-  .) ac_abs_top_srcdir=$ac_abs_builddir;;
-  [\\/]* | ?:[\\/]* ) ac_abs_top_srcdir=$ac_top_srcdir;;
-  *) ac_abs_top_srcdir=$ac_abs_builddir/$ac_top_srcdir;;
-  esac;;
-esac
+# Don't blindly perform a `cd "$ac_dir"/$ac_foo && pwd` since $ac_foo can be
+# absolute.
+ac_abs_builddir=`cd "$ac_dir" && cd $ac_builddir && pwd`
+ac_abs_top_builddir=`cd "$ac_dir" && cd ${ac_top_builddir}. && pwd`
+ac_abs_srcdir=`cd "$ac_dir" && cd $ac_srcdir && pwd`
+ac_abs_top_srcdir=`cd "$ac_dir" && cd $ac_top_srcdir && pwd`
 
 
   case $INSTALL in
@@ -20607,7 +19496,7 @@
     configure_input="$ac_file.  "
   fi
   configure_input=$configure_input"Generated from `echo $ac_file_in |
-				     sed 's,.*/,,'` by configure."
+                                     sed 's,.*/,,'` by configure."
 
   # First look for the input files in the build tree, otherwise in the
   # src tree.
@@ -20616,24 +19505,24 @@
       case $f in
       -) echo $tmp/stdin ;;
       [\\/$]*)
-	 # Absolute (can't be DOS-style, as IFS=:)
-	 test -f "$f" || { { echo "$as_me:$LINENO: error: cannot find input file: $f" >&5
+         # Absolute (can't be DOS-style, as IFS=:)
+         test -f "$f" || { { echo "$as_me:$LINENO: error: cannot find input file: $f" >&5
 echo "$as_me: error: cannot find input file: $f" >&2;}
    { (exit 1); exit 1; }; }
-	 echo "$f";;
+         echo $f;;
       *) # Relative
-	 if test -f "$f"; then
-	   # Build tree
-	   echo "$f"
-	 elif test -f "$srcdir/$f"; then
-	   # Source tree
-	   echo "$srcdir/$f"
-	 else
-	   # /dev/null tree
-	   { { echo "$as_me:$LINENO: error: cannot find input file: $f" >&5
+         if test -f "$f"; then
+           # Build tree
+           echo $f
+         elif test -f "$srcdir/$f"; then
+           # Source tree
+           echo $srcdir/$f
+         else
+           # /dev/null tree
+           { { echo "$as_me:$LINENO: error: cannot find input file: $f" >&5
 echo "$as_me: error: cannot find input file: $f" >&2;}
    { (exit 1); exit 1; }; }
-	 fi;;
+         fi;;
       esac
     done` || { (exit 1); exit 1; }
 _ACEOF
@@ -20675,41 +19564,16 @@
   ac_source=`echo "$ac_file" | sed 's,[^:]*:,,'`
   ac_dir=`(dirname "$ac_dest") 2>/dev/null ||
 $as_expr X"$ac_dest" : 'X\(.*[^/]\)//*[^/][^/]*/*$' \| \
-	 X"$ac_dest" : 'X\(//\)[^/]' \| \
-	 X"$ac_dest" : 'X\(//\)$' \| \
-	 X"$ac_dest" : 'X\(/\)' \| \
-	 .     : '\(.\)' 2>/dev/null ||
+         X"$ac_dest" : 'X\(//\)[^/]' \| \
+         X"$ac_dest" : 'X\(//\)$' \| \
+         X"$ac_dest" : 'X\(/\)' \| \
+         .     : '\(.\)' 2>/dev/null ||
 echo X"$ac_dest" |
     sed '/^X\(.*[^/]\)\/\/*[^/][^/]*\/*$/{ s//\1/; q; }
   	  /^X\(\/\/\)[^/].*/{ s//\1/; q; }
   	  /^X\(\/\/\)$/{ s//\1/; q; }
   	  /^X\(\/\).*/{ s//\1/; q; }
   	  s/.*/./; q'`
-  { if $as_mkdir_p; then
-    mkdir -p "$ac_dir"
-  else
-    as_dir="$ac_dir"
-    as_dirs=
-    while test ! -d "$as_dir"; do
-      as_dirs="$as_dir $as_dirs"
-      as_dir=`(dirname "$as_dir") 2>/dev/null ||
-$as_expr X"$as_dir" : 'X\(.*[^/]\)//*[^/][^/]*/*$' \| \
-	 X"$as_dir" : 'X\(//\)[^/]' \| \
-	 X"$as_dir" : 'X\(//\)$' \| \
-	 X"$as_dir" : 'X\(/\)' \| \
-	 .     : '\(.\)' 2>/dev/null ||
-echo X"$as_dir" |
-    sed '/^X\(.*[^/]\)\/\/*[^/][^/]*\/*$/{ s//\1/; q; }
-  	  /^X\(\/\/\)[^/].*/{ s//\1/; q; }
-  	  /^X\(\/\/\)$/{ s//\1/; q; }
-  	  /^X\(\/\).*/{ s//\1/; q; }
-  	  s/.*/./; q'`
-    done
-    test ! -n "$as_dirs" || mkdir $as_dirs
-  fi || { { echo "$as_me:$LINENO: error: cannot create directory \"$ac_dir\"" >&5
-echo "$as_me: error: cannot create directory \"$ac_dir\"" >&2;}
-   { (exit 1); exit 1; }; }; }
-
   ac_builddir=.
 
 if test "$ac_dir" != .; then
@@ -20735,45 +19599,12 @@
     ac_srcdir=$ac_top_builddir$srcdir$ac_dir_suffix
     ac_top_srcdir=$ac_top_builddir$srcdir ;;
 esac
-
-# Do not use `cd foo && pwd` to compute absolute paths, because
-# the directories may not exist.
-case `pwd` in
-.) ac_abs_builddir="$ac_dir";;
-*)
-  case "$ac_dir" in
-  .) ac_abs_builddir=`pwd`;;
-  [\\/]* | ?:[\\/]* ) ac_abs_builddir="$ac_dir";;
-  *) ac_abs_builddir=`pwd`/"$ac_dir";;
-  esac;;
-esac
-case $ac_abs_builddir in
-.) ac_abs_top_builddir=${ac_top_builddir}.;;
-*)
-  case ${ac_top_builddir}. in
-  .) ac_abs_top_builddir=$ac_abs_builddir;;
-  [\\/]* | ?:[\\/]* ) ac_abs_top_builddir=${ac_top_builddir}.;;
-  *) ac_abs_top_builddir=$ac_abs_builddir/${ac_top_builddir}.;;
-  esac;;
-esac
-case $ac_abs_builddir in
-.) ac_abs_srcdir=$ac_srcdir;;
-*)
-  case $ac_srcdir in
-  .) ac_abs_srcdir=$ac_abs_builddir;;
-  [\\/]* | ?:[\\/]* ) ac_abs_srcdir=$ac_srcdir;;
-  *) ac_abs_srcdir=$ac_abs_builddir/$ac_srcdir;;
-  esac;;
-esac
-case $ac_abs_builddir in
-.) ac_abs_top_srcdir=$ac_top_srcdir;;
-*)
-  case $ac_top_srcdir in
-  .) ac_abs_top_srcdir=$ac_abs_builddir;;
-  [\\/]* | ?:[\\/]* ) ac_abs_top_srcdir=$ac_top_srcdir;;
-  *) ac_abs_top_srcdir=$ac_abs_builddir/$ac_top_srcdir;;
-  esac;;
-esac
+# Don't blindly perform a `cd "$ac_dir"/$ac_foo && pwd` since $ac_foo can be
+# absolute.
+ac_abs_builddir=`cd "$ac_dir" && cd $ac_builddir && pwd`
+ac_abs_top_builddir=`cd "$ac_dir" && cd ${ac_top_builddir}. && pwd`
+ac_abs_srcdir=`cd "$ac_dir" && cd $ac_srcdir && pwd`
+ac_abs_top_srcdir=`cd "$ac_dir" && cd $ac_top_srcdir && pwd`
 
 
   { echo "$as_me:$LINENO: executing $ac_dest commands" >&5
@@ -20791,10 +19622,10 @@
   if grep '^#.*generated by automake' $mf > /dev/null 2>&1; then
     dirpart=`(dirname "$mf") 2>/dev/null ||
 $as_expr X"$mf" : 'X\(.*[^/]\)//*[^/][^/]*/*$' \| \
-	 X"$mf" : 'X\(//\)[^/]' \| \
-	 X"$mf" : 'X\(//\)$' \| \
-	 X"$mf" : 'X\(/\)' \| \
-	 .     : '\(.\)' 2>/dev/null ||
+         X"$mf" : 'X\(//\)[^/]' \| \
+         X"$mf" : 'X\(//\)$' \| \
+         X"$mf" : 'X\(/\)' \| \
+         .     : '\(.\)' 2>/dev/null ||
 echo X"$mf" |
     sed '/^X\(.*[^/]\)\/\/*[^/][^/]*\/*$/{ s//\1/; q; }
   	  /^X\(\/\/\)[^/].*/{ s//\1/; q; }
@@ -20830,10 +19661,10 @@
     test -f "$dirpart/$file" && continue
     fdir=`(dirname "$file") 2>/dev/null ||
 $as_expr X"$file" : 'X\(.*[^/]\)//*[^/][^/]*/*$' \| \
-	 X"$file" : 'X\(//\)[^/]' \| \
-	 X"$file" : 'X\(//\)$' \| \
-	 X"$file" : 'X\(/\)' \| \
-	 .     : '\(.\)' 2>/dev/null ||
+         X"$file" : 'X\(//\)[^/]' \| \
+         X"$file" : 'X\(//\)$' \| \
+         X"$file" : 'X\(/\)' \| \
+         .     : '\(.\)' 2>/dev/null ||
 echo X"$file" |
     sed '/^X\(.*[^/]\)\/\/*[^/][^/]*\/*$/{ s//\1/; q; }
   	  /^X\(\/\/\)[^/].*/{ s//\1/; q; }
@@ -20849,10 +19680,10 @@
       as_dirs="$as_dir $as_dirs"
       as_dir=`(dirname "$as_dir") 2>/dev/null ||
 $as_expr X"$as_dir" : 'X\(.*[^/]\)//*[^/][^/]*/*$' \| \
-	 X"$as_dir" : 'X\(//\)[^/]' \| \
-	 X"$as_dir" : 'X\(//\)$' \| \
-	 X"$as_dir" : 'X\(/\)' \| \
-	 .     : '\(.\)' 2>/dev/null ||
+         X"$as_dir" : 'X\(//\)[^/]' \| \
+         X"$as_dir" : 'X\(//\)$' \| \
+         X"$as_dir" : 'X\(/\)' \| \
+         .     : '\(.\)' 2>/dev/null ||
 echo X"$as_dir" |
     sed '/^X\(.*[^/]\)\/\/*[^/][^/]*\/*$/{ s//\1/; q; }
   	  /^X\(\/\/\)[^/].*/{ s//\1/; q; }
diff -ruN ccp4-5.99.5-orig/x-windows/xdl_view/src/configure ccp4-5.99.5/x-windows/xdl_view/src/configure
--- ccp4-5.99.5-orig/x-windows/xdl_view/src/configure	2005-11-30 15:22:21.000000000 -0800
+++ ccp4-5.99.5/x-windows/xdl_view/src/configure	2005-11-30 16:27:47.000000000 -0800
@@ -8276,27 +8276,27 @@
       link_all_deplibs=yes
     if test "$GCC" = yes ; then
     	output_verbose_link_cmd='echo'
-        archive_cmds='$CC -dynamiclib $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags -install_name $rpath/$soname $verstring'
+        archive_cmds='$CC -dynamiclib $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags -install_name SW_PREFIX/lib/ccp4-5.99.5/$soname $verstring'
       module_cmds='$CC $allow_undefined_flag -o $lib -bundle $libobjs $deplibs$compiler_flags'
       # Don't fix this by using the ld -exported_symbols_list flag, it doesn't exist in older darwin lds
-      archive_expsym_cmds='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC -dynamiclib $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags -install_name $rpath/$soname $verstring~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
+      archive_expsym_cmds='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC -dynamiclib $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags -install_name SW_PREFIX/lib/ccp4-5.99.5/$soname $verstring~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
       module_expsym_cmds='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC $allow_undefined_flag  -o $lib -bundle $libobjs $deplibs$compiler_flags~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
     else
       case $cc_basename in
         xlc* )
          output_verbose_link_cmd='echo'
-         archive_cmds='$CC -qmkshrobj $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-install_name ${wl}`echo $rpath/$soname` $verstring'
+         archive_cmds='$CC -qmkshrobj $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-install_name ${wl}`echo SW_PREFIX/lib/ccp4-5.99.5/$soname` $verstring'
          module_cmds='$CC $allow_undefined_flag -o $lib -bundle $libobjs $deplibs$compiler_flags'
           # Don't fix this by using the ld -exported_symbols_list flag, it doesn't exist in older darwin lds
-         archive_expsym_cmds='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC -qmkshrobj $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-install_name ${wl}$rpath/$soname $verstring~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
+         archive_expsym_cmds='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC -qmkshrobj $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-install_name ${wl}SW_PREFIX/lib/ccp4-5.99.5/$soname $verstring~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
           module_expsym_cmds='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC $allow_undefined_flag  -o $lib -bundle $libobjs $deplibs$compiler_flags~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
           ;;
         xlf* )
          output_verbose_link_cmd='echo'
-         archive_cmds='$CC -qmkshrobj $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-dylib_install_name ${wl}`echo $rpath/$soname` $verstring'
+         archive_cmds='$CC -qmkshrobj $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-dylib_install_name ${wl}`echo SW_PREFIX/lib/ccp4-5.99.5/$soname` $verstring'
          module_cmds='$CC $allow_undefined_flag -o $lib -bundle $libobjs $deplibs$compiler_flags'
           # Don't fix this by using the ld -exported_symbols_list flag, it doesn't exist in older darwin lds
-         archive_expsym_cmds='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC -qmkshrobj $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-dylib_install_name ${wl}$rpath/$soname $verstring~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
+         archive_expsym_cmds='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC -qmkshrobj $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-dylib_install_name ${wl}SW_PREFIX/lib/ccp4-5.99.5/$soname $verstring~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
           module_expsym_cmds='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC $allow_undefined_flag  -o $lib -bundle $libobjs $deplibs$compiler_flags~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
           ;;
        *)
@@ -11349,26 +11349,26 @@
        lt_int_apple_cc_single_mod=yes
       fi
       if test "X$lt_int_apple_cc_single_mod" = Xyes ; then
-       archive_cmds_CXX='$CC -dynamiclib -single_module $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags -install_name $rpath/$soname $verstring'
+       archive_cmds_CXX='$CC -dynamiclib -single_module $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags -install_name SW_PREFIX/lib/ccp4-5.99.5/$soname $verstring'
       else
-          archive_cmds_CXX='$CC -r -keep_private_externs -nostdlib -o ${lib}-master.o $libobjs~$CC -dynamiclib $allow_undefined_flag -o $lib ${lib}-master.o $deplibs $compiler_flags -install_name $rpath/$soname $verstring'
+          archive_cmds_CXX='$CC -r -keep_private_externs -nostdlib -o ${lib}-master.o $libobjs~$CC -dynamiclib $allow_undefined_flag -o $lib ${lib}-master.o $deplibs $compiler_flags -install_name SW_PREFIX/lib/ccp4-5.99.5/$soname $verstring'
         fi
         module_cmds_CXX='$CC $allow_undefined_flag -o $lib -bundle $libobjs $deplibs$compiler_flags'
         # Don't fix this by using the ld -exported_symbols_list flag, it doesn't exist in older darwin lds
           if test "X$lt_int_apple_cc_single_mod" = Xyes ; then
-            archive_expsym_cmds_CXX='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC -dynamiclib -single_module $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags -install_name $rpath/$soname $verstring~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
+            archive_expsym_cmds_CXX='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC -dynamiclib -single_module $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags -install_name SW_PREFIX/lib/ccp4-5.99.5/$soname $verstring~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
           else
-            archive_expsym_cmds_CXX='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC -r -keep_private_externs -nostdlib -o ${lib}-master.o $libobjs~$CC -dynamiclib $allow_undefined_flag -o $lib ${lib}-master.o $deplibs $compiler_flags -install_name $rpath/$soname $verstring~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
+            archive_expsym_cmds_CXX='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC -r -keep_private_externs -nostdlib -o ${lib}-master.o $libobjs~$CC -dynamiclib $allow_undefined_flag -o $lib ${lib}-master.o $deplibs $compiler_flags -install_name SW_PREFIX/lib/ccp4-5.99.5/$soname $verstring~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
           fi
             module_expsym_cmds_CXX='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC $allow_undefined_flag  -o $lib -bundle $libobjs $deplibs$compiler_flags~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
       else
       case $cc_basename in
         xlc*)
          output_verbose_link_cmd='echo'
-          archive_cmds_CXX='$CC -qmkshrobj ${wl}-single_module $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-install_name ${wl}`echo $rpath/$soname` $verstring'
+          archive_cmds_CXX='$CC -qmkshrobj ${wl}-single_module $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-install_name ${wl}`echo SW_PREFIX/lib/ccp4-5.99.5/$soname` $verstring'
           module_cmds_CXX='$CC $allow_undefined_flag -o $lib -bundle $libobjs $deplibs$compiler_flags'
           # Don't fix this by using the ld -exported_symbols_list flag, it doesn't exist in older darwin lds
-          archive_expsym_cmds_CXX='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC -qmkshrobj ${wl}-single_module $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-install_name ${wl}$rpath/$soname $verstring~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
+          archive_expsym_cmds_CXX='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC -qmkshrobj ${wl}-single_module $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-install_name ${wl}SW_PREFIX/lib/ccp4-5.99.5/$soname $verstring~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
           module_expsym_cmds_CXX='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC $allow_undefined_flag  -o $lib -bundle $libobjs $deplibs$compiler_flags~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
           ;;
        *)
@@ -15483,27 +15483,27 @@
       link_all_deplibs_F77=yes
     if test "$GCC" = yes ; then
     	output_verbose_link_cmd='echo'
-        archive_cmds_F77='$CC -dynamiclib $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags -install_name $rpath/$soname $verstring'
+        archive_cmds_F77='$CC -dynamiclib $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags -install_name SW_PREFIX/lib/ccp4-5.99.5/$soname $verstring'
       module_cmds_F77='$CC $allow_undefined_flag -o $lib -bundle $libobjs $deplibs$compiler_flags'
       # Don't fix this by using the ld -exported_symbols_list flag, it doesn't exist in older darwin lds
-      archive_expsym_cmds_F77='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC -dynamiclib $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags -install_name $rpath/$soname $verstring~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
+      archive_expsym_cmds_F77='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC -dynamiclib $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags -install_name SW_PREFIX/lib/ccp4-5.99.5/$soname $verstring~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
       module_expsym_cmds_F77='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC $allow_undefined_flag  -o $lib -bundle $libobjs $deplibs$compiler_flags~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
     else
       case $cc_basename in
         xlc* )
          output_verbose_link_cmd='echo'
-         archive_cmds_F77='$CC -qmkshrobj $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-install_name ${wl}`echo $rpath/$soname` $verstring'
+         archive_cmds_F77='$CC -qmkshrobj $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-install_name ${wl}`echo SW_PREFIX/lib/ccp4-5.99.5/$soname` $verstring'
          module_cmds_F77='$CC $allow_undefined_flag -o $lib -bundle $libobjs $deplibs$compiler_flags'
           # Don't fix this by using the ld -exported_symbols_list flag, it doesn't exist in older darwin lds
-         archive_expsym_cmds_F77='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC -qmkshrobj $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-install_name ${wl}$rpath/$soname $verstring~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
+         archive_expsym_cmds_F77='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC -qmkshrobj $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-install_name ${wl}SW_PREFIX/lib/ccp4-5.99.5/$soname $verstring~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
           module_expsym_cmds_F77='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC $allow_undefined_flag  -o $lib -bundle $libobjs $deplibs$compiler_flags~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
           ;;
         xlf* )
          output_verbose_link_cmd='echo'
-         archive_cmds_F77='$CC -qmkshrobj $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-dylib_install_name ${wl}`echo $rpath/$soname` $verstring'
+         archive_cmds_F77='$CC -qmkshrobj $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-dylib_install_name ${wl}`echo SW_PREFIX/lib/ccp4-5.99.5/$soname` $verstring'
          module_cmds_F77='$CC $allow_undefined_flag -o $lib -bundle $libobjs $deplibs$compiler_flags'
           # Don't fix this by using the ld -exported_symbols_list flag, it doesn't exist in older darwin lds
-         archive_expsym_cmds_F77='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC -qmkshrobj $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-dylib_install_name ${wl}$rpath/$soname $verstring~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
+         archive_expsym_cmds_F77='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC -qmkshrobj $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-dylib_install_name ${wl}SW_PREFIX/lib/ccp4-5.99.5/$soname $verstring~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
           module_expsym_cmds_F77='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC $allow_undefined_flag  -o $lib -bundle $libobjs $deplibs$compiler_flags~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
           ;;
        *)
@@ -17987,27 +17987,27 @@
       link_all_deplibs_GCJ=yes
     if test "$GCC" = yes ; then
     	output_verbose_link_cmd='echo'
-        archive_cmds_GCJ='$CC -dynamiclib $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags -install_name $rpath/$soname $verstring'
+        archive_cmds_GCJ='$CC -dynamiclib $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags -install_name SW_PREFIX/lib/ccp4-5.99.5/$soname $verstring'
       module_cmds_GCJ='$CC $allow_undefined_flag -o $lib -bundle $libobjs $deplibs$compiler_flags'
       # Don't fix this by using the ld -exported_symbols_list flag, it doesn't exist in older darwin lds
-      archive_expsym_cmds_GCJ='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC -dynamiclib $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags -install_name $rpath/$soname $verstring~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
+      archive_expsym_cmds_GCJ='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC -dynamiclib $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags -install_name SW_PREFIX/lib/ccp4-5.99.5/$soname $verstring~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
       module_expsym_cmds_GCJ='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC $allow_undefined_flag  -o $lib -bundle $libobjs $deplibs$compiler_flags~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
     else
       case $cc_basename in
         xlc* )
          output_verbose_link_cmd='echo'
-         archive_cmds_GCJ='$CC -qmkshrobj $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-install_name ${wl}`echo $rpath/$soname` $verstring'
+         archive_cmds_GCJ='$CC -qmkshrobj $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-install_name ${wl}`echo SW_PREFIX/lib/ccp4-5.99.5/$soname` $verstring'
          module_cmds_GCJ='$CC $allow_undefined_flag -o $lib -bundle $libobjs $deplibs$compiler_flags'
           # Don't fix this by using the ld -exported_symbols_list flag, it doesn't exist in older darwin lds
-         archive_expsym_cmds_GCJ='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC -qmkshrobj $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-install_name ${wl}$rpath/$soname $verstring~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
+         archive_expsym_cmds_GCJ='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC -qmkshrobj $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-install_name ${wl}SW_PREFIX/lib/ccp4-5.99.5/$soname $verstring~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
           module_expsym_cmds_GCJ='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC $allow_undefined_flag  -o $lib -bundle $libobjs $deplibs$compiler_flags~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
           ;;
         xlf* )
          output_verbose_link_cmd='echo'
-         archive_cmds_GCJ='$CC -qmkshrobj $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-dylib_install_name ${wl}`echo $rpath/$soname` $verstring'
+         archive_cmds_GCJ='$CC -qmkshrobj $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-dylib_install_name ${wl}`echo SW_PREFIX/lib/ccp4-5.99.5/$soname` $verstring'
          module_cmds_GCJ='$CC $allow_undefined_flag -o $lib -bundle $libobjs $deplibs$compiler_flags'
           # Don't fix this by using the ld -exported_symbols_list flag, it doesn't exist in older darwin lds
-         archive_expsym_cmds_GCJ='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC -qmkshrobj $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-dylib_install_name ${wl}$rpath/$soname $verstring~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
+         archive_expsym_cmds_GCJ='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC -qmkshrobj $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-dylib_install_name ${wl}SW_PREFIX/lib/ccp4-5.99.5/$soname $verstring~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
           module_expsym_cmds_GCJ='sed -e "s,#.*,," -e "s,^[    ]*,," -e "s,^\(..*\),_&," < $export_symbols > $output_objdir/${libname}-symbols.expsym~$CC $allow_undefined_flag  -o $lib -bundle $libobjs $deplibs$compiler_flags~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
           ;;
        *)
