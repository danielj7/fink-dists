diff -ru gnumeric-1.4.0.orig/src/tools/solver/lp_solve/commonlib.c gnumeric-1.4.0/src/tools/solver/lp_solve/commonlib.c
--- gnumeric-1.4.0.orig/src/tools/solver/lp_solve/commonlib.c	2004-07-22 21:36:42.000000000 -0700
+++ gnumeric-1.4.0/src/tools/solver/lp_solve/commonlib.c	2004-12-05 13:34:56.000000000 -0800
@@ -4,7 +4,7 @@
 #ifdef INTEGERTIME
 # include <time.h>
 #else
-# include <sys/timeb.h>
+# include <sys/time.h>
 #endif
 
 #include <stdlib.h>
@@ -282,10 +282,11 @@
 #elif defined CLOCKTIME
   return((double)clock()/CLOCKS_PER_SEC /* CLK_TCK */);
 #else
-  struct timeb buf;
+  struct timeval buf;
+  struct timezone tzbuf;
 
-  ftime(&buf);
-  return((double)buf.time+((double) buf.millitm)/1000.0);
+  gettimeofday(&buf,&tzbuf);
+  return((double)buf.tv_sec+((double) buf.tv_usec)/1000000.0);
 #endif
 }
 
diff -ru gnumeric-1.4.0.orig/src/tools/solver/lp_solve/commonlib.h gnumeric-1.4.0/src/tools/solver/lp_solve/commonlib.h
--- gnumeric-1.4.0.orig/src/tools/solver/lp_solve/commonlib.h	2004-07-22 21:38:08.000000000 -0700
+++ gnumeric-1.4.0/src/tools/solver/lp_solve/commonlib.h	2004-12-05 13:35:36.000000000 -0800
@@ -3,7 +3,6 @@
 
 #include <stdlib.h>
 #include <stdio.h>
-#include <malloc.h>
 
 #define BIGNUMBER    1.0e+30
 #define TINYNUMBER   1.0e-4
diff -ru gnumeric-1.4.0.orig/src/tools/solver/lp_solve/fortify.c gnumeric-1.4.0/src/tools/solver/lp_solve/fortify.c
--- gnumeric-1.4.0.orig/src/tools/solver/lp_solve/fortify.c	2004-07-22 21:36:42.000000000 -0700
+++ gnumeric-1.4.0/src/tools/solver/lp_solve/fortify.c	2004-12-05 13:36:14.000000000 -0800
@@ -20,7 +20,6 @@
 
 #include <stdio.h>
 #include <stdlib.h>
-#include <malloc.h>
 
 #if defined FORTIFY
 
diff -ru gnumeric-1.4.0.orig/src/tools/solver/lp_solve/lp_Hash.c gnumeric-1.4.0/src/tools/solver/lp_solve/lp_Hash.c
--- gnumeric-1.4.0.orig/src/tools/solver/lp_solve/lp_Hash.c	2004-07-22 21:36:42.000000000 -0700
+++ gnumeric-1.4.0/src/tools/solver/lp_solve/lp_Hash.c	2004-12-05 13:36:47.000000000 -0800
@@ -1,5 +1,4 @@
 
-#include <malloc.h>
 #include <string.h>
 #include "lp_lib.h"
 #include "lp_utils.h"
diff -ru gnumeric-1.4.0.orig/src/tools/solver/lp_solve/lp_etaPFI.c gnumeric-1.4.0/src/tools/solver/lp_solve/lp_etaPFI.c
--- gnumeric-1.4.0.orig/src/tools/solver/lp_solve/lp_etaPFI.c	2004-07-22 21:36:42.000000000 -0700
+++ gnumeric-1.4.0/src/tools/solver/lp_solve/lp_etaPFI.c	2004-12-05 13:44:45.000000000 -0800
@@ -26,7 +26,6 @@
 */
 
 #include <stdlib.h>
-#include <malloc.h>
 
 #include "lp_lib.h"
 #include "commonlib.h"
diff -ru gnumeric-1.4.0.orig/src/tools/solver/lp_solve/lp_lib.h gnumeric-1.4.0/src/tools/solver/lp_solve/lp_lib.h
--- gnumeric-1.4.0.orig/src/tools/solver/lp_solve/lp_lib.h	2004-11-04 08:52:25.000000000 -0800
+++ gnumeric-1.4.0/src/tools/solver/lp_solve/lp_lib.h	2004-12-05 13:45:11.000000000 -0800
@@ -179,7 +179,6 @@
 #include <sys/types.h>
 #include <stdio.h>
 #include <stdlib.h>
-#include <malloc.h>
 #include <math.h>
 
 #if (LoadInverseLib==TRUE) || (LoadLanguageLib == TRUE)
diff -ru gnumeric-1.4.0.orig/src/tools/solver/lp_solve/lp_rlp.c gnumeric-1.4.0/src/tools/solver/lp_solve/lp_rlp.c
--- gnumeric-1.4.0.orig/src/tools/solver/lp_solve/lp_rlp.c	2004-07-22 21:50:23.000000000 -0700
+++ gnumeric-1.4.0/src/tools/solver/lp_solve/lp_rlp.c	2004-12-05 13:47:03.000000000 -0800
@@ -348,15 +348,8 @@
 /* This used to test MSDOS, but that is a bad idea
    since that symbol is in the user namespace.  */
 #if (defined (_MSDOS) || defined (_MSDOS_)) && !defined (__TURBOC__)
-#if 0 /* No need for malloc.h, which pollutes the namespace;
-	 instead, just don't use alloca.  */
-#include <malloc.h>
-#endif
 #else /* not MSDOS, or __TURBOC__ */
 #if defined(_AIX)
-/* I don't know what this was needed for, but it pollutes the namespace.
-   So I turned it off.   rms, 2 May 1997.  */
-/* #include <malloc.h>  */
  #pragma alloca
 #define YYSTACK_USE_ALLOCA
 #else /* not MSDOS, or __TURBOC__, or _AIX */
diff -ru gnumeric-1.4.0.orig/src/tools/solver/lp_solve/lp_rlpt.c gnumeric-1.4.0/src/tools/solver/lp_solve/lp_rlpt.c
--- gnumeric-1.4.0.orig/src/tools/solver/lp_solve/lp_rlpt.c	2004-07-22 21:36:42.000000000 -0700
+++ gnumeric-1.4.0/src/tools/solver/lp_solve/lp_rlpt.c	2004-12-05 13:50:34.000000000 -0800
@@ -352,15 +352,8 @@
 /* This used to test MSDOS, but that is a bad idea
    since that symbol is in the user namespace.  */
 #if (defined (_MSDOS) || defined (_MSDOS_)) && !defined (__TURBOC__)
-#if 0 /* No need for malloc.h, which pollutes the namespace;
-	 instead, just don't use alloca.  */
-#include <malloc.h>
-#endif
 #else /* not MSDOS, or __TURBOC__ */
 #if defined(_AIX)
-/* I don't know what this was needed for, but it pollutes the namespace.
-   So I turned it off.   rms, 2 May 1997.  */
-/* #include <malloc.h>  */
  #pragma alloca
 #define YYSTACK_USE_ALLOCA
 #else /* not MSDOS, or __TURBOC__, or _AIX */
