Package: synfig
# 0.64.1 builds, but crashes when loading the 'walk' example.
# However, it has fixed magick++ detection
Version: 0.64.0
Revision: 2
Description: Vector-based 2D animation renderer
License: GPL
Maintainer: None <fink-devel@lists.sourceforge.net>

Depends: <<
	%N-shlibs (= %v-%r),
	boost1.55-nopython-shlibs,
	cairo-shlibs (>= 1.12.14-1),
	glib2-shlibs (>= 2.22.0-1),
	glibmm2.4-shlibs (>= 2.22.0-1),
	libgettext8-shlibs,
	libsigc++2-shlibs (>= 2.2.4.2-2),
	libtool2-shlibs,
	libxml++2-shlibs (>= 2.26.1-2),
	libxml2-shlibs (>= 2.9.1-2),
	pango1-xft2-ft219-shlibs (>= 1.24.5-7)
<<
BuildDepends: <<
	autoconf2.6,
	automake1.13,
	boost1.55-nopython,
	cairo (>= 1.12.14-1),
	etl (>= 0.04.16-1),
	fink-package-precedence,
	fontconfig2-dev (>= 2.10.0-1),
	freetype219 (>= 2.4.11-1),
	gettext-tools,
	glib2-dev (>= 2.22.0-1),
	glibmm2.4-dev (>= 2.22.0-1),
	ilmbase,
	imagemagick7-dev,
	libgettext8-dev,
	libiconv-dev (>= 1.12-3),
	libjpeg9,
	libmng2,
	libopenexr6,
	libpng16,
	libsigc++2 (>= 2.2.4.2-2),
	libtool2,
	libxml++2 (>= 2.26.1-2),
	libxml2 (>= 2.6.32-1),
	pango1-xft2-ft219-dev (>= 1.24.5-7),
	pkgconfig (>= 0.23-2)
<<
Source: mirror:sourceforge:synfig/synfig-%v.tar.gz
Source-MD5: 124cb4059b9f48dc5c37204660053d6f
Source-Checksum: SHA1(b33a4b4eeb957aa141df156ebf9e397fe4bf1503)

PatchFile: %n.patch
PatchFile-MD5: e9d51c15dcbf6054d05e247345254f2e
PatchScript: <<
	%{default_script}
	## turn off avcodec module
 	perl -ni -e 'print unless /mod_libavcodec/' src/modules/synfig_modules.cfg.in

	### pass MAGICKPP_LIBS to configure
	perl -pi -e "s|\@FINK_MAGICKPP_LIBS\@|`%p/bin/magick++-config --libs`|g" configure.ac
<<

# from Magick++-config --cppflags
SetCPPFLAGS: -I%p/include/ImageMagick -DMAGICKCORE_HDRI_ENABLE=1 -DMAGICKCORE_QUANTUM_DEPTH=16 -I%p/include/libxml2
SetLDFLAGS: -lxml2
ConfigureParams: <<
	--with-ffmpeg \
	--without-libavcodec \
	--without-libswscale \
	--enable-dependency-tracking \
	--with-boost=%p/opt/boost-1_55 \
	--with-boost-program-options=boost_program_options-1_55
<<
GCC: 4.0
CompileScript: <<
#!/bin/sh -ev
	autoreconf -if
	./configure %c
	make
	fink-package-precedence --prohibit-bdep=%N-dev .
<<

InstallScript: <<
#	find %d -name "*.la" -exec perl -pi.bak -e 's| .*root-%f.* | |g' {} \;
	make install prefix=%i
	mkdir -p %i/share/doc/%n/examples/walk
	install -p -m644 examples/*.sifz %i/share/doc/%n/examples
	install -p -m644 examples/walk/*.lst %i/share/doc/%n/examples/walk
	install -p -m644 examples/walk/*.jpg %i/share/doc/%n/examples/walk
	install -p -m644 examples/walk/*.sifz %i/share/doc/%n/examples/walk
<<

SplitOff: <<
	Package: %N-shlibs
	Depends: <<
		cairo-shlibs (>= 1.12.14-1),
		fontconfig2-shlibs (>= 2.10.0-1),
		freetype219-shlibs (>= 2.4.11-1),
		glib2-shlibs (>= 2.22.0-1),
		glibmm2.4-shlibs (>= 2.22.0-1),
		ilmbase-shlibs,
		imagemagick7-shlibs,
		libgettext8-shlibs,
		libjpeg9-shlibs,
		libmng2-shlibs,
		libopenexr6-shlibs,
		libpng16-shlibs,
		libsigc++2-shlibs (>=2.2.3-1),
		libtool2-shlibs,
		libxml++2-shlibs (>= 2.26.1-2),
		libxml2-shlibs (>= 2.9.1-1),
		pango1-xft2-ft219-shlibs (>= 1.24.5-7)
	<<
	Files: lib/libsynfig.0.dylib lib/synfig
	# move share/locale from %N? (rename with libmajorversion?)
	DocFiles: AUTHORS COPYING INSTALL NEWS README
	Shlibs: %p/lib/libsynfig.0.dylib 1.0.0 %n (>= 0.63.00-1)
<<

SplitOff2: <<
	Package: %N-dev
	Depends: %N-shlibs (= %v-%r)
	Replaces: %N (<< 0.62.02-1), %N-shlibs (<< 0.62.00-1)
	Files: <<
		bin/synfig-config
		include
		lib
	<<
	DocFiles: AUTHORS COPYING INSTALL NEWS README
	BuildDependsOnly: true
<<

DocFiles: AUTHORS COPYING INSTALL NEWS README
Homepage: http://synfig.org/
DescDetail: <<
synfig is a vector based 2D animation renderer. It is designed to be capable of
producing feature-film quality animation.

This package contains the command-line renderer, the GUI animation editor is in
synfigstudio.
<<
DescPackaging: <<
	Disable libavcodec because it's a newer version in fink
	incompatible with synfig. See:
	http://synfig.org/forums/viewtopic.php?f=13&t=5
	Older libavcodec has no .pc so synfig doesn't even find it.

	Remove libavcodec from config file (list of active mods)
	because it won't exist (silences runtime warnings). Why isn't
	this list auto-generated during pkg build process?

	Doesn't use Magick's native flag detector:
		Need to pass -I globally so that configure finds it.

	Main ImageMagick lib is now MagickCore not Magick.
	http://www.synfig.org/issues/thebuggenie/synfig/issues/56

	Links magick libs and also uses magick's "convert" program.

	Major shuffling of package layout for pangocairo and shlibs
	policy as of 0.61.08-1001, and then again as of 0.61.09-3
<<
