From 073fd99150b8370fea129672752794a7d15140a4 Mon Sep 17 00:00:00 2001
From: JJ Allaire <jj@rstudio.org>
Date: Sat, 25 Apr 2015 07:36:17 -0400
Subject: [PATCH] fix compilation errors that occur as a result of GCC concept
 checks

---
 NEWS.md                                 |  2 ++
 src/cpp/core/include/core/json/Json.hpp | 11 +++++++++++
 2 files changed, 13 insertions(+)

diff --git a/src/cpp/core/include/core/json/Json.hpp b/src/cpp/core/include/core/json/Json.hpp
index add2c54..68022c9 100644
--- a/src/cpp/core/include/core/json/Json.hpp
+++ b/src/cpp/core/include/core/json/Json.hpp
@@ -154,6 +154,17 @@ json::Value toJsonValue(const T& val)
 
 json::Value toJsonString(const std::string& val);
 
+// NOTE: we can't use the templatized version for bool because
+// some compilers specialize std::vector<bool> such that the
+// concept check for std::copy fails
+inline json::Array toJsonArray(const std::vector<bool>& val)
+{
+   json::Array results;
+   for (size_t i=0; i<val.size(); i++)
+      results.push_back(val[i] ? true : false);
+   return results;
+}
+
 template<typename T>
 json::Array toJsonArray(const std::vector<T>& val)
 {
From c50b3b3f07e574d4b8a0d84236700d5b91ac9d49 Mon Sep 17 00:00:00 2001
From: JJ Allaire <jj@rstudio.org>
Date: Fri, 24 Apr 2015 21:07:42 -0400
Subject: [PATCH] read file into buffer before calling std::search

---
 src/cpp/session/modules/SessionHTMLPreview.cpp | 15 ++++++++++-----
 1 file changed, 10 insertions(+), 5 deletions(-)

diff --git a/src/cpp/session/modules/SessionHTMLPreview.cpp b/src/cpp/session/modules/SessionHTMLPreview.cpp
index 777ad40..ac37d19 100644
--- a/src/cpp/session/modules/SessionHTMLPreview.cpp
+++ b/src/cpp/session/modules/SessionHTMLPreview.cpp
@@ -551,12 +551,17 @@ bool okToGenerateFile(const FilePath& rmdPath,
          return false;
       }
 
+      // copy the file's contents
+      std::vector<char> contents;
+      std::copy(std::istream_iterator<char>(*pStr),
+                std::istream_iterator<char>(),
+                std::back_inserter(contents));
+
       std::string magicGuid(MAGIC_GUID);
-      std::istreambuf_iterator<char> eod;
-      if (eod == std::search(std::istreambuf_iterator<char>(*pStr),
-                             eod,
-                             magicGuid.begin(),
-                             magicGuid.end()))
+      if (contents.end() == std::search(contents.begin(),
+                                        contents.end(),
+                                        magicGuid.begin(),
+                                        magicGuid.end()))
       {
          *pErrMsg = "Unable to generate the file '" +
                     filePath.filename() + "' because it already "
