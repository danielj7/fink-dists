diff -uNbr postgresql-7.2.1/src/Makefile.global.in postgresql-7.2.1-new/src/Makefile.global.in
--- postgresql-7.2.1/src/Makefile.global.in	2001-12-20 16:23:05.000000000 -0500
+++ postgresql-7.2.1-new/src/Makefile.global.in	2002-07-27 19:25:17.000000000 -0500
@@ -94,6 +94,7 @@
 override pkgincludedir := $(pkgincludedir)/postgresql
 endif
 endif
+includedir = $(pkgincludedir)
 includedir_server = $(pkgincludedir)/server
 includedir_internal = $(pkgincludedir)/internal
 
diff -uNbr postgresql-7.2.1/src/Makefile.shlib postgresql-7.2.1-new/src/Makefile.shlib
--- postgresql-7.2.1/src/Makefile.shlib	2001-11-11 14:20:53.000000000 -0500
+++ postgresql-7.2.1-new/src/Makefile.shlib	2002-07-27 19:25:17.000000000 -0500
@@ -112,8 +112,9 @@
 endif
 
 ifeq ($(PORTNAME), darwin)
-  shlib			:= lib$(NAME)$(DLSUFFIX).$(SO_MAJOR_VERSION).$(SO_MINOR_VERSION)
+  shlib			:= lib$(NAME).$(SO_MAJOR_VERSION).$(SO_MINOR_VERSION)$(DLSUFFIX)
   LINK.shared		= $(COMPILER) $(DARWIN_NAMESPACE_SPEC) -bundle -undefined suppress
+  SHLIB_LINK		:= -L$(libpq_builddir) $(SHLIB_LINK)
 endif
 
 ifeq ($(PORTNAME), openbsd)
@@ -305,9 +306,9 @@
 $(shlib): $(OBJS)
 	$(LINK.shared) $(OBJS) $(SHLIB_LINK) -o $@
 # If we're using major and minor versions, then make a symlink to major-version-only.
-ifneq ($(shlib), lib$(NAME)$(DLSUFFIX).$(SO_MAJOR_VERSION))
-	rm -f lib$(NAME)$(DLSUFFIX).$(SO_MAJOR_VERSION)
-	$(LN_S) $(shlib) lib$(NAME)$(DLSUFFIX).$(SO_MAJOR_VERSION)
+ifneq ($(shlib), lib$(NAME).$(SO_MAJOR_VERSION)$(DLSUFFIX))
+	rm -f lib$(NAME).$(SO_MAJOR_VERSION)$(DLSUFFIX)
+	$(LN_S) $(shlib) lib$(NAME).$(SO_MAJOR_VERSION)$(DLSUFFIX)
 endif
 # Make sure we have a link to a name without any version numbers
 ifneq ($(shlib), lib$(NAME)$(DLSUFFIX))
@@ -363,10 +364,10 @@
 install-lib-shared: $(shlib)
 	$(INSTALL_SHLIB) $< $(DESTDIR)$(libdir)/$(shlib)
 ifneq ($(PORTNAME), win)
-ifneq ($(shlib), lib$(NAME)$(DLSUFFIX).$(SO_MAJOR_VERSION))
+ifneq ($(shlib), lib$(NAME).$(SO_MAJOR_VERSION)$(DLSUFFIX))
 	cd $(DESTDIR)$(libdir) && \
-	rm -f lib$(NAME)$(DLSUFFIX).$(SO_MAJOR_VERSION) && \
-	$(LN_S) $(shlib) lib$(NAME)$(DLSUFFIX).$(SO_MAJOR_VERSION)
+	rm -f lib$(NAME).$(SO_MAJOR_VERSION)$(DLSUFFIX) && \
+	$(LN_S) $(shlib) lib$(NAME).$(SO_MAJOR_VERSION)$(DLSUFFIX)
 endif
 ifneq ($(shlib), lib$(NAME)$(DLSUFFIX))
 	cd $(DESTDIR)$(libdir) && \
diff -uNbr postgresql-7.2.1/src/backend/port/Makefile.in postgresql-7.2.1-new/src/backend/port/Makefile.in
--- postgresql-7.2.1/src/backend/port/Makefile.in	2001-12-20 16:23:05.000000000 -0500
+++ postgresql-7.2.1-new/src/backend/port/Makefile.in	2002-07-27 19:25:57.000000000 -0500
@@ -34,8 +34,10 @@
 OBJS += beos/SUBSYS.o
 endif
 ifeq ($(PORTNAME), darwin)
+ifneq ($(host_os), darwin6.0)
 OBJS += darwin/SUBSYS.o
 endif
+endif
 
 all: SUBSYS.o
 
diff -uNbr postgresql-7.2.1/src/backend/storage/ipc/ipc.c postgresql-7.2.1-new/src/backend/storage/ipc/ipc.c
--- postgresql-7.2.1/src/backend/storage/ipc/ipc.c	2001-11-05 12:46:28.000000000 -0500
+++ postgresql-7.2.1-new/src/backend/storage/ipc/ipc.c	2002-07-27 19:39:57.000000000 -0500
@@ -45,8 +45,10 @@
 #endif
 
 #if defined(__darwin__)
+#if __GNUC__ < 3
 #include "port/darwin/sem.h"
 #endif
+#endif
 
 #include "miscadmin.h"
 #include "utils/memutils.h"
diff -uNbr postgresql-7.2.1/src/backend/storage/lmgr/proc.c postgresql-7.2.1-new/src/backend/storage/lmgr/proc.c
--- postgresql-7.2.1/src/backend/storage/lmgr/proc.c	2001-12-28 13:16:43.000000000 -0500
+++ postgresql-7.2.1-new/src/backend/storage/lmgr/proc.c	2002-07-27 19:40:35.000000000 -0500
@@ -58,8 +58,10 @@
 #endif
 
 #if defined(__darwin__)
+#if __GNUC__ < 3
 #include "port/darwin/sem.h"
 #endif
+#endif
 
 #include "miscadmin.h"
 #include "access/xact.h"
diff -uNbr postgresql-7.2.1/src/backend/storage/lmgr/spin.c postgresql-7.2.1-new/src/backend/storage/lmgr/spin.c
--- postgresql-7.2.1/src/backend/storage/lmgr/spin.c	2001-11-05 12:46:28.000000000 -0500
+++ postgresql-7.2.1-new/src/backend/storage/lmgr/spin.c	2002-07-27 19:41:37.000000000 -0500
@@ -30,8 +30,10 @@
 #endif
 
 #if defined(__darwin__)
+#if __GNUC__ < 3
 #include "port/darwin/sem.h"
 #endif
+#endif
 
 #include "storage/lwlock.h"
 #include "storage/proc.h"
diff -uNbr postgresql-7.2.1/src/backend/utils/misc/guc.c postgresql-7.2.1-new/src/backend/utils/misc/guc.c
--- postgresql-7.2.1/src/backend/utils/misc/guc.c	2001-10-30 00:38:56.000000000 -0500
+++ postgresql-7.2.1-new/src/backend/utils/misc/guc.c	2002-07-27 19:25:17.000000000 -0500
@@ -576,12 +576,12 @@
 
 	{
 		"unix_socket_group", PGC_POSTMASTER, &Unix_socket_group,
-		"", NULL, NULL
+		"pgsql", NULL, NULL
 	},
 
 	{
 		"unix_socket_directory", PGC_POSTMASTER, &UnixSocketDir,
-		"", NULL, NULL
+		"/tmp", NULL, NULL
 	},
 
 	{
diff -uNbr postgresql-7.2.1/src/backend/utils/misc/postgresql.conf.sample postgresql-7.2.1-new/src/backend/utils/misc/postgresql.conf.sample
--- postgresql-7.2.1/src/backend/utils/misc/postgresql.conf.sample	2002-01-04 00:50:25.000000000 -0500
+++ postgresql-7.2.1-new/src/backend/utils/misc/postgresql.conf.sample	2002-07-27 19:25:17.000000000 -0500
@@ -23,17 +23,17 @@
 #
 #	Connection Parameters
 #
-#tcpip_socket = false
-#ssl = false
+tcpip_socket = true
+ssl = false
 
-#max_connections = 32
+max_connections = 32
 
 #port = 5432 
 #hostname_lookup = false
 #show_source_port = false
 
-#unix_socket_directory = ''
-#unix_socket_group = ''
+unix_socket_directory = '/tmp'
+unix_socket_group = 'pgsql'
 #unix_socket_permissions = 0777
 
 #virtual_host = ''
diff -uNbr postgresql-7.2.1/src/bin/initdb/initdb.sh postgresql-7.2.1-new/src/bin/initdb/initdb.sh
--- postgresql-7.2.1/src/bin/initdb/initdb.sh	2001-11-25 17:19:30.000000000 -0500
+++ postgresql-7.2.1-new/src/bin/initdb/initdb.sh	2002-07-27 20:01:38.000000000 -0500
@@ -873,11 +873,8 @@
 echo
 echo "Success. You can now start the database server using:"
 echo ""
-echo "    $PGPATH/postmaster -D $PGDATA"
-echo "or"
-# (Advertise -l option here, otherwise we have a background
-#  process writing to the terminal.)
-echo "    $PGPATH/pg_ctl -D $PGDATA -l logfile start"
-echo
+echo "    sudo -u root sudo -u pgsql $PGPATH/pg_ctl \\"
+echo "        -D $PGDATA -l /sw/var/log/postgresql/logfile start"
+echo ""
 
 exit 0
diff -uNbr postgresql-7.2.1/src/bin/pg_ctl/pg_ctl.sh postgresql-7.2.1-new/src/bin/pg_ctl/pg_ctl.sh
--- postgresql-7.2.1/src/bin/pg_ctl/pg_ctl.sh	2001-09-28 22:09:32.000000000 -0500
+++ postgresql-7.2.1-new/src/bin/pg_ctl/pg_ctl.sh	2002-07-27 19:25:17.000000000 -0500
@@ -14,6 +14,10 @@
 
 CMDNAME=`basename $0`
 
+ulimit -d 24000
+ulimit -n 512
+ulimit -s 4096
+
 help="\
 $CMDNAME is a utility to start, stop, restart, reload configuration files,
 or report the status of a PostgreSQL server.
diff -uNbr postgresql-7.2.1/src/interfaces/ecpg/lib/Makefile postgresql-7.2.1-new/src/interfaces/ecpg/lib/Makefile
--- postgresql-7.2.1/src/interfaces/ecpg/lib/Makefile	2002-01-08 15:41:26.000000000 -0500
+++ postgresql-7.2.1-new/src/interfaces/ecpg/lib/Makefile	2002-07-27 19:25:17.000000000 -0500
@@ -17,7 +17,7 @@
 SO_MINOR_VERSION= 3.0
 
 override CPPFLAGS := -I$(top_srcdir)/src/interfaces/ecpg/include -I$(libpq_srcdir) $(CPPFLAGS)
-
+override LDFLAGS := -L$(libpq_builddir) $(LDFLAGS)
 
 OBJS= execute.o typename.o descriptor.o data.o error.o prepare.o memory.o \
 	connect.o misc.o
diff -uNbr postgresql-7.2.1/src/interfaces/libpgeasy/Makefile postgresql-7.2.1-new/src/interfaces/libpgeasy/Makefile
--- postgresql-7.2.1/src/interfaces/libpgeasy/Makefile	2001-05-10 20:46:33.000000000 -0500
+++ postgresql-7.2.1-new/src/interfaces/libpgeasy/Makefile	2002-07-27 19:25:17.000000000 -0500
@@ -17,6 +17,7 @@
 SO_MINOR_VERSION= 2
 
 override CPPFLAGS := -I$(libpq_srcdir) $(CPPFLAGS)
+override LDFLAGS := -L$(libpq_builddir) $(LDFLAGS)
 
 OBJS= libpgeasy.o halt.o
 
diff -uNbr postgresql-7.2.1/src/interfaces/libpgtcl/Makefile postgresql-7.2.1-new/src/interfaces/libpgtcl/Makefile
--- postgresql-7.2.1/src/interfaces/libpgtcl/Makefile	2001-05-10 20:46:33.000000000 -0500
+++ postgresql-7.2.1-new/src/interfaces/libpgtcl/Makefile	2002-07-27 19:25:17.000000000 -0500
@@ -17,6 +17,7 @@
 SO_MINOR_VERSION= 2
 
 override CPPFLAGS := -I$(libpq_srcdir) $(CPPFLAGS)
+override LDFLAGS := -L$(libpq_builddir) $(LDFLAGS)
 
 OBJS= pgtcl.o pgtclCmds.o pgtclId.o
 
diff -uNbr postgresql-7.2.1/src/interfaces/libpq++/Makefile postgresql-7.2.1-new/src/interfaces/libpq++/Makefile
--- postgresql-7.2.1/src/interfaces/libpq++/Makefile	2001-05-22 06:24:28.000000000 -0500
+++ postgresql-7.2.1-new/src/interfaces/libpq++/Makefile	2002-07-27 19:25:17.000000000 -0500
@@ -17,6 +17,7 @@
 SO_MINOR_VERSION= 0
 
 override CPPFLAGS := -I$(libpq_srcdir) $(CPPFLAGS)
+override LDFLAGS := -L$(libpq_builddir) $(LDFLAGS)
 
 OBJS = pgconnection.o pgdatabase.o pgtransdb.o pgcursordb.o pglobject.o 
 
diff -uNbr postgresql-7.2.1/src/interfaces/perl5/GNUmakefile postgresql-7.2.1-new/src/interfaces/perl5/GNUmakefile
--- postgresql-7.2.1/src/interfaces/perl5/GNUmakefile	2001-08-26 17:28:04.000000000 -0500
+++ postgresql-7.2.1-new/src/interfaces/perl5/GNUmakefile	2002-07-27 19:25:17.000000000 -0500
@@ -12,14 +12,9 @@
 
 .NOTPARALLEL:
 
-# This would allow a non-root install of the Perl module, but it's not
-# quite implemented yet.
-ifeq ($(mysterious_feature),yes)
-perl_installsitearch	= $(pkglibdir)
-perl_installsitelib	= $(pkglibdir)
-perl_installman3dir	= $(mandir)/man3
-endif
-
+perl_installsitearch	= $(prefix)/lib/perl5/darwin
+perl_installsitelib	= $(prefix)/lib/perl5
+perl_installman3dir	= $(prefix)/share/man/man3
 
 all: Makefile libpq-all
 	$(MAKE) -f $< all VPATH=$(VPATH)
diff -uNbr postgresql-7.2.1/src/interfaces/python/GNUmakefile postgresql-7.2.1-new/src/interfaces/python/GNUmakefile
--- postgresql-7.2.1/src/interfaces/python/GNUmakefile	2001-12-13 13:39:04.000000000 -0500
+++ postgresql-7.2.1-new/src/interfaces/python/GNUmakefile	2002-07-27 19:25:17.000000000 -0500
@@ -18,6 +18,7 @@
 include $(top_srcdir)/src/Makefile.shlib
 
 override CPPFLAGS := -I$(libpq_srcdir) $(CPPFLAGS) $(python_includespec)
+override SHLIB_LINK := -L$(libpq_builddir) $(SHLIB_LINK)
 
 all: all-lib
 
diff -uNbr postgresql-7.2.1/src/pl/plpython/Makefile postgresql-7.2.1-new/src/pl/plpython/Makefile
--- postgresql-7.2.1/src/pl/plpython/Makefile	2001-09-16 11:11:11.000000000 -0500
+++ postgresql-7.2.1-new/src/pl/plpython/Makefile	2002-07-27 19:25:17.000000000 -0500
@@ -8,7 +8,7 @@
 # On some platforms we can only build PL/Python if libpython is a
 # shared library.  Since there is no official way to determine this,
 # we see if there is a file that is named like a shared library.
-ifneq (,$(wildcard $(python_configdir)/libpython*$(DLSUFFIX)*))
+ifneq (,$(wildcard $(python_configdir)/libpython*.dylib*))
 shared_libpython = yes
 endif
 
diff -uNbr postgresql-7.2.2/src/backend/port/darwin/Makefile.orig postgresql-7.2.2/src/backend/port/darwin/Makefile
--- postgresql-7.2.2/src/backend/port/darwin/Makefile.orig	2002-09-21 17:32:50.000000000 -0700
+++ postgresql-7.2.2/src/backend/port/darwin/Makefile	2002-09-21 17:33:24.000000000 -0700
@@ -12,7 +12,7 @@
 top_builddir = ../../../..
 include $(top_builddir)/src/Makefile.global

-OBJS = sem.o system.o
+OBJS = system.o

 all: SUBSYS.o

