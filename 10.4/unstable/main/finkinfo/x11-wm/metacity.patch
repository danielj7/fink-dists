diff -Nurd -x'*~' metacity-2.26.0.orig/configure.in metacity-2.26.0/configure.in
--- metacity-2.26.0.orig/configure.in	2009-03-16 13:58:12.000000000 -0400
+++ metacity-2.26.0/configure.in	2009-06-01 23:11:23.000000000 -0400
@@ -239,6 +239,7 @@
 else
   echo "Building without compositing manager"
 fi
+AM_CONDITIONAL([USE_COMPOSITOR_EXTENSIONS], [test x$have_xcomposite != xno])
 
 ## if no compositor, still possibly enable render
 if test x$have_xcomposite = xno; then
diff -Nurd -x'*~' metacity-2.26.0.orig/src/Makefile.am metacity-2.26.0/src/Makefile.am
--- metacity-2.26.0.orig/src/Makefile.am	2009-02-04 20:10:06.000000000 -0500
+++ metacity-2.26.0/src/Makefile.am	2009-06-01 23:02:57.000000000 -0400
@@ -4,6 +4,14 @@
 
 INCLUDES=-I$(srcdir)/include -DMETACITY_LIBEXECDIR=\"$(libexecdir)\" -DHOST_ALIAS=\"@HOST_ALIAS@\" -DMETACITY_LOCALEDIR=\"$(prefix)/@DATADIRNAME@/locale\" -DMETACITY_PKGDATADIR=\"$(pkgdatadir)\" -DMETACITY_DATADIR=\"$(datadir)\" -DG_LOG_DOMAIN=\"metacity\" -DSN_API_NOT_YET_FROZEN=1 @METACITY_CFLAGS@
 
+if USE_COMPOSITOR_EXTENSIONS
+compositor_ext_sources = \
+	compositor/compositor-xrender.c		\
+	compositor/compositor-xrender.h
+else
+compositor_ext_sources =
+endif
+
 metacity_SOURCES= 				\
 	core/async-getprop.c			\
 	core/async-getprop.h			\
@@ -14,8 +22,7 @@
 	include/boxes.h				\
 	compositor/compositor.c			\
 	compositor/compositor-private.h		\
-	compositor/compositor-xrender.c		\
-	compositor/compositor-xrender.h		\
+	$(compositor_ext_sources)		\
 	include/compositor.h			\
 	core/constraints.c			\
 	core/constraints.h			\
