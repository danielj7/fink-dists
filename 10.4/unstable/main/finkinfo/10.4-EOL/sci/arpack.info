Package: arpack
Version: 96patched
Revision: 5
Maintainer: Alexander Hansen <alexkhansen@users.sourceforge.net>
Description: Solve large scale eigenvalue problems
DescDetail: <<
ARPACK is a collection of Fortran77 subroutines designed to solve large scale
eigenvalue problems.
<<
DescUsage: <<
This package contains the header, static libraries, Fortran examples, and
documentation.
<<
BuildDependsOnly: true
Homepage: http://www.caam.rice.edu/software/ARPACK
License: BSD

Source: http://www.caam.rice.edu/software/ARPACK/SRC/arpack96.tar.gz
Source2: http://www.caam.rice.edu/software/ARPACK/SRC/patch.tar.gz
Source2Rename: arpack-patch.tar.gz
Source-MD5: fffaa970198b285676f4156cebc8626e 
Source2-MD5: 14830d758f195f272b8594a493501fa2
SourceDirectory: ARPACK

BuildDepends: fink (>=0.30.0), gcc46-compiler
Depends: %N-shlibs (= %v-%r )
UseMaxBuildJobs: false

PatchFile: %n.patch
PatchFile-MD5:  c21f6a329b48f1490bd84873a9acaac4
PatchScript: <<
	#!/bin/sh -ev
	sed -e 's|FINKPREFIX|%p|g' %{PatchFile} | patch -p1
	sed -i.orig -e 's|\$(HOME)/ARPACK|%b|' ARmake.inc
	# on darwin8, -fno-common still results in _debug_ and _timing_
	# from SRC/debug.h and SRC/stat.h to appear in common section,
	# which is forbidden for dynamic shared libraries, 
	# so we just comment them out and hope for the best -- fangism
	# -ff2c needed for compatibility with Accelerate framework (darwin8)
	darwin_vers=`uname -r | cut -d. -f1`
	if test $darwin_vers = 8
	then
	  sed -i.orig -e '/^FFLAGS/s|$| -ff2c|' ARmake.inc
	  for f in SRC/debug.h SRC/stat.h
	  do sed -i.orig -e '/common/,$s|^|c&|' $f
	  done
	fi
<<
CompileScript: <<
	#!/bin/sh -ev
	make -j1 all
	make -j1 arpackdylib
<<
InstallScript:  <<
	#!/bin/sh -ev
	install -d -v %i/lib 
	install -m 644 -v libarpack.a %i/lib
	ranlib %i/lib/libarpack.a
	mv libarpack.dylib libarpack.0.dylib
	install -m 644 -v libarpack.0.dylib %i/lib
	pushd %i/lib
	ln -s libarpack.0.dylib libarpack.dylib
	popd
	install -d -v %i/share
	install -d -v %i/share/%n
	cp -r -v EXAMPLES %i/share/%n
<<
DocFiles: DOCUMENTS
DescPackaging:  <<
	Borrowed liberally from Macports.
	Needs a gfortran; I've arbitrarily chosen gcc46, as it's the
	lowest-versioned one available on 10.7.
<<
DescPort: <<
	Dynamic library originally courtesy of Ben Abbot.  I've tweaked it to
	have a nonzero compatibility_version and current_version.
	Fortran files are built at -O0 to avoid runtime crashes--thanks to
	Martin Costabel for bringing this up.
	Makefiles are not parallel-safe, use -j1. (fangism)
<<
Splitoff: <<
	Package: %N-shlibs
	Files: lib/lib%N.0.dylib
	Shlibs: %p/lib/lib%N.0.dylib 1.0.0 %n (>=0.96patched-2)
	Depends: gcc46-shlibs
	DescDetail: <<
	This package contains a dynamic library.
	<<
	DocFiles: DOCUMENTS/README
<<
