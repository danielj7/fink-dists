# -*- coding: ascii; tab-width: 4; x-counterpart: libzmq4.patch -*-
Package: libzmq4
Version: 4.1.0
Revision: 0.1
Description: ZeroMQ library
DescDetail: <<
ZeroMQ looks like an embeddable networking library but acts like a
concurrency framework. It gives you sockets that carry atomic messages
across various transports like in-process, inter-process, TCP, and
multicast. You can connect sockets N-to-N with patterns like fan-out,
pub-sub, task distribution, and request-reply. It's fast enough to be
the fabric for clustered products. Its asynchronous I/O model gives you
scalable multicore applications, built as asynchronous
message-processing tasks. It has a score of language APIs and runs on
most operating systems. ZeroMQ is from iMatix and is LGPLv3 open source.
<<
Maintainer: Daniel Johnson <daniel@daniel-johnson.org>
License: LGPL3
Homepage: http://zeromq.org

Source: http://download.zeromq.org/zeromq-%v-rc1.tar.gz
Source-MD5: 82f266d5ff63489166b5801e04e2f230
SourceDirectory: zeromq-%v

# Test fix from https://github.com/zeromq/libzmq/commit/eacd4d9cba87c8e6876839d81056131cca1a0c90
PatchFile: %{n}.patch
PatchFile-MD5: 57f8e1366dfa8bff3954a95cfbf1d485
PatchScript: <<
	%{default_script}
	# Patch configure to not link like Puma on Yosemite
	perl -pi.bak -e 's|10\.\[012\]\*|10.[012][,.]*|g' configure
<<

Depends: %{n}-shlibs (= %v-%r)
BuildDepends: <<
	asciidoc,
	libpgm52,
	libsodium13,
	pkgconfig,
	xmlto
<<
BuildDependsOnly: true

ConfigureParams: --disable-static --with-libsodium=%p --with-system-pgm

# Still random test failure in test_shutdown_stress occasionally.
InfoTest: TestScript: make check || exit 1

InstallScript: make install DESTDIR=%d

DocFiles: AUTHORS ChangeLog COPYING* MAINTAINERS NEWS

SplitOff: <<
	Package: %{N}-shlibs
	
	Depends: libpgm52-shlibs, libsodium13-shlibs
	
	Files: lib/libzmq.4.dylib
	
	Shlibs: %p/lib/libzmq.4.dylib 5.0.0 %n (>= 4.1.0-0.1)
	
	DocFiles: AUTHORS ChangeLog COPYING* MAINTAINERS NEWS
<<

SplitOff2: <<
	Package: libzmq-bin
	Description: ZeroMQ curve_keygen utility
	
	Depends: libpgm52-shlibs, libsodium13-shlibs, %{N}-shlibs (>= 4.1.0-0.1)
	
	Files: bin
	
	DocFiles: AUTHORS ChangeLog COPYING* MAINTAINERS NEWS
<<
