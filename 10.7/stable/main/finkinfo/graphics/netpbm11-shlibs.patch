diff -ruN netpbm-10.63.01-orig/Makefile.config.fink netpbm-10.63.01/Makefile.config.fink
--- netpbm-10.63.01-orig/Makefile.config.fink	1969-12-31 19:00:00.000000000 -0500
+++ netpbm-10.63.01/Makefile.config.fink	2013-07-23 07:52:54.000000000 -0400
@@ -0,0 +1,22 @@
+#
+# Configuration for fink
+# Copied from a manual run of ./configure (plus some additions)
+
+DEFAULT_TARGET	= nonmerge
+NETPBMLIBTYPE	= dylib
+NETPBMLIBSUFFIX	= dylib
+STATICLIB_TOO	= n
+NETPBMLIB_RUNTIME_PATH = @PREFIX@/lib
+CC		= cc -no-cpp-precomp
+CFLAGS = -O3 -ffast-math  -pedantic -fno-common -Wall -Wno-uninitialized -Wmissing-declarations -Wimplicit -Wwrite-strings -Wmissing-prototypes -Wundef -Wno-unknown-pragmas -MD
+CFLAGS_SHLIB	= -fno-common
+LDSHLIB		= -dynamiclib -install_name $(NETPBMLIB_RUNTIME_PATH)/libnetpbm.$(MAJ).dylib -compatibility_version $$(($(MAJ)+1)) -current_version $$(($(MAJ)+1)).$(MIN)
+LINKERISCOMPILER	= Y
+CFLAGS_SHLIB	+= -fPIC
+TIFFLIB		= libtiff.dylib
+JPEGLIB		= libjpeg.dylib
+PNGLIB		= libpng.dylib
+ZLIB		= libz.dylib
+JBIGLIB		= libjbig.dylib
+JASPERLIB       = libjasper.dylib
+
diff -ruN netpbm-10.63.01-orig/buildtools/installnetpbm.pl netpbm-10.63.01/buildtools/installnetpbm.pl
--- netpbm-10.63.01-orig/buildtools/installnetpbm.pl	2013-07-23 07:45:39.000000000 -0400
+++ netpbm-10.63.01/buildtools/installnetpbm.pl	2013-07-23 08:02:43.000000000 -0400
@@ -120,7 +120,7 @@
     } elsif ($ENV{OSTYPE} && $ENV{OSTYPE} eq "msdosdjgpp") {
         $default = "/dev/env/DJDIR";
     } else {
-        $default = "/usr/local/netpbm";
+        $default = "@PREFIX@";
     }
 
     my $response = prompt("install prefix", $default);
@@ -766,7 +766,7 @@
     my $manDir;
 
     while (!$manDir) {
-        my $default = "$prefix/man";
+        my $default = "$prefix/share/man";
 
         my $response = prompt("man page directory", $default);
 
@@ -965,9 +965,9 @@
 
     print("\n");
 
-    removeObsoleteManPage($manDir);
+#    removeObsoleteManPage($manDir);
 
-    makeInManwebPath("$manDir/web");
+#    makeInManwebPath("$manDir/web");
     
     $$mandirR = $manDir;
 }
diff -ruN netpbm-10.63.01-orig/converter/other/pnmtopng.c netpbm-10.63.01/converter/other/pnmtopng.c
--- netpbm-10.63.01-orig/converter/other/pnmtopng.c	2013-07-23 07:45:48.000000000 -0400
+++ netpbm-10.63.01/converter/other/pnmtopng.c	2013-07-23 08:04:49.000000000 -0400
@@ -529,7 +529,7 @@
                       unsigned int * const bestMatchP) {
     
     unsigned int paletteIndex;
-    unsigned int bestIndex;
+    unsigned int bestIndex = 0;
     unsigned int bestMatch;
 
     assert(paletteSize > 0);
@@ -1598,9 +1598,9 @@
     colorhist_vector chv;
     unsigned int colors;
 
-    gray * alphas_of_color[MAXPALETTEENTRIES];
+    gray * alphas_of_color[MAXPALETTEENTRIES + 1];
     unsigned int alphas_first_index[MAXPALETTEENTRIES];
-    unsigned int alphas_of_color_cnt[MAXPALETTEENTRIES];
+    unsigned int alphas_of_color_cnt[MAXPALETTEENTRIES + 1];
  
     getChv(ifP, rasterPos, cols, rows, maxval, format, MAXCOLORS, 
            &chv, &colors);
@@ -2651,7 +2651,7 @@
         /* The color part of the color/alpha palette passed to the PNG
            compressor 
         */
-    unsigned int paletteSize;
+    unsigned int paletteSize = MAXCOLORS;
 
     gray transPnm[MAXCOLORS];
     png_byte  trans[MAXCOLORS];
diff -ruN netpbm-10.63.01-orig/pm_config.in.h netpbm-10.63.01/pm_config.in.h
--- netpbm-10.63.01-orig/pm_config.in.h	2013-07-23 07:45:53.000000000 -0400
+++ netpbm-10.63.01/pm_config.in.h	2013-07-23 08:06:14.000000000 -0400
@@ -60,9 +60,9 @@
 ** hex and decimal forms to specify colors (see ppm/pgmtoppm.1 for details).  */
 
 #define RGB_DB_PATH \
-"/usr/share/netpbm/rgb.txt:" \
+"@PREFIX@/share/netpbm/rgb.txt:" \
 "/usr/lib/X11/rgb.txt:" \
-"/usr/share/X11/rgb.txt:" \
+"/usr/X11/share/X11/rgb.txt:" \
 "/usr/X11R6/lib/X11/rgb.txt"
 
 /* CONFIGURE: This is the name of an environment variable that tells
diff -uNr netpbm-10.62.02/test/Execute-Tests netpbm-10.62.02.fink/test/Execute-Tests
--- netpbm-10.62.02/test/Execute-Tests	2013-07-21 10:22:52.000000000 -0400
+++ netpbm-10.62.02.fink/test/Execute-Tests	2013-07-21 12:31:26.000000000 -0400
@@ -63,7 +63,7 @@
 
 if [ -z $tmpdir ]
   then
-    tmpdir_created=$(mktemp -d) || exit 1;
+    tmpdir_created=$(mktemp -d -t netpbm) || exit 1;
   export tmpdir=${tmpdir_created}
   else
   tmpdir_created="";
@@ -177,7 +177,7 @@
 
 echo ==================
 echo "All tests done."
-date -R -u
+date -u
 
 
 # Exit with status 0 if all supported tests succeeded, 1 otherwise.
--- a/test/pnmshear.ok	2014-01-06 12:35:20.000000000 -0500
+++ b/test/pnmshear.ok	2014-01-06 13:16:21.000000000 -0500
@@ -1 +1 @@
-2080980136 22
+598644601 24
--- a/test/pnmshear.test	2014-01-06 12:35:20.000000000 -0500
+++ b/test/pnmshear.test	2014-01-06 13:16:43.000000000 -0500
@@ -1,19 +1,26 @@
 #! /bin/bash
 # This script tests: pnmshear
-# Also requires: pbmmake
+# Also requires: pbmmake pnmpad
 
-# Test.  Should produce 2080980136 22
-${PBM_BINPREFIX}pbmmake -g 7 7 | \
-   ${PBM_TESTPREFIX}pnmshear 45 -noantialias  | cksum
+  alias pnmshear="${PBM_TESTPREFIX}pnmshear"
+  alias pbmmake="${PBM_BINPREFIX}pbmmake"
+  alias pnmpad="${PBM_BINPREFIX}pnmpad"
+  shopt -s expand_aliases
+
+# Test.  Should produce 598644601 24
+
+pbmmake -g 7 7 | pnmpad -white -top 1 | \
+   pnmshear 45 -noantialias | cksum
 
 # Output of above, in pbm plain format
 #
 # P1
-# 14 7
-# 01010101111111
-# 10101011111111
-# 10101010111111
-# 11101010111111
-# 11101010101111
-# 11111010101111
-# 11111010101011
+# 15 8
+# 000000000000000
+# 010101000000000
+# 010101010000000
+# 000101010000000
+# 000101010100000
+# 000001010100000
+# 000001010101000
+# 000000010101000
