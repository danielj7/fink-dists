--- teg-0.11.0/client/gui-gnome/g_country.c.cvsfix	2002-10-15 05:04:36.000000000 +0800
+++ teg-0.11.0/client/gui-gnome/g_country.c	2004-02-18 02:33:34.000000000 +0800
@@ -1,4 +1,4 @@
-/*	$Id: g_country.c,v 1.2 2002/10/08 04:35:57 riq Exp $	*/
+/*	$Id: g_country.c,v 1.3 2003/08/30 04:34:39 riq Exp $	*/
 /* Tenes Empanadas Graciela
  *
  * Copyright (C) 2000 Ricardo Quesada
@@ -559,7 +559,9 @@
 	}
 
 
-	gnome_canvas_update_now( GNOME_CANVAS(canvas_map) );
+	if (GNOME_CANVAS(canvas_map)->idle_id == 0)
+		gnome_canvas_update_now( GNOME_CANVAS(canvas_map) );
+
 	return TEG_STATUS_SUCCESS;
 }
 
--- teg-0.11.0/client/themes.c.cvsfix	2002-09-09 11:52:06.000000000 +0800
+++ teg-0.11.0/client/themes.c	2004-02-18 02:34:11.000000000 +0800
@@ -1,4 +1,4 @@
-/*	$Id: themes.c,v 1.31 2002/09/09 03:52:06 riq Exp $	*/
+/*	$Id: themes.c,v 1.32 2003/09/08 06:18:12 edomat Exp $	*/
 /* Tenes Empanadas Graciela
  *
  * Copyright (C) 2001 Ricardo Quesada
@@ -46,7 +46,7 @@
 #undef _DEBUG
 
 #define TEG_THEME_VER_MAJOR (1)
-#define TEG_THEME_VER_MINOR (4)
+#define TEG_THEME_VER_MINOR (5)
 
 static pTheme g_theme = NULL;	/**< Current theme */
 static pTInfo g_tinfo = NULL;	/**< info of all current themes */
@@ -497,6 +497,36 @@
 			}
 		}
 
+		/* screen */
+		else if (!xmlStrcmp(cur->name, (const xmlChar *) "screen") ) {
+			ret->screen_size_x = xmlGetProp(cur, (const xmlChar *) "size_x");
+			if (ret->screen_size_x == NULL) {
+				fprintf(stderr, "XML: 'screen' has no size_x\n");
+				goto error;
+			}
+			ret->screen_size_y = xmlGetProp(cur, (const xmlChar *) "size_y");
+			if (ret->screen_size_x == NULL) {
+				fprintf(stderr, "XML: 'screen' has no size_y\n");
+				goto error;
+			}
+		}
+
+		/* map */
+		else if (!xmlStrcmp(cur->name, (const xmlChar *) "map") ) {
+			ret->board = xmlGetProp(cur, (const xmlChar *) "file");
+			if (ret->board == NULL) {
+				fprintf(stderr, "XML: 'board' has no name\n");
+				goto error;
+			}
+			ret->board_x = xmlGetProp(cur, (const xmlChar *) "offset_x");
+			if (ret->board_x == NULL) {
+			  ret->board_x =  "0";
+			}
+			ret->board_y = xmlGetProp(cur, (const xmlChar *) "offset_y");
+			if (ret->board_y == NULL) {
+			  ret->board_y = "0";
+			}
+		}
 #ifdef XML_WORKS_OK
 		/* dices file */
 		else  if (!xmlStrcmp(cur->name, (const xmlChar *) "dices_file") ) {
@@ -514,7 +544,7 @@
 		}
 #endif	/* XML_WORKS_OK */
 		else {
-			fprintf(stderr,"Wrong type (%s). 'continent', 'board' and 'dices' were expected\n", cur->name);
+			fprintf(stderr,"Wrong type (%s). 'continent', 'board' or 'map', 'screen' and 'dices' were expected\n", cur->name);
 			free(ret);
 			goto error;
 		}
@@ -667,7 +697,15 @@
 	pT->author= g_theme->author;
 	pT->email = g_theme->email;
 	pT->version = g_theme->version;
+	pT->screen_size_x = my_atoi ( g_theme->screen_size_x );
+	if ( pT->screen_size_x == -1)
+	  pT->screen_size_x = 640;
+	pT->screen_size_y = my_atoi ( g_theme->screen_size_y );
+	if ( pT->screen_size_y == -1)
+	  pT->screen_size_y = 480;
 	pT->board = g_theme->board;
+	pT->board_x = my_atoi( g_theme->board_x );
+	pT->board_y = my_atoi( g_theme->board_y );
 
 	pT->dices_x = my_atoi( g_theme->dices_x );
 	pT->dices_y = my_atoi( g_theme->dices_y );
--- teg-0.11.0/client/themes.h.cvsfix	2002-09-09 11:21:28.000000000 +0800
+++ teg-0.11.0/client/themes.h	2004-02-18 02:34:16.000000000 +0800
@@ -1,4 +1,4 @@
-/*	$Id: themes.h,v 1.17 2002/08/31 17:45:57 riq Exp $	*/
+/*	$Id: themes.h,v 1.18 2003/09/08 06:18:12 edomat Exp $	*/
 /* Tenes Empanadas Graciela
  *
  * Copyright (C) 2001 Ricardo Quesada
@@ -89,9 +89,11 @@
 	xmlChar	*author;	/**< author of the theme */
 	xmlChar	*email;		/**< email of the author */
 	xmlChar	*version;	/**< version of the theme */
+	xmlChar *screen_size_x;	/**< screen height */
+	xmlChar *screen_size_y;	/**< screen width */
 	xmlChar	*board;		/**< board file name */
-	xmlChar	*size_x;
-	xmlChar	*size_y;
+	xmlChar *board_x;	/**< board x position */
+	xmlChar *board_y;	/**< board y position */
 	xmlChar	*armies_x;
 	xmlChar	*armies_y;
 	xmlChar *armies_background;
@@ -121,7 +123,11 @@
 	char	*author;	/**< author of the theme */
 	char	*email;		/**< email of the author */
 	char	*version;	/**< version of the theme */
+	int	screen_size_x;	/**< screen height */
+	int	screen_size_y;	/**< screen width */
 	char	*board;		/**< board file name */
+	int	board_x;	/**< board x position */
+	int	board_y;	/**< board y position */
 	int	armies_x;
 	int	armies_y;
 	int	armies_background;
