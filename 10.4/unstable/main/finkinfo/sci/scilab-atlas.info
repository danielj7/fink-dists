Package: scilab-atlas
Version: 4.1.1
Revision: 1001
Maintainer: Jeffrey Whitaker <jswhit@fastmail.fm>
Depends: gcc42-shlibs, libgtkhtml2-shlibs, tcltk, vte
BuildDepends: <<
	atlas, atk1, gcc42, glib2-dev, gtk+2-dev, libgettext3-dev, libgtkhtml2, libiconv-dev, libncurses5,
	libsablot, libxml2, ocaml, pango1-xft2-dev, readline5, tcltk-dev, vte-dev, xaw3d, x11-dev
<<
Conflicts: scilab
Replaces: scilab
Source: http://www.scilab.org/download/%v/scilab-%v-src.tar.gz
SourceDirectory: scilab-%v
Source-MD5: 0b603c8e40334d0be97eb4ac104926bf
Patch: %n.patch
PatchScript: <<
#!/bin/sh -ev
 perl -pi -e 's,(head|tail) +\-([0-9]),\1 \-n\2,g' scripts/sc_cpp
 perl -pi -e 's|[/]sw/|%p/|g' configure
 perl -pi -e 's,\#ifdef B42UNIX,#define B42UNIX\n#ifdef B42UNIX,' routines/console/zzledt.c
 perl -pi.bak -e 's|.*setslatecjmp.*||g' routines/interf/matimp.f
 sed -i.bak -e '21,42d' scripts/scilab.g.in
 perl -pi -e 's,-DFAKEXDRFLOAT ,,' pvm3/conf/DARWIN.def
 sed -e 's;-Wl,-shared -g ;-Wl,-bundle ;' < routines/Javasci/Makefile.linux > routines/Javasci/Makefile.darwin
 sed -i.bak -e 's,-module,& -bundle_loader %p/lib/scilab-%v/bin/scilex,' \
	-e 's,--quiet,,' -e 's,^\t@,\t,'  Makemex.in config/Makeso.incl.in
# make the scipad editor not crash on startup
 printf "function tklib=gettklib()\n  tklib='@GETLIBTK@'\nendfunction\n" > macros/util/gettklib.sci.in
# don't know how to coax configure to define this:
 sed -i.bak -e '/G95_FORTRAN/c \
#define G95_FORTRAN 1' routines/machine.h.in
# fix perms
 perl -pi -e 's,(install) (ACKNOWLEDGEMENTS),\1 -m 644 \2,' Makefile.in
<<
DescPackaging: Patch and patchscript contain /sw because upstream source does
ConfigureParams: --with-gfortran --with-gtk2 --with-tcl-include=%p/include --with-tcl-library=%p/lib --with-ocaml --with-atlas-library=%p/lib --without-java
#  --without-pvm ?
CompileScript: <<
 #!/bin/sh -ev
 perl -pi -e 's|g77|gfortran|g' configure
 ./configure %c
# on intel, dlamc1 needs -ffloat-store, otherwise it produces an infinite loop
# doesn't harm on ppc either
# maybe not with gfortran ? or no longer ? comment out to try..
# make FC_OPTIONS="-O2 -ffloat-store" routines/lapack/dlamch.o routines/lapack/slamch.o
# remove annoying disclaimer from greeting message
 make CFLAGS="-U__APPLE__" routines/system/banier.o
 make all man
<<
InstallScript: <<
#!/bin/sh -ev
 make install PREFIX=%i DESTDIR=%p
 ln -fs %p/lib/scilab-%v/bin/scilab %i/bin/scilab
 ln -fs %p/lib/scilab-%v/bin/intersci %i/bin/intersci
 ln -fs %p/lib/scilab-%v/bin/intersci-n %i/bin/intersci-n
<<
PostInstScript: cd %p/lib/scilab-%v; make
Description: Software package for numerical computations
License: OSI-Approved
Homepage: http://www.scilab.org
