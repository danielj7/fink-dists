Package: imlib2
Version: 1.1.0
Revision: 14
Source: mirror:sourceforge:enlightenment/%n-%v.tar.gz
Source-MD5: 1589ebb054da76734fe08ae570460034
BuildDepends: libjpeg, libpng3, libtiff, giflib | libungif, x11-dev, gcc3.3
Depends: %N-shlibs (= %v-%r)
Replaces: %N-shlibs (<<1.1.0-14)
BuildDependsOnly: true
Patch: %n.patch
UpdateLibtoolInDirs: libltdl
#UpdateConfigGuess: true
SetCPPFLAGS: -no-cpp-precomp
SetLIBS: -L%p/lib
ConfigureParams: --mandir=%i/share/man --disable-dependency-tracking
PatchScript: <<
  perl -pi.bak -e 's,need_relink=yes,need_relink=no,g' ltmain.sh
  perl -pi.bak -e 's,hardcode_direct=yes,hardcode_direct=no,g' configure

  perl -pi.bak -e 's,-no-undefined -module,-module,g' filters/Makefile.in loaders/Makefile.in

  perl -pi.bak2 -e 's, -L\$\(top_builddir\)/src(/.libs)?,,g' filters/Makefile.in loaders/Makefile.in
  perl -pi.bak3 -e 's, -lImlib2, ../src/libImlib2.la,,g' filters/Makefile.in loaders/Makefile.in

  perl -pi.bak2 -e 's,/loaders,/imlib2/loaders,g' configure
  perl -pi.bak4 -e 's,\$\(libdir\)/(loaders|filters)/(image|filter),\$(pkglibdir)/$2,g' filters/Makefile.in loaders/Makefile.in

  perl -pi.bak -e 's,(no(?:spans|lines):),$1\ncontinue;,' src/rgbadraw.c
<<
CompileScript: <<
  export CC=gcc-3.3; export CXX=g++-3.3; ./configure %c
  make CC=gcc-3.3 CXX=g++-3.3
<<
InstallScript: <<
 make install DESTDIR=%d
<<
SplitOff: <<
  Package: %N-shlibs
  Depends: libjpeg-shlibs, libpng3-shlibs (>= 1.2.5-4), libtiff-shlibs, giflib-shlibs | libungif-shlibs, x11
  DocFiles: COPYING
  Files: lib/libImlib2.1*.dylib lib/imlib2/loaders/filter/*.so lib/imlib2/loaders/image/*.so
  Shlibs: <<
    %p/lib/libImlib2.1.dylib 3.0.0 %n (>= 1.1.0-14)
  <<
<<
DocFiles: AUTHORS COPYING ChangeLog README TODO doc/*.html doc/*.gif
Description: Image handling library for X11
DescDetail: <<
Imlib2 is the successor to Imlib.  It is not just a newer version, it is a
completely new library.  Imlib2 can be installed alongside Imlib 1.x
without any problems since they are effectively different libraries, but
they Have very similar functionality.
<<
DescPort: <<
Needed to modify various bits to have -no-undefined turned on or not
to handle flat/twolevel libs properly.

Make sure to link to locally-built libraries, not existing ones in
%p/lib (old-libtool bug, and "yo upstream: learn how to use libtool!")
<<
License: BSD
Maintainer: None <fink-devel@lists.sourceforge.net>
Homepage: http://enlightenment.sourceforge.net/Libraries/Imlib2/
