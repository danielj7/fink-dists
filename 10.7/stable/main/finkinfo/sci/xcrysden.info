Package: xcrysden
Version: 1.5.53
Revision: 3
Description: Crystalline/molecular structure visualisation
License: GPL
Maintainer: Hanspeter Niederstrasser <nieder@users.sourceforge.net>
Depends: <<
	fftw3-shlibs,
	gcc48-shlibs,
	mesa-shlibs,
	meschach-shlibs,
	tcltk-shlibs,
	x11-shlibs
<<
BuildDepends: <<
	fftw3,
	fink (>= 0.32),
	fink-package-precedence,
	gcc48-compiler,
	mesa,
	meschach,
	tcltk-dev,
	x11-dev
<<
RuntimeDepends: <<
	tcltk
<<
Recommends: <<
	afni,
	imagemagick,
	mplayer,
	netpbm-bin,
	openbabel
<<
Source: http://www.xcrysden.org/download/xcrysden-%v.tar.gz
Source-MD5: 2f6b89546de5f82e5b7a7d81ac0646ef
Source2: mirror:sourceforge:tcllib/BWidget/1.9.5/bwidget-1.9.5.tar.gz
Source2-MD5: 2ec9a66ce2e0a7c4e741fc30a9d46b2b
Source2ExtractDir: %n-%v/external/src
PatchFile: %n.patch
PatchFile-MD5: e4b2408c611181a3495d811e73f6cc0a
PatchScript: <<
	#!/bin/sh -ev
	### Patch and them move Make.sys so future changes are noticed when patch fails
	sed -e 's|@FINKPREFIX@|%p|g' -e 's|@GCC_VERSION@|4.8|g' < %{PatchFile} | patch -p1
	if [ "`uname -r | cut -d. -f1`" -ge "13" ]; then
		### Mavericks has TclTk 8.6
		perl -pi -e 's|8.5|8.6|g' system/Make.macosx-x11
		### TclTk 8.6 (on Mavericks and up) errors out with
		### "'Tcl_Interp' has no member named 'result'", so fix
		perl -pi -e 's|-DHAVE_NO_GETLINE|$& -DUSE_INTERP_RESULT|g' system/Make.macosx-x11
	fi
	cp system/Make.macosx-x11 Make.sys
	### Fink can't just copy a tarball, it extracts it, but xcrysden needs
	### the tarball as is, so expand, and then retar.
	pushd external/src
		tar cfz bwidget-1.9.5.tar.gz bwidget-1.9.5
	popd
<<
UseMaxBuildJobs: false
CompileScript: <<
	make xcrysden
	fink-package-precedence --depfile-ext='\.d' .
<<
InstallScript: <<
	#!/bin/sh -ev
	make install prefix=%p DESTDIR=%d
	#mkdir -p %i/lib/xcrysden/{bin,docs,examples,external,images,scripts,sys_utils,Tcl,util}
	#cp -R Awk bin docs examples external images scripts sys_utils Tcl util %i/lib/xcrysden/
	#cp xcConfigure{,.sh} %i/lib/xcrysden
	#cp xcrysden %i/lib/xcrysden
	#cp version %i/lib/xcrysden
	
	### place a symlink in %p/bin for main executable
	#mkdir -p %i/bin
	#ln -s %p/lib/%n/xcrysden %i/bin/xcrysden
<<
DocFiles: AUTHORS COPYING COPYRIGHT ChangeLog NEWS README THANKS usage
Homepage: http://www.xcrysden.org/
DescDetail: <<
XCrySDen is a crystalline and molecular structure visualisation 
program, which aims at display of isosurfaces and contours, which 
can be superimposed on crystalline structures and interactively 
rotated and manipulated.
<<
DescUsage: <<
Normal use
----------
%p/bin/xcrysden

The location of the scratch folder can be modified by 
setting XCRYSDEN_SCRATCH in ~/.bashrc or another startup script.
<<
DescPackaging: <<
o Needs non Apple-mesa.

o From version 1.5.53 on, now uses a make install version to 
install, rather than manually copying files.
<<
DescPort: <<
Fix for TclTk 8.6
http://www.democritos.it/pipermail/xcrysden/2013-November/001509.html
<<