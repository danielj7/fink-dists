diff -Naur esound-0.2.32.old/Makefile.in esound-0.2.32.new/Makefile.in
--- esound-0.2.32.old/Makefile.in	Thu Sep  4 01:26:10 2003
+++ esound-0.2.32.new/Makefile.in	Mon Nov 10 02:10:01 2003
@@ -171,7 +171,7 @@
 
 LDADD = libesd.la $(AUDIOFILE_LIBS)
 
-esd_LDADD = $(WRAP_LIB) $(LDADD)
+esd_LDADD = $(WRAP_LIB) $(LDADD) $(SOUND_LIBS)
 
 m4datadir = $(datadir)/aclocal
 m4data_DATA = esd.m4
@@ -248,11 +248,12 @@
 esdplay_LDFLAGS = 
 @NEED_GETOPT_FALSE@esd_OBJECTS =  esd.$(OBJEXT) clients.$(OBJEXT) \
 @NEED_GETOPT_FALSE@filter.$(OBJEXT) mix.$(OBJEXT) players.$(OBJEXT) \
-@NEED_GETOPT_FALSE@proto.$(OBJEXT) samples.$(OBJEXT) util.$(OBJEXT)
+@NEED_GETOPT_FALSE@proto.$(OBJEXT) samples.$(OBJEXT) util.$(OBJEXT) \
+@NEED_GETOPT_FALSE@esd_audio.$(OBJEXT)
 @NEED_GETOPT_TRUE@esd_OBJECTS =  esd.$(OBJEXT) clients.$(OBJEXT) \
 @NEED_GETOPT_TRUE@filter.$(OBJEXT) mix.$(OBJEXT) players.$(OBJEXT) \
 @NEED_GETOPT_TRUE@proto.$(OBJEXT) samples.$(OBJEXT) getopt.$(OBJEXT) \
-@NEED_GETOPT_TRUE@getopt1.$(OBJEXT) util.$(OBJEXT)
+@NEED_GETOPT_TRUE@getopt1.$(OBJEXT) util.$(OBJEXT) esd_audio.$(OBJEXT)
 esd_DEPENDENCIES =  libesd.la
 esd_LDFLAGS = 
 SCRIPTS =  $(bin_SCRIPTS)
diff -Naur esound-0.2.32.old/audio.c esound-0.2.32.new/audio.c
--- esound-0.2.32.old/audio.c	Wed Jun 18 21:12:23 2003
+++ esound-0.2.32.new/audio.c	Sat Nov  8 11:49:03 2003
@@ -20,6 +20,8 @@
 /*******************************************************************/
 /* returns audio_fd for use by main prog - platform dependent */
 
+#if defined(INSIDE_ESD)
+
 /* ALSA before OSS as ALSA is OSS compatible */
 #if defined(DRIVER_ALSA) || defined(DRIVER_NEWALSA) 
 #  include "audio_alsa.c"
@@ -46,6 +48,11 @@
 #else
 #  include "audio_none.c"
 #endif
+
+#else
+#define DRIVER_NONE 1
+#include "audio_none.c"
+#endif /* INSIDE_ESD */
 
 /*******************************************************************/
 /* display available devices */
diff -Naur esound-0.2.32.old/configure esound-0.2.32.new/configure
--- esound-0.2.32.old/configure	Thu Sep  4 01:25:37 2003
+++ esound-0.2.32.new/configure	Mon Nov 10 01:50:47 2003
@@ -5472,7 +5472,7 @@
       allow_undefined_flag='-undefined suppress'
       ;;
     *) # Darwin 1.3 on
-      allow_undefined_flag='-flat_namespace -undefined suppress'
+      test -z "$LD_TWOLEVEL_NAMESPACE" && allow_undefined_flag='-flat_namespace -undefined suppress'
       ;;
     esac
     # FIXME: Relying on posixy $() will cause problems for
diff -Naur esound-0.2.32.old/esd.c esound-0.2.32.new/esd.c
--- esound-0.2.32.old/esd.c	Thu Sep  4 01:21:35 2003
+++ esound-0.2.32.new/esd.c	Sat Nov  8 02:47:01 2003
@@ -25,6 +25,13 @@
 /* max arguments (argc + tokenized esd.conf) can't be more than this */
 #define MAX_OPTS 128
 
+#if defined (__APPLE__)
+#include <mach/mach.h>
+#include <mach/thread_policy.h>
+#include <sys/param.h>
+#include <sys/sysctl.h>
+#endif
+
 /*******************************************************************/
 /* esd.c - prototypes */
 void set_audio_buffer( void *buf, esd_format_t format, int magl, int magr,
@@ -599,6 +606,29 @@
 
     int default_format = ESD_BITS16 | ESD_STEREO;
     /* end test scaffolding parameters */
+
+#if defined (__APPLE__)
+    /* get realtime priority */
+    {
+	struct thread_time_constraint_policy ttcpolicy;
+	int bus_speed, mib [2] = { CTL_HW, HW_BUS_FREQ };
+	size_t len;   
+
+	len = sizeof (bus_speed);
+	sysctl (mib, 2, &bus_speed, &len, NULL, 0);
+
+	/* Is it enough? */
+	ttcpolicy.period = bus_speed / 120;
+	ttcpolicy.computation = bus_speed / 2400;
+	ttcpolicy.constraint = bus_speed / 1200;
+	ttcpolicy.preemptible = 1;
+
+	thread_policy_set (mach_thread_self (),
+			   THREAD_TIME_CONSTRAINT_POLICY,
+			   (int*)&ttcpolicy,
+			   THREAD_TIME_CONSTRAINT_POLICY_COUNT);
+    }
+#endif
 
     programname = *argv;
 
diff -Naur esound-0.2.32.old/esd.conf esound-0.2.32.new/esd.conf
--- esound-0.2.32.old/esd.conf	Sat Jun 19 11:52:01 1999
+++ esound-0.2.32.new/esd.conf	Sat Nov  8 02:47:01 2003
@@ -1,4 +1,4 @@
 [esd]
 auto_spawn=1
 spawn_options=-terminate -nobeeps -as 2
-spawn_wait_ms=100
+spawn_wait_ms=999
diff -Naur esound-0.2.32.old/esd_audio.c esound-0.2.32.new/esd_audio.c
--- esound-0.2.32.old/esd_audio.c	Thu Jan  1 09:00:00 1970
+++ esound-0.2.32.new/esd_audio.c	Mon Nov 10 02:10:01 2003
@@ -0,0 +1,5 @@
+/* dirty trickery to reduce shared library dependencies */
+
+#define INSIDE_ESD
+#include "audio.c"
+
diff -Naur esound-0.2.32.old/esd_config.c esound-0.2.32.new/esd_config.c
--- esound-0.2.32.old/esd_config.c	Fri Aug  1 22:44:12 2003
+++ esound-0.2.32.new/esd_config.c	Sat Nov  8 02:47:01 2003
@@ -9,7 +9,7 @@
 int esd_no_spawn=1; /* If we can't even find the system config file,
 		       things are screwed up - don't try to make things
 		       worse. */
-int esd_spawn_wait_ms=100; /* Time to wait trying to connect to an
+int esd_spawn_wait_ms=999; /* Time to wait trying to connect to an
 			      autospawned ESD, in milliseconds. */
 char esd_spawn_options[LINEBUF_SIZE] = "-terminate -nobeeps -as 2";
 
