diff -Nru Canna37p1.orig/Canna.conf Canna37p1/Canna.conf
--- Canna37p1.orig/Canna.conf	Fri Jan  2 21:26:27 2004
+++ Canna37p1/Canna.conf	Fri Apr  2 00:33:22 2004
@@ -140,19 +140,23 @@
 # define ModernElfLinkAvailable NO
 #endif
 
-cannaPrefix = DefCannaPrefix
+#define MyCCOptions -no-cpp-precomp -Wall -Wpointer-arith -Wno-implicit-int -Wno-return-type
+#undef LibraryCCOptions
+#define LibraryCCOptions MyCCOptions -fno-common
+CCOPTIONS = MyCCOptions
+
+cannaPrefix = @PREFIX@
 cannaExecPrefix = $(cannaPrefix)
 cannaBinDir = $(cannaExecPrefix)/bin
 cannaSrvDir = DefCannaSrvDir
 XCOMM cannaLibDir = /var/lib/canna
 XCOMM cannaLibDir = /var/db/canna
 cannaLibDir = DefCannaLibDir
-XCOMM cannaManDir = $(cannaPrefix)/share/man
-cannaManDir = $(cannaPrefix)/man
+cannaManDir = $(cannaPrefix)/share/man
 cannaIncDir = $(cannaPrefix)/include/canna
 
 libCannaDir = DefLibCannaDir
-ErrDir  = DefErrDir
+ErrDir  = $(cannaPrefix)/var/log/canna
 
 /* 旧バージョンとの互換APIを無効にする場合は0と定義してください */
 #define SupportOldWchar 1
@@ -169,8 +173,8 @@
 #define ModernElfLink NO /* experimental */
 
 
-cannaOwner = bin
-cannaGroup = bin
+cannaOwner = canna
+cannaGroup = canna
 
 #ifdef InstallAsUser
 cannaOwnerGroup =
@@ -199,13 +203,13 @@
 CHGRP = :
 CHMOD = :
 #else
-CHOWN = chown
-CHGRP = chgrp
-CHMOD = chmod
+CHOWN = /usr/sbin/chown
+CHGRP = /usr/bin/chgrp
+CHMOD = /bin/chmod
 #endif
 
 /* 日本語マニュアルを使わないのであればコメントアウト */
-#define JAPANESEMAN
+/* #define JAPANESEMAN */
 
 /* #define engineSwitch */
 
@@ -237,7 +241,7 @@
 /* #define UseInstalledLibCanna YES */
 #define UseInstalledLibCanna NO
 
-DicDir   = $(cannaLibDir)/dic
+DicDir   = $(cannaPrefix)/var/lib/canna/dic
 
 /* ここから下は変更不要です */
 
@@ -343,7 +347,7 @@
 AccessFile = $(cannaPrefix)/etc/hosts.canna
 #else
 UnixSockDir = /tmp/.iroha_unix
-AccessFile = /etc/hosts.canna
+AccessFile = $(cannaPrefix)/etc/canna/hosts.canna
 #endif
 UnixSockName = IROHA
 
diff -Nru Canna37p1.orig/dic/phono/Imakefile Canna37p1/dic/phono/Imakefile
--- Canna37p1.orig/dic/phono/Imakefile	Sat Oct 19 17:27:40 2002
+++ Canna37p1/dic/phono/Imakefile	Fri Apr  2 00:33:22 2004
@@ -25,7 +25,11 @@
                 KPDIC = $(CMDDIR)/kpdic/kpdic
 #endif
 
+#ifdef HasGcc
+       ROMAJI_DIC_DEF = -DSHIFT -traditional
+#else
        ROMAJI_DIC_DEF = -DSHIFT
+#endif
 
                DICDIR = $(cannaLibDir)/dic
             SAMPLEDIR = $(cannaLibDir)/sample
diff -Nru Canna37p1.orig/hosts.canna Canna37p1/hosts.canna
--- Canna37p1.orig/hosts.canna	Thu Jan  1 09:00:00 1970
+++ Canna37p1/hosts.canna	Fri Apr  2 00:33:22 2004
@@ -0,0 +1,2 @@
+unix
+localhost
diff -Nru Canna37p1.orig/lib/canna/obind.c Canna37p1/lib/canna/obind.c
--- Canna37p1.orig/lib/canna/obind.c	Sun Feb  2 04:34:21 2003
+++ Canna37p1/lib/canna/obind.c	Fri Apr  2 00:33:51 2004
@@ -21,7 +21,7 @@
  */
 
 #if !defined(lint) && !defined(__CODECENTER__)
-static char rcsid[] = "$Id: obind.c,v 1.4 2003/02/01 19:34:21 aida_s Exp $";
+static char rcsid[] = "$Id$";
 #endif
 
 #include "cannaconf.h"
@@ -66,8 +66,8 @@
   int (*callback_func) pro((char *, int, wchar_t **, int, int *));
 } owcListCallbackStruct;
 
-typedef unsigned short cannawc16;
-typedef unsigned int cannawc32;
+typedef canna_uint16_t cannawc16;
+typedef canna_uint32_t cannawc32;
 
 extern int howToReturnModeInfo;
 extern char *context_table;
@@ -340,14 +340,13 @@
 	      kanji_status_return)
 unsigned int dpy, win;
 int functionalChar, nbytes;
-char *buffer_return;
+wchar_t *buffer_return;
 int n_buffer;
 owcKanjiStatus *kanji_status_return;
 {
   int ret;
   wcKanjiStatus wks;
   wchar_t ch;
-  int i;
   cannawc *inbuf = NULL;
   int inbufsize;
   int r;
@@ -362,10 +361,7 @@
     return -1;
   }
 
-  inbuf[0] = (cannawc)(unsigned char)buffer_return[0];
-  for (i = 1 ; i < nbytes ; i++) {
-    inbuf[i] = (cannawc)(unsigned char)buffer_return[i];
-  }
+  OldwcstoWCs(inbuf, buffer_return, nbytes ? nbytes : 1);
   ch = buffer_return[0];
   ret = XwcLookupKanji2(dpy, win, inbuf, inbufsize, nbytes, functionalChar,
 			&wks);
@@ -551,7 +547,7 @@
 wchar_t *buffer_return;
 owcKanjiStatus  *kanji_status_return;
 {
-  *buffer_return = ch;
+  *buffer_return = (wchar_t)ch;
 
   return owcLookupKanji2((unsigned int)0, (unsigned int)context_id,
 		       buffer_return, nbuffer,
diff -Nru Canna37p1.orig/update-canna-dics-dir Canna37p1/update-canna-dics-dir
--- Canna37p1.orig/update-canna-dics-dir	Thu Jan  1 09:00:00 1970
+++ Canna37p1/update-canna-dics-dir	Fri Apr  2 00:33:22 2004
@@ -0,0 +1,15 @@
+#!/bin/sh -e
+
+PATH=/bin:/sbin:/usr/bin:/usr/sbin:@PREFIX@/bin:@PREFIX@/sbin
+export PATH
+
+LIST_FILE=@PREFIX@/var/lib/canna/dic/canna/dics.dir
+LIST_DIR=@PREFIX@/var/lib/canna/dics.d
+
+TMPFILE=`tempfile`
+cat ${LIST_DIR}/* >>${TMPFILE}
+mv ${TMPFILE} ${LIST_FILE}
+chmod 0644 ${LIST_FILE}
+chown canna:canna ${LIST_FILE}
+
+exit 0
