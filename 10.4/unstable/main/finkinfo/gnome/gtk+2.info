Package: gtk+2
Version: 2.14.7
Revision: 2
Description: The Gimp Toolkit
License: LGPL
Maintainer: The Gnome Core Team <fink-gnome-core@lists.sourceforge.net>

Depends: <<
	%N-shlibs (= %v-%r),
	expat1-shlibs,
	glitz-shlibs,
	libiconv,
	pango1-xft2-ft219 (>= 1.22.0-4),
	pixman-shlibs (>= 0.12.0-1),
	x11
<<
BuildDepends: <<
	atk1 (>= 1.24.0-1),
	cairo (>= 1.8-3),
	expat1,
	fink (>= 0.24.12-1),
	fontconfig2-dev (>= 2.4.1-1),
	freetype219 (>= 2.3.7-7),
	gettext-bin,
	gettext-tools,
	glib2-dev (>= 2.18.0-1),
	glitz,
	gtk-doc (>= 1.8-1),
	libgettext3-dev,
	libiconv-dev,
	libjasper.1,
	libjpeg,
	libpng3 (>= 1.2.5-4),
	libtiff,
	pango1-xft2-ft219-dev (>= 1.22.0-4),
	pixman (>= 0.12.0-1),
	pkgconfig (>= 0.23),
	x11-dev,
	xft2-dev
<<
Conflicts: %N-common
Replaces: %N-common
Source: mirror:gnome:sources/gtk+/2.14/gtk+-%v.tar.bz2
Source-MD5: fb1614d4b2adba7b078e2e799b5db604
Source2: mirror:debian:pool/main/g/gtk+2.0/gtk+2.0_2.14.7-1.diff.gz
Source2-MD5: 35e6b8cff0070e4231537f0671571767
PatchFile: %n.patch
PatchFile-MD5: d995d10089c346899a0b2fd002472630
PatchScript: <<
#!/bin/sh -ev
	sed -e 's|@PREFIX@|%p|g' <%{PatchFile} | patch -p1
	gzip -dc ../gtk*.diff.gz | patch -p1
	for file in \
		005_xpmico.patch \
		015_default-fallback-icon-theme.patch \
		030_gtkentry_password-char-circle.patch \
		042_treeview_single-focus.patch \
		060_ignore-random-icons.patch \
		071_jasper_link_fix.patch \
		091_workaround_no_gtk_init_incorrect_display.patch \
		092_fix_printtest_include.patch \
	; do
		echo "applying $file"
		patch -p1 < debian/patches/$file
	done
#	perl -pi -e 's,/usr/bin/env python,/usr/bin/python,' gtk/gtk-builder-convert
<<

SetCPPFLAGS: -DX_LOCALE -I%p/lib/fontconfig2/include
SetLDFLAGS: -L%p/lib/fontconfig2/lib
SetCFLAGS: -Os
SetCXXFLAGS: -Os
ConfigureParams: --mandir=%p/share/man --disable-shm --disable-gtk-doc --disable-dependency-tracking --disable-explicit-deps
CompileScript: <<
#!/bin/sh -ev

	# check for buggy randr lib files
	if [ "`/usr/bin/xcodebuild -version | grep -o '^Xcode 3\.1'`" == "Xcode 3.1" ] && [ "`%p/bin/pkg-config --modversion xdamage | grep -o '^[0-9]\.[0-9]'`" != "1.1" ]
	then
		cat <<EOMSG

You are attempting to build %N with version 3.1 of Xcode, which
requires an update to your installed version of X11.  Please download
and install X11 2.3.0 or later from

  http://xquartz.macosforge.org/trac/wiki/X112.3.0

Once you have installed X11 2.3.0, please re-attempt installation of
this package %N.

EOMSG
		exit -1
	fi

	export PKG_CONFIG_PATH="%p/lib/fontconfig2/lib/pkgconfig:$PKG_CONFIG_PATH"
	./configure %c
	make
<<
InfoTest: TestScript: make -C tests || exit 2
InstallScript: <<
	make install DESTDIR=%d

	install -d -m 755 %i/sbin
	install -c -m 755 update-gdk-pixbuf-loaders %i/sbin/
	install -c -m 755 update-gtk-immodules %i/sbin/

	# libversioned actual placed in %N-shlibs because needed
	# during %N-shlibs PostInst; keep unversioned links in %N for
	# legacy compat for others' PostInst
	mv %i/bin/gdk-pixbuf-query-loaders     %i/bin/gdk-pixbuf-query-loaders-2.0
	ln -s     gdk-pixbuf-query-loaders-2.0 %i/bin/gdk-pixbuf-query-loaders
	perl -pi -e 's/(gdk-pixbuf-query-loaders)/\1-2.0/' %i/sbin/update-gdk-pixbuf-loaders
	mv %i/sbin/update-gdk-pixbuf-loaders     %i/sbin/update-gdk-pixbuf-loaders-2.0
	ln -s      update-gdk-pixbuf-loaders-2.0 %i/sbin/update-gdk-pixbuf-loaders
	mv %i/sbin/update-gtk-immodules     %i/sbin/update-gtk-immodules-2.0
	ln -s      update-gtk-immodules-2.0 %i/sbin/update-gtk-immodules

	install -d -m 755 %i/etc/gtk-2.0
	touch %i/etc/gtk-2.0/gtk.immodules
	touch %i/etc/gtk-2.0/gdk-pixbuf.loaders
<<
DocFiles: AUTHORS COPYING ChangeLog NEWS README
SplitOff: <<
	Package: %N-shlibs
	Depends: <<
		atk1-shlibs (>= 1.24.0-1),
		cairo-shlibs (>= 1.8-3),
		fontconfig2-shlibs (>= 2.4.1-1),
		freetype219-shlibs (>= 2.3.7-7),
		glib2-shlibs (>= 2.18.0-1),
		libgettext3-shlibs,
		libjasper.1-shlibs,
		libjpeg-shlibs,
		libpng3-shlibs (>= 1.2.5-4),
		libtiff-shlibs,
		pango1-xft2-ft219-shlibs (>= 1.22.0-4),
		shared-mime-info,
		x11-shlibs
	<<
	Replaces: <<
		%N (<< 2.14.4-1),
		gtk2-engines (<< 2.6.3-1),
		gail16, gail17, gail18,
		gail18-shlibs
	<<
	Conflicts: jpilot (<< 0.99.9-12), jpilot-ssl, sylpheed-gpgme (<< 2.3.0-2), sylpheed (<< 2.3.0-2), sylpheed-ssl
	DocFiles: AUTHORS COPYING ChangeLog NEWS README
	RuntimeVars: GDK_USE_XFT: 1
	Files: <<
		bin/gdk-pixbuf-query-loaders-2.0
		bin/gtk-query-immodules-2.0
		etc/gtk-2.0
		lib/libgailutil.18*.dylib
		lib/lib*-2.0.*.dylib
		lib/gtk-2.0/2.10.0/engines/*.so
		lib/gtk-2.0/2.10.0/immodules/*.so
		lib/gtk-2.0/2.10.0/loaders/*.so
		lib/gtk-2.0/2.10.0/printbackends/*.so
		lib/gtk-2.0/modules/*.so
		sbin/update-gdk-pixbuf-loaders-2.0
		sbin/update-gtk-immodules-2.0
		share/locale
		share/man/man1/gtk-query-immodules-2.0.1
		share/themes
	<<
	Shlibs: <<
		%p/lib/libgailutil.18.dylib           19.0.0 %n (>= 2.14.3-1)
		%p/lib/libgdk-x11-2.0.0.dylib         1401.0.0 %n (>= 2.14.3-1)
		%p/lib/libgdk_pixbuf-2.0.0.dylib      1401.0.0 %n (>= 2.14.3-1)
		%p/lib/libgdk_pixbuf_xlib-2.0.0.dylib 1401.0.0 %n (>= 2.14.3-1)
		%p/lib/libgtk-x11-2.0.0.dylib         1401.0.0 %n (>= 2.14.3-1)
	<<
	PostInstScript: <<
		. %p/bin/init.sh
		case "$1" in
			configure)
				update-gdk-pixbuf-loaders-2.0
				update-gtk-immodules-2.0
				;;
		esac
	<<
<<
SplitOff2: <<
	Package: %N-dev
	Depends: <<
		%N (= %v-%r),
		%N-shlibs (= %v-%r),
		glib2-shlibs (>= 2.18.0-1),
		libgettext3-shlibs,
		libiconv
	<<
	Conflicts: <<
		gtk+ (<< 1.2.10-12),
		gail16-dev, gail17-dev
	<<
	Replaces: <<
		%N (<< 2.14.5-1),
		%N-shlibs (<< 2.14.3-1),
		gail16, gail17, gail18,
		gail16-dev, gail17-dev, gail18-dev
	<<
	BuildDependsOnly: True
	DocFiles: AUTHORS COPYING ChangeLog NEWS README
	Files: <<
		bin/gdk-pixbuf-csource
		bin/gtk-builder-convert
		include
		lib
		share/aclocal
		share/gtk-doc
		share/man/man1/gdk-pixbuf-csource.1
		share/man/man1/gtk-builder-convert.1
	<<
<<

Homepage: http://www.gtk.org
DescDetail: <<
The X libraries originally written for the GIMP, which are now used by
several other programs as well.
<<
DescUsage: <<
Packages which install gdk-pixbuf loader(s) should call update-gdk-
pixbuf-loaders in their PostInstScript and PostRmScript to update the
gdk-pixbuf.loaders file.

Packages which install gtk immodule(s) should call update-gtk-immodules
in their PostInstScript and PostRmScript to update the gtk.immodules file.

Reinstall %N-shlibs to regenerate those index files if they get
damaged or lost.
<<

DescPackaging: <<
Older versions of gtk2-engines had a pixbuf theme, but now gtk+2 has
that itself (and gtk2-engines has dropped or renamed it).

	Move some .la %N-shlibs -> %N.dev as of 2.14.3-1

	Minimize propagation of InheritedBuildDepends

	Make sure we get cairo-1.8 after pdf got re-enabled in it

	The stand-alone gail packages are obsolete as of gtk+2 2.14.3-1,
	at which point gtk+2 starting including gail18.

	Move lib/gtk-2.0/modules/*.so %N -> %N-shlibs as of 2.14.3-2
	(dir is as versioned as pkgname is)

	Move etc/gtk-2.0/im-multipress.conf %N -> %N-shlibs as of 2.14.3-2
	gtk-2.0/2.10.0/immodules/im-multipress.so in %N-shlibs
	(dir is as versioned as pkgname is, could change name in
	modules/input/gtkimcontextmultipress.c if need orthogonal
	filename for new  libversion pkgname)

	Move share/themes %N -> %N-shlibs as of 2.14.3-2
	(dir is as versioned as pkgname is, could split off into
	%N-themes if needed to keep across new libversion pkgname)

	Move gdk-pixbuf-csource %N -> %N-dev as of 2.14.5-1
	(developer tool to generate C code)

	Patch gtk-builder-convert to work with any python version (svn
	revision #21807 and additional patch from comment #5-6). See:
	http://bugzilla.gnome.org/show_bug.cgi?id=559947

	As of 2.14.7-1, %N-shlibs contains a libversioned form of many
	utility programs that generate files needed by %N-shlibs so
	that users don't need to install %N in order for %N-shlibs to
	have the files. All data being handled is already in
	libversioned directories, so still sane for Shlibs Policy.

	As of 2.14.7-1, there are blank files installed in the .deb
	for the live indexes generated by the update-gtk-immodules and
	update-gdk-pixbuf-loaders scripts (run during PostInst).
	Having these files "owned" allows dpkg to remove them
	automatically when the package that can create them is
	removed, rather than needing to play PostRm purge and hope
	that doesn't interfere with a differently-named package that
	may handle these files in the future.
<<
DescPort: <<
gtk+2-dev conflicts with gtk+ (<< 1.2.11), because it has symbolic
link which intercepts include files of the package.

Import some Debian patches (whichever ones look useful)

#Import ltmain.sh dependent-lib dependency handlers from libtool2
#(prevents linking against installed lib instead of build-dir one).
#Thanks pogma!
^-- comes with ltmain.sh from libtool-2.2.6 as of 2.14.5-1

	Make sure libgdk-x11 links against Xrender even on 10.4. See:
	http://bugzilla.gnome.org/show_bug.cgi?id=555763

	Disable RANDR because it's broken on 10.5 X11. See:
	http://bugzilla.gnome.org/show_bug.cgi?id=527253
	http://permalink.gmane.org/gmane.os.apple.fink.general/27311
<<
