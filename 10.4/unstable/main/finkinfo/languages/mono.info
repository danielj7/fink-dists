Package: mono
Version: 1.9.1
Revision: 1

Source: http://ftp.novell.com/pub/mono/sources/%n/%n-%v.tar.bz2
Source-MD5: 6610c3b999d791553a9dc21059ca9d35
PatchScript: sed -e 's,@FINKPREFIX@,%p,g' %a/%n.patch | patch -p1
DocFiles: AUTHORS COPYING* ChangeLog NEWS README
Depends: <<
	%N-shlibs (= %v-%r),
	libgettext3-shlibs,
	system-java14
<<
BuildDepends: <<
	atk1 (>= 1.20.0-1),
	cairo (>= 1.6-1),
	expat1,
	fink (>= 0.22.2-1),
	fontconfig2-dev (>= 2.4.1-1),
	freetype219 (>= 2.3.5-1),
	gettext-tools,
	glib2-dev (>= 2.14.0-1),
	glitz (>= 0.4.4-1),
	libgettext3-dev,
	libiconv-dev,
	libicu32-dev | libicu36-dev,
	libpng3,
	pixman (>= 0.10.0-1),
	pkgconfig (>= 0.22-3),
	system-java14-dev,
	xmkmf
<<
BuildConflicts: libicu26-dev, libicu28-dev, libicu30-dev, gc
Replaces: %N-dev (<< %v-%r)
Type: java(1.4)
Homepage: http://www.mono-project.com/
Maintainer: Benjamin Reed <mono@fink.racoonfink.com>
Description: .NET-compatible CIL engine
NoSetCPPFLAGS: true
SetCPPFLAGS: -I%p/include
NoSetLDFLAGS: true
SetLDFLAGS: -bind_at_load
SetLIBS: -L%p/lib
ConfigureParams: --mandir=%p/share/man --sysconfdir=%p/etc --with-icu=yes --with-glib=system --with-ikvm-native=yes --with-jit=yes --with-preview=yes --with-x --with-moonlight --disable-dependency-tracking CFLAGS="-Os" CXXFLAGS="-Os"
ConfFiles: <<
	%p/etc/mono/1.0/DefaultWsdlHelpGenerator.aspx
	%p/etc/mono/1.0/machine.config
	%p/etc/mono/2.0/DefaultWsdlHelpGenerator.aspx
	%p/etc/mono/2.0/machine.config
	%p/etc/mono/browscap.ini
	%p/etc/mono/config
<<
CompileScript: <<
#!/bin/sh -ex

	case `uname -r` in
		8.*)
			ulimit -n unlimited
			;;
	esac

	if [ -x /usr/bin/ld64 ]; then
		mkdir tmpld
		ln -s /usr/bin/ld64 tmpld/ld
		export CC="gcc -B`pwd`/tmpld"
		export CXX="g++ -B`pwd`/tmpld"
	fi

	export lt_cv_sys_max_cmd_len=65536 PATH="%p/lib/xmkmf/bin:$PATH"
	perl -pi -e 's/hardcode_direct=yes/hardcode_direct=no/g; s/need_relink=yes/need_relink=no/g' configure ltmain.sh
	./configure %c --with-jdk=$JAVA_HOME

	for dir in libgc mono ikvm-native; do
		pushd $dir
			make
		popd
	done
	make -j1
<<
InstallScript: <<
#!/bin/sh -ex

	ulimit -n unlimited || :
	make -j1 install DESTDIR="%d"
	find %i/lib/mono -name \*.config -print0 | xargs -0 perl -pi -e 's,target="lib,target="%p/lib/lib,g'
<<
# dynamically loaded
Shlibs: <<
	%p/lib/libMonoPosixHelper.dylib 0.0.0 %n (>= 1.2.5-1)
	%p/lib/libMonoSupportW.dylib    0.0.0 %n (>= 1.2.5-1)
	%p/lib/libikvm-native.dylib     0.0.0 %n (>= 1.2.5-1)
<<
SplitOff: <<
	Package: %N-shlibs
	Replaces: %N (<< %v-%r)
	Depends: <<
		cairo-shlibs (>= 1.6-1),
		glib2-shlibs (>= 2.14.0-1),
		macosx (>= 10.4.3-1)
	<<
	Files: <<
		lib/libmono-profiler-*.0*.dylib
		lib/libmono.0*.dylib
	<<
	Shlibs: <<
		%p/lib/libmono-profiler-aot.0.dylib 1.0.0 %n (>= 1.2.5-1)
		%p/lib/libmono-profiler-cov.0.dylib 1.0.0 %n (>= 1.2.5-1)
		%p/lib/libmono.0.dylib              1.0.0 %n (>= 1.2.5-1)
	<<
<<
SplitOff2: <<
	Package: %N-dev
	BuildDependsOnly: true
	Depends: %N (>= %v-%r)
	Replaces: %N (<< %v-%r)
	Files: <<
		include
		lib/*.a
		lib/*.la
		lib/libmono-profiler*.dylib
		lib/libmono.dylib
		lib/pkgconfig
	<<
<<

RuntimeVars: MONO_PATH: "%p/lib:/usr/lib"
DescDetail: <<
The Mono runtime implements a JIT engine for the CIL virtual machine
(as well as a byte code interpreter, this is to quickly port it to
new systems), the class loader, the garbage collector, threading
system and metadata access libraries.
<<
License: LGPL
