Package: apple-gdb
Version: 1824
Revision: 1
Maintainer: Jack Howarth <howarth@bromo.med.uc.edu>
License: GPL2
Source: http://opensource.apple.com/tarballs/gdb/gdb-%v.tar.gz
Source-MD5: d9522c29269de8c432a4886c498956db
SourceDirectory: gdb-%v/src
SetCFLAGS: -O2 -g -I%p/include
Conflicts: gdb (<= 7.6-1)
Replaces: gdb (<= 7.6-1)
Depends: libgettext8-shlibs, libncurses5-shlibs, readline6-shlibs, sqlite3-shlibs, xcode (>= 4.7)
BuildDepends: flex, gettext-tools, libgettext8-dev, libncurses5, readline6, sqlite3-dev, texinfo-legacy, xcode (>= 4.7), fink (>= 0.24.12)
ConfigureParams: --disable-werror --datarootdir=%p/share --infodir=%p/share/info --mandir=%p/share/man  --with-docdir=%p/share/doc --with-libiconv-prefix=%p
Architecture: x86_64, i386
DocFiles: COPYING README
InfoDocs: apple-gdb.info apple-gdb.info-1 apple-gdb.info-2 apple-gdb.info-3 apple-gdb.info-4 apple-gdbint.info apple-gdbint.info-1 apple-gdbint.info-2
Homepage: http://opensource.apple.com/source/gdb
Description: The GNU Project Debugger with Apple mods
DescDetail: <<
Apple's GDB, the GNU Project debugger, allows you to see what is going on
`inside' another program while it executes -- or what another program
was doing at the moment it crashed.
<<
PatchScript: <<
#!/bin/sh -ev
perl -pi -e 's|-mmacosx-version-min=10.7||g' gdb/config/i386/macosx.mh libiberty/config/mh-macosx bfd/configure.host
# hack around non-functional --with-included-gettext=no to not use bundled intl
perl -pi -e 's|INTL = \@INTLLIBS\@|INTL = -L%p/lib -lintl|g' gdb/Makefile.in
perl -pi -e 's|INTL_DEP = \@INTLDEPS\@|INTL_DEP =|g' gdb/Makefile.in
perl -pi -e 's|INTL_DIR = ../intl|INTL_DIR =|g' gdb/Makefile.in
# hack Makefile.in's to build or use bundled readline except for creating gdb.info
perl -pi -e 's|READLINE = \$\(READLINE_DIR\)/libreadline.a|READLINE = -L%p/lib -lreadline|g' gdb/Makefile.in
perl -pi -e 's|READLINE_DEP = ../readline/libreadline.a|READLINE_DEP =|g' gdb/Makefile.in
perl -pi -e 's|READLINE_DIR = ../readline|READLINE_DIR =|g' gdb/Makefile.in
perl -pi -e 's|\$\(readline_h\)||g' gdb/Makefile.in
perl -pi -e 's|\$\(readline_history_h\)||g' gdb/Makefile.in
perl -pi -e 's|\$\(readline_tilde_h\)||g' gdb/Makefile.in
perl -pi -e 's|if readline|if 0||g' Makefile.in
rm -fr intl readline/*.h readline/*.c
<<
CompileScript: <<
#!/bin/bash -ev
./configure %c
make -j1 all-gdb MAKEINFO=%p/opt/texinfo-legacy/bin/makeinfo LEXLIB=%p/lib/libfl.a
<<
InstallScript:<<
#!/bin/bash -ev
cd gdb
# hack around incorrectly set Makefile
perl -pi -e 's|prefix = /usr/local|prefix = %p|g' Makefile
make install DESTDIR=%d MAKEINFO=%p/opt/texinfo-legacy/bin/makeinfo LEXLIB=%p/lib/libfl.a
cd %i/share/info
rm annotate.info stabs.info 
infofiles="1 2 3 4"
for infofile in $infofiles ; do
 mv gdb.info-$infofile apple-gdb.info-$infofile
done
mv gdb.info apple-gdb.info
mv gdbint.info apple-gdbint.info
mv gdbint.info-1 apple-gdbint.info-1
mv gdbint.info-2 apple-gdbint.info-2

# It seems likely that the libbfd, libopcodes, libiberty and their headers may
# also exist in some other packages
rm -rf %i/lib %i/include
<<
PostInstScript: <<
# Make the executables sgid procmod
chgrp procmod %p/bin/gdb
chmod g+s %p/bin/gdb
update-alternatives --install %p/share/info/gdb.info gdb.info %p/share/info/apple-gdb.info 40 
update-alternatives --install %p/share/info/gdb.info-1 gdb.info-1 %p/share/info/apple-gdb.info-1 40
update-alternatives --install %p/share/info/gdb.info-2 gdb.info-2 %p/share/info/apple-gdb.info-2 40
update-alternatives --install %p/share/info/gdb.info-3 gdb.info-3 %p/share/info/apple-gdb.info-3 40
update-alternatives --install %p/share/info/gdb.info-4 gdb.info-4 %p/share/info/apple-gdb.info-4 40
update-alternatives --install %p/share/info/gdbint.info gdbint.info %p/share/info/apple-gdbint.info 40
update-alternatives --install %p/share/info/gdbint.info-1 gdbint.info-1 %p/share/info/apple-gdbint.info-1 40
update-alternatives --install %p/share/info/gdbint.info-2 gdbint.info-2 %p/share/info/apple-gdbint.info-2 40
<<
PreRmScript: <<
  if [ $1 != "upgrade" ]; then
    infofiles="gdb.info gdb.info-1 gdb.info-2 gdb.info-3 gdb.info-4 gdbint.info gdbint.info-1 gdbint.info-2"
    for infofile in $infofiles ; do
      update-alternatives --remove $infofile %p/share/info/apple-$infofile
    done
  fi
<<
DescPort: <<
This packaging provides the deprecated Apple gdb for use with Xcode 4.7 or later.
It both BuildDepends and Depends on xcode (>= 4.7) to prevent displacing the system gdb.
<<
