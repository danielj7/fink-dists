diff -Nurd EMBOSS-6.2.0/ajax/acd/Makefile.in EMBOSS-6.2.0-patched/ajax/acd/Makefile.in
--- EMBOSS-6.2.0/ajax/acd/Makefile.in	2010-01-15 05:54:39.000000000 -0500
+++ EMBOSS-6.2.0-patched/ajax/acd/Makefile.in	2010-03-08 08:52:52.000000000 -0500
@@ -72,7 +72,7 @@
   sed '$$!N;$$!N;$$!N;$$!N;s/\n/ /g'
 am__installdirs = "$(DESTDIR)$(libdir)" "$(DESTDIR)$(includedir)"
 LTLIBRARIES = $(lib_LTLIBRARIES)
-libacd_la_LIBADD =
+libacd_la_LIBADD = ../core/libajax.la ../graphics/libajaxg.la ../ajaxdb/libajaxdb.la
 am__objects_1 = ajacd.lo
 am_libacd_la_OBJECTS = $(am__objects_1)
 libacd_la_OBJECTS = $(am_libacd_la_OBJECTS)
diff -Nurd EMBOSS-6.2.0/ajax/ajaxdb/Makefile.in EMBOSS-6.2.0-patched/ajax/ajaxdb/Makefile.in
--- EMBOSS-6.2.0/ajax/ajaxdb/Makefile.in	2010-01-15 05:54:40.000000000 -0500
+++ EMBOSS-6.2.0-patched/ajax/ajaxdb/Makefile.in	2010-03-08 08:53:35.000000000 -0500
@@ -72,7 +72,7 @@
   sed '$$!N;$$!N;$$!N;$$!N;s/\n/ /g'
 am__installdirs = "$(DESTDIR)$(libdir)" "$(DESTDIR)$(includedir)"
 LTLIBRARIES = $(lib_LTLIBRARIES)
-libajaxdb_la_LIBADD =
+libajaxdb_la_LIBADD = ../core/libajax.la
 am__objects_1 = ajseqdb.lo
 am_libajaxdb_la_OBJECTS = $(am__objects_1)
 libajaxdb_la_OBJECTS = $(am_libajaxdb_la_OBJECTS)
diff -Nurd EMBOSS-6.2.0/ajax/core/Makefile.in EMBOSS-6.2.0-patched/ajax/core/Makefile.in
--- EMBOSS-6.2.0/ajax/core/Makefile.in	2010-01-15 05:54:40.000000000 -0500
+++ EMBOSS-6.2.0-patched/ajax/core/Makefile.in	2010-03-08 09:41:55.000000000 -0500
@@ -72,7 +72,7 @@
   sed '$$!N;$$!N;$$!N;$$!N;s/\n/ /g'
 am__installdirs = "$(DESTDIR)$(libdir)" "$(DESTDIR)$(includedir)"
 LTLIBRARIES = $(lib_LTLIBRARIES)
-libajax_la_LIBADD =
+libajax_la_LIBADD = ../pcre/libepcre.la
 am__objects_1 = ajalign.lo ajarr.lo ajassert.lo ajbase.lo ajcall.lo \
 	ajcod.lo ajdan.lo ajdmx.lo ajdom.lo ajdomain.lo ajexcept.lo \
 	ajfeat.lo ajfile.lo ajfiledata.lo ajfileio.lo ajfmt.lo \
diff -Nurd EMBOSS-6.2.0/ajax/core/ajfeat.c EMBOSS-6.2.0-patched/ajax/core/ajfeat.c
--- EMBOSS-6.2.0/ajax/core/ajfeat.c	2010-01-12 15:18:26.000000000 -0500
+++ EMBOSS-6.2.0-patched/ajax/core/ajfeat.c	2010-03-02 05:20:41.000000000 -0500
@@ -487,7 +487,7 @@
 ** Input feature formats
 **
 ** Includes the read function (featRead), and initialising (featInitReg)
-** and deletion (featDelReg) of parsing resular expression.
+** and deletion (featDelReg) of parsing regular expression.
 **
 ******************************************************************************/
 
@@ -1839,7 +1839,7 @@
 /* @funcstatic featFeatNewProt ************************************************
 **
 ** Constructor for a new protein feature,
-** automatically added to the specififed table.
+** automatically added to the specified table.
 **
 ** @param  [u]   thys     [AjPFeattable] Pointer to the ajFeattable which
 **                         will own the feature
@@ -2312,7 +2312,7 @@
 
 /* @funcstatic featTableInit **************************************************
 **
-** Initialize the components of a previously allocated AjPFeattable object.
+** Initialise the components of a previously allocated AjPFeattable object.
 **
 ** @param [u]   thys       [AjPFeattable]   Target feature table object
 ** @param [r]  name       [const AjPStr]   Name of the table (e.g.
@@ -2327,7 +2327,7 @@
 {
     /*ajDebug("featTableInit Entering...\n");*/
 
-    /*ajDebug("featTableInit initializing seqid: '%S'\n", name);*/
+    /*ajDebug("featTableInit initialising seqid: '%S'\n", name);*/
     ajStrAssignS(&thys->Seqid,name) ;
     thys->DefFormat = 0;
 
@@ -3386,7 +3386,7 @@
     /*
      *     Version 2 or greater: parse groupfield for semicolon ';'
      *     delimited tag-value structures, taking special care about
-     *     double quoted string context. rbskfirst version of code was
+     *     double quoted string context. rbsk first version of code was
      *     adapted from GFF.pm (th/rbsk), itself inherited from AceParse.pm,
      *     courtesy of James Gilbert
      */
@@ -3736,8 +3736,8 @@
     {
 	ajRegSubI(SwRegexFtid, 1, &note);
 	ajRegSubI(SwRegexFtid, 2, &ftid);
-	/*ajDebug("Swiss ftid found\nftid: '%S'\n",
-		ftid);*/
+	/*ajDebug("Swiss ftid found\n");*/
+	/*ajDebug("ftid: '%S'\n",ftid);*/
 	ajStrAssignS(&tagstr, note);
 	ajStrTrimC(&tagstr, " .");
     }
@@ -3781,9 +3781,9 @@
 **
 ** Converts an input EMBL format line into a feature.
 ** Starts a new feature by processing any existing feature data.
-** Creates or appends the type, location and tagvalue pairs.
+** Creates or appends the type, location and tag-value pairs.
 ** With a NULL as the input line, simply processes the type, location
-** and tagvalues.
+** and tag-values.
 **
 ** @param [u] thys     [AjPFeattable] Feature table
 ** @param [r] origline [const AjPStr] Input line (NULL to process last
@@ -4671,8 +4671,8 @@
 **
 ** Tests for a feature tag value next in the input string 
 **
-** @param [u] tags [AjPStr*] Feature tagvalues string, returned with
-**                           current tagvalue removed
+** @param [u] tags [AjPStr*] Feature tag-values string, returned with
+**                           current tag-value removed
 ** @param [w] name [AjPStr*] Feature tag name
 ** @param [w] value [AjPStr*] Feature tag value
 ** @return [AjBool] ajTrue if a match was found
@@ -4858,7 +4858,7 @@
 **
 ** Process bad tag-value text up to next qualifier
 **
-** @param [u] tags [AjPStr*] Feature tagvalues string, returned with
+** @param [u] tags [AjPStr*] Feature tag-values string, returned with
 **                          skipped text removed
 ** @param [w] skip [AjPStr*] Skipped text
 ** @return [AjBool] ajTrue if a match was found
@@ -5041,7 +5041,7 @@
 
     if(istag)
     {
-	/* /tagname */
+	/* /tag name */
 	cp++;
 	cq = cp;
 	i = 0;
@@ -5058,7 +5058,7 @@
     }
     else
     {
-	/* type internalid */
+	/* type internal id */
 	cq = cp;
 	i = 0;
 
@@ -5529,9 +5529,9 @@
 **
 ** Converts an input RefSeq protein format line into a feature.
 ** Starts a new feature by processing any existing feature data.
-** Creates or appends the type, location and tagvalue pairs.
+** Creates or appends the type, location and tag-value pairs.
 ** With a NULL as the input line, simply processes the type, location
-** and tagvalues.
+** and tag-values.
 **
 ** @param [u] thys     [AjPFeattable] Feature table
 ** @param [r] origline [const AjPStr] Input line (NULL to process last
@@ -5697,7 +5697,6 @@
     AjBool Order   = ajFalse;
     ajint Flags;
     ajint ExonFlags;
-    char Strand     = '+';
     AjBool Mother   = ajTrue;
     ajint Frame     = 0;
     float Score     = 0.0;
@@ -5857,10 +5856,6 @@
 	/* location has been read in, now store it */
 	
 	Flags = ExonFlags = 0;
-	if(LocFwd)
-	    Strand = '+';
-	else
-	    Strand = '-';
 	
 	if(Simple)
 	    Flags |= FEATFLAG_POINT;
@@ -6093,7 +6088,7 @@
 
 /* @funcstatic featRegInitEmbl ************************************************
 **
-** Initialize regular expressions and data structures for
+** Initialise regular expressions and data structures for
 ** EMBL/GenBank/DDBJ format
 **
 ** @return [AjBool] ajTrue if successful
@@ -6122,7 +6117,7 @@
 
 /* @funcstatic featRegInitRefseqp *********************************************
 **
-** Initialize regular expressions and data structures for
+** Initialise regular expressions and data structures for
 ** RefSeq protein format
 **
 ** @return [AjBool] ajTrue if successful
@@ -6151,7 +6146,7 @@
 
 /* @funcstatic featRegInitSwiss ***********************************************
 **
-** Initialize regular expressions and data structures for
+** Initialise regular expressions and data structures for
 ** SwissProt format
 **
 ** @return [AjBool] ajTrue if successful
@@ -6193,8 +6188,8 @@
 
 /* @funcstatic featRegInitPir *************************************************
 **
-** Initialize regular expressions and data structures for ajFeat#
-** Pir format
+** Initialise regular expressions and data structures for ajFeat in
+** PIR format
 **
 ** @return [AjBool] ajTrue if successful
 ** @@
@@ -6209,7 +6204,7 @@
 
     featVocabInitPir();
 
-    /*ajDebug("Tables pir Type: %x Tags: %x\n",
+    /*ajDebug("Tables PIR Type: %x Tags: %x\n",
 	    FeatTypeTablePir, FeatTagsTablePir);*/
 
     /*ajDebug("featRegInitPir Compiling regexps\n");*/
@@ -6235,7 +6230,7 @@
 
 /* @funcstatic featRegInitGff *************************************************
 **
-** Initialize regular expressions and data structures for ajFeat GFF format
+** Initialise regular expressions and data structures for ajFeat GFF format
 **
 ** @return [AjBool] ajTrue if successful
 ** @@
@@ -6278,7 +6273,7 @@
 
 /* @funcstatic featRegInitGff3 ************************************************
 **
-** Initialize regular expressions and data structures for ajFeat GFF3 format
+** Initialise regular expressions and data structures for ajFeat GFF3 format
 **
 ** @return [AjBool] ajTrue if successful
 ** @@
@@ -6322,7 +6317,7 @@
 **
 ** Cleanup and exit routines. Free and destroy regular expressions
 **
-** @return [AjBool] ajFalse if unsuccesful
+** @return [AjBool] ajFalse if unsuccessful
 ** @@
 ******************************************************************************/
 
@@ -6346,7 +6341,7 @@
 **
 ** Cleanup and exit routines. Free and destroy regular expressions
 **
-** @return [AjBool] ajFalse if unsuccesful
+** @return [AjBool] ajFalse if unsuccessful
 ** @@
 ******************************************************************************/
 
@@ -6375,7 +6370,7 @@
 **
 ** Cleanup and exit routines. Free and destroy regular expressions
 **
-** @return [AjBool] ajFalse if unsuccesful
+** @return [AjBool] ajFalse if unsuccessful
 ** @@
 ******************************************************************************/
 
@@ -6399,7 +6394,7 @@
 **
 ** Cleanup and exit routines. Free and destroy regular expressions
 **
-** @return [AjBool] ajFalse if unsuccesful
+** @return [AjBool] ajFalse if unsuccessful
 ** @@
 ******************************************************************************/
 
@@ -6428,7 +6423,7 @@
 **
 ** Cleanup and exit routines. Free and destroy regular expressions
 **
-** @return [AjBool] ajFalse if unsuccesful
+** @return [AjBool] ajFalse if unsuccessful
 ** @@
 ******************************************************************************/
 
@@ -6466,7 +6461,7 @@
 **
 ** Cleanup and exit routines. Free and destroy regular expressions
 **
-** @return [AjBool] ajFalse if unsuccesful
+** @return [AjBool] ajFalse if unsuccessful
 ** @@
 ******************************************************************************/
 
@@ -7848,7 +7843,7 @@
     ** but note that any feature will appear in a DASGFF viewer
     ** unless there is some official dummy type available
     **
-    ** Common practice is to ignore the DTD and wriet an empty SEGMENT
+    ** Common practice is to ignore the DTD and write an empty SEGMENT
     ** so this section should not be needed. DAS 1.6 will correct the spec
     */
 
@@ -8181,7 +8176,7 @@
 
 /* @func ajFeattableIsNuc *****************************************************
 **
-** Returns ajTrue if a feature table is knucleotide protein
+** Returns ajTrue if a feature table is nucleotide
 **
 ** @param [r] thys [const AjPFeattable] Feature table
 ** @return [AjBool] ajTrue for a protein feature table
@@ -10471,7 +10466,7 @@
 ** @param [r] tag [const char*] Feature tag
 ** @param [r] value [const AjPStr] Feature tag value
 ** @return [AjBool] ajTrue is value was valid
-**                  ajFalse if it was "corrceted"
+**                  ajFalse if it was "corrected"
 ** @@
 ******************************************************************************/
 
@@ -10499,7 +10494,7 @@
 ** @param [r] tag [const AjPStr] Feature tag
 ** @param [r] value [const AjPStr] Feature tag value
 ** @return [AjBool] ajTrue is value was valid
-**                  ajFalse if it was "corrceted"
+**                  ajFalse if it was "corrected"
 ** @@
 ******************************************************************************/
 
@@ -10766,22 +10761,22 @@
 ** @param [u] thys [AjPFeature] Feature
 ** @param [r] tag [const AjPStr] Feature tag
 ** @param [r] value [const AjPStr] feature tag value
-** @param [w] pdeftag [AjPStr*] Default tag
-** @param [w] pdefval [AjPStr*] Default tag value as "*tag: value"
+** @param [w] Pdeftag [AjPStr*] Default tag
+** @param [w] Pdefval [AjPStr*] Default tag value as "*tag: value"
 ** @return [void]
 ** @@
 ******************************************************************************/
 
 static void featTagSetDefault(AjPFeature thys,
 			      const AjPStr tag, const AjPStr value,
-			      AjPStr* pdeftag, AjPStr* pdefval)
+			      AjPStr* Pdeftag, AjPStr* Pdefval)
 {
     featInit();
 
     if(thys->Protein)
-	featTagSetDefaultDna(tag, value, pdeftag, pdefval);
+	featTagSetDefaultDna(tag, value, Pdeftag, Pdefval);
     else
-	featTagSetDefaultProt(tag, value, pdeftag, pdefval);
+	featTagSetDefaultProt(tag, value, Pdeftag, Pdefval);
 
     return;
 }
@@ -10795,19 +10790,19 @@
 **
 ** @param [r] tag [const AjPStr] Feature tag
 ** @param [r] value [const AjPStr] feature tag value
-** @param [w] pdeftag [AjPStr*] Default tag
-** @param [w] pdefval [AjPStr*] Default tag value as "*tag: value"
+** @param [w] Pdeftag [AjPStr*] Default tag
+** @param [w] Pdefval [AjPStr*] Default tag value as "*tag: value"
 ** @return [void]
 ** @@
 ******************************************************************************/
 
 static void featTagSetDefaultDna(const AjPStr tag, const AjPStr value,
-				  AjPStr* pdeftag, AjPStr* pdefval)
+				  AjPStr* Pdeftag, AjPStr* Pdefval)
 {
     featInit();
 
-    ajStrAssignS(pdeftag, (AjPStr) ajTableFetch(FeatTagsTableDna, ajStrNew()));
-    ajFmtPrintS(pdefval, "*%S: %S", tag, value);
+    ajStrAssignS(Pdeftag, (AjPStr) ajTableFetch(FeatTagsTableDna, ajStrNew()));
+    ajFmtPrintS(Pdefval, "*%S: %S", tag, value);
 
     return;
 }
@@ -10821,20 +10816,20 @@
 **
 ** @param [r] tag [const AjPStr] Feature tag
 ** @param [r] value [const AjPStr] feature tag value
-** @param [w] pdeftag [AjPStr*] Default tag
-** @param [w] pdefval [AjPStr*] Default tag value as "*tag: value"
+** @param [w] Pdeftag [AjPStr*] Default tag
+** @param [w] Pdefval [AjPStr*] Default tag value as "*tag: value"
 ** @return [void]
 ** @@
 ******************************************************************************/
 
 static void featTagSetDefaultProt(const AjPStr tag, const AjPStr value,
-				   AjPStr* pdeftag, AjPStr* pdefval)
+				   AjPStr* Pdeftag, AjPStr* Pdefval)
 {
     featInit();
 
-    ajStrAssignS(pdeftag,
+    ajStrAssignS(Pdeftag,
 		 (AjPStr) ajTableFetch(FeatTagsTableProtein, ajStrNew()));
-    ajFmtPrintS(pdefval, "*%S: %S", tag, value);
+    ajFmtPrintS(Pdefval, "*%S: %S", tag, value);
 
     return;
 }
@@ -11891,13 +11886,13 @@
 ** Returns the tag-value pairs of a feature object
 **
 ** @param [u]  iter  [AjIList] List iterator from ajFeatTagIter
-** @param [w] tagnam [AjPStr*] Tag name
-** @param [w] tagval [AjPStr*] Tag val
+** @param [w] Ptagnam [AjPStr*] Tag name
+** @param [w] Ptagval [AjPStr*] Tag val
 ** @return [AjBool] ajTrue if another tag-value pair was returned
 ** @@
 ******************************************************************************/
 
-AjBool ajFeatTagval(AjIList iter, AjPStr* tagnam, AjPStr* tagval)
+AjBool ajFeatTagval(AjIList iter, AjPStr* Ptagnam, AjPStr* Ptagval)
 {
     FeatPTagval tv = NULL;
 
@@ -11906,8 +11901,8 @@
     if(!tv)
 	return ajFalse;
 
-    ajStrAssignS(tagnam, tv->Tag);
-    ajStrAssignS(tagval, tv->Value);
+    ajStrAssignS(Ptagnam, tv->Tag);
+    ajStrAssignS(Ptagval, tv->Value);
 
     return ajTrue;
 }
@@ -12609,7 +12604,7 @@
 **
 ** Tests a string as a valid internal (EMBL) feature /anticodon tag
 **
-** The format is  (pos:<base_range>,aa:<amino_acid>)
+** The format is  (pos:base_range,aa:amino_acid)
 **
 ** @param  [r] val [const AjPStr] parameter value
 ** @return [AjBool] ajTrue for a valid value, possibly corrected
@@ -13397,7 +13392,7 @@
 ** FT 6.2 todo aa 3 letter codes, or Sec (U) or TERM or OTHER
 **
 ** FT 6.2 todo pos can be 1 or 2 bases for polyA-completed stops (TERM)
-** whcih should have a /note
+** which should have a /note
 **
 ** @param  [r] val [const AjPStr] parameter value
 ** @return [AjBool] ajTrue for a valid value, possibly corrected
@@ -13586,11 +13581,13 @@
 	    i++;
 	}
 
-	if(!*cp && i > 5)		/* ENSP then all numbers */
-	    ret = ajTrue;
+        /* ENSP then all numbers */
+	if(!*cp && i > 5)
+            ret = ajTrue;
+
+/*	if(ret)
+        featWarn("ENSEMBL /protein_id value '%S'",   val);*/
 
-	if(ret)
-	    featWarn("ENSEMBL /protein_id value '%S'",   val);
 	/*
 	if(saveit)
 	{
@@ -13682,7 +13679,7 @@
     /* and in misc_difference features */
     if(!featRegTagReplace)
 	featRegTagReplace =
-	    ajRegCompC("^([abcdghkmnrstuvwxyABCDGHKMNRSTUVWXY]*)$");
+	    ajRegCompC("^([abcdghkmnrstuvwxyABCDGHKMNRSTUVWXY/-]*)$");
 
     /* if(!featRegTagReplace)
        featRegTagReplace = ajRegCompC("^\"([acgt]*)\"$");*/
@@ -14107,7 +14104,7 @@
 ** Splits EMBL feature location at the last possible comma
 ** and adds the appropriate prefix (e.g. the EMBL FT line type)
 **
-** @param  [u] ploc [AjPStr*] location as a string
+** @param  [u] Ploc [AjPStr*] location as a string
 ** @param  [r] margin [ajuint] Right margin
 ** @param  [r] prefix [const char*] Left margin prefix string
 ** @param  [r] preftyp [const char*] Left margin prefix string for first line
@@ -14117,7 +14114,7 @@
 ** @@
 ******************************************************************************/
 
-static void featLocEmblWrapC(AjPStr *ploc, ajuint margin,
+static void featLocEmblWrapC(AjPStr *Ploc, ajuint margin,
 			     const char* prefix, const char* preftyp,
 			     AjPStr* retstr)
 {
@@ -14132,12 +14129,12 @@
     left = strlen(prefix);
     width = margin - left;	    /* available width for printing */
 
-    ajStrRemoveWhite(ploc);	     /* no white space in locations */
-    len = ajStrGetLen(*ploc);
+    ajStrRemoveWhite(Ploc);	     /* no white space in locations */
+    len = ajStrGetLen(*Ploc);
 
     k = width;			/* for safety - will be set in time */
 
-    /* ajDebug("featLocEmblWrapC %d <%d> '%S'\n", len, width, *ploc); */
+    /* ajDebug("featLocEmblWrapC %d <%d> '%S'\n", len, width, *Ploc); */
     for(i=0; i < len; i+= k)
     {
 	last = i + width - 1;
@@ -14146,13 +14143,13 @@
 
 	if((last+1) >= len)		/* no need to split */
 	{
-	    ajStrAssignSubS(&featTmpStr, *ploc, i, len-1);
+	    ajStrAssignSubS(&featTmpStr, *Ploc, i, len-1);
 	    /* ajDebug("last %d >= len %d\n", last, len); */
 	    j = 0;
 	}
 	else
 	{
-	    ajStrAssignSubS(&featTmpStr, *ploc, i, last); /* save max string */
+	    ajStrAssignSubS(&featTmpStr, *Ploc, i, last); /* save max string */
 	    j = ajStrFindlastC(featTmpStr, ","); /* last comma in featTmpStr */
 	    /* ajDebug("comma at %d\n", j); */
 	}
@@ -17250,7 +17247,7 @@
 
 /* @func ajFeatPrintbookFormat ************************************************
 **
-** Reports the input feature format internals in wikitext format
+** Reports the input feature format internals in wiki text format
 **
 ** @param [u] outf [AjPFile] Output file
 ** @return [void]
@@ -17328,7 +17325,7 @@
 
 /* @func ajFeatPrintwikiFormat ************************************************
 **
-** Reports the input feature format internals in wikitext format
+** Reports the input feature format internals in wiki text format
 **
 ** @param [u] outf [AjPFile] Output file
 ** @return [void]
@@ -17465,7 +17462,7 @@
 
 /* @func ajFeatoutPrintwikiFormat *********************************************
 **
-** Reports the output feature format internals in wikitext format
+** Reports the output feature format internals in wiki text format
 **
 ** @param [u] outf [AjPFile] Output file
 ** @return [void]
diff -Nurd EMBOSS-6.2.0/ajax/core/ajlist.c EMBOSS-6.2.0-patched/ajax/core/ajlist.c
--- EMBOSS-6.2.0/ajax/core/ajlist.c	2009-07-09 05:21:44.000000000 -0400
+++ EMBOSS-6.2.0-patched/ajax/core/ajlist.c	2010-03-02 05:20:41.000000000 -0500
@@ -498,7 +498,7 @@
 ** @nam3rule Sort Apply function to each node
 ** @nam4rule Two Apply second function to each equal node
 ** @nam5rule Three Apply third function to each equal node
-** @suffix Unique Remove non-unique valukes from the list
+** @suffix Unique Remove non-unique values from the list
 **
 ** @argrule * list [AjPList] List
 ** @argrule Map apply [void function] Function to apply
@@ -1175,11 +1175,12 @@
 ** @nam3rule Mapread Apply function to each node without modifying list or data
 ** @nam3rule Mapfind Apply function to each node without modifying list
 **                   or data
-** @nam3rule Peek Pointer to nextvalue
+** @nam3rule Peek Pointer to next value
 ** @nam4rule PeekFirst Pointer to first value
 ** @nam4rule PeekLast Pointer to last value
 ** @nam4rule PeekNumber Pointer to numbered value
 ** @nam3rule Toarray Build array of values
+** @nam3rule Toindex Sort index array by list node values
 **
 ** @argrule * list [const AjPList] List
 ** @argrule Mapfind apply [AjBool function] Function to apply
@@ -1189,12 +1190,15 @@
 ** @argrule PeekNumber ipos [ajuint] Position in list
 ** @argrule Peek x [void**] Value
 ** @argrule Toarray array [void***] Array of values, ending with NULL
+** @argrule Toindex lind [ajuint*] Populated ndex array to be sorted
+** @argrule Toindex sort1 [int* function] Function to compare two list items.
 **
 ** @valrule * [AjBool] True on success
 ** @valrule *Length [ajuint] List length
 ** @valrule *Mapfind [AjBool] True if function returns true
 ** @valrule *Mapread [void]
 ** @valrule *Toarray [ajuint] Array size, excluding final NULL
+** @valrule *Toindex [ajuint] Array size, excluding final NULL
 **
 ** @fcategory cast
 **
@@ -1554,6 +1558,67 @@
 
 
 
+/* @func ajListToindex ********************************************************
+**
+** Create an array of the pointers to the data.
+**
+** @param [r] list [const AjPList] List
+** @param [w] lind [ajuint*] Populated ndex array to be sorted
+** @param [f] sort1 [int* function] Function to compare two list items.
+** @return [ajuint] Size of index array.
+** @@
+******************************************************************************/
+
+ajuint ajListToindex(const AjPList list, ajuint* lind,
+                     int (*sort1) (const void*, const void*))
+{
+    ajuint n;
+    ajuint s;
+    ajuint i;
+    ajint j;
+    ajuint t;
+
+    AjPListNode rest;
+    AjPListNode *nodes;
+    ajuint* idx = NULL;
+
+    n = list->Count;
+    rest = list->First;
+
+    if(!n)
+        return 0;
+
+    ajListToarray(list, (void***) &nodes);
+    AJCNEW0(idx, n);
+
+    for(i = 0; i < n; i++)
+        idx[i] = i;
+
+    for(s=n/2; s>0; s /= 2)
+	for(i=s; i<n; ++i)
+        {
+	    for(j=i-s;
+                j>=0 && (sort1(&nodes[idx[j]],&nodes[idx[j+s]]) < 0);
+                j-=s)
+	    {
+		t = lind[j];
+		lind[j] = lind[j+s];
+		lind[j+s] = t;
+		t = idx[j];
+		idx[j] = idx[j+s];
+		idx[j+s] = t;
+	    }
+        }
+            
+    AJFREE(nodes);
+    AJFREE(idx);
+
+    return n;
+}
+
+
+
+
 /* @section Trace functions ***************************************************
 **
 ** @fdata [AjPList]
@@ -3402,7 +3467,7 @@
 ** @nam3rule Mapfind Apply function to each node without modifying list
 **                       or data
 ** @nam3rule Mapread Apply function to each node without modifying list or data
-** @nam3rule Peek Pointer to nextvalue
+** @nam3rule Peek Pointer to next value
 ** @nam4rule PeekFirst Pointer to first value
 ** @nam4rule PeekLast Pointer to last value
 ** @nam4rule PeekNumber Pointer to numbered value
diff -Nurd EMBOSS-6.2.0/ajax/core/ajlist.h EMBOSS-6.2.0-patched/ajax/core/ajlist.h
--- EMBOSS-6.2.0/ajax/core/ajlist.h	2009-08-24 09:59:06.000000000 -0400
+++ EMBOSS-6.2.0-patched/ajax/core/ajlist.h	2010-03-02 05:20:41.000000000 -0500
@@ -150,6 +150,8 @@
 void        ajListstrTrace   (const AjPList list);
 
 ajuint      ajListToarray (const AjPList list, void*** array);
+ajuint      ajListToindex(const AjPList list, ajuint* listindex,
+                          int (*sort1) (const void*, const void*));
 void        ajListTrace   (const AjPList list);
 
 AjBool      ajListMapfind (const AjPList listhead,
diff -Nurd EMBOSS-6.2.0/ajax/core/ajpat.c EMBOSS-6.2.0-patched/ajax/core/ajpat.c
--- EMBOSS-6.2.0/ajax/core/ajpat.c	2009-12-01 09:34:10.000000000 -0500
+++ EMBOSS-6.2.0-patched/ajax/core/ajpat.c	2010-03-02 05:20:41.000000000 -0500
@@ -1228,9 +1228,13 @@
       AJFREE(thys->sotable);
 
     if(thys->type==6)
+    {
 	for(i=0;i<thys->m;++i)
 	    AJFREE(thys->skipm[i]);
 
+        AJFREE(thys->skipm);
+    }
+    
     AJFREE(*pthys);
 
     return;
@@ -1330,19 +1334,19 @@
 ** Documents patterns to a formatted string
 **
 ** @param [u] plist [AjPPatlistRegex] Pattern list object
-** @param [w] pdoc [AjPStr*] Formatted string
+** @param [w] Pdoc [AjPStr*] Formatted string
 ** @return [ajuint] Number of patterns
 ** @@
 ******************************************************************************/
 
-ajuint ajPatlistRegexDoc (AjPPatlistRegex plist, AjPStr* pdoc)
+ajuint ajPatlistRegexDoc (AjPPatlistRegex plist, AjPStr* Pdoc)
 {
     AjPPatternRegex pat = NULL;
 
-    ajFmtPrintS(pdoc, "%-12S %S\n", "Pattern_name", "Pattern");
+    ajFmtPrintS(Pdoc, "%-12S %S\n", "Pattern_name", "Pattern");
 
     while (ajPatlistRegexGetNext(plist, &pat))
-	ajFmtPrintAppS(pdoc, "%-12S %S\n",
+	ajFmtPrintAppS(Pdoc, "%-12S %S\n",
 		       ajPatternRegexGetName(pat),
 		       ajPatternRegexGetPattern(pat));
 
@@ -1357,20 +1361,20 @@
 ** Documents patterns to a formatted string
 **
 ** @param [u] plist [AjPPatlistSeq] Pattern list object
-** @param [w] pdoc [AjPStr*] Formatted string
+** @param [w] Pdoc [AjPStr*] Formatted string
 ** @return [ajuint] Number of patterns
 ** @@
 ******************************************************************************/
 
-ajuint ajPatlistSeqDoc (AjPPatlistSeq plist, AjPStr* pdoc)
+ajuint ajPatlistSeqDoc (AjPPatlistSeq plist, AjPStr* Pdoc)
 {
     AjPPatternSeq pat = NULL;
 
-    ajFmtPrintS(pdoc, "%-12s %8s %s\n",
+    ajFmtPrintS(Pdoc, "%-12s %8s %s\n",
 		   "Pattern_name", "Mismatch", "Pattern");
     while (ajPatlistSeqGetNext(plist, &pat))
     {
-	ajFmtPrintAppS(pdoc, "%-12S %8d %S\n",
+	ajFmtPrintAppS(Pdoc, "%-12S %8d %S\n",
 		       ajPatternSeqGetName(pat),
 		       ajPatternSeqGetMismatch(pat),
 		       ajPatternSeqGetPattern(pat));
diff -Nurd EMBOSS-6.2.0/ajax/core/ajseqread.c EMBOSS-6.2.0-patched/ajax/core/ajseqread.c
--- EMBOSS-6.2.0/ajax/core/ajseqread.c	2010-01-12 07:32:40.000000000 -0500
+++ EMBOSS-6.2.0-patched/ajax/core/ajseqread.c	2010-03-02 05:20:41.000000000 -0500
@@ -582,7 +582,7 @@
 static const AjPStr seqAppendWarn(AjPStr* seq, const AjPStr line);
 static ajuint     seqAppendCommented(AjPStr* seq, AjBool* incomment,
 				     const AjPStr line);
-static AjBool     seqClustalReadseq(const AjPStr seqReadLine,
+static AjBool     seqClustalReadseq(const AjPStr rdLine,
 				    const AjPTable msftable);
 static AjBool     seqDefine(AjPSeq thys, AjPSeqin seqin);
 static AjBool     seqFindInFormat(const AjPStr format, ajint *iformat);
@@ -594,9 +594,9 @@
 				AjPStr* pline,
 				ajuint maxlines, ajuint *len);
 static AjBool     seqGcgMsfHeader(const AjPStr line, SeqPMsfItem* msfitem);
-static AjBool     seqGcgMsfReadseq(const AjPStr seqReadLine,
+static AjBool     seqGcgMsfReadseq(const AjPStr rdline,
 				   const AjPTable msftable);
-static AjBool     seqHennig86Readseq(const AjPStr seqReadLine,
+static AjBool     seqHennig86Readseq(const AjPStr rdline,
 				     const AjPTable msftable);
 static AjBool     seqinUfoLocal(const AjPSeqin thys);
 static void       seqListNoComment(AjPStr* text);
@@ -607,7 +607,7 @@
 static void       seqMsfItemDel(SeqPMsfItem* pthys);
 static void       seqMsfTabDel(void **key, void **value, void *cl);
 static void       seqMsfTabList(const void *key, void **value, void *cl);
-static AjBool     seqPhylipReadseq(const AjPStr seqReadLine,
+static AjBool     seqPhylipReadseq(const AjPStr rdline,
 				   const AjPTable phytable,
 				   const AjPStr token,
 				   ajuint len, ajuint* ilen, AjBool* done);
@@ -879,7 +879,7 @@
        AJFALSE, AJFALSE, AJTRUE,  AJTRUE,
        AJFALSE, AJTRUE,  seqReadDbId, AJFALSE, AJFALSE}, /* odd fasta with id as
                                                             second token */
-  {"msf",         "GCG MSF (mutiple sequence file) file format",
+  {"msf",         "GCG MSF (multiple sequence file) file format",
        AJFALSE, AJTRUE,  AJTRUE,  AJTRUE,
        AJFALSE, AJTRUE,  seqReadMsf, AJFALSE, AJFALSE},
   {"hennig86",    "Hennig86 output format",
@@ -1499,7 +1499,7 @@
 /* @func ajSeqinClearPos ******************************************************
 **
 ** Clears a Sequence input object position information as possibly read from
-** a USA that included the begni, end and direction
+** a USA that included the begin, end and direction
 **
 ** @param [u] thys [AjPSeqin] Sequence input
 ** @return [void]
@@ -1626,7 +1626,7 @@
 
 /* @section Sequence inputs **********************************************
 **
-** These functions read the sequence provdied by the first argument
+** These functions read the sequence provided by the first argument
 **
 ******************************************************************************/
 
@@ -3198,7 +3198,7 @@
             if(i >= seqlen){
                 if(!badwarn)
                     ajWarn("Bad quality '%S' for base %d "
-                       "in fastqint format\n",
+                       "in fastq-int format\n",
                        qualstr, i);
                 badwarn = ajTrue;
             }
@@ -3206,7 +3206,7 @@
             {
                 if(!badwarn)
                     ajWarn("Bad quality '%S' for base %d "
-			   "in fastqint format\n",
+			   "in fastq-int format\n",
 			   qualstr, i);
                 badwarn = ajTrue;
                 i++;
@@ -5978,7 +5978,7 @@
 ** using the SEQRES records.
 **
 ** This is the sequence observed in the structure. See seqReadPdbnucseq
-** for parsing the SEQRES records which give the soriginal sequence.
+** for parsing the SEQRES records which give the original sequence.
 **
 ** @param [w] thys [AjPSeq] Sequence object
 ** @param [u] seqin [AjPSeqin] Sequence input object
@@ -9670,7 +9670,7 @@
 ** continue lines for OS
 **
 ** New line types:
-**    OH organism host: list of taxids
+**    OH organism host: list of tax ids
 **
 ** CC line blocks -!- TOPIC:
 ** can do this by parsing the stored comment block
@@ -10979,7 +10979,7 @@
 		ajStrAppendC(&cmtstr, "\n");
 	    ajStrAppendS(&cmtstr, token);
 
-/* trying to keep commments in one long string with embedded returns
+/* trying to keep comments in one long string with embedded returns
 ** probably fails for long comments - and also fails for contact details
 ** which have very short comment lines
 ** switch to just keeping original lines */
@@ -12648,30 +12648,23 @@
     {
 	switch(++i)
 	{
-            case 1:
+            case 1:             /* 'LOCUS' */
                 break;
-            case 2:
+            case 2:             /* locus name */
                 seqSetName(thys, token);
                 break;
-            case 3:
+            case 3:             /* length */
                 ajStrToUint(token, &seqlen);
                 break;
-            case 4:
+            case 4:             /* 'aa' */
                 if(!ajStrMatchC(token, "aa"))
                     ajWarn("bad RefseqP LOCUS line '%S'", seqReadLine);
                 break;
             case 5:
-                ajSeqmolSetGb(&thys->Molecule, token);
-                break;
-            case 6:
-                if(ajStrMatchC(token, "circular"))
-                    thys->Circular = ajTrue;
-                break;
-            case 7:
                 ajSeqdivSetGb(&thys->Division, token);
                 ajSeqclsSetGb(&thys->Class, token);
                 break;
-            case 8:
+            case 6:
                 if(!thys->Date)
                     thys->Date = ajSeqdateNew();
                 ajSeqdateSetModifyS(thys->Date, token);
@@ -12806,7 +12799,7 @@
 
 	    while (ajStrTokenNextParse(&handle, &token))
 	    {
-		if(ajStrMatchC(token, "(bases"))
+		if(ajStrMatchC(token, "(residues"))
                     continue;
 
 		if(ajStrMatchC(token, "to"))
@@ -13684,7 +13677,7 @@
 ** Looks for the specified format(s) in the internal definitions and
 ** returns the index.
 **
-** Sets iformat as the recognized format, and returns ajTrue.
+** Sets iformat as the recognised format, and returns ajTrue.
 **
 ** @param [r] format [const AjPStr] Format required.
 ** @param [w] iformat [ajint*] Index
@@ -14008,20 +14001,20 @@
 ** Non sequence characters are reported in the return value
 ** if EMBOSS_SEQWARN is set
 **
-** @param [u] pqual [AjPStr*] Quality values as a string
+** @param [u] Pqual [AjPStr*] Quality values as a string
 ** @param [r] line [const AjPStr] Input line.
 ** @return [void]
 ** @@
 ******************************************************************************/
 
-static void seqqualAppendWarn(AjPStr* pqual, const AjPStr line)
+static void seqqualAppendWarn(AjPStr* Pqual, const AjPStr line)
 {
     AjPStr tmpstr = NULL;
 
     ajStrAssignS(&tmpstr, line);
 
     ajStrKeepSetAscii(&tmpstr, 33, 126);
-    ajStrAppendS(pqual, tmpstr);
+    ajStrAppendS(Pqual, tmpstr);
 
     ajStrDel(&tmpstr);
 
@@ -14088,7 +14081,7 @@
 **
 ** @param [u] thys [AjPSeq] Sequence.
 ** @param [r] seqin [const AjPSeqin] Sequence input.
-** @param [u] pline [AjPStr*] Input buffer.
+** @param [u] Pline [AjPStr*] Input buffer.
 ** @param [r] maxlines [ajuint] Maximum number of lines to read
 **                              before giving up
 ** @param [w] len [ajuint*] Length of sequence read.
@@ -14097,7 +14090,7 @@
 ******************************************************************************/
 
 static AjBool seqGcgDots(AjPSeq thys, const  AjPSeqin seqin,
-			 AjPStr* pline,
+			 AjPStr* Pline,
 			 ajuint maxlines, ajuint* len)
 {
     AjPStr token  = NULL;
@@ -14113,22 +14106,22 @@
     while(nlines < maxlines)
     {
 	if(nlines++)
-	    if(!ajBuffreadLineStore(buff, pline,
+	    if(!ajBuffreadLineStore(buff, Pline,
 				   seqin->Text, &thys->TextPtr))
 		return ajFalse;
 
 	if(nlines > maxlines)
 	    return ajFalse;
 
-	if(!ajRegExec(seqRegGcgDot, *pline))
+	if(!ajRegExec(seqRegGcgDot, *Pline))
 	    continue;
 
-	ajDebug("seqGcgDots   .. found\n'%S'\n", *pline);
+	ajDebug("seqGcgDots   .. found\n'%S'\n", *Pline);
 
-	if(!ajRegExec(seqRegGcgChk, *pline))	/* checksum required */
+	if(!ajRegExec(seqRegGcgChk, *Pline))	/* checksum required */
 	    return ajFalse;
 
-	if(ajRegExec(seqRegGcgMsf, *pline))	/* oops - it's an MSF file */
+	if(ajRegExec(seqRegGcgMsf, *Pline))	/* oops - it's an MSF file */
 	    return ajFalse;
 
 	ajRegSubI(seqRegGcgChk, 1, &token);
@@ -14136,20 +14129,20 @@
 
 	ajDebug("   checksum %d\n", check);
 
-	if(ajRegExec(seqRegGcgLen, *pline))
+	if(ajRegExec(seqRegGcgLen, *Pline))
 	{
 	    ajRegSubI(seqRegGcgLen, 1, &token);
 	    ajStrToUint(token, len);
 	    ajDebug("   length %d\n", *len);
 	}
 
-	if(ajRegExec(seqRegGcgNam, *pline))
+	if(ajRegExec(seqRegGcgNam, *Pline))
 	{
 	    ajRegSubI(seqRegGcgNam, 0, &thys->Name);
 	    ajDebug("   name '%S'\n", thys->Name);
 	}
 
-	if(ajRegExec(seqRegGcgTyp, *pline))
+	if(ajRegExec(seqRegGcgTyp, *Pline))
 	{
 	    ajRegSubI(seqRegGcgTyp, 1, &thys->Type);
 	    ajDebug("   type '%S'\n", thys->Type);
@@ -14180,7 +14173,7 @@
 **
 ** @param [u] thys [AjPSeq] Sequence.
 ** @param [r] seqin [const AjPSeqin] Sequence input.
-** @param [u] pline [AjPStr*] Input buffer.
+** @param [u] Pline [AjPStr*] Input buffer.
 ** @param [r] maxlines [ajuint] Maximum number of lines to read
 **                              before giving up
 ** @param [w] len [ajuint*] Length of sequence read.
@@ -14188,7 +14181,7 @@
 ** @@
 ******************************************************************************/
 
-static AjBool seqGcgMsfDots(AjPSeq thys, const AjPSeqin seqin, AjPStr* pline,
+static AjBool seqGcgMsfDots(AjPSeq thys, const AjPSeqin seqin, AjPStr* Pline,
 			    ajuint maxlines, ajuint* len)
 {
     AjPStr token = NULL;
@@ -14199,31 +14192,31 @@
 
     buff = seqin->Filebuff;
 
-    ajDebug("seqGcgMsfDots maxlines: %d\nline: '%S'\n", maxlines,*pline);
+    ajDebug("seqGcgMsfDots maxlines: %d\nline: '%S'\n", maxlines,*Pline);
 
     seqGcgRegInit();
 
     while(nlines < maxlines)
     {
 	if(nlines++)
-	    if(!ajBuffreadLineStore(buff, pline,
+	    if(!ajBuffreadLineStore(buff, Pline,
 				   seqin->Text, &thys->TextPtr))
 		return ajFalse;
 
-	ajDebug("testing line %d\n'%S'\n", nlines,*pline);
+	ajDebug("testing line %d\n'%S'\n", nlines,*Pline);
 
 	if(nlines > maxlines)
 	    return ajFalse;
 
-	if(!ajRegExec(seqRegGcgDot, *pline))
+	if(!ajRegExec(seqRegGcgDot, *Pline))
 	    continue;
 
 	/* dots found. This must be the line if this is MSF format */
 
-	if(!ajRegExec(seqRegGcgChk, *pline))	/* check: is required */
+	if(!ajRegExec(seqRegGcgChk, *Pline))	/* check: is required */
 	    return ajFalse;
 
-	if(!ajRegExec(seqRegGcgMsf, *pline)) /* MSF: len required for GCG*/
+	if(!ajRegExec(seqRegGcgMsf, *Pline)) /* MSF: len required for GCG*/
 	    return ajFalse;
 
 
@@ -14233,10 +14226,10 @@
 	ajRegSubI(seqRegGcgChk, 1, &token);
 	ajStrToUint(token, &check);
 
-	if(ajRegExec(seqRegGcgNam, *pline))
+	if(ajRegExec(seqRegGcgNam, *Pline))
 	    ajRegSubI(seqRegGcgNam, 0, &thys->Name);
 
-	if(ajRegExec(seqRegGcgTyp, *pline))
+	if(ajRegExec(seqRegGcgTyp, *Pline))
 	    ajRegSubI(seqRegGcgTyp, 1, &thys->Type);
 
 	ajStrDel(&token);
@@ -14256,17 +14249,17 @@
 **
 ** Parses data from a line of an MSF file header. The header stores
 ** names and other data for all sequences in the file. Each file
-** is definied on a separate line. The results are stored
+** is defined on a separate line. The results are stored
 ** in the MSF internal table. The sequence data is read later in the
 ** input file and added to the table.
 **
 ** @param [r] line [const AjPStr] Input line.
-** @param [u] pmsfitem [SeqPMsfItem*] MSF internal table item.
+** @param [u] Pmsfitem [SeqPMsfItem*] MSF internal table item.
 ** @return [AjBool] ajTrue on success.
 ** @@
 ******************************************************************************/
 
-static AjBool seqGcgMsfHeader(const AjPStr line, SeqPMsfItem* pmsfitem)
+static AjBool seqGcgMsfHeader(const AjPStr line, SeqPMsfItem* Pmsfitem)
 {
     AjPStr name         = NULL;	/* NOTE: not static. New each time for list */
     AjPStr token = NULL;
@@ -14285,7 +14278,7 @@
 
     /*ajDebug("Check found\n");*/
 
-    *pmsfitem = AJNEW0(msfitem);
+    *Pmsfitem = AJNEW0(msfitem);
     msfitem->Name = name;
 
     ajRegSubI(seqRegGcgChk, 1, &token);
@@ -15072,7 +15065,8 @@
 	{
 	    ajStrTokenAssignC(&handle, seqReadLine, " \t\n\r");
 	    ajStrTokenNextParse(&handle, &token);
-	    /* ajDebug("Line  '%S'\ntoken '%S'\n", seqReadLine, token); */
+	    /* ajDebug("Line  '%S'\n");*/
+	    /* ajDebug("token '%S'\n", seqReadLine, token); */
 
 	    if(ajStrGetLen(token))
 	    {
@@ -15323,7 +15317,7 @@
 
 /* @funcstatic seqnameSetName *************************************************
 **
-** Sets the name usable by a seuqnece object by applying simple conversion
+** Sets the name usable by a sequence object by applying simple conversion
 ** rules to the input which could be, for example, the name from a
 ** FASTA format file.
 **
@@ -15568,7 +15562,7 @@
 **
 ** All constructors return a new sequence query object by pointer. It
 ** is the responsibility of the user to first destroy any previous
-** sequenceoutput object. The target pointer does not need to be
+** sequence output object. The target pointer does not need to be
 ** initialised to NULL, but it is good programming practice to do so
 ** anyway.
 **
@@ -16195,7 +16189,7 @@
 
 /* @funcstatic seqQryWildComp *************************************************
 **
-** Compiles the reqular expressions for testing wild cards in queries.
+** Compiles the regular expressions for testing wild cards in queries.
 ** These are held in static storage and built once only if needed.
 **
 ** @return [void]
@@ -16622,7 +16616,7 @@
     }
 
     /* works for NCBI formatdb reformatted blast databases
-     ** still checking for any misformatted databases elsewhere */
+     ** still checking for any mis-formatted databases elsewhere */
 
     if(!strcmp(q,"bbs") || !strcmp(q,"lcl"))
     {
diff -Nurd EMBOSS-6.2.0/ajax/core/ajseqwrite.c EMBOSS-6.2.0-patched/ajax/core/ajseqwrite.c
--- EMBOSS-6.2.0/ajax/core/ajseqwrite.c	2009-12-29 11:42:41.000000000 -0500
+++ EMBOSS-6.2.0-patched/ajax/core/ajseqwrite.c	2010-03-02 05:20:41.000000000 -0500
@@ -341,7 +341,7 @@
 	 AJFALSE, AJFALSE, AJFALSE, AJTRUE,  AJFALSE,
 	 AJTRUE,  AJTRUE,  AJFALSE, seqWriteRefseq},
     {"refseqp",    "Refseqp entry format",
-	 AJFALSE, AJFALSE, AJFALSE, AJTRUE,  AJFALSE,
+	 AJFALSE, AJFALSE, AJFALSE, AJFALSE, AJTRUE,
 	 AJTRUE,  AJTRUE,  AJFALSE, seqWriteRefseqp},
     {"gff2",       "GFF2 feature file with sequence in the header",
 	 AJFALSE, AJFALSE, AJFALSE, AJTRUE,  AJTRUE,
@@ -382,7 +382,7 @@
     {"fitch",      "Fitch program format",
 	 AJFALSE, AJFALSE, AJFALSE, AJTRUE,  AJTRUE,
 	 AJFALSE, AJTRUE,  AJFALSE, seqWriteFitch},
-    {"msf",        "GCG MSF (mutiple sequence file) file format",
+    {"msf",        "GCG MSF (multiple sequence file) file format",
 	 AJFALSE, AJFALSE, AJTRUE,  AJTRUE,  AJTRUE,
 	 AJFALSE, AJTRUE,  AJFALSE, seqWriteMsf},
     {"clustal",    "Clustalw multiple alignment format",
@@ -489,7 +489,7 @@
 **
 ** All constructors return a new sequence output object by pointer. It
 ** is the responsibility of the user to first destroy any previous
-** sequenceoutput object. The target pointer does not need to be
+** sequence output object. The target pointer does not need to be
 ** initialised to NULL, but it is good programming practice to do so
 ** anyway.
 **
@@ -592,7 +592,7 @@
 
 /* @func ajSeqoutNewFile ******************************************************
 **
-** Creates a new sequence output object using a preopened file.
+** Creates a new sequence output object using a pre-opened file.
 **
 ** @param [u] file [AjPFile] Open file object
 ** @return [AjPSeqout] New sequence output object.
@@ -2154,7 +2154,7 @@
 	return;
     
     itest = ajListToarray(outseq->Savelist, (void***) &seqs);
-    ajDebug("ajListToArray listed %d items\n", itest);
+    ajDebug("ajListToarray listed %d items\n", itest);
     seqarr = (AjPSeq*) seqs;
 
     for(i=0; i < isize; i++)
@@ -2265,7 +2265,7 @@
 /* test for group description only when writing 2+ sequences (a set) */
     
     itest = ajListToarray(outseq->Savelist, (void***) &seqs);
-    ajDebug("ajListToArray listed %u items\n", itest);
+    ajDebug("ajListToarray listed %u items\n", itest);
     seqarr = (AjPSeq*) seqs;
 
     seqfirst = seqarr[0];
@@ -2433,7 +2433,7 @@
 	return;
 
     itest = ajListToarray(outseq->Savelist, (void***) &seqs);
-    ajDebug("ajListToArray listed %d items\n", itest);
+    ajDebug("ajListToarray listed %d items\n", itest);
     seqarr = (AjPSeq*) seqs;
 
     seqfirst = seqarr[0];
@@ -2584,7 +2584,7 @@
 	return;
     
     itest = ajListToarray(outseq->Savelist, (void***) &seqs);
-    ajDebug("ajListToArray listed %d items\n", itest);
+    ajDebug("ajListToarray listed %d items\n", itest);
     seqarr = (AjPSeq*) seqs;
 
     for(i=0; i < isize; i++)
@@ -2692,7 +2692,7 @@
 	return;
 
     itest = ajListToarray(outseq->Savelist, (void***) &seqs);
-    ajDebug("ajListToArray listed %d items\n", itest);
+    ajDebug("ajListToarray listed %d items\n", itest);
     seqarr = (AjPSeq*) seqs;
 
     for(i=0; i < isize; i++)
@@ -2788,7 +2788,7 @@
 	return;
 
     itest = ajListToarray(outseq->Savelist, (void***) &seqs);
-    ajDebug("ajListToArray listed %d items\n", itest);
+    ajDebug("ajListToarray listed %d items\n", itest);
     seqarr = (AjPSeq*) seqs;
 
     for(i=0; i < isize; i++)
@@ -2866,7 +2866,7 @@
 	return;
 
     itest = ajListToarray(outseq->Savelist, (void***) &seqs);
-    ajDebug("ajListToArray listed %d items\n", itest);
+    ajDebug("ajListToarray listed %d items\n", itest);
     seqarr = (AjPSeq*) seqs;
 
     for(i=0; i < isize; i++)
@@ -2947,7 +2947,7 @@
 	return;
 
     itest = ajListToarray(outseq->Savelist, (void***) &seqs);
-    ajDebug("ajListToArray listed %d items\n", itest);
+    ajDebug("ajListToarray listed %d items\n", itest);
     seqarr = (AjPSeq*) seqs;
 
     for(i=0; i < isize; i++)
@@ -3014,7 +3014,7 @@
 	return;
     
     itest = ajListToarray(outseq->Savelist, (void***) &seqs);
-    ajDebug("ajListToArray listed %d items\n", itest);
+    ajDebug("ajListToarray listed %d items\n", itest);
     seqarr = (AjPSeq*) seqs;
 
     for(i=0; i < isize; i++)
@@ -3123,7 +3123,7 @@
 	return;
     
     test = ajListToarray(outseq->Savelist, (void***) &seqs);
-    ajDebug("ajListToArray listed %d items\n", test);
+    ajDebug("ajListToarray listed %d items\n", test);
     
     
     
@@ -3244,7 +3244,7 @@
 	    {
 		p = ajStrGetPtr(seqs[0]->Selexdata->rf);
 		if(i+50>=len)
-		    ajFmtPrintF(outseq->File,"%S %s\n",rfstr,&p[i]);
+		    ajFmtPrintF(outseq->File,"%S %s\n",rfstr, &p[i]);
 		else
 		    ajFmtPrintF(outseq->File,"%S %-50.50s\n",rfstr,
 				&p[i]);
@@ -3413,7 +3413,7 @@
     
     itest = ajListToarray(outseq->Savelist, (void***) &seqs);
     
-    ajDebug("ajListToArray listed %d items\n", itest);
+    ajDebug("ajListToarray listed %d items\n", itest);
     seqarr = (AjPSeq*) seqs;
     maxnamelen = 10;
 
@@ -6332,7 +6332,6 @@
     
     static SeqPSeqFormat sf = NULL;
     /*ajuint b[5];*/                /* was used for BASE COUNT line */
-    AjPStr ftfmt = NULL;
     AjPStr tmpstr = NULL;
     AjPStr tmpstr2 = NULL;
     const AjPStr tmpline = NULL;
@@ -6341,22 +6340,11 @@
     AjPStr cur;
     ajuint ilen;
    
-    if(!ftfmt)
-	ajStrAssignC(&ftfmt, "refseqp");
-    
     ajSeqoutTrace(outseq);
     
-    ajFmtPrintF(outseq->File, "LOCUS       %-17S %10u bp   ",
+    ajFmtPrintF(outseq->File, "LOCUS       %-9S %7u aa                   ",
 		outseq->Name, ajStrGetLen(outseq->Seq));
 
-    ajFmtPrintF(outseq->File, " %-7s",
-		    ajSeqmolGetGb(outseq->Molecule));
-
-    if(outseq->Circular)
-       ajFmtPrintF(outseq->File, " %-8s", "circular");
-    else
-       ajFmtPrintF(outseq->File, " %-8s", "linear");
-
     if(ajStrGetLen(outseq->Division))
        ajFmtPrintF(outseq->File, " %-3s",ajSeqdivGetGb(outseq->Division));
     else
@@ -6365,12 +6353,12 @@
     if(outseq->Date)
     {
 	if(outseq->Date->ModDate)
-	    ajFmtPrintF(outseq->File, " %D", outseq->Date->ModDate);
+	    ajFmtPrintF(outseq->File, "       %D", outseq->Date->ModDate);
 	else if(outseq->Date->CreDate)
-	    ajFmtPrintF(outseq->File, " %D", outseq->Date->CreDate);
+	    ajFmtPrintF(outseq->File, "       %D", outseq->Date->CreDate);
     }
     else
-	ajFmtPrintF(outseq->File, " %D", ajTimeRefTodayFmt("dtline"));
+	ajFmtPrintF(outseq->File, "       %D", ajTimeRefTodayFmt("dtline"));
        
     ajWritebinNewline(outseq->File);
 
@@ -6517,7 +6505,7 @@
 	    {
 		ajStrAssignS(&tmpstr, seqref->Position);
 		ajStrExchangeCC(&tmpstr, "-", " to ");
-		ajFmtPrintF(outseq->File, "  (bases %S)", tmpstr);
+		ajFmtPrintF(outseq->File, "  (residues %S)", tmpstr);
 	    }
 
 	    ajWritebinNewline(outseq->File);
@@ -6594,7 +6582,7 @@
     if(seqoutUfoLocal(outseq))
     {
 	ajFeattabOutDel(&outseq->Ftquery);
-        outseq->Ftquery = ajFeattabOutNewSSF(ftfmt, outseq->Name,
+        outseq->Ftquery = ajFeattabOutNewCSF("refseqp", outseq->Name,
 					     ajStrGetPtr(outseq->Type),
 					     outseq->File);
 	if(!ajFeattableWrite(outseq->Ftquery, outseq->Fttable))
@@ -6602,19 +6590,18 @@
 		   outseq->Ufo);
     }
 
-    ajFmtPrintF(outseq->File, "ORIGIN\n");
+    ajFmtPrintF(outseq->File, "ORIGIN      \n");
     
     seqSeqFormat(ajStrGetLen(outseq->Seq), &sf);
     strcpy(sf->endstr, "\n//");
-    sf->tab = 1;
+    sf->tab = 0;
     sf->spacer = 11;
     sf->width = 60;
     sf->numleft = ajTrue;
-    sf->numwidth = 8;
-    
+    sf->numwidth = 9;
+
     seqWriteSeq(outseq, sf);
     seqFormatDel(&sf);
-    ajStrDel(&ftfmt);
     ajStrDel(&tmpstr);
     ajStrDel(&tmpstr2);
 
@@ -6948,7 +6935,7 @@
 	return;
     
     itest = ajListToarray(outseq->Savelist, (void***) &seqs);
-    ajDebug("ajListToArray listed %d items\n", itest);
+    ajDebug("ajListToarray listed %d items\n", itest);
     seqarr = (AjPSeq*) seqs;
 
     for(i=0; i < isize; i++)
@@ -7044,7 +7031,7 @@
 	return;
     
     itest = ajListToarray(outseq->Savelist, (void***) &seqs);
-    ajDebug("ajListToArray listed %d items\n", itest);
+    ajDebug("ajListToarray listed %d items\n", itest);
     seqarr = (AjPSeq*) seqs;
 
     for(i=0; i < isize; i++)
@@ -7809,7 +7796,7 @@
 		fputc(' ',outf);
 	}
 	
-	l1++;			     /* don't count spaces for width*/
+	l1++;			     /* don't count spaces for width */
 
 	if(sf->numline)
 	{
@@ -8353,7 +8340,7 @@
 	single = ajFalse;
 
     if(single)
-    {				     /* ok, but nothing to open yet */
+    {				     /* OK, but nothing to open yet */
 	ajStrAssignEmptyS(&seqout->Extension, seqout->Formatstr);
 
 	return ajTrue;
@@ -9052,12 +9039,12 @@
 ** Initialises sequence output formatting parameters.
 **
 ** @param [r] seqlen [ajint] Sequence length
-** @param [u] psf [SeqPSeqFormat*] Sequence format object
+** @param [u] Psf [SeqPSeqFormat*] Sequence format object
 ** @return [void]
 ** @@
 ******************************************************************************/
 
-static void seqSeqFormat(ajint seqlen, SeqPSeqFormat* psf)
+static void seqSeqFormat(ajint seqlen, SeqPSeqFormat* Psf)
 {
     char numform[20];
     SeqPSeqFormat sf;
@@ -9072,9 +9059,9 @@
     sprintf(numform, "%d", seqlen);
     ajDebug("seqSeqFormat numwidth old: %d new: %d\n", strlen(numform)+1, j);
 
-    if(!*psf)
+    if(!*Psf)
     {
-	sf = AJNEW0(*psf);
+	sf = AJNEW0(*Psf);
 	sf->namewidth = 8;
 	sf->spacer    = 0;
 	sf->width     = 50;
@@ -9097,7 +9084,7 @@
 	/*sf->interline = 1;*/
     }
     else
-	sf = *psf;
+	sf = *Psf;
 
     sf->numwidth = j;		    /* or 8 as a reasonable minimum */
 
@@ -9124,7 +9111,7 @@
 ** @nam3rule Get Return an element or property
 ** @nam4rule Basecount Counts of nucleotide bases
 ** @nam4rule Checkgcg GCG checksum
-** @nam4rule Filename Ouptut filename
+** @nam4rule Filename Output filename
 **
 ** @argrule Get seqout [const AjPSeqout] Sequence output object
 ** @argrule Basecount bases [ajuint*] Base counts
@@ -10001,7 +9988,7 @@
 **
 ** Checks whether an output format should go to single files, rather than
 ** all sequences being written to one file. Some formats do not work when
-** more than one sequence is writte to a file. Obvious examples are plain
+** more than one sequence is written to a file. Obvious examples are plain
 ** text and GCG formats.
 **
 ** @param [r] format [const AjPStr] Output format required.
diff -Nurd EMBOSS-6.2.0/ajax/core/ajsys.c EMBOSS-6.2.0-patched/ajax/core/ajsys.c
--- EMBOSS-6.2.0/ajax/core/ajsys.c	2009-12-11 10:49:35.000000000 -0500
+++ EMBOSS-6.2.0-patched/ajax/core/ajsys.c	2010-03-02 05:20:41.000000000 -0500
@@ -259,7 +259,7 @@
 ** Needed for very fussy compilers i.e. Digital C
 **
 ** @param [r] v [ajint] integer
-** @return [unsigned char] Unisigned character cast
+** @return [unsigned char] Unsigned character cast
 ** @@
 ******************************************************************************/
 
@@ -387,8 +387,12 @@
 
     while(1)
     {
+#if !defined(WIN32) && !defined(__CYGWIN__)
 	ajFmtPrintS(&sysFname,"%s%s%S",p,SLASH_STRING,sysTname);
-
+#else
+	ajFmtPrintS(&sysFname,"%s%s%S.exe",p,SLASH_STRING,sysTname);
+#endif
+        
 	if(ajFilenameExistsExec(sysFname))
 	{
 	    ajStrAssignS(Pfilename,sysFname);
diff -Nurd EMBOSS-6.2.0/ajax/graphics/Makefile.in EMBOSS-6.2.0-patched/ajax/graphics/Makefile.in
--- EMBOSS-6.2.0/ajax/graphics/Makefile.in	2010-01-15 05:54:40.000000000 -0500
+++ EMBOSS-6.2.0-patched/ajax/graphics/Makefile.in	2010-03-08 09:42:22.000000000 -0500
@@ -72,7 +72,7 @@
   sed '$$!N;$$!N;$$!N;$$!N;s/\n/ /g'
 am__installdirs = "$(DESTDIR)$(libdir)" "$(DESTDIR)$(includedir)"
 LTLIBRARIES = $(lib_LTLIBRARIES)
-libajaxg_la_LIBADD =
+libajaxg_la_LIBADD = ../core/libajax.la ../../plplot/libeplplot.la
 am__objects_1 = ajgraph.lo ajhist.lo
 am_libajaxg_la_OBJECTS = $(am__objects_1)
 libajaxg_la_OBJECTS = $(am_libajaxg_la_OBJECTS)
diff -Nurd EMBOSS-6.2.0/ajax/graphics/ajgraph.c EMBOSS-6.2.0-patched/ajax/graphics/ajgraph.c
--- EMBOSS-6.2.0/ajax/graphics/ajgraph.c	2010-01-08 07:41:06.000000000 -0500
+++ EMBOSS-6.2.0-patched/ajax/graphics/ajgraph.c	2010-03-02 05:20:41.000000000 -0500
@@ -302,7 +302,7 @@
 #endif
 
 #ifdef PLD_png          /* if png/gd/zlib libraries available for png driver */
-    {"png",        "png",     ".png",   640,  480,
+    {"png",        "png",     ".png",   800,  600,
      AJTRUE,  AJFALSE, AJFALSE, AJFALSE, AJFALSE,  AJFALSE,
      GraphxyDisplayToFile, GraphOpenFile,
      "PNG graphics files"},
@@ -843,7 +843,7 @@
 **
 ** Set internal graph device to that selected for a graph object
 **
-** @param [r] graph [const AjPGraph] Graph object with displaytype set
+** @param [r] graph [const AjPGraph] Graph object with display type set
 **
 ** @return [void]
 ** @@
@@ -891,7 +891,7 @@
     col = colour;
 
     /* in case of looping through colours */
-    /* start at the begining once past end */
+    /* start at the beginning once past end */
     while(col > MAXCOL)
 	col -= (MAXCOL+1);
 
@@ -1117,7 +1117,8 @@
     fold = ajGraphicsSetCharscale(0.0);
     ajGraphicsSetCharscale(fold/(float)2.0);
 
-    ajDebug("=g= plmtex('t', 1.5, 0.5, 0.5, '%S') [subtitle]\n", strsubtitle);
+    ajDebug("=g= plmtex('t', 1.5, 0.5, 0.5, '%s') [subtitle]\n",
+            MAJSTRGETPTR(strsubtitle));
     plmtex("t", (PLFLT) 1.5, (PLFLT) 0.5, (PLFLT) 0.5,
            MAJSTRGETPTR(strsubtitle));
 
@@ -1568,7 +1569,7 @@
 
 /* @func ajGraphicsBasecolourNewNuc ********************************************
 **
-** Initialize a base colours array for a string of nucleotide
+** Initialise a base colours array for a string of nucleotide
 ** sequence characters
 **
 ** @param [r] codes [const AjPStr] Residue codes for each numbered position
@@ -1635,7 +1636,7 @@
 **
 ** Initialize a base colours array for a string of protein sequence characters
 ** according to the following colour scheme designed by Toby Gibson (EMBL
-** Heidelberg) to show the chemical propoerties important in sequence
+** Heidelberg) to show the chemical properties important in sequence
 ** and structure alignment and to be clear to those with common forms
 ** of colour blindness.
 **
@@ -2061,8 +2062,8 @@
 **
 ** Draw a portion of a circle (an arc).
 **
-** @param  [r] xcentre [PLFLT] x coor for centre.
-** @param  [r] ycentre [PLFLT] y coor for centre.
+** @param  [r] xcentre [PLFLT] x coord for centre.
+** @param  [r] ycentre [PLFLT] y coord for centre.
 ** @param  [r] radius  [PLFLT] radius of the circle.
 ** @param  [r] startangle [PLFLT] angle of the start of the arc.
 ** @param  [r] endangle [PLFLT] angle of the end of the arc.
@@ -2087,6 +2088,9 @@
     if(endangle < startangle)
         stopangle += 360.0;
 
+    if((stopangle-startangle)>=360.0)
+        stopangle = startangle + (float) 360.0;
+
     x[0] = xcentre + ( radius*(float)cos(ajCvtDegToRad(startangle)) );
     y[0] = ycentre + ( radius*(float)sin(ajCvtDegToRad(startangle)) );
 
@@ -2126,8 +2130,8 @@
 **
 ** Draw a rectangle along a curve with the current pen colour/style.
 **
-** @param  [r] xcentre [PLFLT] x coor for centre.
-** @param  [r] ycentre [PLFLT] y coor for centre.
+** @param  [r] xcentre [PLFLT] x coord for centre.
+** @param  [r] ycentre [PLFLT] y coord for centre.
 ** @param  [r] radius  [PLFLT] radius of the circle.
 ** @param  [r] startangle [PLFLT] angle of the start of the rectangle.
 ** @param  [r] endangle [PLFLT] angle of the end of the rectangle.
@@ -2187,8 +2191,8 @@
 ** Draw a rectangle along a curve and fill it with the current pen
 ** colour/style.
 **
-** @param  [r] xcentre [PLFLT] x coor for centre.
-** @param  [r] ycentre [PLFLT] y coor for centre.
+** @param  [r] xcentre [PLFLT] x coord for centre.
+** @param  [r] ycentre [PLFLT] y coord for centre.
 ** @param  [r] radius  [PLFLT] radius of the circle.
 ** @param  [r] startangle [PLFLT] angle of the start of the rectangle.
 ** @param  [r] endangle [PLFLT] angle of the end of the rectangle.
@@ -2213,6 +2217,9 @@
     if(endangle < startangle)
         stopangle += 360.0;
 
+    if((stopangle-startangle)>=360.0)
+        stopangle = startangle + (float) 360.0;
+
     r1Blocks = radius;
     r2Blocks = r1Blocks+height;
 
@@ -2271,8 +2278,8 @@
 ** written character by character, forwards or backwards depending on
 ** the angle.
 **
-** @param  [r] xcentre [PLFLT] x coor for centre.
-** @param  [r] ycentre [PLFLT] y coor for centre.
+** @param  [r] xcentre [PLFLT] x coord for centre.
+** @param  [r] ycentre [PLFLT] y coord for centre.
 ** @param  [r] radius  [PLFLT] radius of the circle.
 ** @param  [r] startangle [PLFLT] angle of the start of the arc (in deg).
 ** @param  [r] endangle [PLFLT] angle of the end of the arc (in deg).
@@ -2520,8 +2527,8 @@
 **
 ** Draw a circle.
 **
-** @param  [r] x [PLFLT] x coor for centre.
-** @param  [r] y [PLFLT] y coor for centre.
+** @param  [r] x [PLFLT] x coord for centre.
+** @param  [r] y [PLFLT] y coord for centre.
 ** @param  [r] radius  [float] radius of the circle.
 ** @return [void]
 ** @@
@@ -2710,10 +2717,10 @@
 **
 ** Draw a rectangle with the current pen colour/style.
 **
-** @param [r] x [PLFLT] xx0 coor.
-** @param [r] y [PLFLT] yy0 coor.
-** @param [r] x2 [PLFLT] xx1 coor.
-** @param [r] y2 [PLFLT] yy1 coor.
+** @param [r] x [PLFLT] xx0 coord.
+** @param [r] y [PLFLT] yy0 coord.
+** @param [r] x2 [PLFLT] xx1 coord.
+** @param [r] y2 [PLFLT] yy1 coord.
 ** @return [void]
 **
 ** @@
@@ -2768,10 +2775,10 @@
 **
 ** Draw a rectangle and fill it with the current pen colour/style.
 **
-** @param [r] x [PLFLT] xx0 coor.
-** @param [r] y [PLFLT] yy0 coor.
-** @param [r] x2 [PLFLT] xx1 coor.
-** @param [r] y2 [PLFLT] yy1 coor.
+** @param [r] x [PLFLT] xx0 coord.
+** @param [r] y [PLFLT] yy0 coord.
+** @param [r] x2 [PLFLT] xx1 coord.
+** @param [r] y2 [PLFLT] yy1 coord.
 ** @return [void]
 **
 ** @@
@@ -2823,8 +2830,8 @@
 **
 ** Draw text ending at position (xx1,yy1)
 **
-** @param [r] x [PLFLT] xx1 coor.
-** @param [r] y [PLFLT] yy1 coor.
+** @param [r] x [PLFLT] xx1 coord.
+** @param [r] y [PLFLT] yy1 coord.
 ** @param [r] txt [const char*] The text to be displayed.
 ** @return [void]
 **
@@ -2863,10 +2870,10 @@
 **
 ** Draw text along a line.
 **
-** @param [r] x [PLFLT] x1 coor.
-** @param [r] y [PLFLT] y1 coor.
-** @param [r] x2 [PLFLT] x2 coor.
-** @param [r] y2 [PLFLT] y2 coor.
+** @param [r] x [PLFLT] x1 coord.
+** @param [r] y [PLFLT] y1 coord.
+** @param [r] x2 [PLFLT] x2 coord.
+** @param [r] y2 [PLFLT] y2 coord.
 ** @param [r] txt [const char*] The text to be displayed.
 ** @param [r] just [PLFLT] justification of the string.
 **                         (0=left,1=right,0.5=middle etc)
@@ -2912,8 +2919,8 @@
 **
 ** For graph data type, writes directly.
 **
-** @param [r] x [PLFLT] xx1 coor.
-** @param [r] y [PLFLT] yy1 coor.
+** @param [r] x [PLFLT] xx1 coord.
+** @param [r] y [PLFLT] yy1 coord.
 ** @param [r] txt [const char*] The text to be displayed.
 ** @return [void]
 **
@@ -2994,8 +3001,8 @@
 ** Draw text, positioning with respect to (xx1,yy1) by justified as
 ** defined by just.
 **
-** @param [r] x [PLFLT] xx1 coor.
-** @param [r] y [PLFLT] yy1 coor.
+** @param [r] x [PLFLT] xx1 coord.
+** @param [r] y [PLFLT] yy1 coord.
 ** @param [r] txt [const char*] The text to be displayed.
 ** @param [r] just [PLFLT] justification of the string.
 **                         (0=left,1=right,0.5=middle etc)
@@ -3356,14 +3363,14 @@
 ** @suffix C Character data
 ** @suffix S String object data
 **
-** @argrule Charsize xx1 [PLFLT] xx1 coor.
-** @argrule Charsize yy1 [PLFLT] yy1 coor.
-** @argrule Charsize xx2 [PLFLT] xx2 coor.
-** @argrule Charsize yy2 [PLFLT] yy2 coor.
+** @argrule Charsize xx1 [PLFLT] xx1 coord.
+** @argrule Charsize yy1 [PLFLT] yy1 coord.
+** @argrule Charsize xx2 [PLFLT] xx2 coord.
+** @argrule Charsize yy2 [PLFLT] yy2 coord.
 ** @argrule Charsize text [const char*] The text to be displayed.
 ** @argrule Charsize TextHeight [PLFLT] The height of the text (in user coord).
-** @argrule Coord x [PLFLT] x coor for centre.
-** @argrule Coord y [PLFLT] y coor for centre.
+** @argrule Coord x [PLFLT] x coord for centre.
+** @argrule Coord y [PLFLT] y coord for centre.
 ** @argrule Coord radius [PLFLT] Radius of the circle.
 ** @argrule Coord angle [PLFLT] angle at which the point is.
 ** @argrule Distance xx1 [PLFLT] x coord of point 1
@@ -3372,7 +3379,7 @@
 ** @argrule Distance yy2 [PLFLT] y coord of point 2
 ** @argrule Range array [const float*] array
 ** @argrule Range npoints [ajuint] Number of data points
-** @argrule Range min [float*] min. value ikn array
+** @argrule Range min [float*] min. value in array
 ** @argrule Range max [float*] max. value in array
 ** @argrule [r] C txt [const char*] Text
 ** @argrule [r] S str [const AjPStr] Text
@@ -3395,10 +3402,10 @@
 ** TextHeight.  If the default size is too large, characters are
 ** shrunk. If it is too small, characters are enlarged.
 **
-** @param [r] xx1 [PLFLT] xx1 coor.
-** @param [r] yy1 [PLFLT] yy1 coor.
-** @param [r] xx2 [PLFLT] xx2 coor.
-** @param [r] yy2 [PLFLT] yy2 coor.
+** @param [r] xx1 [PLFLT] xx1 coord.
+** @param [r] yy1 [PLFLT] yy1 coord.
+** @param [r] xx2 [PLFLT] xx2 coord.
+** @param [r] yy2 [PLFLT] yy2 coord.
 ** @param [r] text [const char*] The text to be displayed.
 ** @param [r] TextHeight [PLFLT] The height of the text (in user coord).
 ** @return [PLFLT] The character size (in mm) that fits the specified
@@ -3470,8 +3477,8 @@
 **
 ** compute the coordinates of a point on a circle knowing the angle.
 **
-** @param  [r] x [PLFLT] x coor for centre.
-** @param  [r] y [PLFLT] y coor for centre.
+** @param  [r] x [PLFLT] x coord for centre.
+** @param  [r] y [PLFLT] y coord for centre.
 ** @param  [r] radius  [PLFLT] Radius of the circle.
 ** @param  [r] angle [PLFLT] angle at which the point is.
 ** @return [PLFLT*] The x and y coordinates of the point.
@@ -3548,8 +3555,8 @@
 {
     ajuint i;
 
-    *min = 64000.;
-    *max = -64000.;
+    *min = FLT_MAX;
+    *max = FLT_MIN;
 
     for(i=0;i<npoints;++i)
     {
@@ -3557,6 +3564,12 @@
 	*max = (*max > array[i]) ? *max : array[i];
     }
 
+    if(*min == *max)
+    {
+        *min *= (float) 0.9;
+        *max *= (float) 1.1;
+    }
+
     return;
 }
 
@@ -3767,7 +3780,7 @@
 ** @fdata [AjPGraph]
 ** @fcategory modify
 **
-** @nam3rule Init Initialise a grah object
+** @nam3rule Init Initialise a graph object
 ** @nam4rule InitSeq Initialises using default values based on a sequence.
 ** @nam3rule Open Open a plot
 ** @nam3rule Newpage Start a new plot page
@@ -6082,8 +6095,8 @@
 ** @nam4rule Yaxis Set the graph is to display a Y axis.
 ** @nam4rule Xlabel Set whether the graph is to label the x axis.
 ** @nam4rule Ylabel Set whether the graph is to label the y axis.
-** @nam4rule Xtick Set whether the graph is to tickmark the x axis.
-** @nam4rule Ytick Set whether the graph is to tickmark the y axis.
+** @nam4rule Xtick Set whether the graph is to tick mark the x axis.
+** @nam4rule Ytick Set whether the graph is to tick mark the y axis.
 ** @nam4rule Xend Set the end position for X in the graph.
 ** @nam4rule Yend Set the end position for Y in the graph.
 ** @nam4rule Xgrid Whether the graph is to grid the tick marks on the x axis
@@ -7077,7 +7090,7 @@
     return;
 }
 
-/* @datasection [AjPGraphdata] Graph dataobject ********************************
+/* @datasection [AjPGraphdata] Graph data object ********************************
 **
 ** Function is for manipulating an AjPGraphdata object
 **
@@ -7093,7 +7106,7 @@
 **
 ** @nam3rule New Constructor
 ** @suffix I Number of points
-** @argrule I numofpoints [ajuint] Nuymber of points
+** @argrule I numofpoints [ajuint] Number of points
 **
 ** @valrule * [AjPGraphdata] New graphdata object
 **
@@ -7772,8 +7785,9 @@
     {
 	/*
 	** Use the whole screen. User may add boundaries by
-	** modifying xmin, xmax et
+	** modifying xmin, xmax etc.
 	*/
+        plvpor (0.0,1.0,0.0,1.0);
 	GraphWind(xmin, xmax, ymin, ymax);
     }
 
@@ -8854,7 +8868,7 @@
 void ajGraphicsListDevices (AjPList list)
 {
     ajint i;
-    AjPStr devname;
+    AjPStr devicename;
 
     for(i=0;graphType[i].Name;i++)
     {
@@ -8863,8 +8877,8 @@
 
 	if(!graphType[i].Alias)
 	{
-	    devname = ajStrNewC(graphType[i].Name);
-	    ajListstrPushAppend(list, devname);
+	    devicename = ajStrNewC(graphType[i].Name);
+	    ajListstrPushAppend(list, devicename);
 	}
     }
 
@@ -9011,6 +9025,8 @@
 }
 
 
+
+
 /* @obsolete ajGraphxyDumpDevices
 ** @rename ajGraphicsxyDumpDevices
 */
@@ -9022,6 +9038,7 @@
 
 
 
+
 /* @func ajGraphicsxyListDevices **********************************************
 **
 ** Store device names for a graph object in a list
@@ -9034,7 +9051,7 @@
 void ajGraphicsxyListDevices (AjPList list)
 {
     ajint i;
-    AjPStr devname;
+    AjPStr devicename;
 
     for(i=0;graphType[i].Name;i++)
     {
@@ -9043,14 +9060,17 @@
 
 	if(!graphType[i].Alias)
 	{
-	    devname = ajStrNewC(graphType[i].Name);
-	    ajListstrPushAppend(list, devname);
+	    devicename = ajStrNewC(graphType[i].Name);
+	    ajListstrPushAppend(list, devicename);
 	}
     }
 
     return;
 }
 
+
+
+
 /* @obsolete ajGraphxyListDevices
 ** @rename ajGraphicsxyListDevices
 */
@@ -9061,6 +9081,8 @@
 }
 
 
+
+
 /* @funcstatic GraphCheckFlags ************************************************
 **
 ** Prints the flags defined by bits in the input integer value.
@@ -9338,7 +9360,7 @@
     **
     ** Test this output
     ** Check how it handles multiple sequences
-    ** Try to catch the sequnce information
+    ** Try to catch the sequence information
     **
     ** Do we want end=start or end=start+1
     **
@@ -9566,7 +9588,7 @@
 	    ajFmtPrintF(outf,"%f\t%f\n",graphdata->x[j],graphdata->y[j]);
 	
 	
-	/* Now for the Data graphobjs */
+	/* Now for the Data graph objects */
 	ajFmtPrintF(outf,"##DataObjects\n##Number %d\n",
 		    graphdata->numofobjects);
 	
@@ -9605,7 +9627,7 @@
 	}
 	
 	
-	/* Now for the Graph graphobjs */
+	/* Now for the Graph graph objects */
 	ajFmtPrintF(outf,"##GraphObjects\n##Number %d\n",
 		    thys->numofobjects);
 	
@@ -10058,8 +10080,8 @@
 ** Draw text along a curve (i.e., an arc of a circle).
 ** The text is written character by character.
 **
-** @param  [r] xcentre [PLFLT] x coor for centre.
-** @param  [r] ycentre [PLFLT] y coor for centre.
+** @param  [r] xcentre [PLFLT] x coord for centre.
+** @param  [r] ycentre [PLFLT] y coord for centre.
 ** @param  [r] Radius  [PLFLT] Radius of the circle.
 ** @param  [r] Angle [PLFLT] angle at which a particular character
 **                           will be written (in deg).
diff -Nurd EMBOSS-6.2.0/doc/programs/html/Makefile.am EMBOSS-6.2.0-patched/doc/programs/html/Makefile.am
--- EMBOSS-6.2.0/doc/programs/html/Makefile.am	2010-01-12 12:32:32.000000000 -0500
+++ EMBOSS-6.2.0-patched/doc/programs/html/Makefile.am	2010-03-02 05:20:41.000000000 -0500
@@ -1,7 +1,8 @@
 pkgdata_DATA =  abiview.1.abiview.gif \
 	banana.1.banana.gif \
 	chaos.1.chaos.gif cirdna.1.cirdna.gif cpgplot.1.cpgplot.gif \
-	dan.2.dan.gif dotmatcher.1.dotmatcher.gif \
+	dan.2.dan.gif density.2.density.gif density.3.density.gif \
+	dotmatcher.1.dotmatcher.gif \
 	dotpath.1.dotpath.gif dottup.1.dottup.gif \
 	emboss_icon.gif epestfind.1.epestfind.gif \
 	findkm.1.findkm.gif \
diff -Nurd EMBOSS-6.2.0/doc/programs/html/Makefile.in EMBOSS-6.2.0-patched/doc/programs/html/Makefile.in
--- EMBOSS-6.2.0/doc/programs/html/Makefile.in	2010-01-15 05:54:40.000000000 -0500
+++ EMBOSS-6.2.0-patched/doc/programs/html/Makefile.in	2010-03-02 05:20:41.000000000 -0500
@@ -224,7 +224,8 @@
 pkgdata_DATA = abiview.1.abiview.gif \
 	banana.1.banana.gif \
 	chaos.1.chaos.gif cirdna.1.cirdna.gif cpgplot.1.cpgplot.gif \
-	dan.2.dan.gif dotmatcher.1.dotmatcher.gif \
+	dan.2.dan.gif density.2.density.gif density.3.density.gif \
+	dotmatcher.1.dotmatcher.gif \
 	dotpath.1.dotpath.gif dottup.1.dottup.gif \
 	emboss_icon.gif epestfind.1.epestfind.gif \
 	findkm.1.findkm.gif \
diff -Nurd EMBOSS-6.2.0/doc/programs/html/extractfeat.html EMBOSS-6.2.0-patched/doc/programs/html/extractfeat.html
--- EMBOSS-6.2.0/doc/programs/html/extractfeat.html	2010-01-08 07:51:28.000000000 -0500
+++ EMBOSS-6.2.0-patched/doc/programs/html/extractfeat.html	2010-03-02 05:20:41.000000000 -0500
@@ -205,9 +205,9 @@
    -type               string     [*] By default every feature in the feature
                                   table is extracted. You can set this to be
                                   any feature type you wish to extract.
-                                  See http://www.ebi.ac.uk/Services/WebFeat/
-                                  for a list of the EMBL feature types and see
-                                  the Uniprot user manual in
+                                  See http://www.ebi.ac.uk/embl/WebFeat/ for a
+                                  list of the EMBL feature types and see the
+                                  Uniprot user manual in
                                   http://www.uniprot.org/manual/sequence_annotation
                                   for a list of the Uniprot feature types.
                                   The type may be wildcarded by using '*'.
@@ -264,7 +264,8 @@
                                   '/gene' can have the value of the gene name.
                                   By default any feature tag value in the
                                   feature table is shown. You can set this to
-                                  match any feature tag valueyou wish to show.
+                                  match any feature tag value you wish to
+                                  show.
                                   The tag value may be wildcarded by using
                                   '*'.
                                   If you wish to show more than one tag value,
@@ -439,7 +440,7 @@
 <td>-type</td>
 <td>string</td>
 <td>By default every feature in the feature table is extracted. You can set this to be any feature type you wish to extract.
-See http://www.ebi.ac.uk/Services/WebFeat/ for a list of the EMBL feature types and see the Uniprot user manual in http://www.uniprot.org/manual/sequence_annotation for a list of the Uniprot feature types.
+See http://www.ebi.ac.uk/embl/WebFeat/ for a list of the EMBL feature types and see the Uniprot user manual in http://www.uniprot.org/manual/sequence_annotation for a list of the Uniprot feature types.
 The type may be wildcarded by using '*'.
 If you wish to extract more than one type, separate their names with the character '|', eg:
 *UTR | intron</td>
@@ -487,7 +488,7 @@
 <tr bgcolor="#FFFFCC">
 <td>-value</td>
 <td>string</td>
-<td>Tag values are the values associated with a feature tag. Tags are the types of extra values that a feature may have. For example in the EMBL feature table, a 'CDS' type of feature may have the tags '/codon', '/codon_start', '/db_xref', '/EC_number', '/evidence', '/exception', '/function', '/gene', '/label', '/map', '/note', '/number', '/partial', '/product', '/protein_id', '/pseudo', '/standard_name', '/translation', '/transl_except', '/transl_table', or '/usedin'. Only some of these tags can have values, for example '/gene' can have the value of the gene name. By default any feature tag value in the feature table is shown. You can set this to match any feature tag valueyou wish to show.
+<td>Tag values are the values associated with a feature tag. Tags are the types of extra values that a feature may have. For example in the EMBL feature table, a 'CDS' type of feature may have the tags '/codon', '/codon_start', '/db_xref', '/EC_number', '/evidence', '/exception', '/function', '/gene', '/label', '/map', '/note', '/number', '/partial', '/product', '/protein_id', '/pseudo', '/standard_name', '/translation', '/transl_except', '/transl_table', or '/usedin'. Only some of these tags can have values, for example '/gene' can have the value of the gene name. By default any feature tag value in the feature table is shown. You can set this to match any feature tag value you wish to show.
 The tag value may be wildcarded by using '*'.
 If you wish to show more than one tag value, separate their names with a space or the character '|', eg:
 pax* | 10</td>
@@ -1582,11 +1583,13 @@
     Author(s)
 </H2>
 
-Gary Williams (gwilliam&nbsp;&copy;&nbsp;rfcgr.mrc.ac.uk)
+Gary Williams formerly at:
 <br>
 MRC Rosalind Franklin Centre for Genomics Research
 Wellcome Trust Genome Campus, Hinxton, Cambridge, CB10 1SB, UK
 
+<p>
+Please report all bugs to the EMBOSS bug team (emboss-bug&nbsp;&copy;&nbsp;emboss.open-bio.org) not to the original author.
 
 <H2>
     History
diff -Nurd EMBOSS-6.2.0/doc/programs/html/maskfeat.html EMBOSS-6.2.0-patched/doc/programs/html/maskfeat.html
--- EMBOSS-6.2.0/doc/programs/html/maskfeat.html	2010-01-08 07:51:29.000000000 -0500
+++ EMBOSS-6.2.0-patched/doc/programs/html/maskfeat.html	2010-03-02 05:20:41.000000000 -0500
@@ -104,11 +104,11 @@
                                   feature table with a type starting 'repeat'
                                   is masked. You can set this to be any
                                   feature type you wish to mask.
-                                  See http://www3.ebi.ac.uk/Services/WebFeat/
-                                  for a list of the EMBL feature types and see
+                                  See http://www.ebi.ac.uk/embl/WebFeat/ for a
+                                  list of the EMBL feature types and see
                                   Appendix A of the Swissprot user manual in
-                                  http://www.expasy.ch/txt/userman.txt for a
-                                  list of the Swissprot feature types.
+                                  http://www.expasy.org/sprot/userman.html for
+                                  a list of the Swissprot feature types.
                                   The type may be wildcarded by using '*'.
                                   If you wish to mask more than one type,
                                   separate their names with spaces or commas,
@@ -222,7 +222,7 @@
 <td>-type</td>
 <td>string</td>
 <td>By default any feature in the feature table with a type starting 'repeat' is masked. You can set this to be any feature type you wish to mask.
-See http://www3.ebi.ac.uk/Services/WebFeat/ for a list of the EMBL feature types and see Appendix A of the Swissprot user manual in http://www.expasy.ch/txt/userman.txt for a list of the Swissprot feature types.
+See http://www.ebi.ac.uk/embl/WebFeat/ for a list of the EMBL feature types and see Appendix A of the Swissprot user manual in http://www.expasy.org/sprot/userman.html for a list of the Swissprot feature types.
 The type may be wildcarded by using '*'.
 If you wish to mask more than one type, separate their names with spaces or commas, eg:
 *UTR repeat*</td>
@@ -1112,11 +1112,13 @@
 </H2>
 
 
-Gary Williams (gwilliam&nbsp;&copy;&nbsp;rfcgr.mrc.ac.uk)
+Gary Williams formerly at:
 <br>
 MRC Rosalind Franklin Centre for Genomics Research
 Wellcome Trust Genome Campus, Hinxton, Cambridge, CB10 1SB, UK
 
+<p>
+Please report all bugs to the EMBOSS bug team (emboss-bug&nbsp;&copy;&nbsp;emboss.open-bio.org) not to the original author.
 
 
 <H2>
diff -Nurd EMBOSS-6.2.0/doc/programs/html/showfeat.html EMBOSS-6.2.0-patched/doc/programs/html/showfeat.html
--- EMBOSS-6.2.0/doc/programs/html/showfeat.html	2010-01-08 07:51:29.000000000 -0500
+++ EMBOSS-6.2.0-patched/doc/programs/html/showfeat.html	2010-03-02 05:20:41.000000000 -0500
@@ -126,11 +126,11 @@
    -typematch          string     [*] By default any feature type in the
                                   feature table is shown. You can set this to
                                   match any feature type you wish to show.
-                                  See http://www3.ebi.ac.uk/Services/WebFeat/
-                                  for a list of the EMBL feature types and see
+                                  See http://www.ebi.ac.uk/embl/WebFeat/ for a
+                                  list of the EMBL feature types and see
                                   Appendix A of the Swissprot user manual in
-                                  http://www.expasy.ch/txt/userman.txt for a
-                                  list of the Swissprot feature types.
+                                  http://www.expasy.org/sprot/userman.html for
+                                  a list of the Swissprot feature types.
                                   The type may be wildcarded by using '*'.
                                   If you wish to show more than one type,
                                   separate their names with the character '|',
@@ -173,7 +173,8 @@
                                   '/gene' can have the value of the gene name.
                                   By default any feature tag value in the
                                   feature table is shown. You can set this to
-                                  match any feature tag valueyou wish to show.
+                                  match any feature tag value you wish to
+                                  show.
                                   The tag value may be wildcarded by using
                                   '*'.
                                   If you wish to show more than one tag value,
@@ -373,7 +374,7 @@
 <td>-typematch</td>
 <td>string</td>
 <td>By default any feature type in the feature table is shown. You can set this to match any feature type you wish to show.
-See http://www3.ebi.ac.uk/Services/WebFeat/ for a list of the EMBL feature types and see Appendix A of the Swissprot user manual in http://www.expasy.ch/txt/userman.txt for a list of the Swissprot feature types.
+See http://www.ebi.ac.uk/embl/WebFeat/ for a list of the EMBL feature types and see Appendix A of the Swissprot user manual in http://www.expasy.org/sprot/userman.html for a list of the Swissprot feature types.
 The type may be wildcarded by using '*'.
 If you wish to show more than one type, separate their names with the character '|', eg:
 *UTR | intron</td>
@@ -396,7 +397,7 @@
 <tr bgcolor="#FFFFCC">
 <td>-valuematch</td>
 <td>string</td>
-<td>Tag values are the values associated with a feature tag. Tags are the types of extra values that a feature may have. For example in the EMBL feature table, a 'CDS' type of feature may have the tags '/codon', '/codon_start', '/db_xref', '/EC_number', '/evidence', '/exception', '/function', '/gene', '/label', '/map', '/note', '/number', '/partial', '/product', '/protein_id', '/pseudo', '/standard_name', '/translation', '/transl_except', '/transl_table', or '/usedin'. Only some of these tags can have values, for example '/gene' can have the value of the gene name. By default any feature tag value in the feature table is shown. You can set this to match any feature tag valueyou wish to show.
+<td>Tag values are the values associated with a feature tag. Tags are the types of extra values that a feature may have. For example in the EMBL feature table, a 'CDS' type of feature may have the tags '/codon', '/codon_start', '/db_xref', '/EC_number', '/evidence', '/exception', '/function', '/gene', '/label', '/map', '/note', '/number', '/partial', '/product', '/protein_id', '/pseudo', '/standard_name', '/translation', '/transl_except', '/transl_table', or '/usedin'. Only some of these tags can have values, for example '/gene' can have the value of the gene name. By default any feature tag value in the feature table is shown. You can set this to match any feature tag value you wish to show.
 The tag value may be wildcarded by using '*'.
 If you wish to show more than one tag value, separate their names with the character '|', eg:
 pax* | 10</td>
@@ -953,26 +954,26 @@
 X65921
 H.sapiens fau 1 gene
 |==========================================================| 2016
-|----------------------------------------------------------&gt; source
-           |--&gt;                                              exon
-           |--&gt;                                              mRNA
-              |-------&gt;                                      intron
-                      |-&gt;                                    exon
-                      |-&gt;                                    mRNA
-                      |-&gt;                                    CDS
+                                                        &gt;    polyA_signal
+                                                    |--&gt;     exon
+                                               |----&gt;        intron
+                                             |&gt;              exon
+                               |-------------&gt;               intron
+                           |---&gt;                             exon
                         |--&gt;                                 intron
+                      |-&gt;                                    CDS
                            |---&gt;                             CDS
-                           |---&gt;                             exon
-                           |---&gt;                             mRNA
-                               |-------------&gt;               intron
                                              |&gt;              CDS
-                                             |&gt;              exon
-                                             |&gt;              mRNA
-                                               |----&gt;        intron
                                                     |--&gt;     CDS
-                                                    |--&gt;     exon
+                      |-&gt;                                    exon
+              |-------&gt;                                      intron
+           |--&gt;                                              mRNA
+                      |-&gt;                                    mRNA
+                           |---&gt;                             mRNA
+                                             |&gt;              mRNA
                                                     |--&gt;     mRNA
-                                                        &gt;    polyA_signal
+           |--&gt;                                              exon
+|----------------------------------------------------------&gt; source
 
 </pre>
 </td></tr></table><p>
@@ -985,19 +986,19 @@
 X65921
 H.sapiens fau 1 gene
 |==========================================================| 2016
-|----------------------------------------------------------&gt; 1-2016 source
-           |--&gt;                                              408-504 exon
-           |--&gt;                                              408-504 mRNA
-              |-------&gt;                                      505-773 intron
-                      |-&gt;                                    774-856,774-856 exon
-                      |-&gt;                                    782-856 CDS
-                        |--|---&gt;                             857-950,951-1095 intron
-                           |---&gt;                             951-1095,951-1095 exon
-                               |-------------|&gt;              1096-1556,1557-1612 intron
-                                             |&gt;              1557-1612,1557-1612 exon
-                                               |----|--&gt;     1613-1786,1787-1912 intron
-                                                    |--&gt;     1787-1912,1787-1912 exon
                                                         &gt;    1938-1943 polyA_signal
+                                                    |--&gt;     1787-1912 exon
+                                               |----&gt;        1613-1786 intron
+                                             |&gt;              1557-1612 exon
+                               |-------------&gt;               1096-1556 intron
+                           |---&gt;                             951-1095 exon
+                        |--&gt;                                 857-950 intron
+                      |-&gt;  |---&gt;             |&gt;     |--&gt;     782-856,951-1095,1557-1612,1787-1912 CDS
+                      |-&gt;                                    774-856 exon
+              |-------&gt;                                      505-773 intron
+           |--&gt;       |-&gt;  |---&gt;             |&gt;     |--&gt;     408-504,774-856,951-1095,1557-1612,1787-1912 mRNA
+           |--&gt;                                              408-504 exon
+|----------------------------------------------------------&gt; 1-2016 source
 
 </pre>
 </td></tr></table><p>
@@ -1175,11 +1176,13 @@
 <H2>
     Author(s)
 </H2>
-Gary Williams (gwilliam&nbsp;&copy;&nbsp;rfcgr.mrc.ac.uk)
+Gary Williams formerly at:
 <br>
 MRC Rosalind Franklin Centre for Genomics Research
 Wellcome Trust Genome Campus, Hinxton, Cambridge, CB10 1SB, UK
 
+<p>
+Please report all bugs to the EMBOSS bug team (emboss-bug&nbsp;&copy;&nbsp;emboss.open-bio.org) not to the original author.
 
 
 
diff -Nurd EMBOSS-6.2.0/doc/programs/html/showpep.html EMBOSS-6.2.0-patched/doc/programs/html/showpep.html
--- EMBOSS-6.2.0/doc/programs/html/showpep.html	2010-01-08 07:51:29.000000000 -0500
+++ EMBOSS-6.2.0-patched/doc/programs/html/showpep.html	2010-03-02 05:20:41.000000000 -0500
@@ -285,11 +285,11 @@
    -typematch          string     [*] By default any feature type in the
                                   feature table is shown. You can set this to
                                   match any feature type you wish to show.
-                                  See http://www3.ebi.ac.uk/Services/WebFeat/
-                                  for a list of the EMBL feature types and see
+                                  See http://www.ebi.ac.uk/embl/WebFeat/ for a
+                                  list of the EMBL feature types and see
                                   Appendix A of the Swissprot user manual in
-                                  http://www.expasy.ch/txt/userman.txt for a
-                                  list of the Swissprot feature types.
+                                  http://www.expasy.org/sprot/userman.html for
+                                  a list of the Swissprot feature types.
                                   The type may be wildcarded by using '*'.
                                   If you wish to show more than one type,
                                   separate their names with the character '|',
@@ -316,7 +316,7 @@
                                   extra values that a feature may have. By
                                   default any feature tag value in the feature
                                   table is shown. You can set this to match
-                                  any feature tag valueyou wish to show.
+                                  any feature tag value you wish to show.
                                   The tag value may be wildcarded by using
                                   '*'.
                                   If you wish to show more than one tag value,
@@ -504,7 +504,7 @@
 <td>-typematch</td>
 <td>string</td>
 <td>By default any feature type in the feature table is shown. You can set this to match any feature type you wish to show.
-See http://www3.ebi.ac.uk/Services/WebFeat/ for a list of the EMBL feature types and see Appendix A of the Swissprot user manual in http://www.expasy.ch/txt/userman.txt for a list of the Swissprot feature types.
+See http://www.ebi.ac.uk/embl/WebFeat/ for a list of the EMBL feature types and see Appendix A of the Swissprot user manual in http://www.expasy.org/sprot/userman.html for a list of the Swissprot feature types.
 The type may be wildcarded by using '*'.
 If you wish to show more than one type, separate their names with the character '|', eg:
 *UTR | intron</td>
@@ -543,7 +543,7 @@
 <tr bgcolor="#FFFFCC">
 <td>-valuematch</td>
 <td>string</td>
-<td>Tag values are the values associated with a feature tag. Tags are the types of extra values that a feature may have. By default any feature tag value in the feature table is shown. You can set this to match any feature tag valueyou wish to show.
+<td>Tag values are the values associated with a feature tag. Tags are the types of extra values that a feature may have. By default any feature tag value in the feature table is shown. You can set this to match any feature tag value you wish to show.
 The tag value may be wildcarded by using '*'.
 If you wish to show more than one tag value, separate their names with the character '|', eg:
 pax* | 10</td>
@@ -1748,11 +1748,13 @@
 <H2>
     Author(s)
 </H2>
-Gary Williams (gwilliam&nbsp;&copy;&nbsp;rfcgr.mrc.ac.uk)
+Gary Williams formerly at:
 <br>
 MRC Rosalind Franklin Centre for Genomics Research
 Wellcome Trust Genome Campus, Hinxton, Cambridge, CB10 1SB, UK
 
+<p>
+Please report all bugs to the EMBOSS bug team (emboss-bug&nbsp;&copy;&nbsp;emboss.open-bio.org) not to the original author.
 
 
 <H2>
diff -Nurd EMBOSS-6.2.0/doc/programs/html/showseq.html EMBOSS-6.2.0-patched/doc/programs/html/showseq.html
--- EMBOSS-6.2.0/doc/programs/html/showseq.html	2010-01-08 07:51:29.000000000 -0500
+++ EMBOSS-6.2.0-patched/doc/programs/html/showseq.html	2010-03-02 05:20:41.000000000 -0500
@@ -382,11 +382,11 @@
    -typematch          string     [*] By default any feature type in the
                                   feature table is shown. You can set this to
                                   match any feature type you wish to show.
-                                  See http://www3.ebi.ac.uk/Services/WebFeat/
-                                  for a list of the EMBL feature types and see
+                                  See http://www.ebi.ac.uk/embl/WebFeat/ for a
+                                  list of the EMBL feature types and see
                                   Appendix A of the Swissprot user manual in
-                                  http://www.expasy.ch/txt/userman.txt for a
-                                  list of the Swissprot feature types.
+                                  http://www.expasy.org/sprot/userman.html for
+                                  a list of the Swissprot feature types.
                                   The type may be wildcarded by using '*'.
                                   If you wish to show more than one type,
                                   separate their names with the character '|',
@@ -397,7 +397,7 @@
                                   in the feature table is shown. You can set
                                   this to match any feature sense you wish to
                                   show. 0 - any sense, 1 - forward sense, -1 -
-                                  reverse sense (Any integer value)
+                                  reverse sense (Integer from -1 to 1)
    -minscore           float      [0.0] Minimum score of feature to display
                                   (see also maxscore) (Any numeric value)
    -maxscore           float      [0.0] Maximum score of feature to display.
@@ -441,7 +441,8 @@
                                   '/gene' can have the value of the gene name.
                                   By default any feature tag value in the
                                   feature table is shown. You can set this to
-                                  match any feature tag valueyou wish to show.
+                                  match any feature tag value you wish to
+                                  show.
                                   The tag value may be wildcarded by using
                                   '*'.
                                   If you wish to show more than one tag value,
@@ -473,8 +474,8 @@
    -maxcuts            integer    [2000000000] This sets the maximum number of
                                   cuts for any restriction enzyme that will
                                   be considered. Any enzymes that cut more
-                                  times than this will be ignored. (Integer up
-                                  to 2000000000)
+                                  times than this will be ignored. (Any
+                                  integer value)
    -sitelen            integer    [4] This sets the minimum length of the
                                   restriction enzyme recognition site. Any
                                   enzymes with sites shorter than this will be
@@ -495,7 +496,7 @@
                                   pattern to be considered
    -plasmid            boolean    [N] If this is set then this allows searches
                                   for restriction enzyme recognition site and
-                                  cut postions that span the end of the
+                                  cut positions that span the end of the
                                   sequence to be considered.
    -methylation        boolean    [N] If this is set then RE recognition sites
                                   will not match methylated bases.
@@ -758,7 +759,7 @@
 <td>-typematch</td>
 <td>string</td>
 <td>By default any feature type in the feature table is shown. You can set this to match any feature type you wish to show.
-See http://www3.ebi.ac.uk/Services/WebFeat/ for a list of the EMBL feature types and see Appendix A of the Swissprot user manual in http://www.expasy.ch/txt/userman.txt for a list of the Swissprot feature types.
+See http://www.ebi.ac.uk/embl/WebFeat/ for a list of the EMBL feature types and see Appendix A of the Swissprot user manual in http://www.expasy.org/sprot/userman.html for a list of the Swissprot feature types.
 The type may be wildcarded by using '*'.
 If you wish to show more than one type, separate their names with the character '|', eg:
 *UTR | intron</td>
@@ -770,7 +771,7 @@
 <td>-sensematch</td>
 <td>integer</td>
 <td>By default any feature type in the feature table is shown. You can set this to match any feature sense you wish to show. 0 - any sense, 1 - forward sense, -1 - reverse sense</td>
-<td>Any integer value</td>
+<td>Integer from -1 to 1</td>
 <td>0 - any sense, 1 - forward sense, -1 - reverse sense</td>
 </tr>
 
@@ -806,7 +807,7 @@
 <tr bgcolor="#FFFFCC">
 <td>-valuematch</td>
 <td>string</td>
-<td>Tag values are the values associated with a feature tag. Tags are the types of extra values that a feature may have. For example in the EMBL feature table, a 'CDS' type of feature may have the tags '/codon', '/codon_start', '/db_xref', '/EC_number', '/evidence', '/exception', '/function', '/gene', '/label', '/map', '/note', '/number', '/partial', '/product', '/protein_id', '/pseudo', '/standard_name', '/translation', '/transl_except', '/transl_table', or '/usedin'. Only some of these tags can have values, for example '/gene' can have the value of the gene name. By default any feature tag value in the feature table is shown. You can set this to match any feature tag valueyou wish to show.
+<td>Tag values are the values associated with a feature tag. Tags are the types of extra values that a feature may have. For example in the EMBL feature table, a 'CDS' type of feature may have the tags '/codon', '/codon_start', '/db_xref', '/EC_number', '/evidence', '/exception', '/function', '/gene', '/label', '/map', '/note', '/number', '/partial', '/product', '/protein_id', '/pseudo', '/standard_name', '/translation', '/transl_except', '/transl_table', or '/usedin'. Only some of these tags can have values, for example '/gene' can have the value of the gene name. By default any feature tag value in the feature table is shown. You can set this to match any feature tag value you wish to show.
 The tag value may be wildcarded by using '*'.
 If you wish to show more than one tag value, separate their names with the character '|', eg:
 pax* | 10</td>
@@ -854,7 +855,7 @@
 <td>-maxcuts</td>
 <td>integer</td>
 <td>This sets the maximum number of cuts for any restriction enzyme that will be considered. Any enzymes that cut more times than this will be ignored.</td>
-<td>Integer up to 2000000000</td>
+<td>Any integer value</td>
 <td>2000000000</td>
 </tr>
 
@@ -901,7 +902,7 @@
 <tr bgcolor="#FFFFCC">
 <td>-plasmid</td>
 <td>boolean</td>
-<td>If this is set then this allows searches for restriction enzyme recognition site and cut postions that span the end of the sequence to be considered.</td>
+<td>If this is set then this allows searches for restriction enzyme recognition site and cut positions that span the end of the sequence to be considered.</td>
 <td>Boolean value Yes/No</td>
 <td>No</td>
 </tr>
@@ -2197,11 +2198,13 @@
 <H2>
     Author(s)
 </H2>
-Gary Williams (gwilliam&nbsp;&copy;&nbsp;rfcgr.mrc.ac.uk)
+Gary Williams formerly at:
 <br>
 MRC Rosalind Franklin Centre for Genomics Research
 Wellcome Trust Genome Campus, Hinxton, Cambridge, CB10 1SB, UK
 
+<p>
+Please report all bugs to the EMBOSS bug team (emboss-bug&nbsp;&copy;&nbsp;emboss.open-bio.org) not to the original author.
 
 
 <H2>
diff -Nurd EMBOSS-6.2.0/doc/programs/html/twofeat.html EMBOSS-6.2.0-patched/doc/programs/html/twofeat.html
--- EMBOSS-6.2.0/doc/programs/html/twofeat.html	2010-01-08 07:51:30.000000000 -0500
+++ EMBOSS-6.2.0-patched/doc/programs/html/twofeat.html	2010-03-02 05:20:41.000000000 -0500
@@ -127,11 +127,11 @@
    -atype              string     [*] By default every feature in the feature
                                   table is allowed. You can set this to be any
                                   feature type you wish to allow.
-                                  See http://www3.ebi.ac.uk/Services/WebFeat/
-                                  for a list of the EMBL feature types and see
+                                  See http://www.ebi.ac.uk/embl/WebFeat/ for a
+                                  list of the EMBL feature types and see
                                   Appendix A of the Swissprot user manual in
-                                  http://www.expasy.ch/txt/userman.txt for a
-                                  list of the Swissprot feature types.
+                                  http://www.expasy.org/sprot/userman.html for
+                                  a list of the Swissprot feature types.
                                   The type may be wildcarded by using '*'.
                                   If you wish to allow more than one type,
                                   separate their names with the character '|',
@@ -140,11 +140,11 @@
    -btype              string     [*] By default every feature in the feature
                                   table is allowed. You can set this to be any
                                   feature type you wish to allow.
-                                  See http://www3.ebi.ac.uk/Services/WebFeat/
-                                  for a list of the EMBL feature types and see
+                                  See http://www.ebi.ac.uk/embl/WebFeat/ for a
+                                  list of the EMBL feature types and see
                                   Appendix A of the Swissprot user manual in
-                                  http://www.expasy.ch/txt/userman.txt for a
-                                  list of the Swissprot feature types.
+                                  http://www.expasy.org/sprot/userman.html for
+                                  a list of the Swissprot feature types.
                                   The type may be wildcarded by using '*'.
                                   If you wish to allow more than one type,
                                   separate their names with the character '|',
@@ -334,14 +334,14 @@
                                   then you can specify the 'type' name of the
                                   new feature here. By default every feature
                                   in the feature table is allowed. See
-                                  http://www3.ebi.ac.uk/Services/WebFeat/ for
-                                  a list of the EMBL feature types and see
+                                  http://www.ebi.ac.uk/embl/WebFeat/ for a
+                                  list of the EMBL feature types and see
                                   Appendix A of the Swissprot user manual in
-                                  http://www.expasy.ch/txt/userman.txt for a
-                                  list of the Swissprot feature types. If you
-                                  specify an invalid feature type name, then
-                                  the default name 'misc_feature' is used.
-                                  (Any string)
+                                  http://www.expasy.org/sprot/userman.html for
+                                  a list of the Swissprot feature types. If
+                                  you specify an invalid feature type name,
+                                  then the default name 'misc_feature' is
+                                  used. (Any string)
 
    Advanced (Unprompted) qualifiers: (none)
    Associated qualifiers:
@@ -420,7 +420,7 @@
 <td>-atype</td>
 <td>string</td>
 <td>By default every feature in the feature table is allowed. You can set this to be any feature type you wish to allow.
-See http://www3.ebi.ac.uk/Services/WebFeat/ for a list of the EMBL feature types and see Appendix A of the Swissprot user manual in http://www.expasy.ch/txt/userman.txt for a list of the Swissprot feature types.
+See http://www.ebi.ac.uk/embl/WebFeat/ for a list of the EMBL feature types and see Appendix A of the Swissprot user manual in http://www.expasy.org/sprot/userman.html for a list of the Swissprot feature types.
 The type may be wildcarded by using '*'.
 If you wish to allow more than one type, separate their names with the character '|', eg:
 *UTR | intron</td>
@@ -432,7 +432,7 @@
 <td>-btype</td>
 <td>string</td>
 <td>By default every feature in the feature table is allowed. You can set this to be any feature type you wish to allow.
-See http://www3.ebi.ac.uk/Services/WebFeat/ for a list of the EMBL feature types and see Appendix A of the Swissprot user manual in http://www.expasy.ch/txt/userman.txt for a list of the Swissprot feature types.
+See http://www.ebi.ac.uk/embl/WebFeat/ for a list of the EMBL feature types and see Appendix A of the Swissprot user manual in http://www.expasy.org/sprot/userman.html for a list of the Swissprot feature types.
 The type may be wildcarded by using '*'.
 If you wish to allow more than one type, separate their names with the character '|', eg:
 *UTR | intron</td>
@@ -630,7 +630,7 @@
 <tr bgcolor="#FFFFCC">
 <td>-typeout</td>
 <td>string</td>
-<td>If you have specified that the pairs of features that are found should be reported as one feature in the ouput, then you can specify the 'type' name of the new feature here. By default every feature in the feature table is allowed. See http://www3.ebi.ac.uk/Services/WebFeat/ for a list of the EMBL feature types and see Appendix A of the Swissprot user manual in http://www.expasy.ch/txt/userman.txt for a list of the Swissprot feature types. If you specify an invalid feature type name, then the default name 'misc_feature' is used.</td>
+<td>If you have specified that the pairs of features that are found should be reported as one feature in the ouput, then you can specify the 'type' name of the new feature here. By default every feature in the feature table is allowed. See http://www.ebi.ac.uk/embl/WebFeat/ for a list of the EMBL feature types and see Appendix A of the Swissprot user manual in http://www.expasy.org/sprot/userman.html for a list of the Swissprot feature types. If you specify an invalid feature type name, then the default name 'misc_feature' is used.</td>
 <td>Any string</td>
 <td>misc_feature</td>
 </tr>
@@ -1069,7 +1069,7 @@
 The results can be output in one of several styles by using the
 command-line qualifier <b>-rformat xxx</b>, where 'xxx' is replaced by
 the name of the required format.  The available format names are: embl,
-genbank, gff, pir, swiss, trace, listfile, dbmotif, diffseq, excel,
+genbank, gff, pir, swiss, debug, listfile, dbmotif, diffseq, excel,
 feattable, motif, regions, seqtable, simple, srs, table, tagseq
 
 <p>
@@ -1217,11 +1217,13 @@
 <H2>
     Author(s)
 </H2>
-Gary Williams (gwilliam&nbsp;&copy;&nbsp;rfcgr.mrc.ac.uk)
+Gary Williams formerly at:
 <br>
 MRC Rosalind Franklin Centre for Genomics Research
 Wellcome Trust Genome Campus, Hinxton, Cambridge, CB10 1SB, UK
 
+<p>
+Please report all bugs to the EMBOSS bug team (emboss-bug&nbsp;&copy;&nbsp;emboss.open-bio.org) not to the original author.
 
 <H2>
     History
diff -Nurd EMBOSS-6.2.0/doc/programs/text/extractfeat.txt EMBOSS-6.2.0-patched/doc/programs/text/extractfeat.txt
--- EMBOSS-6.2.0/doc/programs/text/extractfeat.txt	2010-01-08 07:51:31.000000000 -0500
+++ EMBOSS-6.2.0-patched/doc/programs/text/extractfeat.txt	2010-03-02 05:20:41.000000000 -0500
@@ -154,9 +154,9 @@
    -type               string     [*] By default every feature in the feature
                                   table is extracted. You can set this to be
                                   any feature type you wish to extract.
-                                  See http://www.ebi.ac.uk/Services/WebFeat/
-                                  for a list of the EMBL feature types and see
-                                  the Uniprot user manual in
+                                  See http://www.ebi.ac.uk/embl/WebFeat/ for a
+                                  list of the EMBL feature types and see the
+                                  Uniprot user manual in
                                   http://www.uniprot.org/manual/sequence_annotat
 ion
                                   for a list of the Uniprot feature types.
@@ -214,7 +214,8 @@
                                   '/gene' can have the value of the gene name.
                                   By default any feature tag value in the
                                   feature table is shown. You can set this to
-                                  match any feature tag valueyou wish to show.
+                                  match any feature tag value you wish to
+                                  show.
                                   The tag value may be wildcarded by using
                                   '*'.
                                   If you wish to show more than one tag value,
@@ -855,10 +856,13 @@
 
 Author(s)
 
-   Gary Williams (gwilliam (c) rfcgr.mrc.ac.uk)
+   Gary Williams formerly at:
    MRC Rosalind Franklin Centre for Genomics Research Wellcome Trust
    Genome Campus, Hinxton, Cambridge, CB10 1SB, UK
 
+   Please report all bugs to the EMBOSS bug team
+   (emboss-bug (c) emboss.open-bio.org) not to the original author.
+
 History
 
    Written (Dec 12 2001) - Gary Williams
diff -Nurd EMBOSS-6.2.0/doc/programs/text/maskfeat.txt EMBOSS-6.2.0-patched/doc/programs/text/maskfeat.txt
--- EMBOSS-6.2.0/doc/programs/text/maskfeat.txt	2010-01-08 07:51:31.000000000 -0500
+++ EMBOSS-6.2.0-patched/doc/programs/text/maskfeat.txt	2010-03-02 05:20:41.000000000 -0500
@@ -68,11 +68,11 @@
                                   feature table with a type starting 'repeat'
                                   is masked. You can set this to be any
                                   feature type you wish to mask.
-                                  See http://www3.ebi.ac.uk/Services/WebFeat/
-                                  for a list of the EMBL feature types and see
+                                  See http://www.ebi.ac.uk/embl/WebFeat/ for a
+                                  list of the EMBL feature types and see
                                   Appendix A of the Swissprot user manual in
-                                  http://www.expasy.ch/txt/userman.txt for a
-                                  list of the Swissprot feature types.
+                                  http://www.expasy.org/sprot/userman.html for
+                                  a list of the Swissprot feature types.
                                   The type may be wildcarded by using '*'.
                                   If you wish to mask more than one type,
                                   separate their names with spaces or commas,
@@ -466,10 +466,13 @@
 
 Author(s)
 
-   Gary Williams (gwilliam (c) rfcgr.mrc.ac.uk)
+   Gary Williams formerly at:
    MRC Rosalind Franklin Centre for Genomics Research Wellcome Trust
    Genome Campus, Hinxton, Cambridge, CB10 1SB, UK
 
+   Please report all bugs to the EMBOSS bug team
+   (emboss-bug (c) emboss.open-bio.org) not to the original author.
+
 History
 
    Written (2000) - Gary Williams
diff -Nurd EMBOSS-6.2.0/doc/programs/text/showfeat.txt EMBOSS-6.2.0-patched/doc/programs/text/showfeat.txt
--- EMBOSS-6.2.0/doc/programs/text/showfeat.txt	2010-01-08 07:51:31.000000000 -0500
+++ EMBOSS-6.2.0-patched/doc/programs/text/showfeat.txt	2010-03-02 05:20:41.000000000 -0500
@@ -87,11 +87,11 @@
    -typematch          string     [*] By default any feature type in the
                                   feature table is shown. You can set this to
                                   match any feature type you wish to show.
-                                  See http://www3.ebi.ac.uk/Services/WebFeat/
-                                  for a list of the EMBL feature types and see
+                                  See http://www.ebi.ac.uk/embl/WebFeat/ for a
+                                  list of the EMBL feature types and see
                                   Appendix A of the Swissprot user manual in
-                                  http://www.expasy.ch/txt/userman.txt for a
-                                  list of the Swissprot feature types.
+                                  http://www.expasy.org/sprot/userman.html for
+                                  a list of the Swissprot feature types.
                                   The type may be wildcarded by using '*'.
                                   If you wish to show more than one type,
                                   separate their names with the character '|',
@@ -134,7 +134,8 @@
                                   '/gene' can have the value of the gene name.
                                   By default any feature tag value in the
                                   feature table is shown. You can set this to
-                                  match any feature tag valueyou wish to show.
+                                  match any feature tag value you wish to
+                                  show.
                                   The tag value may be wildcarded by using
                                   '*'.
                                   If you wish to show more than one tag value,
@@ -412,26 +413,26 @@
 X65921
 H.sapiens fau 1 gene
 |==========================================================| 2016
-|----------------------------------------------------------> source
-           |-->                                              exon
-           |-->                                              mRNA
-              |------->                                      intron
-                      |->                                    exon
-                      |->                                    mRNA
-                      |->                                    CDS
+                                                        >    polyA_signal
+                                                    |-->     exon
+                                               |---->        intron
+                                             |>              exon
+                               |------------->               intron
+                           |--->                             exon
                         |-->                                 intron
+                      |->                                    CDS
                            |--->                             CDS
-                           |--->                             exon
-                           |--->                             mRNA
-                               |------------->               intron
                                              |>              CDS
-                                             |>              exon
-                                             |>              mRNA
-                                               |---->        intron
                                                     |-->     CDS
-                                                    |-->     exon
+                      |->                                    exon
+              |------->                                      intron
+           |-->                                              mRNA
+                      |->                                    mRNA
+                           |--->                             mRNA
+                                             |>              mRNA
                                                     |-->     mRNA
-                                                        >    polyA_signal
+           |-->                                              exon
+|----------------------------------------------------------> source
 
 
   Output files for usage example 2
@@ -441,27 +442,22 @@
 X65921
 H.sapiens fau 1 gene
 |==========================================================| 2016
-|----------------------------------------------------------> 1-2016 source
-           |-->                                              408-504 exon
-           |-->                                              408-504 mRNA
-              |------->                                      505-773 intron
-                      |->                                    774-856,774-856 exo
-n
-                      |->                                    782-856 CDS
-                        |--|--->                             857-950,951-1095 in
-tron
-                           |--->                             951-1095,951-1095 e
-xon
-                               |-------------|>              1096-1556,1557-1612
- intron
-                                             |>              1557-1612,1557-1612
- exon
-                                               |----|-->     1613-1786,1787-1912
- intron
-                                                    |-->     1787-1912,1787-1912
- exon
                                                         >    1938-1943 polyA_sig
 nal
+                                                    |-->     1787-1912 exon
+                                               |---->        1613-1786 intron
+                                             |>              1557-1612 exon
+                               |------------->               1096-1556 intron
+                           |--->                             951-1095 exon
+                        |-->                                 857-950 intron
+                      |->  |--->             |>     |-->     782-856,951-1095,15
+57-1612,1787-1912 CDS
+                      |->                                    774-856 exon
+              |------->                                      505-773 intron
+           |-->       |->  |--->             |>     |-->     408-504,774-856,951
+-1095,1557-1612,1787-1912 mRNA
+           |-->                                              408-504 exon
+|----------------------------------------------------------> 1-2016 source
 
 
   Output files for usage example 3
@@ -551,10 +547,13 @@
 
 Author(s)
 
-   Gary             Williams (gwilliam (c) rfcgr.mrc.ac.uk)
+   Gary             Williams formerly at:
    MRC              Rosalind Franklin Centre for Genomics Research Wellcome Trust
    Genome           Campus, Hinxton, Cambridge, CB10 1SB, UK
 
+                    Please report all bugs to the EMBOSS bug team
+                    (emboss-bug (c) emboss.open-bio.org) not to the original author.
+
 History
 
                     Written 1999 - Gary Williams
diff -Nurd EMBOSS-6.2.0/doc/programs/text/showpep.txt EMBOSS-6.2.0-patched/doc/programs/text/showpep.txt
--- EMBOSS-6.2.0/doc/programs/text/showpep.txt	2010-01-08 07:51:31.000000000 -0500
+++ EMBOSS-6.2.0-patched/doc/programs/text/showpep.txt	2010-03-02 05:20:41.000000000 -0500
@@ -232,11 +232,11 @@
    -typematch          string     [*] By default any feature type in the
                                   feature table is shown. You can set this to
                                   match any feature type you wish to show.
-                                  See http://www3.ebi.ac.uk/Services/WebFeat/
-                                  for a list of the EMBL feature types and see
+                                  See http://www.ebi.ac.uk/embl/WebFeat/ for a
+                                  list of the EMBL feature types and see
                                   Appendix A of the Swissprot user manual in
-                                  http://www.expasy.ch/txt/userman.txt for a
-                                  list of the Swissprot feature types.
+                                  http://www.expasy.org/sprot/userman.html for
+                                  a list of the Swissprot feature types.
                                   The type may be wildcarded by using '*'.
                                   If you wish to show more than one type,
                                   separate their names with the character '|',
@@ -263,7 +263,7 @@
                                   extra values that a feature may have. By
                                   default any feature tag value in the feature
                                   table is shown. You can set this to match
-                                  any feature tag valueyou wish to show.
+                                  any feature tag value you wish to show.
                                   The tag value may be wildcarded by using
                                   '*'.
                                   If you wish to show more than one tag value,
@@ -992,10 +992,13 @@
 
 Author(s)
 
-   Gary             Williams (gwilliam (c) rfcgr.mrc.ac.uk)
+   Gary             Williams formerly at:
    MRC              Rosalind Franklin Centre for Genomics Research Wellcome Trust
    Genome           Campus, Hinxton, Cambridge, CB10 1SB, UK
 
+                    Please report all bugs to the EMBOSS bug team
+                    (emboss-bug (c) emboss.open-bio.org) not to the original author.
+
 History
 
 Target users
diff -Nurd EMBOSS-6.2.0/doc/programs/text/showseq.txt EMBOSS-6.2.0-patched/doc/programs/text/showseq.txt
--- EMBOSS-6.2.0/doc/programs/text/showseq.txt	2010-01-08 07:51:31.000000000 -0500
+++ EMBOSS-6.2.0-patched/doc/programs/text/showseq.txt	2010-03-02 05:20:41.000000000 -0500
@@ -327,11 +327,11 @@
    -typematch          string     [*] By default any feature type in the
                                   feature table is shown. You can set this to
                                   match any feature type you wish to show.
-                                  See http://www3.ebi.ac.uk/Services/WebFeat/
-                                  for a list of the EMBL feature types and see
+                                  See http://www.ebi.ac.uk/embl/WebFeat/ for a
+                                  list of the EMBL feature types and see
                                   Appendix A of the Swissprot user manual in
-                                  http://www.expasy.ch/txt/userman.txt for a
-                                  list of the Swissprot feature types.
+                                  http://www.expasy.org/sprot/userman.html for
+                                  a list of the Swissprot feature types.
                                   The type may be wildcarded by using '*'.
                                   If you wish to show more than one type,
                                   separate their names with the character '|',
@@ -342,7 +342,7 @@
                                   in the feature table is shown. You can set
                                   this to match any feature sense you wish to
                                   show. 0 - any sense, 1 - forward sense, -1 -
-                                  reverse sense (Any integer value)
+                                  reverse sense (Integer from -1 to 1)
    -minscore           float      [0.0] Minimum score of feature to display
                                   (see also maxscore) (Any numeric value)
    -maxscore           float      [0.0] Maximum score of feature to display.
@@ -386,7 +386,8 @@
                                   '/gene' can have the value of the gene name.
                                   By default any feature tag value in the
                                   feature table is shown. You can set this to
-                                  match any feature tag valueyou wish to show.
+                                  match any feature tag value you wish to
+                                  show.
                                   The tag value may be wildcarded by using
                                   '*'.
                                   If you wish to show more than one tag value,
@@ -418,8 +419,8 @@
    -maxcuts            integer    [2000000000] This sets the maximum number of
                                   cuts for any restriction enzyme that will
                                   be considered. Any enzymes that cut more
-                                  times than this will be ignored. (Integer up
-                                  to 2000000000)
+                                  times than this will be ignored. (Any
+                                  integer value)
    -sitelen            integer    [4] This sets the minimum length of the
                                   restriction enzyme recognition site. Any
                                   enzymes with sites shorter than this will be
@@ -440,7 +441,7 @@
                                   pattern to be considered
    -plasmid            boolean    [N] If this is set then this allows searches
                                   for restriction enzyme recognition site and
-                                  cut postions that span the end of the
+                                  cut positions that span the end of the
                                   sequence to be considered.
    -methylation        boolean    [N] If this is set then RE recognition sites
                                   will not match methylated bases.
@@ -1207,10 +1208,13 @@
 
 Author(s)
 
-   Gary Williams (gwilliam (c) rfcgr.mrc.ac.uk)
+   Gary Williams formerly at:
    MRC Rosalind Franklin Centre for Genomics Research Wellcome Trust
    Genome Campus, Hinxton, Cambridge, CB10 1SB, UK
 
+   Please report all bugs to the EMBOSS bug team
+   (emboss-bug (c) emboss.open-bio.org) not to the original author.
+
 History
 
    Written 1999 - GWW
diff -Nurd EMBOSS-6.2.0/doc/programs/text/twofeat.txt EMBOSS-6.2.0-patched/doc/programs/text/twofeat.txt
--- EMBOSS-6.2.0/doc/programs/text/twofeat.txt	2010-01-08 07:51:31.000000000 -0500
+++ EMBOSS-6.2.0-patched/doc/programs/text/twofeat.txt	2010-03-02 05:20:41.000000000 -0500
@@ -107,11 +107,11 @@
    -atype              string     [*] By default every feature in the feature
                                   table is allowed. You can set this to be any
                                   feature type you wish to allow.
-                                  See http://www3.ebi.ac.uk/Services/WebFeat/
-                                  for a list of the EMBL feature types and see
+                                  See http://www.ebi.ac.uk/embl/WebFeat/ for a
+                                  list of the EMBL feature types and see
                                   Appendix A of the Swissprot user manual in
-                                  http://www.expasy.ch/txt/userman.txt for a
-                                  list of the Swissprot feature types.
+                                  http://www.expasy.org/sprot/userman.html for
+                                  a list of the Swissprot feature types.
                                   The type may be wildcarded by using '*'.
                                   If you wish to allow more than one type,
                                   separate their names with the character '|',
@@ -120,11 +120,11 @@
    -btype              string     [*] By default every feature in the feature
                                   table is allowed. You can set this to be any
                                   feature type you wish to allow.
-                                  See http://www3.ebi.ac.uk/Services/WebFeat/
-                                  for a list of the EMBL feature types and see
+                                  See http://www.ebi.ac.uk/embl/WebFeat/ for a
+                                  list of the EMBL feature types and see
                                   Appendix A of the Swissprot user manual in
-                                  http://www.expasy.ch/txt/userman.txt for a
-                                  list of the Swissprot feature types.
+                                  http://www.expasy.org/sprot/userman.html for
+                                  a list of the Swissprot feature types.
                                   The type may be wildcarded by using '*'.
                                   If you wish to allow more than one type,
                                   separate their names with the character '|',
@@ -314,14 +314,14 @@
                                   then you can specify the 'type' name of the
                                   new feature here. By default every feature
                                   in the feature table is allowed. See
-                                  http://www3.ebi.ac.uk/Services/WebFeat/ for
-                                  a list of the EMBL feature types and see
+                                  http://www.ebi.ac.uk/embl/WebFeat/ for a
+                                  list of the EMBL feature types and see
                                   Appendix A of the Swissprot user manual in
-                                  http://www.expasy.ch/txt/userman.txt for a
-                                  list of the Swissprot feature types. If you
-                                  specify an invalid feature type name, then
-                                  the default name 'misc_feature' is used.
-                                  (Any string)
+                                  http://www.expasy.org/sprot/userman.html for
+                                  a list of the Swissprot feature types. If
+                                  you specify an invalid feature type name,
+                                  then the default name 'misc_feature' is
+                                  used. (Any string)
 
    Advanced (Unprompted) qualifiers: (none)
    Associated qualifiers:
@@ -469,7 +469,7 @@
    The results can be output in one of several styles by using the
    command-line qualifier -rformat xxx, where 'xxx' is replaced by the
    name of the required format. The available format names are: embl,
-   genbank, gff, pir, swiss, trace, listfile, dbmotif, diffseq, excel,
+   genbank, gff, pir, swiss, debug, listfile, dbmotif, diffseq, excel,
    feattable, motif, regions, seqtable, simple, srs, table, tagseq
 
    See: http://emboss.sf.net/docs/themes/ReportFormats.html for further
@@ -568,10 +568,13 @@
 
 Author(s)
 
-   Gary             Williams (gwilliam (c) rfcgr.mrc.ac.uk)
+   Gary             Williams formerly at:
    MRC              Rosalind Franklin Centre for Genomics Research Wellcome Trust
    Genome           Campus, Hinxton, Cambridge, CB10 1SB, UK
 
+                    Please report all bugs to the EMBOSS bug team
+                    (emboss-bug (c) emboss.open-bio.org) not to the original author.
+
 History
 
                     Written (2002) - Gary Williams
diff -Nurd EMBOSS-6.2.0/emboss/acd/cirdna.acd EMBOSS-6.2.0-patched/emboss/acd/cirdna.acd
--- EMBOSS-6.2.0/emboss/acd/cirdna.acd	2010-01-11 14:54:14.000000000 -0500
+++ EMBOSS-6.2.0-patched/emboss/acd/cirdna.acd	2010-03-02 05:20:41.000000000 -0500
@@ -13,7 +13,7 @@
     parameter: "Y"
     default: "inputfile"
     information: "Commands to the cirdna drawing program file"
-    knowntype: "lindna mapping commands"
+    knowntype: "cirdna mapping commands"
     relations: ""
   ]
 
diff -Nurd EMBOSS-6.2.0/emboss/acd/extractfeat.acd EMBOSS-6.2.0-patched/emboss/acd/extractfeat.acd
--- EMBOSS-6.2.0/emboss/acd/extractfeat.acd	2010-01-14 16:51:23.000000000 -0500
+++ EMBOSS-6.2.0-patched/emboss/acd/extractfeat.acd	2010-03-02 05:20:41.000000000 -0500
@@ -83,7 +83,7 @@
     information: "Type of feature to extract"
     help: "By default every feature in the feature table is extracted.
            You can set this to be any feature type you wish to extract. \
-           See http://www.ebi.ac.uk/Services/WebFeat/ for a list of the EMBL
+           See http://www.ebi.ac.uk/embl/WebFeat/ for a list of the EMBL
            feature types and see the Uniprot user manual in
            http://www.uniprot.org/manual/sequence_annotation
            for a list of the Uniprot feature types. \
diff -Nurd EMBOSS-6.2.0/emboss/acd/jaspextract.acd EMBOSS-6.2.0-patched/emboss/acd/jaspextract.acd
--- EMBOSS-6.2.0/emboss/acd/jaspextract.acd	2009-09-15 06:25:52.000000000 -0400
+++ EMBOSS-6.2.0-patched/emboss/acd/jaspextract.acd	2010-03-02 05:20:41.000000000 -0500
@@ -15,9 +15,8 @@
   directory: directory [
     parameter: "Y"
     information: "JASPAR database directory"
-    help: "The directory containing the unzipped and untarred
-           JASPAR_CORE, JASPAR_FAM and JASPAR_PHYLOFACTS
-           subdirectories"
+    help: "The FlatFileDir directory containing the .pfm files
+           and the matrix_list.txt file"
     knowntype: "Jaspar database"
     relations: "EDAM: Directory"                                           
   ]
diff -Nurd EMBOSS-6.2.0/emboss/acd/jaspscan.acd EMBOSS-6.2.0-patched/emboss/acd/jaspscan.acd
--- EMBOSS-6.2.0/emboss/acd/jaspscan.acd	2009-09-15 06:25:52.000000000 -0400
+++ EMBOSS-6.2.0-patched/emboss/acd/jaspscan.acd	2010-03-02 05:20:41.000000000 -0500
@@ -21,7 +21,7 @@
     default: "C"
     minimum: "1"
     maximum: "1"
-    values: "C:Core,F:Fam,P:Phylofacts,N:CNE,O:POLII,S:SPLICE"
+    values: "C:Core,F:Fam,P:Phylofacts,N:CNE,O:POLII,S:SPLICE,B:PBM,L:PBM_HLH,H:PBM_HOMEO"
     delimiter: ","
     codedelimiter: ":"
     header: "Jaspar matrix set"
@@ -38,7 +38,7 @@
     help: "The name 'all' reads in all matrix files from the selected \
            JASPAR matrix set. You can specify individual matrices by giving \
            their names with commas between then, such as: \
-           'ma0001,ma0015'. \
+           'ma0001.1,ma0015*'. \
            The case of the names is not important. You can specify a file of \
            matrix names to read in by giving the name of the file holding the \
            matrix names with a '@' character in front of it, for example, \
@@ -49,11 +49,11 @@
            for. \
            An example of a file of matrix names is: \
            ! my matrices \
-           ma0001, ma0002 \
+           ma0001.1, ma0002.1 \
            ! other matrices \
-           ma0010 \
-           ma0032 \
-           ma0053"
+           ma0010.1 \
+           ma0032* \
+           ma0053.1"
     knowntype: "jaspar matrix id"
     relations:  "EDAM: JASPAR profile identifier"                      
   ]
@@ -115,9 +115,10 @@
     multiple: "Y"
     taglist: "float:pc=Score_Percent
               str:id=ID str:name=Name str:species=Species str:class=Class
-              str:supergroup=Supergroup str:pseq=Protein_Seq
-              str:exp=Experiment str:pmid=Source_PMID float:info=Info_Content
-              str:jaspar=Closest_Jaspar str:transfac=Closest_Transfac
+              str:supergroup=Supergroup str:fam=Family str:paz=Pazar_TF_ID
+	      str:pseq=Protein_Seq str:exp=Experiment str:pmid=Source_PMID
+	      float:info=Info_Content str:jaspar=Closest_Jaspar
+	      str:transfac=Closest_Transfac
               float:mcs=MCS_Score str:built=Built_From"
     relations: "EDAM: EMBOSS report"                                       
   ]
diff -Nurd EMBOSS-6.2.0/emboss/acd/knowntypes.standard EMBOSS-6.2.0-patched/emboss/acd/knowntypes.standard
--- EMBOSS-6.2.0/emboss/acd/knowntypes.standard	2009-12-18 08:59:32.000000000 -0500
+++ EMBOSS-6.2.0-patched/emboss/acd/knowntypes.standard	2010-03-02 05:20:41.000000000 -0500
@@ -20,6 +20,7 @@
 blast_protein_dbname                | string         |  "EDAM: BLAST database name"                            | Blast protein database name
 caf_project                         | file           |  "EDAM: Common Assembly Format (CAF) project file"      | CAF assembly project file
 cds_sequence                        | sequence       |  "EDAM: Nucleotide sequence"                            | Coding
+cirdna_mapping_commands             | file           |                                                 | Commands to the cirdna drawing program
 clique_input                        | file           |  "EDAM: PHYLIP discrete states file"                    | Phylip clique program input
 clique_output                       | file           |  "EDAM: PHYLIP cliques file"                            | Phylip clique program output
 codon_list                          | string         |  "EDAM: Codon string"                                   | Codon triplet(s)
diff -Nurd EMBOSS-6.2.0/emboss/acd/maskfeat.acd EMBOSS-6.2.0-patched/emboss/acd/maskfeat.acd
--- EMBOSS-6.2.0/emboss/acd/maskfeat.acd	2009-09-15 06:25:52.000000000 -0400
+++ EMBOSS-6.2.0-patched/emboss/acd/maskfeat.acd	2010-03-02 05:20:41.000000000 -0500
@@ -31,9 +31,9 @@
     help: "By default any feature in the feature table with a type
            starting 'repeat' is masked. You can set this to be any feature
            type you wish to mask. \
-           See http://www3.ebi.ac.uk/Services/WebFeat/ for a list of the EMBL
+           See http://www.ebi.ac.uk/embl/WebFeat/ for a list of the EMBL
            feature types and see Appendix A of the Swissprot user manual in
-           http://www.expasy.ch/txt/userman.txt for a list of the Swissprot
+           http://www.expasy.org/sprot/userman.html for a list of the Swissprot
            feature types. \
            The type may be wildcarded by using '*'. \
            If you wish to mask more than one type, separate their names with
diff -Nurd EMBOSS-6.2.0/emboss/acd/remap.acd EMBOSS-6.2.0-patched/emboss/acd/remap.acd
--- EMBOSS-6.2.0/emboss/acd/remap.acd	2010-01-14 16:51:23.000000000 -0500
+++ EMBOSS-6.2.0-patched/emboss/acd/remap.acd	2010-03-02 05:20:41.000000000 -0500
@@ -91,7 +91,6 @@
   integer: maxcuts [
     additional: "Y"
     minimum: "$(mincuts)"
-    maximum: "2000000000"
     default: "2000000000"
     information: "Maximum cuts per RE"
     help: "This sets the maximum number of cuts for any restriction
diff -Nurd EMBOSS-6.2.0/emboss/acd/restover.acd EMBOSS-6.2.0-patched/emboss/acd/restover.acd
--- EMBOSS-6.2.0/emboss/acd/restover.acd	2009-10-12 10:42:43.000000000 -0400
+++ EMBOSS-6.2.0-patched/emboss/acd/restover.acd	2010-03-02 05:20:41.000000000 -0500
@@ -61,7 +61,6 @@
 
   integer: max [
     minimum: "$(min)"
-    maximum: "2000000000"
     default: "2000000000"
     information: "Maximum cuts per RE"
     relations: "EDAM: Generic integer"                                     
diff -Nurd EMBOSS-6.2.0/emboss/acd/restrict.acd EMBOSS-6.2.0-patched/emboss/acd/restrict.acd
--- EMBOSS-6.2.0/emboss/acd/restrict.acd	2010-01-14 16:51:23.000000000 -0500
+++ EMBOSS-6.2.0-patched/emboss/acd/restrict.acd	2010-03-02 05:20:41.000000000 -0500
@@ -97,7 +97,6 @@
 
   integer: max [
     minimum: "$(min)"
-    maximum: "2000000000"
     default: "2000000000"
     information: "Maximum cuts per RE"
     help: "This sets the maximum number of cuts for any restriction
diff -Nurd EMBOSS-6.2.0/emboss/acd/showfeat.acd EMBOSS-6.2.0-patched/emboss/acd/showfeat.acd
--- EMBOSS-6.2.0/emboss/acd/showfeat.acd	2010-01-14 16:51:23.000000000 -0500
+++ EMBOSS-6.2.0-patched/emboss/acd/showfeat.acd	2010-03-02 05:20:41.000000000 -0500
@@ -47,9 +47,9 @@
     information: "Type of feature to display"
     help: "By default any feature type in the feature table is shown.
            You can set this to match any feature type you wish to show. \
-           See http://www3.ebi.ac.uk/Services/WebFeat/ for a list of the EMBL
+           See http://www.ebi.ac.uk/embl/WebFeat/ for a list of the EMBL
            feature types and see Appendix A of the Swissprot user manual in
-           http://www.expasy.ch/txt/userman.txt for a list of the Swissprot
+           http://www.expasy.org/sprot/userman.html for a list of the Swissprot
            feature types. \
            The type may be wildcarded by using '*'. \
            If you wish to show more than one type, separate their names with
diff -Nurd EMBOSS-6.2.0/emboss/acd/showpep.acd EMBOSS-6.2.0-patched/emboss/acd/showpep.acd
--- EMBOSS-6.2.0/emboss/acd/showpep.acd	2010-01-14 16:51:23.000000000 -0500
+++ EMBOSS-6.2.0-patched/emboss/acd/showpep.acd	2010-03-02 05:20:41.000000000 -0500
@@ -152,10 +152,10 @@
       help: "By default any feature type in the feature table is
              shown. You can set this to match any feature type you wish to
              show. \
-             See http://www3.ebi.ac.uk/Services/WebFeat/ for a list of the
+             See http://www.ebi.ac.uk/embl/WebFeat/ for a list of the
              EMBL feature types and see Appendix A of the Swissprot user
-             manual in http://www.expasy.ch/txt/userman.txt for a list of the
-             Swissprot feature types. \
+             manual in http://www.expasy.org/sprot/userman.html
+             for a list of the Swissprot feature types. \
              The type may be wildcarded by using '*'. \
              If you wish to show more than one type, separate their names
              with the character '|', eg: \
diff -Nurd EMBOSS-6.2.0/emboss/acd/showseq.acd EMBOSS-6.2.0-patched/emboss/acd/showseq.acd
--- EMBOSS-6.2.0/emboss/acd/showseq.acd	2010-01-14 16:51:23.000000000 -0500
+++ EMBOSS-6.2.0-patched/emboss/acd/showseq.acd	2010-03-02 05:20:41.000000000 -0500
@@ -249,10 +249,10 @@
       help: "By default any feature type in the feature table is
              shown. You can set this to match any feature type you wish to
              show. \
-             See http://www3.ebi.ac.uk/Services/WebFeat/ for a list of the
+             See http://www.ebi.ac.uk/embl/WebFeat/ for a list of the
              EMBL feature types and see Appendix A of the Swissprot user
-             manual in http://www.expasy.ch/txt/userman.txt for a list of the
-             Swissprot feature types. \
+             manual in http://www.expasy.org/sprot/userman.html
+             for a list of the Swissprot feature types. \
              The type may be wildcarded by using '*'. \
              If you wish to show more than one type, separate their names
              with the character '|', eg: \
@@ -264,6 +264,8 @@
     integer: sensematch [
       additional: "Y"
       default: "0"
+      minimum: "-1"
+      maximum: "1"
       information: "Sense of feature to display"
       expected: "0 - any sense, 1 - forward sense, -1 - reverse
                  sense"
@@ -387,7 +389,6 @@
 
     integer: maxcuts [
       minimum: "$(mincuts)"
-      maximum: "2000000000"
       default: "2000000000"
       information: "Maximum cuts per RE"
       help: "This sets the maximum number of cuts for any restriction
diff -Nurd EMBOSS-6.2.0/emboss/acd/trimseq.acd EMBOSS-6.2.0-patched/emboss/acd/trimseq.acd
--- EMBOSS-6.2.0/emboss/acd/trimseq.acd	2009-09-15 06:25:52.000000000 -0400
+++ EMBOSS-6.2.0-patched/emboss/acd/trimseq.acd	2010-03-02 05:20:41.000000000 -0500
@@ -26,6 +26,7 @@
   integer: window [
     additional: "Y"
     default: "1"
+    maximum: "$(sequence.length)"
     information: "Window size"
     help: "This determines the size of the region that is considered
            when deciding whether the percentage of ambiguity is greater than
diff -Nurd EMBOSS-6.2.0/emboss/acd/twofeat.acd EMBOSS-6.2.0-patched/emboss/acd/twofeat.acd
--- EMBOSS-6.2.0/emboss/acd/twofeat.acd	2009-09-15 06:25:52.000000000 -0400
+++ EMBOSS-6.2.0-patched/emboss/acd/twofeat.acd	2010-03-02 05:20:41.000000000 -0500
@@ -45,10 +45,10 @@
       information: "Type of first feature"
       help: "By default every feature in the feature table is allowed.
              You can set this to be any feature type you wish to allow. \
-             See http://www3.ebi.ac.uk/Services/WebFeat/ for a list of the
+             See http://www.ebi.ac.uk/embl/WebFeat/ for a list of the
              EMBL feature types and see Appendix A of the Swissprot user
-             manual in http://www.expasy.ch/txt/userman.txt for a list of the
-             Swissprot feature types. \
+             manual in http://www.expasy.org/sprot/userman.html
+             for a list of the Swissprot feature types. \
              The type may be wildcarded by using '*'. \
              If you wish to allow more than one type, separate their names
              with the character '|', eg: \
@@ -168,10 +168,10 @@
       information: "Type of second feature"
       help: "By default every feature in the feature table is allowed.
              You can set this to be any feature type you wish to allow. \
-             See http://www3.ebi.ac.uk/Services/WebFeat/ for a list of the
+             See http://www.ebi.ac.uk/embl/WebFeat/ for a list of the
              EMBL feature types and see Appendix A of the Swissprot user
-             manual in http://www.expasy.ch/txt/userman.txt for a list of the
-             Swissprot feature types. \
+             manual in http://www.expasy.org/sprot/userman.html
+             for a list of the Swissprot feature types. \
              The type may be wildcarded by using '*'. \
              If you wish to allow more than one type, separate their names
              with the character '|', eg: \
@@ -385,9 +385,9 @@
            found should be reported as one feature in the ouput, then you can
            specify the 'type' name of the new feature here. By default every
            feature in the feature table is allowed. See
-           http://www3.ebi.ac.uk/Services/WebFeat/ for a list of the EMBL
+           http://www.ebi.ac.uk/embl/WebFeat/ for a list of the EMBL
            feature types and see Appendix A of the Swissprot user manual in
-           http://www.expasy.ch/txt/userman.txt for a list of the Swissprot
+           http://www.expasy.org/sprot/userman.html for a list of the Swissprot
            feature types. If you specify an invalid feature type name, then
            the default name 'misc_feature' is used."
     knowntype: "feature key"
diff -Nurd EMBOSS-6.2.0/emboss/coderet.c EMBOSS-6.2.0-patched/emboss/coderet.c
--- EMBOSS-6.2.0/emboss/coderet.c	2009-12-01 09:39:23.000000000 -0500
+++ EMBOSS-6.2.0-patched/emboss/coderet.c	2010-03-02 05:20:41.000000000 -0500
@@ -121,68 +121,73 @@
         imrna = 0;
         itran = 0;
         irest = 0;
+
         feat = ajSeqGetFeat(seq);
-        if(seqoutrest)
+
+        if(feat)
         {
-            copyseq = ajSeqGetSeqCopyS(seq);
-            ajStrFmtUpper(&copyseq);
-        }
+            if(seqoutrest)
+            {
+                copyseq = ajSeqGetSeqCopyS(seq);
+                ajStrFmtUpper(&copyseq);
+            }
         
-        iter = ajListIterNewread(feat->Features);
-        while(!ajListIterDone(iter))
-        {
-            gf = ajListIterGet(iter);
-            if(ajFeatIsChild(gf))
-                continue;
-            if(seqoutcds && ajFeatTypeMatchC(gf, "CDS"))
+            iter = ajListIterNewread(feat->Features);
+            while(!ajListIterDone(iter))
             {
-                icds++;
-                ret = ajFeatGetSeqJoin(gf, feat, seq, &cds);
-		if(!ret)
-		{
-		    ajWarn("Cannot extract %S\n",ajSeqGetNameS(seq));
-		    continue;
-		}
-		coderet_put_seq(seq,cds,icds,"cds",0,seqoutcds);
-	    }
+                gf = ajListIterGet(iter);
+                if(ajFeatIsChild(gf))
+                    continue;
+                if(seqoutcds && ajFeatTypeMatchC(gf, "CDS"))
+                {
+                    icds++;
+                    ret = ajFeatGetSeqJoin(gf, feat, seq, &cds);
+                    if(!ret)
+                    {
+                        ajWarn("Cannot extract %S\n",ajSeqGetNameS(seq));
+                        continue;
+                    }
+                    coderet_put_seq(seq,cds,icds,"cds",0,seqoutcds);
+                }
 
-            if(seqoutmrna && ajFeatTypeMatchC(gf, "mRNA"))
-            {
-                imrna++;
-                ret = ajFeatGetSeqJoin(gf, feat, seq, &mrna);
-                if(!ret)
+                if(seqoutmrna && ajFeatTypeMatchC(gf, "mRNA"))
                 {
-                    ajWarn("Cannot extract %s",ajSeqGetNameC(seq));
-                    continue;
+                    imrna++;
+                    ret = ajFeatGetSeqJoin(gf, feat, seq, &mrna);
+                    if(!ret)
+                    {
+                        ajWarn("Cannot extract %s",ajSeqGetNameC(seq));
+                        continue;
+                    }
+                    coderet_put_seq(seq,mrna,imrna,"mrna",0,seqoutmrna);
                 }
-		coderet_put_seq(seq,mrna,imrna,"mrna",0,seqoutmrna);
-	    }
 
 
-            if(seqoutrest)          /* set feature to lowercase */
-            {
+                if(seqoutrest)          /* set feature to lowercase */
+                {
 
-                if(ajFeatTypeMatchC(gf, "CDS") ||
-                   ajFeatTypeMatchC(gf, "mRNA") ||
-                   ajFeatTypeMatchC(gf, "exon"))
-                    ajFeatLocMark(gf, feat, &copyseq);
-                else
-                    irest++;
-            }
+                    if(ajFeatTypeMatchC(gf, "CDS") ||
+                       ajFeatTypeMatchC(gf, "mRNA") ||
+                       ajFeatTypeMatchC(gf, "exon"))
+                        ajFeatLocMark(gf, feat, &copyseq);
+                    else
+                        irest++;
+                }
 
-            if(seqoutprot && ajFeatTypeMatchC(gf, "CDS"))
-            {
-                if(ajFeatGetTranslation(gf, &trnseq))
+                if(seqoutprot && ajFeatTypeMatchC(gf, "CDS"))
                 {
-                    itran++;
-                    coderet_put_seq(seq, trnseq, itran,"pro",1,seqoutprot);
+                    if(ajFeatGetTranslation(gf, &trnseq))
+                    {
+                        itran++;
+                        coderet_put_seq(seq, trnseq, itran,"pro",1,seqoutprot);
+                    }
                 }
             }
+            ajListIterDel(&iter);
+
+            if(seqoutrest)
+                coderet_put_rest(seq,copyseq,"noncoding",seqoutrest);
         }
-        ajListIterDel(&iter);
-        
-        if(seqoutrest)
-            coderet_put_rest(seq,copyseq,"noncoding",seqoutrest);
 
         if(seqoutcds)
             ajFmtPrintF(logf, "%6d", icds);
diff -Nurd EMBOSS-6.2.0/emboss/emma.c EMBOSS-6.2.0-patched/emboss/emma.c
--- EMBOSS-6.2.0/emboss/emma.c	2009-12-11 10:37:59.000000000 -0500
+++ EMBOSS-6.2.0-patched/emboss/emma.c	2010-03-02 05:20:41.000000000 -0500
@@ -390,17 +390,13 @@
 
 /*    ajFmtError("..%s..\n\n", ajStrGetPtr( cmd)); */
     ajDebug("Executing '%S'\n", cmd);
-#ifndef WIN32
-    ajSysSystemEnv(cmd, env);
-#else
+
     if(system(ajStrGetPtr(cmd)) == -1)
     {
         fprintf(stderr,"Command: %s\n",ajStrGetPtr(cmd));
 	ajFatal("clustalw execution failure");
     }
 
-#endif
-
     /* produce alignment file only if one was produced */
     if(!only_dend)
     {
diff -Nurd EMBOSS-6.2.0/emboss/jaspextract.c EMBOSS-6.2.0-patched/emboss/jaspextract.c
--- EMBOSS-6.2.0/emboss/jaspextract.c	2008-11-14 12:22:57.000000000 -0500
+++ EMBOSS-6.2.0-patched/emboss/jaspextract.c	2010-03-02 05:20:41.000000000 -0500
@@ -22,49 +22,58 @@
 
 #include "emboss.h"
 
+#ifdef WIN32
+#include <direct.h>
+#endif
 
+#define PFMNUMGUESS 2000
+#define MATRIXFILE "matrix_list.txt"
 
 
-/* @datastatic JaspDir **************************************************
+
+
+/* @datastatic JaspPrefix **************************************************
 **
 ** JASPAR data directory structure
 **
-** @alias JaspSDir
-** @alias JaspODir
+** @alias SJaspPrefix
+** @alias OJaspPrefix
 **
-** @attr namactual [AjPStr] name of Jaspar source subdirectory
-** @attr namdata [AjPStr] name of Jaspar subdirectory in EMBOSS_DATA area
+** @attr Prefix [const char*] Filename prefix of pfm files
+** @attr Directory [const char*] Directory name for files of a given prefix
 ** @@
 ******************************************************************************/
 
-typedef struct JaspSDir
+typedef struct SJaspPrefix
 {
-    AjPStr namactual;
-    AjPStr namdata;
-} JaspODir;
-#define JaspPDir JaspODir*
-
-
-
-
-static void jaspextract_check(const AjPStr directory, AjPList dlist);
-static void jaspextract_copy(AjPList dlist);
+    const char* Prefix;
+    const char* Directory;
+} OJaspPrefix;
 
-static void jaspextract_jddel(JaspPDir *thys);
-static JaspPDir jaspextract_jdnew(void);
+static OJaspPrefix Jprefix[] =
+{
+    {"PB", "JASPAR_PBM"},
+    {"PL", "JASPAR_PBM_HLH"},
+    {"PH", "JASPAR_PBM_HOMEO"},
+    {"MA", "JASPAR_CORE"},
+    {"CN", "JASPAR_CNE"},
+    {"MF", "JASPAR_FAM"},
+    {"PF", "JASPAR_PHYLOFACTS"},
+    {"POL", "JASPAR_POLII"},
+    {"SA", "JASPAR_SPLICE"},
+    {"SD", "JASPAR_SPLICE"},
+    {NULL, NULL}
+};
 
 
 
 
-static const char *jdirnames[] = {
-    "JASPAR_CORE",
-    "JASPAR_FAM",
-    "JASPAR_PHYLOFACTS",
-    "JASPAR_CNE",
-    "JASPAR_POLII",
-    "JASPAR_SPLICE",
-    NULL
-};
+static void jaspextract_openoutdirs(void);
+static void jaspextract_copyfiles(AjPStr directory);
+static void jaspextract_readmatrixlist(AjPTable mtable, const AjPStr directory);
+static void jaspextract_getjaspdirs(AjPList jdirlist);
+static void jaspextract_writematrixfile(const AjPTable mtable,
+                                        const AjPStr directory);
 
 
 
@@ -81,21 +90,37 @@
 
 int main(int argc, char **argv)
 {
+
     AjPStr directory = NULL;
-    AjPList dlist = NULL;
+    AjPTable mtable = NULL;
+
+    AjPList jdirlist = NULL;
+    AjPStr  jdirloc  = NULL;
     
     embInit("jaspextract",argc,argv);
 
     directory = ajAcdGetDirectoryName("directory");
 
-    dlist = ajListNew();
+    mtable = ajTablestrNewLen(PFMNUMGUESS);
+    jdirlist = ajListNew();
     
-    jaspextract_check(directory, dlist);
+    jaspextract_openoutdirs();
+    jaspextract_copyfiles(directory);
 
-    jaspextract_copy(dlist);
+    jaspextract_readmatrixlist(mtable, directory);
+    
+    jaspextract_getjaspdirs(jdirlist);
 
+    while(ajListPop(jdirlist,(void **)&jdirloc))
+    {
+        jaspextract_writematrixfile(mtable, jdirloc);
+        ajStrDel(&jdirloc);
+    }
+    
+    ajTablestrFree(&mtable);
     ajStrDel(&directory);
-
+    ajListFree(&jdirlist);
+    
     embExit();
 
     return 0;
@@ -104,208 +129,349 @@
 
 
 
-/* @funcstatic jaspextract_check ***********************************************
+/* @funcstatic jaspextract_openoutdirs **************************************
 **
-** Checks whether specific JASPAR subdirectories exist
+** Checks whether JASPAR output subdirectories exist in the current
+** EMBOSS data area. Create them if not. Open them.
 **
-** @param [r] directory [const AjPStr] jaspar directory
-** @param [w] dlist     [AjPList] jaspar directory list
+** @return [void]
+** @@
+******************************************************************************/
+
+static void jaspextract_openoutdirs(void)
+{
+    const AjPStr datadir = NULL;
+    AjPStr dir = NULL;
+    const char *p = NULL;
+    
+    ajuint i = 0;
+    
+    datadir = ajDatafileValuePath();
+    if(!datadir)
+        ajFatal("jaspextract: Cannot determine the EMBOSS data directory");
+
+    dir  = ajStrNew();
+    
+    i = 0;
+
+    while(Jprefix[i].Directory)
+    {
+        ajFmtPrintS(&dir,"%S%s",datadir,Jprefix[i].Directory);
+
+        if(!ajFilenameExistsDir(dir))
+        {
+            p = ajStrGetPtr(dir);
+#ifndef WIN32
+            mkdir(p,0755);
+#else
+            _mkdir(p);
+#endif
+        }
+        
+        if(!ajFilenameExistsDir(dir))
+            ajFatal("jaspextract: No such directory %S",
+                    dir);
+
+        ++i;
+    }
+    
+    ajStrDel(&dir);
+    
+    return;
+}
+
+
+
+
+/* @funcstatic jaspextract_copyfiles *****************************************
+**
+** Copy datafiles into the EMBOSS data area
+**
+** @param [u] directory [AjPStr] jaspar source flatfile directory
 **
 ** @return [void]
 ** @@
 ******************************************************************************/
 
-static void jaspextract_check(const AjPStr directory, AjPList dlist)
+static void jaspextract_copyfiles(AjPStr directory)
 {
-    AjPStr entry  = NULL;
-    AjPStr nbase  = NULL;
+    AjPStr matrixfile = NULL;
+    AjPList flist     = NULL;
     
-    AjPList flist = NULL;
-    ajint i = 0;
+    AjPStr wild  = NULL;
+    AjPStr entry = NULL;
+    AjPStr bname = NULL;
+    AjPStr line  = NULL;
+    AjPStr dest  = NULL;
 
-    JaspPDir jdir = NULL;
+    const AjPStr datadir = NULL;
     
+    ajuint preflen = 0;
+    ajuint i       = 0;
+    const char *p  = NULL;
+
+    AjPFile inf   = NULL;
+    AjPFile outf  = NULL;    
     
+    matrixfile = ajStrNew();
+    flist      = ajListNew();
+    wild       = ajStrNewC("*.pfm");
+    bname      = ajStrNew();
+    line       = ajStrNew();
+    dest       = ajStrNew();
 
-    flist = ajListNew();
 
+    datadir = ajDatafileValuePath();
+    if(!datadir)
+        ajFatal("jaspextract: Cannot determine the EMBOSS data directory");
+    
+    ajFmtPrintS(&matrixfile,"%S%s",directory,MATRIXFILE);
 
-    ajFilelistAddPathDir(flist, directory);
+    if(!ajFilenameExistsRead(matrixfile))
+        ajFatal("jaspextract: Directory (%S) doesn't appear to be a JASPAR "
+                "one\nNo matrix_list.txt file found",directory);
+    
+    ajFilelistAddPathWild(flist, directory, wild);
 
 
     while(ajListPop(flist,(void **)&entry))
     {
-        ajDebug("jaspextract_check '%S'\n", entry);
+        ajStrAssignS(&bname,entry);
+        ajFilenameTrimPath(&bname);
         
-        if(!ajFilenameExistsRead(entry))
-            continue;
-
-        ajStrAssignS(&nbase,entry);
-	ajFilenameTrimPath(&nbase);
-
         i = 0;
-        while(jdirnames[i])
+
+        while(Jprefix[i].Prefix)
         {
-            if(ajStrPrefixC(nbase,jdirnames[i]))
+            if(!ajStrPrefixC(bname,Jprefix[i].Prefix))
             {
-                jdir = jaspextract_jdnew();
-                ajStrAssignS(&jdir->namactual,entry);
-                ajStrAssignC(&jdir->namdata,jdirnames[i]);
-                ajListPush(dlist,(void *)jdir);
-                ajDebug("found %d: '%s' => '%S' '%S'\n",
-                        i, jdirnames[i], jdir->namactual, jdir->namdata);
+                ++i;
+                continue;
             }
-            
+
+            preflen = strlen(Jprefix[i].Prefix);
+            p = ajStrGetPtr(bname);
+            if(p[preflen]>='0' && p[preflen]<='9')
+                break;
 
             ++i;
         }
 
-        ajStrDel(&entry);
-    }
+        if(!Jprefix[i].Prefix)
+        {
+            ajStrDel(&entry);
+            continue;
+        }
 
 
-    ajStrDel(&nbase);
+        ajFmtPrintS(&dest,"%S%s%c%S",datadir,Jprefix[i].Directory,SLASH_CHAR,
+                    bname);
+
+        outf = ajFileNewOutNameS(dest);
+        if(!outf)
+            ajFatal("Cannot open output file %S",dest);
+
+        /* Avoid UNIX copy for portability */
+        inf  = ajFileNewInNameS(entry);
+        if(!inf)
+            ajFatal("Cannot open input file: %S",entry);
 
+        while(ajReadlineTrim(inf,&line))
+            ajFmtPrintF(outf,"%S\n",line);
+
+        ajFileClose(&inf);
+        ajFileClose(&outf);
+        
+        ajStrDel(&entry);        
+
+    }
+    
     ajListFree(&flist);
     
+    ajStrDel(&wild);
+    ajStrDel(&dest);
+    ajStrDel(&line);
+    ajStrDel(&bname);
+    ajStrDel(&matrixfile);
+
     return;
 }
 
 
 
 
-/* @funcstatic jaspextract_copy ***********************************************
+/* @funcstatic jaspextract_readmatrixlist *************************************
 **
-** Copy datafile into the EMBOSS  data area
+** Read the matrix_list.txt file
 **
-** @param [u] dlist [AjPList] jaspar directory list
+** @param [u] mtable [AjPTable] Table for pfm entry descriptions
+** @param [r] directory [const AjPStr] Directory containing matrix_list.txt
 **
 ** @return [void]
 ** @@
 ******************************************************************************/
 
-static void jaspextract_copy(AjPList dlist)
+static void jaspextract_readmatrixlist(AjPTable mtable, const AjPStr directory)
 {
-    AjPStr wild   = NULL;
-    AjPList flist = NULL;
-    AjPStr entry  = NULL;
-    AjPStr nbase  = NULL;
-    AjPStr dfile  = NULL;
-    AjPFile inf   = NULL;
-    AjPFile outf  = NULL;
-    AjPStr line   = NULL;
+    const AjPStr datadir = NULL;
 
-    JaspPDir jdir = NULL;
+    AjPStr matrixfile = NULL;
+    AjPFile inf = NULL;
+
+    AjPStr line  = NULL;
+    AjPStr key   = NULL;
+    AjPStr value = NULL;
     
+    matrixfile = ajStrNew();
     
-    wild   = ajStrNewC("*");
-    flist  = ajListNew();
-    nbase  = ajStrNew();
-    dfile  = ajStrNew();
-    line   = ajStrNew();
 
+    datadir = ajDatafileValuePath();
+    if(!datadir)
+        ajFatal("jaspextract: Cannot determine the EMBOSS data directory");
+    
+    ajFmtPrintS(&matrixfile,"%S%s",directory,MATRIXFILE);
 
+    if(!ajFilenameExistsRead(matrixfile))
+        ajFatal("jaspextract: Directory (%S) doesn't appear to be a JASPAR "
+                "one\nNo matrix_list.txt file found",directory);
 
 
-    while(ajListPop(dlist,(void **)&jdir))
+    inf  = ajFileNewInNameS(matrixfile);
+    if(!inf)
+        ajFatal("Cannot open input file: %S",matrixfile);
+
+    while(ajReadline(inf,&line))
     {
-        ajFilelistAddPathWild(flist, jdir->namactual,wild);
-        ajDebug("jaspextract_copy '%S' '%S'\n",
-                jdir->namactual, wild);
-        while(ajListPop(flist,(void **)&entry))
+        key = ajStrNew();
+        
+        if(ajFmtScanS(line,"%S",&key) != 1)
         {
-            ajStrAssignS(&nbase,entry);
-            ajFilenameTrimPath(&nbase);
-            ajFmtPrintS(&dfile,"%S%c%S",jdir->namdata,SLASH_CHAR,nbase);
-            ajDebug("copying '%S' => '%S'\n",
-                    entry, dfile);
-            /* Avoid UNIX copy for portability */
-            inf  = ajFileNewInNameS(entry);
-            if(!inf)
-                ajFatal("Cannot open input file: %S",entry);
-
-            outf = ajDatafileNewOutNameS(dfile);
-            if(!outf)
-                ajFatal("Cannot open output file: %S",dfile);
-
-            while(ajReadlineTrim(inf,&line))
-                ajFmtPrintF(outf,"%S\n",line);
-
-            ajFileClose(&inf);
-            ajFileClose(&outf);
-
-            ajStrDel(&entry);
+            ajStrDel(&key);
+            continue;
         }
 
-        jaspextract_jddel(&jdir);
+        value = ajStrNew();
+        ajStrAssignS(&value,line);
+
+        ajTablePut(mtable,(void *)key, (void *)value);
     }
     
 
-    ajListFree(&flist);
-    ajListFree(&dlist);
+    ajFileClose(&inf);
     
-    ajStrDel(&wild);
-    ajStrDel(&dfile);
-    ajStrDel(&nbase);
+    ajStrDel(&matrixfile);
     ajStrDel(&line);
-    
+        
     return;
 }
 
 
 
 
-/* @funcstatic jaspextract_jdnew ***********************************************
+/* @funcstatic jaspextract_getjaspdirs ****************************************
 **
-** Create a jaspar directory structure
+** Construct a list of JASPAR_ directory locations in the EMBOSS data area
 **
-** @return [JaspPDir] Jaspar directory structure
+** @param [u] jdirlist [AjPList] List for JASPAR_ directory locations
+**
+** @return [void]
 ** @@
 ******************************************************************************/
 
-static JaspPDir jaspextract_jdnew(void)
+static void jaspextract_getjaspdirs(AjPList jdirlist)
 {
-    JaspPDir ret = NULL;
+    const AjPStr datadir = NULL;
+    AjPStr line = NULL;
+    
+    ajuint n = 0;
+    ajuint i = 0;
+    
+    datadir = ajDatafileValuePath();
+    if(!datadir)
+        ajFatal("jaspextract: Cannot determine the EMBOSS data directory");
 
-    AJNEW(ret);
 
-    ret->namactual = ajStrNew();
-    ret->namdata   = ajStrNew();
+    n = ajFilelistAddPathDir(jdirlist, datadir);
 
-    return ret;
+    
+    for(i=0; i < n; ++i)
+    {
+        ajListPop(jdirlist,(void **)&line);
+
+        if(ajStrFindC(line,"JASPAR_") != -1)
+            ajListPushAppend(jdirlist,(void *)line);
+        else
+            ajStrDel(&line);
+    }
+
+    return;
 }
 
 
 
 
-/* @funcstatic jaspextract_jddel ***********************************************
+/* @funcstatic jaspextract_writematrixfile **********************************
 **
-** Delete a Jaspar directory structure
+** Writes a matrix_list.txt file in a JASPAR_ directory
 **
-** @param [w] thys [JaspPDir*] jaspar directory structure
+** @param [r] mtable [const AjPTable] Table of matrix definitions 
+** @param [r] directory [const AjPStr] JASPAR_ directory location
 **
 ** @return [void]
 ** @@
 ******************************************************************************/
 
-static void jaspextract_jddel(JaspPDir *thys)
+static void jaspextract_writematrixfile(const AjPTable mtable,
+                                        const AjPStr directory)
 {
-    JaspPDir pthis = NULL;
+    AjPStr wild   = NULL;
+    AjPList flist = NULL;
+    AjPStr key    = NULL;
+    AjPStr fname  = NULL;
+    AjPStr dest   = NULL;
+    AjPStr value  = NULL;
+    
+    AjPFile outf = NULL;
+    
+    const char *p = NULL;
+    char *q = NULL;
+    
+    wild = ajStrNewC("*.pfm");
+    flist = ajListNew();
+    key   = ajStrNew();
+    dest  = ajStrNew();
+    
+    ajFmtPrintS(&dest,"%S%c%s",directory,SLASH_CHAR,MATRIXFILE);
+    
+    outf = ajFileNewOutNameS(dest);
+    if(!outf)
+        ajFatal("Cannot open output file %S",dest);
 
-    if(!thys)
-        return;
+    ajFilelistAddPathWild(flist, directory, wild);
 
-    if(!*thys)
-        return;
-    
-    pthis = *thys;
+    while(ajListPop(flist,(void**)&fname))
+    {
+        ajFilenameTrimPath(&fname);        
 
-    ajStrDel(&pthis->namactual);
-    ajStrDel(&pthis->namdata);
-    AJFREE(*thys);
+        p = ajStrGetPtr(fname);
+        q = strrchr(p,(int)'.');
+        ajStrAssignSubC(&key,p,0,q-p-1);
+        
+        value = (AjPStr) ajTableFetch(mtable, (const void *)key);
 
-    *thys = NULL;
+        if(value)
+            ajFmtPrintF(outf,"%S",value);
 
+        ajStrDel(&fname);
+    }
+    
+        
+    ajFileClose(&outf);
+    
+    ajStrDel(&wild);
+    ajStrDel(&dest);
+    ajStrDel(&key);
+    ajListFree(&flist);
+    
     return;
 }
-
diff -Nurd EMBOSS-6.2.0/emboss/jaspscan.c EMBOSS-6.2.0-patched/emboss/jaspscan.c
--- EMBOSS-6.2.0/emboss/jaspscan.c	2009-10-09 07:26:35.000000000 -0400
+++ EMBOSS-6.2.0-patched/emboss/jaspscan.c	2010-03-02 05:20:41.000000000 -0500
@@ -36,18 +36,18 @@
 #define JASPTAB_GUESS 1000
 
 
-/* @datastatic AjPJsphits *****************************************************
+/* @datastatic PJsphits *****************************************************
 **
 ** Jaspar hits object
 **
 ** Holds hits from scanning a sequence with a Jaspar matrix
 ** Also holds matrix information and type.
 **
-** AjPJsphits is implemented as a pointer to a C data structure.
+** PJsphits is implemented as a pointer to a C data structure.
 **
 ** @alias AjPPStr
-** @alias AjSJsphits
-** @alias AjOJsphits
+** @alias SJsphits
+** @alias OJsphits
 **
 ** @attr matname [AjPStr] matrix name
 ** @attr start [ajuint] start position
@@ -61,7 +61,7 @@
 ** @@
 ******************************************************************************/
 
-typedef struct AjSJspHits {
+typedef struct SJsphits {
   AjPStr matname;
   ajuint start;
   ajuint end;
@@ -71,22 +71,22 @@
   float  maxscore;
   char type;
   char Padding[7];
-} AjOJsphits;
-#define AjPJsphits AjOJsphits*
+} OJsphits;
+#define PJsphits OJsphits*
 
 
 
 
-/* @datastatic AjPJspmat ******************************************************
+/* @datastatic PJspmat ******************************************************
 **
 ** Jaspar matrix object
 **
 ** Also holds matrix information and type from the matrix_list.txt file
 **
-** AjPJspmat is implemented as a pointer to a C data structure.
+** PJspmat is implemented as a pointer to a C data structure.
 **
-** @alias AjSJspmat
-** @alias AjOJspmat
+** @alias SJspmat
+** @alias OJspmat
 **
 ** @attr id [AjPStr] Identifier
 ** @attr num [AjPStr] Information content (very close to optional content value)
@@ -112,7 +112,7 @@
 ** @@
 ******************************************************************************/
 
-typedef struct AjSJspmat {
+typedef struct SJspmat {
     AjPStr id;
     AjPStr num;
     AjPStr name;
@@ -134,8 +134,8 @@
     AjPStr consens;
     char type;
     char Padding[7];
-} AjOJspmat;
-#define AjPJspmat AjOJspmat*
+} OJspmat;
+#define PJspmat OJspmat*
 
 
 
@@ -152,16 +152,16 @@
 			     const AjBool both, AjPList hits);
 
 
-static AjPJsphits jaspscan_hitsnew(void);
-static void       jaspscan_hitsdel(AjPJsphits *thys);
+static PJsphits jaspscan_hitsnew(void);
+static void       jaspscan_hitsdel(PJsphits *thys);
 
-static AjPJspmat  jaspscan_infonew(void);
-static void       jaspscan_infodel(AjPJspmat *thys);
+static PJspmat  jaspscan_infonew(void);
+static void       jaspscan_infodel(PJspmat *thys);
 
 static AjPTable jaspscan_ReadCoreList(const AjPStr jaspdir);
 static AjPTable jaspscan_ReadFamList(const AjPStr jaspdir);
 
-static void   jaspscan_coretoken(AjPJspmat info, const AjPStr str);
+static void   jaspscan_coretoken(PJspmat info, const AjPStr str);
 static ajuint jaspscan_readmatrix(const AjPStr mfname, float ***matrix);
 
 static void   jaspscan_ReportHits(AjPFeattable TabRpt, const AjPTable mattab,
@@ -594,7 +594,7 @@
 			  const float threshold,
 			  const AjBool both, AjPList hits)
 {
-    AjPJsphits val = NULL;
+    PJsphits val = NULL;
     AjPStr mname   = NULL;
     float **matrix = NULL;
     ajuint cols;
@@ -790,13 +790,13 @@
 **
 ** Creates a hits object
 **
-** @return [AjPJsphits] list of hits
+** @return [PJsphits] list of hits
 ** @@
 ******************************************************************************/
 
-static AjPJsphits jaspscan_hitsnew(void)
+static PJsphits jaspscan_hitsnew(void)
 {
-    AjPJsphits thys = NULL;
+    PJsphits thys = NULL;
     
     AJNEW0(thys);
     thys->matname = ajStrNew();
@@ -811,15 +811,15 @@
 **
 ** Delete a Jaspar hits object
 **
-** @param [w] thys [AjPJsphits*] Jaspar hits object
+** @param [w] thys [PJsphits*] Jaspar hits object
 **
 ** @return [void]
 ** @@
 ******************************************************************************/
 
-static void jaspscan_hitsdel(AjPJsphits *thys)
+static void jaspscan_hitsdel(PJsphits *thys)
 {
-    AjPJsphits pthis;
+    PJsphits pthis;
 
     pthis = *thys;
 
@@ -840,7 +840,7 @@
 **
 ** @param [r] jaspdir [const AjPStr] Jaspar directory
 **
-** @return [AjPTable] AjPJspmat objects with matrix ID keys
+** @return [AjPTable] PJspmat objects with matrix ID keys
 ** @@
 ******************************************************************************/
 
@@ -852,7 +852,7 @@
     AjPStr key   = NULL;
     AjPStr str   = NULL;
  
-    AjPJspmat info = NULL;
+    PJspmat info = NULL;
     
     AjPFile inf  = NULL;
     const char *p = NULL;
@@ -936,7 +936,7 @@
 **
 ** @param [r] jaspdir [const AjPStr] Jaspar directory
 **
-** @return [AjPTable] AjPJspmat objects with matrix ID keys
+** @return [AjPTable] PJspmat objects with matrix ID keys
 ** @@
 ******************************************************************************/
 
@@ -948,7 +948,7 @@
     AjPStr key   = NULL;
     AjPStr str   = NULL;
  
-    AjPJspmat info = NULL;
+    PJspmat info = NULL;
     
     AjPFile inf  = NULL;
     const char *p = NULL;
@@ -1036,14 +1036,14 @@
 **
 ** Parse matrix_list.txt key/value pairs
 **
-** @param [u] info [AjPJspmat] Jaspar matrix information
+** @param [u] info [PJspmat] Jaspar matrix information
 ** @param [r] str [const AjPStr] key/value pair
 **
 ** @return [void]
 ** @@
 ******************************************************************************/
 
-static void jaspscan_coretoken(AjPJspmat info, const AjPStr str)
+static void jaspscan_coretoken(PJspmat info, const AjPStr str)
 {
     const char *p;
     const char *q;
@@ -1123,13 +1123,13 @@
 **
 ** Creates a hits object
 **
-** @return [AjPJspmat] matrix information
+** @return [PJspmat] matrix information
 ** @@
 ******************************************************************************/
 
-static AjPJspmat jaspscan_infonew(void)
+static PJspmat jaspscan_infonew(void)
 {
-    AjPJspmat thys = NULL;
+    PJspmat thys = NULL;
     
     AJNEW0(thys);
 
@@ -1163,15 +1163,15 @@
 **
 ** Delete a Jaspar information object
 **
-** @param [w] thys [AjPJspmat*] Jaspar hits object
+** @param [w] thys [PJspmat*] Jaspar hits object
 **
 ** @return [void]
 ** @@
 ******************************************************************************/
 
-static void jaspscan_infodel(AjPJspmat *thys)
+static void jaspscan_infodel(PJspmat *thys)
 {
-    AjPJspmat pthis;
+    PJspmat pthis;
 
     pthis = *thys;
 
@@ -1220,8 +1220,8 @@
 static void jaspscan_ReportHits(AjPFeattable TabRpt, const AjPTable mattab,
 				AjPList hits)
 {
-    AjPJsphits hit = NULL;
-    AjPJspmat info = NULL;
+    PJsphits hit = NULL;
+    PJspmat info = NULL;
     AjPFeature feat = NULL;
     AjPStr str = NULL;
     float fnum = 0.;
@@ -1345,7 +1345,7 @@
 
 static void jaspscan_ClearTable(void **key, void **value, void *cl)
 {
-    AjPJspmat info = (AjPJspmat) *value;
+    PJspmat info = (PJspmat) *value;
     AjPStr skey = (AjPStr) *key;
     
     ajStrDel(&skey);
diff -Nurd EMBOSS-6.2.0/emboss/jembossctl.c EMBOSS-6.2.0-patched/emboss/jembossctl.c
--- EMBOSS-6.2.0/emboss/jembossctl.c	2008-06-26 04:39:09.000000000 -0400
+++ EMBOSS-6.2.0-patched/emboss/jembossctl.c	2010-03-02 05:20:41.000000000 -0500
@@ -1278,7 +1278,11 @@
 	return ajFalse;
     }
 
-
+/*
+    fprintf(stdout,"%s",ajStrGetPtr(outstd));
+    fprintf(stderr,"%s",ajStrGetPtr(errstd));
+*/
+    
     close(errpipe[0]);
     close(errpipe[1]);
     close(outpipe[0]);
@@ -1342,6 +1346,25 @@
 	return ajFalse;
     }
 
+    if(ajStrGetLen(errstd))
+    {
+        if(!(fp=fopen("stderrfile","w")))
+        {
+            fprintf(stderr,"errfile fopen error (do_batch)\n");
+            jembossctl_fork_tidy(&cl,&prog,&enviro,&dir,&outstd,&errstd);
+            return ajFalse;
+        }
+
+        fprintf(fp,"%s\n",ajStrGetPtr(errstd));
+    
+        if(fclose(fp))
+        {
+            fprintf(stderr,"errfile fclose error (do_batch)\n");
+            jembossctl_fork_tidy(&cl,&prog,&enviro,&dir,&outstd,&errstd);
+            return ajFalse;
+        }
+    }
+    
     jembossctl_fork_tidy(&cl,&prog,&enviro,&dir,&outstd,&errstd);
 
     return ajTrue;
@@ -1695,37 +1718,139 @@
 /* @funcstatic jembossctl_make_array ******************************************
 **
 ** Construct argv and env arrays for Ajax.fork
+** N.B. This function converts tabs to spaces and removes
+** excess space characters.
 **
-** @param [r] str [const AjPStr] space separated tokens
+** @param [r] str [const AjPStr] space or doublequote separated tokens
 **
 ** @return [char**] env or argv array
 ******************************************************************************/
 
 static char** jembossctl_make_array(const AjPStr str)
 {
-    int n;
-    char **ptr = NULL;
-    AjPStr buf;
-    const char *save = NULL;
+    ajint n = 0;
+    ajint i = 0;
+    ajint len = 0;
+    
+    char **ptr    = NULL;
+    const char *p = NULL;
+    const char *q = NULL;
+    char c;
+    AjPStr stmp = NULL;
+    AjPStr buf  = NULL;
+    
 
-    buf = ajStrNew();
+    n = 0;
+
+    stmp = ajStrNewS(str);
+    
+    ajStrRemoveWhiteExcess(&stmp);
+
+    p = ajStrGetPtr(stmp);
+    q = p;
+    
+    /*
+    ** Count the number of tokens
+    */
+
+    while((c = *p))
+    {
+        if(c == '"')
+        {
+            ++p;
+            
+            while(*p != '"' && *p)
+                ++p;
+
+            if(*p)
+                ++p;
+
+            if(*p == ' ')
+            {
+                ++n;
+                ++p;
+            }
+            
+            continue;
+        }
+
+        if(c == ' ')
+            ++n;
+
+        ++p;
+    }
+
+    if(p != q)
+        ++n;
 
-    n = ajStrParseCountMultiC(str," \t\n");
 
     AJCNEW0(ptr,n+1);
 
     ptr[n] = NULL;
 
+    /* If there are no tokens return an empty NULL terminated list */
+    if(!n)
+    {
+        ajStrDel(&stmp);
+        return ptr;
+    }
+    
+
+    /*
+    ** Tokenise and create ptr array strings
+    */
+
+    buf = ajStrNew();
+
+    p = q;
     n = 0;
+    
+    while((c = *p))
+    {
+        
+        if(c == '"')
+        {
+            ++p;
+            while(*p != '"' && *p)
+                ++p;
 
-    if(!ajSysFuncStrtokR(ajStrGetPtr(str)," \t\n",&save,&buf))
-	return ptr;
-    ptr[n++] = ajCharNewS(buf);
+            len = p-q;
+            
+            
+            if(*p)
+                ++p;
 
-    while(ajSysFuncStrtokR(NULL," \t\n",&save,&buf))
-	ptr[n++] = ajCharNewS(buf);
+            if(len > 1)
+                ajStrAssignSubC(&buf,q,1,len-1);
+            else
+                ajStrAssignC(&buf,"");
 
+            ptr[n++] = ajCharNewS(buf);
+            
+            if(*p == ' ')
+                ++p;
+
+            q = p;
+            continue;
+        }
+        
+        while(*p != ' ' && *p)
+            ++p;
+
+        len = p-q;
+        
+        ajStrAssignSubC(&buf,q,0,len-1);
+        ptr[n++] = ajCharNewS(buf);
+        
+        if(*p == ' ')
+            ++p;
+
+        q = p;
+    }
+
+        
     ajStrDel(&buf);
+    ajStrDel(&stmp);
 
     return ptr;
 }
diff -Nurd EMBOSS-6.2.0/emboss/matcher.c EMBOSS-6.2.0-patched/emboss/matcher.c
--- EMBOSS-6.2.0/emboss/matcher.c	2010-01-08 07:43:41.000000000 -0500
+++ EMBOSS-6.2.0-patched/emboss/matcher.c	2010-03-02 05:20:41.000000000 -0500
@@ -27,7 +27,6 @@
 
 
 
-
 /* @macro matchergap **********************************************************
 **
 ** sets k-symbol indel score
@@ -47,8 +46,6 @@
 static ajint  last;				/* Last script op appended */
 
 static ajint I, J;				/* current positions of A ,B */
-static ajint no_mat; 				/* number of matches */
-static ajint no_mis; 				/* number of mismatches */
 static ajint al_len; 				/* length of alignment */
 
 
@@ -256,7 +253,7 @@
 
 static void  matcher_Sim(AjPAlign align,
 			const char A[], const char B[],
-			 const AjPSeq seq1, const AjPSeq seq2, ajuint K,
+			 const AjPSeq seq0, const AjPSeq seq1, ajuint K,
 			ajint Q, ajint R, ajint beg, ajint beg2, ajint nseq);
 static ajint matcher_BigPass(const char A[], const char B[],
 			     ajint M, ajint N, ajint K,
@@ -413,10 +410,9 @@
     seq1len = ajSeqGetLen(seq1);
 
     /* allocate space for consensus */
-    i =(AJMIN(ajSeqGetLen(seq0),ajSeqGetLen(seq1)))*2;
+    i = (seq0len+seq1len+1);
     AJCNEW(seqc0,i);
     AJCNEW(seqc1,i);
-
     /* allocate space for all vectors */
 
     j = (seq1len + 1)				/* * sizeof(ajint)*/;
@@ -434,7 +430,7 @@
     AJCNEW(JJ, i);
     AJCNEW(XX, i);
     AJCNEW(YY, i);
-    AJCNEW(S,  AJMIN(i,j)*5/4);
+    AJCNEW(S,  (i+j));
     AJCNEW0(row,(seq0len + 1));
 
     /* set up list for each row (already zeroed by AJCNEW0 macro) */
@@ -452,7 +448,6 @@
     numnode = lmin = 0;
     matcher_BigPass(A,B,seq0len,seq1len,K,nseq, &numnode);
 
-    ajDebug("Matcher numnode: %d\n", numnode);
     /* Report the K best alignments one by one. After each alignment is
        output, recompute part of the matrix. First determine the size
        of the area to be recomputed, then do the recomputation         */
@@ -478,8 +473,6 @@
 	sapp  = S;
 	last  = 0;
 	al_len = 0;
-	no_mat = 0;
-	no_mis = 0;
 	matcher_Diff(&A[stari]-1, &B[starj]-1,rl,cl,q,q);
 
 	min0 = stari-1;
@@ -1359,10 +1352,6 @@
         {
 	    if(midj > 1) MATCHERINS(midj-1)
 		MATCHERREP
-		if(A[1] == B[midj])
-		  no_mat += 1;
-		else
-		  no_mis += 1;
 
 	    /* mark(A[I],B[J]) as used: put J into list row[I] */
 	    I++; J++;
@@ -1579,7 +1568,6 @@
 	    }
 	}
     }
-
     *sp0 = '\0';
     *sp1 = '\0';
     *nident = nid;
diff -Nurd EMBOSS-6.2.0/emboss/prettyplot.c EMBOSS-6.2.0-patched/emboss/prettyplot.c
--- EMBOSS-6.2.0/emboss/prettyplot.c	2010-01-08 07:43:41.000000000 -0500
+++ EMBOSS-6.2.0-patched/emboss/prettyplot.c	2010-03-02 05:20:41.000000000 -0500
@@ -434,24 +434,28 @@
 
     ajGraphicsGetCharsize(&defheight,&currentscale);
 
-    ajGraphicsSetCharscale(((float)ixlen/((float)(numres+charlen)*
-                                          (currentscale+(float)1.0)))/
+    ajGraphicsSetCharscale(((float)ixlen/((float)(numres+charlen+1)*
+                                          (currentscale * (float) 1.5)))/
                                            currentscale);
 
+/*    ajGraphicsSetCharscale(((float)ixlen/((float)(numres+charlen)*
+                                          (currentscale+(float)1.0)))/
+                                          currentscale); */
+
     ajGraphicsGetCharsize(&defheight,&currentscale);
 
     yincr = (currentscale + (float)3.0)*(float)0.3;
 
 /*
-** If we have titles (now the standard graph title and subtitle)
-** leave 5 rows of space for them
+** If we have titles (now the standard graph title and subtitle and footer)
+** leave 7 rows of space for them
 */
-    y=ystart-(float)6.0;
+    y=ystart-(float)7.0;
 
     if(ajStrGetLen(options))
     {
 	fold = ajGraphicsSetCharscale(1.0);
-	ajGraphicsDrawposTextAtmid(xmid,1.0,
+	ajGraphicsDrawposTextAtmid(xmid,2.0,
                                    ajStrGetPtr(options));
 	ajGraphicsSetCharscale(fold);
     }
@@ -1267,8 +1271,10 @@
 	if(consensus && (numseq==seqend))
 	{
 	    res[0] = constr[k];
-	    ajGraphicsDrawposTextAtstart((float)(count+gapcount),
-                                         y-(yincr*((seqend-seqstart)+1)),res);
+
+	    /* start -> mid */
+            ajGraphicsDrawposTextAtmid((float) 0.5 + (float)(count+gapcount),
+                                       y-(yincr*((seqend-seqstart)+1)),res);
 	}
     }
 
@@ -1339,8 +1345,10 @@
 			    res[0] = seqcharptr[j][k];
 			else
 			    res[0] = '-';
-			ajGraphicsDrawposTextAtstart((float)(count+gapcount),
-                                                     y-(yincr*l),res);
+	    /* start -> mid */
+			ajGraphicsDrawposTextAtmid((float) 0.5 +
+                                                   (float) (count+gapcount),
+                                                   y-(yincr*l),res);
 		    }
 		}
 	    }
diff -Nurd EMBOSS-6.2.0/emboss/recoder.c EMBOSS-6.2.0-patched/emboss/recoder.c
--- EMBOSS-6.2.0/emboss/recoder.c	2009-08-24 10:33:44.000000000 -0400
+++ EMBOSS-6.2.0-patched/emboss/recoder.c	2010-03-02 05:20:41.000000000 -0500
@@ -33,12 +33,12 @@
 
 
 
-/* @datastatic AjPRinfo *******************************************************
+/* @datastatic PRinfo *******************************************************
 **
 ** recoder internals for RE information
 **
-** @alias AjSRinfo
-** @alias AjORinfo
+** @alias SRinfo
+** @alias ORinfo
 **
 ** @attr code [AjPStr] Undocumented
 ** @attr site [AjPStr] Undocumented
@@ -50,7 +50,7 @@
 ** @attr Padding [char[4]] Padding to alignment boundary
 ******************************************************************************/
 
-typedef struct AjSRinfo
+typedef struct SRinfo
 {
     AjPStr code;
     AjPStr site;
@@ -60,18 +60,18 @@
     ajint cut3;
     ajint cut4;
     char Padding[4];
-} AjORinfo;
-#define AjPRinfo AjORinfo*
+} ORinfo;
+#define PRinfo ORinfo*
 
 
 
 
-/* @datastatic Mutant *********************************************************
+/* @datastatic PMutant *********************************************************
 **
 ** recoder internals for mutation sites
 **
-** @alias AjSRinfo
-** @alias AjORinfo
+** @alias SMutant
+** @alias OMutant
 **
 ** @attr code [AjPStr] Undocumented
 ** @attr site [AjPStr] Undocumented
@@ -84,7 +84,7 @@
 ** @attr Padding [char[6]] Padding to alignment boudnary
 ******************************************************************************/
 
-typedef struct Mutant
+typedef struct SMutant
 {
     AjPStr code;
     AjPStr site;
@@ -96,7 +96,7 @@
     char   nbase;
     char   Padding[6];
 } OMutant;
-#define Mutant OMutant*
+#define PMutant OMutant*
 
 
 static AjPTrn recoderTable = NULL;               /* translation table object */
@@ -109,14 +109,14 @@
 			       AjBool rev, ajint begin, ajint end,
 			       AjBool tshow);
 static AjPList recoder_checkTrans(const AjPStr seq,const EmbPMatMatch match,
-				  const AjPRinfo rlp, ajint begin, ajint radj,
+				  const PRinfo rlp, ajint begin, ajint radj,
 				  AjBool rev, ajint end, ajint pos,
 				  AjBool* empty);
 static AjBool recoder_checkPat(const EmbPMatMatch match,
-			       const AjPRinfo rlp, ajint radj, AjBool rev,
+			       const PRinfo rlp, ajint radj, AjBool rev,
 			       ajint begin, ajint end);
 static ajint recoder_changebase(char pbase, char* tbase);
-static void  recoder_mutFree(Mutant* mut);
+static void  recoder_mutFree(PMutant* mut);
 static ajint recoder_basecompare(const void *a, const void *b);
 
 static void recoder_fmt_seq(const char* title, const AjPStr seq,
@@ -155,7 +155,7 @@
     AjPList relist = NULL;
     AjPList muts;
     AjPList nmuts;
-    AjPRinfo re;
+    PRinfo re;
     AjPStr tailstr = NULL;
 
     embInit("recoder", argc, argv);
@@ -297,7 +297,7 @@
 
     AjPList patlist = NULL;            /* list for pattern matches of.. */
     EmbPMatMatch match;                /* ..AjMatMatch structures*/
-    AjPRinfo rlp = NULL;
+    PRinfo rlp = NULL;
 
     str   = ajStrNew();
     tstr  = ajStrNew();
@@ -410,7 +410,7 @@
     AjPFile fin = NULL;			/* file pointer to RE file data */
     AjPStr refilename = NULL;		/* .. & string for the filename */
     register ajint RStotal = 0;		/* counts no of RE */
-    AjPRinfo rinfo = NULL;
+    PRinfo rinfo = NULL;
     AjBool isall = ajFalse;
     ajint ne = 0;
     ajint i;
@@ -445,8 +445,11 @@
 
     /* read RE data into AjPRestrict obj */
 
-    while(embPatRestrictReadEntry(rptr,fin))
+    while(!ajFileIsEof(fin))
     {
+        if(!embPatRestrictReadEntry(rptr,fin))
+	    continue;
+
      	if(!isall)           /* only select enzymes on command line */
 	{
 	     for(i=0;i<ne;++i)
@@ -490,7 +493,7 @@
 ** Checks whether the RS pattern falls within the sequence string
 **
 ** @param [r] match [const EmbPMatMatch] Match data
-** @param [r] rlp [const AjPRinfo] Restriction site info
+** @param [r] rlp [const PRinfo] Restriction site info
 ** @param [r] radj [ajint] Adjustment for reversed sequence
 ** @param [r] rev [AjBool] Reverse sequence
 ** @param [r] begin [ajint] Start position
@@ -499,7 +502,7 @@
 **
 ******************************************************************************/
 static AjBool recoder_checkPat(const EmbPMatMatch match,
-			       const AjPRinfo rlp, ajint radj, AjBool rev,
+			       const PRinfo rlp, ajint radj, AjBool rev,
 			       ajint begin, ajint end)
 {
     ajint mpos;
@@ -550,7 +553,7 @@
 **
 ** @param [r] dna [const AjPStr] Sequence as a string
 ** @param [r] match [const EmbPMatMatch] Match data
-** @param [r] rlp [const AjPRinfo] Restriction site info
+** @param [r] rlp [const PRinfo] Restriction site info
 ** @param [r] begin [ajint] Start position
 ** @param [r] radj [ajint] Adjustment for reversed sequence
 ** @param [r] rev [AjBool] Reverse sequence
@@ -563,7 +566,7 @@
 ******************************************************************************/
 
 static AjPList recoder_checkTrans(const AjPStr dna, const EmbPMatMatch match,
-				  const AjPRinfo rlp, ajint begin, ajint radj,
+				  const PRinfo rlp, ajint begin, ajint radj,
 				  AjBool rev, ajint end, ajint pos,
 				  AjBool* empty)
 {
@@ -572,7 +575,7 @@
     const char *prs;
     char *s;
 
-    Mutant  tresult;
+    PMutant  tresult;
     AjPList res;
 
     ajint mpos;
@@ -805,7 +808,7 @@
 
 static void recoder_fmt_muts(AjPList muts, AjPFeattable feat, AjBool rev)
 {
-    Mutant res;
+    PMutant res;
     AjPFeature sf = NULL;
     AjPStr tmpFeatStr = NULL;
 
@@ -857,7 +860,7 @@
 
 static ajint recoder_basecompare(const void *a, const void *b)
 {
-    return((*(Mutant const *)a)->base)-((*(Mutant const *)b)->base);
+    return((*(PMutant const *)a)->base)-((*(PMutant const *)b)->base);
 }
 
 
@@ -867,11 +870,11 @@
 **
 ** Free allocated memory for mutant structure
 **
-** @param [d] mut [Mutant*] Mutant structure to be deleted
+** @param [d] mut [PMutant*] Mutant structure to be deleted
 ** @return [void]
 ******************************************************************************/
 
-static void recoder_mutFree(Mutant* mut)
+static void recoder_mutFree(PMutant* mut)
 {
     ajStrDel(&(*mut)->code);
     ajStrDel(&(*mut)->site);
diff -Nurd EMBOSS-6.2.0/emboss/remap.c EMBOSS-6.2.0-patched/emboss/remap.c
--- EMBOSS-6.2.0/emboss/remap.c	2009-12-01 09:30:08.000000000 -0500
+++ EMBOSS-6.2.0-patched/emboss/remap.c	2010-03-02 05:20:41.000000000 -0500
@@ -777,8 +777,11 @@
     /* push all enzyme names without the required criteria onto nocutlist */
 
     enz = embPatRestrictNew();
-    while(embPatRestrictReadEntry(enz, enzfile))
+    while(!ajFileIsEof(enzfile))
     {
+        if(!embPatRestrictReadEntry(enz, enzfile))
+	    continue;
+
          /* 
 	 ** If user entered explicit enzyme list, then check to see if
 	 ** this is one of that explicit list 
diff -Nurd EMBOSS-6.2.0/emboss/restrict.c EMBOSS-6.2.0-patched/emboss/restrict.c
--- EMBOSS-6.2.0/emboss/restrict.c	2009-08-24 10:33:44.000000000 -0400
+++ EMBOSS-6.2.0-patched/emboss/restrict.c	2010-03-02 05:20:41.000000000 -0500
@@ -951,8 +951,11 @@
     
     ne = ajArrCommaList(enzymes,&ea);
 
-    while(embPatRestrictReadEntry(enz,enzfile))
+    while(!ajFileIsEof(enzfile))
     {
+        if(!embPatRestrictReadEntry(enz,enzfile))
+	    continue;
+
         key = ajStrNew();
         ajStrAssignS(&key,enz->cod);
         ajStrFmtUpper(&key);
diff -Nurd EMBOSS-6.2.0/emboss/showfeat.c EMBOSS-6.2.0-patched/emboss/showfeat.c
--- EMBOSS-6.2.0/emboss/showfeat.c	2009-08-24 10:33:44.000000000 -0400
+++ EMBOSS-6.2.0-patched/emboss/showfeat.c	2010-03-02 05:20:41.000000000 -0500
@@ -266,7 +266,12 @@
 {
     AjIList    iter = NULL ;
     AjPFeature gf   = NULL ;
-    AjPFeattable feat;
+    void **array   = NULL ;
+    AjPFeature *fullfeats   = NULL ;
+    ajuint *featindex = NULL;
+    const AjPFeattable feat;
+    AjPList featlist = NULL;
+    AjPList fullfeatlist = NULL;
     AjPStr lineout;
     char strandout   = '\0';
     AjBool first     = ajTrue;
@@ -290,12 +295,16 @@
     AjPStr key = NULL;
     AjBool val = ajFalse;
 
+    ajuint i;
+    ajuint isize;
+    ajuint jsize;
+    ajuint j = 0;
+
     /* get the feature table of the sequence */
-    feat = ajSeqGetFeatCopy(seq);
+    feat = ajSeqGetFeat(seq);
     if(!feat)
 	return;
 
-
     lineout = ajStrNew();
     tagstmp = ajStrNewC("");
     tagsout = ajStrNewC("");
@@ -303,24 +312,55 @@
 
     if(ajFeattableGetSize(feat))
     {
+        isize = ajListToarray(feat->Features, (void***) &array);
+        fullfeats = (AjPFeature*) array;
+
+        featlist = ajListNew();
+        AJCNEW0(featindex, isize);
+
+        jsize = 0;
+        for(i=0;fullfeats[i];i++)
+        {
+            if(ajFeatIsChild(fullfeats[i]))
+                continue;
+             ajListPushAppend(featlist, fullfeats[i]);
+           featindex[jsize++] = i;
+        }
+
 	if(!ajStrCmpC(sortlist, "source"))
 	    /* sort by: sense, source, type, start */
-	    ajListSort(feat->Features, showfeat_CompareFeatSource);
+	    ajListToindex(featlist, featindex, showfeat_CompareFeatSource);
 	else if(!ajStrCmpC(sortlist, "start"))
-	    /* sort by: sense, start, type, source, source */
-	    ajListSort(feat->Features, showfeat_CompareFeatPos);
+	    /* sort by: sense, start, type, source */
+	    ajListToindex(featlist, featindex, showfeat_CompareFeatPos);
 	else if(!ajStrCmpC(sortlist, "type"))
 	    /* type */
 	    /* sort by: sense, type, source, start */
-	    ajListSort(feat->Features, showfeat_CompareFeatType);
+	    ajListToindex(featlist, featindex, showfeat_CompareFeatType);
 	/* else - no sort */
 
-	iter = ajListIterNewread(feat->Features) ;
+	if(!ajStrCmpC(sortlist, "nosort"))
+        {
+            iter = ajListIterNewread(feat->Features);
+        }
+        else 
+        {
+            fullfeatlist = ajListNew();
+            j = 0;
+            for(i=0;i<jsize;i++) 
+            {
+                j = featindex[i];
+                ajListPushAppend(fullfeatlist, fullfeats[j++]);
+                while(j < isize && ajFeatIsChild(fullfeats[j]))
+                      ajListPushAppend(fullfeatlist, fullfeats[j++]);
+            }
+            iter = ajListIterNewread(fullfeatlist);
+        }
+        AJFREE(featindex);
 
 	while(!ajListIterDone(iter))
 	{
 	    gf = ajListIterGet(iter);
-
             /* see if its a child of a multiple join */
 	    child = ajFalse;
             if(ajFeatIsMultiple(gf))
@@ -339,7 +379,6 @@
 	    else
 	    	want_multiple_line = ajFalse;
 
-
 	    /* check that the feature is within the range we wish to display */
 	    if(beg+1 > (ajint)ajFeatGetEnd(gf) || 
 	       end+1 < (ajint)ajFeatGetStart(gf))
@@ -510,15 +549,15 @@
 
     }
 
-
-    ajFeattableDel(&feat);
-
     ajStrDel(&tagstmp);
     ajStrDel(&tagsout);
     ajStrDel(&posout);
     ajStrDel(&lineout);
     ajStrDel(&sourceout);
     ajStrDel(&typeout);
+    ajListFree(&featlist);
+    ajListFree(&fullfeatlist);
+    AJFREE(array);
 
     return;
 }
diff -Nurd EMBOSS-6.2.0/emboss/showpep.c EMBOSS-6.2.0-patched/emboss/showpep.c
--- EMBOSS-6.2.0/emboss/showpep.c	2009-08-24 10:33:44.000000000 -0400
+++ EMBOSS-6.2.0-patched/emboss/showpep.c	2010-03-02 05:20:41.000000000 -0500
@@ -238,7 +238,7 @@
 	ajFmtPrintF(outfile, "\n");
 
 	if(html)
-	    ajFmtPrintF(outfile, "<PRE>");
+	    ajFmtPrintF(outfile, "</PRE>\n");
     }
     
 
diff -Nurd EMBOSS-6.2.0/emboss/showseq.c EMBOSS-6.2.0-patched/emboss/showseq.c
--- EMBOSS-6.2.0/emboss/showseq.c	2009-08-24 10:33:44.000000000 -0400
+++ EMBOSS-6.2.0-patched/emboss/showseq.c	2010-03-02 05:20:41.000000000 -0500
@@ -380,7 +380,7 @@
 	ajFmtPrintF(outfile, "\n");
 
 	if(html)
-	    ajFmtPrintF(outfile, "<PRE>");
+	    ajFmtPrintF(outfile, "</PRE>\n");
     }
     
 
diff -Nurd EMBOSS-6.2.0/emboss/silent.c EMBOSS-6.2.0-patched/emboss/silent.c
--- EMBOSS-6.2.0/emboss/silent.c	2009-08-24 10:33:44.000000000 -0400
+++ EMBOSS-6.2.0-patched/emboss/silent.c	2010-03-02 05:20:41.000000000 -0500
@@ -27,12 +27,12 @@
 
 
 
-/* @datastatic AjPRinfo *******************************************************
+/* @datastatic PRinfo *******************************************************
 **
 ** recoder internals for RE information
 **
-** @alias AjSRinfo
-** @alias AjORinfo
+** @alias SRinfo
+** @alias ORinfo
 **
 ** @attr code [AjPStr] structure for silent mutation info
 ** @attr site [AjPStr] Undocumented
@@ -44,7 +44,7 @@
 ** @attr Padding [char[4]] Padding to alignment boundary
 ******************************************************************************/
 
-typedef struct AjSRinfo
+typedef struct SRinfo
 {
     AjPStr code;
     AjPStr site;
@@ -54,18 +54,18 @@
     ajint cut3;
     ajint cut4;
     char Padding[4];
-} AjORinfo;
-#define AjPRinfo AjORinfo*
+} ORinfo;
+#define PRinfo ORinfo*
 
 
 
 
-/* @datastatic AjPSilent ******************************************************
+/* @datastatic PSilent ******************************************************
 **
 ** recoder internals for silent sites
 **
-** @alias AjSSilent
-** @alias AjOSilent
+** @alias SSilent
+** @alias OSilent
 **
 ** @attr code [AjPStr] Undocumented
 ** @attr site [AjPStr] Undocumented
@@ -79,7 +79,7 @@
 ** @attr Padding [char[2]] Padding to alignment boundary
 ******************************************************************************/
 
-typedef struct AjSSilent
+typedef struct SSilent
 {
     AjPStr code;
     AjPStr site;
@@ -91,8 +91,8 @@
     char   obase;
     char   nbase;
     char Padding[2];
-} AjOSilent;
-#define AjPSilent AjOSilent*
+} OSilent;
+#define PSilent OSilent*
 
 
 
@@ -103,8 +103,8 @@
 			       ajint radj, AjBool rev, ajint end,
 			       AjBool tshow);
 static ajint silent_restr_read(AjPList *relist, const AjPStr enzymes);
-static AjPSilent silent_checktrans(const AjPStr seq,const EmbPMatMatch match,
-				const AjPRinfo rlp, ajint begin, ajint radj,
+static PSilent silent_checktrans(const AjPStr seq,const EmbPMatMatch match,
+				const PRinfo rlp, ajint begin, ajint radj,
 				AjBool rev, ajint end);
 static void silent_fmt_sequence(const char* title, const AjPStr seq,
 				AjPStr* tailstr,
@@ -271,7 +271,7 @@
 
 static void silent_relistdel(AjPList* relist)
 {
-    AjPRinfo rlp = NULL;
+    PRinfo rlp = NULL;
     
     while(ajListPop(*relist,(void **)&rlp))
     {
@@ -307,7 +307,7 @@
 			       ajint radj,AjBool rev, ajint end,
 			       AjBool tshow)
 {
-    AjPSilent res;
+    PSilent res;
     AjPList results;
     AjPStr str;                          /*holds RS patterns*/
     AjPStr tstr;
@@ -320,7 +320,7 @@
     AjPList patlist = NULL;            /*a list for pattern matches.
                                              a list of ..*/
     EmbPMatMatch match;                /*..AjMatMatch structures*/
-    AjPRinfo rlp = NULL;
+    PRinfo rlp = NULL;
     AjPStr pep   = NULL;               /*string to hold protein*/
     AjPTrn table = NULL;               /*object to hold translation table*/
 
@@ -428,7 +428,7 @@
 
     AjPStr refilename = NULL;
     register ajint RStotal = 0;
-    AjPRinfo rinfo = NULL;
+    PRinfo rinfo = NULL;
     AjBool isall = ajFalse;
     ajint ne = 0;
     ajint i;
@@ -457,8 +457,11 @@
             isall = ajFalse;
     }
 
-    while(embPatRestrictReadEntry(rptr,fin))
+    while(!ajFileIsEof(fin))
     {
+        if(!embPatRestrictReadEntry(rptr,fin))
+	    continue;
+
      	if(!isall)
 	{
 		for(i=0;i<ne;++i)
@@ -501,20 +504,20 @@
 **
 ** @param [r] seq [const AjPStr] sequence
 ** @param [r] match [const EmbPMatMatch] pattern match
-** @param [r] rlp [const AjPRinfo] RE information
+** @param [r] rlp [const PRinfo] RE information
 ** @param [r] begin [ajint] start position
 ** @param [r] radj [ajint] reverse numbering adjustment
 ** @param [r] rev [AjBool] do complement
 ** @param [r] end [ajint] end position
-** @return [AjPSilent] silent mutation object or NULL if not found
+** @return [PSilent] silent mutation object or NULL if not found
 ** @@
 ******************************************************************************/
 
-static AjPSilent silent_checktrans(const AjPStr seq,const EmbPMatMatch match,
-				const AjPRinfo rlp, ajint begin, ajint radj,
+static PSilent silent_checktrans(const AjPStr seq,const EmbPMatMatch match,
+				const PRinfo rlp, ajint begin, ajint radj,
 				AjBool rev, ajint end)
 {
-    AjPSilent ret;
+    PSilent ret;
     const char *p = NULL;
     const char *q = NULL;
     const char *s = NULL;
@@ -721,7 +724,7 @@
 static void silent_fmt_hits(AjPList hits, AjPFeattable feat,
 			    AjBool silent, AjBool rev)
 {
-    AjPSilent res;
+    PSilent res;
     AjPFeature sf = NULL;
     AjPStr tmpFeatStr = NULL;
 
@@ -780,7 +783,7 @@
 static void silent_split_hits(AjPList *hits, AjPList *silents,
 			      AjPList *nonsilents, AjBool allmut)
 {
-    AjPSilent res;
+    PSilent res;
 
     while(ajListPop(*hits,(void **)&res))
     {
@@ -819,5 +822,5 @@
 
 static ajint silent_basecompare(const void *a, const void *b)
 {
-    return((*(AjPSilent const *)a)->base)-((*(AjPSilent const *)b)->base);
+    return((*(PSilent const *)a)->base)-((*(PSilent const *)b)->base);
 }
diff -Nurd EMBOSS-6.2.0/emboss/splitter.c EMBOSS-6.2.0-patched/emboss/splitter.c
--- EMBOSS-6.2.0/emboss/splitter.c	2009-08-24 10:33:44.000000000 -0400
+++ EMBOSS-6.2.0-patched/emboss/splitter.c	2010-03-02 05:20:41.000000000 -0500
@@ -102,10 +102,11 @@
                 pos += size;
             }
         }
+
         splitter_MakeSubSeqName(&outseq_name, seq, pos, len-1);
         splitter_ProcessChunk (seqout, seq, pos, len-1,
                                outseq_name, feature);
-      }
+    }
 
     ajSeqoutClose(seqout);
     ajSeqallDel(&seqall);
@@ -135,17 +136,20 @@
 static void splitter_write(AjPSeqout default_seqout,
                            AjPSeq subseq, const AjPSeq seq)
 {
-  /* set the description of the subsequence */
-  ajSeqAssignDescS(subseq, ajSeqGetDescS(seq));
+    /* set the description of the subsequence */
+    ajSeqAssignDescS(subseq, ajSeqGetDescS(seq));
 
-  /* set the type of the subsequence */
-  ajSeqType(subseq);
+    /* set the type of the subsequence */
+    ajSeqType(subseq);
 
-  ajSeqoutWriteSeq(default_seqout, subseq);
+    ajSeqoutWriteSeq(default_seqout, subseq);
 
-  return;
+    return;
 }
 
+
+
+
 /* @funcstatic splitter_MakeSubSeqName ****************************************
 **
 ** Undocumented
@@ -161,20 +165,23 @@
                                      const AjPSeq seq, ajuint start,
                                      ajuint end)
 {
-  AjPStr value = ajStrNew();
+    AjPStr value = ajStrNew();
 
-  /* create a nice name for the subsequence */
-  ajStrAssignS(name_ptr, ajSeqGetNameS(seq));
-  ajStrAppendC(name_ptr, "_");
-  ajStrFromUint(&value, ajSeqGetBegin(seq)+start);
-  ajStrAppendS(name_ptr, value);
-  ajStrAppendC(name_ptr, "-");
-  ajStrFromUint(&value, ajSeqGetBegin(seq)+end);
-  ajStrAppendS(name_ptr, value);
+    /* create a nice name for the subsequence */
+    ajStrAssignS(name_ptr, ajSeqGetNameS(seq));
+    ajStrAppendC(name_ptr, "_");
+    ajStrFromUint(&value, ajSeqGetBegin(seq)+start);
+    ajStrAppendS(name_ptr, value);
+    ajStrAppendC(name_ptr, "-");
+    ajStrFromUint(&value, ajSeqGetBegin(seq)+end);
+    ajStrAppendS(name_ptr, value);
 
-  ajStrDel(&value);
+    ajStrDel(&value);
 }
 
+
+
+
 /* @funcstatic splitter_ProcessChunk ******************************************
 **
 ** Undocumented
@@ -192,29 +199,35 @@
                                    ajuint start, ajuint end, const AjPStr name,
                                    AjBool feature)
 {
-  AjPStr str = ajStrNew();
+    AjPStr str;
 
-  AjPFeattable new_feattable = NULL;
-  AjPSeq subseq = ajSeqNew ();
+    AjPFeattable new_feattable = NULL;
+    AjPSeq subseq;
 
-  ajDebug("splitter_ProcessChunk %d..%d '%S' %B\n",
-	  start, end, name, feature);
+    ajDebug("splitter_ProcessChunk %d..%d '%S' %B\n",
+            start, end, name, feature);
 
-  new_feattable = ajFeattableNew(name);
-  subseq->Fttable = new_feattable;
-  ajFeattableSetNuc(new_feattable);
+    str    = ajStrNew();
+    subseq = ajSeqNew();
+  
+  
+    new_feattable = ajFeattableNew(name);
+    subseq->Fttable = new_feattable;
+    ajFeattableSetNuc(new_feattable);
 
-  ajStrAssignSubC(&str,ajSeqGetSeqC(seq),start,end);
-  ajSeqAssignSeqS(subseq,str);
-  if (feature)
-    splitter_AddSubSeqFeat(subseq->Fttable,start,end,seq);
-  ajSeqAssignNameS(subseq, name);
-  splitter_write(seqout,subseq,seq);
+    ajStrAssignSubC(&str,ajSeqGetSeqC(seq),start,end);
+    ajSeqAssignSeqS(subseq,str);
 
-  ajStrDel(&str);
-  ajSeqDel(&subseq);
+    if(feature)
+        splitter_AddSubSeqFeat(subseq->Fttable,start,end,seq);
 
-  return;
+    ajSeqAssignNameS(subseq, name);
+    splitter_write(seqout,subseq,seq);
+
+    ajStrDel(&str);
+    ajSeqDel(&subseq);
+
+    return;
 }
 
 
@@ -233,40 +246,48 @@
 static void splitter_AddSubSeqFeat(AjPFeattable ftable, ajuint start,
                                    ajuint end, const AjPSeq oldseq)
 {
-  AjPFeattable old_feattable = NULL;
-  AjIList iter = NULL;
-
-  old_feattable = ajSeqGetFeatCopy(oldseq);
-  iter = ajListIterNewread(old_feattable->Features);
+    AjPFeattable old_feattable = NULL;
+    AjIList iter = NULL;
 
-  while(!ajListIterDone(iter)) {
-    AjPFeature gf = ajListIterGet(iter);
+    old_feattable = ajSeqGetFeatCopy(oldseq);
 
-    AjPFeature copy = NULL;
+    if(!old_feattable)
+        return;
 
+    iter = ajListIterNewread(old_feattable->Features);
 
-    if (((ajFeatGetEnd(gf) < start + 1) &&
-        (gf->End2 == 0 || gf->End2 < start + 1)) ||
-        ((ajFeatGetStart(gf) > end + 1) &&
-        (gf->Start2 == 0 || gf->Start2 > end + 1)))
+    while(!ajListIterDone(iter))
     {
-        continue;
-    }
+        AjPFeature gf = ajListIterGet(iter);
 
-    copy = ajFeatNewFeat(gf);
-    copy->Start = copy->Start - start;
-    copy->End = copy->End - start;
+        AjPFeature copy = NULL;
 
-    if (copy->Start2 > 0)
-      copy->Start2 = copy->Start2 - start;
 
-    if (copy->End2 > 0)
-      copy->End2 = copy->End2 - start;
+        if (((ajFeatGetEnd(gf) < start + 1) &&
+             (gf->End2 == 0 || gf->End2 < start + 1)) ||
+            ((ajFeatGetStart(gf) > end + 1) &&
+             (gf->Start2 == 0 || gf->Start2 > end + 1)))
+        {
+            continue;
+        }
 
-    ajFeatTrimOffRange (copy, 0, 1, end - start + 1, AJTRUE, AJTRUE);
+        copy = ajFeatNewFeat(gf);
+        copy->Start = copy->Start - start;
+        copy->End = copy->End - start;
 
-    ajFeattableAdd(ftable, copy);
-  }
-  ajFeattableDel(&old_feattable);
-  ajListIterDel(&iter);
+        if (copy->Start2 > 0)
+            copy->Start2 = copy->Start2 - start;
+
+        if (copy->End2 > 0)
+            copy->End2 = copy->End2 - start;
+
+        ajFeatTrimOffRange (copy, 0, 1, end - start + 1, AJTRUE, AJTRUE);
+
+        ajFeattableAdd(ftable, copy);
+    }
+
+    ajFeattableDel(&old_feattable);
+    ajListIterDel(&iter);
+
+    return;
 }
diff -Nurd EMBOSS-6.2.0/jemboss/org/emboss/jemboss/JembossParams.java EMBOSS-6.2.0-patched/jemboss/org/emboss/jemboss/JembossParams.java
--- EMBOSS-6.2.0/jemboss/org/emboss/jemboss/JembossParams.java	2008-07-03 10:54:02.000000000 -0400
+++ EMBOSS-6.2.0-patched/jemboss/org/emboss/jemboss/JembossParams.java	2010-03-02 05:20:41.000000000 -0500
@@ -22,6 +22,7 @@
 
 import java.util.*;
 import java.io.FileInputStream;
+import java.io.InputStream;
 
 
 /**
@@ -280,7 +281,9 @@
     // try out of the classpath
     try
     {
-      jembossSettings.load(cl.getResourceAsStream("resources/jemboss.properties"));
+        InputStream is = cl.getResourceAsStream("resources/jemboss.properties");
+        if (is!=null)
+            jembossSettings.load(is);
     } 
     catch (Exception e) 
     {
diff -Nurd EMBOSS-6.2.0/jemboss/org/emboss/jemboss/gui/ShowResultSet.java EMBOSS-6.2.0-patched/jemboss/org/emboss/jemboss/gui/ShowResultSet.java
--- EMBOSS-6.2.0/jemboss/org/emboss/jemboss/gui/ShowResultSet.java	2009-10-26 09:31:54.000000000 -0400
+++ EMBOSS-6.2.0-patched/jemboss/org/emboss/jemboss/gui/ShowResultSet.java	2010-03-02 05:20:41.000000000 -0500
@@ -189,6 +189,8 @@
   public void setJMenuBar()
   {
     int index = rtp.getSelectedIndex();
+    if (index == -1)
+        return;
     String title = rtp.getTitleAt(index);
     if (toolbar != null)
         remove(toolbar);
diff -Nurd EMBOSS-6.2.0/jemboss/org/emboss/jemboss/gui/filetree/DragTree.java EMBOSS-6.2.0-patched/jemboss/org/emboss/jemboss/gui/filetree/DragTree.java
--- EMBOSS-6.2.0/jemboss/org/emboss/jemboss/gui/filetree/DragTree.java	2010-01-06 10:24:58.000000000 -0500
+++ EMBOSS-6.2.0-patched/jemboss/org/emboss/jemboss/gui/filetree/DragTree.java	2010-03-02 05:20:41.000000000 -0500
@@ -688,7 +688,14 @@
   public static void showFilePane(String filename, JembossParams mysettings)
   {
     Hashtable contents = new Hashtable();
-    contents.put(filename,readByteFile(filename));
+    byte[] content = readByteFile(filename);
+    if(content==null)
+    {
+        JOptionPane.showMessageDialog(null, "file \""+filename+"\" was empty",
+                "error", JOptionPane.ERROR_MESSAGE);
+        return;
+    }
+    contents.put(filename, content);
     ShowResultSet srs = new ShowResultSet(contents,mysettings);
     srs.setTitle("Local File");
   }
diff -Nurd EMBOSS-6.2.0/jemboss/org/emboss/jemboss/gui/filetree/RemoteDragTree.java EMBOSS-6.2.0-patched/jemboss/org/emboss/jemboss/gui/filetree/RemoteDragTree.java
--- EMBOSS-6.2.0/jemboss/org/emboss/jemboss/gui/filetree/RemoteDragTree.java	2008-07-04 09:33:08.000000000 -0400
+++ EMBOSS-6.2.0-patched/jemboss/org/emboss/jemboss/gui/filetree/RemoteDragTree.java	2010-03-02 05:20:41.000000000 -0500
@@ -743,6 +743,12 @@
  
       Hashtable hfile = new Hashtable();
       Object contents = gReq.getHash().get("contents");
+      if(contents==null)
+      {
+          JOptionPane.showMessageDialog(null, "file was empty", "error",
+                                JOptionPane.ERROR_MESSAGE);
+          return;
+      }
       if(contents instanceof String)
         hfile.put(filename, ((String)contents).getBytes() );
       else
diff -Nurd EMBOSS-6.2.0/jemboss/org/emboss/jemboss/gui/form/BuildJembossForm.java EMBOSS-6.2.0-patched/jemboss/org/emboss/jemboss/gui/form/BuildJembossForm.java
--- EMBOSS-6.2.0/jemboss/org/emboss/jemboss/gui/form/BuildJembossForm.java	2010-01-14 12:51:49.000000000 -0500
+++ EMBOSS-6.2.0-patched/jemboss/org/emboss/jemboss/gui/form/BuildJembossForm.java	2010-03-02 05:20:41.000000000 -0500
@@ -469,7 +469,8 @@
         {
           if(batchStart)
           {
-            BatchSoapProcess bsp = new BatchSoapProcess(embossCommand,filesToMove,mysettings);
+            BatchSoapProcess bsp = new BatchSoapProcess(embossCommand,
+                    filesToMove, mysettings, commandA);
             bsp.setWithSoap(false);
             bsp.start();
             if (prfs.getBoolean(DISPLAY_JOB_SUBMITTED_MSG, true)){
@@ -511,9 +512,11 @@
           else
           {
               JembossServer js = new JembossServer(mysettings.getResultsHome());
-              js.setEmbossCommandA((String[])commandA.toArray(new String[commandA.size()]));
-              Vector result = js.run_prog(embossCommand, 
-                      mysettings.getCurrentMode(), filesToMove);
+              // standalone jemboss, no files to move
+              Vector filesToMovev = new Vector();
+              Vector result = js.run_prog_array(
+                      new Vector(commandA), 
+                      mysettings.getCurrentMode(), filesToMovev, "");
               Hashtable r = convert(result,false);
               try {
                   resultSetFrame = new ShowResultSet(r,filesToMove,mysettings);
@@ -528,8 +531,9 @@
       }
       else
       {
+        List commandA = new ArrayList();
         Hashtable filesToMove = new Hashtable();
-        String embossCommand = getCommand(filesToMove);
+        String embossCommand = getCommand(filesToMove, commandA);
 
         if(!embossCommand.equals("NOT OK"))
         {
@@ -541,23 +545,37 @@
           {
             if(batchStart)
             {
-              BatchSoapProcess bsp = new BatchSoapProcess(embossCommand,filesToMove,mysettings);
+              BatchSoapProcess bsp = new BatchSoapProcess(embossCommand,
+                      filesToMove, mysettings, commandA);
               bsp.start();
             }
             else
             {
-              JembossRun thisrun = new JembossRun(embossCommand,"",
-                                           filesToMove,mysettings);
-              resultSetFrame = new ShowResultSet(thisrun.hash(),filesToMove,mysettings);
+              JembossRun thisrun;
+              if(mysettings.getUseAuth())
+                thisrun = new JembossRun(embossCommand, "",filesToMove,
+                        mysettings);
+              else
+                thisrun = new JembossRun(commandA, "",filesToMove,mysettings);
+
+              resultSetFrame = new ShowResultSet(thisrun.hash(),filesToMove,
+                      mysettings);
             }
           }
           catch (JembossSoapException eae)
           {
+              if (mysettings.getUseAuth() == true)
+              {
             AuthPopup ap = new AuthPopup(mysettings,f);
             ap.setBottomPanel();
             ap.setSize(380,170);
             ap.pack();
             ap.setVisible(true);
+              }
+              else
+                  JOptionPane.showMessageDialog(f,eae.getMessage(),
+                          "Problem in executing server job",
+                          JOptionPane.ERROR_MESSAGE);
           }
         }
       }
@@ -594,7 +612,7 @@
       if(s.equals("msg"))
       {
         String msg = (String)vans.get(j+1);
-        if(msg.startsWith("Error"))
+        if(msg.indexOf("Error")!=-1 || msg.indexOf("error")!=-1)
           JOptionPane.showMessageDialog(null, msg, "alert",
                                 JOptionPane.ERROR_MESSAGE);
       }
@@ -839,7 +857,7 @@
         if(!(textf[h].getText()).equals("") && textf[h].isVisible()
                                             && textf[h].isEnabled()) 
         {
-          options = options.concat(" -" + val + " " + textf[h].getText());
+          options = options.concat(" -" + val + " \"" + textf[h].getText())+"\"";
           optionsA.add("-" + val);
           optionsA.add(textf[h].getText());
 
@@ -868,7 +886,8 @@
         
         if(textFields[0].getText() != null && !textFields[0].getText().trim().equals(""))
         {
-          options = options.concat(" -" + val + " " + textFields[0].getText());
+          options = options.concat(" -" + val + " \"" +
+                  textFields[0].getText()+ "\"");
           optionsA.add("-" + val);
           optionsA.add(textFields[0].getText());
         }
@@ -1262,16 +1281,15 @@
 
 /**
 *
-* Get the command line for the Standalone version.
-* @param Hashtable of the files to be transferrred
+* Get the command line for the standalone as well as the client jemboss
+* @param Hashtable of the files to be transferred
 * @return String command line to use
 *
 */
   private String getCommand(Hashtable filesToMove, List commandA)
   {
-	  String embossBin = mysettings.getEmbossBin();
 	  String command = applName;
-	  commandA.add(embossBin +(embossBin.endsWith(File.separator)?"":File.separator)+command);
+	  commandA.add(command);
 	  int numofFields = parseAcd.getNumofFields();
 
 	  String options = checkParameters(parseAcd, numofFields, filesToMove, commandA);
@@ -1279,7 +1297,12 @@
 	  if(options.equals("NOT OK"))
 		  command = "NOT OK";
 	  else {
-		  command = command.concat(options + " -auto");
+	      for (int i=0; i<commandA.size();i++){
+	          String s = (String)commandA.get(i);
+	          if(s.equals("stdout"))
+	          commandA.set(i, "stdoutfile");
+	      }
+		  command = command.concat(options.replaceAll("\"stdout\"", "stdoutfile") + " -auto");
 		  commandA.add("-auto");
 	  }
 
@@ -1287,29 +1310,6 @@
   }
 
 
-/**
-*
-* Get the command line for the SOAP version.
-* @param Hashtable of the files to be transferrred
-* @return String command line to use
-*
-*/
-  private String getCommand(Hashtable filesToMove)
-  {
-	  String command = applName;
-	  int numofFields = parseAcd.getNumofFields();
-
-	  String options = checkParameters(parseAcd, numofFields, filesToMove, new ArrayList());
-
-	  if(options.equals("NOT OK"))
-		  command = "NOT OK";
-	  else {
-		  command = command.concat(options + " -auto");
-	  }
-
-	  return command;
-  }
-
 
 /**
 *
@@ -1326,16 +1326,18 @@
   public class BatchSoapProcess extends Thread
   {
     private String embossCommand;
+    List command;
     private Hashtable filesToMove;
     private JembossParams mysettings;
     private boolean withSoap = true;
 
     public BatchSoapProcess(String embossCommand, Hashtable filesToMove,
-                            JembossParams mysettings)
+                            JembossParams mysettings, List command)
     {
       this.embossCommand = embossCommand;
       this.filesToMove   = filesToMove;
       this.mysettings    = mysettings;
+      this.command = command;
     }
 
     public void setWithSoap(boolean withSoap)
@@ -1364,15 +1366,23 @@
         final JembossProcess er;
         if(withSoap)
         {
-          JembossRun thisrun = new JembossRun(embossCommand,"",
-                                       filesToMove,mysettings);
+            JembossRun thisrun;
+            if (mysettings.getUseAuth() == true)
+                thisrun = new JembossRun(embossCommand,"",filesToMove,
+                        mysettings);
+            else
+                thisrun = new JembossRun(command,"",filesToMove,mysettings);
           er = new JembossProcess((String)thisrun.get("jobid"));
         }
         else
         {
           JembossServer js = new JembossServer(mysettings.getResultsHome());
-          Vector result = js.run_prog(embossCommand,mysettings.getCurrentMode(),
-                                        filesToMove);
+          // standalone jemboss, no files to move
+          Vector filesToMovev = new Vector();
+          Vector result = js.run_prog_array(
+                  new Vector(command),
+                  mysettings.getCurrentMode(),
+                                        filesToMovev, "");
           Hashtable resultHash = convert(result, false);
           er = new JembossProcess((String)resultHash.get("jobid"));
         }
diff -Nurd EMBOSS-6.2.0/jemboss/org/emboss/jemboss/programs/RunEmbossApplication2.java EMBOSS-6.2.0-patched/jemboss/org/emboss/jemboss/programs/RunEmbossApplication2.java
--- EMBOSS-6.2.0/jemboss/org/emboss/jemboss/programs/RunEmbossApplication2.java	2009-07-06 09:49:20.000000000 -0400
+++ EMBOSS-6.2.0-patched/jemboss/org/emboss/jemboss/programs/RunEmbossApplication2.java	2010-03-02 05:20:41.000000000 -0500
@@ -141,10 +141,11 @@
       while((nc = stderrRead.read(c,0,100)) != -1)
         stderr = stderr.append(new String(c,0,nc));
     }
-    catch (IOException io)
+    catch (Exception io)
     {
+        io.printStackTrace();
       System.err.println("RunEmbossApplication2: Error in "+
-                                "collecting standard out");
+                                "collecting standard error output");
     }
     finally
     {
diff -Nurd EMBOSS-6.2.0/jemboss/org/emboss/jemboss/server/JembossAuthServer.java EMBOSS-6.2.0-patched/jemboss/org/emboss/jemboss/server/JembossAuthServer.java
--- EMBOSS-6.2.0/jemboss/org/emboss/jemboss/server/JembossAuthServer.java	2010-01-06 06:55:24.000000000 -0500
+++ EMBOSS-6.2.0-patched/jemboss/org/emboss/jemboss/server/JembossAuthServer.java	2010-03-02 05:20:41.000000000 -0500
@@ -45,9 +45,9 @@
   /** Jemboss error log file */
   private final String errorLog = new String(tmproot+"/jemboss_error.log");
   /** file separator */
-  private final String fs = new String(System.getProperty("file.separator"));
+  private final String fs = File.separator;
   /** path separator */
-  private final String ps = new String(System.getProperty("path.separator"));
+  private final String ps = File.pathSeparator;
   /** line separator */
   private final String ls = System.getProperty("line.separator");
 
@@ -666,8 +666,12 @@
       catch(Exception exp){} 
  
 //include any stderr from EMBOSS
+      String stderr = aj.getErrStd();
       result.add("msg");
-      result.add(aj.getErrStd());
+      result.add(stderr);
+      if (stderr.length()>0)
+          createStderrFile(project, stderr);
+      
 
 //add a finished file
       try
@@ -712,6 +716,25 @@
     return result;
   }
 
+  
+  /**
+  *
+  * Creates a file named "stderrfile" in the project directory
+  *
+  */
+  
+  private void createStderrFile(String project, String stderr)
+  {
+    File finished = new File(project + fs + "stderrfile");
+
+    try
+    {
+      PrintWriter fout = new PrintWriter(new FileWriter(finished));
+      fout.println(stderr);
+      fout.close();
+    }
+    catch (IOException ioe) {}
+  }
 
   /**
   *
diff -Nurd EMBOSS-6.2.0/jemboss/org/emboss/jemboss/server/JembossServer.java EMBOSS-6.2.0-patched/jemboss/org/emboss/jemboss/server/JembossServer.java
--- EMBOSS-6.2.0/jemboss/org/emboss/jemboss/server/JembossServer.java	2010-01-06 10:11:44.000000000 -0500
+++ EMBOSS-6.2.0-patched/jemboss/org/emboss/jemboss/server/JembossServer.java	2010-03-02 05:20:41.000000000 -0500
@@ -73,7 +73,7 @@
   /** user name */
   private String username = System.getProperty("user.name") + fs;
   /** results directory */
-  private String tmproot  = jp.getResultsHome()+username;
+  private String tmproot  = jp.getResultsHome();
   /** results directory */
   private File tmprootDir = new File(tmproot);
 
@@ -320,98 +320,6 @@
         return vans;
   }
 
-  /**
-  * @deprecated
-  * Uses JNI to calculate sequence attributes using EMBOSS library call.
-  * @param fileContent  sequence filename or database entry
-  * @param seqtype      sequence type (seqset/sequence)
-  * @return     	sequence length, weight & type (protein/nucleotide)
-  *
-  */
-
-  /*
-  private Vector call_ajax_(String fileContent, String seqtype)
-  {
-    boolean afile = false;
-    String fn = null;
-    File tf = null;
-
-    Vector vans = new Vector();
-
-    // create temporary file
-    if( ((fileContent.indexOf(":") < 0) || 
-         (fileContent.indexOf("\n") > 0) ) &&
-       !((new File(fileContent)).exists()) ) 
-    {
-      afile = true;
-      try
-      {
-        tf = File.createTempFile("tmp",".jembosstmp", tmprootDir);
-        PrintWriter out = new PrintWriter(new FileWriter(tf));
-        out.println(fileContent);
-        out.close();
-    
-        fn = new String(tf.getCanonicalPath());
-      }
-      catch (IOException ioe) 
-      {
-        System.out.println("IOException : STATUS NOT OK");
-        vans.add("status");
-        vans.add("1");
-        return vans;
-      }
-    }
-    else
-    {
-      fn = fileContent;     //looks like db entry or local file name
-    }
-
-    boolean ok = false;
-    Ajax aj = null;
-
-    if( ((new File(fn)).exists()) ||    //call ajax if sequence file
-         (fn.indexOf(":") > 0) )        //or db
-    {
-      try
-      {
-        aj = new Ajax();
-        if(seqtype.startsWith("seqset"))
-          ok = aj.seqsetType(fn);
-        else
-          ok = aj.seqType(fn);
-      }
-      catch (Exception e)
-      {
-        System.out.println("AjaxException : STATUS NOT OK");
-        vans.add("status");
-        vans.add("1");
-        return vans;
-      }
-    }
-
-    if(ok)
-    {
-      vans.add("length");
-      vans.add(new Integer(Ajax.length));
-      vans.add("protein");
-      vans.add(new Boolean(Ajax.protein));
-      vans.add("weight");
-      vans.add(new Float(Ajax.weight));
-      vans.add("status");
-      vans.add("0");
-    }
-    else
-    {
-      vans.add("status");
-      vans.add("1");
-    }
-
-    if(afile)
-      tf.delete();
-
-    return vans;
-  }
-  */
 
 
   /**
@@ -474,28 +382,7 @@
   }
 
 
-  /**
-  *
-  * Run an EMBOSS application
-  * @param embossCommand	command line to run
-  * @param options		unused
-  * @param inFiles		input files and names
-  * @return 			output files from application run
-  *
-  */
-  public Vector run_prog(String embossCommand, String options, 
-                                             String[] inFiles)
-  {
-    Vector result = new Vector();
-
-    Hashtable inF = new Hashtable();
-    for(int i=0; i<inFiles.length;i+=2)
-      inF.put(inFiles[i],inFiles[i+1]);
-
-    result = run_prog(embossCommand,options,inF);
 
-    return result;
-  }
 
   /**
   *
@@ -503,7 +390,7 @@
   * @param embossCommand        command line to run
   * @param options              unused
   * @param inFiles              input files and names
-  * @param userName		username
+  * @param userName             user name
   * @return                     output files from application run
   *
   */
@@ -513,7 +400,55 @@
     Hashtable hashInFiles = getHashtable(inFiles);
     tmproot = tmproot.concat(userName+fs);
     return run_prog(embossCommand,options,hashInFiles);
-/*   return run_prog(embossCommand,options,hashInFiles,userName); */
+  }
+
+
+  
+  /**
+  *
+  * Run an EMBOSS application.
+  * Construction of the command line string here is for information only,
+  * jobs are actually executed using the string array representation
+  * of the command line.
+  * 
+  * @param embossCommand        command line represented as a String array
+  * @param options              "interactive" or "batch", i.e sync or async job
+  * @param inFiles              input files with names
+  * @param userName             user name
+  * @return                     output files from application run
+  *
+  */
+
+  public Vector run_prog_array(Vector cmdA, String options,
+          Vector inFiles, String userName)
+  {
+      Hashtable hashInFiles = getHashtable(inFiles);
+      String cmd ="";
+      int i = 0;
+      tmproot = tmproot.concat(userName+fs);
+      embossCommandA = new String[cmdA.size()+hashInFiles.size()];
+      
+      if(cmdA.size()==0)
+          throw new RuntimeException("empty command line array");
+      
+      embossCommandA[0] = embossBin + cmdA.get(0);
+      cmd = (String)cmdA.get(0);
+
+      for (i=1; i<cmdA.size(); i++)
+      {
+          String s = (String)cmdA.get(i);
+          cmd += " "+(s.indexOf(' ')==-1 ? s : "\""+s+"\"");
+          embossCommandA[i] = s;
+      }
+      Object[] filenames = hashInFiles.keySet().toArray();
+      for (i=0; i<filenames.length; i++)
+      {
+          String s = (String)filenames[i];
+          cmd += " "+s;
+          embossCommandA[cmdA.size()+i] = s;
+      }
+
+      return run_prog(cmd,options, hashInFiles);
   }
 
   /**
@@ -525,7 +460,7 @@
   * @return 			output files from application run
   *
   */
-  public Vector run_prog(String embossCommand, String options, 
+  private Vector run_prog(String embossCommand, String options, 
                                             Hashtable inFiles)
   {
 
@@ -538,20 +473,9 @@
        result.add("ERROR: Disallowed command syntax "+embossCommand);
        result.add("status");
        result.add("1");
-
        return result;
     }
 
-    //trap anything that is trying to write to stdout
-    int stdIndex = embossCommand.indexOf(" stdout ");
-    if(stdIndex > -1)
-    {
-      String startCmd = embossCommand.substring(0,stdIndex+7);
-      String endCmd = embossCommand.substring(stdIndex+8);
-      embossCommand = startCmd.concat("file ");
-      embossCommand = embossCommand.concat(endCmd);
-    }
-
     Enumeration enumFiles = inFiles.keys();
     String appl   = embossCommand.substring(0,embossCommand.indexOf(" "));
     String rest   = embossCommand.substring(embossCommand.indexOf(" "));
@@ -637,7 +561,7 @@
     result.add("0");
 
     if(options.toLowerCase().indexOf("interactive") > -1)
-    { 
+    {
     	String stdout = "";
         String stderr = "";
         try
@@ -659,8 +583,9 @@
         
         if(!stderr.equals(""))
         {
-          result.add("stderr");
-          result.add(stderr);  
+          result.add("msg");
+          result.add(stderr);
+          createStderrFile(project, stderr);
         }
         createFinishedFile(project);
     }
@@ -669,9 +594,6 @@
       JembossThread jt = new JembossThread(rea,project);
       jt.start();
 
-//    if(jt.isAlive())
-//      System.out.println("THREAD IS ALIVE!");
-
       result.add("job_submitted");
       result.add("Job " + projectDir.getName() + "submitted.");
       result.add("jobid");
@@ -681,8 +603,8 @@
     }
 
 //get the output files
-    result = loadFilesContent(projectDir,project,result,inFiles);
-    result = loadPNGContent(projectDir,project,result);
+    loadFilesContent(projectDir,project,result,inFiles);
+    loadPNGContent(projectDir,project,result);
 
     return result;
   }
@@ -707,6 +629,31 @@
   }
 
 
+
+
+  /**
+  *
+  * Creates a file named "stderrfile" in the project directory
+  *
+  */
+  
+  private void createStderrFile(String project, String stderr)
+  {
+    File finished = new File(project + fs + "stderrfile");
+
+    try
+    {
+      PrintWriter fout = new PrintWriter(new FileWriter(finished));
+      fout.println(stderr);
+      fout.close();
+    }
+    catch (IOException ioe) {}
+  }
+
+
+
+
+
   /**
   *
   * Returns the results for a saved project.
@@ -744,8 +691,8 @@
 
     if(cl.equals(""))
     {
-      ssr = loadFilesContent(projectDir,project,ssr,null);
-      ssr = loadPNGContent(projectDir,project,ssr);
+      loadFilesContent(projectDir,project,ssr,null);
+      loadPNGContent(projectDir,project,ssr);
     }
     else
     {
@@ -970,7 +917,7 @@
   * @return             result
   *
   */
-  private Vector loadFilesContent(File projectDir, String project, 
+  private void loadFilesContent(File projectDir, String project, 
                                   Vector result, Hashtable inFiles)
   {
 
@@ -981,6 +928,9 @@
         return (!name.startsWith(".") && !name.endsWith(".png"));
       };
     });
+    
+    if (outFiles == null)
+        return;
 
     for(int i=0;i<outFiles.length;i++)
     {
@@ -1028,8 +978,7 @@
         result.add(fc);
       }
     }
-    return result;
-
+    return;
   }
 
   /**
@@ -1041,7 +990,7 @@
   * @return             result
   *
   */
-  private Vector loadPNGContent(File projectDir, String project, Vector result)
+  private void loadPNGContent(File projectDir, String project, Vector result)
   {
 
     String pngFiles[] = projectDir.list(new FilenameFilter()
@@ -1065,7 +1014,7 @@
         result.add(data);
       }
     }
-    return result;
+    return;
   }
 
   /**
@@ -1106,7 +1055,7 @@
   * @param prog         program
   * @param opt          options
   * @param resToQuery   results to query
-  * @param userName     username
+  * @param userName     user name
   *
   */
   public Vector update_result_status(String prog, String opt,
@@ -1205,9 +1154,5 @@
     throw new java.lang.CloneNotSupportedException();
   }
 
-public void setEmbossCommandA(String[] embossCommandA) {
-	this.embossCommandA = embossCommandA;
-}
-
 }
 
diff -Nurd EMBOSS-6.2.0/jemboss/org/emboss/jemboss/server/JembossThread.java EMBOSS-6.2.0-patched/jemboss/org/emboss/jemboss/server/JembossThread.java
--- EMBOSS-6.2.0/jemboss/org/emboss/jemboss/server/JembossThread.java	2004-02-29 15:47:22.000000000 -0500
+++ EMBOSS-6.2.0-patched/jemboss/org/emboss/jemboss/server/JembossThread.java	2010-03-02 05:20:41.000000000 -0500
@@ -55,8 +55,38 @@
   { 
     rea.waitFor();
     createFinishedFile();
+    String stderr;
+    try {
+        stderr = rea.getProcessStderr();
+
+        if (stderr.length()>0)
+            createStderrFile(stderr);
+
+    } catch (Exception e) {
+        System.err.println("Problem while capturing stderr output: " +
+        		e.getMessage());
+    }
+
   }
- 
+
+  /**
+  *
+  * Creates a file named "stderrfile" in the project directory
+  *
+  */
+  private void createStderrFile(String stderr)
+  {
+    File stderrfile = new File(project + File.separator + "stderrfile");
+
+    try
+    {
+      PrintWriter fout = new PrintWriter(new FileWriter(stderrfile));
+      fout.println(stderr);
+      fout.close();
+    }
+    catch (IOException ioe) {}
+  }
+  
   /**
   *
   * Creates a file named "finished" in the project directory,
@@ -65,8 +95,7 @@
   */
   private void createFinishedFile()
   {
-    String fs = new String(System.getProperty("file.separator"));
-    File finished = new File(project + fs + ".finished");
+    File finished = new File(project + File.separator + ".finished");
 
     try
     {
diff -Nurd EMBOSS-6.2.0/jemboss/org/emboss/jemboss/soap/AuthPopup.java EMBOSS-6.2.0-patched/jemboss/org/emboss/jemboss/soap/AuthPopup.java
--- EMBOSS-6.2.0/jemboss/org/emboss/jemboss/soap/AuthPopup.java	2010-01-11 08:43:55.000000000 -0500
+++ EMBOSS-6.2.0-patched/jemboss/org/emboss/jemboss/soap/AuthPopup.java	2010-03-02 05:20:41.000000000 -0500
@@ -176,7 +176,7 @@
 
   /**
   *
-  * Buttons across the bottom
+  * Buttons across the bottom. Used for the File Manager login only.
   *
   */
   public void addBottomPanel() 
@@ -300,7 +300,6 @@
           remove(promptPanel);
           pack();
         }
-        else
           dispose();
       }
     });
@@ -328,7 +327,6 @@
           remove(promptPanel);
           pack();
         }
-        else
           dispose();
       }
     });
@@ -336,10 +334,6 @@
   }
 
 
-//public JButton getOKButton()
-//{
-//  return okButton;
-//}
 
 
   /**
diff -Nurd EMBOSS-6.2.0/jemboss/org/emboss/jemboss/soap/JembossRun.java EMBOSS-6.2.0-patched/jemboss/org/emboss/jemboss/soap/JembossRun.java
--- EMBOSS-6.2.0/jemboss/org/emboss/jemboss/soap/JembossRun.java	2009-07-01 05:20:30.000000000 -0400
+++ EMBOSS-6.2.0-patched/jemboss/org/emboss/jemboss/soap/JembossRun.java	2010-03-02 05:20:41.000000000 -0500
@@ -44,42 +44,76 @@
   private Hashtable proganswer;
 
   /**
+  * Makes a web service call to run an EMBOSS job.
+  * This constructor is used when user.auth is true.
   *
-  * @param appl       	defining command
+  * @param cmdl       	command line
   * @param options    	defining options
   * @param filesToMove  Hashtable of filenames and contents
   * @param mysettings 	jemboss properties
   * @throws JembossSoapException if authentication fails
   *
   */
-  public JembossRun(String appl, String options, Hashtable filesToMove, 
+  public JembossRun(String cmdl, String options, Hashtable filesToMove, 
                     JembossParams mysettings) throws JembossSoapException 
   {
 
     String fulloptions;
 
     Vector params = new Vector();
-    params.addElement(appl);
+    params.addElement(cmdl);
 
      //construct a full options string
     fulloptions = "mode="+mysettings.getCurrentMode()+" "+options;
-//   if (mysettings.getUseX11()) 
-//     fulloptions = "display="+mysettings.getX11display()+" "+fulloptions;
     params.addElement(fulloptions);
 
     // just pass the hash
     params.addElement(filesToMove);
 
     PrivateRequest eRun;
-    try 
-    {
-      eRun = new PrivateRequest(mysettings,
-			       "run_prog", params);
-    }
-    catch (JembossSoapException e)
-    {
-      throw new JembossSoapException("Authentication Failed");
-    }
+
+    eRun = new PrivateRequest(mysettings,"run_prog", params);
+
+    proganswer = eRun.getHash();
+    status = proganswer.get("status").toString();
+    statusmsg = proganswer.get("msg").toString();
+    
+    proganswer.remove("status");  // delete the status/msg
+    proganswer.remove("msg");
+  }
+
+  
+  /**
+  * Makes a web service call to run an EMBOSS job.
+  * This constructor is used when user.auth is false.
+  * 
+  * @param cmdl         command line
+  * @param options      defining options
+  * @param filesToMove  Hashtable of filenames and contents
+  * @param mysettings   jemboss properties
+  * @throws JembossSoapException if authentication fails
+  *
+  */
+  public JembossRun(List cmdl, String options, Hashtable filesToMove, 
+                    JembossParams mysettings) throws JembossSoapException 
+  {
+
+    String fulloptions;
+
+    Vector params = new Vector();
+    params.addElement(new Vector(cmdl));
+
+     //construct a full options string
+    fulloptions = "mode="+mysettings.getCurrentMode()+" "+options;
+    params.addElement(fulloptions);
+
+    // just pass the hash
+    params.addElement(filesToMove);
+
+    PrivateRequest eRun;
+
+    eRun = new PrivateRequest(mysettings,
+                   "run_prog_array", params);
 
     proganswer = eRun.getHash();
     status = proganswer.get("status").toString();
diff -Nurd EMBOSS-6.2.0/jemboss/org/emboss/jemboss/soap/PrivateRequest.java EMBOSS-6.2.0-patched/jemboss/org/emboss/jemboss/soap/PrivateRequest.java
--- EMBOSS-6.2.0/jemboss/org/emboss/jemboss/soap/PrivateRequest.java	2008-05-21 07:14:41.000000000 -0400
+++ EMBOSS-6.2.0-patched/jemboss/org/emboss/jemboss/soap/PrivateRequest.java	2010-03-02 05:20:41.000000000 -0500
@@ -85,7 +85,6 @@
        org.apache.axis.client.Service serv =
                                new org.apache.axis.client.Service();
        Call    call     = (Call) serv.createCall();
-       //QName   qn       = new QName(service, method);
        call.setTargetEndpointAddress( new java.net.URL(endpoint) );
        call.setOperationName(new QName(service, method));
        call.setEncodingStyle(org.apache.axis.Constants.URI_SOAP12_ENC);
@@ -110,6 +109,13 @@
              call.addParameter("Args"+i, XMLType.XSD_STRING,
                              javax.xml.rpc.ParameterMode.IN);
            }
+           else if(obj.getClass().equals(Vector.class))
+           {
+             params[i] = obj;
+
+             call.addParameter("Args"+i, XMLType.SOAP_VECTOR,
+                             javax.xml.rpc.ParameterMode.IN);
+           }
            else if(obj.getClass().equals(Hashtable.class))
            {
              params[i] = getVector((Hashtable)obj);
@@ -171,7 +177,7 @@
            String msg = (String)vans.get(j+1);
            if(msg.startsWith("Failed Authorisation"))
              throw new JembossSoapException("Authentication Failed");
-           else if(msg.startsWith("Error"))
+           else if(msg.indexOf("Error")!=-1 || msg.indexOf("error")!=-1)
              JOptionPane.showMessageDialog(null, msg, "alert",
                                    JOptionPane.ERROR_MESSAGE);
          }
@@ -180,9 +186,9 @@
      } 
      catch (Exception e) 
      {
-        System.out.println("Exception in PrivateRequest "+
+        System.err.println("Exception in PrivateRequest "+
                             e.getMessage ());
-        throw new JembossSoapException("  Fault Code   = " );
+        throw new JembossSoapException(e.getMessage());
      }
 
    }
diff -Nurd EMBOSS-6.2.0/jemboss/utils/install-jemboss-server.sh EMBOSS-6.2.0-patched/jemboss/utils/install-jemboss-server.sh
--- EMBOSS-6.2.0/jemboss/utils/install-jemboss-server.sh	2010-01-11 07:24:48.000000000 -0500
+++ EMBOSS-6.2.0-patched/jemboss/utils/install-jemboss-server.sh	2010-03-02 05:20:41.000000000 -0500
@@ -173,7 +173,7 @@
           ./configure --with-thread=$PLATFORM \
               --prefix=$EMBOSS_INSTALL $USER_CONFIG
           make
-          make install
+          make -j install
         else
           echo
           echo "Did not install $dir cannot find"
@@ -1079,6 +1079,11 @@
   read DATADIR
   echo "$DATADIR" >> $RECORD
 
+  if (test "$DATADIR" = ""); then
+    DATADIR="/tmp/SOAP/emboss"
+  fi
+
+
   echo
 
 #
@@ -1210,7 +1215,7 @@
 echo
 sleep 2
 
-make install
+make -j install
 
 #
 #
@@ -1236,13 +1241,6 @@
 
 
 
-#
-# create wossname.jar
-#
-PATH=$EMBOSS_INSTALL/bin:$PATH
-export PATH
-$EMBOSS_INSTALL/bin/wossname -colon -gui -outf wossname.out -auto
-$JAVA_HOME/bin/jar cvf $JEMBOSS/resources/wossname.jar wossname.out
 
 #
 # create resources.jar archive of the scoring matrix
diff -Nurd EMBOSS-6.2.0/nucleus/Makefile.in EMBOSS-6.2.0-patched/nucleus/Makefile.in
--- EMBOSS-6.2.0/nucleus/Makefile.in	2010-01-15 05:54:43.000000000 -0500
+++ EMBOSS-6.2.0-patched/nucleus/Makefile.in	2010-03-08 08:54:38.000000000 -0500
@@ -72,7 +72,7 @@
   sed '$$!N;$$!N;$$!N;$$!N;s/\n/ /g'
 am__installdirs = "$(DESTDIR)$(libdir)" "$(DESTDIR)$(includedir)"
 LTLIBRARIES = $(lib_LTLIBRARIES)
-libnucleus_la_LIBADD =
+libnucleus_la_LIBADD = ../ajax/core/libajax.la ../ajax/graphics/libajaxg.la ../ajax/ajaxdb/libajaxdb.la ../ajax/acd/libacd.la
 am__objects_1 = embaln.lo embcom.lo embcons.lo embdata.lo embdbi.lo \
 	embdmx.lo embdomain.lo embest.lo embexit.lo embgroup.lo \
 	embiep.lo embindex.lo embinit.lo embmat.lo embmisc.lo \
diff -Nurd EMBOSS-6.2.0/nucleus/embpat.c EMBOSS-6.2.0-patched/nucleus/embpat.c
--- EMBOSS-6.2.0/nucleus/embpat.c	2009-10-02 07:27:00.000000000 -0400
+++ EMBOSS-6.2.0-patched/nucleus/embpat.c	2010-03-02 05:20:41.000000000 -0500
@@ -800,8 +800,8 @@
 
 AjBool embPatRestrictReadEntry(EmbPPatRestrict re, AjPFile inf)
 {
-    AjPStr line;
-    AjBool ret;
+    AjPStr line = NULL;
+    AjBool ret = AJFALSE;
     const char *p = NULL;
     char *q = NULL;
     ajuint i;
@@ -825,25 +825,58 @@
 
 
     p = ajSysFuncStrtok(p,"\t \n");
+    if(!p)
+      return ajFalse;
     ajStrAssignC(&re->cod,p);
+
     p = ajSysFuncStrtok(NULL,"\t \n");
+    if(!p)
+      return ajFalse;
     ajStrAssignC(&re->pat,p);
     ajStrAssignC(&re->bin,p);
 
     p = ajSysFuncStrtok(NULL,"\t \n");
-    sscanf(p,"%d",&re->len);
+    if(!p)
+      return ajFalse;
+    if(!sscanf(p,"%d",&re->len))
+      return ajFalse;
+
     p = ajSysFuncStrtok(NULL,"\t \n");
-    sscanf(p,"%d",&re->ncuts);
+    if(!p)
+      return ajFalse;
+    if(!sscanf(p,"%d",&re->ncuts))
+      return ajFalse;
+
     p = ajSysFuncStrtok(NULL,"\t \n");
-    sscanf(p,"%d",&re->blunt);
+    if(!p)
+      return ajFalse;
+    if(!sscanf(p,"%d",&re->blunt))
+      return ajFalse;
+
     p = ajSysFuncStrtok(NULL,"\t \n");
-    sscanf(p,"%d",&re->cut1);
+    if(!p)
+      return ajFalse;
+    if(!sscanf(p,"%d",&re->cut1))
+      return ajFalse;
+
     p = ajSysFuncStrtok(NULL,"\t \n");
-    sscanf(p,"%d",&re->cut2);
+    if(!p)
+      return ajFalse;
+    if(!sscanf(p,"%d",&re->cut2))
+      return ajFalse;
+
     p = ajSysFuncStrtok(NULL,"\t \n");
-    sscanf(p,"%d",&re->cut3);
+    if(!p)
+      return ajFalse;
+    if(!sscanf(p,"%d",&re->cut3))
+      return ajFalse;
+
     p = ajSysFuncStrtok(NULL,"\t \n");
-    sscanf(p,"%d",&re->cut4);
+    if(!p)
+      return ajFalse;
+    if(!sscanf(p,"%d",&re->cut4))
+      return ajFalse;
+
 
     for(i=0,q=ajStrGetuniquePtr(&re->bin);i<re->len;++i)
 	*(q+i)=(char)ajBaseAlphaToBin((int)*(q+i));
@@ -2936,8 +2969,17 @@
     {
 	ready[i] = m;
 
+        /*
+        ** AJB: Note that if the mismatches are 1 less than the real
+        ** pattern length then the skip value can become 0 - hence
+        ** the use of AJMAX to ensure that the skip value is always
+        ** positive. This prevents a potential infinite loop in the
+        ** upcoming TUBSearch function. Need to check the original
+        ** algorithm to check that nothing is amiss here, then
+        ** delete this comment block.
+        */
 	for(j=m-k-1;j<(ajint)m;++j)
-	    skipm[j][i] = m-k-1;
+	    skipm[j][i] = AJMAX(m-k-1,1);
     }
 
     p += plen-1;
@@ -4272,8 +4314,11 @@
 
     hits = 0;
 
-    while(embPatRestrictReadEntry(enz,enzfile))
+    while(!ajFileIsEof(enzfile))
     {
+        if(!embPatRestrictReadEntry(enz,enzfile))
+	    continue;
+
 	if(!enz->ncuts)
 	    continue;
 
@@ -4737,6 +4782,10 @@
 
 	break;
     case 6:
+        if(thys->m && mismatch >= thys->m)
+            ajFatal("embPatCompileII: Mismatches (%d) must be less than the "
+                    "real pattern length (%d)",mismatch,thys->m);
+
 	if (!thys->skipm)
 	{
 	    AJCNEW(thys->skipm,thys->m);
diff -Nurd EMBOSS-6.2.0/plplot/Makefile.in EMBOSS-6.2.0-patched/plplot/Makefile.in
--- EMBOSS-6.2.0/plplot/Makefile.in	2010-01-15 05:54:43.000000000 -0500
+++ EMBOSS-6.2.0-patched/plplot/Makefile.in	2010-03-08 08:55:10.000000000 -0500
@@ -71,7 +71,7 @@
   sed '$$!N;$$!N;$$!N;$$!N;s/\n/ /g'
 am__installdirs = "$(DESTDIR)$(libdir)" "$(DESTDIR)$(pkgincludedir)"
 LTLIBRARIES = $(lib_LTLIBRARIES)
-libeplplot_la_LIBADD =
+libeplplot_la_LIBADD = $(XLIB) -lgd
 am__objects_1 = pdfutils.lo plargs.lo plbox.lo plcont.lo plcore.lo \
 	plctrl.lo plcvt.lo pldtik.lo plfill.lo plhist.lo plline.lo \
 	plmap.lo plot3d.lo plpage.lo plsdef.lo plshade.lo plsym.lo \

--- EMBOSS-6.2.0/emboss/tfm.c	2008-07-15 10:44:56.000000000 -0400
+++ EMBOSS-6.2.0-pathced/emboss/tfm.c	2010-04-14 06:23:15.000000000 -0400
@@ -165,7 +165,7 @@
     /* try to open the installed doc directory */
     if(ajStrGetLen(roottmp))
 	ajStrAssignS(docroot, roottmp);
-    else
+   else
     {
         ajStrAssignS(&docrootinst, ajNamValueInstalldir());
 	ajDirnameFix(&docrootinst);
@@ -198,9 +198,8 @@
 		  ajFmtPrintS(docroot,"%Sprograms%shtml%s",
 			      docrootinst,SLASH_STRING,SLASH_STRING);
 	      else
-		  ajFmtPrintS(docroot,"%Shtml%semboss%sapps%s",
-			      docrootinst,SLASH_STRING,SLASH_STRING,
-			      SLASH_STRING);
+		  ajFmtPrintS(docroot,"%Sprograms%shtml%s",
+			      docrootinst,SLASH_STRING,SLASH_STRING);
           }
 	}
 	else
@@ -349,4 +348,4 @@
     ajStrDel(&pre);
     
     return;
-}
+}


