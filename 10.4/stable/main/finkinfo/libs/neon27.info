Package: neon27
Version: 0.28.4
Revision: 3
Description: HTTP/WebDAV client library with a C API
License: LGPL
Maintainer: Daniel Johnson <daniel@daniel-johnson.org>

# Dependencies:
Depends: %N-shlibs (= %v-%r), pkgconfig (>= 0.20-1)
BuildDepends: libxml2 (>= 2.6.30-1), system-openssl-dev, libiconv-dev (>= 1.12-3), libgettext3-dev
Conflicts: neon-ssl, neon, neon19, neon19-ssl, neon21, neon21-ssl, neon22, neon22-ssl, neon23, neon23-ssl, neon24, neon24-ssl, neon25, neon26, neon27
Replaces: neon-ssl, neon, neon19, neon19-ssl, neon21, neon21-ssl, neon22, neon22-ssl, neon23, neon23-ssl, neon24, neon24-ssl, neon25, neon26, neon27
BuildDependsOnly: True

# Unpack Phase:
Source: http://www.webdav.org/neon/neon-%v.tar.gz
Source-MD5: 6c3b94362af743d046e198e9fcbe4a85

# Patch Phase:
PatchScript: <<
  perl -pi -e 's/neon.mo/%n.mo/' Makefile.in
  perl -pi -e 's/(bindtextdomain\()"neon"/\1"%n"/' src/ne_i18n.c
  perl -pi -e 's/\@NEON_LIBS\@|\@user_LDFLAGS\@//g' neon-config.in
  perl -pi -e 's/\$LDFLAGS -flat_namespace/$LDFLAGS/' configure
<<

# Compile Phase:
ConfigureParams: --with-libxml2 --with-ssl=openssl --with-libs=%p/lib/system-openssl --without-egd --without-socks --enable-shared --disable-static --with-ca-bundle=%p/etc/ssl/certs/ca-bundle.crt --without-pakchois

SetCFLAGS: -Os

CompileScript: <<
	#!/bin/bash -ev
	# This bit enables stripping unused libs on 10.5 and later.
	let version=`uname -r | cut -f 1 -d .`
	if [ $version -ge 9 ]; then
		export LDFLAGS="$LDFLAGS -Wl,-dead_strip_dylibs"
	fi
	
	export PKG_CONFIG_PATH="%p/lib/system-openssl/lib/pkgconfig:$PKG_CONFIG_PATH"
	./configure %c
	make LIBS='-lz -L%p/lib/system-openssl/lib -L%p/lib -lintl -lssl -lcrypto -lgssapi_krb5 -lkrb5 -lk5crypto -lcom_err -lresolv -lxml2 -liconv'
<<

# Tests have a few failures, mostly reverse address lookups and prebinding.
# It seems to be caused by network configuration issues.
InfoTest: TestScript: make check || exit 1

# Install Phase:
InstallScript: <<
	make install DESTDIR=%d docdir='$(datadir)/doc/%n'
	#No need for dependency_libs in .la files if not building static libs
	perl -pi -e "s/dependency_libs=.*$/dependency_libs=''/" %i/lib/*.la
<<
DocFiles: AUTHORS BUGS ChangeLog NEWS README THANKS TODO src/COPYING.LIB

SplitOff: <<
  Package: %N-shlibs
  Depends: libxml2-shlibs (>= 2.6.30-1), libiconv (>= 1.12-3), libgettext3-shlibs, ca-bundle
  Files: lib/libneon.27.dylib share/locale
  Shlibs: %p/lib/libneon.27.dylib 29.0.0 %n (>= 0.28.4-1)
  DocFiles: src/COPYING.LIB README
<<

# Additionale Information:
DescDetail: <<
Current features:

 - High-level interface to HTTP and WebDAV methods (PUT, GET, HEAD etc)
 - Low-level interface to HTTP request handling, to allow implementing
   new methods easily.
 - persistent connections
 - RFC2617 basic and digest authentication (including auth-int, md5-sess)
 - Proxy support (including basic/digest authentication)
 - SSL/TLS support using OpenSSL (including client certificate support)
 - Generic WebDAV 207 XML response handling mechanism
 - XML parsing using the expat or libxml parsers
 - Easy generation of error messages from 207 error responses
 - WebDAV resource manipulation: MOVE, COPY, DELETE, MKCOL.
 - WebDAV metadata support: set and remove properties, query any set of
   properties (PROPPATCH/PROPFIND).
 - autoconf macros supplied for easily embedding neon directly inside an
   application source tree.

neon is licensed under the GNU LGPL; see COPYING.LIB for full details.

Please note that the neon API is not yet stable, and is subject to 
major changes
<<
Homepage: http://www.webdav.org/neon/
