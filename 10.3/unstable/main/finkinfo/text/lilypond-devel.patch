diff -ruN lilypond-2.5.13-orig/Documentation/user/GNUmakefile lilypond-2.5.13/Documentation/user/GNUmakefile
--- lilypond-2.5.13-orig/Documentation/user/GNUmakefile	Mon Feb 28 08:49:44 2005
+++ lilypond-2.5.13/Documentation/user/GNUmakefile	Mon Feb 28 08:50:01 2005
@@ -261,7 +261,7 @@
 local-clean: local-delete
 
 local-delete:
-	-for i in $$(seq 0 9); do \
+	-for i in $$(jot 9 0 9); do \
 		for j in dvi eps eps.bbox eps.trans log png tex; do \
 			rm -f $(outdir)/lily-$$i*$$j; \
 		done; \
diff -ruN lilypond-2.5.13-orig/Documentation/user/lilypond.tely lilypond-2.5.13/Documentation/user/lilypond.tely
--- lilypond-2.5.13-orig/Documentation/user/lilypond.tely	Mon Feb 28 08:49:44 2005
+++ lilypond-2.5.13/Documentation/user/lilypond.tely	Mon Feb 28 08:50:01 2005
@@ -27,15 +27,14 @@
 @c    LilyPond  program.
   
 @end ignore
-
-* LilyPond: (lilypond/lilypond).           The GNU music typesetter.
-* abc2ly: (lilypond/lilypond)Invoking abc2ly.          Importing ABC.          
-* convert-ly: (lilypond/lilypond)Invoking convert-ly.  Older LilyPond versions.
-* etf2ly: (lilypond/lilypond)Invoking etf2ly.          Importing Finale.
-* lilypond-book: (lilypond/lilypond)LilyPond-book.     Itegrating text and music.
-* midi2ly: (lilypond/lilypond)Invoking midi2ly.        Importing MIDI.
-* mup2ly: (lilypond/lilypond)Invoking mup2ly.          Importing Mup. 
-* musedata2ly: (lilypond/lilypond)Invoking musedata2ly.        Importing MuseData.
+* LilyPond: (lilypond).           The GNU music typesetter.
+* abc2ly: (lilypond)Invoking abc2ly.          Importing ABC.          
+* convert-ly: (lilypond)Invoking convert-ly.  Older LilyPond versions.
+* etf2ly: (lilypond)Invoking etf2ly.          Importing Finale.
+* lilypond-book: (lilypond)LilyPond-book.     Itegrating text and music.
+* midi2ly: (lilypond)Invoking midi2ly.        Importing MIDI.
+* mup2ly: (lilypond)Invoking mup2ly.          Importing Mup. 
+* musedata2ly: (lilypond)Invoking musedata2ly.        Importing MuseData.
 @end direntry
 
 
diff -ruN lilypond-2.5.13-orig/Documentation/user/music-glossary.tely lilypond-2.5.13/Documentation/user/music-glossary.tely
--- lilypond-2.5.13-orig/Documentation/user/music-glossary.tely	Mon Feb 28 08:49:44 2005
+++ lilypond-2.5.13/Documentation/user/music-glossary.tely	Mon Feb 28 08:50:01 2005
@@ -13,6 +13,11 @@
 PostScript} and @uref{music-glossary.pdf,PDF}.
 @end ifhtml
 
+@dircategory GNU music project
+@direntry
+* Glossary: (music-glossary).                  Glossary of music terms.
+@end direntry
+
 @titlepage
 @title Music Glossary
 @author Christian Mondrup   @c Original author of LilyPond glossary
diff -ruN lilypond-2.5.13-orig/buildscripts/clean-fonts.sh lilypond-2.5.13/buildscripts/clean-fonts.sh
--- lilypond-2.5.13-orig/buildscripts/clean-fonts.sh	Mon Feb 28 08:49:43 2005
+++ lilypond-2.5.13/buildscripts/clean-fonts.sh	Mon Feb 28 08:50:01 2005
@@ -20,6 +20,7 @@
 /var/texfonts
 /var/cache/fonts
 /usr/share/texmf/fonts
+@prefix@/var/lib/texmf
 "
 
 for i in $dirs; do
diff -ruN lilypond-2.5.13-orig/buildscripts/lilypond-profile.sh lilypond-2.5.13/buildscripts/lilypond-profile.sh
--- lilypond-2.5.13-orig/buildscripts/lilypond-profile.sh	Mon Feb 28 08:49:43 2005
+++ lilypond-2.5.13/buildscripts/lilypond-profile.sh	Mon Feb 28 08:50:01 2005
@@ -2,67 +2,6 @@
 
 # Setup TeX/LaTeX Ghostscript environment for LilyPond.
 
-# Red Hat-like systems should install this in /etc/profile.d/
-
-# If run by hand or from you .profile, run as follows
-#   . /PATH/TO/lilypond-profile
-
-
-
-
-
-# In ZSH, $0 is set to the script name, regardless of whether sourced
-# or run in a subshell.
-if [ -n "$ZSH_NAME" ] ; then
-    echo "Make sure that this script is sourced, ie. run as "
-    echo 
-    echo "   . lilypond-profile"
-    echo ""
-    echo "Continuing anyway ..."
-    return 2
-fi
-
-if [ -z "$ZSH_NAME" -a `basename "$0"` = "lilypond-profile" ] ; then 
-    cat >/dev/stderr <<EOF
-    
-Error: This script cannot be run in a subshell; it MUST be sourced.
-
-
-EXAMPLE 1: One time use 
-
-	* Do
-
-	    . $0
-
-
-
-EXAMPLE 2: Install for self
-
-	* Do
-
-	    cp lilypond-profile $HOME/bin/
-
-	* Add
-
-	    .  $HOME/bin/lilypond-profile
-
-	to either $HOME/.profile or $HOME/.bash_profile, 
-
-	* Logout.
-
-
-EXAMPLE 3: Install for all users.
-
-	* Do
-
-	     mv lilypond-profile /etc/profile.d/lilypond.sh
-
-	* Logout
-
-EOF
-
-    return 2
-else
 	if [ -z "$LILYPONDPREFIX" ]; then
 	    datadir=`echo "@local_lilypond_datadir@" | sed 's!//!/!g'`
 	else
@@ -78,7 +17,4 @@
 		TEXMF="{$datadir,"`kpsexpand  \\$TEXMF`"}"
 		export TEXMF
 	fi
-fi
- 	
-
 
diff -ruN lilypond-2.5.13-orig/config.make.in lilypond-2.5.13/config.make.in
--- lilypond-2.5.13-orig/config.make.in	Mon Feb 28 08:49:45 2005
+++ lilypond-2.5.13/config.make.in	Mon Feb 28 08:50:01 2005
@@ -41,7 +41,7 @@
 
 # move out of config.make.in?
 package_datadir = $(datadir)/$(package)
-package_infodir = $(infodir)/$(package)
+package_infodir = $(infodir)
 package_libdir = $(libdir)/$(package)
 package_docdir = $(docdir)/$(package)
 package_omfdir = $(omfdir)/$(package)
diff -ruN lilypond-2.5.13-orig/configure.in lilypond-2.5.13/configure.in
--- lilypond-2.5.13-orig/configure.in	Mon Feb 28 08:49:45 2005
+++ lilypond-2.5.13/configure.in	Mon Feb 28 08:50:01 2005
@@ -95,8 +95,8 @@
     STEPMAKE_GTK2
 fi
 
-STEPMAKE_FREETYPE2
 STEPMAKE_PANGO_FT2
+STEPMAKE_FREETYPE2
 
 ## Optional tools for building documentation, website, extra fonts.
 
diff -ruN lilypond-2.5.13-orig/configure.in.orig lilypond-2.5.13/configure.in.orig
--- lilypond-2.5.13-orig/configure.in.orig	Wed Dec 31 16:00:00 1969
+++ lilypond-2.5.13/configure.in.orig	Fri Feb 25 17:06:14 2005
@@ -0,0 +1,139 @@
+dnl configure.in   -*-shell-script-*-
+dnl Process this file with autoconf to produce a configure script. 
+
+# Bootstrap the init proces.
+AC_INIT
+
+# Bootstrap StepMake configure
+# For user package:
+AC_CONFIG_AUX_DIR([stepmake/bin])
+# For stepmake package:
+# AC_CONFIG_AUX_DIR(bin)
+
+
+STEPMAKE_INIT
+
+# List a file that identifies your package.
+AC_CONFIG_SRCDIR([lily/main.cc])
+
+# Move to aclocal.m4?
+AC_CONFIG_HEADER([$CONFIGFILE.hh:config.hh.in])
+
+AC_C_BIGENDIAN(CFLAGS="$CFLAGS -DBIGENDIAN",
+               CFLAGS="$CFLAGS -DSMALLENDIAN")
+	       
+	       
+
+
+# Uncomment the configuration options your package needs.
+
+
+gui_b=no
+AC_ARG_ENABLE(gui,
+    [  --enable-gui            compile with experimental GNOME output module.  Default: off],
+    [gui_b=$enableval])
+
+# must come before any header checks
+STEPMAKE_COMPILE
+
+STEPMAKE_PYTHON(REQUIRED,2.1)
+STEPMAKE_GCC(REQUIRED, 2.8)
+STEPMAKE_CXX(REQUIRED)
+STEPMAKE_GXX(REQUIRED, 3.0.5)
+STEPMAKE_CXXTEMPLATE
+STEPMAKE_LIB(REQUIRED)
+# Do not use bison 1.50 and 1.75.
+# 1.29 is required fr %locations, but I'm not sure it's enough --ns
+STEPMAKE_BISON(REQUIRED, 1.29)
+STEPMAKE_FLEX(REQUIRED)
+STEPMAKE_FLEXLEXER(REQUIRED)
+AC_LANG_C
+STEPMAKE_LOCALE
+STEPMAKE_GETTEXT
+STEPMAKE_MSGFMT(REQUIRED)
+STEPMAKE_TEXMF(REQUIRED)
+STEPMAKE_TEXMF_DIRS
+STEPMAKE_GUILE_DEVEL(REQUIRED, 1.6.5)
+STEPMAKE_KPATHSEA
+STEPMAKE_MAKEINFO(REQUIRED)
+STEPMAKE_PYTHON_DEVEL(REQUIRED)
+
+STEPMAKE_PROGS(MFTRACE, mftrace, REQUIRED, 1.1.1)
+STEPMAKE_PATH_PROG(FONTFORGE, fontforge, REQUIRED, 20041208)
+
+AC_CHECK_HEADERS([assert.h libio.h sys/stat.h])
+AC_LANG_PUSH(C++)
+AC_CHECK_HEADERS([sstream])
+AC_LANG_POP(C++)
+AC_HEADER_STAT
+AC_FUNC_MEMCMP
+AC_FUNC_VPRINTF
+AC_CHECK_FUNCS([fopencookie funopen gettext isinf memmem snprintf vsnprintf])
+
+AC_MSG_CHECKING([for ec-fonts-mftraced])
+ecb10=`kpsewhich ecb10.pfa 2>/dev/null`
+if test -n "$ecb10"; then
+    AC_MSG_RESULT([$ecb10])
+else
+    AC_MSG_RESULT(no)
+    AC_MSG_CHECKING([for lmodern])
+    lmr10=`kpsewhich lmr10.pfb 2>/dev/null`
+    if test -n "$lmr10"; then
+	AC_MSG_RESULT([$lmr10])
+    else
+	STEPMAKE_ADD_ENTRY(REQUIRED, 'package ec-fonts-mftraced >= 1.0.5')
+	AC_MSG_CHECKING([for old version of ec-fonts-mftraced])
+	ecrm10=`kpsewhich ecrm10.pfa 2>/dev/null`
+	if test -n "$ecrm10"; then
+	    AC_MSG_RESULT([$ecrm10])
+	    AC_MSG_WARN([old version of ec-fonts-mftraced found, install 1.0.5 or newer])
+	fi
+    fi
+fi
+
+if test "$gui_b" = "yes"; then
+    STEPMAKE_GTK2
+fi
+
+STEPMAKE_FREETYPE2
+STEPMAKE_PANGO_FT2
+
+## Optional tools for building documentation, website, extra fonts.
+
+# guile executable for some scripts
+STEPMAKE_GUILE(OPTIONAL)
+# perl for help2man.
+STEPMAKE_PERL(OPTIONAL)
+
+
+
+# New makeinfo for multi-page website docs Simply always require new
+# makeinfo should avoid bug reports; if people want to build lily
+# without the docs, they can find this comment and use an older
+# makeinfo -- but hopefully won't report makeinfo problems.
+STEPMAKE_PROGS(MAKEINFO, makeinfo, REQUIRED, 4.7)
+AC_SUBST(MAKEINFO_VERSION)
+
+
+if test "$optimise_b" = yes; then
+    DEFINES="$DEFINES -DSTRING_UTILS_INLINED"
+    AC_DEFINE(STRINGS_UTILS_INLINED)
+fi
+
+AC_DEFINE_UNQUOTED(TOPLEVEL_VERSION, "${FULL_VERSION}")
+AC_DEFINE_UNQUOTED(FLOWER_VERSION, "${FULL_FLOWER_VERSION}")
+
+# Gather requirements and generate output.
+STEPMAKE_END
+
+
+test -n "$CONFIGURATION" && mc=" conf=$CONFIGURATION" || mc=""
+
+cat <<EOF
+
+Type:
+    make$mc all       to build LilyPond
+    make$mc install   to install LilyPond
+    make$mc help      to see all possible targets
+
+EOF
diff -ruN lilypond-2.5.13-orig/flower/include/libc-extension.hh lilypond-2.5.13/flower/include/libc-extension.hh
--- lilypond-2.5.13-orig/flower/include/libc-extension.hh	Mon Feb 28 08:49:45 2005
+++ lilypond-2.5.13/flower/include/libc-extension.hh	Mon Feb 28 18:59:01 2005
@@ -53,8 +53,6 @@
 #include <libio.h>
 #else
 
-#ifdef ALIAS_FILE_TO_FILECOOKIE
-  
 #define cookie_io_functions_t le_cookie_io_functions_t 
   typedef struct
   {
@@ -75,6 +73,8 @@
   int handle_cookie_io_fprintf (FILE *file, char const *format, ...);
   int handle_cookie_io_putc (int c, FILE *file);
 
+#ifdef ALIAS_FILE_TO_FILECOOKIE
+  
 /* FIXME: ttftool uses fclose fopencookie fprintf and putc only... */
 #define fclose handle_cookie_io_fclose
 #define fprintf handle_cookie_io_fprintf
diff -ruN lilypond-2.5.13-orig/flower/libc-extension.cc lilypond-2.5.13/flower/libc-extension.cc
--- lilypond-2.5.13-orig/flower/libc-extension.cc	Mon Feb 28 08:49:45 2005
+++ lilypond-2.5.13/flower/libc-extension.cc	Mon Feb 28 19:00:48 2005
@@ -163,9 +163,9 @@
 #if HAVE_FUNOPEN
   
   FILE *
-  fopencookie (void *cookie, char const *mode, cookie_io_functions_t *fun)
+  fopencookie (void *cookie, char const *mode, cookie_io_functions_t fun)
   {
-    return funopen (cookie, fun->read, fun->write, fun->seek, fun->close);
+    return funopen (cookie, fun.read, fun.write, fun.seek, fun.close);
   }
 
 #else /* ! HAVE_FUNOPEN */
diff -ruN lilypond-2.5.13-orig/lexer-gcc-3.1.sh lilypond-2.5.13/lexer-gcc-3.1.sh
--- lilypond-2.5.13-orig/lexer-gcc-3.1.sh	Mon Feb 28 08:49:45 2005
+++ lilypond-2.5.13/lexer-gcc-3.1.sh	Mon Feb 28 08:50:01 2005
@@ -8,7 +8,7 @@
 
 if [ -z "$FLEXLEXER" ]; then
 
-includes="$HOME/usr/include /usr/local/include /usr/include"
+includes="$HOME/usr/include $PREFIX/include /usr/local/include /usr/include" 
 
 for i in $includes; do
     file=$i/FlexLexer.h
@@ -43,9 +43,9 @@
 echo -n "Copying and fixing $file... "
 mkdir -p lily/$outdir
 rm -f lily/$outdir/FlexLexer.h
-sed -e 's/iostream.h/iostream/' \
-    -e 's/\<istream\>/std::istream/' \
-    -e 's/\<ostream\>/std::ostream/' \
+perl -p -e 's/iostream.h/iostream/g;' \
+    -e 's/\bistream\b/std::istream/g;' \
+    -e 's/\bostream\b/std::ostream/' \
     $file > lily/$outdir/FlexLexer.h
 echo "done"
 
@@ -58,9 +58,9 @@
     make conf=$CONF -C lily $outdir/lexer.cc > /dev/null 2>&1 || true
 
     mv $file $file.orig
-    sed -e 's/\<cin\>/std::cin/g' \
-	-e 's/\<cout\>/std::cout/g' \
-	-e 's/\<cerr\>/std::cerr/g' \
+    perl -p -e 's/\bcin\b/std::cin/g;' \
+	-e 's/\bcout\b/std::cout/g;' \
+	-e 's/\bcerr\b/std::cerr/g' \
 	$file.orig > $file
     echo "done"
 fi
diff -ruN lilypond-2.5.13-orig/lily/kpath.cc lilypond-2.5.13/lily/kpath.cc
--- lilypond-2.5.13-orig/lily/kpath.cc	Mon Feb 28 08:49:45 2005
+++ lilypond-2.5.13/lily/kpath.cc	Mon Feb 28 08:50:01 2005
@@ -30,6 +30,7 @@
 #define popen REALLYUGLYKLUDGE
 #define pclose ANOTHERREALLYUGLYKLUDGE
 #define getopt YAKLUDGE
+#define __GNU_LIBRARY__
 
 #if HAVE_KPATHSEA_KPATHSEA_H
 extern "C" {
diff -ruN lilypond-2.5.13-orig/mf/GNUmakefile lilypond-2.5.13/mf/GNUmakefile
--- lilypond-2.5.13-orig/mf/GNUmakefile	Mon Feb 28 08:49:44 2005
+++ lilypond-2.5.13/mf/GNUmakefile	Mon Feb 28 08:50:01 2005
@@ -63,7 +63,7 @@
 	(cd $(outdir) && fontforge -script $(notdir $<)) 
 
 $(CFF_PS_FILES): $(CFF_FILES)
-	cd $(outdir) && $(builddir)/lily/$(outconfbase)/lilypond --verbose $(abs-srcdir)/ly/generate-embedded-cff
+	cd $(outdir) && LILYPONDPREFIX=$(builddir) $(builddir)/lily/$(outconfbase)/lilypond --verbose $(abs-srcdir)/ly/generate-embedded-cff
 
 $(outdir)/%.otf-table: $(outdir)/%.lisp $(if $(findstring brace,$<),,$(subst feta,parmesan,$<)) 
 	cat $< \
diff -ruN lilypond-2.5.13-orig/stepmake/stepmake/c++-rules.make lilypond-2.5.13/stepmake/stepmake/c++-rules.make
--- lilypond-2.5.13-orig/stepmake/stepmake/c++-rules.make	Mon Feb 28 08:49:43 2005
+++ lilypond-2.5.13/stepmake/stepmake/c++-rules.make	Mon Feb 28 08:50:01 2005
@@ -26,3 +26,4 @@
 
 $(outdir)/%.cc: %.ll
 	$(FLEX) -Cfe -p -p -o$@ $< 
+	perl -i.bak -pe 's/^class istream;/#include <iostream>;\nusing namespace std;/' $@
\ No newline at end of file
diff -ruN lilypond-2.5.13-orig/stepmake/stepmake/c-vars.make lilypond-2.5.13/stepmake/stepmake/c-vars.make
--- lilypond-2.5.13-orig/stepmake/stepmake/c-vars.make	Mon Feb 28 08:49:43 2005
+++ lilypond-2.5.13/stepmake/stepmake/c-vars.make	Mon Feb 28 08:50:01 2005
@@ -14,4 +14,4 @@
 
 ALL_C_SOURCES += $(H_FILES) $(C_FILES) $(Y_FILES) $(L_FILES)
 
-ALL_CFLAGS = $(CFLAGS) $(ICFLAGS) $(DEFINES) $(addprefix -I,$(INCLUDES)) $(USER_CFLAGS) $(EXTRA_CFLAGS) $(MODULE_CFLAGS)
+ALL_CFLAGS = $(CFLAGS) $(CPPFLAGS) $(ICFLAGS) $(DEFINES) $(addprefix -I,$(INCLUDES)) $(USER_CFLAGS) $(EXTRA_CFLAGS) $(MODULE_CFLAGS)
diff -ruN lilypond-2.5.13-orig/stepmake/stepmake/compile-vars.make lilypond-2.5.13/stepmake/stepmake/compile-vars.make
--- lilypond-2.5.13-orig/stepmake/stepmake/compile-vars.make	Mon Feb 28 08:49:43 2005
+++ lilypond-2.5.13/stepmake/stepmake/compile-vars.make	Mon Feb 28 08:50:01 2005
@@ -3,7 +3,7 @@
 ALL_LDFLAGS = $(LDFLAGS) $(ILDFLAGS) $(EXTRA_LDFLAGS) $($(PACKAGE)_LDFLAGS) $(MODULE_LDFLAGS) $(USER_LDFLAGS)
 
 PIC_FLAGS = -fpic -fPIC
-SHARED_FLAGS = -shared
+SHARED_FLAGS = -bundle -flat_namespace -undefined suppress
 
 o-dep-out = $(outdir)/$(subst .o,.dep,$(notdir $@))#
 DO_O_DEP = rm -f $(o-dep-out); DEPENDENCIES_OUTPUT="$(o-dep-out) $(outdir)/$(notdir $@)"
diff -ruN lilypond-2.5.13-orig/tex/GNUmakefile lilypond-2.5.13/tex/GNUmakefile
--- lilypond-2.5.13-orig/tex/GNUmakefile	Mon Feb 28 08:49:42 2005
+++ lilypond-2.5.13/tex/GNUmakefile	Tue Mar  1 00:23:35 2005
@@ -20,7 +20,7 @@
 $(outdir)/latin1.enc: GNUmakefile
 	echo '/ISOLatin1Encoding' > $@.orig
 	echo 'ISOLatin1Encoding pstack' \
-	  | gs -sDEVICE=nullpage  -quiet - 2>> $@.orig
+	  | gs -sDEVICE=nullpage  -quiet - >> $@.orig 2>&1
 	echo 'def' >> $@.orig
 	sed 's|/minus|/hyphen|' < $@.orig > $@
 
