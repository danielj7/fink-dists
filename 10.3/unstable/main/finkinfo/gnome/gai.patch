--- gai-0.5.0pre6/gai/gai.c	Sun Nov 16 03:00:09 2003
+++ gai-0.5.0pre6/gai/gai.c	Sun Dec  7 22:17:27 2003
@@ -31,7 +31,9 @@
 #include <gtk/gtk.h>
 #include <gdk/gdkx.h>
 
+#ifdef GAI_JOYSTICK
 #include <linux/joystick.h>
+#endif
 #include <fcntl.h>
 #include <sys/select.h>
 
@@ -184,6 +186,7 @@
 
 static gpointer gai_joystick_thread_func(gpointer d)
 {
+#ifdef GAI_JOYSTICK
     int fd;
     GaiFlagsJoystick jflags;
     struct js_event js;
@@ -237,7 +240,7 @@
     }
 
     close(fd);
-
+#endif
     return NULL;
 }
 
@@ -252,7 +255,10 @@
     if(GAI.on_joystick_callback != NULL){
 	if (!g_thread_supported ())
 	    g_thread_init (NULL);
+	    
+#ifdef GAI_JOYSTICK
 	g_thread_create(gai_joystick_thread_func, NULL, TRUE, NULL);
+#endif
     }
 
 #ifdef GL
--- gai-0.5.0pre6/gai/Makefile.in.orig	Sun Dec  7 22:19:44 2003
+++ gai-0.5.0pre6/gai/Makefile.in	Sun Dec  7 22:24:41 2003
@@ -3,7 +3,7 @@
 
 # @GNOME_24@ - More broken than ever.
 CFLAGS = -Wall -O3 -D@HOST@ @GL@ @GTK@ @GNOME@ @GTK_CFLAGS@ @GNOME_CFLAGS@ @GL_CFLAGS@ -DVERSION="\"@GAI_VERSION@\""
-LDFLAGS = -fPIC -shared -Wl,-soname=libgai.so.@GAI_MAJOR@ @GTK_LIBS@ @GNOME_LIBS@ @GL_LIBS@
+LDFLAGS = -fPIC -dynamiclib -compatibility_version 0.5.0 -current_version @GAI_MAJOR@.@GAI_MINOR@.0 -install_name @prefix@/lib/libgai.@GAI_MAJOR@.dylib @GTK_LIBS@ @GNOME_LIBS@ @GL_LIBS@ -L/usr/X11R6/lib/ -lX11 -lpangoft2-1.0 -lgthread 
 CC = @CC@
 OBJS = gai.o gai-debug.o gai-draw.o gai-info.o gai-gnome.o gai-dockapp.o gai-settings.o gai-pref.o @GNOME_CONFIG@ 
 PREFIX = @prefix@
@@ -11,14 +11,14 @@
 all: libgai.so
 
 libgai.so: $(OBJS)
-	$(CC) $(LDFLAGS) $(OBJS) -o libgai.so
+	$(CC) $(LDFLAGS) $(OBJS) -o libgai.dylib
 install: libgai.so
 	mkdir -p $(PREFIX)/include/gai
 	cp gai.h $(PREFIX)/include/gai/
 	mkdir -p $(PREFIX)/lib
-	cp libgai.so $(PREFIX)/lib/libgai.so.@GAI_MAJOR@.@GAI_MINOR@.@GAI_MICRO@
-	ln -sf libgai.so.@GAI_MAJOR@.@GAI_MINOR@.@GAI_MICRO@ $(PREFIX)/lib/libgai.so.@GAI_MAJOR@
-	ln -sf libgai.so.@GAI_MAJOR@ $(PREFIX)/lib/libgai.so
+	cp libgai.dylib $(PREFIX)/lib/libgai.@GAI_MAJOR@.@GAI_MINOR@.@GAI_MICRO@.dylib
+	ln -sf libgai.@GAI_MAJOR@.@GAI_MINOR@.@GAI_MICRO@.dylib $(PREFIX)/lib/libgai.@GAI_MAJOR@.dylib
+	ln -sf libgai.@GAI_MAJOR@.dylib $(PREFIX)/lib/libgai.dylib
 	mkdir -p $(PREFIX)/lib/pkgconfig
 	cp ../gai.pc $(PREFIX)/lib/pkgconfig/
 uninstall:
--- gai-0.5.0pre6/gai/gnome-util.c.orig	Sun Dec  7 22:47:35 2003
+++ gai-0.5.0pre6/gai/gnome-util.c	Sun Dec  7 22:48:35 2003
@@ -52,6 +52,12 @@
 #include <sys/stat.h>
 #include <pwd.h>
 #include <limits.h>
+
+#ifdef DARWIN
+# include <crt_externs.h>
+# define environ (*_NSGetEnviron())
+#endif
+
 /*#include <libgnome/gnome-program.h>
 #include <libgnome/gnome-util.h>
 */
@@ -191,7 +197,6 @@
 #if defined (HAVE_SETENV)
 	unsetenv (name);
 #else
-	extern char **environ;
 	int i, len;
 
 	len = strlen (name);
@@ -227,7 +232,6 @@
 #ifdef HAVE_CLEARENV
 	clearenv ();
 #else
-	extern char **environ;
 	environ[0] = NULL;
 #endif
 }
