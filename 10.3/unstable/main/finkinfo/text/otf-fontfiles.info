Package: otf-fontfiles
Version: 1.5.4
Revision: 2
Depends: ptex3-base
BuildDepends: fink (>= 0.24.12)
Recommends: okumura-clsfiles, dvipdfmx
Source: http://fink.sodan.ecc.u-tokyo.ac.jp/~okayama/distfiles/%n-%v.zip
SourceDirectory: otfcurrent
Source-MD5: 43ec41d71e50c69ab48fd34f63811dc2
Source2: http://macptex.appi.keio.ac.jp/~uchiyama/Adobe-Japan1-5-V.gz
Source2-MD5: c1d9da9c0194f01b63f21c5f3c19ad0d
Description: Virtual fonts and style files for otf in ptex
License: Restrictive/Distributable
Maintainer: Todai Fink Team <fink@sodan.ecc.u-tokyo.ac.jp>
Homepage: http://psitau.at.infoseek.co.jp/otf.html
DocFiles: readme.txt fontmap/vfontmap.txt
PatchFile: %n.patch
PatchFile-MD5: cff244ce4d5ae908687502887e2c16e5
PatchScript: <<
 patch -p1 < %{PatchFile}
 mv fontmap/ckt.map*             fontmap/ckt.map
 mv fontmap/cktx.map*            fontmap/cktx.map
 mv fontmap/hiragino.map*        fontmap/hiragino.map
 mv fontmap/hiraginox.map*       fontmap/hiraginox.map
 # "morisawa.map" already exists: %p/share/texmf/fonts/map/dvipdfm/morisawa.map
 mv fontmap/morisawa.map*        fontmap/morisawaps.map
 mv fontmap/morisawax.map*       fontmap/morisawax.map
 sed -e 's|Ryumin-Light|ipam|g' \
     -e 's|GothicBBB-Medium|ipag|g' \
  < fontmap/psfonts_jp.map >     fontmap/ipa.map
 sed -e 's|!Ryumin-Light|ipam.ttf|g' \
     -e 's|!GothicBBB-Medium|ipag.ttf|g' \
  < fontmap/otf-noEmbed.map    > fontmap/ipax.map
 cd .. ; gzip -d Adobe-Japan1-5-V.gz

 chmod -x readme.txt
<<
CompileScript: ./makeotf
InstallScript: <<
  install -m 755 -d    %i/etc/texmf.local/fonts/vf/otf
  install -m 644 vf/*  %i/etc/texmf.local/fonts/vf/otf/

  install -m 755 -d    %i/etc/texmf.local/fonts/tfm/otf
  install -m 644 tfm/* %i/etc/texmf.local/fonts/tfm/otf/

  install -m 755 -d    %i/etc/texmf.local/fonts/ofm/otf
  install -m 644 ofm/* %i/etc/texmf.local/fonts/ofm/otf/

  install -m 755 -d    %i/etc/texmf.local/ptex/platex/misc
  install -m 644 sty/* %i/etc/texmf.local/ptex/platex/misc/

  install -m 755 -d %i/etc/texmf.local/fonts/map/dvips/otf
  install -m 644 fontmap/otf-ckt.map \
                    %i/etc/texmf.local/fonts/map/dvips/otf/
  install -m 644 fontmap/{ckt,hiragino,ipa,kozuka,morisawaps,psfonts_jp}.map \
                    %i/etc/texmf.local/fonts/map/dvips/otf/

  install -m 755 -d %i/etc/texmf.local/fonts/map/dvipdfm/otf
  install -m 644 fontmap/{ckt,hiragino,ipa,kozuka,morisawa}x.map \
                    %i/etc/texmf.local/fonts/map/dvipdfm/otf/
  install -m 644 fontmap/otf-{cktx,noEmbed}.map \
                    %i/etc/texmf.local/fonts/map/dvipdfm/otf/

  for font in hiragino ipa kozuka morisawa; do ln -s ${font}x.map \
                    %i/etc/texmf.local/fonts/map/dvipdfm/otf/otf-${font}.map; done

  install -m 755 -d                  %i/share/ghostscript/Resource/CMap
  install -m 644 ../Adobe-Japan1-5-V %i/share/ghostscript/Resource/CMap/
<<
PostInstScript: <<
# If ls-R does not exist, we don't run mktexlsr(user may prefer not to).
if [ -x %p/bin/mktexlsr ] && [ -f %p/etc/texmf.local/ls-R ]
then
	%p/bin/mktexlsr %p/etc/texmf.local
fi
if [ -x %p/bin/updmap-sys ]
then
  # if updmap.cfg is not changed, updmap-sys returns 1. :-<
  updmap-sys --nomkmap --enable KanjiMap otf-@kanjiEmbed@.map || /usr/bin/true
  updmap-sys --nomkmap --enable KanjiMap otf-cktx.map         || /usr/bin/true 
  updmap-sys
fi
<<
PreRmScript: <<
 # do nothing. (needed to upgrade from 1.5.3 with dvipdfmx-20070409)
<<
PostRmScript: <<
if [ $1 != "upgrade" ]; then

if [ -x %p/bin/updmap-sys ]
then
  # if updmap.cfg is not changed, updmap-sys returns 1. :-<
  updmap-sys --nomkmap --disable otf-@kanjiEmbed@.map || /usr/bin/true
  updmap-sys --nomkmap --disable otf-cktx.map         || /usr/bin/true 
  updmap-sys
fi
# If ls-R does not exist, we don't run mktexlsr(user may prefer not to).
if [ -x %p/bin/mktexlsr ] && [ -f %p/etc/texmf.local/ls-R ]
then
	%p/bin/mktexlsr %p/etc/texmf.local
fi

fi
<<
