diff -ru openssl-1.0.1a.orig/crypto/evp/e_rc4_hmac_md5.c openssl-1.0.1a/crypto/evp/e_rc4_hmac_md5.c
--- openssl-1.0.1a.orig/crypto/evp/e_rc4_hmac_md5.c	2012-04-18 13:51:33.000000000 -0400
+++ openssl-1.0.1a/crypto/evp/e_rc4_hmac_md5.c	2012-04-19 22:23:12.000000000 -0400
@@ -103,7 +103,8 @@
 #if	!defined(OPENSSL_NO_ASM) &&	( \
 	defined(__x86_64)	|| defined(__x86_64__)	|| \
 	defined(_M_AMD64)	|| defined(_M_X64)	|| \
-	defined(__INTEL__)		)
+	defined(__INTEL__)		) && \
+	!(defined(__APPLE__) && defined(__MACH__))
 #define	STITCHED_CALL
 #endif
 
@@ -121,6 +122,7 @@
 		md5_off = MD5_CBLOCK-key->md.num,
 		blocks;
 	unsigned int l;
+	extern unsigned int OPENSSL_ia32cap_P[];
 #endif
 	size_t	plen = key->payload_length;
 
@@ -132,7 +134,8 @@
 		/* cipher has to "fall behind" */
 		if (rc4_off>md5_off) md5_off+=MD5_CBLOCK;
 
-		if (plen>md5_off && (blocks=(plen-md5_off)/MD5_CBLOCK)) {
+		if (plen>md5_off && (blocks=(plen-md5_off)/MD5_CBLOCK) &&
+		    (OPENSSL_ia32cap_P[0]&(1<<20))==0) {
 			MD5_Update(&key->md,in,md5_off);
 			RC4(&key->ks,rc4_off,in,out);
 
@@ -172,7 +175,8 @@
 		if (md5_off>rc4_off)	rc4_off += 2*MD5_CBLOCK;
 		else			rc4_off += MD5_CBLOCK;
 
-		if (len>rc4_off && (blocks=(len-rc4_off)/MD5_CBLOCK)) {
+		if (len>rc4_off && (blocks=(len-rc4_off)/MD5_CBLOCK) &&
+		    (OPENSSL_ia32cap_P[0]&(1<<20))==0) {
 			RC4(&key->ks,rc4_off,in,out);
 			MD5_Update(&key->md,out,md5_off);
 
@@ -289,8 +293,6 @@
 
 const EVP_CIPHER *EVP_rc4_hmac_md5(void)
 	{
-	extern unsigned int OPENSSL_ia32cap_P[];
-	/* RC4_CHAR flag ------------vvvvv */
-	return(OPENSSL_ia32cap_P[0]&(1<<20) ? NULL : &r4_hmac_md5_cipher);
+	return(&r4_hmac_md5_cipher);
 	}
 #endif
diff -ru openssl-1.0.1a.orig/util/point.sh openssl-1.0.1a/util/point.sh
--- openssl-1.0.1a.orig/util/point.sh	2009-04-06 10:25:02.000000000 -0400
+++ openssl-1.0.1a/util/point.sh	2012-04-19 19:22:44.000000000 -0400
@@ -1,10 +1,17 @@
 #!/bin/sh
 
-rm -f "$2"
+if [ `echo "$1" | tr '[[:upper:]]' '[[:lower:]]'` = `echo "$2" | tr '[[:upper:]]' '[[:lower:]]'` ]; then
+    echo "$2 => $1 not done ($1 =~ $2)"
+    echo "ln -s \"$1\" \"$2\"" >> @BUILDDIR@/skipped-links
+elif [ -e $2 ]; then	# this part is useless (given linking below with "ln -s"), except for the file "skipped-links" 
+    echo "$2 => $1 not done (-e $2)"
+    echo "ln -s \"$1\" \"$2\"" >> @BUILDDIR@/skipped-links
+else
 if test "$OSTYPE" = msdosdjgpp || test "x$PLATFORM" = xmingw ; then
     cp "$1" "$2"
 else
     ln -s "$1" "$2"
 fi
 echo "$2 => $1"
+fi
 
