Package: libcurl4
Version: 7.19.3
Revision: 1
Description: Lib. for transferring files with URL syntax
DescPackaging: <<
  Now use System's OpenSSL.
  
  No longer need --mandir. Private symbols now hidden with gcc 4.
  Depend on pkgconfig >= 0.20-1
  per http://wiki.finkproject.org/index.php/Fink:Packaging:pkg-config
  
  Removed -I/usr/include -L/usr/lib from krb5-config.
  
  No longer build static libs.
  
  Packages depending on libcurl4 no longer need to depend on its dependencies,
  just Depend on libcurl4-shlibs and BuildDepend on libcurl4.
    
  Versions of curl before 7.11.1-11 were maintained by Max Horn.
<<
Maintainer: Daniel Johnson <daniel@daniel-johnson.org>
Homepage: http://curl.haxx.se/
License: BSD

Source: http://curl.haxx.se/download/curl-%v.tar.bz2
#Source: mirror:custom:curl-%v.tar.bz2
Source-MD5: 10eb8c13350c735eff20d7b4530be8cd

Depends: %N-shlibs (= %v-%r), pkgconfig (>= 0.20-1)
BuildDepends: system-openssl-dev, fink (>= 0.25.0), libssh2.1 (>= 0.17-1), libidn, libgettext3-dev, libcares2, libiconv-dev
Conflicts: curl-dev, curl-ssl-dev, curl-unified-dev, libcurl3, libcurl3-ssl, libcurl3-unified
Replaces: curl-dev, curl-ssl-dev, curl-unified-dev, libcurl3, libcurl3-ssl, libcurl3-unified
BuildDependsOnly: True

PatchScript: <<
	#Since we're not building static libs, no need to cascade dep libs.
	perl -pi -e 's/link_all_deplibs=yes/link_all_deplibs=no/g' configure
	#Clear out unnecessary junk. Leave -lssl in curl-config as a hack for pycurl.
	perl -pi -e 's,\@LDFLAGS\@,,g; s,\@LIBCURL_LIBS\@,-lssl,g' curl-config.in
	perl -pi -e 's,\@LDFLAGS\@,,g; s,\@LIBCURL_LIBS\@,,g' libcurl.pc.in
	#There is no more libcurl.a so trick curl-config --static-libs into using libcurl.dylib. Fixes building of pycurl.
	perl -pi -e 's/\@libext\@/dylib/' curl-config.in
	#This patch only needed for 10.4 but doesn't hurt 10.5
	perl -pi -e 's(krb5-config --cflags gssapi)($& | sed "s,-I/usr/include,,g")g; s(krb5-config --libs gssapi)($& | sed "s,-L/usr/lib,,g")g' configure
	#Set up to use system's ldap
	/bin/cp /usr/include/lber*.h .
	/bin/cp /usr/include/ldap*.h .
	/bin/cp /usr/lib/libldap.dylib .
<<

NoSetCPPFLAGS: true
NoSetLDFLAGS: true
SetCPPFLAGS: -I%b -I%p/lib/system-openssl/include -I%p/include
SetLDFLAGS: -L%b -L%p/lib/system-openssl/lib -L%p/lib
SetCFLAGS: -Os
ConfigureParams: <<
	--with-ssl=%p/lib/system-openssl \
	--without-gnutls \
	--with-libssh2=%p \
	--with-gssapi=/usr \
	--with-libidn=%p \
	--enable-ldap \
	--disable-ldaps \
	--with-ldap-lib=ldap \
	--with-lber-lib=no \
	--enable-hidden-symbols \
	--enable-ares \
	--with-ca-bundle=%p/etc/ssl/certs/ca-bundle.crt \
	--disable-static \
	--disable-dependency-tracking
<<
InstallScript: <<
	perl -pi -e 's/-g -Os -Wl,-search_paths_first //g; s/-dynamic //g' curl-config libcurl.pc
	make install DESTDIR=%d
	#No need for dependency_libs in .la files if not building static libs
	perl -pi -e "s/dependency_libs=.*$/dependency_libs=''/" %i/lib/*.la
	/bin/mkdir -p %I/share/doc/%N
	/bin/cp docs/*.html %I/share/doc/%N
	/bin/mkdir -p %I/share/doc/%N/libcurl
	/bin/cp docs/libcurl/*.html %I/share/doc/%N/libcurl
	/bin/mkdir -p %I/share/aclocal
	/bin/cp docs/libcurl/libcurl.m4 %I/share/aclocal
<<
DocFiles: CHANGES COPYING README RELEASE-NOTES

SplitOff: <<
  Package: %N-shlibs
  
  Depends: libssh2.1-shlibs (>= 0.17-1), libidn-shlibs, libcares2-shlibs, ca-bundle
    
  Files: lib/libcurl.4.*dylib
  Shlibs: %p/lib/libcurl.4.dylib 6.0.0 %n (>= 7.18.2-1)
  DocFiles: CHANGES COPYING README RELEASE-NOTES
<<

SplitOff2: <<
  Package: curl
  Description: Tool for transferring files with URL syntax
  DescUsage: For additional documentation see the %N package.
  
  Depends: %N-shlibs (= %v-%r)
  Replaces: curl-ssl (<< %v-%r), curl-unified (<< %v-%r)
  
  Files: bin/curl share/man/man1/curl.1
  DocFiles: CHANGES COPYING README RELEASE-NOTES docs/BINDINGS docs/BUGS docs/CONTRIBUTE docs/FAQ docs/FEATURES docs/HISTORY docs/KNOWN_BUGS docs/INTERNALS docs/MANUAL docs/RESOURCES docs/THANKS docs/TODO docs/TheArtOfHttpScripting docs/LICENSE-MIXING docs/SSLCERTS docs/VERSIONS
<<
SplitOff3: <<
  Package: curl-ssl
  Description: OBSOLETE use curl instead
  Depends: curl (= %v-%r), fink-obsolete-packages
  DocFiles: CHANGES COPYING README RELEASE-NOTES
<<
SplitOff4: <<
  Package: curl-unified
  Description: OBSOLETE use curl instead
  Depends: curl (= %v-%r)
  DocFiles: CHANGES COPYING README RELEASE-NOTES
<<

InfoTest: <<
  TestDepends: stunnel4
  TestScript: <<
    #!/bin/bash -ev
    
    #This test fails when run as root.
	echo '1001' >>tests/data/DISABLED
	
	#The SSH tests will also be skipped as root but this isn't fatal.
	
    #Build and run the tests
    make test-full || exit 2
  <<
<<

#Mirrors taken from http://curl.haxx.se/metalink.cgi?curl=tar.bz2 on 20081128
CustomMirror: <<
	eur-at: http://gd.tuwien.ac.at/utils/archivers/curl/
	eur-at: ftp://gd.tuwien.ac.at/utils/archivers/curl/
	eur-be: ftp://ftp.spegulo.be/pub/curl/
	sam-cl: http://curl.freeby.pctools.cl/download/
	eur-fr: ftp://miroir-francais.fr/pub/curl/download/
	eur-de: http://curl.de-mirror.de/download/
	eur-de: http://www.mirrorspace.org/curl/
	eur-de: http://curl.online-mirror.de/download/
	eur-de: http://curl.linux-mirror.org/download/
	eur-de: http://dl.ambiweb.de/mirrors/curl.haxx.se/
	eur-de: http://curl.oslevel.de/download/
	eur-de: http://curl.mirror.at.stealer.net/download/
	eur-de: http://curl.basemirror.de/download/
	eur-de: http://curl.very-clever.com/download/
	asi-hk: http://www.execve.net/curl/
	eur-il: http://curl.cheap.co.il/download/
	eur-nl: http://curl.nedmirror.nl/download/
	eur-nl: http://curl.osmirror.nl/download/
	eur-nl: http://curl.xxtracker.org/download/
	eur-pl: http://curl.piotrkosoft.net/download/
	eur-se: http://curl.haxx.se/download/
	eur-se: http://cool.haxx.se/curl/
	eur-se: http://curl2.haxx.se/download/
	eur-se: ftp://ftp.sunet.se/pub/www/utilities/curl/
	asi-tw: http://curl.cs.pu.edu.tw/download/
	nam-us: http://curl.download.nextag.com/download/
	nam-us: http://curl.hoxt.com/download/
	eur-uk: http://curl.smudge-it.co.uk/download/
<<
