Package: libann-shlibs
Version: 1.1.2
Revision: 5
Maintainer: None <fink-devel@lists.sourceforge.net>
License: LGPL

Description: Approximate nearest neighbour library for C++

BuildDepends: <<
	autoconf2.6,
	automake1.15,
	fink (>= 0.32),
	libtool2
<<
GCC: 4.0

Source: http://www.cs.umd.edu/~mount/ANN/Files/%v/ann_%v.tar.gz
Source-MD5: 7ffaacc7ea79ca39d4958a6378071365
Source2: http://ftp.de.debian.org/debian/pool/main/a/ann/ann_%v+doc-5.debian.tar.xz
Source2-MD5: 95c01680996b49655420ab7e76e131ce

PatchFile: %n.patch
PatchFile-MD5: b7749d9a4cdc8eb3d5489387e8f492ed
PatchScript: <<
#!/bin/sh -ev
	for f in \
		autotools-files \
		consider-pts-null \
		annkFRSearch-default-argument \
		clang-ftbfs \
	; do
		patch -p1 < ../debian/patches/$f.diff
	done
	%{default_script}
<<

InfoTest: <<
	TestDepends: coreutils
	TestScript: <<
	#!/bin/sh -ev
		mv ../debian/tests tests
		cd tests
		sed -i -e 's|g++ |g++ -I%b/include -L%b/src/.libs |' -e 's|mktemp|gmktemp|' build1 build2
		export DYLD_LIBRARY_PATH="%b/src/.libs"
		./build1; ./build2 || exit 2
	<<
<<

CompileScript: <<
#!/bin/sh -ev
	touch aclocal.m4
	mkdir -p cfg
	libtoolize --automake
	autoheader
	aclocal -I m4 --install 
	automake --foreign --add-missing
	autoconf 
	%{default_script}
<<

InstallScript: <<
#!/bin/sh -ev
	mkdir -p %i/bin %i/lib/pkgconfig %i/include %i/share/doc/ann-tools
	make install DESTDIR=%d

	install -d %i/share/man/man1
	for f in \
		ann2fig \
		ann_sample \
		ann_test \
	; do
		 pod2man --center="User Commands" --release="ANN 1.1.2" ../debian/$f.pod > $f.1
		 install -m 644 $f.1 %i/share/man/man1
	done

	for f in \
		data.pts \
		query.pts \
		sample.save \
	; do
		install -m 644 sample/$f %i/share/doc/ann-tools
	done
<<

SplitOff: <<
	Package: libann-dev
	Conflicts: libann (<= 1.1.2-2)
	Replaces: libann (<= 1.1.2-2)
	Depends: %N (= %v-%r)
	BuildDependsOnly: true
	Files: <<
		include
		lib/libann.{a,dylib,la}
		lib/pkgconfig/ann.pc
	<<
	DocFiles: Copyright.txt License.txt ReadMe.txt doc/ANNmanual.pdf
<<

SplitOff2: <<
	Package: ann-tools
	Conflicts: libann (<= 1.1.2-2)
	Replaces: libann (<= 1.1.2-2)
	Depends: %N (= %v-%r)
	Files: bin share/man/man1 share/doc/ann-tools
	DocFiles: Copyright.txt License.txt ReadMe.txt 
<<

Shlibs: %p/lib/libann.0.dylib 1.0.0 %n (>= 1.2.2-3)
DocFiles: Copyright.txt License.txt ReadMe.txt 
