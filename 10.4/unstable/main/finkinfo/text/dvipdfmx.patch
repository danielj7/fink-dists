--- dvipdfmx-20050831/data/config/dvipdfmx.cfg.orig	2005-07-20 19:41:54.000000000 +0900
+++ dvipdfmx-20050831/data/config/dvipdfmx.cfg	2006-12-04 16:24:32.000000000 +0900
@@ -135,7 +135,7 @@
 %% simply means large size paper)
 %%
 %% GhostScript (Unix/Linux):
-%D  "gs -q -dNOPAUSE -dBATCH -sPAPERSIZE=a0 -sDEVICE=pdfwrite -dCompatibilityLevel=1.3 -dAutoFilterGrayImages=false -dGrayImageFilter=/FlateEncode -dAutoFilterColorImages=false -dColorImageFilter=/FlateEncode -dUseFlateCompression=true -sOutputFile=%o %i -c quit"
+D "gs -q -dNOPAUSE -dBATCH -sPAPERSIZE=a0 -sDEVICE=pdfwrite -dCompatibilityLevel=1.3 -dAutoFilterGrayImages=false -dGrayImageFilter=/FlateEncode -dAutoFilterColorImages=false -dColorImageFilter=/FlateEncode -dUseFlateCompression=true -sOutputFile=%o -c '.setpdfwrite << /NeverEmbed [/Courier /Courier-Bold /Courier-Oblique /Courier-BoldOblique /Helvetica /Helvetica-Bold /Helvetica-Oblique /Helvetica-BoldOblique /Times-Roman /Times-Bold /Times-Italic /Times-BoldItalic /Symbol /ZapfDingbats /Ryumin-Light /GothicBBB-Medium] >> setdistillerparams' -f %i -c quit"
 
 %% GhostScript (Win32):
 %D  "gswin32c -q -dNOPAUSE -dBATCH -sPAPERSIZE=a0 -sDEVICE=pdfwrite -dCompatibilityLevel=1.3 -dAutoFilterGrayImages=false -dGrayImageFilter=/FlateEncode -dAutoFilterColorImages=false -dColorImageFilter=/FlateEncode -dUseFlateCompression=true -sOutputFile=%o %i -c quit"
@@ -189,5 +189,5 @@
 
 
 %% Put additonal fontmap files here
-f  cid-x.map
-
+%f cid-x.map
+f  kanjix.map
--- dvipdfmx-20050627/data/Makefile.in.orig	2005-06-27 20:57:15.000000000 +0900
+++ dvipdfmx-20050627/data/Makefile.in	2006-03-30 02:09:50.000000000 +0900
@@ -293,7 +293,7 @@
 
 install-pkgdataDATA: $(pkgdata_DATA)
 	@$(NORMAL_INSTALL)
-	$(mkinstalldirs) $(pkgdatadir)
+	$(mkinstalldirs) $(DESTDIR)$(pkgdatadir)
 	@list='$(pkgdata_DATA)'; for adir in $$list; do \
 	  $(mkinstalldirs) $(DESTDIR)$(pkgdatadir)/$$adir; \
 	  for p in $$adir/*; do \
--- dvipdfmx-20050831/src/spc_html.c.orig	2005-08-15 00:50:36.000000000 +0900
+++ dvipdfmx-20050831/src/spc_html.c	2006-04-27 17:06:43.000000000 +0900
@@ -288,6 +288,7 @@
     len += strlen(baseurl) + 1; /* we may want to add '/' */
 
   q = NEW(len + 1, char);
+  *q = '\0';
   if (baseurl && baseurl[0]) {
     char  *p;
     strcpy(q, baseurl);
--- dvipdfmx-20050831/src/fontmap.c.orig   30 Jul 2005 11:44:18 -0000
+++ dvipdfmx-20050831/src/fontmap.c   7 Jan 2006 08:16:35 -0000
@@ -422,7 +422,7 @@
       if (v < 0 || v > 16)
         WARN("Invalid valur for option 'p': %s", q);
       else {
-        mrec->opt.mapc |= v << 16;
+        mrec->opt.mapc = v << 16;
       }
       RELEASE(q);
       break;

--- dvipdfmx/src/pdfdoc.c.orig	2005-09-06 13:17:15.000000000 +0900
+++ dvipdfmx/src/pdfdoc.c	2007-01-25 14:43:45.000000000 +0900
@@ -1,4 +1,4 @@
-/*  $Header: /home/cvsroot/dvipdfmx/src/pdfdoc.c,v 1.43 2005/09/06 04:17:15 chofchof Exp $
+/*  $Header: /home/cvsroot/dvipdfmx/src/pdfdoc.c,v 1.45 2006/12/21 02:36:55 chofchof Exp $
  
     This is dvipdfmx, an eXtended version of dvipdfm by Mark A. Wicks.
 
@@ -484,12 +484,36 @@
   return;
 }
 
+/* auxiliary function to compute timezone offset on
+   systems that do not support the tm_gmtoff in struct tm,
+   or have a timezone variable.  Such as i386-solaris.  */
+
+static long
+compute_timezone_offset()
+{
+  const time_t now = time(NULL);
+  struct tm tm;
+  struct tm local;
+  time_t gmtoff;
+
+  localtime_r(&now, &local);
+  gmtime_r(&now, &tm);
+  return (mktime(&local) - mktime(&tm));
+}
+
 /*
  * Docinfo
  */
 static long
 asn_date (char *date_string)
 {
+#ifndef HAVE_TIMEZONE
+# ifdef HAVE_TM_GMTOFF
+#  define timezone (-bd_time->tm_gmtoff)
+# else
+#  define timezone (-compute_timezone_offset())
+# endif /* not HAVE_TM_GMTOFF */
+#endif  /* not HAVE_TIMEZONE */
   time_t      current_time;
   struct tm  *bd_time;
 
@@ -498,7 +522,7 @@
   sprintf(date_string, "D:%04d%02d%02d%02d%02d%02d%+03ld'%02ld'",
 	  bd_time->tm_year + 1900, bd_time->tm_mon + 1, bd_time->tm_mday,
 	  bd_time->tm_hour, bd_time->tm_min, bd_time->tm_sec,
-	  -(bd_time->tm_gmtoff / 3600), (bd_time->tm_gmtoff % 3600) / 60);
+	  (-timezone / 3600), (timezone % 3600) / 60);
 
   return strlen(date_string);
 }
--- dvipdfmx/src/pdfdoc.c~	2007-01-25 14:43:45.000000000 +0900
+++ dvipdfmx/src/pdfdoc.c	2007-01-25 15:57:37.000000000 +0900
@@ -494,7 +494,6 @@
   const time_t now = time(NULL);
   struct tm tm;
   struct tm local;
-  time_t gmtoff;
 
   localtime_r(&now, &local);
   gmtime_r(&now, &tm);
@@ -516,13 +515,15 @@
 #endif  /* not HAVE_TIMEZONE */
   time_t      current_time;
   struct tm  *bd_time;
+  ldiv_t       offset;
 
+  offset = ldiv(-timezone / 60, 60);
   time(&current_time);
   bd_time = localtime(&current_time);
   sprintf(date_string, "D:%04d%02d%02d%02d%02d%02d%+03ld'%02ld'",
 	  bd_time->tm_year + 1900, bd_time->tm_mon + 1, bd_time->tm_mday,
 	  bd_time->tm_hour, bd_time->tm_min, bd_time->tm_sec,
-	  (-timezone / 3600), (timezone % 3600) / 60);
+	  offset.quot, offset.rem);
 
   return strlen(date_string);
 }
