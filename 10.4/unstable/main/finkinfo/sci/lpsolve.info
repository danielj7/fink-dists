Package: lpsolve
Description: Mixed Integer Linear Programming (ILP) solver
Version: 5.5.0.9
Revision: 2

Depends: %N5.5-shlibs (= %v-%r)

Source: mirror:sourceforge:%n/lp_solve_%v_source.tar.gz
Source-MD5: 8c2823c8dc3d4cb80b7510b1d500635d
SourceDirectory: lp_solve_5.5

PatchScript: <<
#!/bin/sh -ev
## change the name of the lib, and correct install_name.
  sed -i.bak -e '{
	s,liblpsolve55,liblpsolve,g
	s,liblpsolve\.dylib,liblpsolve.5.5.0.dylib -install_name %p/lib/liblpsolve.5.5.dylib,
# liblpsolv.a is useless on the link line (except if with -all_load, and then tail of the cmd is useless..), and let us strip.
	s;b liblpsolve.a;b -single_module -Wl,-x -dead_strip;
	}' lpsolve55/ccc.osx
## for executable, use dynamic linking, and -mdynamic-no-pic _ and strip :
  sed -i.bak -e 's;\$src;-mdynamic-no-pic -s -dead_strip lp_solve.c ../lpsolve55/liblpsolve.dylib;' lp_solve/ccc.osx
## try adding -fstrict-aliasing to CFLAGS (comment out for the moment since gives a warning in lp_matrix.c 2308-2309)
#  sed -i~ -e 's,\-O3,& -fstrict-aliasing -Wall,' lp*/ccc.osx
## Dynamic library filenames on OS X end with ".dylib", not ".so"
  sed -i.bak -e 's;".so";".dylib";' bfp/bfp_LUSOL/LUSOL/commonlib.c lp_lib.c shared/commonlib.c shared/myblas.c
<<

CompileScript: <<
#!/bin/sh -ev

  # Build the library
  cd %n55
  sh -ev ccc.osx

  # Symbolic links to library
  ln -s lib%n.5.5.0.dylib lib%n.5.5.dylib
  ln -s lib%n.5.5.dylib lib%n.dylib

  # Build the lp_solve executable
  cd ../lp_solve
  sh -ev ccc.osx
<<

InstallScript: <<
#!/bin/sh -ev

  # Libraries
  mkdir -p %i/lib
  cp -pPR %n55/lib%n.* %i/lib

  # Headers
  mkdir -p %i/include/lp_solve/bfp/bfp_LUSOL/LUSOL
  mkdir -p %i/include/lp_solve/colamd
  mkdir -p %i/include/lp_solve/shared
  cp *.h %i/include/lp_solve
  cp bfp/*.h %i/include/lp_solve/bfp
  cp bfp/bfp_LUSOL/*.h %i/include/lp_solve/bfp/bfp_LUSOL
  cp bfp/bfp_LUSOL/LUSOL/*.h %i/include/lp_solve/bfp/bfp_LUSOL/LUSOL
  cp colamd/*.h %i/include/lp_solve/colamd
  cp shared/*.h %i/include/lp_solve/shared

  # Executable
  mkdir -p %i/bin
  /usr/bin/install lp_solve/lp_solve %i/bin

  # link the doc files:
  mkdir -p %i/share/doc
  ln -s %N5.5-shlibs %i/share/doc/%n
<<

SplitOff: <<
  Package: %N5.5-shlibs
  Files: lib/lib%N.5*.dylib
  Shlibs: %p/lib/lib%N.5.5.dylib 5.5.0 %n (>= 5.5.0.9-1)
  DocFiles: README.txt
<<

SplitOff2: <<
  Package: %N5.5-dev
  Depends: %N5.5-shlibs (= %v-%r)
  BuildDependsOnly: true
  Files: include lib
  InstallScript: <<
    # link the doc files:        
    mkdir -p %i/share/doc
    ln -s %N5.5-shlibs %i/share/doc/%n  
  <<
<<

DescDetail: <<
lp_solve is a free linear (integer) programming solver based on the revised
simplex method and the Branch-and-bound method for the integers. It solves pure
linear, (mixed) integer/binary, semi-continuous and special ordered sets (SOS)
models. It can be called as a library from different languages like C, VB,
.NET, Delphi, Excel, Java, ...
<<

DescPort: <<
Experimenting with -combine is very negative:
total size of .o files w/o combining : 751216; combined: 876720; stripped dylib after combining: 753208
(cmp to 601832  _ cf below)
(independently [except of course for the size of the combined .o file, 876720] of whether first compile, then link,
or, "compile-and-link in 1 go")

Those figures are quite robust: the following sizes of the dylib are independent of the various combinations
of '-s' and '-gfull' in the compile stage :
-fno-common, -single-module: 601776
-fno-common, multiple-modules: 609436
common; -single-module: 601832
<<

DescPackaging: <<
Library name changed from "lpsolve55" to "lpsolve".
So the install_name (and the splitoff-names) must contain "5.5"...

Use dynamic linking for the executable.

The demo files are not packaged (neither source nor binary).
<<

DescUsage: documentation in http://lpsolve.sourceforge.net/5.5/

License: LGPL
HomePage: http://sourceforge.net/projects/lpsolve/
Maintainer: Trevor Harmon <trevor@vocaro.com>
