Package: nspr.0d
Version: 4.8
Revision: 1
BuildDepends: fink (>= 0.24.12)
Depends: %N-shlibs (= %v-%r)
Conflicts: nspr
Replaces: nspr
BuildDependsOnly: true
Source: http://ftp.mozilla.org/pub/mozilla.org/nspr/releases/v%v/src/nspr-%v.tar.gz
Source-MD5: e0916a72bcc6c427551ea262183fdb26
SourceDirectory: nspr-%v/mozilla/nsprpub
Source2: mirror:debian:pool/main/n/nspr/nspr_4.8-1.diff.gz
Source2-MD5: 6f464e55fc87fd6b4e9e5193ba509fa5
PatchFile: %n.patch
PatchFile-MD5: 11d0c4f8ac772380b06c0b05e18bebe8
PatchScript: <<
#!/bin/sh -ev
	patch -p3 < %{PatchFile}

	gzip -dc ../../../nspr_*.diff.gz | patch -p1
	for file in \
		30_pkgconfig.dpatch \
		99_configure.dpatch \
	; do
		echo "applying $file"
		patch -p3 < debian/patches/$file
	done
<<
NoSetCPPFLAGS: true
NoSetLDFLAGS: true
ConfigureParams: --disable-debug --disable-dependency-tracking --enable-macos-target=10.4 --libdir=%p/lib/nspr
InstallScript: <<
#!/bin/sh -ev
	make -j1 install DESTDIR=%d

	# counteract side-effect of burying the libs
	mv %i/lib/nspr/pkgconfig %i/lib
	
	SO_VERSION=0d
	for file in libnspr4 libplc4 libplds4; do
		ln -sf "$file.${SO_VERSION}.dylib" "%i/lib/nspr/$file.dylib"
	done

<<
SplitOff: <<
	Package: %N-shlibs
	Files: <<
		lib/nspr/libnspr4.0d.dylib
		lib/nspr/libplc4.0d.dylib
		lib/nspr/libplds4.0d.dylib
	<<
	Shlibs: <<
		%p/lib/nspr/libnspr4.0d.dylib 1.0.0 %n (>= 4.8-1)
		%p/lib/nspr/libplc4.0d.dylib  1.0.0 %n (>= 4.8-1)
		%p/lib/nspr/libplds4.0d.dylib 1.0.0 %n (>= 4.8-1)
	<<
<<
Description: Netscape Portable Runtime
DescDetail: <<
Netscape Portable Runtime (NSPR) provides a platform-neutral
API for system level and libc like functions.  The API is
used in the Mozilla client, many of Netscape/AOL/iPlanet's
and other software offerings.
<<
DescPackaging: <<
	dmacks overhauled 4.6.7-1 -> 4.8-1 all the following:

	Upstream does not update compatibility_version when added new
	public symbols! Maybe that's why debian hacked soname in
	recent versions? We'll do that too: rename %n nspr -> nspr.0d

	Bury library files so don't accidentally find them (many pkgs
	seem to need BuildConflicts:nspr)

	macos-target for consistency among all fink-supported
	platforms (cleaner to use %c than patch configure fallbacks).

	do not use SDKs...don't need portability or fat.

	#Grab debian's patch for soname handling. Seems like they have
	#lots of platforms covered and portably handle linker symlinks.
	^-- uses libFOO.so.X.Y.Z (postfix libversion naming) and doesn't
	    actually do anything when used under fink (dunno why) so just
	    use their "SO_VERSION=0d" and manually hack it instead of
	    fiddling with their patch

	Steal debian's nspr.pc patch (other fink packages may look for
	nspr via pkg-config)

	autoreconf generates syntax-error'd configure, so make sure to
	patch configure, not just configure.in

	make sure we get build-dir lib instead of usin local -L path.
	But no external deps, so scrap -I and -L for %p altogether
	instead of tracing and fixing makefile-variable spaghetti.
<<
License: OSI-Approved
Maintainer: Benjamin Reed <nspr@fink.racoonfink.com>
Homepage: http://www.mozilla.org/projects/nspr/
