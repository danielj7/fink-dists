Package: emacs22-carbon
Version: 22.0.50.20051004
Revision: 4
BuildDepends: texinfo (>= 4.1)
Depends: emacsen-common
Provides: emacsen
Conflitcs: emacs22,emacs22-nox,emacs22-gtk
Replaces: emacs22,emacs22-nox,emacs22-gtk
Source: http://ichiro.nnip.org/osx/fink/emacs22-carbon-%v.tar.gz
Source-MD5: f9ff7848b69f5d9b2efaee66f252f1a0
SourceDirectory: emacs
DocFiles: <<
  AUTHORS BUGS COPYING ChangeLog FTP INSTALL INSTALL.CVS MAINTAINERS README
<<
#ConfFiles: %p/var/games/emacs22/snake-scores %p/var/games/emacs22/tetris-scores
AppBundles: Emacs22.app
Description: Flexible real-time text editor, Aqua native

PatchScript: <<
  sed 's|@PREFIX@|%p|g' %a/%n.patch | patch -p1
<<

CompileScript: <<
#!/bin/sh -e

CFLAGS=-DUSE_ATSUI \
./configure --prefix=%p --with-carbon --without-x \
    --infodir='${prefix}/share/info' --mandir='${prefix}/share/man' \
    --libexecdir='${prefix}/lib'
make carbon_appdir=%p/Applications \
     gamedir='${prefix}/var/games/emacs22/' bootstrap
<<

InstallScript: <<
#!/bin/sh -e

# Remove CVS date from version number (%v)
v=`expr "%v" : '\(.*\)\.'`

# Install Everything (except Emacs.app)
make prefix=%i carbon_appdir="" \
     gamedir='${prefix}/var/games/emacs22/' install

# Move some files to avoid conflicts with other emacsen
mv %i/share/man/man1/emacs.1 %i/share/man/man1/emacs.1.emacs22
mv %i/bin/ctags %i/bin/ctags.emacs22
mv %i/share/man/man1/ctags.1 %i/share/man/man1/ctags.1.emacs22
mv %i/bin/emacsclient %i/bin/emacsclient.emacs22
mv %i/share/man/man1/emacsclient.1 %i/share/man/man1/emacsclient.1.emacs22
mv %i/bin/etags %i/bin/etags.emacs22
mv %i/share/man/man1/etags.1 %i/share/man/man1/etags.1.emacs22
mv %i/bin/b2m %i/bin/b2m.emacs22
mv %i/bin/rcs-checkin %i/bin/rcs-checkin.emacs22
mv %i/bin/ebrowse %i/bin/ebrowse.emacs22
mv %i/bin/grep-changelog %i/bin/grep-changelog.emacs22
mkdir -p %i/share/doc/%n
install -m 644 README %i/share/doc/%n/
install -m 644 src/COPYING %i/share/doc/%n/COPYING

# Wrapper script for the command-line invokation
rm %i/bin/emacs
cat <<EOF >%i/bin/emacs-$v
#!/bin/sh
exec -a "%p/Applications/Emacs22.app/Contents/MacOS/Emacs" \\
    "%p/Applications/Emacs22.app/Contents/MacOS/Emacs.bin" "\$@"
EOF
chmod 755 %i/bin/emacs-$v

mkdir -p %i/etc/emacs
mkdir -p %i/etc/emacs22/site-start.d
mkdir -p %i/share/emacs22
mv %i/share/emacs/$v/site-lisp %i/share/emacs22/
(cd %i/share/emacs/$v; ln -s ../../emacs22/site-lisp site-lisp)
(cd %i/bin; chmod 755 emacs-$v; ln -s emacs-$v emacs22)

mv %i/share/info %i/share/emacs-22.info
mkdir -p %i/share/info
mv %i/share/emacs-22.info %i/share/info/emacs-22
rm %i/share/info/emacs-22/dir %i/share/info/emacs-22/dir.old
chmod 755 mangle-info
chmod 755 fix-info
./fix-info %i/share/info/emacs-22

chown -R root:admin %i/share/emacs/$v/etc
chown -R root:admin %i/share/emacs/$v/lisp
chown -R root:admin %i/share/emacs/$v/leim
rm %i/share/emacs/site-lisp/subdirs.el

## Patch Emacs.app to load %p/bin/init.sh
ebd="mac/Emacs.app/Contents/MacOS/"
mv "$ebd/Emacs" "$ebd/Emacs.bin"
cp Emacs.finkwrap "$ebd/Emacs"
chmod +x "$ebd/Emacs"

## Install Emacs22.app as %p/Applications/Emacs22.app
mkdir %i/Applications
#cp -rp mac/Emacs.app %i/Applications/Emacs22.app
cp -rp mac/Emacs.app Emacs22.app
<<

PostInstScript: <<
# Remove CVS date from version number (%v)
v=`expr "%v" : '\(.*\)\.'`

mkdir -p %p/etc/lisp/emacs/$v/site-lisp
mkdir -p %p/etc/lisp/emacs/site-lisp
update-alternatives --install %p/bin/emacs emacs %p/bin/emacs22 50           --slave %p/share/man/man1/emacs.1 emacs.1 %p/share/man/man1/emacs.1.emacs22
update-alternatives --install %p/bin/ctags ctags %p/bin/ctags.emacs22 50     --slave %p/share/man/man1/ctags.1 ctags.1 %p/share/man/man1/ctags.1.emacs22
update-alternatives --install %p/bin/etags etags %p/bin/etags.emacs22 70     --slave %p/share/man/man1/etags.1 etags.1 %p/share/man/man1/etags.1.emacs22
update-alternatives --install %p/bin/emacsclient emacsclient %p/bin/emacsclient.emacs22 50 --slave %p/share/man/man1/emacsclient.1 emacsclient.1 %p/share/man/man1/emacsclient.1.emacs22
update-alternatives --install %p/bin/b2m b2m %p/bin/b2m.emacs22 50
update-alternatives --install %p/bin/rcs-checkin rcs-checkin %p/bin/rcs-checkin.emacs22 50
update-alternatives --install %p/bin/ebrowse ebrowse %p/bin/ebrowse.emacs22 50
update-alternatives --install %p/bin/grep-changelog grep-changelog \
    %p/bin/grep-changelog.emacs22 50

# Regiser ourselves with emacsen-common
%p/lib/emacsen-common/emacs-install emacs22

# Since we're placing our info files in a subdirectory of %p/share/info
# we need to manually add each doc to the info dir-file
for file in ada-mode autotype ccmode cl dired-x ebrowse ediff efaq \
    emacs emacs-mime eshell eudc forms gnus idlwave info message mh-e \
    pcl-cvs reftex sc speedbar vip viper widget woman
do
  install-info --infodir=%p/share/info --section Emacs Emacs %p/share/info/emacs-22/${file}
done

# Make a symlink to /Applications/Fink
#[ -d /Applications/Fink ] || mkdir /Applications/Fink
#[ -L /Applications/Fink/Emacs22.app ] || \
#    ln -s %p/Applications/Emacs22.app /Applications/Fink/
<<

PreRmScript: <<
# Remove the symlink in /Applications/Fink
#[ -L /Applications/Fink/Emacs22.app ] && rm /Applications/Fink/Emacs22.app

# Manually remove all of our info docs from the dir-file
for file in ada-mode autotype ccmode cl dired-x ebrowse ediff efaq \
    emacs emacs-mime eshell eudc forms gnus idlwave info message mh-e \
    pcl-cvs reftex sc speedbar vip viper widget woman
do
  install-info --infodir=%p/share/info --remove-exactly emacs-22/${file}
done

if [ $1 != "upgrade" ]; then
  update-alternatives --remove emacs %p/bin/emacs22
  update-alternatives --remove emacsclient %p/bin/emacsclient.emacs22
  update-alternatives --remove ctags %p/bin/ctags.emacs22
  update-alternatives --remove etags %p/bin/etags.emacs22
  update-alternatives --remove b2m %p/bin/b2m.emacs22
  update-alternatives --remove rcs-checkin %p/bin/rcs-checkin.emacs22
  update-alternatives --remove ebrowse %p/bin/ebrowse.emacs22
  %p/lib/emacsen-common/emacs-remove emacs22
fi
<<

DescDetail: <<
GNU Emacs is an extensible, customizable, self-documenting real-time
display editor. Through its extensibility, it is actually much more
than an editor. You can use it as a file manager, mail reader, web
browser, and for many other tasks. Some people even use it to control
their coffee machine.

This package installs Carbon port of GNU Emacs, which can natively run
on Mac OS X window system.  Also supports input methods for
international languages.

Use -nw option to use this emacs on terminal.
<<

DescPackaging: <<
This .info file is essentially based on the emacs21 package by
Christian Swinehart. Also contains Ben Willmore's suggestions for
general improvements.

You can lauch emacs22 from Finder, as well as terminal using usual
command line syntax. For this purpose, Emacs22.app is placed on
%p/Applications and will be symlinked to /Applications/Fink. To gain a
better integration with the fink environments, it automatically loads
%p/bin/init.sh at startup.

emacs22-carbon (20051004.3)

 * Description field was shortend not to exceed 45 characters.
 * Hardcoded /sw was eliminated from the patch.
 * To prevent conflicts with emacs21, %p/var/games/emacs was moved to
   %p/var/games/emacs22.

 -- NAKAHASHI Ichiro <ichiro@nnip.org>  Thu, 10 Nov 2005 22:28:00 -0900

emacs22-carbon (20051004.2)

 * Now uses AppBundles field instead of PostInst/PreRm scripts.

 -- NAKAHASHI Ichiro <ichiro@nnip.org>  Thu, 10 Nov 2005 22:28:00 -0900

emacs22-carbon (20051004.1)

 * Sync with the latest cvs tree, as of 4 Oct 2005.
 * ATSUI support has been introduced.

 -- NAKAHASHI Ichiro <ichiro@nnip.org>  Tue, 04 Oct 2005 13:54:00 -0900

emacs22-carbon (20050929.1)

 * Based on the emacs CVS code as of 29 Sep 2005.
 * inline_patch dated 12 Sep 2005 from macemacsjp.sourceforge.jp CVS
   tree.

 -- NAKAHASHI Ichiro <ichiro@nnip.org>  Fri, 30 Sep 2005 15:53:00 -0900
<<

License: GPL
Homepage: http://www.gnu.org/software/emacs/emacs.html
Maintainer: NAKAHASHI Ichiro <ichiro@nnip.org>