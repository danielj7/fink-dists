diff -uNbr arts/kde/mcop-dcop/Makefile.am arts/kde/mcop-dcop/Makefile.am
--- arts/kde/mcop-dcop/Makefile.am	Mon Jul  1 14:58:17 2002
+++ arts/kde/mcop-dcop/Makefile.am	Tue Mar 18 18:55:48 2003
@@ -1,16 +1,23 @@
 
 INCLUDES= -I$(includedir)/arts -I$(top_srcdir)/arts/kde $(all_includes)
 
+lib_LTLIBRARIES = libkmcop_main.la kmcop.la
 bin_PROGRAMS = kmcop
-lib_LTLIBRARIES = kmcop.la
 
-kmcop_la_SOURCES = mcopdcopobject.cpp kmcop.cpp kmcop.skel
-kmcop_la_LIBADD	= ../libartskde.la
+libkmcop_main_la_SOURCES = mcopdcopobject.cpp kmcop.cpp kmcop.skel
+libkmcop_main_la_LIBADD  = ../libartskde.la
+libkmcop_main_la_LDFLAGS = $(all_libraries) -version-info 1:0
+
+kmcop_la_SOURCES = kmcop_la_main.cpp
+kmcop_la_LIBADD	= ../libartskde.la libkmcop_main.la
 kmcop_la_LDFLAGS = $(all_libraries) -module -avoid-version
 kmcop_la_METASOURCES = AUTO
 
-kmcop_SOURCES = dummy.cpp
-kmcop_LDADD = kmcop.la
+kmcop_la_main.cpp: kmcop_main.cpp
+	cat kmcop_main.cpp > kmcop_la_main.cpp
+
+kmcop_SOURCES = kmcop_main.cpp
+kmcop_LDADD = libkmcop_main.la
 kmcop_LDFLAGS = $(all_libraries) $(KDE_RPATH)
 
 noinst_HEADERS = kmcop.h
@@ -20,6 +27,3 @@
 
 messages:
 	$(XGETTEXT) kmcop.cpp -o $(podir)/kmcop.pot
-
-dummy.cpp:
-	echo > dummy.cpp
diff -uNbr arts/kde/mcop-dcop/kmcop.cpp arts/kde/mcop-dcop/kmcop.cpp
--- arts/kde/mcop-dcop/kmcop.cpp	Sat Nov 17 04:02:25 2001
+++ arts/kde/mcop-dcop/kmcop.cpp	Tue Mar 18 18:55:48 2003
@@ -46,7 +46,9 @@
 	QPtrList<MCOPDCOPObject> list;
 };
 
-int main(int argc, char **argv)
+extern "C" int kdemain(int, char**);
+
+int kdemain(int argc, char **argv)
 {
     KAboutData aboutdata("kmcop", I18N_NOOP("KMCOP"),
                          "0.1", I18N_NOOP("KDE MCOP-DCOP Bridge"),
diff -uNbr arts/kde/mcop-dcop/kmcop_main.cpp arts/kde/mcop-dcop/kmcop_main.cpp
--- arts/kde/mcop-dcop/kmcop_main.cpp	Wed Dec 31 19:00:00 1969
+++ arts/kde/mcop-dcop/kmcop_main.cpp	Tue Mar 18 18:55:48 2003
@@ -0,0 +1,27 @@
+/*
+ *
+ * Copyright (c) 2001 Nick Hudson <skrll@netbsd.org>
+ *
+ * Permission is hereby granted, free of charge, to any person obtaining a copy
+ * of this software and associated documentation files (the "Software"), to deal
+ * in the Software without restriction, including without limitation the rights
+ * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
+ * copies of the Software, and to permit persons to whom the Software is
+ * furnished to do so, subject to the following conditions:
+ *
+ * The above copyright notice and this permission notice shall be included in
+ * all copies or substantial portions of the Software.
+ *
+ * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
+ * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
+ * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.  IN NO EVENT SHALL THE
+ * AUTHORS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN
+ * AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN
+ * CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
+ */
+extern "C" int kdemain(int, char* []);
+
+int main( int argc, char* argv[] )
+{
+        return kdemain(argc, argv);
+}
diff -uNbr arts/knotify/Makefile.am arts/knotify/Makefile.am
--- arts/knotify/Makefile.am	Sun Sep 15 17:12:54 2002
+++ arts/knotify/Makefile.am	Tue Mar 18 18:55:48 2003
@@ -3,18 +3,29 @@
 
 ####### Files
 
+lib_LTLIBRARIES = libknotify_main.la knotify.la
 bin_PROGRAMS	= knotify
-lib_LTLIBRARIES = knotify.la
 
-knotify_la_SOURCES	= knotify.cpp knotify.skel
-knotify_la_LIBADD	= -lsoundserver_idl -lqtmcop $(LIB_KDEUI)
+libknotify_main_la_SOURCES     = knotify.cpp knotify.skel
+libknotify_main_la_LIBADD      = -lsoundserver_idl -lqtmcop $(LIB_KDEUI) $(LIB_KDECORE) -lmcop -lkmedia2_idl -lartsflow_idl
+libknotify_main_la_LDFLAGS     = $(all_libraries) -avoid-version
+libknotify_main_la_METASOURCES = AUTO
+
+knotify_la_SOURCES     = knotify_la_main.cpp
+knotify_la_LIBADD      = libknotify_main.la
 knotify_la_LDFLAGS = $(all_libraries) -module -avoid-version
 knotify_la_METASOURCES = AUTO
 
-knotify_SOURCES = dummy.cpp
-knotify_LDADD = knotify.la
+knotify_la_main.cpp: stub_main.cpp
+	cat stub_main.cpp > knotify_la_main.cpp
+
+knotify_SOURCES = knotify_main.cpp
+knotify_LDADD = libknotify_main.la
 knotify_LDFLAGS  = $(all_libraries) $(KDE_RPATH)
 
+knotify_main.cpp: stub_main.cpp
+	cat stub_main.cpp > knotify_main.cpp
+
 check_PROGRAMS		= knotifytest
 knotifytest_SOURCES	= knotifytest.cpp
 knotifytest_LDADD	= $(LIB_KDECORE)
@@ -28,5 +39,3 @@
 messages:
 	$(XGETTEXT) knotify.cpp -o $(podir)/knotify.pot
 
-dummy.cpp:
-	echo > dummy.cpp
diff -uNbr arts/knotify/knotify.cpp arts/knotify/knotify.cpp
--- arts/knotify/knotify.cpp	Mon Nov 18 08:19:01 2002
+++ arts/knotify/knotify.cpp	Tue Mar 18 18:55:48 2003
@@ -81,7 +81,9 @@
 };
 
 
-int main(int argc, char **argv)
+extern "C" int kdemain(int, char**);
+
+int kdemain(int argc, char **argv)
 {
     KAboutData aboutdata("knotify", I18N_NOOP("KNotify"),
                          "3.0", I18N_NOOP("KDE Notification Server"),
diff -uNbr arts/knotify/stub_main.cpp arts/knotify/stub_main.cpp
--- arts/knotify/stub_main.cpp	Wed Dec 31 19:00:00 1969
+++ arts/knotify/stub_main.cpp	Tue Mar 18 18:55:48 2003
@@ -0,0 +1,27 @@
+/*
+ *
+ * Copyright (c) 2001 Nick Hudson <skrll@netbsd.org>
+ *
+ * Permission is hereby granted, free of charge, to any person obtaining a copy
+ * of this software and associated documentation files (the "Software"), to deal
+ * in the Software without restriction, including without limitation the rights
+ * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
+ * copies of the Software, and to permit persons to whom the Software is
+ * furnished to do so, subject to the following conditions:
+ *
+ * The above copyright notice and this permission notice shall be included in
+ * all copies or substantial portions of the Software.
+ *
+ * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
+ * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
+ * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.  IN NO EVENT SHALL THE
+ * AUTHORS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN
+ * AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN
+ * CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
+ */
+extern "C" int kdemain(int, char* []);
+
+int main( int argc, char* argv[] )
+{
+	return kdemain(argc, argv);
+}
diff -uNbr configure.in.in configure.in.in
--- configure.in.in	Thu Jan  2 23:56:04 2003
+++ configure.in.in	Tue Mar 18 18:55:48 2003
@@ -191,6 +191,18 @@
 AC_SUBST(LIB_KDEUI, '$(top_builddir)/kdeui/libkdeui.la')
 AC_SUBST(LIB_KIO, '$(top_builddir)/kio/libkio.la')
 AC_SUBST(LIB_KPARTS, '$(top_builddir)/kparts/libkparts.la')
+AC_SUBST(LIB_KFORMULA, '$(top_builddir)/kformula/libkformula.la')
+AC_SUBST(LIB_KSYCOCA, '$(top_builddir)/kio/libkio.la')
+AC_SUBST(LIB_KFILE, '$(top_builddir)/kio/libkio.la')
+AC_SUBST(LIB_KAB, '$(top_builddir)/kab/libkab.la')
+AC_SUBST(LIB_KHTML, '$(top_builddir)/khtml/libkhtml.la')
+AC_SUBST(LIB_DCOP, '$(top_builddir)/dcop/libDCOP.la')
+AC_SUBST(LIB_KDESU, '$(top_builddir)/kdesu/libkdesu.la')
+AC_SUBST(LIB_KDEFX, '$(top_builddir)/kdefx/libkdefx.la')
+AC_SUBST(LIB_KSPELL, '$(top_builddir)/kspell/libkspell.la')
+AC_SUBST(LIB_KDEPRINT, '$(top_builddir)/kdeprint/libkdeprint.la')
+AC_SUBST(LIB_KDED, '$(top_builddir)/kded/libkded.la')
+AC_SUBST(LIB_KDEFAKES, '$(top_builddir)/kdecore/libkdefakes.la')
 
 AC_SUBST(EXTRA_SUBDIRS)
 
diff -uNbr dcop/Makefile.am dcop/Makefile.am
--- dcop/Makefile.am	Sun Sep 15 17:12:54 2002
+++ dcop/Makefile.am	Tue Mar 18 18:55:48 2003
@@ -26,10 +26,10 @@
 
 INCLUDES=  $(all_includes)
 
+lib_LTLIBRARIES  = libDCOP.la libdcopserver_main.la dcopserver.la
 bin_PROGRAMS = dcopserver dcopserver_shutdown
 check_PROGRAMS = testdcop testdcopc
 
-lib_LTLIBRARIES  = libDCOP.la dcopserver.la
 libDCOP_la_LIBADD = KDE-ICE/libkICE.la $(LIB_QT)
 libDCOP_la_LDFLAGS = $(KDE_RPATH) -version-info 5:0:1 -no-undefined $(all_libraries)
 
@@ -45,13 +45,20 @@
 # dcopstub needs to go first for --enable-final to work
 libDCOP_la_SOURCES = dcopstub.cpp dcopref.cpp dcopobject.cpp dcopclient.cpp
 
-dcopserver_la_LDFLAGS = -module -avoid-version $(all_libraries)
-dcopserver_la_SOURCES = dcopserver.cpp dcopsignals.cpp
-dcopserver_la_LIBADD   = libDCOP.la
-
-dcopserver_LDFLAGS = $(KDE_RPATH) $(all_libraries)
-dcopserver_SOURCES = dummy.cpp
-dcopserver_LDADD   = dcopserver.la
+libdcopserver_main_la_LDFLAGS = -avoid-version $(all_libraries)
+libdcopserver_main_la_SOURCES = dcopserver.cpp dcopsignals.cpp
+libdcopserver_main_la_LIBADD  = libDCOP.la
+
+dcopserver_la_LDFLAGS = -avoid-version $(all_libraries) -module
+dcopserver_la_SOURCES = dcopserver_la_main.cpp
+dcopserver_la_LIBADD  = libdcopserver_main.la
+
+dcopserver_la_main.cpp: dcopserver_main.cpp
+	cat dcopserver_main.cpp > dcopserver_la_main.cpp
+
+dcopserver_LDFLAGS = $(KDE_RPATH) $(all_libraries) -module
+dcopserver_SOURCES = dcopserver_main.cpp
+dcopserver_LDADD   = libdcopserver_main.la
 
 dcopserver_shutdown_SOURCES = dcopserver_shutdown.c
 
@@ -64,9 +71,6 @@
 testdcopc_LDADD =  KDE-ICE/libkICE.la $(LIBSM)
 
 EXTRA_DIST = HOWTO ICE
-
-dummy.cpp:
-	echo > dummy.cpp
 
 DOXYGEN_REFERENCES = kdecore
 DOXYGEN_EXCLUDE = KDE-ICE/*
diff -uNbr dcop/dcopserver.cpp dcop/dcopserver.cpp
--- dcop/dcopserver.cpp	Fri Jan  3 17:12:10 2003
+++ dcop/dcopserver.cpp	Tue Mar 18 18:55:48 2003
@@ -1544,7 +1544,9 @@
 "Copyright (C) 1999-2001, The KDE Developers <http://www.kde.org>\n"
 ;
 
-int main( int argc, char* argv[] )
+extern "C" int kdemain(int, char**);
+
+int kdemain( int argc, char* argv[] )
 {
     bool serverid = false;
     bool nofork = false;
diff -uNbr dcop/dcopserver_main.cpp dcop/dcopserver_main.cpp
--- dcop/dcopserver_main.cpp	Wed Dec 31 19:00:00 1969
+++ dcop/dcopserver_main.cpp	Tue Mar 18 18:55:48 2003
@@ -0,0 +1,27 @@
+/*
+ *
+ * Copyright (c) 2001 Nick Hudson <skrll@netbsd.org>
+ *
+ * Permission is hereby granted, free of charge, to any person obtaining a copy
+ * of this software and associated documentation files (the "Software"), to deal
+ * in the Software without restriction, including without limitation the rights
+ * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
+ * copies of the Software, and to permit persons to whom the Software is
+ * furnished to do so, subject to the following conditions:
+ *
+ * The above copyright notice and this permission notice shall be included in
+ * all copies or substantial portions of the Software.
+ *
+ * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
+ * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
+ * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.  IN NO EVENT SHALL THE
+ * AUTHORS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN
+ * AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN
+ * CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
+ */
+extern "C" int kdemain(int, char* []);
+
+int main( int argc, char* argv[] )
+{
+	return kdemain(argc, argv);
+}
diff -uNbr interfaces/kmediaplayer/Makefile.am interfaces/kmediaplayer/Makefile.am
--- interfaces/kmediaplayer/Makefile.am	Wed May 29 17:25:35 2002
+++ interfaces/kmediaplayer/Makefile.am	Tue Mar 18 18:55:49 2003
@@ -3,7 +3,7 @@
 lib_LTLIBRARIES = libkmediaplayer.la
 
 libkmediaplayer_la_SOURCES = player.cpp playerdcopobject.skel view.cpp
-libkmediaplayer_la_LDFLAGS = $(all_libraries) $(KDE_RPATH) -no-undefined
+libkmediaplayer_la_LDFLAGS = $(all_libraries) $(KDE_RPATH) -no-undefined -avoid-version
 libkmediaplayer_la_LIBADD = $(LIB_KPARTS)
 libkmediaplayer_la_METASOURCES = AUTO
 
diff -uNbr interfaces/kscript/Makefile.am interfaces/kscript/Makefile.am
--- interfaces/kscript/Makefile.am	Mon Jul  1 14:58:19 2002
+++ interfaces/kscript/Makefile.am	Tue Mar 18 18:55:49 2003
@@ -9,7 +9,7 @@
 #libkscriptloader_la_LIBADD = $(LIB_KPARTS)
 
 libkscript_la_SOURCES = scriptmanager.cpp
-libkscript_la_LDFLAGS = $(all_libraries) $(KDE_RPATH) -no-undefined
+libkscript_la_LDFLAGS = $(all_libraries) $(KDE_RPATH) -no-undefined -avoid-version
 libkscript_la_LIBADD = $(LIB_KIO)
 
 kscriptinclude_HEADERS = scriptinterface.h scriptclientinterface.h scriptmanager.h
diff -uNbr interfaces/kscript/sample/Makefile.am interfaces/kscript/sample/Makefile.am
--- interfaces/kscript/sample/Makefile.am	Thu Jan 10 11:56:07 2002
+++ interfaces/kscript/sample/Makefile.am	Tue Mar 18 18:55:49 2003
@@ -3,7 +3,7 @@
 lib_LTLIBRARIES = libshellscript.la
 
 libshellscript_la_SOURCES = shellscript.cpp
-libshellscript_la_LDFLAGS = $(all_libraries) $(KDE_RPATH) -no-undefined
+libshellscript_la_LDFLAGS = $(all_libraries) $(KDE_RPATH) -no-undefined -avoid-version
 libshellscript_la_LIBADD = ../libkscript.la
 
 
diff -uNbr interfaces/ktexteditor/Makefile.am interfaces/ktexteditor/Makefile.am
--- interfaces/ktexteditor/Makefile.am	Sun Sep 15 17:12:56 2002
+++ interfaces/ktexteditor/Makefile.am	Tue Mar 18 18:55:49 2003
@@ -21,7 +21,7 @@
     viewstatusmsgdcopinterface.skel selectioninterfaceext.cpp selectionextdcopinterface.skel
     
     
-libktexteditor_la_LDFLAGS = $(all_libraries) $(KDE_RPATH)
+libktexteditor_la_LDFLAGS = $(all_libraries) $(KDE_RPATH) -avoid-version
 libktexteditor_la_LIBADD = $(LIB_KPARTS) $(top_builddir)/dcop/libDCOP.la
 
 ktexteditorinclude_HEADERS = document.h view.h editor.h plugin.h editinterface.h undointerface.h \
diff -uNbr kabc/Makefile.am kabc/Makefile.am
--- kabc/Makefile.am	Mon Nov 18 08:19:01 2002
+++ kabc/Makefile.am	Tue Mar 18 18:55:49 2003
@@ -4,8 +4,8 @@
   -I$(top_srcdir)/kabc -I$(top_srcdir)/kab $(all_includes)
 
 lib_LTLIBRARIES   = libkabc.la
-libkabc_la_LDFLAGS = $(all_libraries) -no-undefined -version-info 2:0:1 -module
-libkabc_la_LIBADD  = vcard/libvcard.la ../kdeui/libkdeui.la ../kio/libkio.la
+libkabc_la_LDFLAGS = $(all_libraries) -no-undefined -version-info 2:0:1
+libkabc_la_LIBADD  = $(top_builddir)/kabc/vcard/libvcard.la $(top_builddir)/kdeui/libkdeui.la $(top_builddir)/kio/libkio.la
 
 libkabc_la_SOURCES = \
   address.cpp addressbook.cpp addressee.cpp addresseedialog.cpp agent.cpp \
diff -uNbr kabc/plugins/ldap/configure.in.in kabc/plugins/ldap/configure.in.in
--- kabc/plugins/ldap/configure.in.in	Mon Jan 13 18:48:47 2003
+++ kabc/plugins/ldap/configure.in.in	Tue Mar 18 18:55:49 2003
@@ -19,7 +19,7 @@
   fi
   if test $with_ldap = FOUND ; then
     with_ldap=NOTFOUND
-    for ext in la so sl a ; do
+    for ext in la so sl a dylib; do
       AC_FIND_FILE(libldap.$ext, $kde_libraries /usr/lib /usr/local/lib,
         ldap_libdir)
       if test -r $ldap_libdir/libldap.$ext ; then
@@ -38,6 +38,12 @@
 case "$with_ldap" in
 no) AC_MSG_RESULT(no) ;;
 NOTFOUND) AC_MSG_RESULT(searched but not found) ;;
+framework)
+  LDAP_LIBS="-framework LDAP"
+  AC_DEFINE_UNQUOTED(HAVE_LIBLDAP, 1, [Define if you have LDAP libraries])
+  LDAP_SUBDIR="ldap"
+  AC_MSG_RESULT(Apple framework)
+  ;;
 *)
   if test "x$with_ldap" = "xFOUND" ; then
     msg="incs=$ldap_incdir libs=$ldap_libdir"
diff -uNbr kabc/vcard/Makefile.am kabc/vcard/Makefile.am
--- kabc/vcard/Makefile.am	Mon Jul  1 14:58:20 2002
+++ kabc/vcard/Makefile.am	Tue Mar 18 18:55:49 2003
@@ -7,6 +7,7 @@
 
 libvcard_la_SOURCES = vCard-all.cpp
 libvcard_la_LIBADD = $(LIB_KDECORE)
+libvcard_la_LDFLAGS = -avoid-version
 
 check_PROGRAMS = testwrite testread
 
diff -uNbr kate/interfaces/Makefile.am kate/interfaces/Makefile.am
--- kate/interfaces/Makefile.am	Mon Jul  1 14:58:21 2002
+++ kate/interfaces/Makefile.am	Tue Mar 18 18:55:49 2003
@@ -4,7 +4,7 @@
 
 libkatepartinterfaces_la_SOURCES = interfaces.cpp
 libkatepartinterfaces_la_LIBADD   = $(top_builddir)/interfaces/ktexteditor/libktexteditor.la
-libkatepartinterfaces_la_LDFLAGS = $(all_libraries) $(KDE_RPATH) -no-undefined
+libkatepartinterfaces_la_LDFLAGS = $(all_libraries) $(KDE_RPATH) -no-undefined -avoid-version
 
 kateinclude_HEADERS = document.h view.h
 kateincludedir = $(includedir)/kate
diff -uNbr kcert/Makefile.am kcert/Makefile.am
--- kcert/Makefile.am	Thu Jan  2 23:56:44 2003
+++ kcert/Makefile.am	Tue Mar 18 18:56:09 2003
@@ -1,4 +1,4 @@
-INCLUDES= $(SSL_INCLUDES) -I$(top_srcdir)/kio/kssl -I$(top_builddir)/kio/kssl -I$(top_srcdir) $(all_includes)
+INCLUDES= -I$(top_srcdir)/kio/kssl -I$(top_builddir)/kio/kssl -I$(top_srcdir) $(all_includes) $(SSL_INCLUDES)
 
 lib_LTLIBRARIES = libkcertpart.la
 KCERTPARTVERSION=	2.2.0
diff -uNbr kconf_update/Makefile.am kconf_update/Makefile.am
--- kconf_update/Makefile.am	Sun Sep 15 17:13:02 2002
+++ kconf_update/Makefile.am	Tue Mar 18 18:55:49 2003
@@ -18,22 +18,26 @@
 
 INCLUDES= $(all_includes)
 
-lib_LTLIBRARIES = kconf_update.la
-
+lib_LTLIBRARIES = libkconf_update_main.la kconf_update.la
 bin_PROGRAMS = kconf_update
-kconf_update_SOURCES = dummy.cpp
-kconf_update_LDADD = kconf_update.la
-kconf_update_LDFLAGS = $(KDE_RPATH) $(all_libraries)
 
-kconf_update_la_SOURCES = kconf_update.cpp
-kconf_update_la_LIBADD = ../kdecore/libkdecore.la
-kconf_update_la_LDFLAGS = $(all_libraries) -module -avoid-version
+libkconf_update_main_la_SOURCES = kconf_update.cpp
+libkconf_update_main_la_LIBADD = ../kdecore/libkdecore.la
+libkconf_update_main_la_LDFLAGS = $(all_libraries) -avoid-version
+
+kconf_update_la_SOURCES = kconf_update_la_main.cpp
+kconf_update_la_LIBADD = libkconf_update_main.la
+kconf_update_la_LDFLAGS = $(all_libraries) -avoid-version -module
+
+kconf_update_la_main.cpp: kconf_update_main.cpp
+	cat kconf_update_main.cpp > kconf_update_la_main.cpp
+
+kconf_update_SOURCES = kconf_update_main.cpp
+kconf_update_LDADD = libkconf_update_main.la
+kconf_update_LDFLAGS = $(KDE_RPATH) $(all_libraries)
 
 METASOURCES = AUTO
 
 # Internal
 # noinst_HEADERS = kconf_update.h
-
-dummy.cpp: 
-	echo > dummy.cpp
 
diff -uNbr kconf_update/kconf_update.cpp kconf_update/kconf_update.cpp
--- kconf_update/kconf_update.cpp	Mon Nov 11 07:39:06 2002
+++ kconf_update/kconf_update.cpp	Tue Mar 18 18:55:49 2003
@@ -779,7 +779,9 @@
 }
 
 
-int main(int argc, char **argv)
+extern "C" int kdemain(int, char**);
+
+int kdemain(int argc, char **argv)
 {
    KAboutData aboutData("kconf_update", I18N_NOOP("KConf Update"),
                         "1.0.2",
diff -uNbr kconf_update/kconf_update_main.cpp kconf_update/kconf_update_main.cpp
--- kconf_update/kconf_update_main.cpp	Wed Dec 31 19:00:00 1969
+++ kconf_update/kconf_update_main.cpp	Tue Mar 18 18:55:49 2003
@@ -0,0 +1,27 @@
+/*
+ *
+ * Copyright (c) 2001 Nick Hudson <skrll@netbsd.org>
+ *
+ * Permission is hereby granted, free of charge, to any person obtaining a copy
+ * of this software and associated documentation files (the "Software"), to deal
+ * in the Software without restriction, including without limitation the rights
+ * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
+ * copies of the Software, and to permit persons to whom the Software is
+ * furnished to do so, subject to the following conditions:
+ *
+ * The above copyright notice and this permission notice shall be included in
+ * all copies or substantial portions of the Software.
+ *
+ * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
+ * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
+ * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.  IN NO EVENT SHALL THE
+ * AUTHORS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN
+ * AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN
+ * CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
+ */
+extern "C" int kdemain(int, char* []);
+
+int main( int argc, char* argv[] )
+{
+        return kdemain(argc, argv);
+}
diff -uNbr kdecore/Makefile.am kdecore/Makefile.am
--- kdecore/Makefile.am	Mon Nov 18 08:19:02 2002
+++ kdecore/Makefile.am	Tue Mar 18 18:55:49 2003
@@ -1,6 +1,6 @@
 #    This file is part of the KDE libraries
 #
-#    $Id: Makefile.am,v 1.303 2002/11/14 08:46:24 hausmann Exp $
+#    $Id: Makefile.am,v 1.302 2002/10/26 14:32:21 gallium Exp $
 #
 #    Copyright (C) 1996-1997 Matthias Kalle Dalheimer (kalle@kde.org)
 #			  (C) 1997 Stephan Kulow (coolo@kde.org)
diff -uNbr kdecore/fakes.c kdecore/fakes.c
--- kdecore/fakes.c	Thu Jan  2 23:56:46 2003
+++ kdecore/fakes.c	Tue Mar 18 18:55:49 2003
@@ -19,6 +19,7 @@
    Boston, MA 02111-1307, USA.
 */
 
+#include <sys/types.h>
 #include <config.h>
 
 #ifndef HAVE_SETENV
@@ -137,7 +138,7 @@
 #include <errno.h>
 #include <stdio.h>
 
-int getdomainname(char *name, size_t len)
+int getdomainname(char *name, unsigned int len)
 {
         struct utsname uts;
         struct hostent *hent;
diff -uNbr kdecore/kglobalsettings.cpp kdecore/kglobalsettings.cpp
--- kdecore/kglobalsettings.cpp	Mon Oct 28 14:37:49 2002
+++ kdecore/kglobalsettings.cpp	Tue Mar 18 18:55:49 2003
@@ -455,7 +455,7 @@
         *s_desktopPath += "/";
 
     // Trash Path
-    *s_trashPath = *s_desktopPath + i18n("Trash") + "/";
+    *s_trashPath = *s_desktopPath + "." + i18n("Trash") + "/";
     *s_trashPath = config->readEntry( "Trash" , *s_trashPath);
     if ( (*s_trashPath)[0] != '/' )
       s_trashPath->prepend( QDir::homeDirPath() + "/" );
diff -uNbr kdecore/kiconloader.cpp kdecore/kiconloader.cpp
--- kdecore/kiconloader.cpp	Mon Jan 13 18:49:07 2003
+++ kdecore/kiconloader.cpp	Tue Mar 18 18:55:49 2003
@@ -457,7 +457,7 @@
     return icon;
 }
 
-inline QString KIconLoader::unknownIconPath( int size ) const
+QString KIconLoader::unknownIconPath( int size ) const
 {
     static const QString &str_unknown = KGlobal::staticQString("unknown");
 
diff -uNbr kdecore/klibloader.cpp kdecore/klibloader.cpp
--- kdecore/klibloader.cpp	Mon Jul  1 14:58:24 2002
+++ kdecore/klibloader.cpp	Tue Mar 18 18:55:49 2003
@@ -366,13 +366,8 @@
     else
     {
       libfile = instance->dirs()->findResource( "module", libname );
-      if ( libfile.isEmpty() )
-      {
+      if ( libfile.isEmpty() ) {
         libfile = instance->dirs()->findResource( "lib", libname );
-#ifndef NDEBUG
-        if ( !libfile.isEmpty() && libname.left(3) == "lib" ) // don't warn for kdeinit modules
-          kdDebug(150) << "library " << libname << " not found under 'module' but under 'lib'" << endl;
-#endif
       }
       if ( libfile.isEmpty() )
       {
diff -uNbr kded/Makefile.am kded/Makefile.am
--- kded/Makefile.am	Sun Sep 15 17:13:07 2002
+++ kded/Makefile.am	Tue Mar 18 18:55:49 2003
@@ -19,32 +19,46 @@
 
 INCLUDES= -I$(srcdir)/.. -I$(top_srcdir) $(all_includes)
 
-lib_LTLIBRARIES = kded.la kbuildsycoca.la
+lib_LTLIBRARIES = libkded_main.la kded.la libkbuildsycoca_main.la kbuildsycoca.la
 
-kded_la_LDFLAGS = $(all_libraries) -module -avoid-version
-kded_la_LIBADD = $(LIB_KIO)
-kded_la_SOURCES = kded.cpp kbuildservicetypefactory.cpp \
+libkded_main_la_LDFLAGS = $(all_libraries) -avoid-version
+libkded_main_la_LIBADD = $(LIB_KIO)
+libkded_main_la_SOURCES = kded.cpp kbuildservicetypefactory.cpp \
 			kbuildservicefactory.cpp \
 			kbuildservicegroupfactory.cpp kdedmodule.cpp
 
-kbuildsycoca_la_LDFLAGS = $(all_libraries) -module -avoid-version
-kbuildsycoca_la_LIBADD = $(LIB_KIO)
-kbuildsycoca_la_SOURCES = kbuildsycoca.cpp kbuildservicetypefactory.cpp \
+kded_la_LDFLAGS = $(all_libraries) -module -avoid-version
+kded_la_LIBADD  = libkded_main.la
+kded_la_SOURCES = kded_la_main.cpp
+
+kded_la_main.cpp: kded_main.cpp
+	cat kded_main.cpp > kded_la_main.cpp
+
+libkbuildsycoca_main_la_LDFLAGS = $(all_libraries) -avoid-version
+libkbuildsycoca_main_la_LIBADD = $(LIB_KIO)
+libkbuildsycoca_main_la_SOURCES = kbuildsycoca.cpp kbuildservicetypefactory.cpp \
 				kbuildservicefactory.cpp \
 				kbuildservicegroupfactory.cpp \
 				kbuildimageiofactory.cpp \
 				kbuildprotocolinfofactory.cpp \
 				kctimefactory.cpp
 
+kbuildsycoca_la_LDFLAGS = $(all_libraries) -module -avoid-version
+kbuildsycoca_la_LIBADD  = libkbuildsycoca_main.la
+kbuildsycoca_la_SOURCES = kbuildsycoca_la_main.cpp
+
+kbuildsycoca_la_main.cpp: kbuildsycoca_main.cpp
+	cat kbuildsycoca_main.cpp > kbuildsycoca_la_main.cpp
+
 bin_PROGRAMS = kded kbuildsycoca kdontchangethehostname
 
 kded_LDFLAGS = $(all_libraries) $(KDE_RPATH)
-kded_LDADD = kded.la
-kded_SOURCES = dummy.cpp
+kded_LDADD   = libkded_main.la
+kded_SOURCES = kded_main.cpp
 
 kbuildsycoca_LDFLAGS = $(all_libraries) $(KDE_RPATH)
-kbuildsycoca_LDADD = kbuildsycoca.la
-kbuildsycoca_SOURCES = dummy.cpp
+kbuildsycoca_LDADD = libkbuildsycoca_main.la
+kbuildsycoca_SOURCES = kbuildsycoca_main.cpp
 
 kdontchangethehostname_LDFLAGS = $(all_libraries) $(KDE_RPATH)
 kdontchangethehostname_LDADD = $(LIB_KDECORE) 
@@ -64,6 +78,3 @@
 
 update_DATA = kded.upd
 updatedir = $(kde_datadir)/kconf_update
-
-dummy.cpp:
-	echo > dummy.cpp
diff -uNbr kded/kbuildsycoca.cpp kded/kbuildsycoca.cpp
--- kded/kbuildsycoca.cpp	Sun Sep 15 17:13:07 2002
+++ kded/kbuildsycoca.cpp	Tue Mar 18 18:55:49 2003
@@ -502,7 +502,9 @@
 static const char *appName = "kbuildsycoca";
 static const char *appVersion = "1.0";
 
-int main(int argc, char **argv)
+extern "C" int kdemain(int, char**);
+
+int kdemain(int argc, char **argv)
 {
    KLocale::setMainCatalogue("kdelibs");
    KAboutData d(appName, I18N_NOOP("KBuildSycoca"), appVersion,
diff -uNbr kded/kbuildsycoca_main.cpp kded/kbuildsycoca_main.cpp
--- kded/kbuildsycoca_main.cpp	Wed Dec 31 19:00:00 1969
+++ kded/kbuildsycoca_main.cpp	Tue Mar 18 18:55:49 2003
@@ -0,0 +1,27 @@
+/*
+ *
+ * Copyright (c) 2001 Nick Hudson <skrll@netbsd.org>
+ *
+ * Permission is hereby granted, free of charge, to any person obtaining a copy
+ * of this software and associated documentation files (the "Software"), to deal
+ * in the Software without restriction, including without limitation the rights
+ * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
+ * copies of the Software, and to permit persons to whom the Software is
+ * furnished to do so, subject to the following conditions:
+ *
+ * The above copyright notice and this permission notice shall be included in
+ * all copies or substantial portions of the Software.
+ *
+ * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
+ * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
+ * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.  IN NO EVENT SHALL THE
+ * AUTHORS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN
+ * AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN
+ * CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
+ */
+extern "C" int kdemain(int, char* []);
+
+int main( int argc, char* argv[] )
+{
+        return kdemain(argc, argv);
+}
diff -uNbr kded/kded.cpp kded/kded.cpp
--- kded/kded.cpp	Sun Sep 15 17:13:07 2002
+++ kded/kded.cpp	Tue Mar 18 18:55:49 2003
@@ -653,7 +653,9 @@
   bool startup;
 };
 
-int main(int argc, char *argv[])
+extern "C" int kdemain(int, char**);
+
+int kdemain(int argc, char **argv)
 {
      KAboutData aboutData( "kded", I18N_NOOP("KDE Daemon"),
         "$Id: kded.cpp,v 1.75 2002/08/04 21:45:31 danimo Exp $",
diff -uNbr kded/kded_main.cpp kded/kded_main.cpp
--- kded/kded_main.cpp	Wed Dec 31 19:00:00 1969
+++ kded/kded_main.cpp	Tue Mar 18 18:55:49 2003
@@ -0,0 +1,27 @@
+/*
+ *
+ * Copyright (c) 2001 Nick Hudson <skrll@netbsd.org>
+ *
+ * Permission is hereby granted, free of charge, to any person obtaining a copy
+ * of this software and associated documentation files (the "Software"), to deal
+ * in the Software without restriction, including without limitation the rights
+ * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
+ * copies of the Software, and to permit persons to whom the Software is
+ * furnished to do so, subject to the following conditions:
+ *
+ * The above copyright notice and this permission notice shall be included in
+ * all copies or substantial portions of the Software.
+ *
+ * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
+ * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
+ * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.  IN NO EVENT SHALL THE
+ * AUTHORS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN
+ * AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN
+ * CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
+ */
+extern "C" int kdemain(int, char* []);
+
+int main( int argc, char* argv[] )
+{
+        return kdemain(argc, argv);
+}
diff -uNbr kdeprint/Makefile.am kdeprint/Makefile.am
--- kdeprint/Makefile.am	Sun Sep 15 17:13:07 2002
+++ kdeprint/Makefile.am	Tue Mar 18 18:55:49 2003
@@ -10,9 +10,8 @@
 kde_module_LTLIBRARIES = kded_kdeprintd.la
 
 kded_kdeprintd_la_SOURCES = kdeprintd.skel kdeprintd.cpp kprintprocess.cpp
-kded_kdeprintd_la_LIBADD = $(LIB_KIO)
+kded_kdeprintd_la_LIBADD = $(LIB_KIO) $(top_builddir)/kded/libkded_main.la
 kded_kdeprintd_la_LDFLAGS = $(all_libraries) -module -avoid-version
-#kded_kdeprintd_la_METASOURCES = AUTO
 
 lib_LTLIBRARIES = libkdeprint.la
 
diff -uNbr kdeprint/cups/cupsdconf2/Makefile.am kdeprint/cups/cupsdconf2/Makefile.am
--- kdeprint/cups/cupsdconf2/Makefile.am	Sun Sep 15 17:13:08 2002
+++ kdeprint/cups/cupsdconf2/Makefile.am	Tue Mar 18 18:55:49 2003
@@ -3,22 +3,32 @@
 INCLUDES= -I$(top_srcdir) -I$(top_srcdir)/kio -I$(top_srcdir)/kfile $(all_includes)
 
 bin_PROGRAMS = cupsdconf
-cupsdconf_SOURCES = main.cpp
 
-cupsdconf_LDADD   =  libcupsdconf.la
+cupsdconf_SOURCES = cupsdconf_main.cpp
+cupsdconf_LDADD   = libcupsdconf_main.la
 cupsdconf_LDFLAGS = $(all_libraries) $(KDE_RPATH)
 
+cupsdconf_main.cpp: stub_main.cpp
+	cat stub_main.cpp > cupsdconf_main.cpp
+
 # library creation
-lib_LTLIBRARIES = libcupsdconf.la
-libcupsdconf_la_SOURCES = cupsdconf.cpp cupsddialog.cpp cupsdpage.cpp cupsdcomment.cpp cupsdsplash.cpp \
+lib_LTLIBRARIES = libcupsdconf_main.la cupsdconf.la
+libcupsdconf_main_la_SOURCES = cupsdconf.cpp cupsddialog.cpp cupsdpage.cpp cupsdcomment.cpp cupsdsplash.cpp \
 			  cupsdserverpage.cpp cupsdlogpage.cpp cupsdjobspage.cpp cupsdfilterpage.cpp \
 			  qdirlineedit.cpp cupsddirpage.cpp portdialog.cpp cupsdnetworkpage.cpp \
 			  editlist.cpp cupsdbrowsingpage.cpp browsedialog.cpp cupsdsecuritypage.cpp \
 			  locationdialog.cpp addressdialog.cpp cups-util.c \
-			  qdirmultilineedit.cpp sizewidget.cpp
-libcupsdconf_la_METASOURCES = AUTO
-libcupsdconf_la_LDFLAGS = $(all_libraries) -module -avoid-version -no-undefined
-libcupsdconf_la_LIBADD = $(LIB_KIO) $(LIB_CUPS)
+			  qdirmultilineedit.cpp sizewidget.cpp main.cpp
+libcupsdconf_main_la_METASOURCES = AUTO
+libcupsdconf_main_la_LDFLAGS = $(all_libraries) -avoid-version
+libcupsdconf_main_la_LIBADD = $(LIB_KIO) $(LIB_CUPS)
+
+cupsdconf_la_SOURCES = cupsdconf_la_main.cpp
+cupsdconf_la_LDFLAGS = $(all_libraries) -avoid-version -module $(KDE_RPATH)
+cupsdconf_la_LIBADD  = libcupsdconf_main.la
+
+cupsdconf_la_main.cpp: stub_main.cpp
+	cat stub_main.cpp > cupsdconf_la_main.cpp
 
 noinst_HEADERS = cupsdconf.h cupsdpage.h cupsddialog.h cupsdcomment.h cupsdsplash.h \
 		 cupsdserverpage.h cupsdlogpage.h cupsdjobspage.h cupsdfilterpage.h \
diff -uNbr kdeprint/cups/cupsdconf2/main.cpp kdeprint/cups/cupsdconf2/main.cpp
--- kdeprint/cups/cupsdconf2/main.cpp	Wed Oct 10 13:40:38 2001
+++ kdeprint/cups/cupsdconf2/main.cpp	Tue Mar 18 18:55:49 2003
@@ -30,7 +30,9 @@
 	{ 0, 0, 0}
 };
 
-int main(int argc, char *argv[])
+extern "C" int kdemain(int, char**);
+
+int kdemain(int argc, char **argv)
 {
 	KCmdLineArgs::init(argc,argv,"cupsdconf",I18N_NOOP("A CUPS configuration tool"),"0.0.1");
 	KCmdLineArgs::addCmdLineOptions(options);
diff -uNbr kdeprint/cups/cupsdconf2/stub_main.cpp kdeprint/cups/cupsdconf2/stub_main.cpp
--- kdeprint/cups/cupsdconf2/stub_main.cpp	Wed Dec 31 19:00:00 1969
+++ kdeprint/cups/cupsdconf2/stub_main.cpp	Tue Mar 18 18:55:49 2003
@@ -0,0 +1,28 @@
+/*
+ *
+ * Copyright (c) 2001 Nick Hudson <skrll@netbsd.org>
+ *
+ * Permission is hereby granted, free of charge, to any person obtaining a copy
+ * of this software and associated documentation files (the "Software"), to deal
+ * in the Software without restriction, including without limitation the rights
+ * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
+ * copies of the Software, and to permit persons to whom the Software is
+ * furnished to do so, subject to the following conditions:
+ *
+ * The above copyright notice and this permission notice shall be included in
+ * all copies or substantial portions of the Software.
+ *
+ * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
+ * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
+ * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.  IN NO EVENT SHALL THE
+ * AUTHORS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN
+ * AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN
+ * CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
+ */
+extern "C" int kdemain(int, char* []);
+
+int main( int argc, char* argv[] )
+{
+        return kdemain(argc, argv);
+}
+
diff -uNbr kdeprint/management/Makefile.am kdeprint/management/Makefile.am
--- kdeprint/management/Makefile.am	Sun Sep 15 17:13:12 2002
+++ kdeprint/management/Makefile.am	Tue Mar 18 18:55:49 2003
@@ -3,13 +3,16 @@
 lib_LTLIBRARIES = libkdeprint_management.la kaddprinterwizard.la
 bin_PROGRAMS = kaddprinterwizard
 
-kaddprinterwizard_SOURCES = dummy.cpp
-kaddprinterwizard_LDADD = kaddprinterwizard.la
+kaddprinterwizard_SOURCES = kaddprinterwizard_main.cpp
+kaddprinterwizard_LDADD = libkdeprint_management.la
 kaddprinterwizard_LDFLAGS = $(all_libraries) $(KDE_RPATH)
 
+kaddprinterwizard_main.cpp: kaddprinterwizard.cpp
+	cat kaddprinterwizard.cpp > kaddprinterwizard_main.cpp
+
 kaddprinterwizard_la_SOURCES = kaddprinterwizard.cpp
 kaddprinterwizard_la_LIBADD = libkdeprint_management.la
-kaddprinterwizard_la_LDFLAGS = -module -avoid-version $(all_libraries) $(KDE_RPATH)
+kaddprinterwizard_la_LDFLAGS = -avoid-version $(all_libraries) $(KDE_RPATH) -module
 
 libkdeprint_management_la_SOURCES = \
 	kmdbcreator.cpp kmdriverdb.cpp kmdriverdbwidget.cpp \
@@ -45,7 +48,4 @@
 
 dataicon_DATA = tileup.png tiledown.png side.png
 dataicondir = $(kde_datadir)/kdeprint
-
-dummy.cpp:
-	echo > dummy.cpp
 
diff -uNbr kdeui/kedittoolbar.cpp kdeui/kedittoolbar.cpp
--- kdeui/kedittoolbar.cpp	Fri Dec  6 09:45:38 2002
+++ kdeui/kedittoolbar.cpp	Tue Mar 18 18:55:49 2003
@@ -142,13 +142,13 @@
    */
   ToolbarList findToolbars(QDomElement elem)
   {
-    static const QString &tagToolbar = KGlobal::staticQString( "ToolBar" );
-    static const QString &attrNoEdit = KGlobal::staticQString( "noEdit" );
+    // static const QString &tagToolbar = KGlobal::staticQString( "ToolBar" );
+    // static const QString &attrNoEdit = KGlobal::staticQString( "noEdit" );
     ToolbarList list;
 
     for( ; !elem.isNull(); elem = elem.nextSibling().toElement() )
     {
-      if (elem.tagName() == tagToolbar && elem.attribute( attrNoEdit ) != "true" )
+      if (elem.tagName() == KGlobal::staticQString( "ToolBar" ) && elem.attribute( KGlobal::staticQString( "noEdit" ) ) != "true" )
         list.append(elem);
 
       QDomElement child = elem.firstChild().toElement();
diff -uNbr kdeui/kxmlguifactory.cpp kdeui/kxmlguifactory.cpp
--- kdeui/kxmlguifactory.cpp	Sat Sep 21 12:56:13 2002
+++ kdeui/kxmlguifactory.cpp	Tue Mar 18 18:55:49 2003
@@ -49,14 +49,10 @@
 public:
     KXMLGUIFactoryPrivate()
     {
-        static const QString &defaultMergingName = KGlobal::staticQString( "<default>" );
-        static const QString &actionList = KGlobal::staticQString( "actionlist" );
-        static const QString &name = KGlobal::staticQString( "name" );
-
         m_rootNode = new ContainerNode( 0L, QString::null, 0L );
-        m_defaultMergingName = defaultMergingName;
-        tagActionList = actionList;
-        attrName = name;
+        m_defaultMergingName = KGlobal::staticQString( "<default>" );
+        tagActionList = KGlobal::staticQString( "actionlist" );
+        attrName = KGlobal::staticQString( "name" );
     }
     ~KXMLGUIFactoryPrivate()
     {
diff -uNbr khtml/Makefile.am khtml/Makefile.am
--- khtml/Makefile.am	Thu Jan  2 23:58:07 2003
+++ khtml/Makefile.am	Tue Mar 18 18:55:49 2003
@@ -26,8 +26,8 @@
 
 SUBDIRS = misc dom css xml html rendering pics $(JAVA_SUBDIR) . ecma kmultipart
 
-lib_LTLIBRARIES = libkhtml.la
-kde_module_LTLIBRARIES = khtmlimagepart.la
+lib_LTLIBRARIES = libkhtml.la khtml.la
+kde_module_LTLIBRARIES = libkhtmlimagepart_main.la khtmlimagepart.la
 
 libkhtml_la_SOURCES = khtmlview.cpp khtml_part.cpp khtml_run.cpp khtml_factory.cpp khtml_settings.cc \
 		      khtml_events.cpp khtml_ext.cpp khtml_pagecache.cpp khtml_iface.skel khtml_iface.cc \
@@ -40,7 +40,7 @@
 noinst_HEADERS = design.h testkhtml.h testrender.h test_regression.h khtml_ext.h \
 		 khtml_pagecache.h khtmlimage.h khtmlpart_p.h khtml_printsettings.h
 
-libkhtml_la_LDFLAGS = -version-info 5:0:1 -module -no-undefined $(all_libraries)
+libkhtml_la_LDFLAGS = -version-info 5:0:1 -no-undefined $(all_libraries)
 libkhtml_la_LIBADD = ./xml/libkhtmlxml.la ./html/libkhtmlhtml.la \
 	./rendering/libkhtmlrender.la ./css/libkhtmlcss.la \
 	./misc/libkhtmlmisc.la ./dom/libkhtmldom.la $(LIBKJAVA) \
@@ -49,9 +49,23 @@
 	$(top_builddir)/kdeprint/libkdeprint.la  \
 	$(top_builddir)/kutils/libkutils.la 
 
-khtmlimagepart_la_SOURCES = khtmlimage.cpp
+khtml_la_LDFLAGS = -avoid-version -no-undefined $(all_libraries) -module
+khtml_la_LIBADD  = libkhtml.la
+khtml_la_SOURCES = dummy.cpp
+
+dummy.cpp:
+	echo > dummy.cpp
+
+libkhtmlimagepart_main_la_SOURCES = khtmlimage.cpp
+libkhtmlimagepart_main_la_LDFLAGS = $(KDE_RPATH) $(all_libraries) -avoid-version
+libkhtmlimagepart_main_la_LIBADD  = $(LIB_QT) $(LIB_KDEUI) $(LIB_KDECORE) $(LIB_KPARTS) libkhtml.la
+
+khtmlimagepart_la_SOURCES = khtmlimagepart_dummy.cpp
 khtmlimagepart_la_LDFLAGS = -module $(KDE_PLUGIN) $(all_libraries)
-khtmlimagepart_la_LIBADD = libkhtml.la
+khtmlimagepart_la_LIBADD  = $(LIB_QT) $(LIB_KDEUI) $(LIB_KDECORE) $(LIB_KPARTS) libkhtml.la
+
+khtmlimagepart_dummy.cpp:
+	echo > khtmlimagepart_dummy.cpp
 
 INCLUDES = -I$(top_srcdir)/kjs -I$(top_srcdir)/kimgio \
 	-I$(srcdir)/java -I$(top_srcdir)/dcop -I$(srcdir)/misc \
diff -uNbr kimgio/Makefile.am kimgio/Makefile.am
--- kimgio/Makefile.am	Thu Jan  2 23:58:28 2003
+++ kimgio/Makefile.am	Tue Mar 18 18:55:49 2003
@@ -7,7 +7,7 @@
 kde_module_LTLIBRARIES= kimg_eps.la kimg_xview.la kimg_krl.la \
 	         $(KIMGIO_TIFF_MODULES) kimg_ico.la
 
-KIMGIO_PLUGIN = -avoid-version -export-symbols-regex 'kimgio_.*_(read|write)'
+KIMGIO_PLUGIN = -avoid-version -export-symbols-regex 'kimgio_.*_(read|write)' $(all_libraries) $(LIB_KDECORE) $(LIB_QT)
 
 kimg_tiff_la_SOURCES = tiffr.cpp
 kimg_tiff_la_LDFLAGS = -module $(KIMGIO_PLUGIN) -no-undefined $(all_libraries)
diff -uNbr kinit/Makefile.am kinit/Makefile.am
--- kinit/Makefile.am	Sun Sep 15 17:13:34 2002
+++ kinit/Makefile.am	Tue Mar 18 18:55:49 2003
@@ -20,7 +20,7 @@
 SUBDIRS = . tests
 
 bin_PROGRAMS = kdeinit kdeinit_wrapper kshell kdeinit_shutdown lnusertemp kwrapper klauncher kioslave
-lib_LTLIBRARIES = klauncher.la
+lib_LTLIBRARIES = klauncher.la libklauncher_main.la
 
 kdeinit_SOURCES = kinit.cpp setproctitle.cpp
 
@@ -49,13 +49,20 @@
 kwrapper_SOURCES = kwrapper.c
 kwrapper_LDADD = $(LIBSOCKET)
 
-klauncher_la_LDFLAGS = $(all_libraries) -module -avoid-version
-klauncher_la_LIBADD = $(LIB_KIO)
-klauncher_la_SOURCES = klauncher.cpp klauncher_main.cpp autostart.cpp
+libklauncher_main_la_LDFLAGS = $(all_libraries) -avoid-version
+libklauncher_main_la_LIBADD = $(LIB_KIO)
+libklauncher_main_la_SOURCES = klauncher.cpp autostart.cpp
+
+klauncher_la_LDFLAGS = $(all_libraries) -avoid-version -module
+klauncher_la_LIBADD = $(LIB_KIO) libklauncher_main.la
+klauncher_la_SOURCES = klauncher_la_main.cpp
+
+klauncher_la_main.cpp: klauncher_main.cpp
+	cat klauncher_main.cpp > klauncher_la_main.cpp
 
 klauncher_LDFLAGS =  $(all_libraries) $(KDE_RPATH)
-klauncher_LDADD = klauncher.la
-klauncher_SOURCES = dummy.cpp
+klauncher_LDADD = libklauncher_main.la
+klauncher_SOURCES = klauncher_main.cpp
 
 METASOURCES = AUTO
 
@@ -64,6 +71,3 @@
 kwrapper.o: wrapper.c
 
 shell.o: wrapper.c
-
-dummy.cpp:
-	echo > dummy.cpp
diff -uNbr kinit/kinit.cpp kinit/kinit.cpp
--- kinit/kinit.cpp	Mon Jan 13 18:51:57 2003
+++ kinit/kinit.cpp	Tue Mar 18 18:55:49 2003
@@ -1430,6 +1430,7 @@
    kdeinit_setproctitle("Starting up...");
    kdeinit_library_path();
    unsetenv("LD_BIND_NOW");
+   unsetenv("DYLD_BIND_AT_LAUNCH");
    KApplication::loadedByKdeinit = true;
 
    d.maxname = strlen(argv[0]);
diff -uNbr kinit/setproctitle.cpp kinit/setproctitle.cpp
--- kinit/setproctitle.cpp	Thu Jan  2 23:58:30 2003
+++ kinit/setproctitle.cpp	Tue Mar 18 18:55:49 2003
@@ -72,6 +72,12 @@
 # define SPT_TYPE	SPT_REUSEARGV
 #endif
 
+#if defined(HAVE_NSGETENVIRON) && defined(HAVE_CRT_EXTERNS_H)
+#include <sys/time.h>
+#include <crt_externs.h>
+#define environ (*_NSGetEnviron())
+#endif
+
 #if SPT_TYPE != SPT_NONE && SPT_TYPE != SPT_BUILTIN
 
 # if SPT_TYPE == SPT_PSTAT
diff -uNbr kio/Makefile.am kio/Makefile.am
--- kio/Makefile.am	Sat Sep 21 12:56:14 2002
+++ kio/Makefile.am	Tue Mar 18 18:55:49 2003
@@ -20,7 +20,7 @@
 
 INCLUDES=  -I$(srcdir)/.. $(all_includes) $(SSL_INCLUDES)
 
-SUBDIRS = kssl kio bookmarks kfile . kpasswdserver misc pics tests
+SUBDIRS = kssl kio bookmarks kfile . kded kpasswdserver misc pics tests
 
 lib_LTLIBRARIES = libkio.la
 
diff -uNbr kio/kded/Makefile kio/kded/Makefile
--- kio/kded/Makefile	Wed Dec 31 19:00:00 1969
+++ kio/kded/Makefile	Tue Mar 18 18:55:49 2003
@@ -0,0 +1,8 @@
+# That's right!  OSX's linker is so anal, I had to totally
+# mess with the link order to get things to build.  Scary, scary.
+
+all:
+	pushd ../../kded; $(MAKE); popd
+
+clean:
+install:
diff -uNbr kio/kio/kurlcompletion.cpp kio/kio/kurlcompletion.cpp
--- kio/kio/kurlcompletion.cpp	Mon Sep 16 20:09:08 2002
+++ kio/kio/kurlcompletion.cpp	Tue Mar 18 18:55:49 2003
@@ -740,6 +740,11 @@
 // Environment variables
 //
 
+#if defined(HAVE_NSGETENVIRON) && defined(HAVE_CRT_EXTERNS_H)   
+#include <crt_externs.h>                                 
+#define environ (*_NSGetEnviron()) 
+#endif
+
 extern char **environ; // Array of environment variables
 
 bool KURLCompletion::envCompletion(const MyURL &url, QString *match)
diff -uNbr kio/kio/kurlcompletion.h kio/kio/kurlcompletion.h
--- kio/kio/kurlcompletion.h	Mon Jul  1 14:58:42 2002
+++ kio/kio/kurlcompletion.h	Tue Mar 18 18:55:49 2003
@@ -23,6 +23,10 @@
 #ifndef KURLCOMPLETION_H
 #define KURLCOMPLETION_H
 
+#ifdef HAVE_CONFIG_H
+#include <config.h>
+#endif
+
 #include <kcompletion.h>
 #include <kio/jobclasses.h>
 #include <qstring.h>
diff -uNbr kio/kpasswdserver/Makefile.am kio/kpasswdserver/Makefile.am
--- kio/kpasswdserver/Makefile.am	Sun Sep 15 17:13:40 2002
+++ kio/kpasswdserver/Makefile.am	Tue Mar 18 18:55:49 2003
@@ -10,4 +10,4 @@
 kded_kpasswdserver_la_SOURCES = kpasswdserver.cpp kpasswdserver.skel 
 kded_kpasswdserver_la_METASOURCES = AUTO
 kded_kpasswdserver_la_LDFLAGS = $(all_libraries) -module -avoid-version
-kded_kpasswdserver_la_LIBADD = $(LIB_KIO)
+kded_kpasswdserver_la_LIBADD = $(LIB_KIO) $(top_builddir)/kded/libkded_main.la
diff -uNbr kio/kssl/kopenssl.cc kio/kssl/kopenssl.cc
--- kio/kssl/kopenssl.cc	Thu Jan  2 23:58:50 2003
+++ kio/kssl/kopenssl.cc	Tue Mar 18 18:55:49 2003
@@ -251,6 +251,9 @@
             #ifdef _AIX
             << "/opt/freeware/lib/"
 	    #endif
+	    #ifdef __APPLE__
+	    << "@PREFIX@/lib/"
+	    #endif
 	    << "/usr/lib/"
 	    << "/usr/ssl/lib/"
             << "/usr/local/lib/"
@@ -269,6 +272,7 @@
 	     #elif defined(__APPLE__)
 	     << "libssl.dylib"
 	     << "libssl.0.9.dylib"
+	     << "libssl.0.9.6.dylib"
              #else
              << "libssl.so"
 	     << "libssl.so.0"
@@ -286,6 +290,7 @@
 	     #elif defined(__APPLE__)
 	     << "libcrypto.dylib"
 	     << "libcrypto.0.9.dylib"
+	     << "libcrypto.0.9.6.dylib"
 	     #else
              << "libcrypto.so"
 	     << "libcrypto.so.0"
diff -uNbr kio/misc/Makefile.am kio/misc/Makefile.am
--- kio/misc/Makefile.am	Thu Jan  2 23:58:52 2003
+++ kio/misc/Makefile.am	Tue Mar 18 18:55:49 2003
@@ -22,25 +22,29 @@
 
 SUBDIRS = . ksendbugmail kpac kdesasl kssld kfile
 
-lib_LTLIBRARIES = kio_uiserver.la
+lib_LTLIBRARIES = kio_uiserver.la libkio_uiserver_main.la
 bin_PROGRAMS = kio_uiserver kmailservice ktelnetservice
 
-kio_uiserver_SOURCES = dummy.cpp
-kio_uiserver_LDADD = kio_uiserver.la
-kio_uiserver_LDFLAGS = $(KDE_RPATH) $(all_libraries)
+libkio_uiserver_main_la_SOURCES = uiserver.cpp uiserver.skel observer.stub
+libkio_uiserver_main_la_LIBADD = $(LIB_KIO)
+libkio_uiserver_main_la_LDFLAGS = $(all_libraries) -avoid-version
+
+kio_uiserver_la_SOURCES = kio_uiserver_la_main.cpp
+kio_uiserver_la_LIBADD = libkio_uiserver_main.la
+kio_uiserver_la_LDFLAGS = $(all_libraries) -avoid-version -module
+
+kio_uiserver_la_main.cpp: kio_uiserver_main.cpp
+	cat kio_uiserver_main.cpp > kio_uiserver_la_main.cpp
 
-kio_uiserver_la_SOURCES = uiserver.cpp uiserver.skel observer.stub
-kio_uiserver_la_LIBADD = $(LIB_KIO)
-kio_uiserver_la_LDFLAGS = $(all_libraries) -module -avoid-version
+kio_uiserver_SOURCES = kio_uiserver_main.cpp
+kio_uiserver_LDADD = libkio_uiserver_main.la
+kio_uiserver_LDFLAGS = $(KDE_RPATH) $(all_libraries)
 
 observer_DIR = $(top_srcdir)/kio/kio
 
 METASOURCES = AUTO
 
 kde_services_DATA = kio_uiserver.desktop
-
-dummy.cpp: uiserver.kidl
-	echo > dummy.cpp
 
 kmailservice_SOURCES = kmailservice.cpp
 kmailservice_LDADD = $(LIB_KDECORE)
diff -uNbr kio/misc/kio_uiserver_main.cpp kio/misc/kio_uiserver_main.cpp
--- kio/misc/kio_uiserver_main.cpp	Wed Dec 31 19:00:00 1969
+++ kio/misc/kio_uiserver_main.cpp	Tue Mar 18 18:55:49 2003
@@ -0,0 +1,27 @@
+/*
+ *
+ * Copyright (c) 2001 Nick Hudson <skrll@netbsd.org>
+ *
+ * Permission is hereby granted, free of charge, to any person obtaining a copy
+ * of this software and associated documentation files (the "Software"), to deal
+ * in the Software without restriction, including without limitation the rights
+ * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
+ * copies of the Software, and to permit persons to whom the Software is
+ * furnished to do so, subject to the following conditions:
+ *
+ * The above copyright notice and this permission notice shall be included in
+ * all copies or substantial portions of the Software.
+ *
+ * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
+ * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
+ * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.  IN NO EVENT SHALL THE
+ * AUTHORS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN
+ * AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN
+ * CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
+ */
+extern "C" int kdemain(int, char* []);
+
+int main( int argc, char* argv[] )
+{
+        return kdemain(argc, argv);
+}
diff -uNbr kio/misc/kpac/dhcp.h kio/misc/kpac/dhcp.h
--- kio/misc/kpac/dhcp.h	Mon Jul  1 14:58:43 2002
+++ kio/misc/kpac/dhcp.h	Tue Mar 18 18:55:49 2003
@@ -29,6 +29,10 @@
 
 #define DHCP_OPT_LEN 312
 
+#ifndef uint8_t
+#include <stdint.h>
+#endif
+
 struct dhcp_msg
 {
 #define DHCP_BOOTREQUEST 1
diff -uNbr kio/misc/kpac/kpac_dhcp_helper.c kio/misc/kpac/kpac_dhcp_helper.c
--- kio/misc/kpac/kpac_dhcp_helper.c	Mon Jul  1 14:58:43 2002
+++ kio/misc/kpac/kpac_dhcp_helper.c	Tue Mar 18 18:55:49 2003
@@ -19,6 +19,7 @@
 /* $Id: kpac_dhcp_helper.c,v 1.8 2002/04/20 13:42:02 hausmann Exp $ */
 
 #include <config.h>
+#include <sys/types.h>
 #include <grp.h>
 
 #include <unistd.h>
diff -uNbr kio/misc/kssld/Makefile.am kio/misc/kssld/Makefile.am
--- kio/misc/kssld/Makefile.am	Thu Jan  2 23:58:53 2003
+++ kio/misc/kssld/Makefile.am	Tue Mar 18 18:55:49 2003
@@ -21,7 +21,7 @@
 kde_module_LTLIBRARIES = kded_kssld.la
 
 kded_kssld_la_LDFLAGS = $(all_libraries) -module -avoid-version
-kded_kssld_la_LIBADD = $(LIB_KIO)
+kded_kssld_la_LIBADD = $(LIB_KIO) $(top_builddir)/kded/libkded_main.la
 kded_kssld_la_SOURCES = kssld.cpp kssld.skel
 
 METASOURCES = AUTO
diff -uNbr kio/misc/uiserver.cpp kio/misc/uiserver.cpp
--- kio/misc/uiserver.cpp	Thu Nov 28 22:16:09 2002
+++ kio/misc/uiserver.cpp	Tue Mar 18 18:55:49 2003
@@ -1013,7 +1013,9 @@
 
 //------------------------------------------------------------
 
-int main(int argc, char **argv)
+extern "C" int kdemain(int, char**);
+
+int kdemain(int argc, char **argv)
 {
     KLocale::setMainCatalogue("kdelibs");
     //  GS 5/2001 - I changed the name to "KDE" to make it look better
diff -uNbr kioslave/http/Makefile.am kioslave/http/Makefile.am
--- kioslave/http/Makefile.am	Sat Oct 26 18:18:24 2002
+++ kioslave/http/Makefile.am	Tue Mar 18 18:55:49 2003
@@ -9,7 +9,7 @@
 ####### Files
 
 bin_PROGRAMS = kio_http_cache_cleaner
-lib_LTLIBRARIES = kio_http_cache_cleaner.la
+lib_LTLIBRARIES = kio_http_cache_cleaner.la libkio_http_cache_cleaner_main.la
 kde_module_LTLIBRARIES = kio_http.la
 
 kio_http_la_SOURCES = http.cc httpfilter.cc
@@ -17,19 +17,26 @@
 kio_http_la_LIBADD = $(LIB_KIO) $(LIBZ)
 kio_http_la_LDFLAGS = $(all_libraries) -module $(KDE_PLUGIN)
 
-kio_http_cache_cleaner_SOURCES = dummy.cpp
-kio_http_cache_cleaner_LDADD   = kio_http_cache_cleaner.la
+kio_http_cache_cleaner_SOURCES = http_cache_cleaner_main.cpp
+kio_http_cache_cleaner_LDADD = libkio_http_cache_cleaner_main.la
 kio_http_cache_cleaner_LDFLAGS = $(KDE_RPATH)
 
-kio_http_cache_cleaner_la_SOURCES = http_cache_cleaner.cpp
-kio_http_cache_cleaner_la_LIBADD  = $(LIB_KIO)
-kio_http_cache_cleaner_la_LDFLAGS = -module -avoid-version
+http_cache_cleaner_main.cpp: stub_main.cpp
+	cat stub_main.cpp > http_cache_cleaner_main.cpp
+
+kio_http_cache_cleaner_la_SOURCES = http_cache_cleaner_la_main.cpp
+kio_http_cache_cleaner_la_LIBADD  = libkio_http_cache_cleaner_main.la
+kio_http_cache_cleaner_la_LDFLAGS = -avoid-version -module
+
+http_cache_cleaner_la_main.cpp: stub_main.cpp
+	cat stub_main.cpp > http_cache_cleaner_la_main.cpp
+
+libkio_http_cache_cleaner_main_la_SOURCES = http_cache_cleaner.cpp
+libkio_http_cache_cleaner_main_la_LIBADD  = $(LIB_KIO)
+libkio_http_cache_cleaner_main_la_LDFLAGS = -avoid-version
 
 noinst_HEADERS = http.h
 
 kdelnkdir = $(kde_servicesdir)
 kdelnk_DATA = http_cache_cleaner.desktop http.protocol https.protocol \
               webdav.protocol webdavs.protocol
-
-dummy.cpp:
-	echo > dummy.cpp
diff -uNbr kioslave/http/http.cc kioslave/http/http.cc
--- kioslave/http/http.cc	Thu Jan 16 13:51:24 2003
+++ kioslave/http/http.cc	Tue Mar 18 18:55:49 2003
@@ -34,9 +34,9 @@
 #include <netinet/in.h>  // Required for AIX
 #include <netinet/tcp.h>
 
+#include <unistd.h>
 /*
 #include <netdb.h>
-#include <unistd.h>
 #include <sys/time.h>
 #include <sys/wait.h>
 */
diff -uNbr kioslave/http/http_cache_cleaner.cpp kioslave/http/http_cache_cleaner.cpp
--- kioslave/http/http_cache_cleaner.cpp	Fri Dec 21 02:23:33 2001
+++ kioslave/http/http_cache_cleaner.cpp	Tue Mar 18 18:55:49 2003
@@ -187,7 +187,9 @@
    }
 }
 
-int main(int argc, char **argv)
+extern "C" int kdemain(int, char**);
+
+int kdemain(int argc, char **argv)
 {
    KLocale::setMainCatalogue("kdelibs");
    KCmdLineArgs::init( argc, argv, appName, description, version, true);
diff -uNbr kioslave/http/kcookiejar/Makefile.am kioslave/http/kcookiejar/Makefile.am
--- kioslave/http/kcookiejar/Makefile.am	Sun Sep 15 17:13:44 2002
+++ kioslave/http/kcookiejar/Makefile.am	Tue Mar 18 18:55:49 2003
@@ -9,25 +9,25 @@
 lib_LTLIBRARIES = kcookiejar.la
 kde_module_LTLIBRARIES = kded_kcookiejar.la
 
-kcookiejar_la_SOURCES = main.cpp
 METASOURCES = AUTO
+kcookiejar_la_SOURCES = main.cpp
 kcookiejar_la_LDFLAGS = $(all_libraries) -module -avoid-version
 kcookiejar_la_LIBADD = $(LIB_KDECORE)
 
 kded_kcookiejar_la_SOURCES = kcookiejar.cpp kcookieserver.cpp \
 			kcookieserver.skel kcookiewin.cpp 
 kded_kcookiejar_la_LDFLAGS = $(all_libraries) -module -avoid-version
-kded_kcookiejar_la_LIBADD = $(LIB_KIO)
+kded_kcookiejar_la_LIBADD = $(LIB_KIO) $(top_builddir)/kded/libkded_main.la
 
-kcookiejar_SOURCES = dummy.cpp
-kcookiejar_LDADD = kcookiejar.la
+kcookiejar_SOURCES = kcookiejar_main.cpp
+kcookiejar_LDADD = $(LIB_KDECORE)
 kcookiejar_LDFLAGS = $(all_libraries) $(KDE_RPATH)
 
+kcookiejar_main.cpp: main.cpp
+	cat main.cpp > kcookiejar_main.cpp
+
 kded_DATA = kcookiejar.desktop
 kdeddir = $(kde_servicesdir)/kded
 
 update_DATA = kcookiescfg.upd
 updatedir = $(kde_datadir)/kconf_update
-
-dummy.cpp:
-	echo > dummy.cpp
diff -uNbr kioslave/http/stub_main.cpp kioslave/http/stub_main.cpp
--- kioslave/http/stub_main.cpp	Wed Dec 31 19:00:00 1969
+++ kioslave/http/stub_main.cpp	Tue Mar 18 18:55:49 2003
@@ -0,0 +1,28 @@
+/*
+ *
+ * Copyright (c) 2001 Nick Hudson <skrll@netbsd.org>
+ *
+ * Permission is hereby granted, free of charge, to any person obtaining a copy
+ * of this software and associated documentation files (the "Software"), to deal
+ * in the Software without restriction, including without limitation the rights
+ * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
+ * copies of the Software, and to permit persons to whom the Software is
+ * furnished to do so, subject to the following conditions:
+ *
+ * The above copyright notice and this permission notice shall be included in
+ * all copies or substantial portions of the Software.
+ *
+ * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
+ * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
+ * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.  IN NO EVENT SHALL THE
+ * AUTHORS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN
+ * AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN
+ * CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
+ */
+extern "C" int kdemain(int, char* []);
+
+int main( int argc, char* argv[] )
+{
+        return kdemain(argc, argv);
+}
+
diff -uNbr libkscreensaver/Makefile.am libkscreensaver/Makefile.am
--- libkscreensaver/Makefile.am	Sun Sep 15 17:13:52 2002
+++ libkscreensaver/Makefile.am	Tue Mar 18 18:55:49 2003
@@ -1,7 +1,7 @@
 lib_LTLIBRARIES = libkscreensaver.la
 libkscreensaver_la_SOURCES = main.cpp kscreensaver.cpp
 libkscreensaver_la_LIBADD  = $(LIB_KIO)
-libkscreensaver_la_LDFLAGS = $(all_libraries) $(KDE_RPATH) -version-info 5:0:1
+libkscreensaver_la_LDFLAGS = $(all_libraries) $(KDE_RPATH) -version-info 5:0:1 -undefined suppress -flat_namespace
 
 include_HEADERS = kscreensaver.h kscreensaver_vroot.h
 
diff -uNbr libltdl/ltdl.c libltdl/ltdl.c
--- libltdl/ltdl.c	Mon Jul  1 14:58:49 2002
+++ libltdl/ltdl.c	Tue Mar 18 18:55:49 2003
@@ -1544,11 +1544,14 @@
   /* try to open the old library first; if it was dlpreopened,
      we want the preopened version of it, even if a dlopenable
      module is available */
+/*	HACKALERT: Why? Mac OS/Darwin can't open static libs, it is
+	a waste to even try. Disabled for kde.	*/
+#if 0
   if (old_name && tryall_dlopen(handle, old_name) == 0)
     {
       return 0;
     }
-
+#endif
   /* try to open the dynamic library */
   if (dlname)
     {
diff -uNbr libltdl/ltdl.m4 libltdl/ltdl.m4
--- libltdl/ltdl.m4	Mon Jul  1 14:58:49 2002
+++ libltdl/ltdl.m4	Tue Mar 18 18:55:49 2003
@@ -103,6 +103,9 @@
 	osf*)
 	  libltdl_cv_sys_dlopen_deplibs=yes
 	  ;;
+	darwin*)
+	  libltdl_cv_sys_dlopen_deplibs=yes
+	  ;;
 	esac
 ])
 if test "$libltdl_cv_sys_dlopen_deplibs" != yes; then
@@ -442,6 +445,8 @@
 if test x"$ac_cv_sys_symbol_underscore" = xyes; then
   if test x"$ac_cv_func_dlopen" = xyes ||
      test x"$ac_cv_lib_dl_dlopen" = xyes ; then
+        ac_save_LIBS="$LIBS"
+        LIBS="$LIBS $LIBADD_DL"
 	AC_CACHE_CHECK([whether we have to add an underscore for dlsym],
 		libltdl_cv_need_uscore, [dnl
 		AC_TRY_RUN([
@@ -495,6 +500,7 @@
 fi
 
 if test x"$libltdl_cv_need_uscore" = xyes; then
+  LIBS="$ac_save_LIBS"
   AC_DEFINE(NEED_USCORE, 1,
     [Define if dlsym() requires a leading underscode in symbol names. ])
 fi
