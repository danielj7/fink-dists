Package: nodejs
Version: 0.8.1
Revision: 1
###
BuildDepends: pkgconfig, python3, openssl, curl, openssl100-dev
Depends: openssl100-shlibs
###
Source: http://nodejs.org/dist/v0.8.1/node-v0.8.1.tar.gz
Source-MD5: 32a6f7b7cf196cb89bd973741ae58dd1
###
PatchFile: %n.patch
PatchFile-MD5: 2bf3988758b7fdf6068ace627f7fb71a
###
DocFiles: AUTHORS LICENSE README.md
###
PatchScript: <<
  sed -e 's,@FINKPREFIX@,%p,g' %{PatchFile} | patch -p1

  patch -p1 < fink/patches/FHS_paths_for_nodejs.patch
  patch -p1 < fink/patches/expected_failing_tests.patch
  patch -p1 < fink/patches/fixjs-before-test.patch

  perl -pi -e 's,ev\.h,uv-private/ev\.h,g' deps/uv/src/unix/ev/ev.c
<<
###
InstallScript: <<
  make install DESTDIR=%d

  mv %i/include/node %i/include/nodejs
  mv %i/lib/node %i/share/nodejs

  ### --without-dtrace not working
  rm -rf %i/lib

  ln -s %p/bin/node %i/bin/nodejs
  ln -s %p/share/man/man1/node.1 %i/share/man/man1/nodejs.1

  install -d -m0755 %i/share/doc/%n
  cp -R %b/doc/api %i/share/doc/%n

  install -m0644 fink/node-waf.1 %i/share/man/man1
  install -d -m0755 %i/etc/bash_completion.d
  install -m0644 fink/node-waf.bash-completion %i/etc/bash_completion.d/node-waf

  find %i/share/doc/%n -name *.json -delete
  sed -i -e '/document\.write/d' -e '/pageTracker/d' %i/share/doc/%n/api/*.html
<<
###
InfoTest: <<
  TestScript: make test || exit 2
<<
###
ConfigureParams: --without-dtrace --without-npm --openssl-use-sys --openssl-includes=%p/include/openssl --openssl-libpath=%p/lib --shared-zlib --shared-zlib-includes=/usr/include --shared-zlib-libpath=/usr/lib --shared-zlib-libname=z
## fink's libv8 is too old
#ConfigureParams: --without-dtrace --without-npm --shared-v8 --shared-v8-includes=%p/include --shared-v8-libpath=%p/lib --shared-v8-libname=v8 --openssl-use-sys --openssl-includes=%p/include/openssl --openssl-libpath=%p/lib --no-ssl2 --shared-zlib --shared-zlib-includes=/usr/include --shared-zlib-libpath=/usr/lib --shared-zlib-libname=z
###
Description: Event-based server-side javascript engine
DescDetail: <<
Node.js is similar in design to and influenced by systems like Ruby's Event
Machine or Python's Twisted.
.
It takes the event model a bit further - it presents the event loop as a
language construct instead of as a library.
.
Node.js is bundled with several useful libraries to handle server tasks :
  System, Events, Standard I/O, Modules, Timers, Child Processes, POSIX, HTTP,
  Multipart Parsing, TCP, DNS, Assert, Path, URL, Query Strings.
<<
###
SplitOff: <<
  Package: %N-dev
  Depends: %N (= %v-%r), python3
  Suggests: bash-completion
  Files: <<
    etc
    bin/node-waf
    include
    share/nodejs
    share/man/man1/node-waf.1
  <<
  Description: Development files for Node.js
  DescDetail: <<
Node.js provides an event-based server-side javascript engine.
.
It is similar in design to and influenced by systems like
Ruby's Event Machine or Python's Twisted.
.
Node.js takes the event model a bit further - it presents the event
loop as a language construct instead of as a library.
.
This package is needed to build plugins.
  <<
<<
###
License: BSD
Homepage: http://nodejs.org/
Maintainer: Justin F. Hallett <thesin@users.sourceforge.net>
