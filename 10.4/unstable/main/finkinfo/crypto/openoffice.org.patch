### A patch to utilize Osaka font; IssueZilla #54535
--- officecfg/registry/data/org/openoffice/VCL.xcu.orig	2005-09-08 23:46:30.000000000 +0900
+++ officecfg/registry/data/org/openoffice/VCL.xcu	2005-10-17 03:08:38.000000000 +0900
@@ -511,31 +511,31 @@
     </node>
     <node oor:name="ja" oor:op="replace">
       <prop oor:name="CJK_TEXT" oor:type="xs:string" oor:op="replace">
-        <value>HG 明朝L Sun;HG MinchoL Sun;HG PゴシックB Sun;HG-PGothicB Sun;HG PゴシックB;HG-PGothicB;HG Mincho Light J;ＭＳ Ｐ明朝;TLP明朝;LX明朝;IPA P明朝;東風明朝;Kochi Mincho;さざなみ明朝;Mincho;Serif</value>
+        <value>HG 明朝L Sun;HG MinchoL Sun;HG PゴシックB Sun;HG-PGothicB Sun;HG PゴシックB;HG-PGothicB;HG Mincho Light J;ＭＳ Ｐ明朝;TLP明朝;LX明朝;IPA P明朝;Osaka;東風明朝;Kochi Mincho;さざなみ明朝;Mincho;Serif</value>
       </prop>
        <prop oor:name="CJK_HEADING" oor:type="xs:string" oor:op="replace">
-        <value>HG 明朝L Sun;HG 明朝L;HG Mincho Light J;ＭＳ Ｐゴシック;TLPゴシック;LXゴシック;IPA Pゴシック;東風ゴシック;さざなみゴシック;Gothic;ＭＳ 明朝;HG Mincho J;HG Mincho L;HG Mincho;Mincho;ＭＳ Ｐ明朝;HG Mincho Light J;ＭＳ ゴシック;HG Gothic J;HG Gothic B;HG Gothic;Gothic;ＭＳ Ｐゴシック;Andale Sans UI</value>
+        <value>HG 明朝L Sun;HG 明朝L;HG Mincho Light J;ＭＳ Ｐゴシック;TLPゴシック;LXゴシック;IPA Pゴシック;Osaka;東風ゴシック;さざなみゴシック;Gothic;ＭＳ 明朝;HG Mincho J;HG Mincho L;HG Mincho;Mincho;ＭＳ Ｐ明朝;HG Mincho Light J;ＭＳ ゴシック;HG Gothic J;HG Gothic B;HG Gothic;Gothic;ＭＳ Ｐゴシック;Andale Sans UI</value>
       </prop>
       <prop oor:name="CJK_PRESENTATION" oor:type="xs:string" oor:op="replace">
-        <value>HG PゴシックB Sun;HG-PGothicB Sun;HG PゴシックB;HG-PGothicB;HG-GothicB;HG Mincho Light J;ＭＳ Ｐゴシック;TLPゴシック;LXゴシック;IPA Pゴシック;東風ゴシック;さざなみゴシック;ＭＳ ゴシック;ＭＳ Ｐゴシック;HG Gothic;HG Gothic B;Gothic;Andale Sans UI</value>
+        <value>HG PゴシックB Sun;HG-PGothicB Sun;HG PゴシックB;HG-PGothicB;HG-GothicB;HG Mincho Light J;ＭＳ Ｐゴシック;TLPゴシック;LXゴシック;IPA Pゴシック;Osaka;東風ゴシック;さざなみゴシック;ＭＳ ゴシック;ＭＳ Ｐゴシック;HG Gothic;HG Gothic B;Gothic;Andale Sans UI</value>
       </prop>
       <prop oor:name="LATIN_PRESENTATION" oor:type="xs:string" oor:op="replace">
         <value>Andale;Arial</value>
       </prop>
       <prop oor:name="CJK_SPREADSHEET" oor:type="xs:string" oor:op="replace">
-        <value>HG PゴシックB Sun;HG-PGothicB Sun;HG PゴシックB;HG-PGothicB;ＭＳ Ｐゴシック;TLPゴシック;LXゴシック;IPA Pゴシック;東風ゴシック;さざなみゴシック;Andale Sans UI;Kochi Gothic;HG Gothic J;HG Gothic B;HG Gothic;Gothic</value>
+        <value>HG PゴシックB Sun;HG-PGothicB Sun;HG PゴシックB;HG-PGothicB;ＭＳ Ｐゴシック;TLPゴシック;LXゴシック;IPA Pゴシック;Osaka;東風ゴシック;さざなみゴシック;Andale Sans UI;Kochi Gothic;HG Gothic J;HG Gothic B;HG Gothic;Gothic</value>
       </prop>
       <prop oor:name="LATIN_SPREADSHEET" oor:type="xs:string" oor:op="replace">
-        <value>HG PゴシックB Sun;HG-PGothicB Sun;HG PゴシックB;HG-PGothicB;Andale Sans UI;ＭＳ Ｐゴシック;TLPゴシック;LXゴシック;IPA Pゴシック;東風ゴシック;MS Gothic;HG Gothic J;HG Gothic B;HG Gothic;Kochi Gothic;MS PGothic;Gothic</value>
+        <value>HG PゴシックB Sun;HG-PGothicB Sun;HG PゴシックB;HG-PGothicB;Andale Sans UI;ＭＳ Ｐゴシック;TLPゴシック;LXゴシック;IPA Pゴシック;Osaka;東風ゴシック;MS Gothic;HG Gothic J;HG Gothic B;HG Gothic;Kochi Gothic;MS PGothic;Gothic</value>
       </prop>
       <prop oor:name="UI_FIXED" oor:type="xs:string" oor:op="replace">
-        <value>HG ゴシックB Sun;HG-GothicB Sun;HG Mincho Light J;ＭＳ Ｐゴシック;TLPゴシック;LXゴシック;IPA Pゴシック;東風ゴシック;さざなみゴシック;Kochi Gothic;Gothic</value>
+        <value>HG ゴシックB Sun;HG-GothicB Sun;HG Mincho Light J;ＭＳ Ｐゴシック;TLPゴシック;LXゴシック;IPA Pゴシック;Osaka;東風ゴシック;さざなみゴシック;Kochi Gothic;Gothic</value>
        </prop>
        <prop oor:name="FIXED" oor:type="xs:string" oor:op="replace">
-        <value>HG ゴシックB Sun;HG-GothicB Sun;HG ゴシックB;HG Mincho Light J;ＭＳ Ｐゴシック;TLPゴシック;LXゴシック;IPA Pゴシック;東風ゴシック;さざなみゴシック;Kochi Gothic;Gothic</value>
+        <value>HG ゴシックB Sun;HG-GothicB Sun;HG ゴシックB;HG Mincho Light J;ＭＳ Ｐゴシック;TLPゴシック;LXゴシック;IPA Pゴシック;Osaka;東風ゴシック;さざなみゴシック;Kochi Gothic;Gothic</value>
        </prop>
       <prop oor:name="UI_SANS" oor:type="xs:string" oor:op="replace">
-        <value>HG PゴシックB Sun;HG-PGothicB Sun;HG PゴシックB;HG-PGothicB;HG-GothicB;Andale Sans UI;HG Mincho Light J;標準;TLPゴシック;LXゴシック;IPA Pゴシック;東風ゴシック;さざなみゴシック;Kochi Gothic;Gothic;Gnu-Unifont</value>
+        <value>HG PゴシックB Sun;HG-PGothicB Sun;HG PゴシックB;HG-PGothicB;HG-GothicB;Andale Sans UI;HG Mincho Light J;標準;TLPゴシック;LXゴシック;IPA Pゴシック;Osaka;東風ゴシック;さざなみゴシック;Kochi Gothic;Gothic;Gnu-Unifont</value>
       </prop>
       <prop oor:name="LATIN_FIXED" oor:type="xs:string" oor:op="replace">
         <value>hgmincholightj;cumberlandamt;cumberland;couriernew;nimbusmonol;courier;lucidasanstypewriter;lucidatypewriter;monaco;monospaced</value>

### Script to create language packs
--- /dev/null	Fri Feb 10 20:33:39 2006
+++ languagepack-splitoff	Fri Feb 10 20:32:14 2006
@@ -0,0 +1,43 @@
+#!/bin/bash
+
+set -e
+
+lang1=$1
+lang2=$2
+fink_p=$3
+fink_d=$4
+fink_i=$5
+fink_N=$6
+# Setting up environment
+case `uname -p` in
+  powerpc) . ./MacOSXPPCEnv.Set.sh;;
+  i386) . ./MacOSXX86Env.Set.sh;;
+  *) echo 'Unknown architecture'; exit 1;;
+esac
+
+# Variables needed to execute make_installer.pl
+export GNUCOPY="/bin/ln"
+export OUT="../$INPATH"
+export LOCAL_OUT="$OUT"
+export LOCAL_COMMON_OUT="$OUT"
+solarlibdir=$SOLARVER/$INPATH/lib
+export PYTHONPATH=$SRC_ROOT/instsetoo_native/$INPATH/bin:$solarlibdir:$solarlibdir/python:$solarlibdir/python/lib-dynload
+build=`sed -n 's/^BUILD=\(.*\)$/\1/p' $SOLARENVINC/minor.mk`
+
+set -v
+
+# Install language pack
+pushd instsetoo_native/util
+/usr/bin/perl -w $SOLARENV/bin/make_installer.pl \
+  -f openoffice.lst -l $lang2 -p OpenOffice \
+  -packagelist ../inc_openoffice/unix/packagelist.txt \
+  -buildid $build -languagepack \
+  -destdir $fink_d \
+  -simple $fink_p/Applications
+popd
+
+# Remove the list files
+/bin/rm -v $fink_d/gid_Module*
+
+/usr/bin/install -m 755 -d $fink_i/share/doc/$fink_N-$lang1
+/bin/mv $fink_i/Applications/{LICENSEs,READMEs} $fink_i/share/doc/$fink_N-$lang1

### Script to convert Mac OS X fonts to truetype fonts
--- /dev/null	Tue Feb  7 11:38:20 2006
+++ update-ooo-fonts	Tue Feb  7 11:37:47 2006
@@ -0,0 +1,52 @@
+#!/bin/sh
+set -e
+case $1 in
+    -h|-help|--help)
+    echo "Usage: `basename $0` [--clean]"
+    exit 0;;
+    ""|--clean) ;;
+    *)
+    echo "Usage: `basename $0` [--clean]"
+    exit 1;;
+esac
+
+/bin/mkdir -p "@PREFIX@/Applications/OpenOffice.org 2.2.app/Contents/MacOS/share/fonts/fondu"
+trap '/bin/rm -rf "@PREFIX@/Applications/OpenOffice.org 2.2.app/Contents/MacOS/share/fonts/fondu/"*.tmp' 0
+cd "@PREFIX@/Applications/OpenOffice.org 2.2.app/Contents/MacOS/share/fonts"
+
+# Remove old fonts and symlinks
+echo "Cleaning old Mac OS X fonts..."
+/bin/rm -f truetype/.fondudone
+/usr/bin/find -H truetype -type l > fondu/oldlinks.tmp
+while read link; do
+    to=`@PREFIX@/sbin/readlink "$link" || :`
+    case $to in
+        ../fondu/*) /bin/rm -f "$link"
+    esac
+done < fondu/oldlinks.tmp
+case $1 in
+    --clean)
+    /bin/rm -rf fondu
+    exit 0;;
+    *) /usr/bin/find -H fondu -type f -delete;;
+esac
+
+# Convert fonts
+echo "Converting Mac OS X fonts..."
+cd fondu
+/usr/bin/find -H /System/Library/Fonts /Library/Fonts -type f > sysfonts.tmp
+{
+    while read font; do
+        @PREFIX@/bin/fondu -force "$font" || :
+    done < sysfonts.tmp 3>&2 2>&1 1>&3 |
+      /usr/bin/grep -v "Can't find an appropriate resource fork" || :
+} 3>&2 2>&1 1>&3 3>&-
+/usr/bin/find -H . -name "*.bdf" -delete
+/usr/bin/find -H . -name "*.ttf" | /usr/bin/sed 's/.*\///' > fondu-ttf.tmp
+cd "@PREFIX@/Applications/OpenOffice.org 2.2.app/Contents/MacOS/share/fonts"
+
+# Create new symlinks
+while read font; do
+  /bin/ln -sf "../fondu/$font" "truetype/$font"
+done < fondu/fondu-ttf.tmp
+/usr/bin/touch truetype/.fondudone

### Avoid adding /sw/lib, /usr/lib or /usr/X11R6/lib into DYLD_LIBRARY_PATH
### on checking libraries, which confuses "libjpeg" and "libJPEG" etc.
--- solenv/bin/checkdll.sh.orig	2007-05-02 03:38:03.000000000 +0900
+++ solenv/bin/checkdll.sh	2007-05-02 12:14:15.000000000 +0900
@@ -45,15 +45,23 @@
 checkdll="$SOLARVERSION/$INPATH/bin$UPDMINOREXT/checkdll"
 
 if [ -x $checkdll ]; then
+    uname_s=`uname -s`
     while :
     do
 	case $1 in
 	    -L) shift; option=$1;;
 	    --) break;;
 	esac
-	case "${libpath+X}" in
-	    X) libpath=$libpath:$option;;
-	    *) libpath=$option;;
+	case $uname_s-$option in
+	    Darwin-${FINK_PREFIX-/sw}/lib) skip=true;;
+	    Darwin-/usr/lib) skip=true;;
+	    Darwin-/usr/X11R6/lib) skip=true;;
+	    *) skip=false;;
+	esac
+	case "$skip-${libpath+X}" in
+	    true-*) ;;
+	    false-X) libpath=$libpath:$option;;
+	    false-*) libpath=$option;;
 	esac
 	shift
     done

### Add configure option to link against Fink's Python
--- config_office/configure.in.orig	2007-05-07 05:09:11.000000000 +0900
+++ config_office/configure.in	2007-05-07 05:08:30.000000000 +0900
@@ -286,6 +286,16 @@
 AC_ARG_WITH(system-python,
 [  --with-system-python    Use python already on system
 ],,)
+AC_ARG_WITH(python-libs,
+[[  --with-python-libs[=auto|LIBS|none]
+                          Specify linker options to link the python library. [default=auto]
+                          This option does nothing without --with-system-python.
+]],[
+case $withval in
+   yes) with_python_libs=auto;;
+   no|"") with_python_libs=none;;
+esac
+],with_python_libs=auto)
 AC_ARG_WITH(system-icu,
 [  --with-system-icu       Use icu already on system
 ],,)
@@ -2937,11 +2947,16 @@
    python_version=`$PYTHON -c "import distutils.sysconfig; print distutils.sysconfig.get_config_var('VERSION');"`
    PYTHON_CFLAGS="-I$python_include"
 
-   if test "$_os" = "Darwin"; then
-      PYTHON_LIBS="-framework Python"
-   else
-      PYTHON_LIBS="-lpython$python_version"
-   fi
+   case $with_python_libs in
+      auto)
+      case $_os:$python_include in
+         Darwin:/System/*) PYTHON_LIBS="-framework Python" ;;
+         *) PYTHON_LIBS="-lpython$python_version" ;;
+      esac
+      ;;
+      none) PYTHON_LIBS= ;;
+      *) PYTHON_LIBS=$with_python_libs ;;
+   esac
    
    dnl check if the headers really work:
    save_CPPFLAGS="$CPPFLAGS"

--- config_office/onfigure.orig	2007-05-07 05:09:20.000000000 +0900
+++ config_office/configure	2007-05-07 05:11:31.000000000 +0900
@@ -1733,6 +1733,10 @@
 
   --with-system-python    Use python already on system
 
+  --with-python-libs[=auto|LIBS|none]
+                          Specify linker options to link the python library. [default=auto]
+                          This option does nothing without --with-system-python.
+
   --with-system-icu       Use icu already on system
 
   --with-system-db        Use berkeley db already on system
@@ -2169,6 +2178,17 @@
 
 fi;
 
+# Check whether --with-python-libs was given.
+if test "${with_python_libs+set}" = set; then
+  withval=$with_python_libs;
+case $withval in
+   yes) with_python_libs=auto;;
+   no|"") with_python_libs=none;;
+esac
+else
+  with_python_libs=auto
+fi
+
 # Check whether --with-system-icu or --without-system-icu was given.
 if test "${with_system_icu+set}" = set; then
   withval="$with_system_icu"
@@ -13061,11 +13078,16 @@
    python_version=`$PYTHON -c "import distutils.sysconfig; print distutils.sysconfig.get_config_var('VERSION');"`
    PYTHON_CFLAGS="-I$python_include"
 
-   if test "$_os" = "Darwin"; then
-      PYTHON_LIBS="-framework Python"
-   else
-      PYTHON_LIBS="-lpython$python_version"
-   fi
+   case $with_python_libs in
+      auto)
+      case $_os:$python_include in
+         Darwin:/System/*) PYTHON_LIBS="-framework Python" ;;
+         *) PYTHON_LIBS="-lpython$python_version" ;;
+      esac
+      ;;
+      none) PYTHON_LIBS= ;;
+      *) PYTHON_LIBS=$with_python_libs ;;
+   esac
 
       save_CPPFLAGS="$CPPFLAGS"
    CPPFLAGS="$CPPFLAGS $PYTHON_CFLAGS"

### link mozilla bits to seamonkey; IZ 73440
--- config_office/configure.in.orig	2007-01-13 14:18:26.000000000 +0100
+++ config_office/configure.in	2007-01-13 14:20:11.000000000 +0100
@@ -58,6 +58,10 @@
 [  --with-firefox          Use Firefox instead of Mozilla Suite for building.
                           Only honoured with --with-system-mozilla
 ],,)
+AC_ARG_WITH(seamonkey,
+[  --with-seamonkey        Use Seamonkey instead of Mozilla Suite for building.
+                          Only honoured with --with-system-mozilla
+],,)
 AC_ARG_WITH(xulrunner,
 [  --with-xulrunner        Use XULRunner instead of Mozilla Suite for building.
                           Only honoured with --with-system-mozilla
@@ -3714,6 +3718,8 @@
     AC_MSG_CHECKING([which Mozilla flavour to use])
     if test -n "$with_firefox" && test "$with_firefox" != "no"; then
       MOZ_FLAVOUR=firefox
+    elif test -n "$with_seamonkey" && test "$with_seamonkey" != "no"; then
+      MOZ_FLAVOUR=seamonkey
     elif test -n "$with_xulrunner" && test "$with_xulrunner" != "no"; then
       MOZ_FLAVOUR=xulrunner
     else

--- config_office/configure.orig	2007-01-19 22:01:19.000000000 +0900
+++ config_office/configure	2007-05-03 11:33:06.000000000 +0900
@@ -1029,6 +1029,9 @@
   --with-firefox          Use Firefox instead of Mozilla Suite for building.
                           Only honoured with --with-system-mozilla
 
+  --with-seamonkey        Use Seamonkey instead of Mozilla Suite for building.
+                          Only honoured with --with-system-mozilla
+
   --with-xulrunner        Use XULRunner instead of Mozilla Suite for building.
                           Only honoured with --with-system-mozilla
 
@@ -1843,6 +1846,12 @@
 
 fi;
 
+# Check whether --with-seamonkey or --without-seamonkey was given.
+if test "${with_seamonkey+set}" = set; then
+  withval="$with_seamonkey"
+
+fi;
+
 # Check whether --with-xulrunner or --without-xulrunner was given.
 if test "${with_xulrunner+set}" = set; then
   withval="$with_xulrunner"
@@ -13577,6 +13586,8 @@
 echo $ECHO_N "checking which Mozilla flavour to use... $ECHO_C" >&6
     if test -n "$with_firefox" && test "$with_firefox" != "no"; then
       MOZ_FLAVOUR=firefox
+    elif test -n "$with_seamonkey" && test "$with_seamonkey" != "no"; then
+      MOZ_FLAVOUR=seamonkey
     elif test -n "$with_xulrunner" && test "$with_xulrunner" != "no"; then
       MOZ_FLAVOUR=xulrunner
     else

### Force libxmlsec to accept SeaMonkey.
--- libxmlsec/xmlsec1-1.2.6.patch.orig	2006-10-24 22:31:14.000000000 +0900
+++ libxmlsec/xmlsec1-1.2.6.patch	2007-05-03 12:47:42.000000000 +0900
@@ -70,7 +70,7 @@
   
   XMLSEC_NO_NSS="1"
   MOZILLA_MIN_VERSION="1.4"
-+ if test "z$MOZ_FLAVOUR" = "zfirefox" ; then
++ if test "z$MOZ_FLAVOUR" = "zfirefox" || test "z$MOZ_FLAVOUR" = "zseamonkey"; then
 +     MOZILLA_MIN_VERSION="1.0"
 + fi
   NSS_MIN_VERSION="3.2"
@@ -236,7 +236,7 @@
       
   XMLSEC_NO_NSS="1"
   MOZILLA_MIN_VERSION="1.4"
-+ if test "z$MOZ_FLAVOUR" = "zfirefox" ; then
++ if test "z$MOZ_FLAVOUR" = "zfirefox" || test "z$MOZ_FLAVOUR" = "zseamonkey"; then
 +     MOZILLA_MIN_VERSION="1.0"
 + fi
   NSS_MIN_VERSION="3.2"
