Package: clamav
Version: 0.53
Revision: 1
Source: http://%n.elektrapro.com/stable/%n-%v.tar.gz
Source-MD5: c635ecebf13dd6c42a72938eaf0cde50
Depends: passwd (>= 20030202-2)
Suggests: unrar
SetLDFLAGS: -prebind
SetCFLAGS: -prebind
ConfigureParams: --mandir=%p/share/man --sysconfdir=%p/etc --disable-clamav --enable-shared=no
InstallScript: <<
 make install DESTDIR=%d
 chown -R %n %i/share/%n
 mkdir -p %i/share/doc
 mv docs %i/share/doc/%n
 rmdir %i/sbin
 rm -R %i/include %i/lib
 cd %i/share/doc/%n; rm Makefile Makefile.am Makefile.in %n.conf.5 clamd.8 clamscan.1 freshclam.1 sigtool.1
 echo './clamscan/clamscan --database=database test/test1; result1="$?"; echo "test result 1: ${result1}"; ./clamscan/clamscan --database=database test/test2.zip; result2="$?"; echo "test result 2: ${result2}"; ./clamscan/clamscan --database=database test/test3.rar; result3="$?"; echo "test result 3: ${result3}"; ./clamscan/clamscan --database=database test/rarfail.rar; result4="$?"; echo "test result 4: ${result4}"; if [ $result1 == "1" ] && [ $result2 == "1" ] && [ $result3 == "1" ] && [ $result4 == "0" ]; then echo "virus scan tests passed!" ; else echo "*** virus scan tests failed! ***" ; exit 1 ; fi' | sh
<<
PostInstScript: <<
 printf "\n\nTo download the latest virus definitions, run 'sudo freshclam'."
 dir=%p/share/%n
 db1=viruses.db
 db2=viruses.db2
 dist1=d1dc954308405cfd136aacd0db0862f8
 dist2=7c92956adb4a0c286bb56816c88bbf29
 olddefs="0"
 if [ -f $dir/$db1 ] && [ -f $dir/$db2 ]; then
  test1=`md5sum $dir/$db1`
  test2=`md5sum $dir/$db2`
  if [ "$test1" == "$dist1  $db1" ] || [ "$test2" == "$dist2  $db2" ]; then
   olddefs="1"
  fi
 else
  olddefs="1"
 fi
 if [ "$olddefs" == "1" ]; then
  YN=yes;
  printf "\n\n*** Download the latest virus definitions now? [Yn] "
  read YN 
  : ${YN:=yes}
  case $YN in 
   [yY]|[yY][eE][sS]) %p/bin/freshclam ;;
  esac 
 fi
<<
ConfFiles: %p/etc/%n.conf %p/share/%n/viruses.db %p/share/%n/viruses.db2
DocFiles: TODO COPYING FAQ ChangeLog BUGS README NEWS AUTHORS
Maintainer: Carsten Klapp <carstenklapp@users.sourceforge.net>
Homepage: http://clamav.elektrapro.com/
License: GPL
Description: Clam Anti-virus scanner
DescDetail: <<
 Clam AntiVirus is an anti-virus scanner written from scratch. It is
 licensed under GNU GPL2 and uses the virus database from
 OpenAntiVirus, which is an another free anti-virus project. In
 contrast to the OpenAntiVirus which is written in Java, Clam
 AntiVirus is written entirely in C and is POSIX compliant.
<<
DescUsage: <<
 `clamscan -h` Outputs help information and exits.
 
 For virus updates, run `freshclam` as superuser from a shell prompt
 or in a cron script.

 Clamav handles most archive formats except those of unrar 3, for
 which it requires the unrar program.
<<
DescPackaging: <<
 Built with --disable-clamav to allow clamscan to run without
 superuser permissions.

 However, clamscan still requires a user named 'clamav' to run in
 superuser mode regardless of how it was built. (Important when
 running the post-build tests because fink runs as root).
 
 During the test the virus database isn't actually installed yet so
 the one in the build directory is specified.
<<
DescPort: <<
 Shared libraries disabled by '--enable-shared=no' so the program can
 be prebound. No other programs use libclam yet anyway.
 
 Note that the newer clamav 0.54 does not build properly on Mac OS X,
 it cannot scan inside archives without help from external utilities.
<<
