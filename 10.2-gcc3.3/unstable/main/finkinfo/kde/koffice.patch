diff -uNr koffice-1.3.4/admin/ltmain.sh koffice-1.3.4-new/admin/ltmain.sh
--- koffice-1.3.4/admin/ltmain.sh	2004-06-28 14:05:49.000000000 -0500
+++ koffice-1.3.4-new/admin/ltmain.sh	2004-11-04 11:42:57.000000000 -0600
@@ -4397,6 +4397,7 @@
 	# We should set the shlibpath_var
 	rpath=
 	for dir in $temp_rpath; do
+     if test "$dir" != "/sw/lib"; then
 	  case $dir in
 	  [\\/]* | [A-Za-z]:[\\/]*)
 	    # Absolute path.
@@ -4407,6 +4408,7 @@
 	    rpath="$rpath\$thisdir/$dir:"
 	    ;;
 	  esac
+     fi
 	done
 	temp_rpath="$rpath"
       fi
diff -uNr koffice-1.3.4/configure.in.in koffice-1.3.4-new/configure.in.in
--- koffice-1.3.4/configure.in.in	2004-10-01 17:32:16.000000000 -0500
+++ koffice-1.3.4-new/configure.in.in	2004-11-04 11:42:57.000000000 -0600
@@ -4,6 +4,8 @@
 
 CXXFLAGS="$CXXFLAGS $KDE_DEFAULT_CXXFLAGS"
 
+KDE_LIB_LTDL
+AC_LIBLTDL_CONVENIENCE
 AC_CHECK_HEADERS(unistd.h sys/param.h floatingpoint.h paths.h)
 AC_C_BIGENDIAN
 AC_CHECK_KDEMAXPATHLEN
diff -uNr koffice-1.3.4/example/Makefile.am koffice-1.3.4-new/example/Makefile.am
--- koffice-1.3.4/example/Makefile.am	2004-02-03 11:10:49.000000000 -0600
+++ koffice-1.3.4-new/example/Makefile.am	2004-11-04 11:42:57.000000000 -0600
@@ -8,21 +8,14 @@
 libexamplepart_la_LDFLAGS = $(KDE_PLUGIN)
 libexamplepart_la_LIBADD = $(LIB_KOFFICEUI)
 
-## The kdeinit loadable module
-lib_LTLIBRARIES = example.la
+bin_PROGRAMS =
+lib_LTLIBRARIES =
+kdeinit_LTLIBRARIES = example.la
+
 example_la_SOURCES = main.cc
 example_la_LDFLAGS = $(all_libraries) -module -avoid-version
 example_la_LIBADD = $(LIB_KOFFICEUI)
 
-## The executable
-bin_PROGRAMS = example
-example_SOURCES = dummy.cc
-example_LDFLAGS = $(all_libraries) $(KDE_RPATH)
-example_LDADD = example.la
-
-dummy.cc:
-	echo > dummy.cc
-
 METASOURCES = AUTO
 noinst_HEADERS =  example_part.h \
 	example_view.h example_factory.h example_aboutdata.h
diff -uNr koffice-1.3.4/example/main.cc koffice-1.3.4-new/example/main.cc
--- koffice-1.3.4/example/main.cc	2004-08-29 10:52:56.000000000 -0500
+++ koffice-1.3.4-new/example/main.cc	2004-11-04 11:42:57.000000000 -0600
@@ -32,7 +32,7 @@
 	KCmdLineLastOption
 };
 
-int main( int argc, char **argv )
+extern "C" int kdemain( int argc, char **argv )
 {
     KCmdLineArgs::init( argc, argv, newExampleAboutData() );
     KCmdLineArgs::addCmdLineOptions( options );
diff -uNr koffice-1.3.4/filters/karbon/ai/Makefile.am koffice-1.3.4-new/filters/karbon/ai/Makefile.am
--- koffice-1.3.4/filters/karbon/ai/Makefile.am	2002-10-29 14:22:16.000000000 -0600
+++ koffice-1.3.4-new/filters/karbon/ai/Makefile.am	2004-11-04 11:42:57.000000000 -0600
@@ -2,7 +2,7 @@
 
 libkarbonaiimport_la_LIBADD = \
 	$(LIB_KOFFICEUI) \
-	../../../karbon/libkarbonpart.la
+	../../../karbon/libkarboncommon.la
 
 libkarbonaiimport_la_LDFLAGS = \
 	$(all_libraries) \
diff -uNr koffice-1.3.4/filters/karbon/eps/Makefile.am koffice-1.3.4-new/filters/karbon/eps/Makefile.am
--- koffice-1.3.4/filters/karbon/eps/Makefile.am	2003-08-20 05:38:37.000000000 -0500
+++ koffice-1.3.4-new/filters/karbon/eps/Makefile.am	2004-11-04 11:42:57.000000000 -0600
@@ -7,7 +7,7 @@
 	epsexportdlg.cc 
 
 libkarbonepsexport_la_LDFLAGS = $(KDE_PLUGIN)
-libkarbonepsexport_la_LIBADD  = $(LIB_KOFFICEUI) ../../../karbon/libkarbonpart.la
+libkarbonepsexport_la_LIBADD  = $(LIB_KOFFICEUI) ../../../karbon/libkarboncommon.la
 
 libkarbonepsimport_la_SOURCES = epsimport.cc pscommentlexer.cc
 libkarbonepsimport_la_LDFLAGS = $(KDE_PLUGIN)
diff -uNr koffice-1.3.4/filters/karbon/kontour/Makefile.am koffice-1.3.4-new/filters/karbon/kontour/Makefile.am
--- koffice-1.3.4/filters/karbon/kontour/Makefile.am	2003-03-26 10:31:07.000000000 -0600
+++ koffice-1.3.4-new/filters/karbon/kontour/Makefile.am	2004-11-04 11:42:57.000000000 -0600
@@ -11,7 +11,7 @@
 
 libkarbonkontourimport_la_SOURCES = kontourimport.cpp
 libkarbonkontourimport_la_LDFLAGS = -module $(KDE_PLUGIN)
-libkarbonkontourimport_la_LIBADD = $(KOFFICE_LIBS) ../../../karbon/libkarbonpart.la
+libkarbonkontourimport_la_LIBADD = $(KOFFICE_LIBS) ../../../karbon/libkarboncommon.la
 
 METASOURCES = AUTO
 
diff -uNr koffice-1.3.4/filters/karbon/msod/Makefile.am koffice-1.3.4-new/filters/karbon/msod/Makefile.am
--- koffice-1.3.4/filters/karbon/msod/Makefile.am	2003-01-24 11:28:39.000000000 -0600
+++ koffice-1.3.4-new/filters/karbon/msod/Makefile.am	2004-11-04 11:42:57.000000000 -0600
@@ -2,7 +2,7 @@
 
 INCLUDES= -I$(srcdir) $(KOFFICE_INCLUDES) $(all_includes)
 libkarbonmsodimport_la_LDFLAGS	= -module -avoid-version -no-undefined $(all_libraries)
-libkarbonmsodimport_la_LIBADD = $(KOFFICE_LIBS)
+libkarbonmsodimport_la_LIBADD = $(KOFFICE_LIBS) $(LIBZ)
 
 ####### Files
 
diff -uNr koffice-1.3.4/filters/karbon/oodraw/Makefile.am koffice-1.3.4-new/filters/karbon/oodraw/Makefile.am
--- koffice-1.3.4/filters/karbon/oodraw/Makefile.am	2003-03-30 04:19:35.000000000 -0600
+++ koffice-1.3.4-new/filters/karbon/oodraw/Makefile.am	2004-11-04 11:42:57.000000000 -0600
@@ -14,7 +14,7 @@
 liboodrawimport_la_SOURCES = oodrawimport.cc
 liboodrawimport_la_LDFLAGS = $(all_libraries) -module -avoid-version -no-undefined
 liboodrawimport_la_LIBADD  = ../../liboofilter/liboofilter.la \
-							../../../karbon/libkarbonpart.la \
+							../../../karbon/libkarboncommon.la \
 							$(KOFFICE_LIBS)
 
 METASOURCES = AUTO
diff -uNr koffice-1.3.4/filters/karbon/png/Makefile.am koffice-1.3.4-new/filters/karbon/png/Makefile.am
--- koffice-1.3.4/filters/karbon/png/Makefile.am	2002-09-13 15:33:56.000000000 -0500
+++ koffice-1.3.4-new/filters/karbon/png/Makefile.am	2004-11-04 11:42:58.000000000 -0600
@@ -3,7 +3,7 @@
 libkarbonpngexport_la_LDFLAGS = $(KDE_PLUGIN)
 libkarbonpngexport_la_LIBADD = \
 	$(LIB_KOFFICEUI) \
-	../../../karbon/libkarbonpart.la
+	../../../karbon/libkarboncommon.la
 
 INCLUDES = \
 	$(KOFFICE_INCLUDES) $(KOPAINTER_INCLUDES) \
diff -uNr koffice-1.3.4/filters/karbon/svg/Makefile.am koffice-1.3.4-new/filters/karbon/svg/Makefile.am
--- koffice-1.3.4/filters/karbon/svg/Makefile.am	2003-10-15 13:51:58.000000000 -0500
+++ koffice-1.3.4-new/filters/karbon/svg/Makefile.am	2004-11-04 11:42:58.000000000 -0600
@@ -3,12 +3,12 @@
 libkarbonsvgexport_la_LDFLAGS = $(KDE_PLUGIN)
 libkarbonsvgexport_la_LIBADD = \
 	$(LIB_KOFFICEUI) \
-	../../../karbon/libkarbonpart.la
+	../../../karbon/libkarboncommon.la
 
 libkarbonsvgimport_la_LDFLAGS = $(KDE_PLUGIN)
 libkarbonsvgimport_la_LIBADD = \
 	$(LIB_KOFFICEUI) \
-	../../../karbon/libkarbonpart.la
+	../../../karbon/libkarboncommon.la
 
 INCLUDES = \
 	$(KOFFICE_INCLUDES) \
diff -uNr koffice-1.3.4/filters/karbon/wmf/Makefile.am koffice-1.3.4-new/filters/karbon/wmf/Makefile.am
--- koffice-1.3.4/filters/karbon/wmf/Makefile.am	2003-08-20 05:38:39.000000000 -0500
+++ koffice-1.3.4-new/filters/karbon/wmf/Makefile.am	2004-11-04 11:42:58.000000000 -0600
@@ -12,12 +12,12 @@
 kde_module_LTLIBRARIES = libwmfimport.la libwmfexport.la
 
 libwmfimport_la_LDFLAGS = -module $(KDE_PLUGIN)
-libwmfimport_la_LIBADD = $(KOFFICE_LIBS) $(LIB_KOWMF) ../../../karbon/libkarbonpart.la
-#libwmfimport_la_LIBADD = $(KOFFICE_LIBS) $(LIB_KOWMF) ../../../karbon/libkarbonpart.la
+libwmfimport_la_LIBADD = $(KOFFICE_LIBS) $(LIB_KOWMF) ../../../karbon/libkarboncommon.la
+#libwmfimport_la_LIBADD = $(KOFFICE_LIBS) $(LIB_KOWMF) ../../../karbon/libkarboncommon.la
 libwmfimport_la_SOURCES = wmfimport.cc wmfimportparser.cc
 
 libwmfexport_la_LDFLAGS = -module $(KDE_PLUGIN)
-libwmfexport_la_LIBADD = $(KOFFICE_LIBS) $(LIB_KOWMF) ../../../karbon/libkarbonpart.la
+libwmfexport_la_LIBADD = $(KOFFICE_LIBS) $(LIB_KOWMF) ../../../karbon/libkarboncommon.la
 libwmfexport_la_SOURCES = wmfexport.cc
 
 noinst_HEADERS = wmfimport.h wmfimportparser.h wmfexport.h 
diff -uNr koffice-1.3.4/filters/karbon/xcf/Makefile.am koffice-1.3.4-new/filters/karbon/xcf/Makefile.am
--- koffice-1.3.4/filters/karbon/xcf/Makefile.am	2002-09-14 07:14:14.000000000 -0500
+++ koffice-1.3.4-new/filters/karbon/xcf/Makefile.am	2004-11-04 11:42:58.000000000 -0600
@@ -3,7 +3,7 @@
 libkarbonxcfexport_la_LDFLAGS = $(KDE_PLUGIN)
 libkarbonxcfexport_la_LIBADD = \
 	$(LIB_KOFFICEUI) \
-	../../../karbon/libkarbonpart.la
+	../../../karbon/libkarboncommon.la
 
 INCLUDES = \
 	$(KOFFICE_INCLUDES) $(KOPAINTER_INCLUDES) \
diff -uNr koffice-1.3.4/filters/kspread/csv/Makefile.am koffice-1.3.4-new/filters/kspread/csv/Makefile.am
--- koffice-1.3.4/filters/kspread/csv/Makefile.am	2002-10-29 14:22:30.000000000 -0600
+++ koffice-1.3.4-new/filters/kspread/csv/Makefile.am	2004-11-04 11:42:58.000000000 -0600
@@ -9,11 +9,11 @@
 
 libcsvimport_la_SOURCES = csvimport.cc xmltree.cc csvdialog.cpp dialogui.ui
 libcsvimport_la_LDFLAGS	= $(all_libraries) -module -avoid-version -no-undefined 
-libcsvimport_la_LIBADD  = $(KOFFICE_LIBS) ../../../kspread/libkspreadpart.la
+libcsvimport_la_LIBADD  = $(KOFFICE_LIBS) ../../../kspread/libkspreadcommon.la
 
 libcsvexport_la_SOURCES = csvexport.cc csvexportdialog.cpp exportdialogui.ui
 libcsvexport_la_LDFLAGS = $(all_libraries) -module -avoid-version -no-undefined
-libcsvexport_la_LIBADD  = $(KOFFICE_LIBS) ../../../kspread/libkspreadpart.la
+libcsvexport_la_LIBADD  = $(KOFFICE_LIBS) ../../../kspread/libkspreadcommon.la
 
 METASOURCES = AUTO
 
diff -uNr koffice-1.3.4/filters/kspread/excel/Makefile.am koffice-1.3.4-new/filters/kspread/excel/Makefile.am
--- koffice-1.3.4/filters/kspread/excel/Makefile.am	2002-12-13 12:48:35.000000000 -0600
+++ koffice-1.3.4-new/filters/kspread/excel/Makefile.am	2004-11-04 11:42:58.000000000 -0600
@@ -9,7 +9,7 @@
 
 libkspreadexcelexport_la_SOURCES = excelexport.cc
 libkspreadexcelexport_la_LDFLAGS = $(all_libraries) -module -avoid-version -no-undefined
-libkspreadexcelexport_la_LIBADD  = $(KOFFICE_LIBS) ../../../kspread/libkspreadpart.la ../libkspreadexport/libkspreadexport.la
+libkspreadexcelexport_la_LIBADD  = $(KOFFICE_LIBS) ../../../kspread/libkspreadcommon.la ../libkspreadexport/libkspreadexport.la
 
 METASOURCES = AUTO
 
diff -uNr koffice-1.3.4/filters/kspread/gnumeric/Makefile.am koffice-1.3.4-new/filters/kspread/gnumeric/Makefile.am
--- koffice-1.3.4/filters/kspread/gnumeric/Makefile.am	2002-10-29 14:22:30.000000000 -0600
+++ koffice-1.3.4-new/filters/kspread/gnumeric/Makefile.am	2004-11-04 11:42:58.000000000 -0600
@@ -8,11 +8,11 @@
 
 libgnumericexport_la_SOURCES = gnumericexport.cc
 libgnumericexport_la_LDFLAGS = $(all_libraries) -module -avoid-version -no-undefined
-libgnumericexport_la_LIBADD  = $(KOFFICE_LIBS) ../../../kspread/libkspreadpart.la
+libgnumericexport_la_LIBADD  = $(KOFFICE_LIBS) ../../../kspread/libkspreadcommon.la $(LIBZ)
 
 libgnumericimport_la_SOURCES = gnumericimport.cc
 libgnumericimport_la_LDFLAGS = $(all_libraries) -module -avoid-version -no-undefined
-libgnumericimport_la_LIBADD  = $(KOFFICE_LIBS) ../../../kspread/libkspreadpart.la
+libgnumericimport_la_LIBADD  = $(KOFFICE_LIBS) ../../../kspread/libkspreadcommon.la $(LIBZ)
 
 METASOURCES = AUTO
 
diff -uNr koffice-1.3.4/filters/kspread/html/Makefile.am koffice-1.3.4-new/filters/kspread/html/Makefile.am
--- koffice-1.3.4/filters/kspread/html/Makefile.am	2002-10-29 14:22:31.000000000 -0600
+++ koffice-1.3.4-new/filters/kspread/html/Makefile.am	2004-11-04 11:42:58.000000000 -0600
@@ -9,7 +9,7 @@
 
 libkspreadhtmlexport_la_SOURCES = htmlexport.cc
 libkspreadhtmlexport_la_LDFLAGS = $(all_libraries) -module -avoid-version -no-undefined
-libkspreadhtmlexport_la_LIBADD  = $(KOFFICE_LIBS) ../../../kspread/libkspreadpart.la
+libkspreadhtmlexport_la_LIBADD  = $(KOFFICE_LIBS) ../../../kspread/libkspreadcommon.la
 
 METASOURCES = AUTO
 
diff -uNr koffice-1.3.4/filters/kspread/libkspreadexport/Makefile.am koffice-1.3.4-new/filters/kspread/libkspreadexport/Makefile.am
--- koffice-1.3.4/filters/kspread/libkspreadexport/Makefile.am	2002-12-01 17:11:06.000000000 -0600
+++ koffice-1.3.4-new/filters/kspread/libkspreadexport/Makefile.am	2004-11-04 11:42:58.000000000 -0600
@@ -5,7 +5,7 @@
 
 libkspreadexport_la_LDFLAGS = $(all_libraries) -module -version-info 1:0:0 -no-undefined
 
-libkspreadexport_la_LIBADD = $(KOFFICE_LIBS) ../../../kspread/libkspreadpart.la
+libkspreadexport_la_LIBADD = $(KOFFICE_LIBS) ../../../kspread/libkspreadcommon.la
 
 ####### Files
 
diff -uNr koffice-1.3.4/filters/kspread/opencalc/Makefile.am koffice-1.3.4-new/filters/kspread/opencalc/Makefile.am
--- koffice-1.3.4/filters/kspread/opencalc/Makefile.am	2004-04-24 16:48:22.000000000 -0500
+++ koffice-1.3.4-new/filters/kspread/opencalc/Makefile.am	2004-11-04 11:42:58.000000000 -0600
@@ -9,11 +9,11 @@
 
 libopencalcexport_la_SOURCES = opencalcexport.cc opencalcstyleexport.cc
 libopencalcexport_la_LDFLAGS = $(all_libraries) -module -avoid-version -no-undefined
-libopencalcexport_la_LIBADD  = $(KOFFICE_LIBS) ../../../kspread/libkspreadpart.la
+libopencalcexport_la_LIBADD  = $(KOFFICE_LIBS) ../../../kspread/libkspreadcommon.la
 
 libopencalcimport_la_SOURCES = opencalcimport.cc
 libopencalcimport_la_LDFLAGS = $(all_libraries) -module -avoid-version -no-undefined
-libopencalcimport_la_LIBADD  = $(KOFFICE_LIBS) ../../../kspread/libkspreadpart.la ../../liboofilter/liboofilter.la
+libopencalcimport_la_LIBADD  = $(KOFFICE_LIBS) ../../../kspread/libkspreadcommon.la ../../liboofilter/liboofilter.la
 
 METASOURCES = AUTO
 
diff -uNr koffice-1.3.4/filters/kspread/qpro/Makefile.am koffice-1.3.4-new/filters/kspread/qpro/Makefile.am
--- koffice-1.3.4/filters/kspread/qpro/Makefile.am	2002-10-29 14:22:38.000000000 -0600
+++ koffice-1.3.4-new/filters/kspread/qpro/Makefile.am	2004-11-04 11:42:58.000000000 -0600
@@ -13,7 +13,7 @@
 libqproimport_la_SOURCES = qproimport.cc qproformula.cc
 
 libqproimport_la_LDFLAGS = $(all_libraries) -module -avoid-version -no-undefined
-libqproimport_la_LIBADD  = $(KOFFICE_LIBS) ../../../kspread/libkspreadpart.la \
+libqproimport_la_LIBADD  = $(KOFFICE_LIBS) ../../../kspread/libkspreadcommon.la \
 	libqpro/src/libqpro.la
 
 METASOURCES = AUTO
diff -uNr koffice-1.3.4/filters/kword/abiword/Makefile.am koffice-1.3.4-new/filters/kword/abiword/Makefile.am
--- koffice-1.3.4/filters/kword/abiword/Makefile.am	2002-12-27 14:27:13.000000000 -0600
+++ koffice-1.3.4-new/filters/kword/abiword/Makefile.am	2004-11-04 11:42:58.000000000 -0600
@@ -1,5 +1,7 @@
 ####### General stuff
 
+KDE_CXXFLAGS=-O
+
 INCLUDES= -I$(srcdir) $(KOFFICE_INCLUDES) -I$(srcdir)/../libexport $(all_includes)
 
 libabiwordimport_la_LDFLAGS	= $(all_libraries) -module -avoid-version -no-undefined
diff -uNr koffice-1.3.4/filters/kword/pdf/xpdf/xpdf/Catalog.cc koffice-1.3.4-new/filters/kword/pdf/xpdf/xpdf/Catalog.cc
--- koffice-1.3.4/filters/kword/pdf/xpdf/xpdf/Catalog.cc	2004-10-23 02:01:23.000000000 -0500
+++ koffice-1.3.4-new/filters/kword/pdf/xpdf/xpdf/Catalog.cc	2004-11-04 11:43:46.000000000 -0600
@@ -12,6 +12,7 @@
 #pragma implementation
 #endif
 
+#include <limits.h>
 #include <stddef.h>
 #include "gmem.h"
 #include "Object.h"
@@ -63,8 +64,8 @@
   }
   pagesSize = numPages0 = obj.getInt();
   obj.free();
-  if (pagesSize*sizeof(Page *)/sizeof(Page *) != pagesSize ||
-      pagesSize*sizeof(Ref)/sizeof(Ref) != pagesSize) {
+  if ((unsigned) pagesSize >= INT_MAX / sizeof(Page *) ||
+      (unsigned) pagesSize >= INT_MAX / sizeof(Ref)) {
     error(-1, "Invalid 'pagesSize'");
     ok = gFalse;
     return;
@@ -196,8 +197,8 @@
       }
       if (start >= pagesSize) {
 	pagesSize += 32;
-        if (pagesSize*sizeof(Page *)/sizeof(Page *) != pagesSize ||
-            pagesSize*sizeof(Ref)/sizeof(Ref) != pagesSize) {
+        if ((unsigned) pagesSize >= INT_MAX / sizeof(Page *) ||
+            (unsigned) pagesSize >= INT_MAX / sizeof(Ref)) {
           error(-1, "Invalid 'pagesSize' parameter.");
           goto err3;
         }
diff -uNr koffice-1.3.4/filters/kword/pdf/xpdf/xpdf/XRef.cc koffice-1.3.4-new/filters/kword/pdf/xpdf/xpdf/XRef.cc
--- koffice-1.3.4/filters/kword/pdf/xpdf/xpdf/XRef.cc	2004-10-23 02:01:23.000000000 -0500
+++ koffice-1.3.4-new/filters/kword/pdf/xpdf/xpdf/XRef.cc	2004-11-04 11:43:46.000000000 -0600
@@ -12,6 +12,7 @@
 #pragma implementation
 #endif
 
+#include <limits.h>
 #include <stdlib.h>
 #include <stddef.h>
 #include <string.h>
@@ -76,7 +77,7 @@
 
   // trailer is ok - read the xref table
   } else {
-    if (size*sizeof(XRefEntry)/sizeof(XRefEntry) != size) {
+    if ((unsigned) size >= INT_MAX / sizeof(XRefEntry)) {
       error(-1, "Invalid 'size' inside xref table.");
       ok = gFalse;
       errCode = errDamaged;
@@ -273,7 +274,7 @@
     // table size
     if (first + n > size) {
       newSize = size + 256;
-      if (newSize*sizeof(XRefEntry)/sizeof(XRefEntry) != newSize) {
+      if ((unsigned) newSize >= INT_MAX / sizeof(XRefEntry)) {
         error(-1, "Invalid 'newSize'");
         goto err2;
       }
@@ -420,7 +421,7 @@
 	    if (!strncmp(p, "obj", 3)) {
 	      if (num >= size) {
 		newSize = (num + 1 + 255) & ~255;
-	        if (newSize*sizeof(XRefEntry)/sizeof(XRefEntry) != newSize) {
+	        if ((unsigned) newSize >= INT_MAX / sizeof(XRefEntry)) {
 	          error(-1, "Invalid 'obj' parameters.");
 	          return gFalse;
 	        }
@@ -445,7 +446,7 @@
     } else if (!strncmp(p, "endstream", 9)) {
       if (streamEndsLen == streamEndsSize) {
 	streamEndsSize += 64;
-        if (streamEndsSize*sizeof(int)/sizeof(int) != streamEndsSize) {
+        if ((unsigned) streamEndsSize >= INT_MAX / sizeof(int)) {
           error(-1, "Invalid 'endstream' parameter.");
           return gFalse;
         }
diff -uNr koffice-1.3.4/karbon/Makefile.am koffice-1.3.4-new/karbon/Makefile.am
--- koffice-1.3.4/karbon/Makefile.am	2003-10-16 09:03:47.000000000 -0500
+++ koffice-1.3.4-new/karbon/Makefile.am	2004-11-04 11:42:58.000000000 -0600
@@ -12,22 +12,21 @@
 
 SUBDIRS = commands visitors core shapes widgets dialogs dockers render tools . plugins data pics
 
-bin_PROGRAMS = karbon
-
-lib_LTLIBRARIES = karbon.la
-kde_module_LTLIBRARIES = libkarbonbase.la libkarbonpart.la
-
-libkarbonpart_la_SOURCES = karbon_factory.cc 	karbon_resourceserver.cc 	karbon_part.cc 	karbon_part_iface.cc 	karbon_part_iface.skel 	karbon_view.cc 	karbon_view_iface.cc 	karbon_view_iface.skel karbon_drag.cpp
+bin_PROGRAMS = 
+lib_LTLIBRARIES = libkarboncommon.la libkarbonbase.la
+kdeinit_LTLIBRARIES = karbon.la
+kde_module_LTLIBRARIES = libkarbonpart.la
 
 libkarbonbase_la_SOURCES = \
 	karbon_view_base.cc \
 	karbon_part_base.cc
 
-libkarbonbase_la_LDFLAGS = $(KDE_PLUGIN)
+libkarbonbase_la_LDFLAGS = $(KDE_RPATH)
 libkarbonbase_la_LIBADD = $(LIB_KOFFICEUI)
 
-libkarbonpart_la_LDFLAGS = $(KDE_PLUGIN) $(LIBFREETYPE_RPATH)
-libkarbonpart_la_LIBADD = $(LIB_KOFFICEUI) $(LIB_KOPAINTER) \
+libkarboncommon_la_SOURCES = karbon_factory.cc 	karbon_resourceserver.cc 	karbon_part.cc 	karbon_part_iface.cc 	karbon_part_iface.skel 	karbon_view.cc 	karbon_view_iface.cc 	karbon_view_iface.skel karbon_drag.cpp
+libkarboncommon_la_LDFLAGS = $(KDE_RPATH) $(LIBFREETYPE_RPATH)
+libkarboncommon_la_LIBADD  = $(LIB_X11) $(LIB_KOFFICEUI) $(LIB_KOPAINTER) \
 	dockers/libkarbondockers.la \
 	widgets/libkarbonwidgets.la \
 	render/libvpainter.la \
@@ -43,18 +42,17 @@
 	$(LIBFONTCONFIG_LIBS) \
 	$(LIBFREETYPE_LIBS)
 
+libkarbonpart_la_SOURCES = dummy.cpp
+libkarbonpart_la_LDFLAGS = $(KDE_PLUGIN) $(LIBFREETYPE_RPATH)
+libkarbonpart_la_LIBADD = libkarboncommon.la
 libkarbonpart_la_METASOURCES = AUTO
 
 karbon_la_SOURCES = main.cc
 karbon_la_LDFLAGS = $(all_libraries) -module -avoid-version
-karbon_la_LIBADD = libkarbonpart.la
-
-karbon_SOURCES = dummy.cc
-karbon_LDFLAGS = $(all_libraries) $(KDE_RPATH)
-karbon_LDADD = karbon.la
+karbon_la_LIBADD = libkarboncommon.la
 
-dummy.cc:
-	echo > dummy.cc
+dummy.cpp:
+	echo > dummy.cpp
 
 noinst_HEADERS = \
 	karbon_factory.h \
diff -uNr koffice-1.3.4/karbon/main.cc koffice-1.3.4-new/karbon/main.cc
--- koffice-1.3.4/karbon/main.cc	2004-08-29 10:52:58.000000000 -0500
+++ koffice-1.3.4-new/karbon/main.cc	2004-11-04 11:42:58.000000000 -0600
@@ -34,7 +34,7 @@
 		KCmdLineLastOption
 	};
 
-int main( int argc, char* argv[] )
+extern "C" int kdemain( int argc, char* argv[] )
 {
 	KCmdLineArgs::init( argc, argv, KarbonFactory::aboutData() );
 	KCmdLineArgs::addCmdLineOptions( options );
diff -uNr koffice-1.3.4/karbon/plugins/flattenpath/Makefile.am koffice-1.3.4-new/karbon/plugins/flattenpath/Makefile.am
--- koffice-1.3.4/karbon/plugins/flattenpath/Makefile.am	2003-03-26 10:31:39.000000000 -0600
+++ koffice-1.3.4-new/karbon/plugins/flattenpath/Makefile.am	2004-11-04 11:42:58.000000000 -0600
@@ -4,7 +4,7 @@
 
 karbon_flattenpathplugin_la_SOURCES = flattenpathplugin.cc
 karbon_flattenpathplugin_la_LIBADD = $(LIB_KPARTS) $(LIB_KOFFICEUI) \
-				../../libkarbonpart.la
+				../../libkarboncommon.la
 
 karbon_flattenpathplugin_la_LDFLAGS = $(all_libraries) -module $(KDE_PLUGIN)
 
diff -uNr koffice-1.3.4/karbon/plugins/imagetool/Makefile.am koffice-1.3.4-new/karbon/plugins/imagetool/Makefile.am
--- koffice-1.3.4/karbon/plugins/imagetool/Makefile.am	2003-03-26 10:31:39.000000000 -0600
+++ koffice-1.3.4-new/karbon/plugins/imagetool/Makefile.am	2004-11-04 11:42:58.000000000 -0600
@@ -4,7 +4,7 @@
 
 karbon_imagetoolplugin_la_SOURCES = imagetoolplugin.cc
 karbon_imagetoolplugin_la_LIBADD = $(LIB_KPARTS) $(LIB_KOFFICEUI) \
-				../../libkarbonpart.la
+				../../libkarboncommon.la
 
 karbon_imagetoolplugin_la_LDFLAGS = $(all_libraries) -module $(KDE_PLUGIN)
 
diff -uNr koffice-1.3.4/karbon/plugins/insertknots/Makefile.am koffice-1.3.4-new/karbon/plugins/insertknots/Makefile.am
--- koffice-1.3.4/karbon/plugins/insertknots/Makefile.am	2003-03-26 10:31:39.000000000 -0600
+++ koffice-1.3.4-new/karbon/plugins/insertknots/Makefile.am	2004-11-04 11:42:58.000000000 -0600
@@ -4,7 +4,7 @@
 
 karbon_insertknotsplugin_la_SOURCES = insertknotsplugin.cc
 karbon_insertknotsplugin_la_LIBADD = $(LIB_KPARTS) \
-					../../libkarbonpart.la
+					../../libkarboncommon.la
 
 karbon_insertknotsplugin_la_LDFLAGS = $(all_libraries) -module $(KDE_PLUGIN)
 
diff -uNr koffice-1.3.4/karbon/plugins/roundcorners/Makefile.am koffice-1.3.4-new/karbon/plugins/roundcorners/Makefile.am
--- koffice-1.3.4/karbon/plugins/roundcorners/Makefile.am	2003-03-26 10:31:39.000000000 -0600
+++ koffice-1.3.4-new/karbon/plugins/roundcorners/Makefile.am	2004-11-04 11:42:58.000000000 -0600
@@ -4,7 +4,7 @@
 
 karbon_roundcornersplugin_la_SOURCES = roundcornersplugin.cc
 karbon_roundcornersplugin_la_LIBADD = $(LIB_KPARTS) \
-					../../libkarbonpart.la
+					../../libkarboncommon.la
 
 karbon_roundcornersplugin_la_LDFLAGS = $(all_libraries) -module $(KDE_PLUGIN)
 
diff -uNr koffice-1.3.4/karbon/plugins/shadoweffect/Makefile.am koffice-1.3.4-new/karbon/plugins/shadoweffect/Makefile.am
--- koffice-1.3.4/karbon/plugins/shadoweffect/Makefile.am	2003-03-26 10:31:39.000000000 -0600
+++ koffice-1.3.4-new/karbon/plugins/shadoweffect/Makefile.am	2004-11-04 11:42:58.000000000 -0600
@@ -4,7 +4,7 @@
 
 karbon_shadoweffectplugin_la_SOURCES = shadoweffectplugin.cc vshadowdecorator.cc 
 karbon_shadoweffectplugin_la_LIBADD = $(LIB_KPARTS) $(LIB_KOFFICEUI) \
-					../../libkarbonpart.la
+					../../libkarboncommon.la
 
 karbon_shadoweffectplugin_la_LDFLAGS = $(all_libraries) -module $(KDE_PLUGIN)
 
diff -uNr koffice-1.3.4/karbon/plugins/whirlpinch/Makefile.am koffice-1.3.4-new/karbon/plugins/whirlpinch/Makefile.am
--- koffice-1.3.4/karbon/plugins/whirlpinch/Makefile.am	2003-08-20 05:43:15.000000000 -0500
+++ koffice-1.3.4-new/karbon/plugins/whirlpinch/Makefile.am	2004-11-04 11:42:58.000000000 -0600
@@ -4,7 +4,7 @@
 
 karbon_whirlpinchplugin_la_SOURCES = whirlpinchplugin.cc
 karbon_whirlpinchplugin_la_LIBADD = $(LIB_KPARTS) $(LIB_KOPAINTER) \
-				../../libkarbonpart.la
+				../../libkarboncommon.la
 
 
 karbon_whirlpinchplugin_la_LDFLAGS = $(all_libraries) -module $(KDE_PLUGIN)
diff -uNr koffice-1.3.4/karbon/plugins/zoomtool/Makefile.am koffice-1.3.4-new/karbon/plugins/zoomtool/Makefile.am
--- koffice-1.3.4/karbon/plugins/zoomtool/Makefile.am	2003-03-26 10:31:39.000000000 -0600
+++ koffice-1.3.4-new/karbon/plugins/zoomtool/Makefile.am	2004-11-04 11:42:58.000000000 -0600
@@ -4,7 +4,7 @@
 
 karbon_zoomtoolplugin_la_SOURCES = zoomtoolplugin.cc
 karbon_zoomtoolplugin_la_LIBADD = $(LIB_KPARTS) $(LIB_KOFFICEUI) \
-				../../libkarbonpart.la
+				../../libkarboncommon.la
 
 karbon_zoomtoolplugin_la_LDFLAGS = $(all_libraries) -module $(KDE_PLUGIN)
 
diff -uNr koffice-1.3.4/kchart/Makefile.am koffice-1.3.4-new/kchart/Makefile.am
--- koffice-1.3.4/kchart/Makefile.am	2004-02-03 11:11:27.000000000 -0600
+++ koffice-1.3.4-new/kchart/Makefile.am	2004-11-04 11:42:58.000000000 -0600
@@ -1,5 +1,8 @@
 INCLUDES  = $(KOFFICE_INCLUDES) -I$(srcdir)/kdchart -I$(top_srcdir)/interfaces -I$(interfacedir) $(all_includes)
 
+bin_PROGRAMS =
+lib_LTLIBRARIES =
+
 ## The part
 kde_module_LTLIBRARIES = libkchartpart.la
 libkchartpart_la_SOURCES = kchart_part.cc \
@@ -39,20 +42,11 @@
 			  kdchart/libkdchart.la			
 
 ## The kdeinit loadable module
-lib_LTLIBRARIES = kchart.la
+kdeinit_LTLIBRARIES = kchart.la
 kchart_la_SOURCES = main.cc
 kchart_la_LDFLAGS = $(all_libraries) -avoid-version -module
 kchart_la_LIBADD = $(LIB_KOFFICECORE)
 
-## The executable
-bin_PROGRAMS = kchart
-kchart_SOURCES = dummy.cc
-kchart_LDFLAGS = $(all_libraries) $(KDE_RPATH)
-kchart_LDADD = kchart.la
-
-dummy.cc:
-	echo > dummy.cc
-
 noinst_HEADERS =  kchart_part.h \
 		kchart_view.h kchart_factory.h \
 		kchartBarConfigDialog.h \
diff -uNr koffice-1.3.4/kchart/kdchart/Makefile.am koffice-1.3.4-new/kchart/kdchart/Makefile.am
--- koffice-1.3.4/kchart/kdchart/Makefile.am	2003-12-28 02:21:29.000000000 -0600
+++ koffice-1.3.4-new/kchart/kdchart/Makefile.am	2004-11-04 11:42:58.000000000 -0600
@@ -1,5 +1,7 @@
 lib_LTLIBRARIES = libkdchart.la
 
+libkdchart_la_LDFLAGS = $(all_libraries)
+libkdchart_la_LIBADD = $(LIB_KDECORE) $(LIBZ)
 libkdchart_la_SOURCES = KDChart.cpp 		\
 			KDChartAreaPainter.cpp	\
 			KDChartAxesPainter.cpp	\
diff -uNr koffice-1.3.4/kchart/main.cc koffice-1.3.4-new/kchart/main.cc
--- koffice-1.3.4/kchart/main.cc	2003-01-24 10:48:17.000000000 -0600
+++ koffice-1.3.4-new/kchart/main.cc	2004-11-04 11:42:58.000000000 -0600
@@ -28,7 +28,7 @@
 	KCmdLineLastOption
 };
 
-int main( int argc, char **argv )
+extern "C" int kdemain( int argc, char **argv )
 {
     KCmdLineArgs::init( argc, argv, newKChartAboutData());
     KCmdLineArgs::addCmdLineOptions( options );
diff -uNr koffice-1.3.4/kformula/Makefile.am koffice-1.3.4-new/kformula/Makefile.am
--- koffice-1.3.4/kformula/Makefile.am	2004-02-03 11:11:58.000000000 -0600
+++ koffice-1.3.4-new/kformula/Makefile.am	2004-11-04 11:42:58.000000000 -0600
@@ -11,20 +11,13 @@
 libkformulapart_la_LIBADD = $(LIB_KOFFICEUI) $(LIB_KFORMULA) $(LIB_KOTEXT)
 libkformulapart_la_METASOURCES = AUTO
 
-## The kdeinit loadable module
-lib_LTLIBRARIES = kformulamain.la
-kformulamain_la_SOURCES = main.cc
-kformulamain_la_LDFLAGS = $(all_libraries) -module -avoid-version
-kformulamain_la_LIBADD = $(LIB_KOFFICECORE)
-
-## The executable
-bin_PROGRAMS = kformula
-kformula_SOURCES = dummy.cc
-kformula_LDFLAGS = $(all_libraries) $(KDE_RPATH)
-kformula_LDADD = kformulamain.la
-
-dummy.cc:
-	echo > dummy.cc
+bin_PROGRAMS =
+lib_LTLIBRARIES =
+kdeinit_LTLIBRARIES = kformula.la
+
+kformula_la_SOURCES = main.cc
+kformula_la_LDFLAGS = $(all_libraries) -module -avoid-version
+kformula_la_LIBADD = $(LIB_KOFFICECORE)
 
 noinst_HEADERS =  kformula_doc.h \
 		  kformula_view.h kformula_factory.h \
diff -uNr koffice-1.3.4/kformula/main.cc koffice-1.3.4-new/kformula/main.cc
--- koffice-1.3.4/kformula/main.cc	2004-08-29 10:53:01.000000000 -0500
+++ koffice-1.3.4-new/kformula/main.cc	2004-11-04 11:42:58.000000000 -0600
@@ -31,7 +31,7 @@
         KCmdLineLastOption
 };
 
-int main( int argc, char **argv )
+extern "C" int kdemain( int argc, char **argv )
 {
     KCmdLineArgs::init( argc, argv, newKFormulaAboutData() );
     KCmdLineArgs::addCmdLineOptions( options );
diff -uNr koffice-1.3.4/kivio/kiviopart/Makefile.am koffice-1.3.4-new/kivio/kiviopart/Makefile.am
--- koffice-1.3.4/kivio/kiviopart/Makefile.am	2004-02-03 11:12:25.000000000 -0600
+++ koffice-1.3.4-new/kivio/kiviopart/Makefile.am	2004-11-04 11:42:58.000000000 -0600
@@ -11,18 +11,19 @@
 
 
 kde_module_LTLIBRARIES = libkiviopart.la
+lib_LTLIBRARIES = libkiviocommon.la
 
-libkiviopart_la_LDFLAGS = -avoid-version -module $(all_libraries) -no-undefined
+libkiviocommon_la_LDFLAGS = $(all_libraries) -no-undefined
 
-libkiviopart_la_LIBADD = \
+libkiviocommon_la_LIBADD = \
 	$(top_builddir)/kivio/kiviopart/tools/libtools.la\
 	$(top_builddir)/kivio/kiviopart/kiviosdk/libkiviosdk.la\
 	$(top_builddir)/kivio/kiviopart/ui/libui.la \
 	$(LIB_KOFFICEUI) $(LIB_KOPAINTER) $(LIB_KOTEXT) $(LIBPYTHON) $(PYTHONLIB)
 
-libkiviopart_la_METASOURCES = AUTO
+libkiviocommon_la_METASOURCES = AUTO
 
-libkiviopart_la_SOURCES = kivio_canvas.cpp kivio_doc.cpp kivio_factory.cpp \
+libkiviocommon_la_SOURCES = kivio_canvas.cpp kivio_doc.cpp kivio_factory.cpp \
 	kivio_tabbar.cpp kivio_view.cpp kivio_map.cpp kivio_page.cpp \
 	kivio_dlg_pageshow.cpp kivio_zoomaction.cpp kivio_icon_view.cpp \
 	kivio_config.cpp kivio_spawner_drag.cpp kivio_intra_stencil_data.cpp \
@@ -36,33 +37,23 @@
 	kiviostencilsetaction.cpp kivioarrowheadaction.cpp KIvioStencilIface.skel \
 	KIvioStencilIface.cc kiviodragobject.cpp
 
+libkiviopart_la_LDFLAGS = -avoid-version $(all_libraries) -module
+libkiviopart_la_LIBADD  = libkiviocommon.la
+libkiviopart_la_SOURCES = dummy.cpp
 
-lib_LTLIBRARIES = kivio.la
+dummy.cpp:
+	echo > dummy.cpp
 
-kivio_la_SOURCES = main.cpp
+bin_PROGRAMS =
+kdeinit_LTLIBRARIES = kivio.la
 
+kivio_la_SOURCES = main.cpp
 kivio_la_LDFLAGS = $(all_libraries) -module -avoid-version
-
 kivio_la_LIBADD = ../../lib/kofficecore/libkofficecore.la
 
-
-bin_PROGRAMS = kivio
-
-kivio_SOURCES = dummy.cpp
-
-kivio_LDFLAGS = $(all_libraries) $(KDE_RPATH)
-
-kivio_LDADD = kivio.la
-
-
-dummy.cpp:
-	echo > dummy.cpp
-
-
 kdelnk_DATA = kivio.desktop
 kdelnkdir = $(kde_appsdir)/Office
 
-
 rc_DATA = kivio.rc kivio_readonly.rc
 rcdir = $(kde_datadir)/kivio
 
diff -uNr koffice-1.3.4/kivio/kiviopart/main.cpp koffice-1.3.4-new/kivio/kiviopart/main.cpp
--- koffice-1.3.4/kivio/kiviopart/main.cpp	2004-08-29 10:53:02.000000000 -0500
+++ koffice-1.3.4-new/kivio/kiviopart/main.cpp	2004-11-04 11:42:58.000000000 -0600
@@ -30,7 +30,7 @@
   KCmdLineLastOption
 };
 
-int main( int argc, char **argv )
+extern "C" int kdemain( int argc, char **argv )
 {
   KCmdLineArgs::init( argc, argv, newKivioAboutData() );
   KCmdLineArgs::addCmdLineOptions( options );
diff -uNr koffice-1.3.4/kivio/plugins/kivioconnectortool/Makefile.am koffice-1.3.4-new/kivio/plugins/kivioconnectortool/Makefile.am
--- koffice-1.3.4/kivio/plugins/kivioconnectortool/Makefile.am	2004-03-28 10:48:39.000000000 -0600
+++ koffice-1.3.4-new/kivio/plugins/kivioconnectortool/Makefile.am	2004-11-04 11:42:58.000000000 -0600
@@ -23,7 +23,7 @@
 		kivio_connector_cursor1.xpm
 
 libkivioconnectortool_la_LDFLAGS = -module $(KDE_PLUGIN)
-libkivioconnectortool_la_LIBADD = $(all_libraries) $(LIB_KOPAINTER) $(top_builddir)/kivio/kiviopart/libkiviopart.la
+libkivioconnectortool_la_LIBADD = $(all_libraries) $(LIB_KOPAINTER) $(top_builddir)/kivio/kiviopart/libkiviocommon.la
 
 rc_DATA = kivioconnectortool.rc
 rcdir = $(kde_datadir)/kivio/kpartplugins
diff -uNr koffice-1.3.4/kivio/plugins/kivioconnectortool/straight_connector/Makefile.am koffice-1.3.4-new/kivio/plugins/kivioconnectortool/straight_connector/Makefile.am
--- koffice-1.3.4/kivio/plugins/kivioconnectortool/straight_connector/Makefile.am	2003-08-20 05:51:29.000000000 -0500
+++ koffice-1.3.4-new/kivio/plugins/kivioconnectortool/straight_connector/Makefile.am	2004-11-04 11:42:59.000000000 -0600
@@ -6,7 +6,7 @@
 straight_connector_la_LDFLAGS = -module $(KDE_PLUGIN) $(all_libraries)
 
 # Hack to make it work (dave m)
-straight_connector_la_LIBADD = $(LIB_KOPAINTER) $(top_builddir)/kivio/kiviopart/libkiviopart.la
+straight_connector_la_LIBADD = $(LIB_KOPAINTER) $(top_builddir)/kivio/kiviopart/libkiviocommon.la
 
 INCLUDES = -I$(top_srcdir)/kivio/kiviopart\
 	-I$(top_srcdir)/kivio/kiviopart/kiviosdk\
diff -uNr koffice-1.3.4/kivio/plugins/kivioselecttool/Makefile.am koffice-1.3.4-new/kivio/plugins/kivioselecttool/Makefile.am
--- koffice-1.3.4/kivio/plugins/kivioselecttool/Makefile.am	2003-08-20 05:51:30.000000000 -0500
+++ koffice-1.3.4-new/kivio/plugins/kivioselecttool/Makefile.am	2004-11-04 11:42:59.000000000 -0600
@@ -18,7 +18,7 @@
 		tool_select.h\
 		kivioselecttool.rc
 libkivioselecttool_la_LDFLAGS = -module $(KDE_PLUGIN)
-libkivioselecttool_la_LIBADD = $(LIB_KOTEXT) $(LIB_KOPAINTER) $(all_libraries) $(top_builddir)/kivio/kiviopart/libkiviopart.la
+libkivioselecttool_la_LIBADD = $(LIB_KOTEXT) $(LIB_KOPAINTER) $(all_libraries) $(top_builddir)/kivio/kiviopart/libkiviocommon.la
 
 rc_DATA = kivioselecttool.rc
 rcdir = $(kde_datadir)/kivio/kpartplugins
diff -uNr koffice-1.3.4/kivio/plugins/kiviosmlconnector/Makefile.am koffice-1.3.4-new/kivio/plugins/kiviosmlconnector/Makefile.am
--- koffice-1.3.4/kivio/plugins/kiviosmlconnector/Makefile.am	2003-05-06 15:34:41.000000000 -0500
+++ koffice-1.3.4-new/kivio/plugins/kiviosmlconnector/Makefile.am	2004-11-04 11:42:59.000000000 -0600
@@ -10,7 +10,7 @@
 METASOURCES = AUTO
 libkiviosmlconnector_la_SOURCES = plugin.cpp tool_connector.cpp
 libkiviosmlconnector_la_LDFLAGS = -module $(KDE_PLUGIN) $(all_libraries)
-libkiviosmlconnector_la_LIBADD = $(LIB_KOPAINTER) $(top_builddir)/kivio/kiviopart/libkiviopart.la
+libkiviosmlconnector_la_LIBADD = $(LIB_KOPAINTER) $(top_builddir)/kivio/kiviopart/libkiviocommon.la
 
 
 
diff -uNr koffice-1.3.4/kivio/plugins/kiviosmlconnector/sml_connector/Makefile.am koffice-1.3.4-new/kivio/plugins/kiviosmlconnector/sml_connector/Makefile.am
--- koffice-1.3.4/kivio/plugins/kiviosmlconnector/sml_connector/Makefile.am	2003-05-06 15:34:41.000000000 -0500
+++ koffice-1.3.4-new/kivio/plugins/kiviosmlconnector/sml_connector/Makefile.am	2004-11-04 11:42:59.000000000 -0600
@@ -9,7 +9,7 @@
 
 sml_connector_la_SOURCES = sml_connector.cpp
 sml_connector_la_LDFLAGS = -module $(KDE_PLUGIN) $(all_libraries)
-sml_connector_la_LIBADD = $(LIB_KOPAINTER) $(top_builddir)/kivio/kiviopart/libkiviopart.la
+sml_connector_la_LIBADD = $(LIB_KOPAINTER) $(top_builddir)/kivio/kiviopart/libkiviocommon.la
 
 stencildir = $(kde_datadir)/kivio/autoloadStencils
 stencil_DATA = sml_connector.xpm
diff -uNr koffice-1.3.4/kivio/plugins/kiviotexttool/Makefile.am koffice-1.3.4-new/kivio/plugins/kiviotexttool/Makefile.am
--- koffice-1.3.4/kivio/plugins/kiviotexttool/Makefile.am	2003-08-20 05:51:37.000000000 -0500
+++ koffice-1.3.4-new/kivio/plugins/kiviotexttool/Makefile.am	2004-11-04 11:42:59.000000000 -0600
@@ -21,7 +21,7 @@
 		Text.sml\
 		Text.xpm
 libkiviotexttool_la_LDFLAGS = -module $(KDE_PLUGIN)
-libkiviotexttool_la_LIBADD = $(all_libraries) $(LIB_KOPAINTER) $(top_builddir)/kivio/kiviopart/libkiviopart.la
+libkiviotexttool_la_LIBADD = $(all_libraries) $(LIB_KOPAINTER) $(top_builddir)/kivio/kiviopart/libkiviocommon.la
 
 rc_DATA = kiviotexttool.rc
 rcdir = $(kde_datadir)/kivio/kpartplugins
diff -uNr koffice-1.3.4/kivio/plugins/kiviozoomtool/Makefile.am koffice-1.3.4-new/kivio/plugins/kiviozoomtool/Makefile.am
--- koffice-1.3.4/kivio/plugins/kiviozoomtool/Makefile.am	2003-08-20 05:51:38.000000000 -0500
+++ koffice-1.3.4-new/kivio/plugins/kiviozoomtool/Makefile.am	2004-11-04 11:42:59.000000000 -0600
@@ -17,7 +17,7 @@
 		tool_zoom.cpp\
 		tool_zoom.h
 libkiviozoomtool_la_LDFLAGS = -module $(KDE_PLUGIN)
-libkiviozoomtool_la_LIBADD = $(LIB_KOTEXT) $(all_libraries) $(LIB_KOPAINTER) $(top_builddir)/kivio/kiviopart/libkiviopart.la
+libkiviozoomtool_la_LIBADD = $(LIB_KOTEXT) $(all_libraries) $(LIB_KOPAINTER) $(top_builddir)/kivio/kiviopart/libkiviocommon.la
 
 rc_DATA = kiviozoomtool.rc
 rcdir = $(kde_datadir)/kivio/kpartplugins
diff -uNr koffice-1.3.4/koshell/Makefile.am koffice-1.3.4-new/koshell/Makefile.am
--- koffice-1.3.4/koshell/Makefile.am	2002-12-09 11:20:08.000000000 -0600
+++ koffice-1.3.4-new/koshell/Makefile.am	2004-11-04 11:42:59.000000000 -0600
@@ -1,21 +1,14 @@
 
 INCLUDES  = $(KOFFICE_INCLUDES) $(all_includes)
 
-## The kdeinit loadable module
-lib_LTLIBRARIES = koshell.la
+bin_PROGRAMS =
+lib_LTLIBRARIES =
+kdeinit_LTLIBRARIES = koshell.la
+
 koshell_la_SOURCES = koshell_main.cc koshell_shell.cc
 koshell_la_LDFLAGS = $(all_libraries) -avoid-version -module
 koshell_la_LIBADD = $(LIB_KOFFICEUI)
 
-## The executable
-bin_PROGRAMS = koshell
-koshell_SOURCES = dummy.cc
-koshell_LDFLAGS = $(all_libraries) $(KDE_RPATH)
-koshell_LDADD = koshell.la
-
-dummy.cc:
-	echo > dummy.cc
-
 noinst_HEADERS = koshell_shell.h
 
 METASOURCES = AUTO
diff -uNr koffice-1.3.4/koshell/koshell_main.cc koffice-1.3.4-new/koshell/koshell_main.cc
--- koffice-1.3.4/koshell/koshell_main.cc	2003-01-20 13:37:23.000000000 -0600
+++ koffice-1.3.4-new/koshell/koshell_main.cc	2004-11-04 11:42:59.000000000 -0600
@@ -30,7 +30,7 @@
 static const char* description=I18N_NOOP("KOffice Workspace");
 static const char* version=VERSION;
 
-int main( int argc, char **argv )
+extern "C" int kdemain( int argc, char **argv )
 {
   KAboutData * aboutData = new KAboutData( "koshell", I18N_NOOP("KOffice Workspace"),
      version, description, KAboutData::License_GPL,
diff -uNr koffice-1.3.4/kpresenter/Makefile.am koffice-1.3.4-new/kpresenter/Makefile.am
--- koffice-1.3.4/kpresenter/Makefile.am	2004-10-05 18:17:48.000000000 -0500
+++ koffice-1.3.4-new/kpresenter/Makefile.am	2004-11-04 11:42:59.000000000 -0600
@@ -57,21 +57,14 @@
 libkpresenterpart_la_LIBADD = autoformEdit/libaf.la $(LIB_KOFFICEUI) $(LIB_KOTEXT) -lkspell $(LIBKOSPELL) $(ARTSKDE) -lkdefx
 libkpresenterpart_la_METASOURCES = AUTO
 
-## The kdeinit loadable module
-lib_LTLIBRARIES = kpresenter.la
+lib_LTLIBRARIES =
+bin_PROGRAMS =
+kdeinit_LTLIBRARIES = kpresenter.la
+
 kpresenter_la_SOURCES = main.cc
 kpresenter_la_LDFLAGS = $(all_libraries) -avoid-version -module
 kpresenter_la_LIBADD = $(LIB_KOFFICECORE)
 
-## The executable
-bin_PROGRAMS = kpresenter
-kpresenter_SOURCES = dummy.cc
-kpresenter_LDFLAGS = $(all_libraries) $(KDE_RPATH)
-kpresenter_LDADD = kpresenter.la
-
-dummy.cc:
-	echo > dummy.cc
-
 noinst_HEADERS = koPointArray.h kprcanvas.h kprpage.h kpresenter_doc.h kpresenter_view.h \
 		backdia.h styledia.h \
 		global.h kprcommand.h kpresenter_sound_player.h \
diff -uNr koffice-1.3.4/kpresenter/main.cc koffice-1.3.4-new/kpresenter/main.cc
--- koffice-1.3.4/kpresenter/main.cc	2004-08-29 10:53:10.000000000 -0500
+++ koffice-1.3.4-new/kpresenter/main.cc	2004-11-04 11:42:59.000000000 -0600
@@ -32,7 +32,7 @@
 	KCmdLineLastOption
 };
 
-int main( int argc, char **argv )
+extern "C" int kdemain( int argc, char **argv )
 {
     KCmdLineArgs::init( argc, argv, newKPresenterAboutData() );
     KCmdLineArgs::addCmdLineOptions( options );
diff -uNr koffice-1.3.4/kspread/Makefile.am koffice-1.3.4-new/kspread/Makefile.am
--- koffice-1.3.4/kspread/Makefile.am	2004-08-10 06:33:09.000000000 -0500
+++ koffice-1.3.4-new/kspread/Makefile.am	2004-11-04 11:42:59.000000000 -0600
@@ -3,10 +3,11 @@
 	$(KOSCRIPT_INCLUDES) -I$(top_srcdir)/interfaces \
 	 -I$(top_srcdir)/kchart/kdchart $(all_includes)
 
+lib_LTLIBRARIES = libkspreadcommon.la
 kde_module_LTLIBRARIES = libkspreadpart.la
 
 ## The part
-libkspreadpart_la_SOURCES = kspread_locale.cc \
+libkspreadcommon_la_SOURCES = kspread_locale.cc \
 	kspread_dlg_formula.cc digest.cc \
 	kspread_functions.cc kspread_dlg_csv.cc \
 	kspread_canvas.cc kspread_functions_helper.cc \
@@ -45,27 +46,26 @@
 	kspread_selection.cc kspread_dlg_paperlayout.cc kspread_format.cc \
         kspread_sheetprint.cc
 
+libkspreadcommon_la_LDFLAGS = $(all_libraries) $(KDE_RPATH) -no-undefined
+libkspreadcommon_la_LIBADD = $(top_builddir)/interfaces/libkochart.la \
+	$(LIB_KOSCRIPT) $(LIB_KOFFICEUI) $(LIB_KOTEXT) -lkspell $(LIBZ)
+
 libkspreadpart_la_LDFLAGS = $(all_libraries) $(KDE_PLUGIN)
-libkspreadpart_la_LIBADD = $(top_builddir)/interfaces/libkochart.la \
-	$(LIB_KOSCRIPT) $(LIB_KOFFICEUI) $(LIB_KOTEXT) -lkspell
+libkspreadpart_la_LIBADD  = libkspreadcommon.la
+libkspreadpart_la_SOURCES = dummy.cpp
+
+dummy.cpp:
+	echo > dummy.cpp
 
 METASOURCES = AUTO
 
-## The kdeinit loadable module
-lib_LTLIBRARIES =  kspread.la
+bin_PROGRAMS =
+kdeinit_LTLIBRARIES = kspread.la
+
 kspread_la_SOURCES = main.cc
 kspread_la_LDFLAGS = $(all_libraries) -avoid-version -module
 kspread_la_LIBADD = $(LIB_KOFFICECORE)
 
-## The executable
-bin_PROGRAMS = kspread
-kspread_SOURCES = dummy.cc
-kspread_LDFLAGS = $(all_libraries) $(KDE_RPATH)
-kspread_LDADD = kspread.la
-
-dummy.cc:
-	echo > dummy.cc
-
 noinst_HEADERS = kspread_doc.h kspread_functions.h kspread_functions_helper.h \
 	kspread_undo.h kspread_view.h kspread_tabbar.h \
 	kspread_autofill.h kspread_interpreter.h kspread_style.h kspread_style_manager.h \
diff -uNr koffice-1.3.4/kspread/main.cc koffice-1.3.4-new/kspread/main.cc
--- koffice-1.3.4/kspread/main.cc	2004-08-29 10:53:13.000000000 -0500
+++ koffice-1.3.4-new/kspread/main.cc	2004-11-04 11:42:59.000000000 -0600
@@ -30,7 +30,7 @@
         KCmdLineLastOption
 };
 
-int main( int argc, char **argv )
+extern "C" int kdemain( int argc, char **argv )
 {
 
     KCmdLineArgs::init( argc, argv, newKSpreadAboutData() );
diff -uNr koffice-1.3.4/kspread/plugins/calculator/Makefile.am koffice-1.3.4-new/kspread/plugins/calculator/Makefile.am
--- koffice-1.3.4/kspread/plugins/calculator/Makefile.am	2002-10-29 14:25:37.000000000 -0600
+++ koffice-1.3.4-new/kspread/plugins/calculator/Makefile.am	2004-11-04 11:42:59.000000000 -0600
@@ -9,7 +9,7 @@
 			main.cpp \
 			stats.cpp
 libkspreadcalc_la_LDFLAGS = -avoid-version -module -no-undefined
-libkspreadcalc_la_LIBADD = $(all_libraries) ../../libkspreadpart.la
+libkspreadcalc_la_LIBADD = $(all_libraries) ../../libkspreadcommon.la
 
 METASOURCES = AUTO
 
diff -uNr koffice-1.3.4/kugar/kudesigner/Makefile.am koffice-1.3.4-new/kugar/kudesigner/Makefile.am
--- koffice-1.3.4/kugar/kudesigner/Makefile.am	2003-08-20 05:54:12.000000000 -0500
+++ koffice-1.3.4-new/kugar/kudesigner/Makefile.am	2004-11-04 11:42:59.000000000 -0600
@@ -2,11 +2,12 @@
 
 INCLUDES = -I$(srcdir)/../kudesigner_lib -I$(srcdir)/../lib $(KOFFICE_INCLUDES) $(all_includes)
 
+bin_PROGRAMS =
 
 ## The kdeinit loadable module
-lib_LTLIBRARIES = libkudesignercore.la kudesigner.la
+lib_LTLIBRARIES = libkudesignercore.la
 libkudesignercore_la_SOURCES = kudesigner_view.cpp kudesigner_factory.cpp kudesigner_doc.cpp
-libkudesignercore_la_LDFLAGS = -avoid-version -module $(all_libraries) $(KDE_RPATH)
+libkudesignercore_la_LDFLAGS = -avoid-version $(all_libraries) $(KDE_RPATH)
 libkudesignercore_la_LIBADD = ../kudesigner_lib/libkudesignercommon.la $(LIB_KOFFICEUI) $(LIB_KPARTS) $(LIB_KOFFICECORE) $(LIB_KIO) $(LIB_KDEPRINT)
 
 ## The part
@@ -15,20 +16,11 @@
 libkudesignerpart_la_LDFLAGS = $(all_libraries) $(KDE_PLUGIN) $(KDE_RPATH)
 libkudesignerpart_la_LIBADD = libkudesignercore.la $(LIB_KOFFICEUI) $(LIB_KPARTS) $(LIB_KOFFICECORE)
 
-## The kdeinit loadable module
+kdeinit_LTLIBRARIES = kudesigner.la
 kudesigner_la_SOURCES = main.cpp
 kudesigner_la_LDFLAGS = $(all_libraries) -module -avoid-version
 kudesigner_la_LIBADD = $(LIB_KOFFICECORE)
 
-## The executable
-bin_PROGRAMS = kudesigner
-kudesigner_SOURCES = dummy.cc
-kudesigner_LDFLAGS = $(all_libraries) $(KDE_RPATH)
-kudesigner_LDADD = kudesigner.la
-
-dummy.cc:
-	echo > dummy.cc
-
 appsdir = $(kde_appsdir)/Office
 apps_DATA = kudesigner.desktop
 
diff -uNr koffice-1.3.4/kugar/kudesigner/main.cpp koffice-1.3.4-new/kugar/kudesigner/main.cpp
--- koffice-1.3.4/kugar/kudesigner/main.cpp	2004-08-29 10:53:13.000000000 -0500
+++ koffice-1.3.4-new/kugar/kudesigner/main.cpp	2004-11-04 11:42:59.000000000 -0600
@@ -32,7 +32,7 @@
 	KCmdLineLastOption
 };
 
-int main( int argc, char **argv )
+extern "C" int kdemain( int argc, char **argv )
 {
     KLocale::setMainCatalogue("kugar");
     KCmdLineArgs::init( argc, argv, newKudesignerAboutData() );
diff -uNr koffice-1.3.4/kugar/part/Makefile.am koffice-1.3.4-new/kugar/part/Makefile.am
--- koffice-1.3.4/kugar/part/Makefile.am	2004-02-03 11:13:44.000000000 -0600
+++ koffice-1.3.4-new/kugar/part/Makefile.am	2004-11-04 11:42:59.000000000 -0600
@@ -24,19 +24,12 @@
 
 CLEANFILES = kugarpart_meta_unload.cpp
 
+bin_PROGRAMS =
+lib_LTLIBRARIES =
 
-## The kdeinit loadable module
-lib_LTLIBRARIES = kugar.la
+kdeinit_LTLIBRARIES = kugar.la
 kugar_la_SOURCES = main.cpp
 kugar_la_LDFLAGS = $(all_libraries) -module -avoid-version
 kugar_la_LIBADD = $(LIB_KOFFICECORE)
 
-## The executable
-bin_PROGRAMS = kugar
-kugar_SOURCES = dummy.cc
-kugar_LDFLAGS = $(all_libraries) $(KDE_RPATH)
-kugar_LDADD = kugar.la
-
-dummy.cc:
-	echo > dummy.cc
 kde_services_DATA = kugarpart.desktop
diff -uNr koffice-1.3.4/kugar/part/main.cpp koffice-1.3.4-new/kugar/part/main.cpp
--- koffice-1.3.4/kugar/part/main.cpp	2004-08-29 10:53:13.000000000 -0500
+++ koffice-1.3.4-new/kugar/part/main.cpp	2004-11-04 11:42:59.000000000 -0600
@@ -28,7 +28,7 @@
   // INSERT YOUR COMMANDLINE OPTIONS HERE
 };
 
-int main(int argc, char *argv[])
+extern "C" int kdemain(int argc, char *argv[])
 {
 
 	KCmdLineArgs::init( argc, argv, newKugarAboutData() );
diff -uNr koffice-1.3.4/kugar/shell/Makefile.am koffice-1.3.4-new/kugar/shell/Makefile.am
--- koffice-1.3.4/kugar/shell/Makefile.am	2001-03-29 06:45:42.000000000 -0600
+++ koffice-1.3.4-new/kugar/shell/Makefile.am	2004-11-04 11:42:59.000000000 -0600
@@ -1,9 +1,13 @@
 INCLUDES = -I$(srcdir)/../lib $(KOFFICE_INCLUDES) $(all_includes)
 
-bin_PROGRAMS = kugar
-kugar_SOURCES = main.cpp report.cpp
-kugar_LDFLAGS = $(all_libraries) $(KDE_RPATH)
-kugar_LDADD = ../lib/libkugar.la $(LIB_KIO) $(LIB_KDEPRINT)
+bin_PROGRAMS =
+lib_LTLIBRARIES =
+
+kdeinit_LTLIBRARIES = kugar.la
+
+kugar_la_SOURCES = main.cpp report.cpp
+kugar_la_LDFLAGS = $(all_libraries) $(KDE_RPATH) -module -avoid-version
+kugar_la_LIBADD = ../lib/libkugar.la $(LIB_KIO) $(LIB_KDEPRINT)
 
 kugar_METASOURCES = AUTO
 
diff -uNr koffice-1.3.4/kugar/shell/main.cpp koffice-1.3.4-new/kugar/shell/main.cpp
--- koffice-1.3.4/kugar/shell/main.cpp	2003-08-20 05:55:00.000000000 -0500
+++ koffice-1.3.4-new/kugar/shell/main.cpp	2004-11-04 11:42:59.000000000 -0600
@@ -16,7 +16,7 @@
 #include "report.h"
 
 
-int main(int argc,char **argv)
+extern "C" int kdemain(int argc,char **argv)
 {
 	KAboutData about("kugar", I18N_NOOP("Kugar"), VERSION,
 		I18N_NOOP("A template driven report viewer for XML data."),
diff -uNr koffice-1.3.4/kword/Makefile.am koffice-1.3.4-new/kword/Makefile.am
--- koffice-1.3.4/kword/Makefile.am	2004-08-10 05:57:54.000000000 -0500
+++ koffice-1.3.4-new/kword/Makefile.am	2004-11-04 11:42:59.000000000 -0600
@@ -46,10 +46,11 @@
 
 
 libkwordpart_la_LDFLAGS = $(all_libraries) $(KDE_PLUGIN)
-libkwordpart_la_LIBADD = $(LIB_KOFFICEUI) $(LIB_KOTEXT) ../lib/kformula/libkformula.la -lkspell $(LIBKOSPELL) ./libkwmailmerge_interface.la
+libkwordpart_la_LIBADD = $(LIB_KOFFICEUI) $(LIB_KOTEXT) ../lib/kformula/libkformula.la -lkspell $(LIBKOSPELL) libkwmailmerge_interface.la
 METASOURCES = AUTO
 
-lib_LTLIBRARIES = kword.la libkwmailmerge_interface.la
+lib_LTLIBRARIES = libkwmailmerge_interface.la
+bin_PROGRAMS =
 
 ## The mailmerge interface library
 libkwmailmerge_interface_la_SOURCES = mailmerge_interface.cc mailmerge_interface.skel
@@ -61,20 +62,11 @@
 kwmailmerge_servicetype_DATA=kwmailmerge.desktop
 kwmailmerge_servicetypedir=$(kde_servicetypesdir)
 
-## The kdeinit loadable module
+kdeinit_LTLIBRARIES = kword.la
 kword_la_SOURCES = main.cc
 kword_la_LDFLAGS = $(all_libraries) -avoid-version -module
 kword_la_LIBADD = ../lib/kofficecore/libkofficecore.la
 
-## The executable
-bin_PROGRAMS = kword
-kword_SOURCES = dummy.cc
-kword_LDFLAGS = $(all_libraries) $(KDE_RPATH)
-kword_LDADD = kword.la
-
-dummy.cc:
-	echo > dummy.cc
-
 kdelnk_DATA = kword.desktop
 kdelnkdir = $(kde_appsdir)/Office
 
diff -uNr koffice-1.3.4/kword/main.cc koffice-1.3.4-new/kword/main.cc
--- koffice-1.3.4/kword/main.cc	2004-08-29 10:53:14.000000000 -0500
+++ koffice-1.3.4-new/kword/main.cc	2004-11-04 11:42:59.000000000 -0600
@@ -28,7 +28,7 @@
 	KCmdLineLastOption
 };
 
-int main( int argc, char **argv )
+extern "C" int kdemain( int argc, char **argv )
 {
     KCmdLineArgs::init( argc, argv, newKWordAboutData());
     KCmdLineArgs::addCmdLineOptions( options );
diff -uNr koffice-1.3.4/lib/configure.in.in koffice-1.3.4-new/lib/configure.in.in
--- koffice-1.3.4/lib/configure.in.in	2003-12-05 15:11:49.000000000 -0600
+++ koffice-1.3.4-new/lib/configure.in.in	2004-11-04 11:42:59.000000000 -0600
@@ -15,7 +15,7 @@
 AC_SUBST(LIB_KWMF, '$(top_builddir)/lib/kwmf/libkwmf.la')
 AC_SUBST(LIB_KOWMF, '$(top_builddir)/lib/kwmf/libkowmf.la')
 AC_SUBST(LIB_KFORMULA, '$(top_builddir)/lib/kformula/libkformula.la')
-AC_SUBST(LIB_KOSCRIPT, '$(top_builddir)/lib/koscript/libkoscript.la')
+AC_SUBST(LIB_KOSCRIPT, '$(top_builddir)/lib/koscript/libkoscriptcommon.la')
 AC_SUBST(LIB_KOSPELL, '$(top_builddir)/lib/kospell/libkospell.la')
 
 AC_SUBST(interfacedir, '$(top_srcdir)/lib/interfaces')
diff -uNr koffice-1.3.4/lib/koscript/Makefile.am koffice-1.3.4-new/lib/koscript/Makefile.am
--- koffice-1.3.4/lib/koscript/Makefile.am	2002-05-18 17:23:34.000000000 -0500
+++ koffice-1.3.4-new/lib/koscript/Makefile.am	2004-11-04 11:42:59.000000000 -0600
@@ -4,19 +4,22 @@
 
 ####### Files
 
-lib_LTLIBRARIES = libkoscript.la
-libkoscript_la_SOURCES = koscript_locale.cc \
+lib_LTLIBRARIES = libkoscriptcommon.la
+bin_PROGRAMS =
+
+kdeinit_LTLIBRARIES = koscript.la
+
+libkoscriptcommon_la_SOURCES = koscript_locale.cc \
 		  koscript_eval.cc koscript_func.cc koscript_property.cc koscript_method.cc \
 		  koscript_context.cc koscript_value.cc koscript_parser.cc koscript_parsenode.cc yacc.cc \
                   scanner.cc koscript.cc koscript_util.cc koscript_struct.cc
-libkoscript_la_METASOURCES = AUTO
-libkoscript_la_LDFLAGS = -version-info 2:0:0 -no-undefined $(all_libraries)
-libkoscript_la_LIBADD = $(LIB_KDEUI)
-
-bin_PROGRAMS = koscript
-koscript_SOURCES = main.cc
-koscript_LDADD = ./libkoscript.la $(all_libraries)
-koscript_LDFLAGS = $(KDE_RPATH)
+libkoscriptcommon_la_METASOURCES = AUTO
+libkoscriptcommon_la_LDFLAGS = -version-info 2:0:0 -no-undefined $(all_libraries)
+libkoscriptcommon_la_LIBADD = $(LIB_KDEUI)
+
+koscript_la_SOURCES = main.cc
+koscript_la_LIBADD = libkoscriptcommon.la
+koscript_la_LDFLAGS = $(KDE_RPATH) $(all_libraries) -module -avoid-version
 
 noinst_HEADERS = koscript_locale.h \
 		 koscript_eval.h koscript_func.h koscript_context.h koscript_value.h \
diff -uNr koffice-1.3.4/lib/koscript/main.cc koffice-1.3.4-new/lib/koscript/main.cc
--- koffice-1.3.4/lib/koscript/main.cc	2003-01-24 10:48:31.000000000 -0600
+++ koffice-1.3.4-new/lib/koscript/main.cc	2004-11-04 11:42:59.000000000 -0600
@@ -36,7 +36,7 @@
   KCmdLineLastOption
 };
 
-int main( int argc, char** argv )
+extern "C" int kdemain( int argc, char** argv )
 {
   const char *appName = (argc > 1) ? argv[1] : "koscript";
   KCmdLineArgs::init(argc, argv, appName,
diff -uNr koffice-1.3.4/tools/converter/Makefile.am koffice-1.3.4-new/tools/converter/Makefile.am
--- koffice-1.3.4/tools/converter/Makefile.am	2002-05-29 14:22:42.000000000 -0500
+++ koffice-1.3.4-new/tools/converter/Makefile.am	2004-11-04 11:42:59.000000000 -0600
@@ -1,9 +1,12 @@
 INCLUDES = $(KOFFICE_INCLUDES) $(all_includes)
 
-bin_PROGRAMS = koconverter
-koconverter_SOURCES = koconverter.cc
-koconverter_LDFLAGS = $(all_libraries) $(KDE_RPATH)
-koconverter_LDADD = $(top_builddir)/lib/kofficecore/libkofficecore.la
+bin_PROGRAMS =
+lib_LTLIBRARIES =
+
+kdeinit_LTLIBRARIES = koconverter.la
+koconverter_la_SOURCES = koconverter.cc
+koconverter_la_LDFLAGS = $(all_libraries) $(KDE_RPATH) -module -avoid-version
+koconverter_la_LIBADD = $(top_builddir)/lib/kofficecore/libkofficecore.la
 
 METASOURCES = AUTO
 
diff -uNr koffice-1.3.4/tools/converter/koconverter.cc koffice-1.3.4-new/tools/converter/koconverter.cc
--- koffice-1.3.4/tools/converter/koconverter.cc	2003-10-15 13:52:59.000000000 -0500
+++ koffice-1.3.4-new/tools/converter/koconverter.cc	2004-11-04 11:42:59.000000000 -0600
@@ -58,7 +58,7 @@
     //kdDebug() << "ProgressObject::slotProgress " << progress << endl;
 }
 
-int main( int argc, char **argv )
+extern "C" int kdemain( int argc, char **argv )
 {
     KAboutData aboutData( "koconverter", I18N_NOOP("KOConverter"), "1.1",
                           I18N_NOOP("KOffice Document Converter"),
diff -uNr koffice-1.3.4/tools/kthesaurus/Makefile.am koffice-1.3.4-new/tools/kthesaurus/Makefile.am
--- koffice-1.3.4/tools/kthesaurus/Makefile.am	2002-06-09 14:54:28.000000000 -0500
+++ koffice-1.3.4-new/tools/kthesaurus/Makefile.am	2004-11-04 11:42:59.000000000 -0600
@@ -1,11 +1,13 @@
 
 INCLUDES = $(all_includes)
 
-bin_PROGRAMS = kthesaurus
+bin_PROGRAMS =
+lib_LTLIBRARIES =
+kdeinit_LTLIBRARIES = kthesaurus.la
 
-kthesaurus_LDFLAGS = $(all_libraries) $(KDE_RPATH)
-kthesaurus_SOURCES = main.cc
-kthesaurus_LDADD = $(LIB_KSYCOCA)
+kthesaurus_la_LDFLAGS = $(all_libraries) $(KDE_RPATH) -module -avoid-version
+kthesaurus_la_SOURCES = main.cc
+kthesaurus_la_LIBADD = $(LIB_KSYCOCA)
  
 appsdir = $(kde_appsdir)/Office
 apps_DATA = KThesaurus.desktop
diff -uNr koffice-1.3.4/tools/kthesaurus/main.cc koffice-1.3.4-new/tools/kthesaurus/main.cc
--- koffice-1.3.4/tools/kthesaurus/main.cc	2003-01-24 10:48:34.000000000 -0600
+++ koffice-1.3.4-new/tools/kthesaurus/main.cc	2004-11-04 11:42:59.000000000 -0600
@@ -32,7 +32,7 @@
 	KCmdLineLastOption
 };
 
-int main(int argc, char **argv)
+extern "C" int kdemain(int argc, char **argv)
 {
 
 	KAboutData aboutData("kthesaurus", I18N_NOOP("KThesaurus"), "1.0",
