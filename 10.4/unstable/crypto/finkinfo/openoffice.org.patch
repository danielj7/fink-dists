### A patch to utilize Osaka font; IssueZilla #54535
--- officecfg/registry/data/org/openoffice/VCL.xcu	2005-09-08 23:46:30.000000000 +0900
+++ officecfg/registry/data/org/openoffice/VCL.xcu.fink	2005-10-17 03:08:38.000000000 +0900
@@ -434,31 +434,31 @@
     </node>
     <node oor:name="ja" oor:op="replace">
       <prop oor:name="CJK_TEXT" oor:type="xs:string" oor:op="replace">
-        <value>HG 明朝L Sun;HG MinchoL Sun;HG PゴシックB Sun;HG-PGothicB Sun;HG PゴシックB;HG-PGothicB;HG Mincho Light J;MS P 明朝;TLP明朝;LX明朝;IPA P明朝;東風明朝;Kochi Mincho;さざなみ明朝;Mincho;Serif</value>
+        <value>HG 明朝L Sun;HG MinchoL Sun;HG PゴシックB Sun;HG-PGothicB Sun;HG PゴシックB;HG-PGothicB;HG Mincho Light J;MS P 明朝;TLP明朝;LX明朝;IPA P明朝;Osaka;東風明朝;Kochi Mincho;さざなみ明朝;Mincho;Serif</value>
       </prop>
        <prop oor:name="CJK_HEADING" oor:type="xs:string" oor:op="replace">
-        <value>HG 明朝L Sun;HG 明朝L;HG Mincho Light J;MS P ゴシック;TLPゴシック;LXゴシック;IPA Pゴシック;東風ゴシック;さざなみゴシック;Gothic;MS 明朝;HG Mincho J;HG Mincho L;HG Mincho;Mincho;MS P 明朝;HG Mincho Light J;MS ゴシック;HG Gothic J;HG Gothic B;HG Gothic;Gothic;MS P ゴシック;Andale Sans UI</value>
+        <value>HG 明朝L Sun;HG 明朝L;HG Mincho Light J;MS P ゴシック;TLPゴシック;LXゴシック;IPA Pゴシック;Osaka;東風ゴシック;さざなみゴシック;Gothic;MS 明朝;HG Mincho J;HG Mincho L;HG Mincho;Mincho;MS P 明朝;HG Mincho Light J;MS ゴシック;HG Gothic J;HG Gothic B;HG Gothic;Gothic;MS P ゴシック;Andale Sans UI</value>
       </prop>
       <prop oor:name="CJK_PRESENTATION" oor:type="xs:string" oor:op="replace">
-        <value>HG PゴシックB Sun;HG-PGothicB Sun;HG PゴシックB;HG-PGothicB;HG-GothicB;HG Mincho Light J;MS P ゴシック;TLPゴシック;LXゴシック;IPA Pゴシック;東風ゴシック;さざなみゴシック;MS ゴシック;MS P ゴシック;HG Gothic;HG Gothic B;Gothic;Andale Sans UI</value>
+        <value>HG PゴシックB Sun;HG-PGothicB Sun;HG PゴシックB;HG-PGothicB;HG-GothicB;HG Mincho Light J;MS P ゴシック;TLPゴシック;LXゴシック;IPA Pゴシック;Osaka;東風ゴシック;さざなみゴシック;MS ゴシック;MS P ゴシック;HG Gothic;HG Gothic B;Gothic;Andale Sans UI</value>
       </prop>
       <prop oor:name="LATIN_PRESENTATION" oor:type="xs:string" oor:op="replace">
         <value>Andale;Arial</value>
       </prop>
       <prop oor:name="CJK_SPREADSHEET" oor:type="xs:string" oor:op="replace">
-        <value>HG PゴシックB Sun;HG-PGothicB Sun;HG PゴシックB;HG-PGothicB;MS P ゴシック;TLPゴシック;LXゴシック;IPA Pゴシック;東風ゴシック;さざなみゴシック;Andale Sans UI;Kochi Gothic;HG Gothic J;HG Gothic B;HG Gothic;Gothic</value>
+        <value>HG PゴシックB Sun;HG-PGothicB Sun;HG PゴシックB;HG-PGothicB;MS P ゴシック;TLPゴシック;LXゴシック;IPA Pゴシック;Osaka;東風ゴシック;さざなみゴシック;Andale Sans UI;Kochi Gothic;HG Gothic J;HG Gothic B;HG Gothic;Gothic</value>
       </prop>
       <prop oor:name="LATIN_SPREADSHEET" oor:type="xs:string" oor:op="replace">
-        <value>HG PゴシックB Sun;HG-PGothicB Sun;HG PゴシックB;HG-PGothicB;Andale Sans UI;MS P ゴシック;TLPゴシック;LXゴシック;IPA Pゴシック;東風ゴシック;MS Gothic;HG Gothic J;HG Gothic B;HG Gothic;Kochi Gothic;MS PGothic;Gothic</value>
+        <value>HG PゴシックB Sun;HG-PGothicB Sun;HG PゴシックB;HG-PGothicB;Andale Sans UI;MS P ゴシック;TLPゴシック;LXゴシック;IPA Pゴシック;Osaka;東風ゴシック;MS Gothic;HG Gothic J;HG Gothic B;HG Gothic;Kochi Gothic;MS PGothic;Gothic</value>
       </prop>
       <prop oor:name="UI_FIXED" oor:type="xs:string" oor:op="replace">
-        <value>HG ゴシックB Sun;HG-GothicB Sun;HG Mincho Light J;MS P ゴシック;TLPゴシック;LXゴシック;IPA Pゴシック;東風ゴシック;さざなみゴシック;Kochi Gothic;Gothic</value>
+        <value>HG ゴシックB Sun;HG-GothicB Sun;HG Mincho Light J;MS P ゴシック;TLPゴシック;LXゴシック;IPA Pゴシック;Osaka;東風ゴシック;さざなみゴシック;Kochi Gothic;Gothic</value>
        </prop>
        <prop oor:name="FIXED" oor:type="xs:string" oor:op="replace">
-        <value>HG ゴシックB Sun;HG-GothicB Sun;HG ゴシックB;HG Mincho Light J;MS P ゴシック;TLPゴシック;LXゴシック;IPA Pゴシック;東風ゴシック;さざなみゴシック;Kochi Gothic;Gothic</value>
+        <value>HG ゴシックB Sun;HG-GothicB Sun;HG ゴシックB;HG Mincho Light J;MS P ゴシック;TLPゴシック;LXゴシック;IPA Pゴシック;Osaka;東風ゴシック;さざなみゴシック;Kochi Gothic;Gothic</value>
        </prop>
       <prop oor:name="UI_SANS" oor:type="xs:string" oor:op="replace">
-        <value>HG PゴシックB Sun;HG-PGothicB Sun;HG PゴシックB;HG-PGothicB;HG-GothicB;Andale Sans UI;HG Mincho Light J;標準;TLPゴシック;LXゴシック;IPA Pゴシック;東風ゴシック;さざなみゴシック;Kochi Gothic;Gothic;Gnu-Unifont</value>
+        <value>HG PゴシックB Sun;HG-PGothicB Sun;HG PゴシックB;HG-PGothicB;HG-GothicB;Andale Sans UI;HG Mincho Light J;標準;TLPゴシック;LXゴシック;IPA Pゴシック;Osaka;東風ゴシック;さざなみゴシック;Kochi Gothic;Gothic;Gnu-Unifont</value>
       </prop>
       <prop oor:name="LATIN_FIXED" oor:type="xs:string" oor:op="replace">
         <value>hgmincholightj;cumberland;couriernew;courier;lucidasanstypewriter;lucidatypewriter;monaco;monospaced</value>
### Script to create language packs
--- /dev/null	Fri Feb 10 20:33:39 2006
+++ languagepack-splitoff	Fri Feb 10 20:32:14 2006
@@ -0,0 +1,42 @@
+#!/bin/bash
+
+set -e
+
+lang1=$1
+lang2=$2
+fink_p=$3
+fink_d=$4
+fink_i=$5
+fink_N=$6
+# Setting up environment
+case `uname -p` in
+  powerpc) . ./MacOSXPPCEnv.Set.sh;;
+  i386) . ./MacOSXIntelEnv.Set.sh;;
+  *) echo 'Unknown architecture'; exit 1;;
+esac
+
+# Variables needed to execute make_installer.pl
+export OUT="../$INPATH"
+export LOCAL_OUT="$OUT"
+export LOCAL_COMMON_OUT="$OUT"
+solarlibdir=$SOLARVER/$UPD/$INPATH/lib
+export PYTHONPATH=$SRC_ROOT/instsetoo_native/$INPATH/bin:$solarlibdir:$solarlibdir/python:$solarlibdir/python/lib-dynload
+build=`sed -n 's/^BUILD=\(.*\)$/\1/p' $SOLARENVINC/minor.mk`
+
+set -v
+
+# Install language pack
+pushd instsetoo_native/util
+/usr/bin/perl -w $SOLARENV/bin/make_installer.pl \
+  -f openoffice.lst -l $lang2 -p OpenOffice \
+  -packagelist ../inc_openoffice/unix/packagelist.txt \
+  -buildid $build -languagepack \
+  -destdir $fink_d \
+  -simple $fink_p/lib/$fink_N
+popd
+
+# Remove the list files
+/bin/rm -v $fink_d/gid_Module*
+
+/usr/bin/install -m 755 -d $fink_i/share/doc/$fink_N-$lang1
+/bin/ln -sf $fink_p/lib/$fink_N/licenses/LICENSE_$lang2 $fink_i/share/doc/$fink_N-$lang1/LICENSE
### Script to convert Mac OS X fonts to truetype fonts
--- /dev/null	Tue Feb  7 11:38:20 2006
+++ update-ooo-fonts.in	Tue Feb  7 11:37:47 2006
@@ -0,0 +1,52 @@
+#!/bin/sh
+set -e
+case $1 in
+    -h|-help|--help)
+    echo "Usage: `basename $0` [--clean]"
+    exit 0;;
+    ""|--clean) ;;
+    *)
+    echo "Usage: `basename $0` [--clean]"
+    exit 1;;
+esac
+
+/bin/mkdir -p "@PREFIX@/lib/@PKGNAME@/share/fonts/fondu"
+trap '/bin/rm -rf "@PREFIX@/lib/@PKGNAME@/share/fonts/fondu/"*.tmp' 0
+cd "@PREFIX@/lib/@PKGNAME@/share/fonts"
+
+# Remove old fonts and symlinks
+echo "Cleaning old Mac OS X fonts..."
+/bin/rm -f truetype/.fondudone
+/usr/bin/find -H truetype -type l > fondu/oldlinks.tmp
+while read link; do
+    to=`@PREFIX@/sbin/readlink "$link" || :`
+    case $to in
+        ../fondu/*) /bin/rm -f "$link"
+    esac
+done < fondu/oldlinks.tmp
+case $1 in
+    --clean)
+    /bin/rm -rf fondu
+    exit 0;;
+    *) /usr/bin/find -H fondu -type f -delete;;
+esac
+
+# Convert fonts
+echo "Converting Mac OS X fonts..."
+cd fondu
+/usr/bin/find -H /System/Library/Fonts /Library/Fonts -type f > sysfonts.tmp
+{
+    while read font; do
+        @PREFIX@/bin/fondu -force "$font" || :
+    done < sysfonts.tmp 3>&2 2>&1 1>&3 |
+      /usr/bin/grep -v "Can't find an appropriate resource fork" || :
+} 3>&2 2>&1 1>&3 3>&-
+/usr/bin/find -H . -name "*.bdf" -delete
+/usr/bin/find -H . -name "*.ttf" | /usr/bin/sed 's/.*\///' > fondu-ttf.tmp
+cd "@PREFIX@/lib/@PKGNAME@/share/fonts"
+
+# Create new symlinks
+while read font; do
+  /bin/ln -sf "../fondu/$font" "truetype/$font"
+done < fondu/fondu-ttf.tmp
+/usr/bin/touch truetype/.fondudone
### No-op if --with-system-python
--- python/makefile.mk	2005-12-29 01:57:47.000000000 +0900
+++ python/makefile.mk.fink	2006-01-15 20:59:52.000000000 +0900
@@ -105,7 +105,7 @@
 .ENDIF			# "$(SYSBASE)"!=""
 
 CONFIGURE_ACTION=./configure --prefix=$(MYCWD)/python-inst --enable-shared CFLAGS="$(python_CFLAGS)" LDFLAGS="$(python_LDFLAGS)"
-.IF "$(OS)$(CPU)" == "SOLARISI"
+.IF "$(OS)$(CPU)" == "SOLARISI" || "$(OS)$(BUILD_OS_MAJOR)$(BUILD_OS_MINOR)" == "MACOSX103"
 CONFIGURE_ACTION += --disable-ipv6
 .ENDIF
 .IF "$(COMNAME)"=="sunpro5"
### IssueZilla #60089, Use fink's python, enable gcc-4.0 + g++-3.3 pair for 10.4-transitional
--- config_office/configure.in	31 Jan 2006 18:28:45 -0000	1.151
+++ config_office/configure.in	31 Jan 2006 20:26:27 -0000
@@ -229,6 +229,16 @@
 AC_ARG_WITH(system-python,
 [  --with-system-python    Use python already on system
 ],,)
+AC_ARG_WITH(python-libs,
+[[  --with-python-libs[=auto|LIBS|none]
+                          Specify linker options to link the python library. [default=auto]
+                          This option does nothing without --with-system-python.
+]],[
+case $withval in
+   yes) with_python_libs=auto;;
+   no|"") with_python_libs=none;;
+esac
+],with_python_libs=auto)
 #AC_ARG_WITH(system-icu,
 #[  --with-system-icu       Use icu already on system
 #],,)
@@ -1056,20 +1066,6 @@
 fi 
 AC_SUBST(GCCVER)
 
-if test "$GCC" = "yes"; then
-   AC_MSG_CHECKING([whether $CC supports -fvisibility=hidden])
-   save_CFLAGS=$CFLAGS
-   CFLAGS="$CFLAGS -fvisibility=hidden"
-   AC_TRY_LINK([], [ return 0; ], [ HAVE_GCC_VISIBILITY_FEATURE=TRUE ], [])
-   CFLAGS=$save_CFLAGS
-   if test "$HAVE_GCC_VISIBILITY_FEATURE" = "TRUE"; then
-      AC_MSG_RESULT([yes])
-   else
-      AC_MSG_RESULT([no])
-   fi
-fi
-AC_SUBST(HAVE_GCC_VISIBILITY_FEATURE)
-
 dnl ===================================================================
 dnl Search all the common names for GNU make
 dnl ===================================================================
@@ -1540,6 +1536,27 @@
    fi
 fi
 
+if test "$GCC" = "yes"; then
+   AC_MSG_CHECKING([whether both $CC and $CXX support -fvisibility=hidden])
+   save_CFLAGS=$CFLAGS
+   HAVE_GCC_VISIBILITY_FEATURE=TRUE
+   CFLAGS="$CFLAGS -fvisibility=hidden"
+   AC_TRY_LINK([], [ return 0; ], [], [ HAVE_GCC_VISIBILITY_FEATURE=FALSE ])
+   CFLAGS=$save_CFLAGS
+   AC_LANG_SAVE
+   AC_LANG_CPLUSPLUS
+   CXXFLAGS="$CXXFLAGS -fvisibility=hidden"
+   AC_TRY_LINK([], [ return 0; ], [], [ HAVE_GCC_VISIBILITY_FEATURE=FALSE ])
+   CXXFLAGS=$save_CFLAGS
+   AC_LANG_RESTORE
+   if test "$HAVE_GCC_VISIBILITY_FEATURE" = "TRUE"; then
+      AC_MSG_RESULT([yes])
+   else
+      AC_MSG_RESULT([no])
+   fi
+fi
+AC_SUBST(HAVE_GCC_VISIBILITY_FEATURE)
+
 dnl *************************************************************
 dnl Testing for exception handling - dwarf2 or sjlj exceptions...
 dnl *************************************************************
@@ -2133,7 +2150,7 @@
    AC_PROG_CPP
 fi
 dnl Check whether there's a C++ pre-processor.
-if test "$_os" = "Linux" -o "$_os" = "FreeBSD" -o "$_os" = "NetBSD" ; then
+if test "$_os" = "Linux" -o "$_os" = "FreeBSD" -o "$_os" = "NetBSD" -o "$_os" = "Darwin"; then
    AC_PROG_CXXCPP
 fi
 
@@ -2596,11 +2613,16 @@
    python_version=`$PYTHON -c "import distutils.sysconfig; print distutils.sysconfig.get_config_var('VERSION');"`
    PYTHON_CFLAGS="-I$python_include"
 
-   if test "$_os" = "Darwin"; then
-      PYTHON_LIBS="-framework Python"
-   else
-      PYTHON_LIBS="-lpython$python_version"
-   fi
+   case $with_python_libs in
+      auto)
+      case $_os:$python_include in
+         Darwin:/System/*) PYTHON_LIBS="-framework Python" ;;
+         *) PYTHON_LIBS="-lpython$python_version" ;;
+      esac
+      ;;
+      none) PYTHON_LIBS= ;;
+      *) PYTHON_LIBS=$with_python_libs ;;
+   esac
    
    dnl check if the headers really work:
    save_CPPFLAGS="$CPPFLAGS"
@@ -3027,25 +3027,25 @@
     SYSTEM_MOZILLA=YES
     AC_MSG_CHECKING([whether to use Mozilla or Firefox])
     if test -n "$with_firefox" && test "$with_firefox" != "no"; then
-      moz_flavour=firefox
+      MOZ_FLAVOUR=firefox
      else
-      moz_flavour=mozilla
+      MOZ_FLAVOUR=mozilla
     fi
-    tmp=`echo $moz_flavour | $PERL -e 'print ucfirst(<STDIN>);'`
+    tmp=`echo $MOZ_FLAVOUR | $PERL -e 'print ucfirst(<STDIN>);'`
     AC_MSG_RESULT($tmp)
 
-    PKG_CHECK_MODULES( MOZILLAXPCOM, $moz_flavour-xpcom )
+    PKG_CHECK_MODULES( MOZILLAXPCOM, $MOZ_FLAVOUR-xpcom )
 
     if $PKG_CONFIG --exists nspr ; then
       PKG_CHECK_MODULES( MOZ_NSPR, nspr )
     else
-      PKG_CHECK_MODULES( MOZ_NSPR, mozilla-nspr )
+      PKG_CHECK_MODULES( MOZ_NSPR, $MOZ_FLAVOUR-nspr )
     fi
 
     PKG_CHECK_MODULES( MOZ_NSS, nss, STANDALONENSS="TRUE", STANDALONENSS="" )
     if test -z "$STANDALONENSS"; then
-        PKG_CHECK_MODULES( MOZ_NSS, $moz_flavour-nss )
+        PKG_CHECK_MODULES( MOZ_NSS, $MOZ_FLAVOUR-nss )
     fi
 
     save_CPPFLAGS="$CPPFLAGS"
     save_LDFLAGS="$LDFLAGS"
@@ -3058,8 +3058,8 @@
     CPPFLAGS="$save_CPPFLAGS"
     LIBS="$save_LIBS"
 
-    MOZ_INC=`$PKG_CONFIG --variable=includedir $moz_flavour-xpcom`
-    MOZ_LIB=`$PKG_CONFIG --variable=libdir $moz_flavour-xpcom`
+    MOZ_INC=`$PKG_CONFIG --variable=includedir $MOZ_FLAVOUR-xpcom`
+    MOZ_LIB=`$PKG_CONFIG --variable=libdir $MOZ_FLAVOUR-xpcom`
     MOZ_LIB_XPCOM=$MOZILLAXPCOM_LIBS
     if test "$WITH_OPENLDAP" != "YES"; then
       MOZ_LDAP_CFLAGS="-I$MOZ_INC"
@@ -3167,6 +3167,7 @@
 
 fi
 AC_SUBST(SYSTEM_MOZILLA)
+AC_SUBST(MOZ_FLAVOUR)
 AC_SUBST(MOZ_INC)
 AC_SUBST(MOZ_LIB)
 AC_SUBST(MOZ_LIB_XPCOM)
### IssuzeZilla #60089
--- config_office/set_soenv.in.orig	2005-12-29 19:38:49.000000000 +0100
+++ config_office/set_soenv.in	2005-12-29 19:40:19.000000000 +0100
@@ -1732,6 +1732,7 @@
 ToFile( "WITH_OPENLDAP",     "@WITH_OPENLDAP@",    "e" );
 ToFile( "WITH_MOZILLA",      "@WITH_MOZILLA@",     "e" );
 ToFile( "SYSTEM_MOZILLA",    "@SYSTEM_MOZILLA@",   "e" );
+ToFile( "MOZ_FLAVOUR",       "@MOZ_FLAVOUR@",      "e" );
 ToFile( "MOZ_INC",           "@MOZ_INC@",          "e" );
 ToFile( "MOZ_LIB",           "@MOZ_LIB@",          "e" );
 ToFile( "MOZ_LIB_XPCOM",     "@MOZ_LIB_XPCOM@",    "e" );
--- extensions/source/plugin/util/makefile.pmk.orig	2005-12-29 19:59:22.000000000 +0100
+++ extensions/source/plugin/util/makefile.pmk	2005-12-29 19:59:37.000000000 +0100
@@ -41,6 +41,6 @@
 
 .IF "$(SYSTEM_MOZILLA)" == "YES"
 CFLAGS+=-DSYSTEM_MOZILLA
-PKGCONFIG_MODULES=mozilla-plugin
+PKGCONFIG_MODULES=$(MOZ_FLAVOUR)-plugin
 .INCLUDE : pkg_config.mk
 .ENDIF
--- libxmlsec/xmlsec1-1.2.6.patch.orig	2006-01-05 20:15:25.000000000 +0100
+++ libxmlsec/xmlsec1-1.2.6.patch	2006-01-07 21:07:49.000000000 +0100
@@ -37,7 +37,12 @@
   LIBXML_LIBS=""
   LIBXML_FOUND="no"
 ***************
-*** 25682,25688 ****
+*** 25677,25688 ****
+  
+  
+  XMLSEC_NO_NSS="1"
+! MOZILLA_MIN_VERSION="1.4"
+  NSS_MIN_VERSION="3.2"
   NSPR_MIN_VERSION="4.0"
   NSS_CFLAGS=""
   NSS_LIBS=""
@@ -45,7 +49,12 @@
   NSPR_LIBS_LIST="-lnspr4 -lplds4 -lplc4"
   NSS_CRYPTO_LIB="$PACKAGE-nss"
   NSS_FOUND="no"
---- 25682,25688 ----
+--- 25677,25688 ----
+  
+  
+  XMLSEC_NO_NSS="1"
+! MOZILLA_MIN_VERSION="1.4"; test "$MOZ_FLAVOUR" = firefox && MOZILLA_MIN_VERSION="1.0"
+  NSS_MIN_VERSION="3.2"
   NSPR_MIN_VERSION="4.0"
   NSS_CFLAGS=""
   NSS_LIBS=""
@@ -54,6 +62,72 @@
   NSS_CRYPTO_LIB="$PACKAGE-nss"
   NSS_FOUND="no"
 ***************
+*** 25766,25788 ****
+    else
+       PKG_CONFIG_MIN_VERSION=0.9.0
+       if $PKG_CONFIG --atleast-pkgconfig-version $PKG_CONFIG_MIN_VERSION; then
+!         echo "$as_me:$LINENO: checking for mozilla-nspr >= $MOZILLA_MIN_VERSION mozilla-nss >= $MOZILLA_MIN_VERSION" >&5
+! echo $ECHO_N "checking for mozilla-nspr >= $MOZILLA_MIN_VERSION mozilla-nss >= $MOZILLA_MIN_VERSION... $ECHO_C" >&6
+  
+!         if $PKG_CONFIG --exists "mozilla-nspr >= $MOZILLA_MIN_VERSION mozilla-nss >= $MOZILLA_MIN_VERSION" ; then
+              echo "$as_me:$LINENO: result: yes" >&5
+  echo "${ECHO_T}yes" >&6
+              succeeded=yes
+  
+              echo "$as_me:$LINENO: checking NSS_CFLAGS" >&5
+  echo $ECHO_N "checking NSS_CFLAGS... $ECHO_C" >&6
+!             NSS_CFLAGS=`$PKG_CONFIG --cflags "mozilla-nspr >= $MOZILLA_MIN_VERSION mozilla-nss >= $MOZILLA_MIN_VERSION"`
+              echo "$as_me:$LINENO: result: $NSS_CFLAGS" >&5
+  echo "${ECHO_T}$NSS_CFLAGS" >&6
+  
+              echo "$as_me:$LINENO: checking NSS_LIBS" >&5
+  echo $ECHO_N "checking NSS_LIBS... $ECHO_C" >&6
+!             NSS_LIBS=`$PKG_CONFIG --libs "mozilla-nspr >= $MOZILLA_MIN_VERSION mozilla-nss >= $MOZILLA_MIN_VERSION"`
+              echo "$as_me:$LINENO: result: $NSS_LIBS" >&5
+  echo "${ECHO_T}$NSS_LIBS" >&6
+          else
+--- 25766,25788 ----
+    else
+       PKG_CONFIG_MIN_VERSION=0.9.0
+       if $PKG_CONFIG --atleast-pkgconfig-version $PKG_CONFIG_MIN_VERSION; then
+!         echo "$as_me:$LINENO: checking for $MOZ_FLAVOUR-nspr >= $MOZILLA_MIN_VERSION $MOZ_FLAVOUR-nss >= $MOZILLA_MIN_VERSION" >&5
+! echo $ECHO_N "checking for $MOZ_FLAVOUR-nspr >= $MOZILLA_MIN_VERSION $MOZ_FLAVOUR-nss >= $MOZILLA_MIN_VERSION... $ECHO_C" >&6
+  
+!         if $PKG_CONFIG --exists "$MOZ_FLAVOUR-nspr >= $MOZILLA_MIN_VERSION $MOZ_FLAVOUR-nss >= $MOZILLA_MIN_VERSION" ; then
+              echo "$as_me:$LINENO: result: yes" >&5
+  echo "${ECHO_T}yes" >&6
+              succeeded=yes
+  
+              echo "$as_me:$LINENO: checking NSS_CFLAGS" >&5
+  echo $ECHO_N "checking NSS_CFLAGS... $ECHO_C" >&6
+!             NSS_CFLAGS=`$PKG_CONFIG --cflags "$MOZ_FLAVOUR-nspr >= $MOZILLA_MIN_VERSION $MOZ_FLAVOUR-nss >= $MOZILLA_MIN_VERSION"`
+              echo "$as_me:$LINENO: result: $NSS_CFLAGS" >&5
+  echo "${ECHO_T}$NSS_CFLAGS" >&6
+  
+              echo "$as_me:$LINENO: checking NSS_LIBS" >&5
+  echo $ECHO_N "checking NSS_LIBS... $ECHO_C" >&6
+!             NSS_LIBS=`$PKG_CONFIG --libs "$MOZ_FLAVOUR-nspr >= $MOZILLA_MIN_VERSION $MOZ_FLAVOUR-nss >= $MOZILLA_MIN_VERSION"`
+              echo "$as_me:$LINENO: result: $NSS_LIBS" >&5
+  echo "${ECHO_T}$NSS_LIBS" >&6
+          else
+***************
+*** 25790,25796 ****
+              NSS_LIBS=""
+              ## If we have a custom action on failure, don't print errors, but
+              ## do set a variable so people can do so.
+!             NSS_PKG_ERRORS=`$PKG_CONFIG --errors-to-stdout --print-errors "mozilla-nspr >= $MOZILLA_MIN_VERSION mozilla-nss >= $MOZILLA_MIN_VERSION"`
+  
+          fi
+  
+--- 25790,25796 ----
+              NSS_LIBS=""
+              ## If we have a custom action on failure, don't print errors, but
+              ## do set a variable so people can do so.
+!             NSS_PKG_ERRORS=`$PKG_CONFIG --errors-to-stdout --print-errors "$MOZ_FLAVOUR-nspr >= $MOZILLA_MIN_VERSION $MOZ_FLAVOUR-nss >= $MOZILLA_MIN_VERSION"`
+  
+          fi
+  
+***************
 *** 25817,25824 ****
           ac_mozilla_name=mozilla-$MOZILLA_MIN_VERSION
       fi
@@ -126,7 +200,12 @@
   LIBXML_LIBS=""
   LIBXML_FOUND="no"
 ***************
-*** 507,513 ****
+*** 502,513 ****
+  dnl ==========================================================================
+      
+  XMLSEC_NO_NSS="1"
+! MOZILLA_MIN_VERSION="1.4"
+  NSS_MIN_VERSION="3.2"
   NSPR_MIN_VERSION="4.0"
   NSS_CFLAGS=""
   NSS_LIBS=""
@@ -134,7 +213,12 @@
   NSPR_LIBS_LIST="-lnspr4 -lplds4 -lplc4"
   NSS_CRYPTO_LIB="$PACKAGE-nss"
   NSS_FOUND="no"
---- 507,513 ----
+--- 502,513 ----
+  dnl ==========================================================================
+      
+  XMLSEC_NO_NSS="1"
+! MOZILLA_MIN_VERSION="1.4"; test "$MOZ_FLAVOUR" = firefox && MOZILLA_MIN_VERSION="1.0"
+  NSS_MIN_VERSION="3.2"
   NSPR_MIN_VERSION="4.0"
   NSS_CFLAGS=""
   NSS_LIBS=""
@@ -143,6 +227,23 @@
   NSS_CRYPTO_LIB="$PACKAGE-nss"
   NSS_FOUND="no"
 ***************
+*** 521,527 ****
+      AC_MSG_RESULT(no)
+      NSS_FOUND="without"
+  elif test "z$with_nss" = "z" -a "z$with_nspr" = "z" -a "z$with_mozilla_ver" = "z" -a "z$PKG_CONFIG_ENABLED" = "zyes" ; then
+!     PKG_CHECK_MODULES(NSS, mozilla-nspr >= $MOZILLA_MIN_VERSION mozilla-nss >= $MOZILLA_MIN_VERSION,
+  	[NSS_FOUND=yes],
+  	[NSS_FOUND=no])
+  fi
+--- 521,527 ----
+      AC_MSG_RESULT(no)
+      NSS_FOUND="without"
+  elif test "z$with_nss" = "z" -a "z$with_nspr" = "z" -a "z$with_mozilla_ver" = "z" -a "z$PKG_CONFIG_ENABLED" = "zyes" ; then
+!     PKG_CHECK_MODULES(NSS, $MOZ_FLAVOUR-nspr >= $MOZILLA_MIN_VERSION $MOZ_FLAVOUR-nss >= $MOZILLA_MIN_VERSION,
+  	[NSS_FOUND=yes],
+  	[NSS_FOUND=no])
+  fi
+***************
 *** 534,541 ****
           ac_mozilla_name=mozilla-$MOZILLA_MIN_VERSION
       fi
### Workaround gcc 4.0.0's bug (2.0 <= Xcode < 2.2)
--- rsc/source/parser/rsclex.cxx.orig	2005-09-08 22:47:43.000000000 +0900
+++ rsc/source/parser/rsclex.cxx	2006-01-16 04:09:20.000000000 +0900
@@ -86,7 +86,7 @@
 RscFileInst*	pFI;
 RscTypCont* 	pTC;
 RscExpression * pExp;
-struct {
+struct RscKeyVal { // workaround gcc 4.0.0's bug (gcc bugzilla #15049)
 	int 	nKeyWord;
 	YYSTYPE aYYSType;
 } aKeyVal[ 1 ];
--- framework/source/loadenv/loadenv.cxx.orig	2005-11-11 21:06:12.000000000 +0900
+++ framework/source/loadenv/loadenv.cxx	2006-01-17 22:17:03.000000000 +0900
@@ -617,7 +617,13 @@
             // <- BREAK SAFE ------------------------------
             xAsyncLoader->cancel();
             // <- RESTART SAFE ----------------------------
+#if defined(__GNUC__) && (__GNUC__ == 4) && (__GNUC_MINOR__ == 0) && (__GNUC_PATCHLEVEL__ < 1)
+            try {
+                aReadLock.lock();
+            } catch (...) {} // avoid an internal compiler error
+#else
             aReadLock.lock();
+#endif
             /* Attention:
                 After returning from any cancel/dispose call, neither the frame nor weself
                 may be called back. Because only we can cancel this job, we already know
--- framework/source/services/autorecovery.cxx.orig	2005-12-22 01:08:39.000000000 +0900
+++ framework/source/services/autorecovery.cxx	2006-01-20 04:54:11.000000000 +0900
@@ -825,7 +825,13 @@
         // <- SAFE ------------------------------
         aReadLock.unlock();
         xListener->statusChanged(aEvent);
+#if defined(__GNUC__) && (__GNUC__ == 4) && (__GNUC_MINOR__ == 0) && (__GNUC_PATCHLEVEL__ < 1)
+        try {
+            aReadLock.lock();
+        } catch (...) {} // avoid an internal compiler error
+#else
         aReadLock.lock();
+#endif
         // SAFE -> ------------------------------
     }
 
--- binfilter/bf_sw/source/core/txtnode/makefile.mk	9 Sep 2005 02:37:27 -0000	1.4
+++ binfilter/bf_sw/source/core/txtnode/makefile.mk	18 Jan 2006 17:53:49 -0000
@@ -63,10 +63,6 @@
 LIBFLAGS=/NOI /NOE /PAGE:512
 .ENDIF
 
-.IF "$(COMID)" == "gcc3"
-ENVCFLAGS=-fno-access-control
-.ENDIF
-
 # --- Files --------------------------------------------------------
 
 CXXFILES = \
--- binfilter/bf_sw/source/core/txtnode/sw_thints.cxx	9 Sep 2005 02:41:10 -0000	1.7
+++ binfilter/bf_sw/source/core/txtnode/sw_thints.cxx	18 Jan 2006 17:53:50 -0000
@@ -1853,11 +1853,7 @@
 /*N*/ 			( SFX_ITEM_SET == rNode.GetpSwAttrSet()->GetItemState( nWhich,
 /*N*/ 				FALSE, &pParaItem ) ) && ( pParaItem == &pHint->GetAttr() );
 /*N*/ 		BOOL bReplace = !( SETATTR_DONTREPLACE & nMode );
-#if defined(_MSC_VER) && (_MSC_VER >= 1310 )
-			::binfilter::SwpHtStart_SAR *pTmpHints = 0;
-#else
-/*N*/ 		SwpHtStart_SAR *pTmpHints = 0;
-#endif
+/*N*/ 		::binfilter::SwpHtStart_SAR *pTmpHints = 0;
 /*N*/
 /*N*/ 		USHORT i;
 /*N*/ 		// Wir wollen zwar von nHtStart bis nMaxEnd, muessen aber ggf.
@@ -2034,11 +2030,7 @@
 /*N*/ 									// Beim Einfuegen spaltet es sich selbst.
 /*?*/ 										if( pHistory ) pHistory->Add( pOther );
 /*?*/ 										if( !pTmpHints )
-#if defined(_MSC_VER) && (_MSC_VER >= 1310 )
-												pTmpHints = new ::binfilter::SwpHtStart_SAR();
-#else
-/*?*/ 											pTmpHints = new SwpHtStart_SAR();
-#endif
+/*?*/ 											pTmpHints = new ::binfilter::SwpHtStart_SAR();
 /*?*/ 										pTmpHints->C40_INSERT( SwTxtAttr, pOther,
 /*?*/ 											pTmpHints->Count() );
 /*?*/ 										Cut( i );
@@ -2087,11 +2079,7 @@
 /*?*/ 									// Beim Einfuegen spaltet es sich selbst.
 /*?*/ 										if( pHistory ) pHistory->Add( pOther );
 /*?*/ 										if( !pTmpHints )
-#if defined(_MSC_VER) && (_MSC_VER >= 1310 )
-												pTmpHints = new ::binfilter::SwpHtStart_SAR();
-#else
-/*?*/ 											pTmpHints = new SwpHtStart_SAR();
-#endif
+/*?*/ 											pTmpHints = new ::binfilter::SwpHtStart_SAR();
 /*?*/ 										pTmpHints->C40_INSERT( SwTxtAttr, pOther,
 /*?*/ 											pTmpHints->Count() );
 /*?*/ 										Cut( i );
--- binfilter/bf_xmloff/source/text/xmloff_XMLIndexBibliographySourceContext.cxx.orig	2005-09-09 19:21:35.000000000 +0900
+++ binfilter/bf_xmloff/source/text/xmloff_XMLIndexBibliographySourceContext.cxx	2006-01-19 02:07:39.000000000 +0900
@@ -144,12 +144,22 @@
 	if ( ( XML_NAMESPACE_TEXT == nPrefix ) &&
 		 ( IsXMLToken( rLocalName, XML_BIBLIOGRAPHY_ENTRY_TEMPLATE ) ) )
 	{
+#if defined(__GNUC__) && (__GNUC__ == 4) && (__GNUC_MINOR__ == 0) && (__GNUC_PATCHLEVEL__ < 1)
+                static const SvXMLEnumMapEntry *p = aLevelNameBibliographyMap;
+		return new XMLIndexTemplateContext(GetImport(), rIndexPropertySet, 
+										   nPrefix, rLocalName,
+										   p,
+										   XML_BIBLIOGRAPHY_TYPE,
+										   aLevelStylePropNameBibliographyMap,
+										   aAllowedTokenTypesBibliography);
+#else
 		return new XMLIndexTemplateContext(GetImport(), rIndexPropertySet, 
 										   nPrefix, rLocalName,
 										   aLevelNameBibliographyMap,
 										   XML_BIBLIOGRAPHY_TYPE,
 										   aLevelStylePropNameBibliographyMap,
 										   aAllowedTokenTypesBibliography);
+#endif
 	}
 	else 
 	{
--- sw/source/core/txtnode/makefile.mk	9 Sep 2005 05:12:57 -0000	1.7
+++ sw/source/core/txtnode/makefile.mk	19 Jan 2006 05:42:26 -0000
@@ -48,10 +48,6 @@
 CDEFS+=-Dmydebug
 .ENDIF
 
-.IF "$(COMID)" == "gcc3"
-ENVCFLAGS=-fno-access-control
-.ENDIF
-
 # --- Files --------------------------------------------------------
 
 SLOFILES =  \
### List of help images is misgenerated; IssueZilla #60490
--- helpcontent2/helpers/create_ilst.pl	17 Jan 2006 12:23:19 -0000	1.4
+++ helpcontent2/helpers/create_ilst.pl	21 Jan 2006 13:26:15 -0000
@@ -45,8 +45,7 @@
 ($params =~ /-dir/) ? ($startdir = $params) =~ (s/.*-dir=([^\|]*).*$/$1/gs) : (($startdir = `pwd`) =~ s/\n//gs);
 ($params =~ /-pre/) ? ($pre = $params) =~ (s/.*-pre=([^\|]*).*$/$1/gs) : ($pre = "helpimg");
 
-my $startdir_regexp = $startdir;
-$startdir_regexp =~ s/\\/\\\\/g;
+my $startdir_regexp = quotemeta($startdir);
 
 
 if ( -d $startdir ) {
### IssueZilla #59729
Index: extensions/source/plugin/base/makefile.mk
===================================================================
RCS file: /cvs/util/extensions/source/plugin/base/makefile.mk,v
retrieving revision 1.8
diff -u -p -r1.8 makefile.mk
--- extensions/source/plugin/base/makefile.mk	8 Sep 2005 19:50:31 -0000	1.8
+++ extensions/source/plugin/base/makefile.mk	25 Jan 2006 14:30:56 -0000
@@ -41,6 +41,8 @@ ENABLE_EXCEPTIONS=TRUE
 
 .INCLUDE :  ..$/util$/makefile.pmk
 
+.IF "$(WITH_MOZILLA)" != "NO"
+
 SLOFILES=		\
 				$(SLO)$/plctrl.obj		\
 				$(SLO)$/service.obj		\
@@ -53,6 +55,8 @@ SLOFILES=		\
 				$(SLO)$/multiplx.obj    \
 				$(SLO)$/plmodel.obj
 
+.ENDIF # $(WITH_MOZILLA) != "NO"
+
 # --- Targets ------------------------------------------------------
 
 .INCLUDE :  target.mk
Index: extensions/source/plugin/unx/makefile.mk
===================================================================
RCS file: /cvs/util/extensions/source/plugin/unx/makefile.mk,v
retrieving revision 1.8
diff -u -p -r1.8 makefile.mk
--- extensions/source/plugin/unx/makefile.mk	8 Sep 2005 19:55:36 -0000	1.8
+++ extensions/source/plugin/unx/makefile.mk	25 Jan 2006 14:30:56 -0000
@@ -42,6 +42,8 @@ TARGETTYPE=CUI
 
 # --- Files --------------------------------------------------------
 
+.IF "$(WITH_MOZILLA)" != "NO"
+
 SLOFILES=\
 	$(SLO)$/nppapi.obj		\
 	$(SLO)$/sysplug.obj		\
@@ -73,6 +75,7 @@ APP1STDLIBS+=-lXaw -lXt -lXext -lX11 -ld
 
 APP1DEF=	$(MISC)$/$(TARGET).def
 
+.ENDIF # $(WITH_MOZILLA) != "NO"
 
 # --- Targets ------------------------------------------------------
 
Index: extensions/source/plugin/util/makefile.mk
===================================================================
RCS file: /cvs/util/extensions/source/plugin/util/makefile.mk,v
retrieving revision 1.12
diff -u -p -r1.12 makefile.mk
--- extensions/source/plugin/util/makefile.mk	8 Sep 2005 19:57:10 -0000	1.12
+++ extensions/source/plugin/util/makefile.mk	25 Jan 2006 14:30:56 -0000
@@ -43,6 +43,9 @@ TARGETTYPE=GUI
 .INCLUDE :  settings.mk
 
 # --- Files --------------------------------------------------------
+
+.IF "$(WITH_MOZILLA)" != "NO"
+
 LIB1TARGET = $(SLB)$/plall.lib
 LIB1FILES  = \
 	$(SLB)$/plbase.lib	\
@@ -97,6 +100,8 @@ SHL1STDLIBS+= -lX11
 
 SHL1STDLIBS+=$(SHL1OWNLIBS)
 
+.ENDIF # $(WITH_MOZILLA) != "NO"
+
 # --- Targets ------------------------------------------------------
 
 .INCLUDE :  target.mk
Index: extensions/source/plugin/win/makefile.mk
===================================================================
RCS file: /cvs/util/extensions/source/plugin/win/makefile.mk,v
retrieving revision 1.4
diff -u -p -r1.4 makefile.mk
--- extensions/source/plugin/win/makefile.mk	8 Sep 2005 19:58:00 -0000	1.4
+++ extensions/source/plugin/win/makefile.mk	25 Jan 2006 14:30:56 -0000
@@ -46,6 +46,8 @@ ENABLE_EXCEPTIONS=TRUE
 
 # --- Types -------------------------------------
 
+.IF "$(WITH_MOZILLA)" != "NO"
+
 #UNOUCROUT=$(OUT)$/inc$/$(PRJNAME)
 #INCPRE+=$(UNOUCROUT)
 
@@ -54,7 +56,9 @@ ENABLE_EXCEPTIONS=TRUE
 SLOFILES =	$(SLO)$/winmgr.obj	\
 			$(SLO)$/sysplug.obj
 
+.ENDIF # $(WITH_MOZILLA) != "NO"
 .ENDIF
+
 # ------------------------------------------------------------------
 
 
Index: file_library_ooo.scp
===================================================================
RCS file: /cvs/installation/scp2/source/ooo/file_library_ooo.scp,v
retrieving revision 1.182
diff -u -r1.182 file_library_ooo.scp
--- scp2/source/ooo/file_library_ooo.scp	31 Jan 2006 18:49:59 -0000	1.182
+++ scp2/source/ooo/file_library_ooo.scp	9 Feb 2006 06:23:41 -0000
@@ -1474,7 +1474,9 @@
     PACKED_UNO_LIB_FILE_BODY_PATCH;
 End
 
+#ifndef WITHOUT_MOZILLA
 STD_UNO_LIB_FILE_PATCH( gid_File_Lib_Pl , pl)
+#endif
 
 STD_UNO_LIB_FILE_PATCH( gid_File_Lib_Preload, preload)
 
Index: scp2/source/ooo/file_ooo.scp
===================================================================
RCS file: /cvs/installation/scp2/source/ooo/file_ooo.scp,v
retrieving revision 1.134
diff -u -p -r1.134 file_ooo.scp
--- scp2/source/ooo/file_ooo.scp	5 Jan 2006 14:55:20 -0000	1.134
+++ scp2/source/ooo/file_ooo.scp	25 Jan 2006 14:43:38 -0000
@@ -163,6 +163,8 @@ File gid_File_Bin_MsiPkgchk
 End
 #endif
 
+#ifndef WITHOUT_MOZILLA
+
 #if !defined(UNX) || defined(ENABLE_GTK)
 File gid_File_Lib_Npsoplugin
         BIN_FILE_BODY;
@@ -184,6 +186,7 @@ File gid_File_Exe_Nsplugin
   #endif
 End
 #endif
+#endif
 
 File gid_File_Bin_Uno
     BIN_FILE_BODY;
@@ -291,7 +294,7 @@ File gid_File_Rdb_Gengal
     Name = "gengal.rdb";
 End
 
-#ifdef UNX
+#if !defined(WITHOUT_MOZILLA) && defined(UNX)
 
 File gid_File_Bin_Pluginapp
     BIN_FILE_BODY;
