diff -uNbr poll-emulator-1.1/Makefile poll-emulator-1.1.new/Makefile
--- poll-emulator-1.1/Makefile	Mon Mar  5 09:47:52 2001
+++ poll-emulator-1.1.new/Makefile	Sat Feb 16 21:07:00 2002
@@ -8,23 +8,33 @@
 #############################################################################
 
 # ---------------------------------------------------------------------------
+# Installation prefix
+
+PREFIX		= @PREFIX@
+LIBDIR		= $(PREFIX)/lib
+INCDIR		= $(PREFIX)/include/sys
+
+# ---------------------------------------------------------------------------
 # Compilation and Linkage
 #
 # For GNU CC. Should work for FreeBSD, NetBSD, OpenBSD and BSD/OS
 
-CC		= gcc
+MAJOR		= 1
+MINOR		= 1
+VERSION		= $(MAJOR).$(MINOR)
+CC		= cc
+INSTALL		= install -c
+LIB_NAME	= libpoll
+SHLIB_EXT	= dylib
+SHLIB_NOVER	= $(LIB_NAME).$(SHLIB_EXT)
+SHLIB		= $(LIB_NAME).$(VERSION).$(SHLIB_EXT)
+LIB		= $(LIB_NAME).a
 COMPILE_STATIC	= $(CC) -c 
 COMPILE_SHARED	= $(CC) -c -fPIC 
-LINK_SHARED	= $(CC) -shared
+LINK		= $(CC) -install_name $(PREFIX)/lib/$(SHLIB) -compatibility_version $(VERSION) -current_version $(VERSION)
+LINK_SHARED	= $(CC) -install_name $(PREFIX)/lib/$(SHLIB) -compatibility_version $(VERSION) -current_version $(VERSION) -dynamiclib
 RANLIB		= ranlib
 
-# ---------------------------------------------------------------------------
-# Installation prefix
-
-PREFIX		= /usr/local
-LIBDIR		= $(PREFIX)/lib 
-INCDIR		= $(PREFIX)/include
-
 #############################################################################
 # There should be no need to edit past this point
 #############################################################################
@@ -36,22 +46,23 @@
 .c.o:
 	$(COMPILE_STATIC) $<
 
-SHLIB_NOVER	= libpoll.so 
-SHLIB		= $(SHLIB_NOVER).1
-LIB		= libpoll.a
-
 all:		libs
 libs:		$(SHLIB) $(LIB)
 test:		polltest
-install:
-		mkdir -p $(LIBDIR)
-		cp $(SHLIB) $(LIB) $(LIBDIR)
-		cd $(LIBDIR) && ln -s $(SHLIB) $(SHLIB_NOVER)
-		mkdir -p $(INCDIR)
-		cp poll.h $(INCDIR)
+
+dirs:
+		@echo "creating directories..."
+		$(INSTALL) -m 755 -d $(LIBDIR)
+		$(INSTALL) -m 755 -d $(INCDIR)
+
+install:	all dirs
+		$(INSTALL) -m 755 $(SHLIB) $(LIB) $(LIBDIR)
+		ln -sf $(SHLIB) $(LIBDIR)/$(LIB_NAME).$(MAJOR).$(SHLIB_EXT)
+		ln -sf $(SHLIB) $(LIBDIR)/$(SHLIB_NOVER)
+		$(INSTALL) -m 644 poll.h $(INCDIR)
 
 clean:
-		rm -f poll.po *.o libpoll.so* libpoll.a polltest
+		rm -f poll.po *.o $(LIB) $(SHLIB) $(SHLIB_NOVER) polltest
 
 $(SHLIB):	poll.po
 		$(LINK_SHARED) -o $(SHLIB) poll.po
