Package: qt4-x11
Version: 4.2.2
Revision: 1021
Description: Cross-Platform framework (X11 version)
License: GPL
Maintainer: Benjamin Reed <qt4-x11@fink.racoonfink.com>

Depends: %N-core-shlibs (>= %v-%r), %N-gui-shlibs (>= %v-%r), %N-designer (>= %v-%r), %N-linguist (>= %v-%r), %N-doc (>= %v-%r), pkgconfig, macosx (>= 10.4.3-1)
BuildDepends: cctools (>= 446-0), cups-dev, dbus-dev (>= 0.60-1003), expat1, fink (>= 0.24-1), freetype219, glib2-dev (>= 2.8.6-123), libgettext3-dev, libiconv-dev, libpng3 (>= 1.2.5-4), libjpeg, macosx (>= 10.4.3-1), pkgconfig, x11-dev
BuildConflicts: autogen-dev
BuildDependsOnly: true
GCC: 4.0

CustomMirror: <<
	Primary: ftp://ftp.trolltech.com/qt/source
	eur-DE: ftp://ftp.fu-berlin.de/unix/X11/gui/Qt/source
	eur-DE: http://wftp.tu-chemnitz.de/pub/Qt/qt/source
	eur-DE: ftp://ftp.tu-chemnitz.de/pub/Qt/qt/source
	eur-GR: http://ftp.ntua.gr/pub/X11/Qt/qt/source
	eur-GR: ftp://ftp.ntua.gr/pub/X11/Qt/qt/source
	eur-NO: ftp://ftp.trolltech.com/qt/source
	eur-RO: http://ftp.iasi.roedu.net/mirrors/ftp.trolltech.com/qt/source
	eur-RO: ftp://ftp.iasi.roedu.net/mirrors/ftp.trolltech.com/qt/source
	nam-US: http://ftp.silug.org/mirrors/ftp.trolltech.com/qt/source
	nam-US: ftp://ftp.silug.org/mirrors/ftp.trolltech.com/qt/source
	nam-US: http://ftp.mj2.org/pub/qt/source
	nam-US: ftp://ftp.mj2.org/pub/qt/source
<<
Source: mirror:custom:qt-x11-opensource-src-%v.tar.gz
Source2: http://ranger.users.finkproject.org/distfiles/qt-mac-for-x11-%v.tar.bz2
SourceDirectory: qt-x11-opensource-src-%v
Source2ExtractDir: qt-x11-opensource-src-%v
Source-MD5: 19f6374fe7924e33775cb87ee02669cb
Source2-MD5: aa303f5a0ac9926700c6bfd57124eeb1
PatchScript: sed -e 's,@PREFIX@,%p,g' < %a/%n.patch | patch -p1

SetMAKEFLAGS: -j1
NoSetLDFLAGS: true
NoSetMAKEFLAGS: true
CompileScript: <<
#!/bin/sh -ev

	unset QMAKESPEC
	export QTDIR=`pwd`
	export PATH="$QTDIR/bin:%p/lib/freetype219/bin:$PATH"

	if [ -f /usr/lib/libresolv.dylib ]; then
		LIBRESOLV="-lresolv"
		perl -pi -e 's,#define QT_AOUT_UNDERSCORE,,' mkspecs/darwin-g++/qplatformdefs.h
	else
		LIBRESOLV=""
	fi

	echo "yes" | ./configure  \
		'-I%p/lib/freetype219/include' '-I%p/lib/freetype219/include/freetype2' '-L%p/lib/freetype219/lib' \
		'-I/usr/X11R6/include' '-L/usr/X11R6/lib' \
		'-I%p/include' '-L%p/lib' \
		$LIBRESOLV -platform darwin-g++ -xplatform darwin-g++ \
		-prefix '%p/lib/%N' -docdir '%p/share/doc/%N' \
		-no-exceptions -no-pch -qt-gif \
		-no-sql-ibase -no-sql-mysql -no-sql-odbc -no-sql-psql \
		-plugin-sql-sqlite

	# don't link against older versions of self
	/usr/bin/find . -name Makefile -print0 | xargs -0 perl -pi -e 's,-L%p/lib/%n/lib,,g'

	# attempt to counterfix qmake's warped fileFixify logic that makes install break
	# when %p is a symlink and something exists already at -libdir or -datadir etc
	# second, better attempt at unfixifying %p:
	pushd %p; FixifiedSW=`/bin/pwd`; popd
	/usr/bin/find . -name Makefile -print0 | xargs -0 perl -pi -e "s,\\$\\(INSTALL_ROOT\\)$FixifiedSW,\\$\\(INSTALL_ROOT\\)%p,g"

	make
<<

InstallScript: <<
#!/bin/sh -ev

	#### MAIN INSTALL ####

	unset QMAKESPEC
	export QTDIR=`pwd`
	export PATH="$QTDIR/bin:$PATH"

	make install INSTALL_ROOT=%d
	install -d -m 755 %i/bin
	for bin in linguist designer qtconfig; do
		ln -sf %p/lib/%N/bin/$bin %i/bin/${bin}4-x11
	done

	#### FIX AND INSTALL LA, PRL and PC FILES ####

	install -d -m 755 %i/lib/%N/lib/pkgconfig
	mv %i/lib/%N/lib/*.pc %i/lib/%N/lib/pkgconfig
	perl -pi -e 's,%b/lib,%p/lib/%N/lib,g' %i/lib/%N/lib/pkgconfig/*.pc %i/lib/%N/lib/*.prl %i/lib/%N/lib/*.la

	#### TUTORIALS AND EXAMPLES ####

	# clean up the makefiles
	perl -pi -e "s,^DEPENDPATH.*,,g;s,^REQUIRES.*,,g" `/usr/bin/find demos examples -name "*.pro"`

	install -d -m 0755 %i/share/doc/%N/examples
	install -d -m 0755 %i/share/doc/%N/demos
	/bin/cp -fRL examples/* %i/share/doc/%N/examples/
	/bin/cp -fRL demos/* %i/share/doc/%N/demos/

	# kde icon for qt designer
	install -d -m 0755 %i/share/applnk/Development
	cat >%i/share/applnk/Development/designer4.desktop <<EOF
[Desktop Entry]
Name=Qt Designer 4
GenericName=Interface Designer
Exec=%p/lib/%N/bin/designer
Icon=designer
InitialPreference=5
MapNotify=true
MimeType=application/x-designer
Terminal=false
Encoding=UTF-8
Type=Application
EOF
	cat >%i/share/applnk/Development/linguist4.desktop <<EOF
[Desktop Entry]
Name=Qt Linguist 4
GenericName=Translation Editor
Exec=%p/lib/%N/bin/linguist
Icon=linguist
InitialPreference=5
MapNotify=true
Terminal=false
Encoding=UTF-8
Type=Application
EOF

	/usr/bin/find %i/share/doc/%N/ -name \*.moc -print0 | xargs -0 rm -rf {} >/dev/null 2>&1 || :
	/usr/bin/find %i/share/doc/%N/ -name \*.obj -print0 | xargs -0 rm -rf {} >/dev/null 2>&1 || :
	/usr/bin/find %i/share/doc/%N/examples -name Makefile -print0 | xargs -0 rm -rf >/dev/null 2>&1 || :

	install -d -m 755 %i/share/doc/installed-packages
	touch %i/share/doc/installed-packages/%N
<<
DocFiles: INSTALL LICENSE.* OPENSOURCE-NOTICE.TXT README
SplitOff: <<
	Package: %N-gui-shlibs
	Depends: %N-core-shlibs (>= %v-%r), libpng3-shlibs (>= 1.2.5-4), libjpeg-shlibs, x11-shlibs
	Suggests: %N-designer, %N-linguist, %N-doc
	Files: <<
		lib/%N/lib/libQt3Support.*.dylib
		lib/%N/lib/libQtAssistantClient.*.dylib
		lib/%N/lib/libQtGui.*.dylib
		lib/%N/lib/libQtOpenGL.*.dylib
		lib/%N/lib/libQtSvg.*.dylib
		lib/%N/plugins/accessible
		lib/%N/plugins/imageformats
	<<
	Shlibs: <<
		%p/lib/%N/lib/libQt3Support.4.dylib                 4.2.0 %n (>= 4.2.0-1)
		%p/lib/%N/lib/libQtAssistantClient.4.dylib          4.2.0 %n (>= 4.2.0-1)
		%p/lib/%N/lib/libQtGui.4.dylib                      4.2.0 %n (>= 4.2.0-1)
		%p/lib/%N/lib/libQtOpenGL.4.dylib                   4.2.0 %n (>= 4.2.0-1)
		%p/lib/%N/lib/libQtSvg.4.dylib                      4.2.0 %n (>= 4.2.0-1)
	<<
	PostInstScript: (/usr/X11R6/bin/fc-cache -f || :) >/tmp/fc-cache.log 2>&1 || :
<<
SplitOff2: <<
	Package: %N-core-shlibs
	Depends: dbus-shlibs (>= 0.60-1003), fink (>= 0.24-1)
	Files: <<
		lib/%N/lib/libQtCore.*.dylib
		lib/%N/lib/libQtDBus.*.dylib
		lib/%N/lib/libQtNetwork.*.dylib
		lib/%N/lib/libQtSql.*.dylib
		lib/%N/lib/libQtTest.*.dylib
		lib/%N/lib/libQtXml.*.dylib
		lib/%N/plugins/codecs
		lib/%N/plugins/sqldrivers
	<<
	Shlibs: <<
		%p/lib/%N/lib/libQtCore.4.dylib                     4.2.0 %n (>= 4.2.0-1)
		%p/lib/%N/lib/libQtDBus.4.dylib                     4.2.0 %n (>= 4.2.0-1)
		%p/lib/%N/lib/libQtNetwork.4.dylib                  4.2.0 %n (>= 4.2.0-1)
		%p/lib/%N/lib/libQtSql.4.dylib                      4.2.0 %n (>= 4.2.0-1)
		%p/lib/%N/lib/libQtTest.4.dylib                     4.2.0 %n (>= 4.2.0-1)
		%p/lib/%N/lib/libQtXml.4.dylib                      4.2.0 %n (>= 4.2.0-1)
	<<
<<
SplitOff3: <<
	Package: %N-designer
	Depends: %N-designer-shlibs (>= %v-%r), x11
	Files: <<
		bin/designer*
		share/applnk/Development/designer4.desktop
		lib/%N/bin/designer
	<<
<<
SplitOff4: <<
	Package: %N-designer-shlibs
	Depends: %N-gui-shlibs (>= %v-%r), x11-shlibs
	Files: <<
		lib/%N/lib/libQtDesigner.*.dylib
		lib/%N/lib/libQtDesignerComponents.*.dylib
		lib/%N/plugins/designer
	<<
	Shlibs: <<
		%p/lib/%N/lib/libQtDesigner.4.dylib                 4.2.0 %n (>= 4.2.0-1)
		%p/lib/%N/lib/libQtDesignerComponents.4.dylib       4.2.0 %n (>= 4.2.0-1)
	<<
<<
SplitOff5: <<
	Package: %N-linguist
	Depends: %N-gui-shlibs (>= %v-%r), x11
	Files: <<
		bin/l*
		share/applnk/Development/linguist4.desktop
		lib/%N/bin/l*
		lib/%N/phrasebooks
	<<
<<
SplitOff6: <<
	Package: %N-doc
	Files: share/doc/%N
<<

Homepage: http://www.trolltech.com/
DescUsage: <<
	To compile against this package, you need to make sure that
	%p/lib/%N/bin is first in your PATH.  $QTDIR is no longer necessary;
	instead, qmake contains the information necessary to find your Qt
	environment, and when you generate a project using qmake it knows
	what to do.

	If you need to manually find this package for whatever reason, you
	need -I%p/lib/%N/include in your compiler flags, and
	-L%p/lib/%N/lib in your linker flags.  In this case, it's still a
	good idea to set your PATH to %p/lib/%N/bin as well.

	To build the demos and examples, it's enough to just run qmake on
	the .pro file in the %p/share/doc/%N directory in the %N-doc
	package:

		mkdir /tmp/build-examples
		cd /tmp/build-examples
		%p/lib/%N/bin/qmake %p/share/doc/%N/examples/examples.pro
		make
<<
DescPackaging: 	This package is dedicated to Boo Fulbright.

