diff -uNr postgresql-7.3.4/configure postgresql-7.3.4-new/configure
--- postgresql-7.3.4/configure	Wed Jul 23 00:09:40 2003
+++ postgresql-7.3.4-new/configure	Sat Sep  6 19:57:04 2003
@@ -4155,7 +4155,7 @@
 
 
 # Extract the first word of "perl", so it can be a program name with args.
-set dummy perl; ac_word=$2
+set dummy perl; ac_word=perl5.6.0
 echo "$as_me:$LINENO: checking for $ac_word" >&5
 echo $ECHO_N "checking for $ac_word... $ECHO_C" >&6
 if test "${ac_cv_path_PERL+set}" = set; then
@@ -4222,7 +4222,7 @@
 
 if test "$with_python" = yes; then
   # Extract the first word of "python", so it can be a program name with args.
-set dummy python; ac_word=$2
+set dummy python; ac_word=python2.1
 echo "$as_me:$LINENO: checking for $ac_word" >&5
 echo $ECHO_N "checking for $ac_word... $ECHO_C" >&6
 if test "${ac_cv_path_PYTHON+set}" = set; then
@@ -8330,8 +8330,8 @@
 
 if test "$with_pam" = yes ; then
   if test "${ac_cv_header_security_pam_appl_h+set}" = set; then
-  echo "$as_me:$LINENO: checking for security/pam_appl.h" >&5
-echo $ECHO_N "checking for security/pam_appl.h... $ECHO_C" >&6
+  echo "$as_me:$LINENO: checking for pam/pam_appl.h" >&5
+echo $ECHO_N "checking for pam/pam_appl.h... $ECHO_C" >&6
 if test "${ac_cv_header_security_pam_appl_h+set}" = set; then
   echo $ECHO_N "(cached) $ECHO_C" >&6
 fi
@@ -8339,13 +8339,13 @@
 echo "${ECHO_T}$ac_cv_header_security_pam_appl_h" >&6
 else
   # Is the header compilable?
-echo "$as_me:$LINENO: checking security/pam_appl.h usability" >&5
-echo $ECHO_N "checking security/pam_appl.h usability... $ECHO_C" >&6
+echo "$as_me:$LINENO: checking pam/pam_appl.h usability" >&5
+echo $ECHO_N "checking pam/pam_appl.h usability... $ECHO_C" >&6
 cat >conftest.$ac_ext <<_ACEOF
 #line $LINENO "configure"
 #include "confdefs.h"
 $ac_includes_default
-#include <security/pam_appl.h>
+#include <pam/pam_appl.h>
 _ACEOF
 rm -f conftest.$ac_objext
 if { (eval echo "$as_me:$LINENO: \"$ac_compile\"") >&5
@@ -8370,12 +8370,12 @@
 echo "${ECHO_T}$ac_header_compiler" >&6
 
 # Is the header present?
-echo "$as_me:$LINENO: checking security/pam_appl.h presence" >&5
-echo $ECHO_N "checking security/pam_appl.h presence... $ECHO_C" >&6
+echo "$as_me:$LINENO: checking pam/pam_appl.h presence" >&5
+echo $ECHO_N "checking pam/pam_appl.h presence... $ECHO_C" >&6
 cat >conftest.$ac_ext <<_ACEOF
 #line $LINENO "configure"
 #include "confdefs.h"
-#include <security/pam_appl.h>
+#include <pam/pam_appl.h>
 _ACEOF
 if { (eval echo "$as_me:$LINENO: \"$ac_cpp conftest.$ac_ext\"") >&5
   (eval $ac_cpp conftest.$ac_ext) 2>conftest.er1
@@ -8407,20 +8407,20 @@
 # So?  What about this header?
 case $ac_header_compiler:$ac_header_preproc in
   yes:no )
-    { echo "$as_me:$LINENO: WARNING: security/pam_appl.h: accepted by the compiler, rejected by the preprocessor!" >&5
-echo "$as_me: WARNING: security/pam_appl.h: accepted by the compiler, rejected by the preprocessor!" >&2;}
-    { echo "$as_me:$LINENO: WARNING: security/pam_appl.h: proceeding with the preprocessor's result" >&5
-echo "$as_me: WARNING: security/pam_appl.h: proceeding with the preprocessor's result" >&2;};;
+    { echo "$as_me:$LINENO: WARNING: pam/pam_appl.h: accepted by the compiler, rejected by the preprocessor!" >&5
+echo "$as_me: WARNING: pam/pam_appl.h: accepted by the compiler, rejected by the preprocessor!" >&2;}
+    { echo "$as_me:$LINENO: WARNING: pam/pam_appl.h: proceeding with the preprocessor's result" >&5
+echo "$as_me: WARNING: pam/pam_appl.h: proceeding with the preprocessor's result" >&2;};;
   no:yes )
-    { echo "$as_me:$LINENO: WARNING: security/pam_appl.h: present but cannot be compiled" >&5
-echo "$as_me: WARNING: security/pam_appl.h: present but cannot be compiled" >&2;}
-    { echo "$as_me:$LINENO: WARNING: security/pam_appl.h: check for missing prerequisite headers?" >&5
-echo "$as_me: WARNING: security/pam_appl.h: check for missing prerequisite headers?" >&2;}
-    { echo "$as_me:$LINENO: WARNING: security/pam_appl.h: proceeding with the preprocessor's result" >&5
-echo "$as_me: WARNING: security/pam_appl.h: proceeding with the preprocessor's result" >&2;};;
+    { echo "$as_me:$LINENO: WARNING: pam/pam_appl.h: present but cannot be compiled" >&5
+echo "$as_me: WARNING: pam/pam_appl.h: present but cannot be compiled" >&2;}
+    { echo "$as_me:$LINENO: WARNING: pam/pam_appl.h: check for missing prerequisite headers?" >&5
+echo "$as_me: WARNING: pam/pam_appl.h: check for missing prerequisite headers?" >&2;}
+    { echo "$as_me:$LINENO: WARNING: pam/pam_appl.h: proceeding with the preprocessor's result" >&5
+echo "$as_me: WARNING: pam/pam_appl.h: proceeding with the preprocessor's result" >&2;};;
 esac
-echo "$as_me:$LINENO: checking for security/pam_appl.h" >&5
-echo $ECHO_N "checking for security/pam_appl.h... $ECHO_C" >&6
+echo "$as_me:$LINENO: checking for pam/pam_appl.h" >&5
+echo $ECHO_N "checking for pam/pam_appl.h... $ECHO_C" >&6
 if test "${ac_cv_header_security_pam_appl_h+set}" = set; then
   echo $ECHO_N "(cached) $ECHO_C" >&6
 else
@@ -8433,8 +8433,8 @@
 if test $ac_cv_header_security_pam_appl_h = yes; then
   :
 else
-  { { echo "$as_me:$LINENO: error: header file <security/pam_appl.h> is required for PAM" >&5
-echo "$as_me: error: header file <security/pam_appl.h> is required for PAM" >&2;}
+  { { echo "$as_me:$LINENO: error: header file <pam/pam_appl.h> is required for PAM" >&5
+echo "$as_me: error: header file <pam/pam_appl.h> is required for PAM" >&2;}
    { (exit 1); exit 1; }; }
 fi
 
diff -uNr postgresql-7.3.4/configure.in postgresql-7.3.4-new/configure.in
--- postgresql-7.3.4/configure.in	Wed Jul 23 00:09:42 2003
+++ postgresql-7.3.4-new/configure.in	Sat Sep  6 19:57:04 2003
@@ -724,7 +724,12 @@
 fi
 
 if test "$with_pam" = yes ; then
-  AC_CHECK_HEADER([security/pam_appl.h], [], [AC_MSG_ERROR([header file <security/pam_appl.h> is required for PAM])])
+  AC_CHECK_HEADERS([security/pam_appl.h], [], [
+    AC_CHECK_HEADERS([pam/pam_appl.h], [
+      AC_DEFINE([HAVE_PAM_PAM_APPL_H], 1, [Define if pam_appl.h is in pam/ instead of security/])
+      ], [AC_MSG_ERROR([header file <security/pam_appl.h> or <pam/pam_appl.h> is required for PAM])]
+    )
+  ])
 fi
 
 
diff -uNr postgresql-7.3.4/pgsql.sh postgresql-7.3.4-new/pgsql.sh
--- postgresql-7.3.4/pgsql.sh	Wed Dec 31 19:00:00 1969
+++ postgresql-7.3.4-new/pgsql.sh	Sat Sep  6 22:02:50 2003
@@ -0,0 +1,21 @@
+#!/bin/sh
+
+for flag in "-n" "-d" "-s" "-u" "-v"; do
+	ulimit $flag 65536 >/dev/null 2>&1 || :
+done
+
+PREFIX="@PREFIX@"
+DATADIR="${PREFIX}/var/postgresql/data"
+LOGFILE="${DATADIR}/pgsql.log"
+
+case "$1" in
+	start)
+		sudo -u postgres "${PREFIX}/bin/pg_ctl" start -D "$DATADIR" -l "$LOGFILE"
+		;;
+	restart)
+		sudo -u postgres "${PREFIX}/bin/pg_ctl" restart -D "$DATADIR" -m fast
+		;;
+	stop)
+		sudo -u postgres "${PREFIX}/bin/pg_ctl" stop -D "$DATADIR" -m fast
+		;;
+esac
diff -uNr postgresql-7.3.4/src/Makefile.shlib postgresql-7.3.4-new/src/Makefile.shlib
--- postgresql-7.3.4/src/Makefile.shlib	Sat Jan 11 12:22:34 2003
+++ postgresql-7.3.4-new/src/Makefile.shlib	Sat Sep  6 19:57:04 2003
@@ -81,8 +81,24 @@
 endif
 
 ifeq ($(PORTNAME), darwin)
-  shlib			:= lib$(NAME)$(DLSUFFIX).$(SO_MAJOR_VERSION).$(SO_MINOR_VERSION)
-  LINK.shared		= $(COMPILER) $(DARWIN_NAMESPACE_SPEC) -bundle -undefined suppress
+  ifeq (,$(filter $(host_os), darwin1.0 darwin1.1 darwin1.2))
+     MULTIPLY_DEFINED	=
+  else
+     MULTIPLY_DEFINED	= -multiply_defined suppress
+  endif
+
+  shlib			:= lib$(NAME).$(SO_MAJOR_VERSION).$(SO_MINOR_VERSION)$(DLSUFFIX)
+  ifneq ($(SO_MAJOR_VERSION), 0)
+    version_link	:= -compatibility_version $(SO_MAJOR_VERSION) -current_version $(SO_MAJOR_VERSION).$(SO_MINOR_VERSION)
+  endif
+  ifeq ($(DLTYPE), bundle)
+    DLSUFFIX		:= .so
+    LINK.shared		= $(COMPILER) $(DARWIN_NAMESPACE_SPEC) -bundle -undefined suppress -flat_namespace
+  else
+    DLSUFFIX		:= .dylib
+    LINK.shared		= $(COMPILER) $(DARWIN_NAMESPACE_SPEC) -install_name $(libdir)/lib$(NAME).$(SO_MAJOR_VERSION)$(DLSUFFIX) $(version_link) -dynamiclib $(MULTIPLY_DEFINED)
+  endif
+  SHLIB_LINK		:= -L$(libpq_builddir) $(SHLIB_LINK)
 endif
 
 ifeq ($(PORTNAME), openbsd)
@@ -246,6 +262,7 @@
 ifneq ($(PORTNAME), beos)
 ifneq ($(PORTNAME), win)
 ifneq ($(PORTNAME), aix)
+ifneq ($(PORTNAME), darwin)
 
 # Normal case
 $(shlib): $(OBJS)
@@ -261,6 +278,25 @@
 	$(LN_S) $(shlib) lib$(NAME)$(DLSUFFIX)
 endif
 
+else # PORTNAME == darwin
+
+# Darwin case
+# (same as normal case, but libfoo.version.suffix)
+
+$(shlib): $(OBJS)
+	$(LINK.shared) $(OBJS) $(SHLIB_LINK) -o $@
+ifneq ($(shlib), lib$(NAME).$(SO_MAJOR_VERSION)$(DLSUFFIX))
+	rm -f lib$(NAME).$(SO_MAJOR_VERSION)$(DLSUFFIX)
+	$(LN_S) $(shlib) lib$(NAME).$(SO_MAJOR_VERSION)$(DLSUFFIX)
+endif
+
+ifneq ($(shlib), lib$(NAME)$(DLSUFFIX))
+	rm -f lib$(NAME)$(DLSUFFIX)
+	$(LN_S) $(shlib) lib$(NAME)$(DLSUFFIX)
+endif
+
+endif # PORTNAME == darwin
+
 else # PORTNAME == aix
 
 # AIX case
@@ -308,7 +344,10 @@
 ifeq ($(enable_shared), yes)
 install-lib-shared: $(shlib)
 	$(INSTALL_SHLIB) $< $(DESTDIR)$(libdir)/$(shlib)
+
 ifneq ($(PORTNAME), win)
+ifneq ($(PORTNAME), darwin)
+
 ifneq ($(shlib), lib$(NAME)$(DLSUFFIX).$(SO_MAJOR_VERSION))
 	cd $(DESTDIR)$(libdir) && \
 	rm -f lib$(NAME)$(DLSUFFIX).$(SO_MAJOR_VERSION) && \
@@ -320,7 +359,23 @@
 	$(LN_S) $(shlib) lib$(NAME)$(DLSUFFIX)
 endif
 
-endif # not win
+else # PORTNAME == darwin
+
+ifneq ($(shlib), lib$(NAME).$(SO_MAJOR_VERSION)$(DLSUFFIX))
+	cd $(DESTDIR)$(libdir) && \
+	rm -f lib$(NAME).$(SO_MAJOR_VERSION)$(DLSUFFIX) && \
+	$(LN_S) $(shlib) lib$(NAME).$(SO_MAJOR_VERSION)$(DLSUFFIX)
+endif
+ifneq ($(shlib), lib$(NAME)$(DLSUFFIX))
+	cd $(DESTDIR)$(libdir) && \
+	rm -f lib$(NAME)$(DLSUFFIX) && \
+	$(LN_S) $(shlib) lib$(NAME)$(DLSUFFIX)
+endif
+
+endif # PORTNAME == darwin
+
+endif # PORTNAME == win
+
 endif # enable_shared
 
 
@@ -334,7 +389,9 @@
 ifeq ($(enable_shared), yes)
 	rm -f $(DESTDIR)$(libdir)/lib$(NAME)$(DLSUFFIX) \
 	  $(DESTDIR)$(libdir)/lib$(NAME)$(DLSUFFIX).$(SO_MAJOR_VERSION) \
-	  $(DESTDIR)$(libdir)/lib$(NAME)$(DLSUFFIX).$(SO_MAJOR_VERSION).$(SO_MINOR_VERSION)
+	  $(DESTDIR)$(libdir)/lib$(NAME)$(DLSUFFIX).$(SO_MAJOR_VERSION).$(SO_MINOR_VERSION) \
+	  $(DESTDIR)$(libdir)/lib$(NAME).$(SO_MAJOR_VERSION)$(DLSUFFIX) \
+	  $(DESTDIR)$(libdir)/lib$(NAME).$(SO_MAJOR_VERSION).$(SO_MINOR_VERSION)$(DLSUFFIX)
 endif # enable_shared
 
 
@@ -346,7 +403,7 @@
 clean-lib:
 	rm -f lib$(NAME).a
 ifeq ($(enable_shared), yes)
-	rm -f lib$(NAME)$(DLSUFFIX) lib$(NAME)$(DLSUFFIX).$(SO_MAJOR_VERSION) lib$(NAME)$(DLSUFFIX).$(SO_MAJOR_VERSION).$(SO_MINOR_VERSION)
+	rm -f lib$(NAME)$(DLSUFFIX) lib$(NAME)$(DLSUFFIX).$(SO_MAJOR_VERSION) lib$(NAME)$(DLSUFFIX).$(SO_MAJOR_VERSION).$(SO_MINOR_VERSION) lib$(NAME).$(SO_MAJOR_VERSION)$(DLSUFFIX) lib$(NAME).$(SO_MAJOR_VERSION).$(SO_MINOR_VERSION)$(DLSUFFIX)
 ifdef EXPSUFF
 	rm -f lib$(NAME)$(EXPSUFF)
 endif
diff -uNr postgresql-7.3.4/src/backend/libpq/auth.c postgresql-7.3.4-new/src/backend/libpq/auth.c
--- postgresql-7.3.4/src/backend/libpq/auth.c	Wed Sep  4 19:31:34 2002
+++ postgresql-7.3.4-new/src/backend/libpq/auth.c	Sat Sep  6 19:57:04 2003
@@ -42,7 +42,12 @@
 char	   *pg_krb_server_keyfile;
 
 #ifdef USE_PAM
+
+#ifdef HAVE_PAM_PAM_APPL_H
+#include <pam/pam_appl.h>
+#else
 #include <security/pam_appl.h>
+#endif
 
 #define PGSQL_PAM_SERVICE "postgresql"	/* Service name passed to PAM */
 
diff -uNr postgresql-7.3.4/src/backend/postmaster/postmaster.c postgresql-7.3.4-new/src/backend/postmaster/postmaster.c
--- postgresql-7.3.4/src/backend/postmaster/postmaster.c	Sat Feb 22 23:48:38 2003
+++ postgresql-7.3.4-new/src/backend/postmaster/postmaster.c	Sat Sep  6 19:57:04 2003
@@ -85,6 +85,10 @@
 #include <getopt.h>
 #endif
 
+#ifdef HAVE_RENDEZVOUS
+#include <DNSServiceDiscovery/DNSServiceDiscovery.h>
+#endif
+
 #include "catalog/pg_database.h"
 #include "commands/async.h"
 #include "lib/dllist.h"
@@ -203,6 +207,10 @@
 bool		Log_connections = false;
 bool		Db_user_namespace = false;
 
+#ifdef HAVE_RENDEZVOUS
+/* service name */
+char		*service_name = NULL;
+#endif
 
 /* Startup/shutdown state */
 static pid_t StartupPID = 0,
@@ -354,6 +362,17 @@
 }
 
 
+#ifdef HAVE_RENDEZVOUS
+
+/* reg_reply -- empty callback function for DNSServiceRegistrationCreate() */
+static void
+reg_reply(DNSServiceRegistrationReplyErrorType errorCode, void *context)
+{
+
+}
+
+#endif
+
 int
 PostmasterMain(int argc, char *argv[])
 {
@@ -684,6 +703,21 @@
 		{
 			postmaster_error("cannot create INET stream port");
 			ExitPostmaster(1);
+                } else {
+#ifdef HAVE_RENDEZVOUS
+                    /* Rendezvous, baby! */
+                    
+                    if (service_name != NULL)
+                    {
+                        DNSServiceRegistrationCreate(service_name,
+                                "_pgsql._tcp.",
+                                "",
+                                htonl(PostPortNumber),
+                                "",
+                                (DNSServiceRegistrationReply)reg_reply,
+                                NULL);
+                    }
+#endif
 		}
 	}
 
diff -uNr postgresql-7.3.4/src/backend/utils/fmgr/dfmgr.c postgresql-7.3.4-new/src/backend/utils/fmgr/dfmgr.c
--- postgresql-7.3.4/src/backend/utils/fmgr/dfmgr.c	Sun Sep  1 22:47:05 2002
+++ postgresql-7.3.4-new/src/backend/utils/fmgr/dfmgr.c	Sat Sep  6 19:54:44 2003
@@ -247,6 +247,11 @@
 #error "DLSUFFIX must be defined to compile this file."
 #endif
 
+#ifdef __APPLE__
+#undef DLSUFFIX
+#define DLSUFFIX ".so"
+#endif
+
 /* Example format: "/usr/local/pgsql/lib" */
 #ifndef PKGLIBDIR
 #error "PKGLIBDIR needs to be defined to compile this file."
diff -uNr postgresql-7.3.4/src/backend/utils/mb/conversion_procs/ascii_and_mic/Makefile postgresql-7.3.4-new/src/backend/utils/mb/conversion_procs/ascii_and_mic/Makefile
--- postgresql-7.3.4/src/backend/utils/mb/conversion_procs/ascii_and_mic/Makefile	Wed Aug 21 22:18:45 2002
+++ postgresql-7.3.4-new/src/backend/utils/mb/conversion_procs/ascii_and_mic/Makefile	Sat Sep  6 19:57:04 2003
@@ -3,6 +3,9 @@
 # $Id: Makefile,v 1.3 2002/08/22 02:18:45 momjian Exp $
 #
 #-------------------------------------------------------------------------
+
+DLTYPE = bundle
+
 subdir = src/backend/utils/mb/conversion_procs/ascii_and_mic
 top_builddir = ../../../../../..
 include $(top_builddir)/src/Makefile.global
diff -uNr postgresql-7.3.4/src/backend/utils/mb/conversion_procs/cyrillic_and_mic/Makefile postgresql-7.3.4-new/src/backend/utils/mb/conversion_procs/cyrillic_and_mic/Makefile
--- postgresql-7.3.4/src/backend/utils/mb/conversion_procs/cyrillic_and_mic/Makefile	Wed Aug 21 17:33:55 2002
+++ postgresql-7.3.4-new/src/backend/utils/mb/conversion_procs/cyrillic_and_mic/Makefile	Sat Sep  6 19:57:04 2003
@@ -3,6 +3,9 @@
 # $Id: Makefile,v 1.2 2002/08/21 21:33:55 momjian Exp $
 #
 #-------------------------------------------------------------------------
+
+DLTYPE = bundle
+
 subdir = src/backend/utils/mb/conversion_procs/cyrillic_and_mic
 top_builddir = ../../../../../..
 include $(top_builddir)/src/Makefile.global
diff -uNr postgresql-7.3.4/src/backend/utils/mb/conversion_procs/euc_cn_and_mic/Makefile postgresql-7.3.4-new/src/backend/utils/mb/conversion_procs/euc_cn_and_mic/Makefile
--- postgresql-7.3.4/src/backend/utils/mb/conversion_procs/euc_cn_and_mic/Makefile	Wed Aug 21 17:33:55 2002
+++ postgresql-7.3.4-new/src/backend/utils/mb/conversion_procs/euc_cn_and_mic/Makefile	Sat Sep  6 19:57:04 2003
@@ -3,6 +3,9 @@
 # $Id: Makefile,v 1.2 2002/08/21 21:33:55 momjian Exp $
 #
 #-------------------------------------------------------------------------
+
+DLTYPE = bundle
+
 subdir = src/backend/utils/mb/conversion_procs/euc_cn_and_mic
 top_builddir = ../../../../../..
 include $(top_builddir)/src/Makefile.global
diff -uNr postgresql-7.3.4/src/backend/utils/mb/conversion_procs/euc_jp_and_sjis/Makefile postgresql-7.3.4-new/src/backend/utils/mb/conversion_procs/euc_jp_and_sjis/Makefile
--- postgresql-7.3.4/src/backend/utils/mb/conversion_procs/euc_jp_and_sjis/Makefile	Wed Aug 21 17:33:55 2002
+++ postgresql-7.3.4-new/src/backend/utils/mb/conversion_procs/euc_jp_and_sjis/Makefile	Sat Sep  6 19:57:04 2003
@@ -3,6 +3,9 @@
 # $Id: Makefile,v 1.2 2002/08/21 21:33:55 momjian Exp $
 #
 #-------------------------------------------------------------------------
+
+DLTYPE = bundle
+
 subdir = src/backend/utils/mb/conversion_procs/euc_jp_and_sjis
 top_builddir = ../../../../../..
 include $(top_builddir)/src/Makefile.global
diff -uNr postgresql-7.3.4/src/backend/utils/mb/conversion_procs/euc_kr_and_mic/Makefile postgresql-7.3.4-new/src/backend/utils/mb/conversion_procs/euc_kr_and_mic/Makefile
--- postgresql-7.3.4/src/backend/utils/mb/conversion_procs/euc_kr_and_mic/Makefile	Wed Aug 21 17:33:55 2002
+++ postgresql-7.3.4-new/src/backend/utils/mb/conversion_procs/euc_kr_and_mic/Makefile	Sat Sep  6 19:57:04 2003
@@ -3,6 +3,9 @@
 # $Id: Makefile,v 1.2 2002/08/21 21:33:55 momjian Exp $
 #
 #-------------------------------------------------------------------------
+
+DLTYPE = bundle
+
 subdir = src/backend/utils/mb/conversion_procs/euc_kr_and_mic
 top_builddir = ../../../../../..
 include $(top_builddir)/src/Makefile.global
diff -uNr postgresql-7.3.4/src/backend/utils/mb/conversion_procs/euc_tw_and_big5/Makefile postgresql-7.3.4-new/src/backend/utils/mb/conversion_procs/euc_tw_and_big5/Makefile
--- postgresql-7.3.4/src/backend/utils/mb/conversion_procs/euc_tw_and_big5/Makefile	Wed Aug 21 17:33:55 2002
+++ postgresql-7.3.4-new/src/backend/utils/mb/conversion_procs/euc_tw_and_big5/Makefile	Sat Sep  6 19:57:04 2003
@@ -3,6 +3,9 @@
 # $Id: Makefile,v 1.2 2002/08/21 21:33:55 momjian Exp $
 #
 #-------------------------------------------------------------------------
+
+DLTYPE = bundle
+
 subdir = src/backend/utils/mb/conversion_procs/euc_tw_and_big5
 top_builddir = ../../../../../..
 include $(top_builddir)/src/Makefile.global
diff -uNr postgresql-7.3.4/src/backend/utils/mb/conversion_procs/latin2_and_win1250/Makefile postgresql-7.3.4-new/src/backend/utils/mb/conversion_procs/latin2_and_win1250/Makefile
--- postgresql-7.3.4/src/backend/utils/mb/conversion_procs/latin2_and_win1250/Makefile	Wed Aug 21 17:33:55 2002
+++ postgresql-7.3.4-new/src/backend/utils/mb/conversion_procs/latin2_and_win1250/Makefile	Sat Sep  6 19:57:04 2003
@@ -3,6 +3,9 @@
 # $Id: Makefile,v 1.2 2002/08/21 21:33:55 momjian Exp $
 #
 #-------------------------------------------------------------------------
+
+DLTYPE = bundle
+
 subdir = src/backend/utils/mb/conversion_procs/latin2_and_win1250
 top_builddir = ../../../../../..
 include $(top_builddir)/src/Makefile.global
diff -uNr postgresql-7.3.4/src/backend/utils/mb/conversion_procs/latin_and_mic/Makefile postgresql-7.3.4-new/src/backend/utils/mb/conversion_procs/latin_and_mic/Makefile
--- postgresql-7.3.4/src/backend/utils/mb/conversion_procs/latin_and_mic/Makefile	Wed Aug 21 17:33:55 2002
+++ postgresql-7.3.4-new/src/backend/utils/mb/conversion_procs/latin_and_mic/Makefile	Sat Sep  6 19:57:04 2003
@@ -3,6 +3,9 @@
 # $Id: Makefile,v 1.2 2002/08/21 21:33:55 momjian Exp $
 #
 #-------------------------------------------------------------------------
+
+DLTYPE = bundle
+
 subdir = src/backend/utils/mb/conversion_procs/latin_and_mic
 top_builddir = ../../../../../..
 include $(top_builddir)/src/Makefile.global
diff -uNr postgresql-7.3.4/src/backend/utils/mb/conversion_procs/proc.mk postgresql-7.3.4-new/src/backend/utils/mb/conversion_procs/proc.mk
--- postgresql-7.3.4/src/backend/utils/mb/conversion_procs/proc.mk	Thu Sep  5 14:28:46 2002
+++ postgresql-7.3.4-new/src/backend/utils/mb/conversion_procs/proc.mk	Sat Sep  6 19:57:04 2003
@@ -1,6 +1,7 @@
 SRCS		+= $(NAME).c
 OBJS		+= $(NAME).o
 
+DLTYPE		= bundle
 SHLIB_LINK 	:= $(BE_DLLLIBS)
 
 SO_MAJOR_VERSION := 0
diff -uNr postgresql-7.3.4/src/backend/utils/mb/conversion_procs/utf8_and_ascii/Makefile postgresql-7.3.4-new/src/backend/utils/mb/conversion_procs/utf8_and_ascii/Makefile
--- postgresql-7.3.4/src/backend/utils/mb/conversion_procs/utf8_and_ascii/Makefile	Wed Aug 21 17:33:55 2002
+++ postgresql-7.3.4-new/src/backend/utils/mb/conversion_procs/utf8_and_ascii/Makefile	Sat Sep  6 19:57:04 2003
@@ -3,6 +3,9 @@
 # $Id: Makefile,v 1.2 2002/08/21 21:33:55 momjian Exp $
 #
 #-------------------------------------------------------------------------
+
+DLTYPE = bundle
+
 subdir = src/backend/utils/mb/conversion_procs/utf8_and_ascii
 top_builddir = ../../../../../..
 include $(top_builddir)/src/Makefile.global
diff -uNr postgresql-7.3.4/src/backend/utils/mb/conversion_procs/utf8_and_big5/Makefile postgresql-7.3.4-new/src/backend/utils/mb/conversion_procs/utf8_and_big5/Makefile
--- postgresql-7.3.4/src/backend/utils/mb/conversion_procs/utf8_and_big5/Makefile	Wed Aug 21 17:33:55 2002
+++ postgresql-7.3.4-new/src/backend/utils/mb/conversion_procs/utf8_and_big5/Makefile	Sat Sep  6 19:57:04 2003
@@ -3,6 +3,9 @@
 # $Id: Makefile,v 1.2 2002/08/21 21:33:55 momjian Exp $
 #
 #-------------------------------------------------------------------------
+
+DLTYPE = bundle
+
 subdir = src/backend/utils/mb/conversion_procs/utf8_and_big5
 top_builddir = ../../../../../..
 include $(top_builddir)/src/Makefile.global
diff -uNr postgresql-7.3.4/src/backend/utils/mb/conversion_procs/utf8_and_cyrillic/Makefile postgresql-7.3.4-new/src/backend/utils/mb/conversion_procs/utf8_and_cyrillic/Makefile
--- postgresql-7.3.4/src/backend/utils/mb/conversion_procs/utf8_and_cyrillic/Makefile	Wed Aug 21 17:33:55 2002
+++ postgresql-7.3.4-new/src/backend/utils/mb/conversion_procs/utf8_and_cyrillic/Makefile	Sat Sep  6 19:57:04 2003
@@ -3,6 +3,9 @@
 # $Id: Makefile,v 1.2 2002/08/21 21:33:55 momjian Exp $
 #
 #-------------------------------------------------------------------------
+
+DLTYPE = bundle
+
 subdir = src/backend/utils/mb/conversion_procs/utf8_and_cyrillic
 top_builddir = ../../../../../..
 include $(top_builddir)/src/Makefile.global
diff -uNr postgresql-7.3.4/src/backend/utils/mb/conversion_procs/utf8_and_euc_cn/Makefile postgresql-7.3.4-new/src/backend/utils/mb/conversion_procs/utf8_and_euc_cn/Makefile
--- postgresql-7.3.4/src/backend/utils/mb/conversion_procs/utf8_and_euc_cn/Makefile	Wed Aug 21 17:33:55 2002
+++ postgresql-7.3.4-new/src/backend/utils/mb/conversion_procs/utf8_and_euc_cn/Makefile	Sat Sep  6 19:57:04 2003
@@ -3,6 +3,9 @@
 # $Id: Makefile,v 1.2 2002/08/21 21:33:55 momjian Exp $
 #
 #-------------------------------------------------------------------------
+
+DLTYPE = bundle
+
 subdir = src/backend/utils/mb/conversion_procs/utf8_and_euc_cn
 top_builddir = ../../../../../..
 include $(top_builddir)/src/Makefile.global
diff -uNr postgresql-7.3.4/src/backend/utils/mb/conversion_procs/utf8_and_euc_jp/Makefile postgresql-7.3.4-new/src/backend/utils/mb/conversion_procs/utf8_and_euc_jp/Makefile
--- postgresql-7.3.4/src/backend/utils/mb/conversion_procs/utf8_and_euc_jp/Makefile	Wed Aug 21 17:33:55 2002
+++ postgresql-7.3.4-new/src/backend/utils/mb/conversion_procs/utf8_and_euc_jp/Makefile	Sat Sep  6 19:57:04 2003
@@ -3,6 +3,9 @@
 # $Id: Makefile,v 1.2 2002/08/21 21:33:55 momjian Exp $
 #
 #-------------------------------------------------------------------------
+
+DLTYPE = bundle
+
 subdir = src/backend/utils/mb/conversion_procs/utf8_and_euc_jp
 top_builddir = ../../../../../..
 include $(top_builddir)/src/Makefile.global
diff -uNr postgresql-7.3.4/src/backend/utils/mb/conversion_procs/utf8_and_euc_kr/Makefile postgresql-7.3.4-new/src/backend/utils/mb/conversion_procs/utf8_and_euc_kr/Makefile
--- postgresql-7.3.4/src/backend/utils/mb/conversion_procs/utf8_and_euc_kr/Makefile	Wed Aug 21 17:33:55 2002
+++ postgresql-7.3.4-new/src/backend/utils/mb/conversion_procs/utf8_and_euc_kr/Makefile	Sat Sep  6 19:57:04 2003
@@ -3,6 +3,9 @@
 # $Id: Makefile,v 1.2 2002/08/21 21:33:55 momjian Exp $
 #
 #-------------------------------------------------------------------------
+
+DLTYPE = bundle
+
 subdir = src/backend/utils/mb/conversion_procs/utf8_and_euc_kr
 top_builddir = ../../../../../..
 include $(top_builddir)/src/Makefile.global
diff -uNr postgresql-7.3.4/src/backend/utils/mb/conversion_procs/utf8_and_euc_tw/Makefile postgresql-7.3.4-new/src/backend/utils/mb/conversion_procs/utf8_and_euc_tw/Makefile
--- postgresql-7.3.4/src/backend/utils/mb/conversion_procs/utf8_and_euc_tw/Makefile	Wed Aug 21 17:33:55 2002
+++ postgresql-7.3.4-new/src/backend/utils/mb/conversion_procs/utf8_and_euc_tw/Makefile	Sat Sep  6 19:57:04 2003
@@ -3,6 +3,9 @@
 # $Id: Makefile,v 1.2 2002/08/21 21:33:55 momjian Exp $
 #
 #-------------------------------------------------------------------------
+
+DLTYPE = bundle
+
 subdir = src/backend/utils/mb/conversion_procs/utf8_and_euc_tw
 top_builddir = ../../../../../..
 include $(top_builddir)/src/Makefile.global
diff -uNr postgresql-7.3.4/src/backend/utils/mb/conversion_procs/utf8_and_gb18030/Makefile postgresql-7.3.4-new/src/backend/utils/mb/conversion_procs/utf8_and_gb18030/Makefile
--- postgresql-7.3.4/src/backend/utils/mb/conversion_procs/utf8_and_gb18030/Makefile	Wed Aug 21 17:33:55 2002
+++ postgresql-7.3.4-new/src/backend/utils/mb/conversion_procs/utf8_and_gb18030/Makefile	Sat Sep  6 19:57:04 2003
@@ -3,6 +3,9 @@
 # $Id: Makefile,v 1.2 2002/08/21 21:33:55 momjian Exp $
 #
 #-------------------------------------------------------------------------
+
+DLTYPE = bundle
+
 subdir = src/backend/utils/mb/conversion_procs/utf8_and_gb18030
 top_builddir = ../../../../../..
 include $(top_builddir)/src/Makefile.global
diff -uNr postgresql-7.3.4/src/backend/utils/mb/conversion_procs/utf8_and_gbk/Makefile postgresql-7.3.4-new/src/backend/utils/mb/conversion_procs/utf8_and_gbk/Makefile
--- postgresql-7.3.4/src/backend/utils/mb/conversion_procs/utf8_and_gbk/Makefile	Wed Aug 21 17:33:55 2002
+++ postgresql-7.3.4-new/src/backend/utils/mb/conversion_procs/utf8_and_gbk/Makefile	Sat Sep  6 19:57:04 2003
@@ -3,6 +3,9 @@
 # $Id: Makefile,v 1.2 2002/08/21 21:33:55 momjian Exp $
 #
 #-------------------------------------------------------------------------
+
+DLTYPE = bundle
+
 subdir = src/backend/utils/mb/conversion_procs/utf8_and_gbk
 top_builddir = ../../../../../..
 include $(top_builddir)/src/Makefile.global
diff -uNr postgresql-7.3.4/src/backend/utils/mb/conversion_procs/utf8_and_iso8859/Makefile postgresql-7.3.4-new/src/backend/utils/mb/conversion_procs/utf8_and_iso8859/Makefile
--- postgresql-7.3.4/src/backend/utils/mb/conversion_procs/utf8_and_iso8859/Makefile	Wed Aug 21 17:33:55 2002
+++ postgresql-7.3.4-new/src/backend/utils/mb/conversion_procs/utf8_and_iso8859/Makefile	Sat Sep  6 19:57:04 2003
@@ -3,6 +3,9 @@
 # $Id: Makefile,v 1.2 2002/08/21 21:33:55 momjian Exp $
 #
 #-------------------------------------------------------------------------
+
+DLTYPE = bundle
+
 subdir = src/backend/utils/mb/conversion_procs/utf8_and_iso8859
 top_builddir = ../../../../../..
 include $(top_builddir)/src/Makefile.global
diff -uNr postgresql-7.3.4/src/backend/utils/mb/conversion_procs/utf8_and_iso8859_1/Makefile postgresql-7.3.4-new/src/backend/utils/mb/conversion_procs/utf8_and_iso8859_1/Makefile
--- postgresql-7.3.4/src/backend/utils/mb/conversion_procs/utf8_and_iso8859_1/Makefile	Wed Aug 21 17:33:55 2002
+++ postgresql-7.3.4-new/src/backend/utils/mb/conversion_procs/utf8_and_iso8859_1/Makefile	Sat Sep  6 19:57:04 2003
@@ -3,6 +3,9 @@
 # $Id: Makefile,v 1.2 2002/08/21 21:33:55 momjian Exp $
 #
 #-------------------------------------------------------------------------
+
+DLTYPE = bundle
+
 subdir = src/backend/utils/mb/conversion_procs/utf8_and_iso8859_1
 top_builddir = ../../../../../..
 include $(top_builddir)/src/Makefile.global
diff -uNr postgresql-7.3.4/src/backend/utils/mb/conversion_procs/utf8_and_johab/Makefile postgresql-7.3.4-new/src/backend/utils/mb/conversion_procs/utf8_and_johab/Makefile
--- postgresql-7.3.4/src/backend/utils/mb/conversion_procs/utf8_and_johab/Makefile	Wed Aug 21 17:33:55 2002
+++ postgresql-7.3.4-new/src/backend/utils/mb/conversion_procs/utf8_and_johab/Makefile	Sat Sep  6 19:57:04 2003
@@ -3,6 +3,9 @@
 # $Id: Makefile,v 1.2 2002/08/21 21:33:55 momjian Exp $
 #
 #-------------------------------------------------------------------------
+
+DLTYPE = bundle
+
 subdir = src/backend/utils/mb/conversion_procs/utf8_and_johab
 top_builddir = ../../../../../..
 include $(top_builddir)/src/Makefile.global
diff -uNr postgresql-7.3.4/src/backend/utils/mb/conversion_procs/utf8_and_sjis/Makefile postgresql-7.3.4-new/src/backend/utils/mb/conversion_procs/utf8_and_sjis/Makefile
--- postgresql-7.3.4/src/backend/utils/mb/conversion_procs/utf8_and_sjis/Makefile	Wed Aug 21 17:33:55 2002
+++ postgresql-7.3.4-new/src/backend/utils/mb/conversion_procs/utf8_and_sjis/Makefile	Sat Sep  6 19:57:04 2003
@@ -3,6 +3,9 @@
 # $Id: Makefile,v 1.2 2002/08/21 21:33:55 momjian Exp $
 #
 #-------------------------------------------------------------------------
+
+DLTYPE = bundle
+
 subdir = src/backend/utils/mb/conversion_procs/utf8_and_sjis
 top_builddir = ../../../../../..
 include $(top_builddir)/src/Makefile.global
diff -uNr postgresql-7.3.4/src/backend/utils/mb/conversion_procs/utf8_and_tcvn/Makefile postgresql-7.3.4-new/src/backend/utils/mb/conversion_procs/utf8_and_tcvn/Makefile
--- postgresql-7.3.4/src/backend/utils/mb/conversion_procs/utf8_and_tcvn/Makefile	Wed Aug 21 17:33:55 2002
+++ postgresql-7.3.4-new/src/backend/utils/mb/conversion_procs/utf8_and_tcvn/Makefile	Sat Sep  6 19:57:04 2003
@@ -3,6 +3,9 @@
 # $Id: Makefile,v 1.2 2002/08/21 21:33:55 momjian Exp $
 #
 #-------------------------------------------------------------------------
+
+DLTYPE = bundle
+
 subdir = src/backend/utils/mb/conversion_procs/utf8_and_tcvn
 top_builddir = ../../../../../..
 include $(top_builddir)/src/Makefile.global
diff -uNr postgresql-7.3.4/src/backend/utils/mb/conversion_procs/utf8_and_uhc/Makefile postgresql-7.3.4-new/src/backend/utils/mb/conversion_procs/utf8_and_uhc/Makefile
--- postgresql-7.3.4/src/backend/utils/mb/conversion_procs/utf8_and_uhc/Makefile	Wed Aug 21 17:33:55 2002
+++ postgresql-7.3.4-new/src/backend/utils/mb/conversion_procs/utf8_and_uhc/Makefile	Sat Sep  6 19:57:04 2003
@@ -3,6 +3,9 @@
 # $Id: Makefile,v 1.2 2002/08/21 21:33:55 momjian Exp $
 #
 #-------------------------------------------------------------------------
+
+DLTYPE = bundle
+
 subdir = src/backend/utils/mb/conversion_procs/utf8_and_uhc
 top_builddir = ../../../../../..
 include $(top_builddir)/src/Makefile.global
diff -uNr postgresql-7.3.4/src/backend/utils/mb/conversion_procs/utf8_and_win1250/Makefile postgresql-7.3.4-new/src/backend/utils/mb/conversion_procs/utf8_and_win1250/Makefile
--- postgresql-7.3.4/src/backend/utils/mb/conversion_procs/utf8_and_win1250/Makefile	Wed Aug 21 17:33:55 2002
+++ postgresql-7.3.4-new/src/backend/utils/mb/conversion_procs/utf8_and_win1250/Makefile	Sat Sep  6 19:57:04 2003
@@ -3,6 +3,9 @@
 # $Id: Makefile,v 1.2 2002/08/21 21:33:55 momjian Exp $
 #
 #-------------------------------------------------------------------------
+
+DLTYPE = bundle
+
 subdir = src/backend/utils/mb/conversion_procs/utf8_and_win1250
 top_builddir = ../../../../../..
 include $(top_builddir)/src/Makefile.global
diff -uNr postgresql-7.3.4/src/backend/utils/mb/conversion_procs/utf8_and_win1256/Makefile postgresql-7.3.4-new/src/backend/utils/mb/conversion_procs/utf8_and_win1256/Makefile
--- postgresql-7.3.4/src/backend/utils/mb/conversion_procs/utf8_and_win1256/Makefile	Wed Aug 21 17:33:55 2002
+++ postgresql-7.3.4-new/src/backend/utils/mb/conversion_procs/utf8_and_win1256/Makefile	Sat Sep  6 19:57:04 2003
@@ -3,6 +3,9 @@
 # $Id: Makefile,v 1.2 2002/08/21 21:33:55 momjian Exp $
 #
 #-------------------------------------------------------------------------
+
+DLTYPE = bundle
+
 subdir = src/backend/utils/mb/conversion_procs/utf8_and_win1256
 top_builddir = ../../../../../..
 include $(top_builddir)/src/Makefile.global
diff -uNr postgresql-7.3.4/src/backend/utils/mb/conversion_procs/utf8_and_win874/Makefile postgresql-7.3.4-new/src/backend/utils/mb/conversion_procs/utf8_and_win874/Makefile
--- postgresql-7.3.4/src/backend/utils/mb/conversion_procs/utf8_and_win874/Makefile	Wed Aug 21 17:33:55 2002
+++ postgresql-7.3.4-new/src/backend/utils/mb/conversion_procs/utf8_and_win874/Makefile	Sat Sep  6 19:57:04 2003
@@ -3,6 +3,9 @@
 # $Id: Makefile,v 1.2 2002/08/21 21:33:55 momjian Exp $
 #
 #-------------------------------------------------------------------------
+
+DLTYPE = bundle
+
 subdir = src/backend/utils/mb/conversion_procs/utf8_and_win874
 top_builddir = ../../../../../..
 include $(top_builddir)/src/Makefile.global
diff -uNr postgresql-7.3.4/src/backend/utils/misc/guc.c postgresql-7.3.4-new/src/backend/utils/misc/guc.c
--- postgresql-7.3.4/src/backend/utils/misc/guc.c	Thu Apr  3 19:32:57 2003
+++ postgresql-7.3.4-new/src/backend/utils/misc/guc.c	Sat Sep  6 19:57:05 2003
@@ -798,6 +798,13 @@
 		"$user,public", assign_search_path, NULL
 	},
 
+#ifdef HAVE_RENDEZVOUS
+	{
+		{"service_name", PGC_POSTMASTER}, &service_name,
+		NULL, NULL, NULL
+	},
+#endif
+
 	{
 		{"server_encoding", PGC_USERSET}, &server_encoding_string,
 		"SQL_ASCII", assign_server_encoding, show_server_encoding
@@ -838,12 +845,12 @@
 
 	{
 		{"unix_socket_group", PGC_POSTMASTER}, &Unix_socket_group,
-		"", NULL, NULL
+		"postgres", NULL, NULL
 	},
 
 	{
 		{"unix_socket_directory", PGC_POSTMASTER}, &UnixSocketDir,
-		"", NULL, NULL
+		"/tmp", NULL, NULL
 	},
 
 	{
diff -uNr postgresql-7.3.4/src/backend/utils/misc/postgresql.conf.sample postgresql-7.3.4-new/src/backend/utils/misc/postgresql.conf.sample
--- postgresql-7.3.4/src/backend/utils/misc/postgresql.conf.sample	Sun Mar 30 16:38:13 2003
+++ postgresql-7.3.4-new/src/backend/utils/misc/postgresql.conf.sample	Sat Sep  6 19:57:05 2003
@@ -27,10 +27,10 @@
 #
 #	Connection Parameters
 #
-#tcpip_socket = false
-#ssl = false
+tcpip_socket = true
+ssl = false
 
-#max_connections = 32
+max_connections = 96
 #superuser_reserved_connections = 2
 
 #port = 5432 
@@ -49,7 +49,7 @@
 #
 #	Shared Memory Size
 #
-#shared_buffers = 64		# min max_connections*2 or 16, 8KB each
+shared_buffers = 192		# min max_connections*2 or 16, 8KB each
 #max_fsm_relations = 1000	# min 10, fsm is free space map, ~40 bytes
 #max_fsm_pages = 10000		# min 1000, fsm is free space map, ~6 bytes
 #max_locks_per_transaction = 64	# min 10
diff -uNr postgresql-7.3.4/src/bin/initdb/initdb.sh postgresql-7.3.4-new/src/bin/initdb/initdb.sh
--- postgresql-7.3.4/src/bin/initdb/initdb.sh	Mon Nov 25 16:42:11 2002
+++ postgresql-7.3.4-new/src/bin/initdb/initdb.sh	Sat Sep  6 19:57:05 2003
@@ -1091,11 +1091,8 @@
 echo
 echo "Success. You can now start the database server using:"
 echo ""
-echo "    $PGPATH/postmaster -D $PGDATA"
-echo "or"
-# (Advertise -l option here, otherwise we have a background
-#  process writing to the terminal.)
-echo "    $PGPATH/pg_ctl -D $PGDATA -l logfile start"
-echo
+echo "    sudo -u root sudo -u postgres $PGPATH/pg_ctl \\"
+echo "        -D $PGDATA -l @PREFIX@/var/log/postgresql/logfile start"
+echo ""
 
 exit 0
diff -uNr postgresql-7.3.4/src/bin/pg_ctl/pg_ctl.sh postgresql-7.3.4-new/src/bin/pg_ctl/pg_ctl.sh
--- postgresql-7.3.4/src/bin/pg_ctl/pg_ctl.sh	Fri Oct 18 18:05:35 2002
+++ postgresql-7.3.4-new/src/bin/pg_ctl/pg_ctl.sh	Sat Sep  6 19:57:05 2003
@@ -14,6 +14,10 @@
 
 CMDNAME=`basename $0`
 
+ulimit -d 24000 >/dev/null 2>&1
+ulimit -n 512   >/dev/null 2>&1
+ulimit -s 4096  >/dev/null 2>&1
+
 help="\
 $CMDNAME is a utility to start, stop, restart, reload configuration files,
 or report the status of a PostgreSQL server.
diff -uNr postgresql-7.3.4/src/include/miscadmin.h postgresql-7.3.4-new/src/include/miscadmin.h
--- postgresql-7.3.4/src/include/miscadmin.h	Thu Oct  3 13:07:53 2002
+++ postgresql-7.3.4-new/src/include/miscadmin.h	Sat Sep  6 19:57:05 2003
@@ -182,6 +182,7 @@
 extern char *Unix_socket_group;
 extern char *UnixSocketDir;
 extern char *VirtualHost;
+extern char *service_name;
 
 
 /*****************************************************************************
diff -uNr postgresql-7.3.4/src/include/pg_config.h.in postgresql-7.3.4-new/src/include/pg_config.h.in
--- postgresql-7.3.4/src/include/pg_config.h.in	Fri Nov  8 00:23:09 2002
+++ postgresql-7.3.4-new/src/include/pg_config.h.in	Sat Sep  6 19:57:05 2003
@@ -57,6 +57,9 @@
 /* Define to build with PAM Support */
 #undef USE_PAM
 
+/* Define if pam_appl.h is in pam/ instead of security/ */
+#undef HAVE_PAM_PAM_APPL_H
+
 /* 
  * DEF_PGPORT is the TCP port number on which the Postmaster listens and
  * which clients will try to connect to.  This is just a default value;
diff -uNr postgresql-7.3.4/src/include/port/darwin.h postgresql-7.3.4-new/src/include/port/darwin.h
--- postgresql-7.3.4/src/include/port/darwin.h	Sun Oct 28 01:26:08 2001
+++ postgresql-7.3.4-new/src/include/port/darwin.h	Sat Sep  6 19:57:05 2003
@@ -1,5 +1,7 @@
 #define __darwin__	1
 
+#define HAVE_RENDEZVOUS
+
 #if defined(__ppc__)
 #define HAS_TEST_AND_SET
 #endif
diff -uNr postgresql-7.3.4/src/interfaces/libpgtcl/Makefile postgresql-7.3.4-new/src/interfaces/libpgtcl/Makefile
--- postgresql-7.3.4/src/interfaces/libpgtcl/Makefile	Tue Dec 10 23:08:05 2002
+++ postgresql-7.3.4-new/src/interfaces/libpgtcl/Makefile	Sat Sep  6 19:57:05 2003
@@ -20,7 +20,7 @@
 
 OBJS= pgtcl.o pgtclCmds.o pgtclId.o
 
-SHLIB_LINK = $(libpq)
+SHLIB_LINK = $(libpq) $(TCL_LIB_SPEC)
 
 # If crypt is a separate library, rather than part of libc, it may need
 # to be referenced separately to keep (broken) linkers happy.  (This is
diff -uNr postgresql-7.3.4/src/interfaces/python/GNUmakefile postgresql-7.3.4-new/src/interfaces/python/GNUmakefile
--- postgresql-7.3.4/src/interfaces/python/GNUmakefile	Thu Dec 13 13:39:04 2001
+++ postgresql-7.3.4-new/src/interfaces/python/GNUmakefile	Sat Sep  6 19:57:05 2003
@@ -1,5 +1,7 @@
 # $Header: /cvsroot/pgsql-server/src/interfaces/python/GNUmakefile,v 1.13 2001/12/13 18:39:04 petere Exp $
 
+DLTYPE = bundle
+
 subdir = src/interfaces/python
 top_builddir = ../../..
 include $(top_builddir)/src/Makefile.global
@@ -13,7 +15,9 @@
 override CPPFLAGS += -DUSE_DL_IMPORT
 SHLIB_LINK += $(python_libspec)
 endif
-
+ifeq ($(PORTNAME), darwin)
+SHLIB_LINK += -bundle_loader @PREFIX@/bin/python2.1
+endif
 
 include $(top_srcdir)/src/Makefile.shlib
 
diff -uNr postgresql-7.3.4/src/makefiles/Makefile.darwin postgresql-7.3.4-new/src/makefiles/Makefile.darwin
--- postgresql-7.3.4/src/makefiles/Makefile.darwin	Fri Oct  5 17:15:38 2001
+++ postgresql-7.3.4-new/src/makefiles/Makefile.darwin	Sat Sep  6 19:57:05 2003
@@ -1,13 +1,23 @@
 AROPT = cr
 AWK= awk
  
-DLSUFFIX = .so
+ifeq ($(DLTYPE), bundle)
+	DLSUFFIX := .so
+else
+	DLSUFFIX := .dylib
+endif
+
 CFLAGS_SL =
+CFLAGS += -fno-common
 ifeq (,$(filter $(host_os), darwin1.0 darwin1.1 darwin1.2))
-DARWIN_NAMESPACE_SPEC = -flat_namespace
+  MULTIPLY_DEFINED=
+else
+  MULTIPLY_DEFINED=-multiply_defined suppress
 endif
  
 %.so: %.o
-	$(CC) $(DARWIN_NAMESPACE_SPEC) -bundle -undefined suppress -o $@ $<
+	$(CC) -bundle $(MULTIPLY_DEFINED) -o $@ $<
+%.dylib: %.o
+	$(CC) -dynamiclib $(MULTIPLY_DEFINED) -o $@ $<
 
 sqlmansect = 7
diff -uNr postgresql-7.3.4/src/pl/plperl/GNUmakefile postgresql-7.3.4-new/src/pl/plperl/GNUmakefile
--- postgresql-7.3.4/src/pl/plperl/GNUmakefile	Tue May 28 12:57:53 2002
+++ postgresql-7.3.4-new/src/pl/plperl/GNUmakefile	Sat Sep  6 19:57:05 2003
@@ -20,10 +20,10 @@
 
 override CPPFLAGS := -I$(srcdir) -I$(perl_archlibexp)/CORE $(CPPFLAGS)
 
-
 NAME = plperl
 SO_MAJOR_VERSION = 0
 SO_MINOR_VERSION = 0
+DLTYPE = bundle
 
 OBJS = plperl.o eloglvl.o SPI.o
 SHLIB_LINK = $(perl_embed_ldflags) $(BE_DLLLIBS)
diff -uNr postgresql-7.3.4/src/pl/plpgsql/src/Makefile postgresql-7.3.4-new/src/pl/plpgsql/src/Makefile
--- postgresql-7.3.4/src/pl/plpgsql/src/Makefile	Fri Nov  1 17:52:34 2002
+++ postgresql-7.3.4-new/src/pl/plpgsql/src/Makefile	Sat Sep  6 19:57:05 2003
@@ -6,6 +6,8 @@
 #
 #-------------------------------------------------------------------------
 
+DLTYPE = bundle
+
 subdir = src/pl/plpgsql/src
 top_builddir = ../../../..
 include $(top_builddir)/src/Makefile.global
diff -uNr postgresql-7.3.4/src/pl/plpython/Makefile postgresql-7.3.4-new/src/pl/plpython/Makefile
--- postgresql-7.3.4/src/pl/plpython/Makefile	Thu Sep  5 14:28:46 2002
+++ postgresql-7.3.4-new/src/pl/plpython/Makefile	Sat Sep  6 19:57:05 2003
@@ -1,5 +1,7 @@
 # $Header: /cvsroot/pgsql-server/src/pl/plpython/Makefile,v 1.11 2002/09/05 18:28:46 petere Exp $
 
+DLTYPE = bundle
+
 subdir = src/pl/plpython
 top_builddir = ../../..
 include $(top_builddir)/src/Makefile.global
@@ -8,7 +10,7 @@
 # On some platforms we can only build PL/Python if libpython is a
 # shared library.  Since there is no official way to determine this,
 # we see if there is a file that is named like a shared library.
-ifneq (,$(wildcard $(python_configdir)/libpython*$(DLSUFFIX)*))
+ifneq (,$(wildcard $(python_configdir)/libpython*.a*))
 shared_libpython = yes
 endif
 
@@ -24,7 +26,7 @@
 SO_MINOR_VERSION = 0
 OBJS = plpython.o
 
-SHLIB_LINK = $(BE_DLLLIBS) $(python_libspec)
+SHLIB_LINK = $(BE_DLLLIBS) -bundle_loader @PREFIX@/bin/python2.1
 
 include $(top_srcdir)/src/Makefile.shlib
 
diff -uNr postgresql-7.3.4/src/pl/tcl/Makefile postgresql-7.3.4-new/src/pl/tcl/Makefile
--- postgresql-7.3.4/src/pl/tcl/Makefile	Fri May 24 14:10:17 2002
+++ postgresql-7.3.4-new/src/pl/tcl/Makefile	Sat Sep  6 19:57:05 2003
@@ -25,7 +25,6 @@
 endif
 endif
 
-
 # The following attempts to figure out what libraries need to be
 # linked with pltcl.  The information comes from the tclConfig.sh
 # file, but it's mostly bogus.  This just might work.
@@ -48,6 +47,7 @@
 NAME = pltcl
 SO_MAJOR_VERSION = 2
 SO_MINOR_VERSION = 0
+DLTYPE = bundle
 OBJS = pltcl.o
 
 include $(top_srcdir)/src/Makefile.shlib
diff -uNr postgresql-7.3.4/src/template/darwin postgresql-7.3.4-new/src/template/darwin
--- postgresql-7.3.4/src/template/darwin	Sat May  4 20:03:29 2002
+++ postgresql-7.3.4-new/src/template/darwin	Sat Sep  6 19:57:05 2003
@@ -1,6 +1,6 @@
 # -traditional-cpp means "don't use apple's cpp-precomp" on darwin
 # this should change to -no-cpp-precomp when that flag is implemented
-CC="$CC -traditional-cpp"
+CC="$CC -no-cpp-precomp"
 
 # Select appropriate semaphore support
 USE_NAMED_POSIX_SEMAPHORES=1
