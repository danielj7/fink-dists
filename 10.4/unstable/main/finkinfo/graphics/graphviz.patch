--- graphviz-2.18-orig/tclpkg/gv/Makefile.in	2008-03-10 20:32:43.000000000 +0100
+++ graphviz-2.18/tclpkg/gv/Makefile.in	2009-02-27 12:54:01.000000000 +0100
@@ -2087,6 +2087,8 @@
 $(LUA_data): gv_lua.cpp
 gv_lua.cpp: gv.i
 	$(SWIG) -c++ -lua -o gv_lua.cpp $(srcdir)/gv.i
+	mv $@ $@.orig
+	sed '/include/s/malloc\.h/cstdlib/' $@.orig > $@
 gv.ml gv.mli: gv_ocaml.cpp
 gv_ocaml.cpp: gv.i
 	$(SWIG) -c++ -ocaml -o gv_ocaml.cpp $(srcdir)/gv.i
@@ -2095,19 +2097,19 @@
 swig.ml:
 	$(SWIG) -ocaml -co swig.ml
 swig.cmi: swig.mli
-	ocamlc -c swig.mli
+	ocamlc.opt -verbose -annot -c $<
 swig.cmo: swig.ml swig.cmi
-	ocamlc -c swig.ml
+	ocamlc.opt -verbose -annot -c $<
 gv.cmi: gv.mli swig.cmi
-	ocamlc -c gv.mli
+	ocamlc.opt -verbose -annot -c $<
 gv.cmo: gv.ml gv.cmi
-	ocamlc -c gv.ml
+	ocamlc.opt -verbose -annot -c $<
 gv.cma: swig.cmo gv.cmo
-	ocamlc -a -dllib dllgv.so -custom -o gv.cma swig.cmo gv.cmo
+	ocamlc.opt -verbose -annot -a -dllib dllgv.so -custom -o $@ $<
 gv.cmx: gv.ml gv.cma
-	ocamlopt -c gv.ml
-gv.cmxa: gv.cma
-	ocamlopt -a -o gv.cmxa
+	ocamlopt.opt -verbose -annot -c $<
+gv.cmxa: gv.cmx
+	ocamlopt.opt -verbose -annot -a -o $@ $<
 gv.a:	gv.cmxa
 $(PERL_data): gv_perl.cpp
 gv_perl.cpp: gv.i
