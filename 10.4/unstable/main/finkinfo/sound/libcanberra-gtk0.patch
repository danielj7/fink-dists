diff -Nurd -x'*~' libcanberra-0.6.orig/src/Makefile.am libcanberra-0.6/src/Makefile.am
--- libcanberra-0.6.orig/src/Makefile.am	2008-07-29 18:17:36.000000000 -0400
+++ libcanberra-0.6/src/Makefile.am	2008-08-09 12:43:47.000000000 -0400
@@ -31,6 +31,10 @@
 EXTRA_DIST = \
 	map-file
 
+if HAVE_GTK
+lib_LTLIBRARIES =
+include_HEADERS =
+else
 lib_LTLIBRARIES = \
         libcanberra.la
 
@@ -192,6 +196,7 @@
 endif
 endif
 
+endif
 if HAVE_GTK
 
 lib_LTLIBRARIES += \
@@ -213,7 +218,7 @@
 	$(GTK_CFLAGS)
 libcanberra_gtk_la_LIBADD = \
 	$(GTK_LIBS) \
-	libcanberra.la
+	-lcanberra
 libcanberra_gtk_la_LDFLAGS = \
 	-export-dynamic -version-info $(LIBCANBERRA_GTK_VERSION_INFO)
 
@@ -223,7 +228,7 @@
 	$(GTK_CFLAGS)
 libcanberra_gtk_module_la_LIBADD = \
 	$(GTK_LIBS) \
-	libcanberra.la \
+	-lcanberra \
 	libcanberra-gtk.la
 libcanberra_gtk_module_la_LDFLAGS = \
 	-avoid-version -module -export-dynamic
@@ -232,7 +237,7 @@
 	canberra-gtk-play.c
 canberra_gtk_play_LDADD = \
 	$(GTK_LIBS) \
-	libcanberra.la \
+	-lcanberra \
 	libcanberra-gtk.la
 canberra_gtk_play_CFLAGS = \
 	$(GTK_CFLAGS)
@@ -260,8 +265,11 @@
 
 endif
 
+if HAVE_GTK
+else
 test_canberra_SOURCES = \
         test-canberra.c
 test_canberra_LDADD = \
         $(AM_LDADD) \
         libcanberra.la
+endif
diff -Nurd -x'*~' libcanberra-0.6.orig/src/canberra-gtk-module.c libcanberra-0.6/src/canberra-gtk-module.c
--- libcanberra-0.6.orig/src/canberra-gtk-module.c	2008-07-30 10:06:10.000000000 -0400
+++ libcanberra-0.6/src/canberra-gtk-module.c	2008-08-09 13:34:22.000000000 -0400
@@ -693,12 +693,12 @@
     return TRUE;
 }
 
-static void install_hook(GType type, const char *signal, guint *sn) {
+static void install_hook(GType type, const char *signal_, guint *sn) {
     GTypeClass *type_class;
 
     type_class = g_type_class_ref(type);
 
-    *sn = g_signal_lookup(signal, type);
+    *sn = g_signal_lookup(signal_, type);
     g_signal_add_emission_hook(*sn, 0, emission_hook_cb, NULL, NULL);
 
     g_type_class_unref(type_class);
