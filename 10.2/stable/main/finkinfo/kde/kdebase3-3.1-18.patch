diff -uNbr kate/app/Makefile.am kate/app/Makefile.am
--- kate/app/Makefile.am	Thu Dec  5 15:39:40 2002
+++ kate/app/Makefile.am	Thu Mar 13 22:51:58 2003
@@ -1,4 +1,4 @@
-lib_LTLIBRARIES = libkateinterfaces.la kate.la kwrite.la
+lib_LTLIBRARIES = libkateinterfaces.la kate.la kwrite.la libkwrite_main.la
 bin_PROGRAMS = kate kwrite
 
 libkateinterfaces_la_SOURCES = kateapp.cpp kateconfigdialog.cpp kateconfigplugindialogpage.cpp \
@@ -7,33 +7,34 @@
 	kateviewmanager.cpp kateviewspace.cpp \
 	kateIface.skel kategrepdialog.cpp katefiledialog.cpp katemailfilesdialog.cpp \
         kbookmarkhandler.cpp kactionselector.cpp katedockcontainer.cpp
+libkateinterfaces_la_LIBADD   = $(top_builddir)/kate/interfaces/libkateinterfacesprivate.la -lkscript $(top_builddir)/kate/lib/libkmultitabbar.la
+libkateinterfaces_la_LDFLAGS = $(all_libraries) $(KDE_RPATH) -avoid-version
 
-libkateinterfaces_la_LIBADD   = ../interfaces/libkateinterfacesprivate.la -lkscript ../lib/libkmultitabbar.la
-libkateinterfaces_la_LDFLAGS = $(all_libraries) $(KDE_RPATH) -module -avoid-version
-kate_la_SOURCES = katemain.cpp
+kate_la_SOURCES = kate_la_main.cpp
 kate_la_LIBADD = libkateinterfaces.la
-kate_la_LDFLAGS = $(all_libraries) $(KDE_RPATH) -module -avoid-version 
+kate_la_LDFLAGS = $(all_libraries) $(KDE_RPATH) -avoid-version -module
 
-kwrite_la_SOURCES = kwritemain.cpp katefiledialog.cpp kwritedialogs.cpp
-kwrite_la_LIBADD   = -lktexteditor
-kwrite_la_LDFLAGS = $(all_libraries) $(KDE_RPATH) -module -avoid-version
+kate_la_main.cpp: katemain.cpp
+	cat katemain.cpp > kate_la_main.cpp
 
-kate_SOURCES = dummy_kate.cpp
-kate_LDADD = kate.la
-kate_LDFLAGS = $(KDE_RPATH) $(all_libraries)
+libkwrite_main_la_SOURCES = kwritemain.cpp katefiledialog.cpp kwritedialogs.cpp
+libkwrite_main_la_LIBADD  = -lktexteditor $(LIB_QT) -lkdecore -lDCOP -lkdeui -lkio -lkparts
+libkwrite_main_la_LDFLAGS = $(all_libraries) $(KDE_RPATH) -avoid-version
 
-kwrite_SOURCES = dummy_kwrite.cpp
-kwrite_LDADD = kwrite.la
-kwrite_LDFLAGS = $(KDE_RPATH) $(all_libraries)
+kwrite_la_SOURCES = kwrite_la_main.cpp
+kwrite_la_LIBADD  = libkwrite_main.la
+kwrite_la_LDFLAGS = $(KDE_RPATH) $(all_libraries) -avoid-version -module
 
-dummy_kate_la.cpp:
-	echo > dummy_kate_la.cpp
+kwrite_la_main.cpp: kwrite_main.cpp
+	cat kwrite_main.cpp > kwrite_la_main.cpp
 
-dummy_kate.cpp:
-	echo > dummy_kate.cpp
+kate_SOURCES = katemain.cpp
+kate_LDADD = libkateinterfaces.la
+kate_LDFLAGS = $(KDE_RPATH) $(all_libraries)
 
-dummy_kwrite.cpp:
-	echo > dummy_kwrite.cpp
+kwrite_SOURCES = kwrite_main.cpp
+kwrite_LDADD = libkwrite_main.la
+kwrite_LDFLAGS = $(KDE_RPATH) $(all_libraries)
                          
 METASOURCES = AUTO  
   
diff -uNbr kate/app/kwrite_main.cpp kate/app/kwrite_main.cpp
--- kate/app/kwrite_main.cpp	Wed Dec 31 19:00:00 1969
+++ kate/app/kwrite_main.cpp	Thu Mar 13 22:51:58 2003
@@ -0,0 +1,27 @@
+/*
+ *
+ * Copyright (c) 2001 Nick Hudson <skrll@netbsd.org>
+ *
+ * Permission is hereby granted, free of charge, to any person obtaining a copy
+ * of this software and associated documentation files (the "Software"), to deal
+ * in the Software without restriction, including without limitation the rights
+ * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
+ * copies of the Software, and to permit persons to whom the Software is
+ * furnished to do so, subject to the following conditions:
+ *
+ * The above copyright notice and this permission notice shall be included in
+ * all copies or substantial portions of the Software.
+ *
+ * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
+ * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
+ * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.  IN NO EVENT SHALL THE
+ * AUTHORS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN
+ * AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN
+ * CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
+ */
+extern "C" int kdemain(int, char* []);
+
+int main( int argc, char* argv[] )
+{
+        return kdemain(argc, argv);
+}
diff -uNbr kate/app/kwritemain.cpp kate/app/kwritemain.cpp
--- kate/app/kwritemain.cpp	Thu Dec  5 15:39:41 2002
+++ kate/app/kwritemain.cpp	Thu Mar 13 22:51:58 2003
@@ -538,7 +538,9 @@
   { 0, 0, 0}
 };
 
-int main(int argc, char **argv)
+extern "C" int kdemain(int, char**);
+
+int kdemain(int argc, char **argv)
 {
   KLocale::setMainCatalogue("kate");         //lukas: set this to have the kwritepart translated using kate message catalog
 
diff -uNbr kate/lib/Makefile.am kate/lib/Makefile.am
--- kate/lib/Makefile.am	Thu Dec  5 15:39:45 2002
+++ kate/lib/Makefile.am	Thu Mar 13 22:51:58 2003
@@ -5,7 +5,7 @@
 lib_LTLIBRARIES = libkmultitabbar.la 
 
 libkmultitabbar_la_SOURCES=kmultitabbar.cpp
-libkmultitabbar_la_LDFLAGS = $(all_libraries) -no-undefined
+libkmultitabbar_la_LDFLAGS = $(all_libraries) -no-undefined -avoid-version
 libkmultitabbar_la_LIBADD = $(LIB_KPARTS)
 
 METASOURCES = AUTO
diff -uNbr kcheckpass/checkpass_pam.c kcheckpass/checkpass_pam.c
--- kcheckpass/checkpass_pam.c	Sat Jul 14 13:59:18 2001
+++ kcheckpass/checkpass_pam.c	Thu Mar 13 22:51:58 2003
@@ -26,7 +26,12 @@
  *****************************************************************/
 #include <stdlib.h>
 #include <string.h>
+
+#ifdef HAVE_PAM_PAM_APPL_H
+#include <pam/pam_appl.h>
+#else
 #include <security/pam_appl.h>
+#endif
 
 static const char *PAM_username;
 static const char *PAM_password;
diff -uNbr kcontrol/access/Makefile.am kcontrol/access/Makefile.am
--- kcontrol/access/Makefile.am	Mon Sep 16 20:10:59 2002
+++ kcontrol/access/Makefile.am	Thu Mar 13 22:51:58 2003
@@ -4,16 +4,23 @@
 
 bin_PROGRAMS = kaccess
 
-kaccess_SOURCES = dummy.cpp
+kaccess_SOURCES = main.cpp
 kaccess_LDFLAGS = $(all_libraries) $(KDE_RPATH)
-kaccess_LDADD = kaccess.la
+kaccess_LDADD = libkaccess_main.la
 
 kde_module_LTLIBRARIES = kcm_access.la
-lib_LTLIBRARIES = kaccess.la
+lib_LTLIBRARIES = kaccess.la libkaccess_main.la
 
-kaccess_la_SOURCES = kaccess.cpp main.cpp
-kaccess_la_LDFLAGS = $(all_libraries) -module -avoid-version
-kaccess_la_LIBADD = $(LIB_KDEUI)
+libkaccess_main_la_SOURCES = kaccess.cpp
+libkaccess_main_la_LDFLAGS = $(all_libraries) -avoid-version
+libkaccess_main_la_LIBADD  = $(LIB_KDEUI) $(LIB_QT) -lkdecore -lDCOP
+
+kaccess_la_SOURCES = kaccess_la_main.cpp
+kaccess_la_LDFLAGS = $(all_libraries) -avoid-version -module
+kaccess_la_LIBADD = libkaccess_main.la
+
+kaccess_la_main.cpp: main.cpp
+	cat main.cpp > kaccess_la_main.cpp
 
 kcm_access_la_SOURCES = kcmaccess.cpp 
 kcm_access_la_LDFLAGS  = $(all_libraries) -module -avoid-version -no-undefined
@@ -32,6 +39,3 @@
 messages:
 	$(XGETTEXT) $(kaccess_la_SOURCES) -o $(podir)/kaccess.pot
 	$(XGETTEXT) $(kcm_access_la_SOURCES) -o $(podir)/kcmaccess.pot
-
-dummy.cpp:
-	echo > dummy.cpp
diff -uNbr kcontrol/info/Makefile.am kcontrol/info/Makefile.am
--- kcontrol/info/Makefile.am	Thu Mar  7 20:16:40 2002
+++ kcontrol/info/Makefile.am	Thu Mar 13 22:51:58 2003
@@ -2,7 +2,7 @@
 
 kcm_info_la_SOURCES = main.cpp memory.cpp
 
-kcm_info_la_LDFLAGS = $(all_libraries) -module -avoid-version -no-undefined
+kcm_info_la_LDFLAGS = $(all_libraries) -module -avoid-version -no-undefined $(FRAMEWORK_COREAUDIO)
 kcm_info_la_LIBADD = $(LIBALIB) $(LIB_KDEUI) $(LIB_TRU64_MACH) $(LIBCFG) $(LIBODM) $(LIBKSTAT) $(LIBDEVINFO)
 
 INCLUDES= $(all_includes)
diff -uNbr kcontrol/info/info.cpp kcontrol/info/info.cpp
--- kcontrol/info/info.cpp	Mon Jan 13 18:38:12 2003
+++ kcontrol/info/info.cpp	Thu Mar 13 22:51:58 2003
@@ -472,6 +472,8 @@
 #include "info_svr4.cpp"
 #elif _AIX
 #include "info_aix.cpp"
+#elif defined(__APPLE__)
+#include "info_osx.cpp"
 #else
 #include "info_generic.cpp"	/* Default for unsupportet systems.... */
 #endif
diff -uNbr kcontrol/info/info_osx.cpp kcontrol/info/info_osx.cpp
--- kcontrol/info/info_osx.cpp	Wed Dec 31 19:00:00 1969
+++ kcontrol/info/info_osx.cpp	Thu Mar 13 22:51:58 2003
@@ -0,0 +1,163 @@
+/*
+ * kdebase3-3.0.1-3.patch,v 1.2 2002/06/24 01:48:12 ranger Exp
+ *
+ * info_fbsd.cpp is part of the KDE program kcminfo.  This displays
+ * various information about the system (hopefully a FreeBSD system)
+ * it's running on.
+ */
+
+#define INFO_CPU_AVAILABLE
+//#define INFO_IRQ_AVAILABLE
+//#define INFO_DMA_AVAILABLE
+//#define INFO_PCI_AVAILABLE
+//#define INFO_IOPORTS_AVAILABLE
+#define INFO_SOUND_AVAILABLE
+#define INFO_DEVICES_AVAILABLE
+#define INFO_SCSI_AVAILABLE
+#define INFO_PARTITIONS_AVAILABLE
+#define INFO_XSERVER_AVAILABLE
+
+/*
+ * all following functions should return TRUE, when the Information
+ * was filled into the lBox-Widget. Returning FALSE indicates that
+ * information was not available.
+ */
+
+#include <sys/types.h>
+#include <sys/sysctl.h>
+
+#include <fstab.h>
+#include <stdio.h>
+#include <stdlib.h>
+
+#include <iostream.h>
+
+#include <qdict.h>
+#include <qfile.h>
+#include <qfontmetrics.h>
+#include <qptrlist.h>
+#include <qstring.h>
+#include <qtextstream.h>
+
+#include <kdebug.h>
+
+#include <mach/mach.h>
+#include <mach-o/arch.h>
+
+#ifdef HAVE_COREAUDIO
+#include <CoreAudio/CoreAudio.h>
+#endif
+
+#include <machine/limits.h>
+
+bool GetInfo_CPU (QListView *lBox)
+{
+
+	QString cpustring;
+
+        kern_return_t ret;
+        struct host_basic_info basic_info;
+        unsigned int count=HOST_BASIC_INFO_COUNT;
+
+        ret=host_info(mach_host_self(), HOST_BASIC_INFO, 
+                (host_info_t)&basic_info, &count);
+        if (ret != KERN_SUCCESS) {
+		kdDebug() << "unable to get host information from mach" << endl;
+		return false;
+        } else {
+		kdDebug() << "got Host Info: (" << basic_info.avail_cpus << ") CPUs available" << endl;
+        	const NXArchInfo *archinfo;
+        	archinfo=NXGetArchInfoFromCpuType(basic_info.cpu_type, basic_info.cpu_subtype);
+		new QListViewItem(lBox, i18n("Kernel is configured for %1 CPUs").arg(basic_info.max_cpus));
+		for (int i = 1; i <= basic_info.avail_cpus; i++) {
+			cpustring = i18n("CPU %1: %2").arg(i).arg(archinfo->description);
+			new QListViewItem(lBox, cpustring);
+		}
+		return true;
+	}
+	return false;
+}
+
+bool GetInfo_IRQ (QListView *)
+{
+	return false;
+}
+
+bool GetInfo_DMA (QListView *)
+{
+	return false;
+}
+
+bool GetInfo_PCI (QListView *)
+{
+	return false;
+}
+
+bool GetInfo_IO_Ports (QListView *)
+{
+	return false;
+}
+
+bool GetInfo_Sound (QListView *lBox)
+{
+#ifdef HAVE_COREAUDIO
+#define kMaxStringSize 1024
+	OSStatus status;
+	AudioDeviceID gOutputDeviceID;
+	unsigned long propertySize;
+	char deviceName[kMaxStringSize];
+	char manufacturer[kMaxStringSize];
+	propertySize = sizeof(gOutputDeviceID);
+	status = AudioHardwareGetProperty(kAudioHardwarePropertyDefaultOutputDevice, &propertySize, &gOutputDeviceID);
+	if (status) {
+		kdDebug() << "get default output device failed, status = " << (int)status << endl;
+		return false;
+	}
+
+	if (gOutputDeviceID != kAudioDeviceUnknown) {
+
+		propertySize = kMaxStringSize;
+
+		/* Device Name */
+		status = AudioDeviceGetProperty(gOutputDeviceID, 1, 0, kAudioDevicePropertyDeviceName, &propertySize, deviceName);
+		if (status) {
+			kdDebug() << "get device name failed, status = " << (int)status << endl;
+			return false;
+		}
+		new QListViewItem(lBox, i18n("Device Name: %1").arg(deviceName));
+
+		/* Manufacturer */
+		status = AudioDeviceGetProperty(gOutputDeviceID, 1, 0, kAudioDevicePropertyDeviceManufacturer, &propertySize, manufacturer);
+		if (status) {
+			kdDebug() << "get manufacturer failed, status = " << (int)status << endl;
+			return false;
+		}
+		new QListViewItem(lBox, i18n("Manufacturer: %1").arg(manufacturer));
+		return true;
+	} else {
+		return false;
+	}
+#else
+	return false;
+#endif
+}
+
+bool GetInfo_SCSI (QListView *lbox)
+{
+	return false;
+}
+
+bool GetInfo_Partitions (QListView *lbox)
+{
+	return false;
+}
+
+bool GetInfo_XServer_and_Video (QListView *lBox)
+{
+	return GetInfo_XServer_Generic( lBox );
+}
+
+bool GetInfo_Devices (QListView *lbox)
+{
+	return false;
+}
diff -uNbr kcontrol/info/memory.cpp kcontrol/info/memory.cpp
--- kcontrol/info/memory.cpp	Sat Sep 21 12:54:57 2002
+++ kcontrol/info/memory.cpp	Thu Mar 13 22:51:58 2003
@@ -431,6 +431,8 @@
 
 #ifdef __linux__
 #include "memory_linux.cpp"
+#elif defined(__APPLE__)
+#include "memory_osx.cpp"
 #elif sgi
 #include "memory_sgi.cpp"
 #elif defined(__svr4__) && defined(sun)
diff -uNbr kcontrol/info/memory_osx.cpp kcontrol/info/memory_osx.cpp
--- kcontrol/info/memory_osx.cpp	Wed Dec 31 19:00:00 1969
+++ kcontrol/info/memory_osx.cpp	Thu Mar 13 22:51:58 2003
@@ -0,0 +1,72 @@
+#include <unistd.h>
+#include <stdlib.h>
+#include <qfile.h>
+#include <mach/mach_init.h>
+#include <mach/mach_host.h>
+#include <mach/host_info.h>
+#include <sys/stat.h>
+#include <dirent.h>
+#include <kdebug.h>
+
+void KMemoryWidget::update()
+{
+
+	vm_statistics_data_t vm_info;
+	mach_msg_type_number_t info_count;
+	DIR *dirp;
+	struct dirent *dp;
+	off_t total;
+
+	info_count = HOST_VM_INFO_COUNT;
+	if (host_statistics(mach_host_self (), HOST_VM_INFO, (host_info_t)&vm_info, &info_count)) {
+		kdDebug() << "could not get memory statistics" << endl;
+		return;
+	}
+
+	Memory_Info[TOTAL_MEM]    = (vm_info.active_count + vm_info.inactive_count +
+		vm_info.free_count + vm_info.wire_count) * vm_page_size;
+	Memory_Info[FREE_MEM]     = vm_info.free_count * vm_page_size;
+	Memory_Info[SHARED_MEM]   = NO_MEMORY_INFO;
+	Memory_Info[BUFFER_MEM]   = NO_MEMORY_INFO;
+	Memory_Info[CACHED_MEM]   = NO_MEMORY_INFO;
+
+	dirp = opendir("/private/var/vm");
+	if (!dirp) {
+		kdDebug() << "unable to open /private/var/vm" << endl;
+		return;
+	}
+
+	total = 0;
+
+	while ((dp = readdir (dirp)) != NULL) {
+		struct stat sb;
+		char fname [MAXNAMLEN];
+
+		if (strncmp (dp->d_name, "swapfile", 8))
+			continue;
+
+		strcpy (fname, "/private/var/vm/");
+		strcat (fname, dp->d_name);
+		if (stat (fname, &sb) < 0)
+			continue;
+
+		total += sb.st_size;
+	}
+	closedir (dirp);
+
+	info_count = HOST_VM_INFO_COUNT;
+	if (host_statistics (mach_host_self (), HOST_VM_INFO,
+		(host_info_t) &vm_info, &info_count)) {
+			kdDebug() << "unable to get VM info" << endl;
+	}
+
+	Memory_Info[SWAP_MEM]     = total;
+	// off_t used = (vm_info.pageouts - vm_info.pageins) * vm_page_size;
+	Memory_Info[FREESWAP_MEM] = NO_MEMORY_INFO;
+
+	/* free = vm_info.free_count * vm_page_size;
+	   used = vm_info.active_count * vm_page_size;
+	   total = (vm_info.active_count + vm_info.inactive_count +
+		vm_info.free_count + vm_info.wire_count) * vm_page_size; */
+
+}
diff -uNbr kcontrol/kcontrol/Makefile.am kcontrol/kcontrol/Makefile.am
--- kcontrol/kcontrol/Makefile.am	Thu Jan  2 23:41:16 2003
+++ kcontrol/kcontrol/Makefile.am	Thu Mar 13 22:51:58 2003
@@ -22,43 +22,69 @@
 
 SUBDIRS = . pics
 
-CLEANFILES = dummy.cpp
-
 bin_PROGRAMS = kcontrol kcmshell kcminit
-lib_LTLIBRARIES = kcontrol.la kcmshell.la kcminit.la
+lib_LTLIBRARIES = libkcontrol_main.la kcontrol.la libkcmshell_main.la kcmshell.la libkcminit_main.la kcminit.la
 
-kcontrol_la_SOURCES = main.cpp toplevel.cpp indexwidget.cpp searchwidget.cpp \
+libkcontrol_main_la_SOURCES = main.cpp toplevel.cpp indexwidget.cpp searchwidget.cpp \
 	helpwidget.cpp moduleinfo.cpp modules.cpp proxywidget.cpp \
 	modloader.cpp dockcontainer.cpp aboutwidget.cpp global.cpp \
 	quickhelp.cpp moduletreeview.cpp moduleiconview.cpp \
 	kecdialog.cpp kcrootonly.cpp moduleIface.cpp moduleIface.skel
+libkcontrol_main_la_LIBADD  = $(LIB_KDEUI) $(LIB_KSYCOCA) $(LIB_QT) -lkdecore -lDCOP -lkdefx
+libkcontrol_main_la_LDFLAGS = $(all_libraries) -avoid-version
+
+kcontrol_la_SOURCES = kcontrol_la_main.cpp
+kcontrol_la_LIBADD  = libkcontrol_main.la
+kcontrol_la_LDFLAGS = $(all_libraries) -avoid-version -module
 
-kcontrol_la_LIBADD  = $(LIB_KDEUI) $(LIB_KSYCOCA)
-kcontrol_la_LDFLAGS = $(all_libraries) -module -avoid-version
+kcontrol_la_main.cpp: stub_main.cpp
+	cat stub_main.cpp > kcontrol_la_main.cpp
 
-kcmshell_la_SOURCES = kcmshell.cpp moduleinfo.cpp modloader.cpp kecdialog.cpp \
+libkcmshell_main_la_SOURCES = kcmshell.cpp moduleinfo.cpp modloader.cpp kecdialog.cpp \
 			proxywidget.cpp kcdialog.cpp global.cpp \
 			kcdialog.skel
-kcmshell_la_LIBADD = $(LIB_KDEUI) $(LIB_KSYCOCA)
-kcmshell_la_LDFLAGS = $(all_libraries) -module -avoid-version
+libkcmshell_main_la_LIBADD = $(LIB_KDEUI) $(LIB_KSYCOCA) $(LIB_QT) -lkdecore -lDCOP
+libkcmshell_main_la_LDFLAGS = $(all_libraries) -avoid-version
+
+kcmshell_la_SOURCES = kcmshell_la_main.cpp
+kcmshell_la_LIBADD = libkcmshell_main.la
+kcmshell_la_LDFLAGS = $(all_libraries) -avoid-version -module
+
+kcmshell_la_main.cpp: stub_main.cpp
+	cat stub_main.cpp > kcmshell_la_main.cpp
+
+libkcminit_main_la_SOURCES = kcminit.cpp global.cpp
+libkcminit_main_la_LIBADD  = $(LIB_KDEUI) $(LIB_KSYCOCA) $(LIB_QT) -lkdecore -lDCOP
+libkcminit_main_la_LDFLAGS = $(all_libraries) -avoid-version
 
+kcminit_la_SOURCES = kcminit_la_main.cpp
+kcminit_la_LIBADD  = libkcminit_main.la
+kcminit_la_LDFLAGS = $(all_libraries) -avoid-version -module
 
-kcminit_la_SOURCES = kcminit.cpp global.cpp
-kcminit_la_LIBADD   = $(LIB_KDEUI) $(LIB_KSYCOCA)
-kcminit_la_LDFLAGS = $(all_libraries) -module -avoid-version
+kcminit_la_main.cpp: stub_main.cpp
+	cat stub_main.cpp > kcminit_la_main.cpp
 
-kcontrol_SOURCES = dummy.cpp
-kcontrol_LDADD = kcontrol.la
+kcontrol_SOURCES = kcontrol_main.cpp
+kcontrol_LDADD = libkcontrol_main.la
 kcontrol_LDFLAGS = $(all_libraries) $(KDE_RPATH) -export-dynamic
 
-kcmshell_SOURCES = dummy.cpp
-kcmshell_LDADD = kcmshell.la
+kcontrol_main.cpp: stub_main.cpp
+	cat stub_main.cpp > kcontrol_main.cpp
+
+kcmshell_SOURCES = kcmshell_main.cpp
+kcmshell_LDADD = libkcmshell_main.la
 kcmshell_LDFLAGS = $(all_libraries) $(KDE_RPATH) -export-dynamic
 
-kcminit_SOURCES = dummy.cpp
-kcminit_LDADD = kcminit.la
+kcmshell_main.cpp: stub_main.cpp
+	cat stub_main.cpp > kcmshell_main.cpp
+
+kcminit_SOURCES = kcminit_main.cpp
+kcminit_LDADD = libkcminit_main.la
 kcminit_LDFLAGS = $(all_libraries) $(KDE_RPATH) -export-dynamic
 
+kcminit_main.cpp: stub_main.cpp
+	cat stub_main.cpp > kcminit_main.cpp
+
 rccontroldir = $(kde_datadir)/kcontrol
 rccontrol_DATA = kcontrolui.rc
 rcinfodir = $(kde_datadir)/kinfocenter
@@ -81,6 +107,3 @@
 
 messages: rc.cpp
 	$(XGETTEXT) *.cpp -o $(podir)/kcontrol.pot
-
-dummy.cpp:
-	echo > dummy.cpp
diff -uNbr kcontrol/kcontrol/kcminit.cpp kcontrol/kcontrol/kcminit.cpp
--- kcontrol/kcontrol/kcminit.cpp	Thu Mar  7 20:16:40 2002
+++ kcontrol/kcontrol/kcminit.cpp	Thu Mar 13 22:51:58 2003
@@ -59,7 +59,9 @@
     return false;
 }
 
-int main(int argc, char *argv[])
+extern "C" int kdemain(int, char**);
+
+int kdemain(int argc, char *argv[])
 {
   KLocale::setMainCatalogue("kcontrol");
   KAboutData aboutData( "kcminit", I18N_NOOP("KCMInit"),
diff -uNbr kcontrol/kcontrol/kcmshell.cpp kcontrol/kcontrol/kcmshell.cpp
--- kcontrol/kcontrol/kcmshell.cpp	Sun Sep 15 17:08:39 2002
+++ kcontrol/kcontrol/kcmshell.cpp	Thu Mar 13 22:51:58 2003
@@ -129,8 +129,9 @@
         quit();
 }
 
+extern "C" int kdemain(int, char**);
 
-int main(int _argc, char *_argv[])
+int kdemain(int _argc, char *_argv[])
 {
     KAboutData aboutData( "kcmshell", I18N_NOOP("KDE Control Module"),
                           KCONTROL_VERSION,
diff -uNbr kcontrol/kcontrol/main.cpp kcontrol/kcontrol/main.cpp
--- kcontrol/kcontrol/main.cpp	Sat Sep 21 12:54:58 2002
+++ kcontrol/kcontrol/main.cpp	Thu Mar 13 22:51:58 2003
@@ -86,7 +86,9 @@
   delete toplevel;
 }
 
-int main(int argc, char *argv[])
+extern "C" int kdemain(int, char**);
+
+int kdemain(int argc, char **argv)
 {
   KLocale::setMainCatalogue("kcontrol");
   KAboutData aboutKControl( "kcontrol", I18N_NOOP("KDE Control Center"),
diff -uNbr kcontrol/kcontrol/stub_main.cpp kcontrol/kcontrol/stub_main.cpp
--- kcontrol/kcontrol/stub_main.cpp	Wed Dec 31 19:00:00 1969
+++ kcontrol/kcontrol/stub_main.cpp	Thu Mar 13 22:51:58 2003
@@ -0,0 +1,28 @@
+/*
+ *
+ * Copyright (c) 2001 Nick Hudson <skrll@netbsd.org>
+ *
+ * Permission is hereby granted, free of charge, to any person obtaining a copy
+ * of this software and associated documentation files (the "Software"), to deal
+ * in the Software without restriction, including without limitation the rights
+ * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
+ * copies of the Software, and to permit persons to whom the Software is
+ * furnished to do so, subject to the following conditions:
+ *
+ * The above copyright notice and this permission notice shall be included in
+ * all copies or substantial portions of the Software.
+ *
+ * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
+ * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
+ * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.  IN NO EVENT SHALL THE
+ * AUTHORS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN
+ * AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN
+ * CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
+ */
+extern "C" int kdemain(int, char* []);
+
+int main( int argc, char* argv[] )
+{
+        return kdemain(argc, argv);
+}
+
diff -uNbr kcontrol/kfontinst/kfontinst/FontEngine.cpp kcontrol/kfontinst/kfontinst/FontEngine.cpp
--- kcontrol/kfontinst/kfontinst/FontEngine.cpp	Thu Dec  5 19:16:52 2002
+++ kcontrol/kfontinst/kfontinst/FontEngine.cpp	Thu Mar 13 22:51:58 2003
@@ -26,6 +26,8 @@
 // (C) Craig Drummond, 2001
 ////////////////////////////////////////////////////////////////////////////////
 
+#include "config.h"
+
 #include "FontEngine.h"
 #if !defined KFI_THUMBNAIL && !defined KFI_METAINFO
 #include "KfiGlobal.h"
diff -uNbr kdeprint/kjobviewer/Makefile.am kdeprint/kjobviewer/Makefile.am
--- kdeprint/kjobviewer/Makefile.am	Sun Jul  8 05:31:24 2001
+++ kdeprint/kjobviewer/Makefile.am	Thu Mar 13 22:51:58 2003
@@ -4,13 +4,13 @@
 lib_LTLIBRARIES = kjobviewer.la
 
 kjobviewer_SOURCES = dummy.cpp
-kjobviewer_LDADD = kjobviewer.la
+kjobviewer_LDADD = -lkdeprint_management $(LIB_KDEUI) $(LIB_QT) -lkdecore -lDCOP -lkdeprint
 kjobviewer_LDFLAGS = $(KDE_RPATH) $(all_libraries)
 
 kjobviewer_la_SOURCES = kjobviewer.cpp main.cpp
 kjobviewer_la_METASOURCES = AUTO
-kjobviewer_la_LIBADD = -lkdeprint_management $(LIB_KDEUI)
-kjobviewer_la_LDFLAGS = -module -avoid-version $(all_libraries) $(KDE_RPATH)
+kjobviewer_la_LIBADD = -lkdeprint_management $(LIB_KDEUI) $(LIB_QT) -lkdecore -lDCOP -lkdeprint
+kjobviewer_la_LDFLAGS = -avoid-version $(all_libraries) $(KDE_RPATH) -module
 
 noinst_HEADERS = kjobviewer.h
 
@@ -22,8 +22,8 @@
 desktop_DATA = kjobviewer.desktop
 desktopdir = $(kde_appsdir)/Utilities
 
-dummy.cpp:
-	echo > dummy.cpp
+dummy.cpp: main.cpp
+	cat main.cpp > dummy.cpp
 
 messages: rc.cpp
 	$(XGETTEXT) *.cpp -o $(podir)/kjobviewer.pot
diff -uNbr kdeprint/kprinter/Makefile.am kdeprint/kprinter/Makefile.am
--- kdeprint/kprinter/Makefile.am	Mon Jul  1 14:53:55 2002
+++ kdeprint/kprinter/Makefile.am	Thu Mar 13 22:51:58 2003
@@ -4,12 +4,12 @@
 lib_LTLIBRARIES = kprinter.la
 
 kprinter_SOURCES = dummy.cpp
-kprinter_LDADD = kprinter.la
+kprinter_LDADD = -lkdeprint $(LIB_QT) -lkdecore -lDCOP -lkdeui -lkio
 kprinter_LDFLAGS = $(KDE_RPATH) $(all_libraries)
 
 kprinter_la_SOURCES = main.cpp printwrapper.cpp
-kprinter_la_LIBADD = -lkdeprint
-kprinter_la_LDFLAGS = -module -avoid-version $(all_libraries) $(KDE_RPATH)
+kprinter_la_LIBADD = -lkdeprint $(LIB_QT) -lkdecore -lDCOP -lkdeui -lkio
+kprinter_la_LDFLAGS = -avoid-version $(all_libraries) $(KDE_RPATH) -module
 kprinter_METASOURCES = AUTO
 
 noinst_HEADERS = printwrapper.h
@@ -17,5 +17,5 @@
 messages:
 	$(XGETTEXT) *.cpp -o $(podir)/kprinter.pot
 
-dummy.cpp:
-	echo > dummy.cpp
+dummy.cpp: main.cpp
+	cat main.cpp > dummy.cpp
diff -uNbr kdesktop/Makefile.am kdesktop/Makefile.am
--- kdesktop/Makefile.am	Sun Sep 15 17:08:45 2002
+++ kdesktop/Makefile.am	Thu Mar 13 22:51:58 2003
@@ -1,10 +1,6 @@
 ## Makefile.am of kdebase/kdesktop
 
 INCLUDES = -I$(top_srcdir)/kcontrol/background -I$(top_srcdir)/libkonq $(all_includes)
-kdesktop_la_LDFLAGS  = $(KDE_RPATH) $(all_libraries) -module -avoid-version
-kdesktop_la_LIBADD   = $(top_builddir)/libkonq/libkonq.la $(top_builddir)/kcontrol/background/libbgnd.la 
-kdesktop_LDFLAGS  = $(all_libraries) $(KDE_RPATH)
-kdesktop_LDADD    = kdesktop.la
 
 SUBDIRS = . lock pics patterns programs init kwebdesktop
 
@@ -12,15 +8,29 @@
 
 bin_PROGRAMS = kdesktop
 bin_SCRIPTS = kdeeject
-lib_LTLIBRARIES = kdesktop.la
+lib_LTLIBRARIES = kdesktop.la libkdesktop_main.la
 
-kdesktop_la_SOURCES = main.cc krootwm.cc xautolock.cc kdiconview.cc desktop.cc \
+libkdesktop_main_la_LDFLAGS  = $(KDE_RPATH) $(all_libraries) -avoid-version
+libkdesktop_main_la_LIBADD   = $(top_builddir)/libkonq/libkonq.la $(top_builddir)/kcontrol/background/libbgnd.la 
+libkdesktop_main_la_SOURCES = main.cc krootwm.cc xautolock.cc kdiconview.cc desktop.cc \
 	lockeng.cc KDesktopIface.skel \
 	bgmanager.cc init.cc KScreensaverIface.skel \
 	minicli.cpp KBackgroundIface.skel pixmapserver.cc kcustommenu.cc \
 	startupid.cpp
 
-kdesktop_SOURCES = dummy.cc
+kdesktop_la_LDFLAGS = $(KDE_RPATH) $(all_libraries) -avoid-version -module
+kdesktop_la_LIBADD  = libkdesktop_main.la
+kdesktop_la_SOURCES = kdesktop_la_main.cpp
+
+kdesktop_la_main.cpp: stub_main.cpp
+	cat stub_main.cpp > kdesktop_la_main.cpp
+
+kdesktop_LDFLAGS  = $(all_libraries) $(KDE_RPATH)
+kdesktop_LDADD    = libkdesktop_main.la
+kdesktop_SOURCES  = kdesktop_main.cpp
+
+kdesktop_main.cpp: stub_main.cpp
+	cat stub_main.cpp > kdesktop_main.cpp
 
 include_HEADERS = KDesktopIface.h KScreensaverIface.h KBackgroundIface.h
 
diff -uNbr kdesktop/main.cc kdesktop/main.cc
--- kdesktop/main.cc	Sat Nov 30 12:57:57 2002
+++ kdesktop/main.cc	Thu Mar 13 22:51:58 2003
@@ -77,7 +77,9 @@
         kapp->quit(); // turn catchable signals into clean shutdown
 }
 
-int main( int argc, char **argv )
+extern "C" int kdemain(int, char**);
+
+int kdemain( int argc, char **argv )
 {
     //setup signal handling
     signal(SIGTERM, signalHandler);
diff -uNbr kdesktop/stub_main.cpp kdesktop/stub_main.cpp
--- kdesktop/stub_main.cpp	Wed Dec 31 19:00:00 1969
+++ kdesktop/stub_main.cpp	Thu Mar 13 22:51:58 2003
@@ -0,0 +1,28 @@
+/*
+ *
+ * Copyright (c) 2001 Nick Hudson <skrll@netbsd.org>
+ *
+ * Permission is hereby granted, free of charge, to any person obtaining a copy
+ * of this software and associated documentation files (the "Software"), to deal
+ * in the Software without restriction, including without limitation the rights
+ * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
+ * copies of the Software, and to permit persons to whom the Software is
+ * furnished to do so, subject to the following conditions:
+ *
+ * The above copyright notice and this permission notice shall be included in
+ * all copies or substantial portions of the Software.
+ *
+ * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
+ * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
+ * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.  IN NO EVENT SHALL THE
+ * AUTHORS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN
+ * AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN
+ * CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
+ */
+extern "C" int kdemain(int, char* []);
+
+int main( int argc, char* argv[] )
+{
+        return kdemain(argc, argv);
+}
+
diff -uNbr kdm/backend/client.c kdm/backend/client.c
--- kdm/backend/client.c	Thu Dec  5 15:40:20 2002
+++ kdm/backend/client.c	Thu Mar 13 22:51:58 2003
@@ -38,6 +38,7 @@
  * user verification and session initiation.
  */
 
+#include <config.h>
 #include "dm.h"
 #include "dm_auth.h"
 #include "dm_error.h"
@@ -59,7 +60,11 @@
 # endif
 #endif
 #ifdef USE_PAM
-# include <security/pam_appl.h>
+#ifdef HAVE_PAM_PAM_APPL_H
+#include <pam/pam_appl.h>
+#else
+#include <security/pam_appl.h>
+#endif
 #elif defined(AIXV3) /* USE_PAM */
 # include <login.h>
 # include <usersec.h>
diff -uNbr kdm/backend/dm.h kdm/backend/dm.h
--- kdm/backend/dm.h	Thu Dec  5 15:40:20 2002
+++ kdm/backend/dm.h	Thu Mar 13 22:51:58 2003
@@ -41,6 +41,10 @@
 #ifndef _DM_H_
 #define _DM_H_ 1
 
+#ifdef __APPLE__
+#define CSRG_BASED
+#endif
+
 #include "greet.h"
 
 #include <X11/Xos.h>
diff -uNbr khotkeys/khotkeys/Makefile.am khotkeys/khotkeys/Makefile.am
--- khotkeys/khotkeys/Makefile.am	Sun Feb 17 12:36:55 2002
+++ khotkeys/khotkeys/Makefile.am	Thu Mar 13 22:51:58 2003
@@ -1,15 +1,25 @@
 # $Id: Makefile.am,v 1.12 2002/02/12 14:32:08 ellis Exp $
 
 bin_PROGRAMS = khotkeys
-lib_LTLIBRARIES = khotkeys.la
+lib_LTLIBRARIES = khotkeys.la libkhotkeys_main.la
 
-khotkeys_la_SOURCES = khotkeys.cpp main.cpp khotkeys.skel
-khotkeys_la_LIBADD   = ../shared/libshared.la $(LIB_KSYCOCA)
-khotkeys_la_LDFLAGS = $(all_libraries) -module -avoid-version
+libkhotkeys_main_la_SOURCES = khotkeys.cpp main.cpp khotkeys.skel
+libkhotkeys_main_la_LIBADD  = ../shared/libshared.la $(LIB_KSYCOCA) $(LIB_QT) -lkdecore -lDCOP
+libkhotkeys_main_la_LDFLAGS = $(all_libraries) -avoid-version
 
-khotkeys_SOURCES = dummy.cpp
-khotkeys_LDADD   = khotkeys.la
+khotkeys_la_SOURCES = khotkeys_la_main.cpp
+khotkeys_la_LIBADD  = libkhotkeys_main.la
+khotkeys_la_LDFLAGS = $(all_libraries) -avoid-version -module
+
+khotkeys_la_main.cpp: stub_main.cpp
+	cat stub_main.cpp > khotkeys_la_main.cpp
+
+khotkeys_SOURCES = khotkeys_main.cpp
+khotkeys_LDADD = libkhotkeys_main.la
 khotkeys_LDFLAGS = $(all_libraries) $(KDE_RPATH)
+
+khotkeys_main.cpp: stub_main.cpp
+	cat stub_main.cpp > khotkeys_main.cpp
 
 autostart_DATA = khotkeys.desktop
 autostartdir = $(prefix)/share/autostart
diff -uNbr khotkeys/khotkeys/main.cpp khotkeys/khotkeys/main.cpp
--- khotkeys/khotkeys/main.cpp	Sun Feb 17 12:36:56 2002
+++ khotkeys/khotkeys/main.cpp	Thu Mar 13 22:51:58 2003
@@ -28,8 +28,9 @@
 // for multihead
 int khotkeys_screen_number = 0;
 
+extern "C" int kdemain(int, char**);
 
-int main( int argc, char** argv )
+int kdemain( int argc, char** argv )
 {                             // no need to i18n these, no GUI
     {
 	// multiheaded hotkeys
diff -uNbr khotkeys/khotkeys/stub_main.cpp khotkeys/khotkeys/stub_main.cpp
--- khotkeys/khotkeys/stub_main.cpp	Wed Dec 31 19:00:00 1969
+++ khotkeys/khotkeys/stub_main.cpp	Thu Mar 13 22:51:58 2003
@@ -0,0 +1,28 @@
+/*
+ *
+ * Copyright (c) 2001 Nick Hudson <skrll@netbsd.org>
+ *
+ * Permission is hereby granted, free of charge, to any person obtaining a copy
+ * of this software and associated documentation files (the "Software"), to deal
+ * in the Software without restriction, including without limitation the rights
+ * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
+ * copies of the Software, and to permit persons to whom the Software is
+ * furnished to do so, subject to the following conditions:
+ *
+ * The above copyright notice and this permission notice shall be included in
+ * all copies or substantial portions of the Software.
+ *
+ * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
+ * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
+ * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.  IN NO EVENT SHALL THE
+ * AUTHORS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN
+ * AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN
+ * CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
+ */
+extern "C" int kdemain(int, char* []);
+
+int main( int argc, char* argv[] )
+{
+        return kdemain(argc, argv);
+}
+
diff -uNbr kicker/Makefile.am kicker/Makefile.am
--- kicker/Makefile.am	Mon Jul  1 14:53:58 2002
+++ kicker/Makefile.am	Thu Mar 13 22:51:58 2003
@@ -3,18 +3,22 @@
 SUBDIRS = share core ui buttons . proxy taskmanager taskbar applets extensions menuext data
 
 bin_PROGRAMS = kicker
-lib_LTLIBRARIES = kicker.la
+lib_LTLIBRARIES = kicker.la libkicker_shared.la
 
-CLEANFILES = dummy.cpp dummy_la.cpp
+CLEANFILES = libkicker_shared_la_dummy.cpp kicker_la_dummy.cpp kicker_dummy.cpp
 
-kicker_la_LIBADD = core/libkicker_core.la  buttons/libkicker_buttons.la \
+libkicker_shared_la_LIBADD = core/libkicker_core.la  buttons/libkicker_buttons.la \
 	ui/libkicker_ui.la share/libkickermain.la $(LIB_KIO) 
 
-kicker_la_SOURCES = dummy.cpp
-kicker_la_LDFLAGS = $(KDE_PLUGIN) -no-undefined -module $(all_libraries)
+libkicker_shared_la_SOURCES = libkicker_shared_la_dummy.cpp
+libkicker_shared_la_LDFLAGS = $(KDE_RPATH) -no-undefined -avoid-version $(all_libraries)
 
-kicker_LDADD = kicker.la
-kicker_SOURCES = dummy_la.cpp
+kicker_la_LIBADD  = libkicker_shared.la
+kicker_la_SOURCES = kicker_la_dummy.cpp
+kicker_la_LDFLAGS = $(all_libraries) $(KDE_RPATH) -module -avoid-version
+
+kicker_LDADD = libkicker_shared.la
+kicker_SOURCES = kicker_dummy.cpp
 kicker_LDFLAGS = $(all_libraries) $(KDE_RPATH)
 
 autostart_DATA = panel.desktop
@@ -26,7 +30,7 @@
 messages:
 	$(XGETTEXT) share/*.cpp buttons/*.cpp core/*.cpp ui/*.cpp -o $(podir)/kicker.pot
 
-dummy.cpp dummy_la.cpp:
+libkicker_shared_la_dummy.cpp kicker_la_dummy.cpp kicker_dummy.cpp:
 	echo > $@
         
 updatedir = $(kde_datadir)/kconf_update
diff -uNbr kicker/applets/launcher/Makefile.am kicker/applets/launcher/Makefile.am
--- kicker/applets/launcher/Makefile.am	Thu Jan  2 23:42:28 2003
+++ kicker/applets/launcher/Makefile.am	Thu Mar 13 22:51:58 2003
@@ -13,8 +13,8 @@
 
 EXTRA_DIST = $(lnk_DATA)
 
-launcher_panelapplet_la_LDFLAGS = -module $(KDE_PLUGIN) $(all_libraries)
-launcher_panelapplet_la_LIBADD = ../../kicker.la $(LIB_KSYCOCA) $(LIB_KDEUI)
+launcher_panelapplet_la_LDFLAGS = $(all_libraries) -module  $(KDE_PLUGIN)
+launcher_panelapplet_la_LIBADD = ../../libkicker_shared.la $(LIB_KSYCOCA) $(LIB_KDEUI) 
 
 messages:
 	$(XGETTEXT) *.cpp *.h -o $(podir)/quicklauncher.pot
diff -uNbr kicker/applets/lockout/Makefile.am kicker/applets/lockout/Makefile.am
--- kicker/applets/lockout/Makefile.am	Thu Jan  2 23:42:28 2003
+++ kicker/applets/lockout/Makefile.am	Thu Mar 13 22:51:58 2003
@@ -4,7 +4,7 @@
 kde_module_LTLIBRARIES = lockout_panelapplet.la
 
 lockout_panelapplet_la_SOURCES = lockout.cpp
-lockout_panelapplet_la_LDFLAGS = -module $(KDE_PLUGIN) $(all_libraries)
+lockout_panelapplet_la_LDFLAGS = -module $(KDE_PLUGIN) $(all_libraries) -no-undefined
 lockout_panelapplet_la_LIBADD = $(LIB_KSYCOCA)
 
 noinst_HEADERS = lockout.h
diff -uNbr kicker/extensions/childpanel/Makefile.am kicker/extensions/childpanel/Makefile.am
--- kicker/extensions/childpanel/Makefile.am	Thu Jan  2 23:42:34 2003
+++ kicker/extensions/childpanel/Makefile.am	Thu Mar 13 22:51:58 2003
@@ -5,7 +5,7 @@
 childpanel_panelextension_la_SOURCES = childpanelextension.cpp childpanelextension.skel
 childpanel_panelextension_la_METASOURCES = AUTO
 childpanel_panelextension_la_LDFLAGS = -module $(KDE_PLUGIN) $(all_libraries)
-childpanel_panelextension_la_LIBADD = $(LIB_KDEUI) $(LIB_KSYCOCA) ../../kicker.la
+childpanel_panelextension_la_LIBADD = $(LIB_KDEUI) $(LIB_KSYCOCA) ../../libkicker_shared.la
 
 noinst_HEADERS = childpanelextension.h
 
diff -uNbr kicker/menuext/kdeprint/Makefile.am kicker/menuext/kdeprint/Makefile.am
--- kicker/menuext/kdeprint/Makefile.am	Thu Mar  7 20:16:48 2002
+++ kicker/menuext/kdeprint/Makefile.am	Thu Mar 13 22:52:28 2003
@@ -4,7 +4,7 @@
 
 kickermenu_kdeprint_la_SOURCES = print_mnu.cpp
 kickermenu_kdeprint_la_LDFLAGS = $(all_libraries) -module -avoid-version
-kickermenu_kdeprint_la_LIBADD = $(LIB_KDEUI) $(LIB_KIO) -lkdeprint
+kickermenu_kdeprint_la_LIBADD = $(LIB_KDEUI) $(LIB_KIO) -lkdeprint $(LIB_QT) -lkdecore -lDCOP
 
 kickermenu_kdeprint_la_METASOURCES = AUTO
 
diff -uNbr kicker/menuext/konsole/Makefile.am kicker/menuext/konsole/Makefile.am
--- kicker/menuext/konsole/Makefile.am	Tue Jul  2 18:24:52 2002
+++ kicker/menuext/konsole/Makefile.am	Thu Mar 13 22:51:58 2003
@@ -4,7 +4,7 @@
 
 kickermenu_konsole_la_SOURCES = konsole_mnu.cpp konsolebookmarkhandler.cpp konsolebookmarkmenu.cpp
 kickermenu_konsole_la_LDFLAGS = $(all_libraries) -module -avoid-version
-kickermenu_konsole_la_LIBADD = $(LIB_KDEUI) $(LIB_KIO)
+kickermenu_konsole_la_LIBADD = $(LIB_KDEUI) $(LIB_KIO) $(LIB_QT) -lkdecore
 
 kickermenu_konsole_la_METASOURCES = AUTO
 
diff -uNbr kicker/menuext/prefmenu/Makefile.am kicker/menuext/prefmenu/Makefile.am
--- kicker/menuext/prefmenu/Makefile.am	Tue May 28 04:14:22 2002
+++ kicker/menuext/prefmenu/Makefile.am	Thu Mar 13 22:51:58 2003
@@ -3,7 +3,7 @@
 kde_module_LTLIBRARIES = kickermenu_prefmenu.la
 
 kickermenu_prefmenu_la_SOURCES = prefmenu.cpp
-kickermenu_prefmenu_la_LDFLAGS = $(all_libraries) -module -avoid-version
+kickermenu_prefmenu_la_LDFLAGS = $(all_libraries) -module -avoid-version -undefined suppress -flat_namespace
 kickermenu_prefmenu_la_LIBADD = $(LIB_KDEUI) $(top_builddir)/kicker/ui/libkicker_ui.la
 
 kickermenu_prefmenu_la_METASOURCES = AUTO
diff -uNbr kicker/menuext/recentdocs/Makefile.am kicker/menuext/recentdocs/Makefile.am
--- kicker/menuext/recentdocs/Makefile.am	Fri Jun  7 15:17:50 2002
+++ kicker/menuext/recentdocs/Makefile.am	Thu Mar 13 22:51:58 2003
@@ -3,7 +3,7 @@
 kde_module_LTLIBRARIES = kickermenu_recentdocs.la
 
 kickermenu_recentdocs_la_SOURCES = recentdocsmenu.cpp
-kickermenu_recentdocs_la_LDFLAGS = $(all_libraries) -module -avoid-version
+kickermenu_recentdocs_la_LDFLAGS = $(all_libraries) -module -avoid-version -undefined suppress -flat_namespace
 kickermenu_recentdocs_la_LIBADD = $(LIB_KDEUI) $(top_builddir)/kicker/ui/libkicker_ui.la
 
 kickermenu_recentdocs_la_METASOURCES = AUTO
diff -uNbr kicker/proxy/Makefile.am kicker/proxy/Makefile.am
--- kicker/proxy/Makefile.am	Sun Feb 17 12:36:59 2002
+++ kicker/proxy/Makefile.am	Thu Mar 13 22:51:58 2003
@@ -3,32 +3,48 @@
 CLEANFILES = dummy.cpp
 
 bin_PROGRAMS = appletproxy extensionproxy
-lib_LTLIBRARIES = appletproxy.la extensionproxy.la
+lib_LTLIBRARIES = libappletproxy_main.la appletproxy.la libextensionproxy_main.la extensionproxy.la
 
-appletproxy_la_LIBADD = $(LIB_KDEUI) ../share/libkickermain.la
-appletproxy_la_SOURCES = appletproxy.cpp
-appletproxy_la_METASOURCES = appletproxy.moc
-appletproxy_la_LDFLAGS = $(all_libraries) $(KDE_RPATH) -module -avoid-version
+libappletproxy_main_la_LIBADD = $(LIB_KDEUI) ../share/libkickermain.la
+libappletproxy_main_la_SOURCES = appletproxy.cpp
+libappletproxy_main_la_METASOURCES = appletproxy.moc
+libappletproxy_main_la_LDFLAGS = $(all_libraries) $(KDE_RPATH) -avoid-version
+
+appletproxy_la_LIBADD  = libappletproxy_main.la
+appletproxy_la_SOURCES = appletproxy_la_main.cpp
+appletproxy_la_LDFLAGS = $(all_libraries) $(KDE_RPATH) -avoid-version -module
 
-appletproxy_LDADD = appletproxy.la
-appletproxy_SOURCES = dummy.cpp
+appletproxy_la_main.cpp: stub_main.cpp
+	cat stub_main.cpp > appletproxy_la_main.cpp
+
+appletproxy_LDADD = libappletproxy_main.la
+appletproxy_SOURCES = appletproxy_main.cpp
 appletproxy_LDFLAGS = $(all_libraries) $(KDE_RPATH)
 
-extensionproxy_la_LIBADD = $(LIB_KDEUI) ../share/libkickermain.la
-extensionproxy_la_SOURCES = extensionproxy.cpp
-extensionproxy_la_METASOURCES = extensionproxy.moc
-extensionproxy_la_LDFLAGS = $(all_libraries) $(KDE_RPATH) -module -avoid-version
+appletproxy_main.cpp: stub_main.cpp
+	cat stub_main.cpp > appletproxy_main.cpp
+
+libextensionproxy_main_la_LIBADD = $(LIB_KDEUI) ../share/libkickermain.la
+libextensionproxy_main_la_SOURCES = extensionproxy.cpp
+libextensionproxy_main_la_METASOURCES = extensionproxy.moc
+libextensionproxy_main_la_LDFLAGS = $(all_libraries) $(KDE_RPATH) -avoid-version
+
+extensionproxy_la_LIBADD = libextensionproxy_main.la
+extensionproxy_la_SOURCES = extensionproxy_la_main.cpp
+extensionproxy_la_LDFLAGS = $(all_libraries) $(KDE_RPATH) -avoid-version -module
+
+extensionproxy_la_main.cpp: stub_main.cpp
+	cat stub_main.cpp > extensionproxy_la_main.cpp
 
-extensionproxy_LDADD = extensionproxy.la
-extensionproxy_SOURCES = dummy.cpp
+extensionproxy_LDADD = libextensionproxy_main.la
+extensionproxy_SOURCES = extensionproxy_main.cpp
 extensionproxy_LDFLAGS = $(all_libraries) $(KDE_RPATH)
 
+extensionproxy_main.cpp: stub_main.cpp
+	cat stub_main.cpp > extensionproxy_main.cpp
+
 noinst_HEADERS = appletproxy.h extensionproxy.h
 
 messages:
 	$(XGETTEXT) appletproxy.cpp -o $(podir)/appletproxy.pot
 	$(XGETTEXT) extensionproxy.cpp -o $(podir)/extensionproxy.pot
-
-dummy.cpp:
-	echo > dummy.cpp
-
diff -uNbr kicker/proxy/appletproxy.cpp kicker/proxy/appletproxy.cpp
--- kicker/proxy/appletproxy.cpp	Mon Jul  1 14:54:01 2002
+++ kicker/proxy/appletproxy.cpp	Thu Mar 13 22:51:58 2003
@@ -67,7 +67,9 @@
   { 0, 0, 0}
 };
 
-int main( int argc, char ** argv )
+extern "C" int kdemain(int, char**);
+
+int kdemain( int argc, char ** argv )
 {
     KAboutData aboutData( "appletproxy", I18N_NOOP("Panel applet proxy.")
                           , "v0.1.0"
diff -uNbr kicker/proxy/extensionproxy.cpp kicker/proxy/extensionproxy.cpp
--- kicker/proxy/extensionproxy.cpp	Mon Jul  1 14:54:01 2002
+++ kicker/proxy/extensionproxy.cpp	Thu Mar 13 22:51:58 2003
@@ -54,7 +54,9 @@
   { 0, 0, 0}
 };
 
-int main( int argc, char ** argv )
+extern "C" int kdemain(int, char**);
+
+int kdemain( int argc, char ** argv )
 {
     KAboutData aboutData( "extensionproxy", I18N_NOOP("Panel extension proxy.")
                           , "v0.1.0"
diff -uNbr kicker/proxy/stub_main.cpp kicker/proxy/stub_main.cpp
--- kicker/proxy/stub_main.cpp	Wed Dec 31 19:00:00 1969
+++ kicker/proxy/stub_main.cpp	Thu Mar 13 22:51:58 2003
@@ -0,0 +1,28 @@
+/*
+ *
+ * Copyright (c) 2001 Nick Hudson <skrll@netbsd.org>
+ *
+ * Permission is hereby granted, free of charge, to any person obtaining a copy
+ * of this software and associated documentation files (the "Software"), to deal
+ * in the Software without restriction, including without limitation the rights
+ * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
+ * copies of the Software, and to permit persons to whom the Software is
+ * furnished to do so, subject to the following conditions:
+ *
+ * The above copyright notice and this permission notice shall be included in
+ * all copies or substantial portions of the Software.
+ *
+ * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
+ * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
+ * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.  IN NO EVENT SHALL THE
+ * AUTHORS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN
+ * AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN
+ * CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
+ */
+extern "C" int kdemain(int, char* []);
+
+int main( int argc, char* argv[] )
+{
+        return kdemain(argc, argv);
+}
+
diff -uNbr kicker/share/Makefile.am kicker/share/Makefile.am
--- kicker/share/Makefile.am	Sun Feb 17 12:36:59 2002
+++ kicker/share/Makefile.am	Thu Mar 13 22:51:58 2003
@@ -5,7 +5,7 @@
 libkickermain_la_SOURCES = pluginloader.cpp appletinfo.cpp panner.cpp fittslawframe.cpp menuinfo.cpp
 libkickermain_la_METASOURCES = AUTO
 
-libkickermain_la_LDFLAGS = $(all_libraries) -version-info 1:0:0 -module -no-undefined
+libkickermain_la_LDFLAGS = $(all_libraries) -version-info 1:0:0 -no-undefined
 libkickermain_la_LIBADD = $(LIB_KDECORE) $(LIB_KDEUI) $(top_builddir)/libkonq/libkonq.la
 
 messages:
diff -uNbr kicker/taskmanager/Makefile.am kicker/taskmanager/Makefile.am
--- kicker/taskmanager/Makefile.am	Thu Jan  3 15:29:40 2002
+++ kicker/taskmanager/Makefile.am	Thu Mar 13 22:51:58 2003
@@ -4,7 +4,7 @@
 libtaskmanager_la_SOURCES = tasklmbmenu.cpp taskrmbmenu.cpp taskmanager.cpp
 libtaskmanager_la_METASOURCES = AUTO
 
-libtaskmanager_la_LDFLAGS = $(all_libraries) -version-info 1:0:0 -module -no-undefined
+libtaskmanager_la_LDFLAGS = $(all_libraries) -version-info 1:0:0 -no-undefined
 libtaskmanager_la_LIBADD = $(LIB_KDECORE)
 
 messages:
diff -uNbr kioslave/Makefile.am kioslave/Makefile.am
--- kioslave/Makefile.am	Sat Oct 26 18:06:27 2002
+++ kioslave/Makefile.am	Thu Mar 13 22:51:58 2003
@@ -8,10 +8,14 @@
 SMB_SUBDIR=smb
 endif
 
+if include_kioslave_nfs
+NFS_SUBDIR=nfs
+endif
+
 if include_devicesdir
 DEVICES_SUBDIR=devices
 endif
 
-
-SUBDIRS = about cgi floppy filter fish info mac man nfs nntp pop3 imap4 smtp \
-  smbro sftp tar zip finger thumbnail $(LDAP_SUBDIR) $(SMB_SUBDIR) $(DEVICES_SUBDIR)
+SUBDIRS = about cgi floppy filter fish info mac man nntp pop3 imap4 smtp \
+	smbro sftp tar zip finger thumbnail $(LDAP_SUBDIR) $(SMB_SUBDIR) \
+	$(NFS_SUBDIR) $(DEVICES_SUBDIR)
diff -uNbr kioslave/devices/configure.in.in kioslave/devices/configure.in.in
--- kioslave/devices/configure.in.in	Sat Oct 26 18:06:27 2002
+++ kioslave/devices/configure.in.in	Thu Mar 13 22:51:58 2003
@@ -7,6 +7,9 @@
     Linux)
         DEVICESDIR=devices
         ;;
+    Darwin)
+        DEVICESDIR=devices
+        ;;
     *)
         DEVICESDIR=
         ;;
diff -uNbr kioslave/devices/kdedmodule/Makefile.am kioslave/devices/kdedmodule/Makefile.am
--- kioslave/devices/kdedmodule/Makefile.am	Sat Oct 26 18:06:27 2002
+++ kioslave/devices/kdedmodule/Makefile.am	Thu Mar 13 22:51:58 2003
@@ -3,7 +3,7 @@
 INCLUDES = $(all_includes)
 kded_mountwatcher_la_SOURCES = mountwatcher.cpp mountwatcher.skel disklist.cpp disks.cpp
 kded_mountwatcher_la_LDFLAGS = $(all_libraries) -module -avoid-version
-kded_mountwatcher_la_LIBADD = $(LIB_KSYCOCA)
+kded_mountwatcher_la_LIBADD = $(LIB_KSYCOCA) $(LIB_QT) -lDCOP -lkdecore $(LIB_KDED)
 
 METASOURCES = AUTO
 
diff -uNbr kioslave/ldap/configure.in.in kioslave/ldap/configure.in.in
--- kioslave/ldap/configure.in.in	Mon Jan 13 18:39:14 2003
+++ kioslave/ldap/configure.in.in	Thu Mar 13 22:51:58 2003
@@ -19,7 +19,7 @@
   fi
   if test $with_ldap = FOUND ; then
     with_ldap=NOTFOUND
-    for ext in la so sl a ; do
+    for ext in la so sl a dylib ; do
       AC_FIND_FILE(libldap.$ext, $kde_libraries /usr/lib /usr/local/lib,
         ldap_libdir)
       if test -r $ldap_libdir/libldap.$ext ; then
@@ -37,6 +37,12 @@
 
 case "$with_ldap" in
 no) AC_MSG_RESULT(no) ;;
+framework)
+  LDAP_LIBS="-framework LDAP"
+  AC_DEFINE_UNQUOTED(HAVE_LIBLDAP, 1, [Define if you have LDAP libraries])
+  LDAP_SUBDIR="ldap"
+  AC_MSG_RESULT(Apple framework)
+  ;;
 NOTFOUND) AC_MSG_RESULT(searched but not found) ;;
 *)
   if test "x$with_ldap" = "xFOUND" ; then
diff -uNbr kioslave/nfs/README kioslave/nfs/README
--- kioslave/nfs/README	Tue Aug 15 05:53:41 2000
+++ kioslave/nfs/README	Thu Mar 13 22:51:58 2003
@@ -1,3 +1,29 @@
 this is an ioslave for KDE 2 for NFS, version 2.
 
 Alex
+
+Darwin notes --
+
+It looks like there are C++ type issues with the Darwin headers
+(try building, you'll see the "too many arguments to function" stuff)
+
+The problem seems to be <rpc/clnt.h> having definitions that don't
+play nice with C++.  The client rpc handle does a bunch of void stuff
+in the struct which is fine in C but makes an empty arg list in C++.
+
+typedef struct {
+        AUTH    *cl_auth;                       /* authenticator */
+        struct clnt_ops {
+                enum clnt_stat  (*cl_call)();   /* call remote procedure */
+                void            (*cl_abort)();  /* abort a call */
+                void            (*cl_geterr)(); /* get specific error code */
+                bool_t          (*cl_freeres)(); /* frees results */
+                void            (*cl_destroy)();/* destroy this structure */
+                bool_t          (*cl_control)();/* the ioctl() of rpc */
+        } *cl_ops;
+        caddr_t                 cl_private;     /* private stuff */
+} CLIENT;
+
+
+The only solution is to probably reimplement clnt.h locally to fix
+these (wrapping the "#include <rpc/rpc.h>" in an extern "C" isn't enough).
diff -uNbr kioslave/nfs/configure.in.in kioslave/nfs/configure.in.in
--- kioslave/nfs/configure.in.in	Wed Dec 31 19:00:00 1969
+++ kioslave/nfs/configure.in.in	Thu Mar 13 22:51:58 2003
@@ -0,0 +1,12 @@
+AC_MSG_CHECKING(whether to compile NFS support)
+AC_ARG_WITH(nfs,
+[  --without-nfs           Disable NFS kioslave [default=no]],
+	with_nfs=$withval, with_nfs=yes
+)dnl
+
+if test `uname -s` = "Darwin"; then
+	with_nfs=no
+fi
+
+AC_MSG_RESULT($withval)
+AM_CONDITIONAL(include_kioslave_nfs, test "$with_nfs" = "yes")
diff -uNbr klipper/Makefile.am klipper/Makefile.am
--- klipper/Makefile.am	Mon Jan 13 18:39:15 2003
+++ klipper/Makefile.am	Thu Mar 13 22:51:58 2003
@@ -1,23 +1,30 @@
 INCLUDES= $(all_includes)
 
 bin_PROGRAMS = klipper
-lib_LTLIBRARIES = klipper.la
+lib_LTLIBRARIES = klipper.la libklipper_main.la
 kde_module_LTLIBRARIES = klipper_panelapplet.la
 
-CLEANFILES = dummy.cpp
+CLEANFILES = dummy.cpp klipper_main.cpp
 
-klipper_la_LIBADD = $(LIB_KDEUI) $(LIB_KSYCOCA) 
-klipper_la_SOURCES = main.cpp toplevel.cpp urlgrabber.cpp configdialog.cpp \
+libklipper_main_la_LIBADD = $(LIB_KDEUI) $(LIB_KSYCOCA) $(LIB_QT) -lkdecore -lDCOP
+libklipper_main_la_SOURCES = toplevel.cpp urlgrabber.cpp configdialog.cpp \
     toplevel.skel
 
-klipper_la_METASOURCES = AUTO
-klipper_la_LDFLAGS = $(all_libraries) -module -avoid-version
+libklipper_main_la_METASOURCES = AUTO
+libklipper_main_la_LDFLAGS = $(all_libraries) -avoid-version
 
-klipper_LDADD = klipper.la $(LIB_KSYCOCA)
-klipper_SOURCES = dummy.cpp
+klipper_la_LIBADD = libklipper_main.la
+klipper_la_SOURCES = main.cpp
+klipper_la_LDFLAGS = $(all_libraries) -avoid-version -module
+
+klipper_main.cpp: main.cpp
+	cat main.cpp > klipper_main.cpp
+
+klipper_LDADD = libklipper_main.la
+klipper_SOURCES = klipper_main.cpp
 klipper_LDFLAGS = $(all_libraries) $(KDE_RPATH)
 
-klipper_panelapplet_la_LIBADD = klipper.la
+klipper_panelapplet_la_LIBADD = libklipper_main.la
 klipper_panelapplet_la_SOURCES = applet.cpp applet.skel
 klipper_panelapplet_la_LDFLAGS = $(all_libraries) -module -avoid-version
 
diff -uNbr kmenuedit/Makefile.am kmenuedit/Makefile.am
--- kmenuedit/Makefile.am	Sun Sep 15 17:08:52 2002
+++ kmenuedit/Makefile.am	Thu Mar 13 22:51:58 2003
@@ -1,18 +1,24 @@
 INCLUDES = $(all_includes)
 
 bin_PROGRAMS = kmenuedit
-lib_LTLIBRARIES = kmenuedit.la
+lib_LTLIBRARIES = kmenuedit.la libkmenuedit_main.la
 
 CLEANFILES = dummy.cpp
 
-kmenuedit_la_SOURCES = basictab.cpp treeview.cpp desktopfileeditor.cpp menueditview.cpp kmenuedit.cpp main.cpp khotkeys.cpp
+libkmenuedit_main_la_SOURCES = basictab.cpp treeview.cpp desktopfileeditor.cpp menueditview.cpp kmenuedit.cpp khotkeys.cpp
+libkmenuedit_main_la_LIBADD = $(LIB_KDEUI) $(LIB_KIO) $(LIB_QT) -lkdecore -lDCOP
+libkmenuedit_main_la_LDFLAGS = $(all_libraries) -avoid-version
 
-kmenuedit_la_LIBADD = $(LIB_KDEUI) $(LIB_KIO)
-kmenuedit_la_LDFLAGS = $(all_libraries) -module -avoid-version
+kmenuedit_la_SOURCES = main.cpp
+kmenuedit_la_LDFLAGS = $(all_libraries) $(KDE_RPATH) -avoid-version -module
+kmenuedit_la_LIBADD  = libkmenuedit_main.la
 
-kmenuedit_SOURCES = dummy.cpp
-kmenuedit_LDADD   = kmenuedit.la
+kmenuedit_SOURCES = kmenuedit_main.cpp
 kmenuedit_LDFLAGS = $(all_libraries) $(KDE_RPATH)
+kmenuedit_LDADD   = libkmenuedit_main.la
+
+kmenuedit_main.cpp: main.cpp
+	cat main.cpp > kmenuedit_main.cpp
 
 noinst_HEADERS = kmenuedit.h menueditview.h treeview.h desktopfileeditor.h basictab.h khotkeys.h
 
diff -uNbr konqueror/Makefile.am konqueror/Makefile.am
--- konqueror/Makefile.am	Thu Jan 16 13:40:04 2003
+++ konqueror/Makefile.am	Thu Mar 13 22:51:58 2003
@@ -5,7 +5,7 @@
 #SUBDIRS = . kfmexec client iconview dirtree listview keditbookmarks shellcmdplugin about pics sidebar
 SUBDIRS = . kfmexec client iconview listview keditbookmarks shellcmdplugin about pics sidebar
 
-lib_LTLIBRARIES = konqueror.la
+lib_LTLIBRARIES = konqueror.la libkonqueror_main.la
 
 konqdatadir = $(kde_datadir)/konqueror
 konqdata_DATA = konqueror.rc
@@ -22,8 +22,7 @@
 
 bin_PROGRAMS = konqueror
 
-konqueror_la_SOURCES = konq_main.cc \
-	    KonquerorIface.cc KonquerorIface.skel \
+libkonqueror_main_la_SOURCES = KonquerorIface.cc KonquerorIface.skel \
 	    KonqMainWindowIface.cc KonqMainWindowIface.skel \
 	    KonqViewIface.cc KonqViewIface.skel \
 	    konq_mainwindow.cc konq_guiclients.cc \
@@ -43,11 +42,18 @@
 	konq_misc.h konq_openurlrequest.h konq_profiledlg.h konq_run.h \
 	konq_view.h konq_viewmgr.h version.h
 
-konqueror_la_LDFLAGS = $(all_libraries) -module -avoid-version
-konqueror_la_LIBADD = ../libkonq/libkonq.la
+libkonqueror_main_la_LDFLAGS = $(all_libraries) -avoid-version
+libkonqueror_main_la_LIBADD = ../libkonq/libkonq.la
 
-konqueror_SOURCES = dummy.cc
-konqueror_LDADD = konqueror.la
+konqueror_la_SOURCES = konq_la_main.cc
+konqueror_la_LDFLAGS = $(all_libraries) -avoid-version $(KDE_RPATH) -module
+konqueror_la_LIBADD  = libkonqueror_main.la
+
+konq_la_main.cc: konq_main.cc
+	cat konq_main.cc > konq_la_main.cc
+
+konqueror_SOURCES = konq_main.cc
+konqueror_LDADD = libkonqueror_main.la
 konqueror_LDFLAGS = $(KDE_RPATH) $(all_libraries)
 
 # Hmm, this experiment of a static konq failed, don't trust it...
@@ -61,9 +67,6 @@
 #konqueror_static_SOURCES = dummy.cc
 #konqueror_static_LDADD = konqueror.la *view/*.la dirtree/*.la $(libdir)/libkhtml.la
 #konqueror_static_LDFLAGS = $(all_libraries) -static
-
-dummy.cc:
-	echo > dummy.cc
 
 messages: rc.cpp
 	$(EXTRACTRC) *.rc */*.rc >> rc.cpp
diff -uNbr konqueror/client/Makefile.am konqueror/client/Makefile.am
--- konqueror/client/Makefile.am	Sun Sep 15 17:08:52 2002
+++ konqueror/client/Makefile.am	Thu Mar 13 22:51:58 2003
@@ -1,12 +1,12 @@
 AM_CPPFLAGS = -DQT_NO_CAST_ASCII
 
 bin_PROGRAMS = kfmclient
-lib_LTLIBRARIES = kfmclient.la
+lib_LTLIBRARIES = kfmclient.la libkfmclient_main.la
 
 INCLUDES= -I.. $(all_includes)
-kfmclient_la_LDFLAGS = $(all_libraries) -module -avoid-version
-kfmclient_la_LIBADD =  $(LIB_KIO)
-kfmclient_la_SOURCES = kfmclient.cc KonquerorIface.stub KDesktopIface.stub
+libkfmclient_main_la_LDFLAGS = $(all_libraries) -avoid-version
+libkfmclient_main_la_LIBADD =  $(LIB_KIO) $(LIB_QT) -lkdecore -lDCOP -lkdeui
+libkfmclient_main_la_SOURCES = kfmclient.cc KonquerorIface.stub KDesktopIface.stub
 
 noinst_HEADERS = kfmclient.h
 METASOURCES = AUTO
@@ -14,12 +14,19 @@
 KonquerorIface_DIR =  $(srcdir)/..
 KDesktopIface_DIR = $(top_srcdir)/kdesktop
 
-kfmclient_SOURCES = dummy.cc
+kfmclient_la_LDFLAGS = $(all_libraries) -avoid-version -module $(KDE_RPATH)
+kfmclient_la_LIBADD  = libkfmclient_main.la
+kfmclient_la_SOURCES = kfmclient_la_main.cpp
+
+kfmclient_la_main.cpp: stub_main.cpp
+	cat stub_main.cpp > kfmclient_la_main.cpp
+
+kfmclient_SOURCES = kfmclient_main.cpp
 kfmclient_LDFLAGS = $(KDE_RPATH) $(all_libraries)
-kfmclient_LDADD = kfmclient.la
+kfmclient_LDADD   = libkfmclient_main.la
 
-dummy.cc:
-	echo > dummy.cc
+kfmclient_main.cpp: stub_main.cpp
+	cat stub_main.cpp > kfmclient_main.cpp
 
 messages:
 	$(XGETTEXT) -kaliasLocal *.h *.cc -o $(podir)/kfmclient.pot
diff -uNbr konqueror/client/kfmclient.cc konqueror/client/kfmclient.cc
--- konqueror/client/kfmclient.cc	Thu Jan  2 23:43:39 2003
+++ konqueror/client/kfmclient.cc	Thu Mar 13 22:51:58 2003
@@ -59,7 +59,9 @@
    {0,0,0}
 };
 
-int main( int argc, char **argv )
+extern "C" int kdemain(int, char**);
+
+int kdemain( int argc, char **argv )
 {
   KCmdLineArgs::init(argc, argv, appName, description, version, false);
 
diff -uNbr konqueror/client/stub_main.cpp konqueror/client/stub_main.cpp
--- konqueror/client/stub_main.cpp	Wed Dec 31 19:00:00 1969
+++ konqueror/client/stub_main.cpp	Thu Mar 13 22:51:58 2003
@@ -0,0 +1,28 @@
+/*
+ *
+ * Copyright (c) 2001 Nick Hudson <skrll@netbsd.org>
+ *
+ * Permission is hereby granted, free of charge, to any person obtaining a copy
+ * of this software and associated documentation files (the "Software"), to deal
+ * in the Software without restriction, including without limitation the rights
+ * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
+ * copies of the Software, and to permit persons to whom the Software is
+ * furnished to do so, subject to the following conditions:
+ *
+ * The above copyright notice and this permission notice shall be included in
+ * all copies or substantial portions of the Software.
+ *
+ * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
+ * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
+ * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.  IN NO EVENT SHALL THE
+ * AUTHORS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN
+ * AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN
+ * CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
+ */
+extern "C" int kdemain(int, char* []);
+
+int main( int argc, char* argv[] )
+{
+        return kdemain(argc, argv);
+}
+
diff -uNbr konqueror/keditbookmarks/Makefile.am konqueror/keditbookmarks/Makefile.am
--- konqueror/keditbookmarks/Makefile.am	Sat Oct 26 18:06:42 2002
+++ konqueror/keditbookmarks/Makefile.am	Thu Mar 13 22:51:58 2003
@@ -2,22 +2,29 @@
 
 METASOURCES = AUTO
 
-lib_LTLIBRARIES = keditbookmarks.la
+lib_LTLIBRARIES = keditbookmarks.la libkeditbookmarks_main.la
 
-keditbookmarks_la_SOURCES = main.cpp items.cpp toplevel.cpp favicons.cpp toplevel.skel commands.cpp
+libkeditbookmarks_main_la_SOURCES = main.cpp items.cpp toplevel.cpp favicons.cpp toplevel.skel commands.cpp
 kbookmarklistener_DIR = $(top_srcdir)/libkonq
 
-keditbookmarks_la_LIBADD  = $(top_builddir)/libkonq/libkonq.la $(LIB_KHTML)
-keditbookmarks_la_LDFLAGS = $(all_libraries) -module -avoid-version
+libkeditbookmarks_main_la_LIBADD  = $(top_builddir)/libkonq/libkonq.la $(LIB_KHTML)
+libkeditbookmarks_main_la_LDFLAGS = $(all_libraries) -avoid-version
+
+keditbookmarks_la_SOURCES = keditbookmarks_la_main.cpp
+keditbookmarks_la_LIBADD  = libkeditbookmarks_main.la
+keditbookmarks_la_LDFLAGS = $(all_libraries) -avoid-version -module
+
+keditbookmarks_la_main.cpp: stub_main.cpp
+	cat stub_main.cpp > keditbookmarks_la_main.cpp
 
 bin_PROGRAMS = keditbookmarks
 
-keditbookmarks_SOURCES = dummy.cpp
-keditbookmarks_LDADD = keditbookmarks.la
+keditbookmarks_SOURCES = keditbookmarks_main.cpp
+keditbookmarks_LDADD = libkeditbookmarks_main.la
 keditbookmarks_LDFLAGS = $(all_libraries)
 
-dummy.cpp:
-	echo > dummy.cpp
+keditbookmarks_main.cpp: stub_main.cpp
+	cat stub_main.cpp > keditbookmarks_main.cpp
 
 rcdir = $(kde_datadir)/keditbookmarks
 rc_DATA = keditbookmarksui.rc  
diff -uNbr konqueror/keditbookmarks/main.cpp konqueror/keditbookmarks/main.cpp
--- konqueror/keditbookmarks/main.cpp	Mon Nov  4 10:45:04 2002
+++ konqueror/keditbookmarks/main.cpp	Thu Mar 13 22:51:58 2003
@@ -110,7 +110,9 @@
   }
 }
 
-int main(int argc, char ** argv)
+extern "C" int kdemain(int, char**);
+
+int kdemain(int argc, char ** argv)
 {
   KLocale::setMainCatalogue("konqueror");
   KAboutData aboutData("keditbookmarks", I18N_NOOP("KEditBookmarks"), "1.1",
diff -uNbr konqueror/keditbookmarks/stub_main.cpp konqueror/keditbookmarks/stub_main.cpp
--- konqueror/keditbookmarks/stub_main.cpp	Wed Dec 31 19:00:00 1969
+++ konqueror/keditbookmarks/stub_main.cpp	Thu Mar 13 22:51:58 2003
@@ -0,0 +1,28 @@
+/*
+ *
+ * Copyright (c) 2001 Nick Hudson <skrll@netbsd.org>
+ *
+ * Permission is hereby granted, free of charge, to any person obtaining a copy
+ * of this software and associated documentation files (the "Software"), to deal
+ * in the Software without restriction, including without limitation the rights
+ * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
+ * copies of the Software, and to permit persons to whom the Software is
+ * furnished to do so, subject to the following conditions:
+ *
+ * The above copyright notice and this permission notice shall be included in
+ * all copies or substantial portions of the Software.
+ *
+ * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
+ * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
+ * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.  IN NO EVENT SHALL THE
+ * AUTHORS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN
+ * AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN
+ * CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
+ */
+extern "C" int kdemain(int, char* []);
+
+int main( int argc, char* argv[] )
+{
+        return kdemain(argc, argv);
+}
+
diff -uNbr konqueror/sidebar/Makefile.am konqueror/sidebar/Makefile.am
--- konqueror/sidebar/Makefile.am	Sun Sep 15 17:08:52 2002
+++ konqueror/sidebar/Makefile.am	Thu Mar 13 22:51:58 2003
@@ -25,7 +25,7 @@
 konq_sidebar_la_LIBADD  = $(LIB_KPARTS) $(LIB_KIO) ../../libkonq/libkonq.la ./libkonqsidebarplugin.la ../../kate/lib/libkmultitabbar.la
 
 libkonqsidebarplugin_la_SOURCES=konqsidebarplugin.cpp
-libkonqsidebarplugin_la_LDFLAGS = $(all_libraries) -no-undefined
+libkonqsidebarplugin_la_LDFLAGS = $(all_libraries) -no-undefined -avoid-version
 libkonqsidebarplugin_la_LIBADD = $(LIB_KPARTS)
 
 # this is where the desktop file will go 
diff -uNbr konqueror/sidebar/trees/Makefile.am konqueror/sidebar/trees/Makefile.am
--- konqueror/sidebar/trees/Makefile.am	Mon Jul  1 14:54:09 2002
+++ konqueror/sidebar/trees/Makefile.am	Thu Mar 13 22:51:58 2003
@@ -8,10 +8,10 @@
 METASOURCES = AUTO
 
 libkonq_sidebar_tree_la_SOURCES = konq_sidebartree.cpp konq_sidebartreeitem.cpp konq_sidebartreetoplevelitem.cpp
-libkonq_sidebar_tree_la_LDFLAGS = $(all_libraries) -module -avoid-version -no-undefined
-libkonq_sidebar_tree_la_LIBADD = $(top_builddir)/libkonq/libkonq.la ../libkonqsidebarplugin.la
+libkonq_sidebar_tree_la_LDFLAGS = $(all_libraries) -avoid-version -no-undefined
+libkonq_sidebar_tree_la_LIBADD = $(top_builddir)/libkonq/libkonq.la $(top_builddir)/konqueror/sidebar/libkonqsidebarplugin.la
 
 konqsidebar_tree_la_SOURCES = konqsidebar_tree.cpp
 konqsidebar_tree_la_LDFLAGS = $(all_libraries) -module -avoid-version -no-undefined
-konqsidebar_tree_la_LIBADD = $(top_builddir)/libkonq/libkonq.la ../libkonqsidebarplugin.la libkonq_sidebar_tree.la
+konqsidebar_tree_la_LIBADD = $(top_builddir)/libkonq/libkonq.la $(top_builddir)/konqueror/sidebar/libkonqsidebarplugin.la libkonq_sidebar_tree.la
 
diff -uNbr konqueror/sidebar/trees/bookmark_module/Makefile.am konqueror/sidebar/trees/bookmark_module/Makefile.am
--- konqueror/sidebar/trees/bookmark_module/Makefile.am	Thu Mar  7 20:16:53 2002
+++ konqueror/sidebar/trees/bookmark_module/Makefile.am	Thu Mar 13 22:51:58 2003
@@ -6,5 +6,5 @@
 
 konq_sidebartree_bookmarks_la_SOURCES = bookmark_module.cpp bookmark_item.cpp
 konq_sidebartree_bookmarks_la_LDFLAGS = $(all_libraries) -module $(KDE_PLUGIN)
-konq_sidebartree_bookmarks_la_LIBADD = ../../libkonqsidebarplugin.la ../libkonq_sidebar_tree.la
+konq_sidebartree_bookmarks_la_LIBADD = $(top_builddir)/konqueror/sidebar/libkonqsidebarplugin.la $(top_builddir)/konqueror/sidebar/trees/libkonq_sidebar_tree.la
 
diff -uNbr konqueror/sidebar/trees/dirtree_module/Makefile.am konqueror/sidebar/trees/dirtree_module/Makefile.am
--- konqueror/sidebar/trees/dirtree_module/Makefile.am	Thu Mar  7 20:16:53 2002
+++ konqueror/sidebar/trees/dirtree_module/Makefile.am	Thu Mar 13 22:51:58 2003
@@ -5,6 +5,6 @@
 METASOURCES = AUTO
 konq_sidebartree_dirtree_la_SOURCES = dirtree_module.cpp dirtree_item.cpp
 konq_sidebartree_dirtree_la_LDFLAGS = $(all_libraries) -module -avoid-version -no-undefined
-konq_sidebartree_dirtree_la_LIBADD = ../../libkonqsidebarplugin.la ../libkonq_sidebar_tree.la
+konq_sidebartree_dirtree_la_LIBADD = $(top_builddir)/konqueror/sidebar/libkonqsidebarplugin.la $(top_builddir)/konqueror/sidebar/trees/libkonq_sidebar_tree.la
 
 
diff -uNbr konqueror/sidebar/trees/history_module/Makefile.am konqueror/sidebar/trees/history_module/Makefile.am
--- konqueror/sidebar/trees/history_module/Makefile.am	Sun Sep 15 17:08:53 2002
+++ konqueror/sidebar/trees/history_module/Makefile.am	Thu Mar 13 22:51:58 2003
@@ -7,7 +7,7 @@
 konq_sidebartree_history_la_SOURCES = history_module.cpp history_item.cpp \
 	history_settings.cpp history_settings.skel
 konq_sidebartree_history_la_LDFLAGS = $(all_libraries) -module $(KDE_PLUGIN)
-konq_sidebartree_history_la_LIBADD =  ../../libkonqsidebarplugin.la ../libkonq_sidebar_tree.la
+konq_sidebartree_history_la_LIBADD =  $(top_builddir)/konqueror/sidebar/libkonqsidebarplugin.la $(top_builddir)/konqueror/sidebar/trees/libkonq_sidebar_tree.la
 
 kcm_history_la_SOURCES = kcmhistory.cpp history_dlg.ui history_settings.cpp history_settings.skel
 kcm_history_la_LDFLAGS = $(all_libraries) -module -avoid-version -no-undefined
diff -uNbr konqueror/sidebar/trees/history_module/history_module.h konqueror/sidebar/trees/history_module/history_module.h
--- konqueror/sidebar/trees/history_module/history_module.h	Sun Sep 15 17:08:53 2002
+++ konqueror/sidebar/trees/history_module/history_module.h	Thu Mar 13 22:51:58 2003
@@ -53,8 +53,7 @@
     bool sortsByName() const { return m_sortsByName; }
 
     static QString groupForURL( const KURL& url ) {
-	static const QString& misc = KGlobal::staticQString(i18n("Miscellaneous"));
-	return url.host().isEmpty() ? misc : url.host();
+	return url.host().isEmpty() ? KGlobal::staticQString(i18n("Miscellaneous")) : url.host();
     }
 
 public slots:
diff -uNbr konsole/konsole/Makefile.am konsole/konsole/Makefile.am
--- konsole/konsole/Makefile.am	Thu Jan  2 23:43:59 2003
+++ konsole/konsole/Makefile.am	Thu Mar 13 22:51:59 2003
@@ -12,13 +12,12 @@
 
 # you can add here more. This one gets installed
 bin_PROGRAMS = 	konsole konsole_grantpty kwrited #kcmkonsole
-lib_LTLIBRARIES = kwrited.la konsole.la
+lib_LTLIBRARIES = libkonsolepart_shared.la libkonsolepart.la libkwrited_main.la kwrited.la libkonsole_main.la konsole.la
 
 # libkonsolepart is a part, but konsole.la links directly to it, so we can't
 # install it under kde_module
 
-kde_module_LTLIBRARIES = libkonsolepart.la
-libkonsolepart_la_SOURCES = TEPty.cpp BlockArray.cpp konsole_part.cpp \
+libkonsolepart_shared_la_SOURCES = TEPty.cpp BlockArray.cpp konsole_part.cpp \
 	schema.cpp \
 	session.cpp \
 	TEWidget.cpp \
@@ -29,33 +28,58 @@
 	keytrans.cpp \
 	konsoleiface.skel \
         sessioniface.skel
+libkonsolepart_shared_la_LDFLAGS = $(all_libraries) $(KDE_RPATH) -avoid-version
+libkonsolepart_shared_la_LIBADD = $(LIBUTIL) $(XTESTLIB) $(LIB_KPARTS) $(LIB_QT) -lkdecore -lDCOP -lkdeui -lkio
 
-libkonsolepart_la_LDFLAGS = $(all_libraries) $(KDE_PLUGIN)
-libkonsolepart_la_LIBADD = $(LIBUTIL) $(XTESTLIB) $(LIB_KPARTS)
+libkonsolepart_la_SOURCES = dummy.cpp
+libkonsolepart_la_LDFLAGS = $(all_libraries) $(KDE_RPATH) -module -avoid-version
+libkonsolepart_la_LIBADD  = libkonsolepart_shared.la
+
+dummy.cpp:
+	echo > dummy.cpp
 
 # kwrited kdeinit module
-kwrited_la_SOURCES = kwrited.cpp
-kwrited_la_LIBADD  = libkonsolepart.la
-kwrited_la_LDFLAGS = $(all_libraries) -module -avoid-version
+libkwrited_main_la_SOURCES = kwrited.cpp
+libkwrited_main_la_LDFLAGS = $(all_libraries) -avoid-version
+libkwrited_main_la_LIBADD = $(LIB_KPARTS) $(LIB_QT) -lkdecore -lDCOP libkonsolepart_shared.la
+
+kwrited_la_SOURCES = kwrited_la_main.cpp
+kwrited_la_LDFLAGS = $(all_libraries) -avoid-version -module
+kwrited_la_LIBADD  = libkwrited_main.la
+
+kwrited_la_main.cpp: stub_main.cpp
+	cat stub_main.cpp > kwrited_la_main.cpp
 
 # kwrited executable
-kwrited_SOURCES	= dummy.cpp
-kwrited_LDADD   = kwrited.la 
+kwrited_SOURCES	= kwrited_main.cpp
+kwrited_LDADD   = libkwrited_main.la
 kwrited_LDFLAGS = $(all_libraries) $(KDE_RPATH)
 
+kwrited_main.cpp: stub_main.cpp
+	cat stub_main.cpp > kwrited_main.cpp
 
 # konsole kdeinit module
-konsole_la_SOURCES = TEPty.cpp BlockArray.cpp main.cpp konsole.cpp schema.cpp session.cpp TEWidget.cpp TEmuVt102.cpp \
+libkonsole_main_la_SOURCES = TEPty.cpp BlockArray.cpp main.cpp konsole.cpp schema.cpp session.cpp TEWidget.cpp TEmuVt102.cpp \
      TEScreen.cpp TEmulation.cpp TEHistory.cpp keytrans.cpp konsoleiface.skel sessioniface.skel \
      konsole_wcwidth.cpp konsolebookmarkhandler.cpp konsolebookmarkmenu.cpp konsole_child.cpp
-konsole_la_LDFLAGS = $(all_libraries) -module -avoid-version
-konsole_la_LIBADD = $(LIB_KDEUI) $(LIB_KIO) $(LIBUTIL) $(XTESTLIB)
+libkonsole_main_la_LDFLAGS = $(all_libraries) -avoid-version
+libkonsole_main_la_LIBADD = $(LIB_KDEUI) $(LIB_KIO) $(LIBUTIL) $(XTESTLIB) $(LIB_QT) -lkdecore -lDCOP
+
+konsole_la_SOURCES = konsole_la_main.cpp
+konsole_la_LDFLAGS = $(all_libraries) -avoid-version -module
+konsole_la_LIBADD  = libkonsole_main.la
+
+konsole_la_main.cpp: stub_main.cpp
+	cat stub_main.cpp > konsole_la_main.cpp
 
 # konsole executable
-konsole_SOURCES = dummy.cpp
-konsole_LDADD = konsole.la $(LIB_KIO)
+konsole_SOURCES = konsole_main.cpp
+konsole_LDADD = libkonsole_main.la
 konsole_LDFLAGS = $(all_libraries) $(KDE_RPATH)
 
+konsole_main.cpp: stub_main.cpp
+	cat stub_main.cpp > konsole_main.cpp
+
 # kcmkonsole_SOURCES = kcmkonsole.cpp schema.cpp
 # kcmkonsole_LDADD   = $(LIB_KDEUI)
 # kcmkonsole_LDFLAGS = $(all_libraries) $(KDE_RPATH)
@@ -97,9 +121,6 @@
 	$(XGETTEXT) rc.cpp *.cpp -o $(podir)/konsole.pot
 	rm -f schemas.cpp
 	rm -f tips.cpp
-
-dummy.cpp:
-	echo > dummy.cpp
 
 # setting up x-application/konsole as a special mimetype
 mimedir = $(kde_mimedir)/application
diff -uNbr konsole/konsole/konsole_grantpty.c konsole/konsole/konsole_grantpty.c
--- konsole/konsole/konsole_grantpty.c	Sun Sep 15 17:08:53 2002
+++ konsole/konsole/konsole_grantpty.c	Thu Mar 13 22:51:59 2003
@@ -45,6 +45,13 @@
 
 int main (int argc, char *argv[])
 {
+
+  if (strcmp(getenv("DEBUG_ME"), "sleepinmain") == 0)
+  {
+    fprintf(stderr, "My PID is %d\n", (int) getpid());
+    kill(getpid(), SIGSTOP);
+  }
+
   char*         pty;
   struct stat   st;
   struct group* p;
diff -uNbr konsole/konsole/kwrited.cpp konsole/konsole/kwrited.cpp
--- konsole/konsole/kwrited.cpp	Sat Oct 26 18:06:56 2002
+++ konsole/konsole/kwrited.cpp	Thu Mar 13 22:51:59 2003
@@ -88,7 +88,9 @@
     ::exit(0);
 }
 
-int main(int argc, char* argv[])
+extern "C" int kdemain(int, char**);
+
+int kdemain(int argc, char* argv[])
 {
   KLocale::setMainCatalogue("konsole");
   KCmdLineArgs::init(argc, argv, "kwrited",
diff -uNbr konsole/konsole/main.cpp konsole/konsole/main.cpp
--- konsole/konsole/main.cpp	Sun Sep 15 17:08:53 2002
+++ konsole/konsole/main.cpp	Thu Mar 13 22:51:59 2003
@@ -125,7 +125,8 @@
 
 
 /* --| main |------------------------------------------------------ */
-int main(int argc, char* argv[])
+extern "C" kdemain(int, char**);
+int kdemain(int argc, char** argv)
 {
   setgid(getgid()); setuid(getuid()); // drop privileges
 
diff -uNbr konsole/konsole/stub_main.cpp konsole/konsole/stub_main.cpp
--- konsole/konsole/stub_main.cpp	Wed Dec 31 19:00:00 1969
+++ konsole/konsole/stub_main.cpp	Thu Mar 13 22:51:59 2003
@@ -0,0 +1,28 @@
+/*
+ *
+ * Copyright (c) 2001 Nick Hudson <skrll@netbsd.org>
+ *
+ * Permission is hereby granted, free of charge, to any person obtaining a copy
+ * of this software and associated documentation files (the "Software"), to deal
+ * in the Software without restriction, including without limitation the rights
+ * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
+ * copies of the Software, and to permit persons to whom the Software is
+ * furnished to do so, subject to the following conditions:
+ *
+ * The above copyright notice and this permission notice shall be included in
+ * all copies or substantial portions of the Software.
+ *
+ * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
+ * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
+ * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.  IN NO EVENT SHALL THE
+ * AUTHORS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN
+ * AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN
+ * CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
+ */
+extern "C" int kdemain(int, char* []);
+
+int main( int argc, char* argv[] )
+{
+        return kdemain(argc, argv);
+}
+
diff -uNbr ksmserver/Makefile.am ksmserver/Makefile.am
--- ksmserver/Makefile.am	Mon Jul  1 14:54:12 2002
+++ ksmserver/Makefile.am	Thu Mar 13 22:51:59 2003
@@ -20,18 +20,28 @@
 INCLUDES=  $(all_includes)
 
 bin_PROGRAMS = ksmserver
-lib_LTLIBRARIES = ksmserver.la
+lib_LTLIBRARIES = ksmserver.la libksmserver_main.la
 noinst_HEADERS = global.h server.h shutdown.h
 
-ksmserver_la_METASOURCES = AUTO
+libksmserver_main_la_METASOURCES = AUTO
 # Order is important for --enable-final!
-ksmserver_la_SOURCES = main.cpp server.cpp shutdown.cpp KSMServerInterface.skel
-ksmserver_SOURCES = dummy.cpp
+libksmserver_main_la_SOURCES = main.cpp server.cpp shutdown.cpp KSMServerInterface.skel
+libksmserver_main_la_LDFLAGS = $(all_libraries) -avoid-version $(QT_LDFLAGS)
+libksmserver_main_la_LIBADD = $(LIB_KDEUI) $(LIB_QT) -lkdecore -lDCOP
 
+ksmserver_la_SOURCES = ksmserver_la_main.cpp
 ksmserver_la_LDFLAGS = $(all_libraries) -avoid-version -module
+ksmserver_la_LIBADD  = libksmserver_main.la
+
+ksmserver_la_main.cpp: stub_main.cpp
+	cat stub_main.cpp > ksmserver_la_main.cpp
+
+ksmserver_SOURCES = ksmserver_main.cpp
 ksmserver_LDFLAGS = $(all_libraries) $(KDE_RPATH)
-ksmserver_la_LIBADD = $(LIB_KDEUI)
-ksmserver_LDADD = ksmserver.la
+ksmserver_LDADD   = libksmserver_main.la
+
+ksmserver_main.cpp: stub_main.cpp
+	cat stub_main.cpp > ksmserver_main.cpp
 
 picsdir = $(kde_datadir)/ksmserver/pics
 pics_DATA = shutdownkonq.png
@@ -47,6 +57,3 @@
 
 messages:
 	$(XGETTEXT) *.cpp -o $(podir)/ksmserver.pot
-
-dummy.cpp:
-	echo > dummy.cpp
diff -uNbr ksmserver/main.cpp ksmserver/main.cpp
--- ksmserver/main.cpp	Sun Sep 15 17:08:53 2002
+++ ksmserver/main.cpp	Thu Mar 13 22:51:59 2003
@@ -159,7 +159,8 @@
   }
 }
 
-int main( int argc, char* argv[] )
+extern "C" int kdemain(int, char**);
+int kdemain( int argc, char** argv )
 {
     sanity_check(argc, argv);
 
diff -uNbr ksmserver/stub_main.cpp ksmserver/stub_main.cpp
--- ksmserver/stub_main.cpp	Wed Dec 31 19:00:00 1969
+++ ksmserver/stub_main.cpp	Thu Mar 13 22:51:59 2003
@@ -0,0 +1,28 @@
+/*
+ *
+ * Copyright (c) 2001 Nick Hudson <skrll@netbsd.org>
+ *
+ * Permission is hereby granted, free of charge, to any person obtaining a copy
+ * of this software and associated documentation files (the "Software"), to deal
+ * in the Software without restriction, including without limitation the rights
+ * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
+ * copies of the Software, and to permit persons to whom the Software is
+ * furnished to do so, subject to the following conditions:
+ *
+ * The above copyright notice and this permission notice shall be included in
+ * all copies or substantial portions of the Software.
+ *
+ * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
+ * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
+ * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.  IN NO EVENT SHALL THE
+ * AUTHORS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN
+ * AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN
+ * CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
+ */
+extern "C" int kdemain(int, char* []);
+
+int main( int argc, char* argv[] )
+{
+        return kdemain(argc, argv);
+}
+
diff -uNbr ksysguard/configure.in.in ksysguard/configure.in.in
--- ksysguard/configure.in.in	Sat Oct 26 18:07:10 2002
+++ ksysguard/configure.in.in	Thu Mar 13 22:51:59 2003
@@ -1,3 +1,5 @@
+DO_NOT_COMPILE="$DO_NOT_COMPILE ksysguard"
+
 dnl Check whether ksysguardd can run; 
 AC_MSG_CHECKING([if ksysguardd can be compiled])
 case "$host" in 
diff -uNbr ksysguard/gui/SensorDisplayLib/SensorDisplay.cc ksysguard/gui/SensorDisplayLib/SensorDisplay.cc
--- ksysguard/gui/SensorDisplayLib/SensorDisplay.cc	Mon Sep 16 10:52:11 2002
+++ ksysguard/gui/SensorDisplayLib/SensorDisplay.cc	Thu Mar 13 22:51:59 2003
@@ -62,7 +62,6 @@
 	pausedWhileHidden = false;
 
 	timerOn();
-	QWhatsThis::add(this, "dummy");
 
 	frame = new QGroupBox(2, Qt::Vertical, "", this, "displayFrame"); 
 	Q_CHECK_PTR(frame);
diff -uNbr ksysguard/gui/ksgrd/StyleEngine.h ksysguard/gui/ksgrd/StyleEngine.h
--- ksysguard/gui/ksgrd/StyleEngine.h	Fri Dec 28 04:47:25 2001
+++ ksysguard/gui/ksgrd/StyleEngine.h	Thu Mar 13 22:51:59 2003
@@ -68,11 +68,12 @@
 	}
 	const QColor& getSensorColor(uint i)
 	{
-		static QColor dummy;
-		if (i < sensorColors.count())
+		if (i < sensorColors.count()) {
 			return *(sensorColors.at(i));
-		else
+		} else {
+			QColor dummy;
 			return dummy;
+		}
 	}
 	uint getSensorColorCount() const
 	{
diff -uNbr ktip/tips ktip/tips
--- ktip/tips	Mon Oct 28 04:55:58 2002
+++ ktip/tips	Thu Mar 13 22:51:59 2003
@@ -704,20 +704,6 @@
 </tip>
 
 
-<tip category="Win2Unix">
-<html>
-<p>
-You might wonder why there are very few (if any) files whose
-names end in <code>.exe</code> or <code>.bat</code> on UNIX
-systems. This is because filenames on UNIX do not need an
-extension. Executable files in KDE are represented by the gear icon
-in Konqueror. In the Konsole window, they are often colored red 
-(depending on your settings).
-</p>
-<p align="right"><em>Contributed by Carsten Niehaus</em></p>
-</html>
-</tip>
-
 <tip category="KDE|Win2Unix|General">
 <html>
 <p>
diff -uNbr kwin/Makefile.am kwin/Makefile.am
--- kwin/Makefile.am	Mon Jul  1 14:54:15 2002
+++ kwin/Makefile.am	Thu Mar 13 22:51:59 2003
@@ -3,14 +3,21 @@
 SUBDIRS = . kcmkwin pics clients
 
 bin_PROGRAMS = kwin
-lib_LTLIBRARIES = kwin.la
+lib_LTLIBRARIES = kwin.la libkwin_main.la
 
 # workspace.cpp has to be first in order not to break --enable-final
-kwin_la_SOURCES = workspace.cpp placement.cpp atoms.cpp  client.cpp main.cpp \
+libkwin_main_la_SOURCES = workspace.cpp placement.cpp atoms.cpp  client.cpp main.cpp \
 	popupinfo.cpp tabbox.cpp options.cpp plugins.cpp events.cpp KWinInterface.skel \
 	killwindow.cpp kwinbutton.cpp
-kwin_la_LIBADD = $(LIB_KDEUI) $(LIBXINERAMA)
-kwin_la_LDFLAGS = $(all_libraries) -module -avoid-version
+libkwin_main_la_LIBADD = $(LIB_KDEUI) $(LIBXINERAMA) $(LIB_QT) -lkdecore -lDCOP
+libkwin_main_la_LDFLAGS = $(all_libraries) -avoid-version $(QT_LDFLAGS)
+
+kwin_la_SOURCES = kwin_la_main.cpp
+kwin_la_LIBADD  = libkwin_main.la
+kwin_la_LDFLAGS = $(all_libraries) -avoid-version -module
+
+kwin_la_main.cpp: kwin_main.cpp
+	cat kwin_main.cpp > kwin_la_main.cpp
 
 include_HEADERS = KWinInterface.h
 
@@ -18,7 +25,7 @@
 kwininclude_HEADERS = options.h client.h workspace.h kwinbutton.h
 
 kwin_SOURCES = kwin_main.cpp
-kwin_LDADD = kwin.la
+kwin_LDADD = libkwin_main.la
 kwin_LDFLAGS = $(all_libraries) $(KDE_RPATH)
 
 KDE_ICON = kwin
diff -uNbr kwin/clients/b2/Makefile.am kwin/clients/b2/Makefile.am
--- kwin/clients/b2/Makefile.am	Thu Mar  7 20:16:57 2002
+++ kwin/clients/b2/Makefile.am	Thu Mar 13 22:51:59 2003
@@ -6,7 +6,7 @@
 kde_module_LTLIBRARIES = kwin_b2.la
 
 kwin_b2_la_SOURCES = b2client.cpp
-kwin_b2_la_LIBADD = ../../kwin.la
+kwin_b2_la_LIBADD = ../../libkwin_main.la
 kwin_b2_la_LDFLAGS = $(all_libraries) $(KDE_PLUGIN) -module
 
 METASOURCES = AUTO
diff -uNbr kwin/clients/default/Makefile.am kwin/clients/default/Makefile.am
--- kwin/clients/default/Makefile.am	Mon Nov  4 10:45:56 2002
+++ kwin/clients/default/Makefile.am	Thu Mar 13 22:51:59 2003
@@ -6,7 +6,7 @@
 kde_module_LTLIBRARIES = kwin_default.la
 
 kwin_default_la_SOURCES = kdedefault.cpp
-kwin_default_la_LIBADD = ../../kwin.la
+kwin_default_la_LIBADD = ../../libkwin_main.la
 kwin_default_la_LDFLAGS = $(all_libraries) $(KDE_PLUGIN) -module
 
 METASOURCES = AUTO
diff -uNbr kwin/clients/icewm/Makefile.am kwin/clients/icewm/Makefile.am
--- kwin/clients/icewm/Makefile.am	Thu Mar  7 20:16:57 2002
+++ kwin/clients/icewm/Makefile.am	Thu Mar 13 22:51:59 2003
@@ -5,7 +5,7 @@
 kde_module_LTLIBRARIES = kwin_icewm.la
 
 kwin_icewm_la_SOURCES = icewm.cpp 
-kwin_icewm_la_LIBADD = ../../kwin.la
+kwin_icewm_la_LIBADD = ../../libkwin_main.la
 kwin_icewm_la_LDFLAGS = $(all_libraries) $(KDE_PLUGIN) -module
 
 METASOURCES = AUTO
diff -uNbr kwin/clients/kde1/Makefile.am kwin/clients/kde1/Makefile.am
--- kwin/clients/kde1/Makefile.am	Thu Mar  7 20:16:58 2002
+++ kwin/clients/kde1/Makefile.am	Thu Mar 13 22:51:59 2003
@@ -4,7 +4,7 @@
 kde_module_LTLIBRARIES = kwin_kde1.la
 
 kwin_kde1_la_SOURCES = kde1client.cpp
-kwin_kde1_la_LIBADD = ../../kwin.la
+kwin_kde1_la_LIBADD = ../../libkwin_main.la
 kwin_kde1_la_LDFLAGS = $(all_libraries) $(KDE_PLUGIN) -module
 
 METASOURCES = AUTO
diff -uNbr kwin/clients/keramik/Makefile.am kwin/clients/keramik/Makefile.am
--- kwin/clients/keramik/Makefile.am	Sun Sep 15 17:08:55 2002
+++ kwin/clients/keramik/Makefile.am	Thu Mar 13 22:51:59 2003
@@ -13,7 +13,7 @@
 kde_module_LTLIBRARIES    = kwin_keramik.la
 
 kwin_keramik_la_SOURCES   = keramik.cpp
-kwin_keramik_la_LIBADD    = ../../kwin.la
+kwin_keramik_la_LIBADD    = ../../libkwin_main.la
 kwin_keramik_la_COMPILE_FIRST = tiles.h
 kwin_keramik_la_LDFLAGS   = $(all_libraries) $(KDE_PLUGIN) -module
 
diff -uNbr kwin/clients/kstep/Makefile.am kwin/clients/kstep/Makefile.am
--- kwin/clients/kstep/Makefile.am	Thu Mar  7 20:16:58 2002
+++ kwin/clients/kstep/Makefile.am	Thu Mar 13 22:51:59 2003
@@ -4,7 +4,7 @@
 kde_module_LTLIBRARIES = kwin_kstep.la
 
 kwin_kstep_la_SOURCES = nextclient.cpp
-kwin_kstep_la_LIBADD = ../../kwin.la
+kwin_kstep_la_LIBADD = ../../libkwin_main.la
 kwin_kstep_la_LDFLAGS = $(all_libraries) $(KDE_PLUGIN) -module
 
 METASOURCES = AUTO
diff -uNbr kwin/clients/kwmtheme/Makefile.am kwin/clients/kwmtheme/Makefile.am
--- kwin/clients/kwmtheme/Makefile.am	Thu Mar  7 20:16:58 2002
+++ kwin/clients/kwmtheme/Makefile.am	Thu Mar 13 22:51:59 2003
@@ -4,7 +4,7 @@
 kde_module_LTLIBRARIES = kwin_kwmtheme.la
 
 kwin_kwmtheme_la_SOURCES = kwmthemeclient.cpp
-kwin_kwmtheme_la_LIBADD = ../../kwin.la
+kwin_kwmtheme_la_LIBADD = ../../libkwin_main.la
 kwin_kwmtheme_la_LDFLAGS = $(all_libraries) $(KDE_PLUGIN) -module
 
 METASOURCES = AUTO
diff -uNbr kwin/clients/laptop/Makefile.am kwin/clients/laptop/Makefile.am
--- kwin/clients/laptop/Makefile.am	Thu Mar  7 20:16:58 2002
+++ kwin/clients/laptop/Makefile.am	Thu Mar 13 22:51:59 2003
@@ -4,7 +4,7 @@
 kde_module_LTLIBRARIES = kwin_laptop.la
 
 kwin_laptop_la_SOURCES = laptopclient.cpp
-kwin_laptop_la_LIBADD = ../../kwin.la
+kwin_laptop_la_LIBADD = ../../libkwin_main.la
 kwin_laptop_la_LDFLAGS = $(all_libraries) $(KDE_PLUGIN) -module
 
 METASOURCES = AUTO
diff -uNbr kwin/clients/modernsystem/Makefile.am kwin/clients/modernsystem/Makefile.am
--- kwin/clients/modernsystem/Makefile.am	Thu Mar  7 20:16:58 2002
+++ kwin/clients/modernsystem/Makefile.am	Thu Mar 13 22:51:59 2003
@@ -7,7 +7,7 @@
 kde_module_LTLIBRARIES = kwin_modernsys.la
 
 kwin_modernsys_la_SOURCES = modernsys.cpp
-kwin_modernsys_la_LIBADD = ../../kwin.la
+kwin_modernsys_la_LIBADD = ../../libkwin_main.la
 kwin_modernsys_la_LDFLAGS = $(all_libraries) $(KDE_PLUGIN) -module
 
 METASOURCES = AUTO
diff -uNbr kwin/clients/quartz/Makefile.am kwin/clients/quartz/Makefile.am
--- kwin/clients/quartz/Makefile.am	Thu Mar  7 20:16:58 2002
+++ kwin/clients/quartz/Makefile.am	Thu Mar 13 22:51:59 2003
@@ -6,7 +6,7 @@
 kde_module_LTLIBRARIES = kwin_quartz.la
 
 kwin_quartz_la_SOURCES = quartz.cpp
-kwin_quartz_la_LIBADD = ../../kwin.la
+kwin_quartz_la_LIBADD = ../../libkwin_main.la
 kwin_quartz_la_LDFLAGS = $(all_libraries) $(KDE_PLUGIN) -module
 
 METASOURCES = AUTO
diff -uNbr kwin/clients/redmond/Makefile.am kwin/clients/redmond/Makefile.am
--- kwin/clients/redmond/Makefile.am	Thu Mar  7 20:16:58 2002
+++ kwin/clients/redmond/Makefile.am	Thu Mar 13 22:51:59 2003
@@ -4,7 +4,7 @@
 kde_module_LTLIBRARIES = kwin_redmond.la
 
 kwin_redmond_la_SOURCES = redmond.cpp
-kwin_redmond_la_LIBADD = ../../kwin.la
+kwin_redmond_la_LIBADD = ../../libkwin_main.la
 kwin_redmond_la_LDFLAGS = $(all_libraries) $(KDE_PLUGIN) -module
 
 METASOURCES = AUTO
diff -uNbr kwin/clients/riscos/Makefile.am kwin/clients/riscos/Makefile.am
--- kwin/clients/riscos/Makefile.am	Thu Mar  7 20:16:58 2002
+++ kwin/clients/riscos/Makefile.am	Thu Mar 13 22:51:59 2003
@@ -12,7 +12,7 @@
 StickyButton.cpp \
 HelpButton.cpp \
 Static.cpp
-kwin_riscos_la_LIBADD = ../../kwin.la
+kwin_riscos_la_LIBADD = ../../libkwin_main.la
 kwin_riscos_la_LDFLAGS = $(all_libraries) $(KDE_PLUGIN) -module
 
 METASOURCES = AUTO
diff -uNbr kwin/clients/system/Makefile.am kwin/clients/system/Makefile.am
--- kwin/clients/system/Makefile.am	Thu Mar  7 20:16:58 2002
+++ kwin/clients/system/Makefile.am	Thu Mar 13 22:51:59 2003
@@ -4,7 +4,7 @@
 kde_module_LTLIBRARIES = kwin_system.la
 
 kwin_system_la_SOURCES = systemclient.cpp
-kwin_system_la_LIBADD = ../../kwin.la
+kwin_system_la_LIBADD = ../../libkwin_main.la
 kwin_system_la_LDFLAGS = $(all_libraries) $(KDE_PLUGIN) -module
 
 METASOURCES = AUTO
diff -uNbr kwin/clients/web/Makefile.am kwin/clients/web/Makefile.am
--- kwin/clients/web/Makefile.am	Thu Mar  7 20:16:58 2002
+++ kwin/clients/web/Makefile.am	Thu Mar 13 22:51:59 2003
@@ -21,7 +21,7 @@
   WebButtonMaximize.h \
   WebButtonSticky.h
 
-kwin_web_la_LIBADD      = ../../kwin.la
+kwin_web_la_LIBADD      = ../../libkwin_main.la
 kwin_web_la_LDFLAGS     = $(all_libraries) $(KDE_PLUGIN) -module
 METASOURCES               = AUTO
 
diff -uNbr kwin/kcmkwin/kwinoptions/Makefile.am kwin/kcmkwin/kwinoptions/Makefile.am
--- kwin/kcmkwin/kwinoptions/Makefile.am	Mon Sep 16 20:11:08 2002
+++ kwin/kcmkwin/kwinoptions/Makefile.am	Thu Mar 13 22:51:59 2003
@@ -10,7 +10,7 @@
 kcm_kwinoptions_la_LDFLAGS = -module -avoid-version $(all_libraries) -no-undefined
 kcm_kwinoptions_la_LIBADD = $(LIB_KDEUI)
 
-noinst_HEADERS = windows.h mouse.h 
+noinst_HEADERS = windows.h mouse.h main.h
 
 messages:
 	$(XGETTEXT) *.cpp -o $(podir)/kcmkwm.pot
diff -uNbr kxkb/Makefile.am kxkb/Makefile.am
--- kxkb/Makefile.am	Sat Oct 26 18:07:27 2002
+++ kxkb/Makefile.am	Thu Mar 13 22:51:59 2003
@@ -7,20 +7,30 @@
 
 bin_PROGRAMS = kxkb
 
-kxkb_SOURCES = dummy.cpp
+kxkb_SOURCES = kxkb_main.cpp
 kxkb_LDFLAGS = $(all_libraries) $(KDE_RPATH)
-kxkb_LDADD = kxkb.la -lxkbfile
+kxkb_LDADD = libkxkb_main.la
 
-lib_LTLIBRARIES = kxkb.la
+kxkb_main.cpp: stub_main.cpp
+	cat stub_main.cpp > kxkb_main.cpp
+
+lib_LTLIBRARIES = kxkb.la libkxkb_main.la
 kde_module_LTLIBRARIES = kcm_keyboard.la
 
 kcm_keyboard_la_SOURCES = rules.cpp kcmlayout.cpp pixmap.cpp kcmmisc.cpp kcmmiscwidget.ui
 kcm_keyboard_la_LDFLAGS  = $(all_libraries) -module -avoid-version -no-undefined
 kcm_keyboard_la_LIBADD = $(XTESTLIB) $(LIB_KIO) -lxkbfile
 
-kxkb_la_SOURCES = kxkb.cpp rules.cpp extension.cpp pixmap.cpp
-kxkb_la_LDFLAGS = $(all_libraries) -module -avoid-version
-kxkb_la_LIBADD = -lX11 -lXext $(LIB_KDEUI) -lxkbfile
+libkxkb_main_la_SOURCES = kxkb.cpp rules.cpp extension.cpp pixmap.cpp
+libkxkb_main_la_LDFLAGS = $(all_libraries) -avoid-version
+libkxkb_main_la_LIBADD = $(LIB_X11) $(LIB_XEXT) $(LIB_KDEUI) -lxkbfile $(LIB_QT) -lDCOP -lkdecore
+
+kxkb_la_SOURCES = kxkb_la_main.cpp
+kxkb_la_LDFLAGS = $(all_libraries) -avoid-version -module
+kxkb_la_LIBADD = libkxkb_main.la
+
+kxkb_la_main.cpp: stub_main.cpp
+	cat stub_main.cpp > kxkb_la_main.cpp
 
 data_DATA = keyboard.desktop
 datadir = $(kde_appsdir)/Settings/Peripherals
@@ -37,6 +47,3 @@
 messages: rc.cpp
 	$(XGETTEXT) $(kxkb_la_SOURCES) kxkbbindings.cpp -o $(podir)/kxkb.pot
 	$(XGETTEXT) rules.cpp kcmlayout.cpp pixmap.cpp kcmmisc.cpp rc.cpp kxkbbindings.cpp -o $(podir)/kcmlayout.pot 
-
-dummy.cpp:
-	echo > dummy.cpp
diff -uNbr kxkb/kxkb.cpp kxkb/kxkb.cpp
--- kxkb/kxkb.cpp	Sat Oct 26 18:07:27 2002
+++ kxkb/kxkb.cpp	Thu Mar 13 22:51:59 2003
@@ -503,7 +503,8 @@
 const char * DESCRIPTION =
   I18N_NOOP("A utility to switch keyboard maps.");
 
-int main(int argc, char *argv[])
+extern "C" int kdemain(int, char**);
+int kdemain(int argc, char **argv)
 {
     KAboutData about("kxkb", I18N_NOOP("KDE Keyboard Tool"), "0.8",
                      DESCRIPTION, KAboutData::License_LGPL,
diff -uNbr kxkb/stub_main.cpp kxkb/stub_main.cpp
--- kxkb/stub_main.cpp	Wed Dec 31 19:00:00 1969
+++ kxkb/stub_main.cpp	Thu Mar 13 22:51:59 2003
@@ -0,0 +1,28 @@
+/*
+ *
+ * Copyright (c) 2001 Nick Hudson <skrll@netbsd.org>
+ *
+ * Permission is hereby granted, free of charge, to any person obtaining a copy
+ * of this software and associated documentation files (the "Software"), to deal
+ * in the Software without restriction, including without limitation the rights
+ * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
+ * copies of the Software, and to permit persons to whom the Software is
+ * furnished to do so, subject to the following conditions:
+ *
+ * The above copyright notice and this permission notice shall be included in
+ * all copies or substantial portions of the Software.
+ *
+ * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
+ * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
+ * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.  IN NO EVENT SHALL THE
+ * AUTHORS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN
+ * AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN
+ * CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
+ */
+extern "C" int kdemain(int, char* []);
+
+int main( int argc, char* argv[] )
+{
+        return kdemain(argc, argv);
+}
+
diff -uNbr libkonq/favicons/Makefile.am libkonq/favicons/Makefile.am
--- libkonq/favicons/Makefile.am	Mon Mar 18 07:40:34 2002
+++ libkonq/favicons/Makefile.am	Thu Mar 13 22:51:59 2003
@@ -2,8 +2,8 @@
 
 INCLUDES = $(all_includes)
 kded_favicons_la_SOURCES = favicons.cpp favicons.skel
-kded_favicons_la_LDFLAGS = $(all_libraries) -module -avoid-version
-kded_favicons_la_LIBADD = $(LIB_KSYCOCA)
+kded_favicons_la_LDFLAGS = $(all_libraries) -module -avoid-version $(QT_LDFLAGS) -undefined suppress -flat_namespace
+kded_favicons_la_LIBADD = $(LIB_KSYCOCA) $(LIB_QT) $(LIB_KDECORE)
 
 METASOURCES = AUTO
 
diff -uNbr nsplugins/pluginscan.cpp nsplugins/pluginscan.cpp
--- nsplugins/pluginscan.cpp	Sat Oct 26 18:07:48 2002
+++ nsplugins/pluginscan.cpp	Thu Mar 13 22:51:59 2003
@@ -443,6 +443,7 @@
         paths.append("/usr/lib/netscape/plugins");
         paths.append("/usr/lib/netscape/plugins-libc5");
         paths.append("/usr/lib/netscape/plugins-libc6");
+        paths.append("@PREFIX@/lib/mozilla/plugins");
         paths.append("/usr/lib/mozilla/plugins");
         paths.append("$MOZILLA_HOME/plugins");
         config->writeEntry( "scanPaths", paths );
diff -uNbr startkde startkde
--- startkde	Sat Nov 30 12:58:15 2002
+++ startkde	Thu Mar 13 22:51:58 2003
@@ -34,6 +34,10 @@
 # people's heads. We use colours from the standard KDE palette for those with
 # palettised displays.
 
+# we have to unset this for Darwin since it will screw up KDE's dynamic-loading
+unset DYLD_FORCE_FLAT_NAMESPACE
+test -d "@PREFIX@" && export PATH="@PREFIX@/bin:${PATH}"
+
 test "$XDM_MANAGED" || bkg="-solid #C0C0C0"
 xsetroot -cursor_name left_ptr $bkg
 
@@ -110,6 +114,11 @@
     export GS_LIB
 fi
 
+# if we're in Apple's X11 and the native window manager is available, use that
+if test -z "$KDEWM" && test -x /usr/X11R6/bin/quartz-wm; then
+    KDEWM="/usr/X11R6/bin/quartz-wm"
+fi
+
 # Link "tmp" resource to directory in /tmp
 # Creates a directory /tmp/kde-$USER and links $KDEHOME/tmp-$HOSTNAME to it.
 lnusertemp tmp >/dev/null
@@ -128,7 +137,11 @@
     # start only dcopserver, don't start whole kdeinit (takes too long)
     echo 'startkde: Running kpersonalizer...'  1>&2
     dcopserver
+    if test -n "$KDEWM"; then
+        $KDEWM &
+    else
     kwin &
+    fi
     kpersonalizer --before-session
     # handle kpersonalizer restarts (language change)
     while test $? -eq 1; do
@@ -139,7 +152,6 @@
     sleep 1
 fi
 
-# the splashscreen and progress indicator
 ksplash
 
 # We set LD_BIND_NOW to increase the efficiency of kdeinit.
