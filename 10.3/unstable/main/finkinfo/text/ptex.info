Info2: <<
Package: ptex%type_pkg[-nox]
Type: -nox (boolean)
Version: 3.1.9
# ptex-3.1.10-Beta3
Revision: 51
GCC: 3.3
Description: ASCII publishing TeX
Depends: %N-base (= %v-%r), texinfo, debianutils, texi2html, nkf
BuildDepends: <<
 libkpathsea4 (>= 3.0-6), t1lib5, libpng3 (>= 1:1.2.8-1), libwww, libncurses5,
 libjpeg, libiconv-dev, ptexenc,
 (%type_raw[-nox] = .)  gd2 (>= 2.0.33-1), 
 (%type_raw[-nox] = .) x11, 
 (%type_raw[-nox] = .) freetype219 (>= 2.2.1-3),
 (%type_raw[-nox] = .) openmotif3
<<
Conflicts: <<
 system-tetex, tetex, tetex-nox, ptex, ptex-nox,
 (%type_raw[-nox] = -nox) tetex-base (<= 2.0.2-24),
 (%type_raw[-nox] = -nox) ptex-base (<= 3.1.3-7)
<<
Replaces: <<
tetex, tetex-nox, ptex, ptex-nox,
 (%type_raw[-nox] = -nox) tetex-base (<= 2.0.2-24),
 (%type_raw[-nox] = -nox) ptex-base (<= 3.1.3-7)
<<
Provides: bundle-tetex
Recommends: detex, ifmslide, latex2html, pdfscreen, pdfslide, ppower4, tex4ht, texpower
Suggests: foiltex, latex2html-ja
Source: mirror:ctan:systems/unix/teTeX/3.0/distrib/tetex-src-3.0.tar.gz
Source-MD5: 944a4641e79e61043fdaf8f38ecbb4b3
#Source2: http://tutimura.ath.cx/~nob/tex/ptetex/ptetex3/ptetex3-20070304.tar.gz
Source2: http://fink.sodan.ecc.u-tokyo.ac.jp/~okayama/distfiles/ptetex3-20070304.tar.gz
Source2-MD5: 37b5a7f1cf1e21cdeb44eb3cab19ab38
Source3: http://fink.sodan.ecc.u-tokyo.ac.jp/~okayama/distfiles/ptexenc-0.91.tar.gz
Source3-MD5: adeb23894fb201a004a98a94adc7503b
Source4: http://fink.sodan.ecc.u-tokyo.ac.jp/~okayama/distfiles/utfsrc-1.9.5.4.zip
Source4-MD5: 3461345204c3762e910d0fb7a8a890dd
PatchScript: <<
 # Update ptexenc
 rm      ../ptetex3-20070304/archive/ptexenc-*.tar.gz
 tar zcf ../ptetex3-20070304/archive/ptexenc-0.91.tar.gz ../ptexenc-0.91

 # 1. -dNOKANJI option is not needed
 # 2. avoid conflict with the original tetex.patch
 # 3. install texmf/dvips/config/config.ps (deleted in ptex-texmf's PatchScript)
 # 4. not install psfonts_jp.map (for brandnew updmap)
 # 5. skip md5sum checks
 sed -i.bak \
  -e 's/-dNOKANJI //' \
  -e '/## use TEXMFMAIN/,/Makefile.in/d' \
  -e '/## disable installing/,/Makefile.in.tetex/s/^/#/' \
  -e '/## disable psfonts_jp.map/,/Makefile.in/s/^#//' \
  -e '/## post/,$d'                 ../ptetex3-20070304/2extract-src.sh

 # add screen size (handling for texmf/dvips/config/config.ps)
 # http://oku.edu.mie-u.ac.jp/~okumura/texfaq/qa/42978.html
 sed -n '/add screen size/,/^EOF/p' ../ptetex3-20070304/3extract-texmf.sh \
                                 >> ../ptetex3-20070304/2extract-src.sh
 echo "' \$SRC/texk/dvipsk/config.ps" \
                                 >> ../ptetex3-20070304/2extract-src.sh

 # not to extract teTeX src (already extracted) and use system's freetype2.
 echo "TEXSRC_EXTRACTED=../" >> ../my_option
 echo "SYSTEM_FREETYPE2=yes" >> ../my_option

 # extract pTeX src and apply patches of ptetex3
 (cd ../ptetex3-20070304 && ./2extract-src.sh) || exit

 # don't run mktexlsr, texlinks and fmtutil-sys.
 # (Run these commands in InstallScript and PostInstScript)
 perl -pi -e 's|\$\(scriptdir\)/mktexlsr|echo "Done."|' \
  texk/web2c/%{ni}/Makefile.in texk/web2c/%{ni}/jmpost/Makefile.in
 perl -pi -e 's|\$\(scriptdir\)/texlinks|echo "Done."|' \
  texk/web2c/%{ni}/Makefile.in texk/web2c/%{ni}/jmpost/Makefile.in
 perl -pi -e 's|\$\(scriptdir\)/fmtutil-sys.*|echo "Done."|' \
  texk/web2c/%{ni}/Makefile.in texk/web2c/%{ni}/jmpost/Makefile.in

 # unpack utf package (from 5macro.sh)
#unzip                ../ptetex3-20070304/macro/utfsrc.zip
 mv ../utfsrc .
 #patch -p1 -d utfsrc ../ptetex3-20070304/macro/utfsrc-speedup.patch
 chmod 644 utfsrc/readme.txt

 # apply the same patches in tetex.info
 sed 's|@PREFIX@|%p|g' < %a/tetex.patch | sed 's|@PACKAGE@|%n-%v-%r|g' | patch -p1
 perl -pi -e "s|hardcode_direct=yes|hardcode_direct=no|" texk/configure texk/kpathsea/configure utils/texinfo/configure 
 perl -pi -e 's,-flat_namespace -undefined suppress,-twolevel_namespace -undefined error,g' texk/configure texk/kpathsea/configure utils/texinfo/configure
 perl -pi -e 's,\*\.obj\),*.obj | *.dSYM),' texk/configure texk/kpathsea/configure utils/texinfo/configure
<<
SetCPPFLAGS:-I%p/lib/freetype219/include/freetype2 -I%p/lib/freetype219/include
SetLDFLAGS: -L%p/lib/freetype219/lib
NoSetMAKEFLAGS: true
SetMAKEFLAGS: -j1
ConfigureParams: <<
 --without-texi2html --without-texinfo --enable-shared \
 --datadir='${prefix}/share' --infodir='${prefix}/share/info' \
 --mandir='${prefix}/share/man' --disable-multiplatform --with-system-ncurses \
 --with-system-pnglib --with-system-t1lib --with-system-wwwlib \
 --with-system-zlib \
 --enable-freetype --enable-kanji-iconv --with-ptexenc=UTF8 \
 (%type_raw[-nox] = .) --with-system-gd 
 (%type_raw[-nox] = -nox) --without-x 
<<
CompileScript: <<
 # make teTeX and pTeX
 export PATH=%p/lib/freetype219/bin:${PATH} && ./configure %c && make

 # make utf package
 cd utfsrc && \
  PATH="../texk/web2c/ptex/.libs:../texk/web2c/.libs:${PATH}" ./makeutf
<<
InstallScript: <<
#!/bin/bash -ev
 make install prefix=%i texmf=%i/share/texmf

echo "Removing files that belong to the libkpathsea4 and ptexenc package..."

 rm -R %i/include
 rm -R %i/lib
 rm %i/share/info/kpathsea.info

echo "Setting up symlinks ..."
 export DYLD_LIBRARY_PATH="%b/texk/kpathsea/SHARED" PATH=%i/bin:$PATH TEXMFMAIN=%p/share/texmf-dist ; texlinks --cnffile %i/share/texmf/web2c/fmtutil.cnf --verbose %i/bin

echo "Creating a local texmf tree, and symlinking it into place ..."
 mkdir -p %i/etc/texmf.local
 %i/bin/mktexlsr %i/etc/texmf.local
 mkdir -p %i/share
 ln -s %p/etc/texmf.local %i/share/texmf-local

echo "Creating a VARTEXMF tree, including a fonts directory ..."
 mkdir -p %i/var/lib/texmf/fonts
 %i/bin/mktexlsr %i/var/lib/texmf

echo "Creating a TEXMFCONFIG tree ..."
 mkdir -p %i/etc/texmf-config
 %i/bin/mktexlsr %i/etc/texmf-config

echo "Removing the ls-R file, which is supplied in the tetex-texmf package ..."
 rm -f %i/share/texmf-dist/ls-R
 rm -f %i/share/texmf/ls-R

echo "Removing readlink, which is supplied in the debianutils package ..."
 rm -f %i/bin/readlink
 rm -f %i/share/man/man1/readlink.1

if [ "%type_raw[-nox]" == "." ]; then
echo "Preparing xdvi for the alternatives system ..."
 mv %i/bin/xdvi %i/bin/xdvik
 mv %i/share/man/man1/xdvi.1 %i/share/man/man1/xdvik.1
 mv %i/bin/xdvizilla %i/bin/xdvizillak
 mv %i/share/man/man1/xdvizilla.1 %i/share/man/man1/xdvizillak.1
fi

# install utf package
 install -m 755 -d           %i/share/texmf/ptex/platex/utf
 install -m 644 utfsrc/sty/* %i/share/texmf/ptex/platex/utf
 install -m 755 -d           %i/share/texmf/fonts/tfm/utf
 install -m 644 utfsrc/tfm/* %i/share/texmf/fonts/tfm/utf
 install -m 755 -d           %i/share/texmf/fonts/vf/utf
 install -m 644 utfsrc/vf/*  %i/share/texmf/fonts/vf/utf

# make font dirs and make links for apple's fonts
install -m 755 -d                %i/share/texmf/fonts/{opentype,truetype}
if [ "%type_raw[-nox]" == "." ]; then
 ln -s %p/lib/X11/fonts/appleotf %i/share/texmf/fonts/opentype
 ln -s %p/lib/X11/fonts/applettf %i/share/texmf/fonts/truetype
fi

# don't edit vfontmap, use updmap-sys instead.
if [ "%type_raw[-nox]" == "." ]; then
 cat <<-EOF > %i/share/texmf/xdvi/vfontmap || exit
	%%
	%% vfontmap -- Do NOT edit this file BY HAND!!
	%%
	%% An effective file is
	%% "%p/var/lib/texmf/fonts/map/xdvi/updmap/xdvi-ptex.map"
	%% which is generated by 'updmap-sys'.
	%%
	%% Use "updmap-sys --setoption xdviRml mincho-font"
	%% and "updmap-sys --setoption xdviGbm gothic-font".
	%%
	EOF
fi

# make links for convenience
ln -s dvips %i/bin/pdvips
if [ "%type_raw[-nox]" == "." ]; then
 ln -s xdvik %i/bin/pxdvi
fi
<<
DocFiles: <<
LICENSE.src:tetex-LICENSE.src README:tetex-README README.fink:tetex-README.fink
texk/web2c/%{ni}/COPYRIGHT texk/web2c/%{ni}/COPYRIGHT.jis
texk/web2c/%{ni}/README.txt
<<
RuntimeVars: PTEX_IN_FILTER: "%p/bin/nkf -j"
SplitOff: <<
 Package: %N-base
 Description: Base programs for a pTeX installation
 Depends: <<
  t1lib5-shlibs, libpng3-shlibs (>= 1:1.2.8-1), 
  libwww-bin, libncurses5-shlibs, ncurses,
  fink (>= 0.12.0-1), ptexenc-shlibs, ptex-texmf (>= 2.4-3),
  (%type_raw[-nox] = .) applesystemfonts,
  (%type_raw[-nox] = .) appleotffonts,
  (%type_raw[-nox] = -nox) ghostscript-nox, 
  (%type_raw[-nox] = .) ghostscript, 
  (%type_raw[-nox] = .) gd2-shlibs (>= 2.0.33-1), 
  (%type_raw[-nox] = .) x11, 
  (%type_raw[-nox] = .) x11-shlibs,
  (%type_raw[-nox] = .) freetype219-shlibs (>= 2.2.1-3),
  (%type_raw[-nox] = .) openmotif3-shlibs
<<
 Conflicts: <<
  tetex-base (>= 0), tetex-nox-base, ptex-base, ptex-nox-base,
  ptex (<= 3.1.3-8), ptex-dev (<= 3.1.3-8), ptex-shlibs (<= 3.1.3-8),
  mendexk (<= 2.5-1),
  (%type_raw[-nox] = .) xdvik (<= 22.40y1-7)
 <<
 Replaces: <<
  tetex-base (>= 0), tetex-nox-base, ptex-base, ptex-nox-base,
  context, dvipdfm, epstopdf, pdftex, tetex-macosx, tetex (<= 2.0-3),
  ptex (<= 3.1.3-8), ptex-dev (<= 3.1.3-8), ptex-shlibs (<= 3.1.3-8),
  mendexk (<= 2.5-1),
  (%type_raw[-nox] = .) xdvi (<= 22.70-1), 
  (%type_raw[-nox] = .) xdvik (<= 22.40y1-7)
 <<
 Provides: <<
  tetex-base, tetex3-base, ptex3-base, mendexk,
  context, dvipdfm, epstopdf, pdftex, tetex-macosx, 
  (%type_raw[-nox] = .) xdvik
 <<
 Files: bin etc share/info share/man share/texmf share/texmf-local var
 InfoDocs: web2c.info dvips.info latex.info
 DocFiles: <<
 ANNOUNCE-3.0:tetex-ANNOUNCE-3.0 CREDITS:tetex-CREDITS
 INSTALL:tetex-INSTALL INSTALL.generic:tetex-INSTALL.generic
 LICENSE.src:tetex-LICENSE.src PROBLEMS:tetex-PROBLEMS
 README:tetex-README README.fink:tetex-README.fink
 QuickInstall:tetex-QuickInstall
 texk/web2c/%{Ni}/COPYRIGHT texk/web2c/%{Ni}/COPYRIGHT.jis
 texk/web2c/%{Ni}/Changes.txt texk/web2c/%{Ni}/INSTALL.txt texk/web2c/%{Ni}/README.txt
 utfsrc/readme.txt:utf-fontfiles-readme.txt
 <<
 PreInstScript: <<
  echo "Removing any leftover files from obsolete teTeX installations ..."
  rm -f %p/etc/texmf.local/web2c/*
  rm -f %p/etc/ls-R/texmf.macosx
  rm -Rf %p/share/texmf.macosx
  rm -Rf %p/etc/texmf-var

  rm -Rf %p/var/lib/texmf
 <<
 PostInstScript: <<
  if [ ! -e %p/share/texmf-dist/tex/context ] ; then
    echo " "
    echo "+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++"
    echo "+ UPGRADE PROBLEM: We apologize for the inconvenience, but please reinstall +"
    echo "+ tetex-texmf and then update or install tetex or tetex-base again.         +"
    echo "+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++"
    echo " "
    exit 1
  fi

if [ -e %p/bin/xdvik ] ; then
  update-alternatives --install %p/bin/xdvi xdvi %p/bin/xdvik 30 --slave %p/share/man/man1/xdvi.1 xdvi.1 %p/share/man/man1/xdvik.1
  update-alternatives --install %p/bin/xdvizilla xdvizilla %p/bin/xdvizillak 30 --slave %p/share/man/man1/xdvizilla.1 xdvizilla.1 %p/share/man/man1/xdvizillak.1
fi
  mktexlsr %p/share/texmf %p/etc/texmf-config %p/etc/texmf.local
  PATH=%p/bin:${PATH} texconfig-sys init

  echo "Adjusting permissions ..."
  chmod -R a+rX %p/etc/texmf.local
  chmod -R a+rwX %p/var/lib/texmf
  chmod -R a+rwX %p/etc/texmf-config
  if [ -f ~/Library/texmf/ls-R ]; then chmod a+rw ~/Library/texmf/ls-R; fi
 <<
 PreRmScript: <<
  if [ $1 != "upgrade" ]; then
    if [ -e %p/bin/xdvik ]; then
      update-alternatives --remove xdvi %p/bin/xdvik
      update-alternatives --remove xdvizilla %p/bin/xdvizillak
    fi
  fi
 <<
 DescDetail: <<
 pTeX is the ASCII publishing TeX distribution. This package can handle
 Japanese TeX file and also takes account of vertical writing.

 Now provides context, epstopdf, pdftex, and the former tetex-macosx
 package.
 <<
<<
License: Restrictive/Distributable
DescDetail: <<
pTeX is the ASCII publishing TeX distribution. This package can handle
Japanese TeX file and also takes account of vertical writing.
<<
DescPort: <<
--- original teTeX Fink package DescPort ----
 The Makefile is patched to prevent the mktexlsr, fmtutil, updmap, and texlinks
 utilities from running during the install phase (although texlinks is run
 after "make install").  The mktexlsr, fmtutil, and updmap utilities are run in
 the PostInstall script (the latter two called by texconfig-sys).

 User files are stored in $HOME/Library/texmf (not $HOME/texmf) for
 backwards-compatibility with earlier Fink teTeX installations.
 We also set up a VARTEXMF directory for storing format and font files,
 and a TEXMFCONFIG directory for storing configuration files.  These latter
 can be modified by running "sudo texconfig-sys".

 We use update-alternatives for xdvi to allow users to install a different
 version if they choose.

 We patch libkpathsea's configure script to prevent it linking against an 
 old copy of the library as it builds.
<<
DescPackaging: <<
 This package contains teTeX Fink package. So other pTeX related packages
 should follow original teTeX's packaging rule.

 -----  original DescPackaging of tetex.info -----
 Other TeX related packages should use %p/etc/texmf.local/ as their texmf
 tree for storing files, rather than %p/share/texmf/.  In this way, the
 original texmf tree will be preserved. Any such package should list
 tetex-base as a dependency, and take care to run
   mktexlsr %p/etc/texmf.local
 in both PostInstScript and PostRmScript.

 There is a variant tetex-nox package with X11 disabled.

 texinfo and texi2html are separate packages.

 readlink and its manpage are removed since they conflict with debianutils,
  an essential Fink package.

 Many thanks to the original teTeX maintainer Jeff Whitaker.
 -----  end of text  -----
 Many thanks to Jeff Whitaker and Dave Morrison.
<<
Maintainer: Todai Fink Team <fink@sodan.ecc.u-tokyo.ac.jp>
Homepage: http://www.tug.org/teTeX  and  http://www.ascii.co.jp/pb/ptex/
<<
