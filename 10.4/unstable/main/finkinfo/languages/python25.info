Package: python25
Version: 2.5.1
Revision: 3
Epoch: 1
Maintainer: Daniel Macks <dmacks@netspace.org>
Conflicts: <<
	python25-nox, python-nox (<= 2.2.1-8)
<<
Replaces: <<
	python (<= 2.2.1-8),
	python25-nox, python-nox (<= 2.2.1-8),
	python25-socket, python25-socket-ssl, python25-socket-nox
<<
Depends: <<
	%N-shlibs (= %e:%v-%r),
	blt-shlibs,
	bzip2-shlibs,
	db44-aes-shlibs | db44-shlibs,
	gdbm3-shlibs,
	libgettext3-shlibs,
	libncursesw5-shlibs,
	readline5-shlibs,
	sqlite3-shlibs  (>= 3.2.8-1001),
	tcltk (>= 8.4.1-1),
	x11
<<
BuildConflicts: libquicktime0
BuildDepends: <<
	blt-dev,
	bzip2-dev,
	db44-aes | db44,
	fink (>= 0.24.12-1), 
	gdbm3,
	gettext-bin,
	gettext-tools,
	libgettext3-dev,
	libncurses5 (>= 5.4-20041023-1006),
	libncursesw5,
	readline5,
	sqlite3-dev (>= 3.2.8-1001),
	system-openssl-dev,
	tcltk-dev (>= 8.4.1-1),
	x11-dev
<<
Source: http://python.org/ftp/python/%v/Python-%v.tgz
Source2: http://www.python.org/ftp/python/doc/%v/html-%v.zip
Source-MD5: cca695828df8adc3e69b637af07522e1
Source2-MD5: 318391e7740f72a4efdb4678fa3b01f6
PatchFile: %n.patch
PatchFile-MD5: 7f9dabf7ecb590fab0344abcae651077
PatchScript: sed 's|@PREFIX@|%p|g' < %{PatchFile} | patch -p1
SetLDFLAGS: -L%p/lib/system-openssl/lib
ConfigureParams: --mandir=%p/share/man
GCC: 4.0
InstallScript: <<
#!/bin/sh -ex
	make install DESTDIR=%d

	# build a shared lib (why doesn't build system do this for us?)
	cc -dynamiclib -single_module -all_load -undefined dynamic_lookup -framework System -framework CoreServices -framework Foundation %i/lib/python2.5/config/libpython2.5.a -o %i/lib/python2.5/config/libpython2.5.dylib -install_name %p/lib/python2.5/config/libpython2.5.dylib -current_version 2.5 -compatibility_version 2.5

	# remove flag that isn't required and may cause link problems
	# because we don't use -bundle-loader for some reason
	perl -pi -e 's|-fno-common||g' %i/lib/python2.5/config/Makefile

	# don't propagate our hackery
	perl -pi -e 's|-L%p/lib/system-openssl/lib||' %i/lib/python2.5/config/Makefile

	# fix all main things to be python-versioned filenames with
	# unversioned symlinks to them
	pushd %i/bin
		sed 's|%p/bin/python|%p/bin/python2.5|g' < idle     > idle2.5
		rm idle
		chmod 755 idle2.5
		ln -s idle2.5 %i/bin/idle

		sed 's|%p/bin/python|%p/bin/python2.5|g' < pydoc    > pydoc2.5
		rm pydoc
		chmod 755 pydoc2.5
		ln -s pydoc2.5 %i/bin/pydoc

		sed 's|%p/bin/python|%p/bin/python2.5|g' < smtpd.py > smtpd.py2.5
		rm smtpd.py
		chmod 755 smtpd.py2.5
		ln -s smtpd.py2.5 %i/bin/smtpd.py
		
		# was created as hard-link...why do they do that?
		rm python
		ln -s python2.5 python
	popd
	/bin/mv %i/share/man/man1/python.1 %i/share/man/man1/python25.1
	ln -s python25.1 %i/share/man/man1/python.1

	# install some docs and other useful tidbits
	rm -rf Misc/RPM
	/bin/cp -R Misc Tools %i/lib/python2.5
	mkdir -p %i/share/doc/%n
	/bin/cp -R Demo Doc %i/share/doc/%n
	mkdir -p %i/share/doc/%n/html
	/bin/cp -R ../Python-Docs-%v/ %i/share/doc/%n/html
<<
SplitOff: <<
 Package: %N-shlibs
 Conflicts: python25-nox-shlibs
 Replaces: python25-nox-shlibs, python (<= 2.2.1-8), python-nox (<= 2.2.1-8)
 Files: lib/python2.5/config/libpython2.5.dylib
 Shlibs: %p/lib/python2.5/config/libpython2.5.dylib 2.5.0 python25-shlibs (>= 2.5-1) | python25-nox-shlibs (>= 2.5-1)
 DocFiles: README LICENSE 
<<
SplitOff2: <<
 Package: python
 Depends: python25 (>= %e:%v-%r)
 Conflicts: python-nox
 Replaces: python-nox, python25 (<< 1:2.5.1-3)
 Files: <<
		bin/python
		bin/pydoc
		bin/idle
		bin/smtpd.py
		bin/python-config
		share/man/man1/python.1
	<<
 DocFiles: README LICENSE
 Description: Generic "python" command that invokes python25
<<
DocFiles: README LICENSE 
Description: Interpreted, object-oriented language
DescDetail: <<
 Python is often compared to Tcl, Perl, Scheme or Java. 
 This package installs unix python - not the OSX Framework version.
 Builds a two-level namespace dynamic libpython (needed for koffice).

 The interpretter is installed as "python2.5", and all associated
 commands are similarly named with the python-version in them. To get
 the simple "python" command, install the fink package "python" (note:
 the "python" command there is not guaranteed to be python2.5!).
<<

DescPackaging: <<
	Originally packaged by Jeffrey Whitaker with much help from
	Dave Morrison and Peter O'Gorman

	As of 1:2.5.1-3, the socket modules, with ssl support, are in
	python25 itself and python25-socket and python25-socket-ssl
	are dummy packages that are no longer needed.

	Adjusts linker flags to ignore undefined symbols instead of
	using bundle-loader for libpython. Why? Should revert to
	default behavior (easier to detect other missing lib linkages)
	but wait for new pythonXX version to avoid propagating a
	different linking scheme into all existing *-py25 compiled
	modules.

	Should use --with-pth (fink's pth package)?

	Play lots of games to make sure we get expected support
	libraries. Also make sure -L/sw/lib/system-openssl is passed
	before -L/sw (build system seems to confuse standard meanings
	and uses of CFLAGS vs CPPFLAGS vs LDFLAGS) but avoid
	propagating into modules that compile using distutils.
<<
License: OSI-Approved
Homepage: http://www.python.org
