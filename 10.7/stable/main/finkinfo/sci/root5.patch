Index: root/configure
===================================================================
--- root/configure	(revision 40801)
+++ root/configure	(working copy)
@@ -356,14 +356,14 @@
 
     case $arch in
     macosx)
-        logmsg " file -L $chklibcompat | grep 'i386'"
-        if file -L $chklibcompat | grep 'i386' > /dev/null 2>& 1 ; then
+        logmsg " /usr/bin/file -L $chklibcompat | grep 'i386'"
+        if /usr/bin/file -L $chklibcompat | grep 'i386' > /dev/null 2>& 1 ; then
             ret=1
         fi
         ;;
     macosx64)
-        logmsg " file -L $chklibcompat | grep 'x86_64'"
-        if file -L $chklibcompat | grep 'x86_64' > /dev/null 2>& 1 ; then
+        logmsg " /usr/bin/file -L $chklibcompat | grep 'x86_64'"
+        if /usr/bin/file -L $chklibcompat | grep 'x86_64' > /dev/null 2>& 1 ; then
             ret=1
         fi
         ;;
@@ -403,12 +403,12 @@
             ret=1
         fi
     else
-        if file -L $chklib64 | grep 'ASCII' > /dev/null 2>& 1 ; then
+        if /usr/bin/file -L $chklib64 | grep 'ASCII' > /dev/null 2>& 1 ; then
             check_link $chklib64
             ret=$link_result
         else
-            logmsg " file -L $chklib64 | grep '64-bit'"
-            if file -L $chklib64 | grep '64-bit' > /dev/null 2>& 1 ; then
+            logmsg " /usr/bin/file -L $chklib64 | grep '64-bit'"
+            if /usr/bin/file -L $chklib64 | grep '64-bit' > /dev/null 2>& 1 ; then
                 ret=1
             fi
         fi
@@ -2624,7 +2624,7 @@
                result "ok"
                ftglincdir=`pkg-config --cflags-only-I ftgl | sed 's/-I//g'`
                ftgllibs=`pkg-config --libs-only-l ftgl`
-               ftgllibdir=`pkg-config --libs-only-L ftgl | sed 's/-L//g'`
+               ftgllibdir=`pkg-config --libs-only-L ftgl`
                enable_builtin_ftgl="no"
             else
                enable_builtin_ftgl="yes"
@@ -3323,7 +3323,7 @@
 
     # At this time, libfftw3.a should always be prefered over .so,
     # to avoid forcing users to install fftw3.
-    check_library "libfftw3 libfftw3-3" "no" "$fftw3libdir" \
+    check_library "libfftw3 libfftw3-3" "yes" "$fftw3libdir" \
         $FFTW3 ${FFTW3:+$FFTW3/lib} ${FFTW3:+$FFTW3/.libs} \
         ${finkdir:+$finkdir/lib} \
         /usr/local/lib /usr/lib /opt/fftw3/lib
Index: root/cint/configure
===================================================================
--- root/cint/configure	(revision 40801)
+++ root/cint/configure	(working copy)
@@ -155,7 +155,7 @@
     AR="ar -r -cs "
     IMPLIBEXT=.dylib
 
-    MAKEIMPLIB="ln -sf @so@ @imp@"
+    MAKEIMPLIB="ln -sf `basename @so@` @imp@"
 
     EXPLLINK=1
 
Index: root/cint/ROOT/cintdlls.mk
===================================================================
--- root/cint/ROOT/cintdlls.mk	(revision 40801)
+++ root/cint/ROOT/cintdlls.mk	(working copy)
@@ -163,21 +163,21 @@
 $(ALLCINTDLLS): $(ORDER_) $(MAINLIBS)
 
 $(CINTDLLDIRSTL)/%.dll: $(CINTDLLDIRDLLSTL)/G__cpp_%.o
-	@$(MAKELIB) $(PLATFORM) $(LD) "$(LDFLAGS)" "$(SOFLAGS)" $(notdir $(@:.dll=.$(SOEXT))) $(@:.dll=.$(SOEXT)) $(filter-out $(MAINLIBS),$^) $(CINTDLLLIBLINK)
+	@$(MAKELIB) $(PLATFORM) $(LD) "$(LDFLAGS)" "$(SOFLAGS)" $(@:.dll=.$(SOEXT)) $(@:.dll=.$(SOEXT)) $(filter-out $(MAINLIBS),$^) $(CINTDLLLIBLINK)
 	$(CINTDLLSOEXTCMD)
 ifneq ($(subst win,,$(ARCH)),$(ARCH))
 	@rm -f $(@:.dll=.lib) $(@:.dll=.exp) # remove import libs
 endif
 
 $(CINTDLLDIRDLLS)/stdcxxfunc.dll: $(CINTDLLDIRL)/G__cpp_stdcxxfunc.o
-	@$(MAKELIB) $(PLATFORM) $(LD) "$(LDFLAGS)" "$(SOFLAGS)" $(notdir $(@:.dll=.$(SOEXT))) $(@:.dll=.$(SOEXT)) $(filter-out $(MAINLIBS),$^) $(CINTDLLLIBLINK)
+	@$(MAKELIB) $(PLATFORM) $(LD) "$(LDFLAGS)" "$(SOFLAGS)" $(@:.dll=.$(SOEXT)) $(@:.dll=.$(SOEXT)) $(filter-out $(MAINLIBS),$^) $(CINTDLLLIBLINK)
 	$(CINTDLLSOEXTCMD)
 ifneq ($(subst win,,$(ARCH)),$(ARCH))
 	@rm -f $(@:.dll=.lib) $(@:.dll=.exp) # remove import libs
 endif
 
 $(CINTDLLDIRDLLS)/%.dll: $(CINTDLLDIRL)/G__c_%.o
-	@$(MAKELIB) $(PLATFORM) $(LD) "$(LDFLAGS)" "$(SOFLAGS)" $(notdir $(@:.dll=.$(SOEXT))) $(@:.dll=.$(SOEXT)) $(filter-out $(MAINLIBS),$^) $(CINTDLLLIBLINK)
+	@$(MAKELIB) $(PLATFORM) $(LD) "$(LDFLAGS)" "$(SOFLAGS)" $(@:.dll=.$(SOEXT)) $(@:.dll=.$(SOEXT)) $(filter-out $(MAINLIBS),$^) $(CINTDLLLIBLINK)
 	$(CINTDLLSOEXTCMD)
 
 core/metautils/src/stlLoader_%.cc: $(ROOT_SRCDIR)/core/metautils/src/stlLoader.cc
Index: root/net/xrootd/src/xrootd/config/GNUmake.rules.macos64
===================================================================
--- root/net/xrootd/src/xrootd/config/GNUmake.rules.macos64	(revision 40801)
+++ root/net/xrootd/src/xrootd/config/GNUmake.rules.macos64	(working copy)
@@ -9,6 +9,9 @@
 
 GCC_MAJOR := $(shell $(CXX) -dumpversion 2>&1 | cut -d'.' -f1)
 MACOSX_MINOR := $(shell sw_vers | sed -n 's/ProductVersion://p' | cut -d . -f 2)
+MAJOR := $(shell sed 's|\(.*\)\..*/.*|\1|' < ../../../../../../build/version_number)
+MINOR := $(shell sed 's|.*\.\(.*\)/.*|\1|' < ../../../../../../build/version_number)
+REVIS := $(shell sed 's|.*\..*/\([0-9]*\).*|\1|' < ../../../../../../build/version_number)
 
 #TYPEMISC   = -m64 -D_POSIX_SOURCE -D_REENTRANT -D_GNU_SOURCE -Wall
 TYPEMISC   = -m64 -D_REENTRANT -D_GNU_SOURCE -Wall -D__macos__ $(CFTRACE)
@@ -18,10 +21,10 @@
 TYPEOPT    = $(TYPEMISC) -O2
 TYPEDBG    = $(TYPEMISC) -g
 ifeq ($(subst $(MACOSX_MINOR),,1234),1234)
-TYPELDSO   = $(TYPELINK) -dynamiclib -single_module -m64
+TYPELDSO   = $(TYPELINK) -dynamiclib -single_module -m64 -compatibility_version $(MAJOR) -current_version $(MAJOR).$(MINOR).$(REVIS)
 TYPELDDY   = $(TYPELINK) -dynamiclib -single_module -m64
-TYPESHLIB  = so
-TYPEDYLIB  = so
+TYPESHLIB  = $(MAJOR).$(MINOR).dylib
+TYPEDYLIB  = dylib
 else
 TYPELDSO   = $(TYPELINK) -bundle -m64
 TYPELDDY   = $(TYPELINK) -dynamiclib -single_module -m64
Index: root/net/xrootd/Module.mk
===================================================================
--- root/net/xrootd/Module.mk	(revision 40801)
+++ root/net/xrootd/Module.mk	(working copy)
@@ -30,7 +30,7 @@
 endif
 endif
 ifeq ($(PLATFORM),macosx)
-XRDSOEXT    = so
+XRDSOEXT    = dylib
 else
 XRDSOEXT    = $(SOEXT)
 endif
@@ -272,9 +272,11 @@
 		      else \
 		         if [ "x$(PLATFORM)" = "xmacosx" ] ; then \
 		            lname=`basename $$i` ; \
-		            install_name_tool -id $(LIBDIR)/$$lname $$i ; \
+                            if [[ $$lname =~ ^[a-zA-Z0-9]+\.[0-9]+\.dylib$$ ]] ; then \
+		               install_name_tool -id $(LIBDIR)/$$lname $$i ; \
+		            fi ; \
 		         fi ; \
-		         cp -p $$i $(LPATH)/ ; \
+		         cp -a $$i $(LPATH)/ ; \
 		      fi ; \
 		   done ; \
 		fi ; \
Index: root/build/unix/makecintdll.sh
===================================================================
--- root/build/unix/makecintdll.sh	(revision 40801)
+++ root/build/unix/makecintdll.sh	(working copy)
@@ -120,7 +120,7 @@
          -DG__MAKECINT $CINT_TYPE -Z0 -I$DLLDIR $DLLHEADERS"
 execute "$COMP $OPT $COMPFLAGS -I. $CXXOUT$DLLOBJECT -I$DLLDIR \
          -c $DLLSOURCE"
-$MAKELIB $PLATFORM $LD "$LDFLAGS" "$SOFLAGS" $DLLNAME.$SOEXT \
+$MAKELIB $PLATFORM $LD "$LDFLAGS" "$SOFLAGS" $CINTDIRI/$DLLNAME.$SOEXT \
    $CINTDIRI/$DLLNAME.$SOEXT "$DLLOBJECT"
 rename $CINTDIRI/$DLLNAME
 
Index: root/build/unix/makelib.sh
===================================================================
--- root/build/unix/makelib.sh	(revision 40801)
+++ root/build/unix/makelib.sh	(working copy)
@@ -34,7 +34,7 @@
 if [ $PLATFORM = "macosx" ]; then
    macosx_minor=`sw_vers | sed -n 's/ProductVersion://p' | cut -d . -f 2`
    if [ $macosx_minor -ge 5 ] && [ $LD != "icpc" ]; then
-      soext="so"
+      soext="dylib"
    else
       soext="dylib"
    fi
@@ -218,7 +218,7 @@
 	ln -fs $SONAME.$MAJOR        $LIB
     elif [ -f $LIBVERS ]; then
 	# Versioned library has format foo.3.05.so
-	source_file=`echo $SONAME | sed "s/.*\./&${MINOR}./"`
+	source_file=`basename $SONAME | sed "s/.*\./&${MINOR}./"`
 	LIBNOMAJORMINOR=`echo $LIB|sed 's,\.'$MAJOR'\.'$MINOR',,'`
 	if [ $LIB != $LIBNOMAJORMINOR ]; then
 	    LIBNOMINOR=`echo $LIB|sed 's,\.'$MINOR',,'`
Index: root/config/Makefile.macosx64
===================================================================
--- root/config/Makefile.macosx64	(revision 40801)
+++ root/config/Makefile.macosx64	(working copy)
@@ -98,7 +98,7 @@
 endif
 endif
 ifeq ($(subst $(MACOSX_MINOR),,1234),1234)
-SOEXT         = so
+SOEXT         = dylib
 else
 SOEXT         = dylib
 endif
