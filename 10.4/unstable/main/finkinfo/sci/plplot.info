Info2: <<
Package: plplot%type_pkg[-nognome]
Version: 5.8.0
Revision: 1017
GCC: 4.0
Type: -nognome (boolean), octave (3.0.5)

BuildDepends: <<
   aquaterm-dev, automake1.9, fftw3 (>= 3.1.1-7), freetype219, gcc44, gd2, gd2-bin, glib2-dev, hdf5 (>= 1.6.5-1012), lasi-dev,
   libgettext3-dev, libiconv-dev, libjpeg, libncurses5, libpng3, libtool14, openjade, opensp4, pango1-xft2-ft219 (>= 1.18.4-4), pango1-xft2-ft219-dev (>= 1.18.4-4), pixman (>= 0.10.0-1),
   pkgconfig, readline5, swig, system-java15-dev, x11-dev, 
fink (>= 0.27.2), expat1, fontconfig2-dev,
   (%type_raw[-nognome] = -nognome) wxmac28, (%type_raw[-nognome] = .) wxgtk2.8,
   (%type_raw[-nognome] = .) atk1 (>= 1.20.0-1), (%type_raw[-nognome] = .) gconf2-dev (>= 1.20.1-1), (%type_raw[-nognome] = .) gnome-keyring-dev (>= 1.20.3-1),
   (%type_raw[-nognome] = .) avahi-dev, (%type_raw[-nognome] = .) libavahi-glib1-dev,
   (%type_raw[-nognome] = .) gnome-python2-py25-dev, (%type_raw[-nognome] = .) gnome-vfs2-unified-dev (>= 1:2.20.1-1),
   (%type_raw[-nognome] = .) gtk+2-dev (>= 2.12.8-1), (%type_raw[-nognome] = .) libart2, (%type_raw[-nognome] = .) libbonoboui2-dev,
   (%type_raw[-nognome] = .) libgnome2-dev (>= 2.20.1.1-1), (%type_raw[-nognome] = .) libgnomecanvas2-dev (>= 2.20.1.1-1),
   (%type_raw[-nognome] = .) libgnomeprint2.2-dev (>= 2.18.4-1), (%type_raw[-nognome] = .) libgnomeprintui2.2-dev (>= 2.18.1-1),
   (%type_raw[-nognome] = .) libgnomeui2-dev (>= 2.20.1.1-1), (%type_raw[-nognome] = .) libxml2 (>= 2.6.30-1),
   (%type_raw[-nognome] = .) pygobject2-py25-dev, (%type_raw[-nognome] = .) pygtk2-gtk-py25-dev (>= 2.6.3-2),
   (%type_raw[-nognome] = .) orbit2-dev (>= 2.14.10-1), (%type_raw[-nognome] = .) libbonobo2-dev (>= 2.20.4-1), (%type_raw[-nognome] = .) popt,
   (%type_raw[-nognome] = .) gail18, tcltk-dev
<<
# xml-dom-pm586, xml-sax-expat-pm586, 
## bdeps on openjade, opensp4, xml-dom-pm586, xml-sax-expat-pm586 seem needed only for cvs builds
Depends: <<
%N-dev (= %v-%r), lasi, numeric-py25, 
octave (>=%type_raw[octave]-1) | octave-atlas (>=%type_raw[octave]-1) ,  
octave (<<%type_raw[octave]-9999) | octave-atlas (<<%type_raw[octave]-9999) ,  
python25, qhull, system-java15
<<
Suggests: tcltk-dev
Replaces: <<
	plplot (<< 5.8.0-1), plplot-dev (<< 5.8.0-1), plplot-shlibs (<< 5.8.0-1),
	%{Ni}, %{Ni}-nognome
<<
Provides: %{Ni}-nognome
# Re: absence of Conflicts: Not completely sure that one can install plplot-nognome + splits on top of plplot + splits,
# and that the latter are still fully functional. Should still be investigated carefully...

Source: mirror:sourceforge:plplot/%{Ni}-%v.tar.gz
Source-MD5: 63e954448b12056aeecf2b53cd97f1f5

PatchFile: %n.patch
PatchFile-MD5: a362905f8168e788fbf5d96934402152

PatchScript: <<
#!/bin/sh -ev
 # link dylibs with -single_module, if only to avoid "common symbols" errors.
 # LDFLAGS or the like can't be used since -single_module only usable for dylibs.
 find . -name Makefile.am|xargs perl -pi.bak -e 's;^([[:space:]]+|lib.*_la_LDFLAGS.* )-no-undefined;$& -Wl,-single_module;'
 # removing '${wl}' seems necessary (at least on 10.4) for gfortran linking, and to do no harm for the others ..
 sed -i.bak -e '/compatibility_/s,\${wl},,g' */ltmain.sh
 mv bindings/java/Makefile.am.bak bindings/java/Makefile.am
 # strip executables (in addition to the SetLDFLAGS):
 sed -i.bak -e 's,-no-undefined,& -s,' {utils,bindings/tk}/Makefile.am
 # help configure getting the correct inference about octave version, to avoid direct install of /PLplot and /plplot_octave.oct
 sed -i.bak -e '/OCTAVE_VERSION/s,2\.1/,[2-9].[0-9]/,' configure
 sed -i.bak -e '/OCTAVE_VERSION/s,2\.1/,[[2-9].[0-9]]/,' cf/octave.ac
 # recognize octave versions >= 3 as such
 sed -i.bak -e 's,\$ver\[0\],& >= 3 || &,' bindings/octave/matwrap/wrap_octave.pl 
 ## octave_version.pl is 'required' by matwrap/wrap_octave.pl,
 ## and must be in the same dir, since @INC does not necessarily contain ".."
 mv bindings/octave/octave_version.pl.in bindings/octave/matwrap
 sed -i.bak -e '/bindings\/Makefile/a\
\ \ \ \ bindings/octave/matwrap/octave_version.pl' configure.ac 
 # get info file accepted by InfoDocs
 sed -i.bak -e '/The PLplot Plotting Library/s,: \.,: (%{Ni}).,' doc/docbook/src/%{Ni}doc.info
 ## In bindings/gnome2/python :
 # 1) correct hard-coded addresses for pygtk2-gtk :
 # 2) PYGTK_DEFS are not the path to gnome.defs
 sed -i.bak -e 's,/usr/share,%p/lib,' \
	-e '/^PYGTK_DEFS=/a\
PYGNOME_DEFS=`pkg-config --variable=defsdir gnome-python-2.0`'\
	-e 's,PYGTK\(_DEFS)/[a-g]*n\),PYGNOME\1,'\
	bindings/gnome2/python/Makefile.am
 # To avoid multiply-defined symbols errors :
 sed -i.bak -e '/pygobject\.h/i\
#define NO_IMPORT_PYGOBJECT\
#define NO_IMPORT_ARRAY' bindings/gnome2/python/*.c
 ## circumvent ltdl error on get-drv-info for gcw _ still to be understood, and corrected at the proper place.:
 # At least, the fix points to the source of the problem much more than the error msg did ...
  sed -i.bak -e 's,\./get-drv-info,export DYLD_FALLBACK_LIBRARY_PATH=../bindings/gnome2/lib/.libs; &,' drivers/Makefile.am

	# use the right python interp
	perl -pi -e 's|#!.*env python|#!%p/bin/python2.5|' examples/python/*

	# use the right path to libpython
	perl -pi -e "s#(get_python_lib\(0,1\))#\1+'/config'#" configure cf/ac_python_devel.m4
<<

SetCFLAGS: -Os -fstrict-aliasing
NoSetCPPFLAGS: true
NoSetLDFLAGS: true
SetLDFLAGS: -Wl,-x,-dead_strip
SetLIBRARY_PATH: %p/lib
NoSetMAKEFLAGS: true
SetMAKEFLAGS: -j1

ConfigureParams: <<
 --mandir=%p/share/man --infodir=%p/share/info \
 --with-freetype2-libdir=%p/lib/freetype219/lib --with-freetype2-incdir=%p/lib/freetype219/include/freetype2 \
 --with-freetype-font-dir=/usr/X11R6/lib/X11/fonts --with-gd-libdir=%p/lib --with-gd-incdir=%p/include \
 --with-java-home=/Library/Java/Home TCLLIBDIR=%p/lib TKLIBDIR=%p/lib AQTINCDIR=%p/include/aquaterm \
 --with-wxwidgets-bindir=%p/bin \
 --without-rpath --build=powerpc-apple-darwin --with-prebuiltdoc --with-onsgmls \
 --with-pkg-config --with-pthreads --with-ltdlsystem --enable-f95 FC=gfortran F77=gfortran \
 --enable-xterm --with-x --disable-java (%type_raw[-nognome] = -nognome) --disable-gcw \
 --disable-dependency-tracking
<<
# remains to get rid of "--disable-java" (to conform with 5.6.1)
# to debug a maximum before switching the build-system to the opaque cmake _ which seems needed
# to build the cairo driver, and will apparently be the only one in next %v... <sigh>

CompileScript: <<
 #!/bin/sh -ev
 export CCACHE_DISABLE=1
 export PKG_CONFIG_PATH=$PKG_CONFIG_PATH:%p/lib/pango-ft219/lib/pkgconfig:%p/lib/freetype219/lib/pkgconfig:%p/lib/fontconfig2/lib/pkgconfig
 export CPATH=%p/lib/freetype219/include:%p/include
 export FCFLAGS="-Os -fstrict-aliasing" FFLAGS="-Os -fstrict-aliasing"
 ln -s %{Ni}.py.Numeric bindings/python/%{Ni}.py
 export PYTHON=%p/bin/python2.5

 %{default_script}
<<

InstallScript: <<
  #!/bin/sh -ev
  make install DESTDIR=%d
  mv %i/share/info/plplotdoc.info %i/share/info/plplot.info
  rm %i/share/info/*.bak
  ln -s html/index.html %i/share/doc/plplot/plplot.html
  chmod a+x %i/share/plplot%v/examples/python/xw24.py
  chmod -R a-x,a+X %i/lib %i/share/doc
  rm %i/share/doc/plplot/plplot-%v.{dvi,ps.gz}
  rm %i/share/doc/plplot/C[Oo]*
  ln -s ../%N-shlibs/{COPYING.LIB,Copyright} %i/share/doc/plplot
  if [ "%n" != "plplot" ] ; then ln -s plplot %i/share/doc/%n ; fi
## clean up .la files (and should still do .pc's , and -config...)
  sed -i.bak -e "/^dependency_libs/{
	s,-[RL]%p/[a-z0-9./]*\([ ']\),\1,g
	s,-l[a-mp-y]*\([ ']\),\1,g
	s,  *, ,g
	s, '$,',
	}" %i/lib{,/*/*}/*.la
  sed -i.bak -e "/^dependency_libs/{
	s, -L[a-z/]*X[^ ]*,,
	s,-lwx,-L%p/lib &,
	}" %i/lib/%{Ni}%v/driversd/wxwidgets.la
  rm -f %i/lib{,/*/*}/*.la.bak
## Adjust TCLLIBPATH _ copied from vtk-py ... (other pkgs would need too ...)
  install -d %i/etc/profile.d
  cat >%i/etc/profile.d/plplot.sh <<-EOF
	export TCLLIBPATH="%p/share/plplot%v/tcl \$TCLLIBPATH"
	EOF
  cat >%i/etc/profile.d/plplot.csh <<-EOF
	if ( ! \$?TCLLIBPATH ) then
		setenv TCLLIBPATH "%p/share/plplot%v/tcl"
	else
		setenv TCLLIBPATH "%p/share/plplot%v/tcl \$TCLLIBPATH"
	endif
	EOF
  chmod 755 %i/etc/profile.d/*
<<
InfoDocs: plplot.info

SplitOff: <<
   Package: %N-shlibs
   Depends: <<
   (%type_raw[-nognome] = .) libgnomeui2-shlibs (>= 2.20.0-1),
   aquaterm-shlibs, freetype219-shlibs, gcc44-shlibs, gd2-shlibs, lasi-shlibs, libtool14-shlibs, pango1-xft2-ft219-shlibs (>= 1.18.4-4), tcltk-shlibs,
   (%type_raw[-nognome] = .) libgnomeprintui2.2-shlibs, (%type_raw[-nognome] = .) wxgtk2.8-shlibs, (%type_raw[-nognome] = -nognome) wxmac28-shlibs
   <<
   Replaces: <<
		plplot (<< 5.8.0-1), plplot-dev (<< 5.8.0-1), plplot-shlibs (<< 5.8.0-1),
		%{Ni}-shlibs, %{Ni}-nognome-shlibs
	<<
   Provides: %{Ni}-nognome-shlibs
   Files: lib/lib*.*.dylib lib/plplot%v/driversd/*.{so,rc}
   Shlibs: <<
	%p/lib/libcsirocsa.0.dylib	1.0.0	%n (>= 5.3.1-1)
	%p/lib/libcsironn.0.dylib	1.0.0	%n (>= 5.3.1-1)
	%p/lib/libplplotd.11.dylib	12.0.0	%n (>= 5.8.0-1)
	%p/lib/libplplotcxxd.9.dylib	12.0.0	%n (>= 5.3.1-1)
	%p/lib/libplplotf77cd.9.dylib	11.0.0	%n (>= 5.6.1-1001)
	%p/lib/libplplotf77d.9.dylib	11.0.0	%n (>= 5.6.1-1001)
	%p/lib/libplplotf95cd.0.dylib	1.0.0	%n (>= 5.6.1-1001)
	%p/lib/libplplotf95d.0.dylib	1.0.0	%n (>= 5.6.1-1001)
	%p/lib/libplplottcltkd.11.dylib	12.0.0	%n (>= 5.8.0-1)
	%p/lib/libtclmatrixd.11.dylib	12.0.0	%n (>= 5.8.0-1)
	(%type_raw[-nognome] = .)	%p/lib/libplplotgnome2d.0.dylib	1.0.0	%n (>= 5.8.0-1)
   <<
   InstallScript: <<
	mkdir -p %i/share/doc/%{Ni}-shlibs
	cp -p COPYING.LIB Copyright %i/share/doc/%{Ni}-shlibs
	if [ "%N" != "%{Ni}" ] ; then ln -s %{Ni}-shlibs %i/share/doc/%n ; fi
   <<
<<

SplitOff2: <<
   Package: %N-dev
   Depends: %N-shlibs (= %v-%r)
   Replaces: <<
 		plplot (<< 5.8.0-1), plplot-dev (<< 5.8.0-1), plplot-shlibs (<< 5.8.0-1),
		%{Ni}-dev, %{Ni}-nognome-dev
	<<
   Provides: %{Ni}-nognome-dev
   Files: <<
		bin/%{Ni}-config
		bin/%{Ni}_libtool
		include
		lib/*.{a,la,dylib}
		(%type_raw[-nognome] = .) lib/python2.5/site-packages/*.{a,la}
		lib/pkgconfig
		lib/plplot%v
	<<
   BuildDependsOnly: False
   InstallScript: mkdir -p %i/share/doc; ln -s %N-shlibs %i/share/doc/%n
   PreInstScript: rm -fR %p/share/doc/%n
<<

Description: Scientific plotting package

DescDetail: <<
PLplot is relatively small, portable, freely distributable, and is rich
enough to satisfy most users. It has a wide range of plot types
including line (linear, log), contour, 3D, fill, and almost 1000
characters (including Greek and mathematical) in its extended font set. 
The package is designed to make it easy to quickly get graphical output;
only a handful of function calls is typically required.  For more
advanced use, virtually all aspects of plotting are configurable.
<<
DescUsage: <<
Make sure that tcltk-dev is installed.

To test the examples, copy the directory /sw/share/%n%v to
your home directory, and cd into examples. Then run the following
commands from an X11 window:

make
./plplot-test.sh

<<
DescPackaging: <<
Many thanks to the PLplot folks for helping with packaging.

Depends on plplot-dev and tcltk-dev because these are needed during 
runtime. The dependency on tcltk-dev is not imposed, because it violates
Fink policy.

Got varianted as of 5.8.0-1

Sylinking doc/ directories across variants is bad form because it can
*never* be undone (dpkg limitation) if wanted to use actual package-
specific dirs instead.

--enable-gnome is old-world gnome1/gtk+ not gnome2/gtk+2
<<
License: LGPL
Maintainer: None <fink-devel@lists.sourceforge.net>
Homepage: http://plplot.sf.net
<<
