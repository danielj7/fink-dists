diff -uNr distcc-2.12/src/setuid.c distcc-2.12-new/src/setuid.c
--- distcc-2.12/src/setuid.c	Sun Nov 16 21:00:16 2003
+++ distcc-2.12-new/src/setuid.c	Wed Dec 31 10:25:15 2003
@@ -108,11 +108,6 @@
      * permanently discard privileges: both the real and effective uid are
      * set. */
 
-    if (setuid(uid)) {
-        rs_log_error("setuid(%d) failed: %s", (int) uid, strerror(errno));
-        return EXIT_SETUID_FAILED;
-    }
-
     if (setgid(gid)) {
         rs_log_error("setgid(%d) failed: %s", (int) gid, strerror(errno));
         return EXIT_SETUID_FAILED;
@@ -127,6 +122,11 @@
         return EXIT_SETUID_FAILED;
     }
 #endif
+
+    if (setuid(uid)) {
+        rs_log_error("setuid(%d) failed: %s", (int) uid, strerror(errno));
+        return EXIT_SETUID_FAILED;
+    }
 
     if (getuid() == 0  ||  geteuid() == 0) {
         rs_log_crit("still have root privileges after trying to discard them!");
