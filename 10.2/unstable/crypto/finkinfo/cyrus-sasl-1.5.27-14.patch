diff -uNbr cyrus-sasl-1.5.27/configure cyrus-sasl-new/configure
--- cyrus-sasl-1.5.27/configure	Fri Mar 23 20:48:12 2001
+++ cyrus-sasl-new/configure	Sat Apr 27 18:52:20 2002
@@ -3571,7 +3571,7 @@
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   ac_save_LIBS="$LIBS"
-LIBS="-ldes  $LIBS"
+LIBS="-ldes524  $LIBS"
 cat > conftest.$ac_ext <<EOF
 #line 3577 "configure"
 #include "confdefs.h"
@@ -3599,7 +3599,7 @@
 fi
 if eval "test \"`echo '$ac_cv_lib_'$ac_lib_var`\" = yes"; then
   echo "$ac_t""yes" 1>&6
-  LIB_DES="-ldes";
+  LIB_DES="-ldes524";
 				       with_des=yes
 else
   echo "$ac_t""no" 1>&6
@@ -3741,7 +3741,7 @@
 #define WITH_DES 1
 EOF
 
-  LIB_DES="-ldes"
+  LIB_DES="-ldes524"
 fi
 
 
@@ -3886,7 +3886,7 @@
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   ac_save_LIBS="$LIBS"
-LIBS="-lkrb -ldes $LIBS"
+LIBS="-lkrb -ldes524 $LIBS"
 cat > conftest.$ac_ext <<EOF
 #line 3892 "configure"
 #include "confdefs.h"
@@ -3924,7 +3924,7 @@
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   ac_save_LIBS="$LIBS"
-LIBS="-lkrb -ldes -lcom_err $LIBS"
+LIBS="-lkrb -ldes524 -lcom_err $LIBS"
 cat > conftest.$ac_ext <<EOF
 #line 3930 "configure"
 #include "confdefs.h"
@@ -3980,7 +3980,7 @@
 #define HAVE_KRB 1
 EOF
 
-  SASL_KRB_LIB="-lkrb -ldes $COM_ERR"
+  SASL_KRB_LIB="-lkrb -ldes524 $COM_ERR"
   
 else
   echo "$ac_t""disabled" 1>&6
@@ -4222,7 +4222,7 @@
   if test "$gss_impl" = mit; then
      GSSAPIBASE_LIBS="$GSSAPIBASE_LIBS/lib -lgssapi_krb5 -lkrb5 -lk5crypto -lcom_err"
   elif test "$gss_impl" = "heimdal"; then
-     GSSAPIBASE_LIBS="$GSSAPIBASE_LIBS/lib -lgssapi -lkrb5 -ldes -lasn1 -lroken ${LIB_CRYPT} -lcom_err"
+     GSSAPIBASE_LIBS="$GSSAPIBASE_LIBS/lib -lgssapi -lkrb5 -ldes524 -lasn1 -lroken ${LIB_CRYPT} -lcom_err"
   else
      gssapi="no"
      echo "configure: warning: Disabling GSSAPI" 1>&2
diff -uNbr cyrus-sasl-1.5.27/lib/dlopen.c cyrus-sasl-new/lib/dlopen.c
--- cyrus-sasl-1.5.27/lib/dlopen.c	Sun Aug 13 21:44:02 2000
+++ cyrus-sasl-new/lib/dlopen.c	Sat Apr 27 18:51:37 2002
@@ -158,7 +158,7 @@
     int flag;
     void *library;
     void *entry_point;
-#if __OpenBSD__
+#if __OpenBSD__ || __APPLE__
     char adj_entryname[1024];
 #else
 #define adj_entryname entryname
@@ -179,7 +179,7 @@
 	return SASL_FAIL;
     }
 
-#if __OpenBSD__
+#if __OpenBSD__ || __APPLE__
     snprintf(adj_entryname, sizeof adj_entryname, "_%s", entryname);
 #endif
 
diff -uNbr cyrus-sasl-1.5.27/lib/saslutil.c cyrus-sasl-new/lib/saslutil.c
--- cyrus-sasl-1.5.27/lib/saslutil.c	Thu Dec 21 01:03:43 2000
+++ cyrus-sasl-new/lib/saslutil.c	Sat Apr 27 18:51:37 2002
@@ -349,6 +349,10 @@
     if (len > 6) len = 6;
     for (lup = 0; lup < len; lup += 2)
 	rpool->pool[lup] = (seed[lup] << 8) + seed[lup + 1];
+
+#ifdef __APPLE__
+    srandom((unsigned)(*rpool->pool));
+#endif /* __APPLE__ */
 }
 
 static void randinit(sasl_rand_t *rpool)
@@ -370,13 +374,16 @@
     /* init if necessary */
     randinit(rpool);
     
-#ifdef WIN32
+#ifdef __APPLE__
+    for (lup=0;lup<len; ++lup)
+	buf[lup] = (char) (random() >> 8);
+#elif WIN32
     for (lup=0;lup<len;lup++)
 	buf[lup] = (char) (rand() >> 8);
 #else /* WIN32 */
     for (lup=0; lup<len; lup++)
 	buf[lup] = (char) (jrand48(rpool->pool) >> 8);
-#endif /* WIN32 */
+#endif /* __APPLE__ */
 }
 
 /* this function is just a bad idea all around, since we're not trying to
diff -uNbr cyrus-sasl-1.5.27/plugins/Makefile.in cyrus-sasl-new/plugins/Makefile.in
--- cyrus-sasl-1.5.27/plugins/Makefile.in	Fri Mar 23 20:48:13 2001
+++ cyrus-sasl-new/plugins/Makefile.in	Sat Apr 27 18:51:37 2002
@@ -160,7 +160,7 @@
 
 INCLUDES = -I$(top_srcdir)/include
 
-LDFLAGS = @LDFLAGS@ -export-dynamic -rpath $(plugindir)
+LDFLAGS = @LDFLAGS@ -export-dynamic -module -rpath $(plugindir)
 
 plugindir = @plugindir@
 
