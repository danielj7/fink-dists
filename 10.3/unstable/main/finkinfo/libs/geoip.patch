diff -uNr GeoIP-1.3.5/libGeoIP/GeoIP.c GeoIP-1.3.5-patched/libGeoIP/GeoIP.c
--- GeoIP-1.3.5/libGeoIP/GeoIP.c	2004-06-13 23:09:08.000000000 -0400
+++ GeoIP-1.3.5-patched/libGeoIP/GeoIP.c	2004-07-17 23:52:46.000000000 -0400
@@ -434,32 +434,15 @@
 
 unsigned long lookupaddress (const char *host) {
 	unsigned long addr = inet_addr(host);
-	struct hostent phe2;
-	struct hostent * phe = &phe2;
-	char *buf = NULL;
-	int buflength = 16384;
-	int herr = 0;
-	int result = 0;
-	buf = malloc(buflength);
-	if (addr == INADDR_NONE) {
-		while (1) {
-			/* we use gethostbyname_r here because it is thread-safe and gethostbyname is not */
-			result = gethostbyname_r(host,&phe2,buf,buflength,&phe,&herr);
-			if (herr != ERANGE)
-				break;
-			if (result == 0)
-				break;
-			/* double the buffer if the buffer is too small */
-			buflength = buflength * 2;
-			buf = realloc(buf,buflength);
-		}
+	struct hostent * phe;
+	if (addr == INADDR_NONE)
+	{
+		phe = gethostbyname(host);
 		if (!phe)
 			return 0;
-		if (result != 0)
-			return 0;
 		addr = *((unsigned long *) phe->h_addr_list[0]);
 	}
-	free(buf);
+
 	return ntohl(addr);
 }
 
