Package: ccp4
Version: 5.0.1
Revision: 14
# Revision 14 includes all released patches up through July 23 2004
Source: ftp://ftp.%n.ac.uk/%n/current/packed/%n-%v.tar.gz
Source-MD5: c2087efdd9c30ccfd39ac5e60d1fdfde   
SourceDirectory: %n-%v
Source2: http://chemistry.ucsc.edu/~wgscott/xtal/xtalfink/XCCPJiffy-custom.gz
Source2-MD5: 21568dd2475505929573a3fd452c538f
#
Depends: x11, tcltk, blt 
BuildDepends: g77 (>= 3.4.0-2), f2c, fort77, tcltk-dev
Replaces: mosflm (<= 6.2.3-2), mosflm-small (<= 6.2.3-2), refmac (<= 5.1999-3)
NoSetCPPFLAGS: true
NoSetLDFLAGS: true
Patch: %n.patch
PatchScript: <<
#!/bin/zsh -f
umask 0022
#
# setup script for tchs, zsh and bash users
perl -pi -e 's|/sw|%p|g' include/%n.setup*            # location of tcktk, blt
perl -pi -e 's|/xtal|%p/src/%f|g' include/%n.setup*   # build prefix (changed in install) 
cp include/%n.setup-dist include/%n.setup
#
# Quick-fix for some compilation header omissions
 cp %p/include/f2c.h    lib/ccif/g2c.h   
 cp %p/include/f2c.h    lib/src/g2c.h
 cp %p/include/f2c.h    lib/g2c.h
 cp %p/include/f2c.h    x-windows/Mosflm/cbf/src/g2c.h
 cp %p/include/f2c.h    x-windows/Mosflm/src/g2c.h
 cp %p/include/f2c.h    x-windows/RasMol/src/g2c.h
 cp %p/include/f2c.h    x-windows/ipdisp/src/g2c.h
 cp %p/include/f2c.h    x-windows/xdl_view/src/g2c.h
#
# Set up XCCPJiffy wrapper scripts in $CCP4/etc
perl -pi -e 's|/sw|%p|g' etc/x*
chmod a+x etc/x*
#
<<
CompileScript: <<
#!/bin/zsh -f
 umask 0022
. include/%n.setup-sh
./configure --with-x Darwin
#  fix a post-configure bug
perl -pi -e 's/EXTRA_LOAD_FLAGS = -lg2c//g' x-windows/XCCPJIFFY/Imakefile
#
make -i
make -i install
mv $CBIN/xplot84driver $CBIN/xplot84driver.exe
#
# Manually link xloggraph with g77 (fails in make)
cd  x-windows/XCCPJIFFY
g77 -fno-second-underscore -o xloggraph -L/usr/lib msg_box.o ZDr2d.o EditString.o hardcopy_ctrl.o xloggraph.o log_file.o tom_fortran_interface.o bits_and_pieces.o graphics.o -g -Os -I/usr/include/X11R6 -L/usr/X11R6/lib -lXaw -lXmu -lXt -lSM -lICE -lXpm -lXext -lX11 -lm -lgcc
#
cp xloggraph $CBIN/xloggraph.exe
cd ../..
#
make clean
<<
InstallScript: <<
#!/bin/zsh -f
umask 0022
. include/%n.setup-sh
# Change environment scripts to match final installation
perl -pi -e 's|%p/src/%f|%p/share/xtal|g' include/%n.setup-sh      # install prefix
perl -pi -e 's|%p/src/%f|%p/share/xtal|g' include/%n.setup         # install prefix
#
 mkdir -p %i/share/xtal/%n-%v
 mkdir -p %i/share/man/man1
# set up man pages in a fink-compliant manner
cd %p/src/%n-%v-%r/%n-%v/doc
mv rasmol.doc eightbit_rasmol.doc
foreach docfilepage ( *.doc )
 cp ${docfilepage}  %i/share/man/man1/${docfilepage:r}.1
end
# back to source directory
 cd %p/src/%n-%v-%r/%n-%v
#
# install everything in one place -- users will require this
 cp -R * %i/share/xtal/%n-%v/.
#
 mkdir -p %i/lib/app-defaults
 gunzip ../XCCPJiffy-custom.gz ; chmod a+x ../XCCPJiffy-custom
 mv lib/X11/app-defaults/XCCPJiffy lib/X11/app-defaults/XCCPJiffy-dist
 cp ../XCCPJiffy-custom lib/X11/app-defaults/XCCPJiffy 
 cp ../XCCPJiffy-custom %i/lib/app-defaults/XCCPJiffy
#
# make scripts for %p/etc/profile.d  
 mkdir -p %i/etc/profile.d
 echo "source %p/share/xtal/%n-%v/include/%n.setup"     > %i/etc/profile.d/%n.csh
 echo ". %p/share/xtal/%n-%v/include/%n.setup-sh"       > %i/etc/profile.d/%n.sh                                                                                     
 chmod a+x %i/etc/profile.d/%n.*
#
# needed for compilation of ancilliary programs such as future versions of mosflm
#
ranlib %i/share/xtal/%n-%v/lib/*.a
#
<<
Description:  Macromolecular crystallography package
DescDetail: <<
CCP4 macromolecular crystallography program suite
This version compiles with Apple's Lapack/Blas
http://www.ccp4.ac.uk
License agreement is part of configure file -- print out form and mail in, 
additional comments at http://chemistry.ucsc.edu/~wgscott/xtal/page5.html
CCP4 files will be installed under /sw/share/xtal/ccp4-5.0.1   
<<
DocFiles: README CHANGES COPYING PROBLEMS INSTALL INSTALL.html INSTALL.ps ccp4i_installation.html academic_software_licence.pdf  academic_software_licence.ps.gz  academic_software_licence.rtf
Homepage: http://www.ccp4.ac.uk  
License: Restrictive
Maintainer: W. G. Scott <wgscott@users.sourceforge.net>
