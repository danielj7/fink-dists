diff --unidirectional-new-file -rux .svn tags/nano_2_2_3/ChangeLog trunk/nano/ChangeLog
--- tags/nano_2_2_3/ChangeLog	2010-03-28 08:35:10.000000000 +0000
+++ trunk/nano/ChangeLog	2010-03-28 08:35:06.000000000 +0000
@@ -1,3 +1,24 @@
+2010-03-21 Chris Allegretta <chrisa@asty.org>
+	* nano.c (page_stdin et al): Don't attempt to reset/reopen the terminal
+	  settings when reading stdin if it was aborted with SIGINT.  May fix Savannah
+	  bug 29114 reported by  Mike Frysinger.
+
+2010-03-21 Mike Frysinger <vapier@gentoo.org>
+	* doc/syntax/c.nanorc: Add additional support for #include_next and #pragma
+
+2010-03-21 Chris Allegretta <chrisa@asty.org>
+	* move.c (do_page_up, do_page_down()): Explicitly set current_y to 0 when paging 
+	  up when not in smooth scroll mode, as previous fixes would otherwise cause 
+	  the cursor to not really be moved to the stop of the screen.
+
+2010-03-07 Chris Allegretta <chrisa@asty.org>
+	* configure.ac, nano.c (handle_sigwinch): Create check for whether LINES and
+	  COLS can safely be redefined.  Fixes compilation issues with cygwin, and likely
+	  with newer versions of ncurses, fixes Savannah bug 28984 repoted by Andy Koppe
+          and Eric Oliver via mailing list.
+	* winio.c (get_mouseinput) - fix stray semicolon in code, also reported in
+	  bug 28984.
+
 GNU nano 2.2.3 - 2010.02.11
 2010-01-28 Chris Allegretta <chrisa@asty.org>
 	* move.c (do_page_up, do_page_down): Fix for smooth mode not preserving cusor 
diff --unidirectional-new-file -rux .svn tags/nano_2_2_3/configure.ac trunk/nano/configure.ac
--- tags/nano_2_2_3/configure.ac	2010-03-28 08:35:11.000000000 +0000
+++ trunk/nano/configure.ac	2010-03-28 08:35:06.000000000 +0000
@@ -569,6 +569,21 @@
     fi
 #fi
 
+AC_MSG_CHECKING([whether LINES and COLS can be redefined])
+AC_TRY_RUN([
+#include <curses.h>
+int main(void)
+{
+    LINES = 80;
+    COLS = 25;
+    return 0;
+}], 
+AC_DEFINE(REDEFINIG_MACROS_OK, 1, [Define this if you know your curses library allows LINES and COLS to be redefined to deal with a resizing bug])
+AC_MSG_RESULT(yes),
+AC_MSG_RESULT(no),
+AC_MSG_WARN([*** Can't check for macro redefinability when cross-compiling]))
+
+
 # Check for groff html support
 AC_MSG_CHECKING([for HTML support in groff])
 groff -t -mandoc -Thtml </dev/null >/dev/null
diff --unidirectional-new-file -rux .svn tags/nano_2_2_3/doc/syntax/c.nanorc trunk/nano/doc/syntax/c.nanorc
--- tags/nano_2_2_3/doc/syntax/c.nanorc	2010-03-28 08:35:09.000000000 +0000
+++ trunk/nano/doc/syntax/c.nanorc	2010-03-28 08:35:05.000000000 +0000
@@ -8,7 +8,7 @@
 color brightyellow "\<(for|if|while|do|else|case|default|switch)\>"
 color brightyellow "\<(try|throw|catch|operator|new|delete)\>"
 color magenta "\<(goto|continue|break|return)\>"
-color brightcyan "^[[:space:]]*#[[:space:]]*(define|include|(un|ifn?)def|endif|el(if|se)|if|warning|error)"
+color brightcyan "^[[:space:]]*#[[:space:]]*(define|include(_next)?|(un|ifn?)def|endif|el(if|se)|if|warning|error|pragma)"
 color brightmagenta "'([^'\]|(\\["'abfnrtv\\]))'" "'\\(([0-3]?[0-7]{1,2}))'" "'\\x[0-9A-Fa-f]{1,2}'"
 ##
 ## GCC builtins
diff --unidirectional-new-file -rux .svn tags/nano_2_2_3/src/move.c trunk/nano/src/move.c
--- tags/nano_2_2_3/src/move.c	2010-03-28 08:35:07.000000000 +0000
+++ trunk/nano/src/move.c	2010-03-28 08:35:05.000000000 +0000
@@ -1,4 +1,4 @@
-/* $Id: move.c 4481 2010-01-29 03:40:58Z astyanax $ */
+/* $Id: move.c 4486 2010-03-21 04:56:37Z astyanax $ */
 /**************************************************************************
  *   move.c                                                               *
  *                                                                        *
@@ -68,7 +68,7 @@
     if (!ISSET(SMOOTH_SCROLL)) {
 #endif
 	openfile->current = openfile->edittop;
-	openfile->placewewant = 0;
+	openfile->placewewant = openfile->current_y = 0;
 #ifndef NANO_TINY
     }
 #endif
@@ -116,7 +116,7 @@
     if (!ISSET(SMOOTH_SCROLL)) {
 #endif
 	openfile->current = openfile->edittop;
-	openfile->placewewant = 0;
+	openfile->placewewant = openfile->current_y = 0;
 #ifndef NANO_TINY
     }
 #endif
diff --unidirectional-new-file -rux .svn tags/nano_2_2_3/src/nano.c trunk/nano/src/nano.c
--- tags/nano_2_2_3/src/nano.c	2010-03-28 08:35:07.000000000 +0000
+++ trunk/nano/src/nano.c	2010-03-28 08:35:05.000000000 +0000
@@ -1,4 +1,4 @@
-/* $Id: nano.c 4477 2010-01-18 03:43:24Z astyanax $ */ 
+/* $Id: nano.c 4489 2010-03-21 05:31:43Z astyanax $ */ 
 /**************************************************************************
  *   nano.c                                                               *
  *                                                                        *
@@ -1067,6 +1067,8 @@
 
 static struct sigaction pager_oldaction, pager_newaction;  /* Original and temporary handlers for SIGINT. */
 static bool pager_sig_failed = FALSE; /* Did sigaction() fail without changing the signal handlers? */
+static bool pager_input_aborted = FALSE; /* Did someone invoke the pager and abort it via ^C? */
+
 
 /* Things which need to be run regardless of whether
    we finished the stdin pipe correctly or not */
@@ -1087,7 +1089,8 @@
 
     dup2(ttystdin,0);
     close(ttystdin);
-    tcgetattr(0, &oldterm);
+    if (!pager_input_aborted)
+	tcgetattr(0, &oldterm);
     if (!pager_sig_failed && sigaction(SIGINT, &pager_oldaction, NULL) == -1)
         nperror("sigaction");
     terminal_init();
@@ -1099,13 +1102,15 @@
 RETSIGTYPE cancel_stdin_pager(int signal)
 {
     /* Currently do nothing, just handle the intr silently */
+    pager_input_aborted = TRUE;
 }
 
 /* Let nano read stdin for the first file at least */
 void stdin_pager(void)
 {
     endwin();
-    tcsetattr(0, TCSANOW, &oldterm);
+    if (!pager_input_aborted)
+	tcsetattr(0, TCSANOW, &oldterm);
     fprintf(stderr, _("Reading from stdin, ^C to abort\n"));
 
     /* Set things up so that Ctrl-C will cancel the new process. */
@@ -1125,7 +1130,7 @@
 	    nperror("sigaction");
 	}
     }
- 
+
     open_buffer("", FALSE);
     finish_stdin_pager();
 }
@@ -1263,8 +1268,10 @@
      * otherwise.  However, COLS and LINES are curses global variables,
      * and in some cases curses has already updated them.  But not in
      * all cases.  Argh. */
+#ifdef REDEFINIG_MACROS_OK
     COLS = win.ws_col;
     LINES = win.ws_row;
+#endif
 
     /* If we've partitioned the filestruct, unpartition it now. */
     if (filepart != NULL)
diff --unidirectional-new-file -rux .svn tags/nano_2_2_3/src/winio.c trunk/nano/src/winio.c
--- tags/nano_2_2_3/src/winio.c	2010-03-28 08:35:07.000000000 +0000
+++ trunk/nano/src/winio.c	2010-03-28 08:35:05.000000000 +0000
@@ -1,4 +1,4 @@
-/* $Id: winio.c 4473 2010-01-13 03:21:19Z astyanax $ */
+/* $Id: winio.c 4484 2010-03-07 19:35:46Z astyanax $ */
 /**************************************************************************
  *   winio.c                                                              *
  *                                                                        *
@@ -1746,7 +1746,7 @@
 	     * wheel is equivalent to moving down three lines. */
 	    for (i = 0; i < 3; i++)
 		unget_kbinput((mevent.bstate & BUTTON4_PRESSED) ?
-			 sc_seq_or(do_up_void, 0) : sc_seq_or(DO_DOWN_VOID, 0);, FALSE,
+			 sc_seq_or(DO_UP_VOID, 0) : sc_seq_or(DO_DOWN_VOID, 0), FALSE,
 			FALSE);
 
 	    return 1;
