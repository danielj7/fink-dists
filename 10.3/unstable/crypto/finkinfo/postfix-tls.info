Package: postfix-tls
Version: 2.1.4
Revision: 2

Homepage: http://www.postfix.org/
Description: Mail transfer agent that's fast and secure
DescDetail: <<
Postfix is Wietse Venema's mailer that started life as an alternative to
the widely-used Sendmail program. Postfix attempts to be fast, easy to
administer, and secure, while at the same time being sendmail compatible
enough to not upset existing users. Thus, the outside has a sendmail-ish
flavor, but the inside is completely different. 

This package provides TLS encryption and SASL authentication. 
<<
DescUsage: <<
You need to do a few things to set Postfix up before you can use it:

 1) Edit /sw/etc/postfix/main.cf. In particular, edit myorigin,
    mydestination and mynetworks in that file. The file is well commented.
    More configuration options are documented in postconf(5). Information
    on setting up TLS encryption can be found in
    /sw/share/doc/postfix-tls/tls.
 
 2) Edit the aliases in /sw/etc/postfix/aliases so that mail to root,
    and your user, go to your real email address. Run 'sudo newaliases'
    to update the alias database file.
 
 3) Run 'sudo mta-switch fink' to move the old sendmail from Apple's Postfix
    out of the way and place symlinks to Fink's Postfix in its place. You may
    need to do this after upgrades of Mac OS X from Apple. If you are running
    the system's Postfix, you must stop it before starting the Fink installed
    one or things could get very confused: 'sudo /usr/sbin/postfix stop'.
 
 4) Run 'sudo daemonic enable postfix-tls'. This will create a Postfix startup
    item, but it won't actually start Postfix. To do that, you can run
    'sudo postfix start'.

Removing postfix via Fink will automatically disable it and re-enable
sendmail.
<<
DescPackaging: <<
Adds startup item via daemonic, and an mta-switch shell script.
NetInfo support disabled since Apple has depreciated it and no longer supplies
the necessary header files.

Original maintainer: Daniel Parks <daniel@maywallacedesign.com>
<<
License: OSI-Approved
Maintainer: Daniel Johnson <daniel@daniel-johnson.org>

Depends: daemonic, db42-shlibs | db42-ssl-shlibs, pcre-shlibs, cyrus-sasl2-shlibs, openssl097-shlibs
BuildDepends: db42 | db42-ssl, pcre, cyrus-sasl2-dev, openssl097-dev
Conflicts: postfix-release, postfix
Replaces: postfix-release, postfix
Recommends: cyrus-sasl2

Source: ftp://ftp.porcupine.org/mirrors/postfix-release/official/postfix-%v.tar.gz
Source-MD5: f96fc9e7cbf9750d4a91475fcbd02a81
Source2: ftp://ftp.aet.tu-cottbus.de/pub/postfix_tls/pfixtls-0.8.18-2.1.3-0.9.7d.tar.gz
Source2-MD5: d3211ebd4d2fbbc9c78235666ed355ac

PatchScript: <<
patch -p1 <../pfixtls-0.8.18-2.1.3-0.9.7d/pfixtls.diff
sed 's|@FINKPREFIX@|%p|g ' <%a/%n.patch | patch -p1
perl -pi.bak -e's,/(etc|var/spool)/postfix,%p/\1/postfix,g' man/man1/* man/man5/* man/man8/* conf/* proto/TLS_README.html html/*.html README_FILES/* ../pfixtls-0.8.18-2.1.3-0.9.7d/doc/*.html
<<

NoSetCPPFLAGS: true
NoSetLDFLAGS: true
CompileScript: <<
make makefiles CCARGS='-DDEF_COMMAND_DIR=\"%p/sbin\" \
	-DDEF_CONFIG_DIR=\"%p/etc/postfix\" \
	-DDEF_DAEMON_DIR=\"%p/lib/postfix\" \
	-DDEF_MAILQ_PATH=\"%p/bin/mailq\" \
	-DDEF_MANPAGE_DIR=\"%p/share/man\" \
	-DDEF_NEWALIAS_PATH=\"%p/bin/newaliases\" \
	-DDEF_README_DIR=\"%p/share/doc/%n/README_FILES\" \
	-DDEF_HTML_DIR=\"%p/share/doc/%n/html\" \
	-DDEF_QUEUE_DIR=\"%p/var/spool/postfix\" \
	-DDEF_SENDMAIL_PATH=\"%p/sbin/sendmail\" \
	-DUSE_SSL -DHAS_DB -DUSE_SASL_AUTH \
	-I. -I%p/include -I%p/include/openssl -I%p/include/db4 -I%p/include/sasl' \
	AUXLIBS="-L%p/lib -lssl -lcrypto -ldb -lsasl2"
make
<<

InstallScript: <<
	/bin/sh postfix-install -non-interactive install_root="%d"
	install -m0755 mta-switch %i/sbin
	mkdir -p %i/share/doc/%n/tls
	install -m0644 ../pfixtls-0.8.18-2.1.3-0.9.7d/doc/*.{html,pl,txt} %i/share/doc/%n/tls
	install -m0644 proto/TLS_README.html %i/share/doc/%n/html
<<
DocFiles: AAAREADME COMPATIBILITY COPYRIGHT HISTORY LICENSE RELEASE_NOTES RELEASE_NOTES-1.1 RELEASE_NOTES-2.0 US_PATENT_6321267
ConfFiles: <<
	%p/etc/postfix/main.cf
	%p/etc/postfix/master.cf
	%p/etc/postfix/access
	%p/etc/postfix/aliases
	%p/etc/postfix/canonical
	%p/etc/postfix/header_checks
	%p/etc/postfix/relocated
	%p/etc/postfix/transport
	%p/etc/postfix/virtual
<<
DaemonicName: postfix-tls
DaemonicFile: <<
	<service>
		<description>Postfix Mail Transfer Agent</description>
		<message>Postfix</message>
		
		<daemon name="postfix">
			<executable checkexit="true">%p/sbin/postfix</executable>
			<parameters>start</parameters>
			<configfile>%p/etc/postfix/main.cf</configfile>
		</daemon>
	</service>
<<

PreInstScript: <<
	echo 'Stopping postfix in case you are upgrading from an old version.'
	{ [ -x %p/sbin/postfix ] && %p/sbin/postfix stop ; } || true
<<
PostInstScript: <<
	%p/etc/postfix/post-install upgrade-package
<<
PreRmScript: <<
	if [ $1 != "upgrade" ]; then
		daemonic remove %n
		echo "Stopping postfix..."
		%p/sbin/postfix stop >& /dev/null || true
		yes 'n' | mta-switch apple
	fi
<<
