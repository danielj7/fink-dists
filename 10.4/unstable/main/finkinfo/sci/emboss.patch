--- EMBOSS-5.0.0/emboss/psiphi.c	2007-07-06 08:15:29.000000000 -0400
+++ EMBOSS-5.0.0-patch/emboss/psiphi.c	2007-07-27 05:28:27.000000000 -0400
@@ -160,7 +160,7 @@
     finishres = ajAcdGetInt("finishresiduenumber");
 
     /* reserve memory for and read in structure */
-    /* JISON */    pdb = ajPdbReadoldNew(pdbfile);
+    /* JISON */    pdb = ajPdbReadNew(pdbfile,0);
     
     /* check and set number of chain to be analysed */
     highest = pdb->Nchn;
@@ -440,6 +440,9 @@
     ajint lowestres = 0;
 
     AjPAtom inlist   = NULL;
+
+    if(!ajListGetLength(pdb->Chains[myindex]->Atoms))
+	ajFatal("Chain %d has no atoms",myindex+1);
     
     /* read first atom in list into memory, but keep it on list */
     ajListPeek(pdb->Chains[myindex]->Atoms,
