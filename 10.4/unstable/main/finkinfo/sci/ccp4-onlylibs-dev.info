Package: ccp4-onlylibs-dev
# Use version numbering to sync with the current CCP4 release:
Version: 6.0   
Revision: 1005
GCC: 4.0
#Source: ftp://ftp.ccp4.ac.uk/prerelease/%n.tar.gz
#Source-MD5: cf085751833aecc7ccef9e67de7e9fcc   
Source: http://chemistry.ucsc.edu/~wgscott/xtal/%n/%n-%v.tar.gz
Source-MD5: d9dd2e786953c812acec42b41a1c08a5   
SourceRename: %n-%v.tar.gz
SourceDirectory: %n
Source2: http://chemistry.ucsc.edu/~wgscott/xtal/%n/%n-extras-0.1.tgz
Source2-MD5: ea307964e3786bef0868ea56aaaa0471
#Source3:  http://chemistry.ucsc.edu/~wgscott/xtal/clipper_%v-src.tgz 
#Source3-MD5: 1c7a91218a4a27af1c2506f39df4692a
Depends:  
BuildDepends: g77 (>= 3.4.0-2), f2c, fort77 
BuildDependsOnly: false
NoSetCPPFLAGS: true
NoSetLDFLAGS: true
###############################################################################
PatchScript: <<
#!/bin/zsh -ef
umask 0022
# Use my patched configure and ccp4.setup-zsh files
cp ../ccp4.setup-zsh include/.
cp ../configure .
# setup scripts for tcsh, zsh and bash users
export TEMPXTAL=$PWD:h
#
perl -pi.bak -e 's|/xtal|\$TEMPXTAL|g' include/ccp4.setup*   
# build prefix (changed in install)
perl -pi.bak -e 's|/prefix|%p|g' include/ccp4.setup*            
# location of tcktk, blt (not needed here, but doesn't hurt).
perl -pi.bak -e 's|/usr/local/bin|%p/bin|g' include/ccp4.setup*   
# same
# make copy for tcsh users (CCP4 convention is no suffix)
cp include/ccp4.setup-dist include/ccp4.setup
#
# We need the mmdbold clipper libraries built for COOT:
perl -pi.bak -e 's|enable_mmdbold=no|enable_mmdbold=yes|g' lib/clipper/configure*
# clean up:
rm -f  include/*.bak lib/clipper/*.bak
<<
###############################################################################
CompileScript: <<
#!/bin/zsh -ef
umask 0022
#cp -R ../src/* lib/clipper/src/.
export TEMPXTAL=$PWD:h
source include/ccp4.setup-zsh
export DYLD_LIBRARY_PATH=$CLIB
#
FC="g77"  ./configure --onlylibs Darwin
#
#  fix some post-configure bugs
#
make -i         2>../make.log  |tee ../make.log      
make -i install 2>../makeinst.log  |tee ../makeinst.log  
#
echo "Ignoring error messages.  They are harmless"
#
command ls -1 lib/*.a
sleep 10
#
make realclean
<<
###############################################################################
InstallScript: <<
#!/bin/zsh -ef
umask 0022
export TEMPXTAL=$PWD:h
source include/ccp4.setup-zsh
export DYLD_LIBRARY_PATH=$CLIB
ORIGDIR=$(dirname $PWD)
#
# Change environment scripts to match final installation install prefix:
 perl -pi.bak -e 's|\$TEMPXTAL|%p/share/xtal|g'         include/ccp4.setup*      
 perl -pi.bak -e 's|CCP4_MASTER/%n|CCP4_MASTER/%n-%v|g' include/ccp4.setup-zsh
 perl -pi.bak -e 's|ccp4-5.99.5|%n-%v|g'                include/ccp4.setup*
 rm -f include/*.bak
 perl -pi.bak -e 's|src/fink.build/%n-%v-%r/%n|share/xtal/%n-%v|g' bin/clipper-config 
 rm -f bin/clipper-config.bak                                                          
 perl -pi.bak -e 's|/src/fink.build/%n-%v-%r/%n/lib|/share/xtal/%n-%v/lib|g' lib/*.la
 rm -f lib/*.la.bak
#
# Now install:
 mkdir -p %i/bin
 mkdir -p %i/share/xtal/%n-%v
 cp bin/* %i/bin/.
 cp -R * %i/share/xtal/%n-%v/.
 ranlib %i/share/xtal/%n-%v/lib/**/*.a
<<
###############################################################################
SplitOff:<<
Package: clipper
Depends: clipper-bin, ccp4-onlylibs-dev
BuildDependsOnly: true
Description: Working Clipper static libs and binaries
DescDetail:<<
Placeholder to install working static clipper libraries and binary
executables for packages that require both to be present for linking.

The aim of the project is to produce a set of object-oriented libraries 
for the organisation of crystallographic data and the performance of
crystallographic computation. The libraries are designed as a framework 
for new crystallographic software, which will allow the full power of 
modern programming techniques to be exploited by the developer. This 
will lead to greater functionality from simpler code which will be easier 
to develop and debug. NOTE:  This is a static version of clipper required
to build COOT and various clipper binary executables like CPIRATE with the
g++-4.0 compiler. 
<<
<<
###############################################################################
SplitOff2: <<
Package: clipper-bin
BuildDependsOnly: false
Files: <<   
bin/*
<<
Description: Working Clipper executables including cpirate
DescDetail:<<
The package clipper-bin installs statically-linked versions of the following
binary executable files that are broken in the ccp4-clipper-bin package in 
the 10.4 branch of fink: cecalc cfft chltofom cinvfft clipper-config 
cmakereference cpatterson cphasecombine cphasematch cpirate csfcalc csigmaa 
superpose.  These executables will be installed in %p/bin.
<<
<<
###############################################################################
###############################################################################
Description: CCP4 and CLIPPER static libraries
DescDetail: <<
This package installs CCP4 libraries, only.  If you need all 
of CCP4, install the self-contained CCP4 package instead of, or
in addition to, this. The splitoff package clipper-bin builds
and installs statically-linked clipper executable programs such
as cpirate. CCP4 itself will also install these, but cpirate in
CCP4 suffers from a run-time error.  Installation of clipper-bin
will put working copies in %p/bin, and thus at the head of the path.
The licensing for the CCP4 library loosely conforms to the LGPL,
unlike the more restrictive CCP4 license. The clipper libraries
and programs explicitly adhere to the LGPL.

This version compiles with the Apple Lapack/Blas framework
but uses its own static lib build of fftw to avoid a run-time
error that appears in cpirate and coot fft calculations.

CCP4lib files will be installed under 
%p/share/xtal/ccp4-onlylibs-dev-6.0. This is essentially
identical in content to the corresponding files in CCP4 6.0.

Programs requiring these libraries to build or run need to
source the appropriate
%p/share/xtal/ccp4-onlylibs-dev-6.0/include/ccp4.setup
file for the shell, as is done in the coot.info file. Unless
you are building something external to fink, there is no need
to source that file.

The primary use for this package, currently, is for compiling COOT.
The primary use for the clipper-bin split-off package is to provide
stand-alone, functioning versions of cpirate and colleagues.
<<
DocFiles: conditions.txt 
Homepage: http://www.ccp4.ac.uk  
License: Restrictive
Maintainer: W. G. Scott <wgscott@users.sourceforge.net>
