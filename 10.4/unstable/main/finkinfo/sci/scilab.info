Info2: <<
Package: scilab%type_pkg[-atlas]
Type: -atlas (boolean)
Version: 4.1.2
Revision: 1002
Maintainer: Jeffrey Whitaker <jswhit@fastmail.fm>
Depends: gcc42-shlibs, (%type_pkg[-atlas]) libgtkhtml2-shlibs, tcltk, (%type_pkg[-atlas]) vte, (%type_raw[-atlas] != -atlas) xaw3d-shlibs
BuildDepends: <<
	gcc42, libgettext3-dev, libiconv-dev, libncurses5, libsablot, ocaml, readline5, tcltk-dev, x11-dev,
	(%type_pkg[-atlas]) atlas,
	(%type_pkg[-atlas]) atk1,
	(%type_pkg[-atlas]) glib2-dev,
	(%type_pkg[-atlas]) gtk+2-dev,
	(%type_pkg[-atlas]) libgtkhtml2,
	(%type_pkg[-atlas]) libxml2,
	(%type_pkg[-atlas]) pango1-xft2-dev,
	(%type_pkg[-atlas]) vte-dev,
	(%type_raw[-atlas] != -atlas) xaw3d
<<
Conflicts: %{Ni}, %{Ni}-atlas
Replaces:  %{Ni}, %{Ni}-atlas
Source: http://www.%{Ni}.org/download/%v/%{Ni}-%v-src.tar.gz
SourceDirectory: %{Ni}-%v
Source-MD5: 17a7a6aa52918f33d96777a0dc423658
Patch: %{Ni}.patch
PatchScript: <<
#!/bin/sh -ev
 perl -pi -e 's,(head|tail) +\-([0-9]),\1 \-n\2,g' scripts/sc_cpp
 perl -pi -e 's|[/]sw/|%p/|g; s|g77|gfortran|g' configure
 perl -pi -e 's,\#ifdef B42UNIX,#define B42UNIX\n#ifdef B42UNIX,' routines/console/zzledt.c
 perl -pi.bak -e 's|.*setslatecjmp.*||g' routines/interf/matimp.f
 sed -i.bak -e '21,42d' scripts/scilab.g.in
 perl -pi -e 's,-DFAKEXDRFLOAT ,,' pvm3/conf/DARWIN.def
 sed -e 's;-Wl,-shared -g ;-Wl,-bundle ;' < routines/Javasci/Makefile.linux > routines/Javasci/Makefile.darwin
 sed -i.bak -e 's,-module,& -bundle_loader %p/lib/scilab-%v/bin/scilex,' \
	-e 's,--quiet,,' -e 's,^\t@,\t,'  Makemex.in config/Makeso.incl.in
# make the scipad editor not crash on startup
 printf "function tklib=gettklib()\n  tklib='@GETLIBTK@'\nendfunction\n" > macros/util/gettklib.sci.in
# don't know how to coax configure to define this:
 sed -i.bak -e '/G95_FORTRAN/c \
#define G95_FORTRAN 1' routines/machine.h.in
# fix perms
 perl -pi -e 's,(install) (ACKNOWLEDGEMENTS),\1 -m 644 \2,' Makefile.in
<<
DescPackaging: Patch and patchscript contain /sw because upstream source does
ConfigureParams: --with-gfortran --with-tcl-include=%p/include --with-tcl-library=%p/lib --with-ocaml --without-java
CompileScript: <<
 #!/bin/sh -ev
 c="%c"; if test %type_raw[-atlas] == "-atlas" ; then c="$c --with-gtk2 --with-atlas-library=%p/lib"; fi
 ./configure $c
# on intel, dlamc1 needs -ffloat-store, otherwise it produces an infinite loop
# doesn't harm on ppc either
# in this version not needed for dlamch, but still needed for slamch
# make FC_OPTIONS="-O2 -ffloat-store" routines/lapack/dlamch.o routines/lapack/slamch.o
 make FC_OPTIONS="-O2 -ffloat-store" routines/lapack/slamch.o
# remove annoying disclaimer from greeting message
 make CFLAGS="-U__APPLE__" routines/system/banier.o
 make all man
<<
InstallScript: <<
#!/bin/sh -ev
 make install PREFIX=%i DESTDIR=%p
 ln -fs %p/lib/%{Ni}-%v/bin/scilab %i/bin/scilab
 ln -fs %p/lib/%{Ni}-%v/bin/intersci %i/bin/intersci
 ln -fs %p/lib/%{Ni}-%v/bin/intersci-n %i/bin/intersci-n
<<
PostInstScript: cd %p/lib/%{Ni}-%v; make
Description: Software package for numerical computations
License: OSI-Approved
Homepage: http://www.scilab.org
<<
