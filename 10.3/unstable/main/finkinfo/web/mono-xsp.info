Package: mono-xsp
Version: 1.0.9
Revision: 2
Source: http://www.go-mono.com/sources/xsp/xsp-%v.tar.gz
Source-MD5: 49edbfb3edf93bdfb712700b18fdc461
DocFiles: AUTHORS COPYING* ChangeLog INSTALL NEWS README
Depends: mono (>= 1.1.8.3-1)
BuildDepends: mono (>= 1.1.8.3-1)
Homepage: http://go-mono.com/
Maintainer: Benjamin Reed <mono-xsp@fink.racoonfink.com>
Description: Mono ASP.Net web server
SetMAKEFLAGS: -j1
NoSetMAKEFLAGS: true
ConfigureParams: --mandir=%p/share/man
CompileScript: <<
#!/bin/sh -ex

  export lt_cv_sys_max_cmd_len=65536
  export MONO_PATH=%b/server:%b/test:$MONO_PATH
  ./configure %c
  make
<<
InstallScript: <<
#!/bin/sh -ex

  export DYLD_FALLBACK_LIBRARY_PATH="%i/lib:/usr/lib"
  make -j1 install DESTDIR=%d
  install -d -m 755 %i/bin
  install -d -m 755 %i/lib/%n
  install -d -m 755 %i/etc/%n
  install -d -m 755 %i/share/doc/%n
  install -d -m 755 %i/var/lib/%n
  touch %i/var/lib/%n/.turd

  mv %i/share/doc/xsp/* %i/share/doc/%n/

  find %i/lib/mono -name \*.exe | while read FILE; do
    FILE`echo $FILE | sed -e 's,^%d,,'`
    FILENAME=`basename $FILE`
    cat <<END >%i/bin/${FILENAME/.exe/}
#!/bin/sh

export MONO_PATH="%p/etc/%n:%p/lib/%n:\$MONO_PATH"
%p/bin/mono %p/lib/mono/$FILENAME "\$@"
END
  done
  chmod 755 %i/bin/*

  cat <<END >%i/etc/%n/web.config
<?xml version="1.0" encoding="utf-8"?>
<configuration>
 <appSettings>
  <add key="MonoServerPort" value="8080"/>
  <add key="MonoApplications" value="/:%p/share/doc/%n/test" />
  <add key="MonoServerRootDir" value="%p/var/lib/%n" />
  
  <!-- MonoServerDefaultIndexFiles is set in web.config -->
 </appSettings>
</configuration>
END

  for file in `cd %i/etc/%n; ls -1 *.exe.config`; do
    ln -sf %p/etc/%n/$file %i/lib/%n/
  done
<<
ConfFiles: <<
  %p/etc/mono-xsp/web.config
<<
DescDetail: <<
The XSP server is a small web server that hosts the Mono
System.Web classes for running what is commonly known as ASP.NET.
<<
License: GPL
