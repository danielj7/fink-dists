Package: libplist
Version: 1.3
Revision: 1
Description: Library for handling apple .plist files
License: GPL/LGPL

# Dependencies:
BuildDependsOnly: true
BuildDepends: <<
  cmake, 
  pkgconfig (>= 0.9.0-1), 
  glib2-dev (>= 2.20.5-1),
 libxml2 (>= 2.6.32-1),
 swig,
 python25 | python26 | python27 | python31
<<
Depends: %N-shlibs (= %v-%r)

# Unpack Phase:
Source: http://github.com/downloads/JonathanBeck/%n/%n-%v.tar.bz2
Source-MD5: 0f48f4da8ddba5d7e186307622bf2c62

# Compile Phase:
CompileScript: <<
#!/bin/sh -ev
  mkdir build
  cd build
  cmake .. -DCMAKE_INSTALL_PREFIX=%p
  make
<<

# Install Phase:
DocFiles: AUTHORS COPYING* README
InstallScript: <<
#!/bin/sh -ev
  cd build
  make install DESTDIR=%i/..
  install_name_tool -id %p/lib/libplist.dylib   %i/lib/libplist.1.1.3.dylib
  install_name_tool -id %p/lib/libplist++.dylib %i/lib/libplist++.1.1.3.dylib
<<

SplitOff: <<
 Package: %N-shlibs
 Depends:  glib2-shlibs (>= 2.20.5-1), libxml2-shlibs (>= 2.6.32-1)

 Files: <<
  lib/libplist.1.1.3.dylib
  lib/libplist.1.dylib
  lib/libplist.dylib
  lib/libplist++.1.1.3.dylib
  lib/libplist++.1.dylib
  lib/libplist++.dylib
 <<
 Shlibs: <<
  %p/lib/libplist.dylib   1.0.0 %n (>= 1.3-1)
  %p/lib/libplist++.dylib 1.0.0 %n (>= 1.3-1)
 <<
<<

Splitoff2: <<
  Package: %N-bin
  Depends: %N-shlibs (= %v-%r)
  Files: bin
<<

# Additional Info
DescDetail: <<
libplist is a library which eases dealing with Apple's property list files.
<<
DescPort: <<
The file should be modified so that setting the install_name is not necessary 
any longer.

suggestion from a fink guru:
# Set up RPATH handling, so the libs are found if they are installed to a non-standard location.
# By default cmake builds the targets with full RPATH to everything in the build directory,
# but then removes the RPATH when installing.
# These two options below make it set the RPATH of the installed targets to all
# RPATH directories outside the current CMAKE_BINARY_DIR and also the library
# install directory.
set(CMAKE_INSTALL_RPATH_USE_LINK_PATH  TRUE)
set(CMAKE_INSTALL_RPATH                ${LIB_DESTINATION} )

if(APPLE)
   set(CMAKE_INSTALL_NAME_DIR ${LIB_DESTINATION})
endif(APPLE)
<<

Homepage: http://www.libimobiledevice.org/
Maintainer: Karl-Michael Schindler <karl-michael.schindler@web.de>
