Package: libcurl4
Version: 7.19.0
Revision: 1
Description: Lib. for transferring files with URL syntax
DescPackaging: <<
  Now use System's OpenSSL.
  
  Packages that also use the system's OpenSSL and link to this
  should be careful to link to the proper libssl and libcrypto.
  Either make sure -L%p/lib/system-openssl/lib comes before -L%p/lib
  when linking, or use a BuildConflicts: openssl-dev, openssl097-dev
  Now links to libssh2.1. Packages that BuildDepend on libcurl4 might
  need to also BuildDepend on system-openssl-dev and libssh2.1 if they
  link to -lssl -lcrypto -lssh2.
  
  No longer need --mandir. Private symbols now hidden with gcc 4.
  Depend on pkgconfig >= 0.20-1
  per http://wiki.finkproject.org/index.php/Fink:Packaging:pkg-config
  
  Disabled LDAP for now. Removed -I/usr/include -L/usr/lib from krb5-config.
  
  Added a prebuilt curl-ca-bundle.crt file since it's no longer included.
  
  Versions of curl before 7.11.1-11 were maintained by Max Horn.
<<
Maintainer: Daniel Johnson <daniel@daniel-johnson.org>
Homepage: http://curl.haxx.se/
License: OSI-Approved

Source: http://curl.haxx.se/download/curl-%v.tar.bz2
Source-MD5: c299c5e0f20f633791b4c4f7ced4effe
# This file includes a set of CA certs downloaded from mozilla.org.
# curl has a script to generate it dynamically, but then the .deb would vary.
Source2: http://homepage.mac.com/danielj7/curl-ca-bundle.20080604.tar.bz2
Source2-MD5: 1400d56896b92f9f39ca5e0add4780b9
Source2ExtractDir: curl-%v
Source3: http://daniel.haxx.se/projects/c-ares/c-ares-1.5.3.tar.gz
Source3-MD5: ec202543a8cb86647f52e1ed4b5c0b37
Source3ExtractDir: curl-%v

Depends: %N-shlibs (= %v-%r), pkgconfig (>= 0.20-1)
BuildDepends: system-openssl-dev, fink (>= 0.25.0), libssh2.1 (>= 0.17-1)
Conflicts: curl-dev, curl-ssl-dev, curl-unified-dev, libcurl3, libcurl3-ssl, libcurl3-unified
Replaces: curl-dev, curl-ssl-dev, curl-unified-dev, libcurl3, libcurl3-ssl, libcurl3-unified
BuildDependsOnly: True

PatchFile: %n.patch
PatchFile-MD5: 439178a815a464db1e79acf7225a9f34
PatchScript: <<
	patch -p1 <%{PatchFile}
	#This patch only needed for 10.4 but doesn't hurt 10.5
	perl -pi -e 's(krb5-config --cflags gssapi)($& | sed "s,-I/usr/include,,g")g; s(krb5-config --libs gssapi)($& | sed "s,-L/usr/lib,,g")g' configure
	/bin/mv c-ares-1.5.3 ares
<<

NoSetCPPFLAGS: true
NoSetLDFLAGS: true
SetCFLAGS: -g -Os
ConfigureParams: <<
	--with-ssl=%p/lib/system-openssl \
	--without-gnutls \
	--with-libssh2=%p \
	--with-gssapi=/usr \
	--without-libidn \
	--disable-ldap \
	--enable-hidden-symbols \
	--enable-ares \
	--with-ca-bundle=%p/share/curl/curl-ca-bundle.crt \
	--disable-dependency-tracking
<<
CompileScript: <<
	#!/bin/sh -ev
	./configure %c
	cd ares
	make
	cd ..
	make
<<
InstallScript: <<
	perl -pi -e 's/-g -Os -Wl,-search_paths_first //g; s/-dynamic //g' curl-config libcurl.pc
	perl -pi -e 's,-L/.*/ares,,g; s,-lcares,,g' curl-config libcurl.pc lib/.libs/libcurl.lai
	make install DESTDIR=%d
	/bin/mkdir -p %I/share/doc/%N
	/bin/cp docs/*.html %I/share/doc/%N
	/bin/mkdir -p %I/share/doc/%N/libcurl
	/bin/cp docs/libcurl/*.html %I/share/doc/%N/libcurl
	/bin/mkdir -p %I/share/aclocal
	/bin/cp docs/libcurl/libcurl.m4 %I/share/aclocal
	/bin/mkdir -p %I/share/curl
	/bin/cp curl-ca-bundle.crt %I/share/curl
<<
DocFiles: CHANGES COPYING README RELEASE-NOTES

SplitOff: <<
  Package: %N-shlibs
  
  Depends: libssh2.1-shlibs (>= 0.17-1)
    
  Files: lib/libcurl.4.1.0.dylib lib/libcurl.4.dylib
  Shlibs: %p/lib/libcurl.4.dylib 6.0.0 %n (>= 7.18.2-1)
  DocFiles: CHANGES COPYING README RELEASE-NOTES
<<

SplitOff2: <<
  Package: curl
  Description: Tool for transferring files with URL syntax
  DescUsage: For additional documentation see the %N package.
  
  Depends: %N-shlibs (= %v-%r)
  Replaces: curl-ssl (<< %v-%r), curl-unified (<< %v-%r)
  
  Files: bin/curl share/man/man1/curl.1 share/curl/curl-ca-bundle.crt
  DocFiles: CHANGES COPYING README RELEASE-NOTES docs/BINDINGS docs/BUGS docs/CONTRIBUTE docs/FAQ docs/FEATURES docs/HISTORY docs/KNOWN_BUGS docs/INTERNALS docs/MANUAL docs/RESOURCES docs/THANKS docs/TODO docs/TheArtOfHttpScripting docs/LICENSE-MIXING docs/SSLCERTS docs/VERSIONS
<<
SplitOff3: <<
  Package: curl-ssl
  Description: OBSOLETE use curl instead
  Depends: curl (= %v-%r), fink-obsolete-packages
  DocFiles: CHANGES COPYING README RELEASE-NOTES
<<
SplitOff4: <<
  Package: curl-unified
  Description: OBSOLETE use curl instead
  Depends: curl (= %v-%r)
  DocFiles: CHANGES COPYING README RELEASE-NOTES
<<

InfoTest: <<
  TestDepends: stunnel4
  TestScript:<<
    #!/bin/bash -ev
    
    #This test fails when run as root.
	echo '1001' >>tests/data/DISABLED
	
	#The SSH tests will also be skipped as root but this isn't fatal.
	
    #Build and run the tests
    make test-full || exit 2
  <<
<<
