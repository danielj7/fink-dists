# TODO fix the dylibs so they have versions
# TODO build and link against libjpeg-turbo
Package: openni
Version: 1.5.2.23
Revision: 1
Homepage: http://www.openni.org
License: GPL3+
Maintainer: Hans-Christoph Steiner <hans@eds.org>
#
Source: https://github.com/OpenNI/OpenNI/tarball/Stable-%v
Source-MD5: 12389c56bf3685a741f6bcfa068585ff
#Source-SHA1: df8998be4e20664f11c7894bca0a2697815ef4b4
SourceRename: OpenNI-OpenNI-Stable-%v-0-g1516074.tar.gz
SourceDirectory: OpenNI-OpenNI-1516074
#
BuildDepends: fink (>= 0.28), libusb1, doxygen, graphviz
Depends: darwin (>= 9-1),  %n-shlibs (= %v-%r)
BuildDependsOnly: true
#
CompileScript: <<
  sed -i 's|/opt/local|%p|' %b/Platform/Linux/Build/OpenNI/Makefile
  sed -i 's|CFLAGS += -arch i386 -arch x86_64||' %b/Platform/Linux/Build/Common/Platform.x86
  sed -i 's|LDFLAGS += -arch i386 -arch x86_64||' %b/Platform/Linux/Build/Common/Platform.x86
  make -C %b/Platform/Linux/Build
  mkdir %b/Source/DoxyGen/html
  cd %b/Source/DoxyGen/ && doxygen
  # remove unneeded files
  rm -rf html/*.map html/*.md5 html/*.hhc html/*.hhk html/*.hhp
<<
InstallScript: <<
	install -d %i/bin
	install -p %b/Platform/Linux/Bin/x86-Release/niLicense \
		%b/Platform/Linux/Bin/x86-Release/niReg \
		%i/bin
	install -d %i/lib
	install -p \
            %b/Platform/Linux/Bin/x86-Release/libOpenNI.dylib \
            %b/Platform/Linux/Bin/x86-Release/libOpenNI.jni.dylib \
            %b/Platform/Linux/Bin/x86-Release/libnimCodecs.dylib \
            %b/Platform/Linux/Bin/x86-Release/libnimMockNodes.dylib \
            %b/Platform/Linux/Bin/x86-Release/libnimRecorder.dylib \
            %i/lib
        install_name_tool -id %p/lib/libOpenNI.dylib  %i/lib/libOpenNI.dylib
        install_name_tool -id %p/lib/libOpenNI.jni.dylib  %i/lib/libOpenNI.jni.dylib
        install_name_tool -id %p/lib/libnimCodecs.dylib  %i/lib/libnimCodecs.dylib
        install_name_tool -id %p/lib/libnimMockNodes.dylib  %i/lib/libnimMockNodes.dylib
        install_name_tool -id %p/lib/libnimRecorder.dylib  %i/lib/libnimRecorder.dylib
	install -d %i/include/ni
	install -p %b/Include/*.h  %i/include/ni
	install -p %b/Include/MacOSX/*.h  %i/include/ni
	install -d %i/var/lib/ni
	install -d %i/etc/primesense
<<
DocFiles: CHANGES GPL.txt LGPL.txt README Documentation/OpenNI_UserGuide.pdf Documentation/OpenNI.chm %b/Source/DoxyGen/html
Description: Sensor-based Natural Interaction framework
DescDetail: <<
 OpenNI is a framework for getting data to support 'Natural Interaction',
 i.e. skeleton tracking, gesture tracking, and similar ways of getting data
 from humans. OpenNI provides the interface for physical devices and for
 middleware components. The API enables modules to be registered in the OpenNI
 framework, which then produce sensory data. OpenNI also allows selection of
 different hardware and middleware modules.
<<
SplitOff: <<
	Package: %N-shlibs
        Depends: libusb1-shlibs
	Files: <<
            %p/lib/libOpenNI.dylib
            %p/lib/libOpenNI.jni.dylib
            %p/lib/libnimCodecs.dylib
            %p/lib/libnimMockNodes.dylib
            %p/lib/libnimRecorder.dylib
	<<
	Shlibs: <<
            %p/lib/libOpenNI.dylib 0.0.0 %n (>= 1.5.2.23-1)
            %p/lib/libOpenNI.jni.dylib 0.0.0 %n (>= 1.5.2.23-1)
            %p/lib/libnimCodecs.dylib 0.0.0 %n (>= 1.5.2.23-1)
            %p/lib/libnimMockNodes.dylib 0.0.0 %n (>= 1.5.2.23-1)
            %p/lib/libnimRecorder.dylib 0.0.0 %n (>= 1.5.2.23-1)
	<<
        DocFiles: CHANGES GPL.txt LGPL.txt README
<<
