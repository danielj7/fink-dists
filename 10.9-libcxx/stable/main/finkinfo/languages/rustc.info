Package: rustc
Version: 1.18.0
Revision: 1
Description: Safe Fast System Programming Language
Maintainer: Brendan Cully <fink@brendan.cully.org>
License: BSD

Conflicts: rust (<< 1.11.0-2)
Replaces: rust (<< 1.11.0-2)

Source: https://static.rust-lang.org/dist/rustc-%v-src.tar.gz
Source-MD5: c37c0cd9d500f6a9d1f2f44401351f88
SourceDirectory: rustc-%v-src

Source2: https://static.rust-lang.org/dist/2017-04-27/rust-std-1.17.0-x86_64-apple-darwin.tar.gz
Source2-MD5: 4df47791800c1dec50258436f44be7ca
# prevent automatic unpacking
Source2Rename: rust-std-1.17.0-x86_64-apple-darwin.tar.gz.nounpack

# derived from src/stage0.txt
Source3: https://static.rust-lang.org/dist/2017-04-27/rustc-1.17.0-x86_64-apple-darwin.tar.gz
Source3-MD5: 52854e43e8d544640351f95dceabc302
Source3Rename: rustc-1.17.0-x86_64-apple-darwin.tar.gz.nounpack

Source4: https://static.rust-lang.org/dist/2017-04-27/cargo-0.18.0-x86_64-apple-darwin.tar.gz
Source4-MD5: d7784f76423014b89acbf50594550854
Source4Rename: cargo-bootstrap-%v-x86_64-apple-darwin.tar.gz.nounpack

BuildDepends: cmake

PatchScript: <<
#!/bin/sh -ev
cat > config.toml <<EOF
[build]
vendor = true
#extended = true

[install]
prefix = "%i"

[rust]
codegen-units = 0
channel = "stable"
rpath = false
EOF
<<

CompileScript: <<
#!/bin/sh -ev
mkdir -p build/cache/2017-04-27
mv ../rust-std-1.17.0-x86_64-apple-darwin.tar.gz.nounpack build/cache/2017-04-27/rust-std-1.17.0-x86_64-apple-darwin.tar.gz
mv ../rustc-1.17.0-x86_64-apple-darwin.tar.gz.nounpack build/cache/2017-04-27/rustc-1.17.0-x86_64-apple-darwin.tar.gz
mkdir build/cache/6b05583d71f982bcad049b9fa094c637c062e751
mv ../cargo-bootstrap-%v-x86_64-apple-darwin.tar.gz.nounpack build/cache/2017-04-27/cargo-0.18.0-x86_64-apple-darwin.tar.gz

# LC_CTYPE to unconfuse configparser
LC_CTYPE=UTF-8 ./x.py build
./x.py dist
<<
InstallScript: <<
#!/bin/sh -ev
  ./x.py dist --install

  mv %i/share/doc/rust %i/share/doc/%n
  
  # lib path is in build tree
  for tgt in %i/bin/* %i/lib/*.dylib; do
    for lib in $(otool -L $tgt | grep %b | awk '{print $1}')
    do
      install_name_tool -change $lib %p/lib/$(basename $lib) $tgt
    done
  done

  for tgt in %i/lib/*.dylib
  do
    install_name_tool -id %p/lib/$(basename $tgt) $tgt
  done

  # https://github.com/rust-lang/rust/issues/39870
  # it turns out that the libraries in rustlib are meant to point to
  # the same shared lib as in the root, and bad things happen if
  # a binary ends up linking to both copies. So just replace the
  # rustlib version with a symlink to the parent.
  for tgt in %i/lib/rustlib/x86_64-apple-darwin/lib/*.dylib
  do
    lib=$(basename $tgt)
    if [ -f %i/lib/$lib ]
    then
      ln -sf %p/lib/$lib $tgt
    fi
  done
<<
Shlibs: <<
  %p/lib/libarena-66ac9ba78a9d87f2.dylib 0.0.0 %n (>= 1.18.0-1)
  %p/lib/libflate-71c09e3ba75e0a4c.dylib 0.0.0 %n (>= 1.18.0-1)
  %p/lib/libfmt_macros-71309396ff645e94.dylib 0.0.0 %n (>= 1.18.0-1)
  %p/lib/libgetopts-853d82a0ad48e88f.dylib 0.0.0 %n (>= 1.18.0-1)
  %p/lib/libgraphviz-f312795bfd8d04f1.dylib 0.0.0 %n (>= 1.18.0-1)
  %p/lib/libproc_macro-c530a72ec5d01c8e.dylib 0.0.0 %n (>= 1.18.0-1)
  %p/lib/libproc_macro_plugin-70207c1c3635a328.dylib 0.0.0 %n (>= 1.18.0-1)
  %p/lib/librustc-c803fedffb0bf651.dylib 0.0.0 %n (>= 1.18.0-1)
  %p/lib/librustc_back-e875d9e5c83b075b.dylib 0.0.0 %n (>= 1.18.0-1)
  %p/lib/librustc_borrowck-7b6e8b7cbd728847.dylib 0.0.0 %n (>= 1.18.0-1)
  %p/lib/librustc_const_eval-e3d740aab49e5d89.dylib 0.0.0 %n (>= 1.18.0-1)
  %p/lib/librustc_const_math-6d07336892b9c4b9.dylib 0.0.0 %n (>= 1.18.0-1)
  %p/lib/librustc_data_structures-ddbbd2218e51d4cb.dylib 0.0.0 %n (>= 1.18.0-1)
  %p/lib/librustc_driver-df774d2304b92eea.dylib 0.0.0 %n (>= 1.18.0-1)
  %p/lib/librustc_errors-972b1315a011c81a.dylib 0.0.0 %n (>= 1.18.0-1)
  %p/lib/librustc_incremental-1cc890ef2cbcb9a6.dylib 0.0.0 %n (>= 1.18.0-1)
  %p/lib/librustc_lint-baa0f6902880c8ec.dylib 0.0.0 %n (>= 1.18.0-1)
  %p/lib/librustc_llvm-501826cbc9b37f51.dylib 0.0.0 %n (>= 1.18.0-1)
  %p/lib/librustc_metadata-b384ea4e19c6251c.dylib 0.0.0 %n (>= 1.18.0-1)
  %p/lib/librustc_mir-929ec2e82306b431.dylib 0.0.0 %n (>= 1.18.0-1)
  %p/lib/librustc_passes-d8b0863c1fad1145.dylib 0.0.0 %n (>= 1.18.0-1)
  %p/lib/librustc_platform_intrinsics-c1c132cd244d5769.dylib 0.0.0 %n (>= 1.18.0-1)
  %p/lib/librustc_plugin-652ec1b52e58dbea.dylib 0.0.0 %n (>= 1.18.0-1)
  %p/lib/librustc_privacy-4fbf1c6d1eb10c0d.dylib 0.0.0 %n (>= 1.18.0-1)
  %p/lib/librustc_resolve-cfa7ffb29dc82169.dylib 0.0.0 %n (>= 1.18.0-1)
  %p/lib/librustc_save_analysis-aa72ce6682d622c4.dylib 0.0.0 %n (>= 1.18.0-1)
  %p/lib/librustc_trans-9b96d1525d3ffbe1.dylib 0.0.0 %n (>= 1.18.0-1)
  %p/lib/librustc_typeck-203c5250c37ca768.dylib 0.0.0 %n (>= 1.18.0-1)
  %p/lib/librustdoc-cacb5a11b11868a5.dylib 0.0.0 %n (>= 1.18.0-1)
  %p/lib/libserialize-3ed29f464364d166.dylib 0.0.0 %n (>= 1.18.0-1)
  %p/lib/libstd-526b429286ada34e.dylib 0.0.0 %n (>= 1.18.0-1)
  %p/lib/libsyntax-c806fbe846d4cafa.dylib 0.0.0 %n (>= 1.18.0-1)
  %p/lib/libsyntax_ext-2505dbc30b9d0467.dylib 0.0.0 %n (>= 1.18.0-1)
  %p/lib/libsyntax_pos-88b60da84fcf9ec0.dylib 0.0.0 %n (>= 1.18.0-1)
  %p/lib/libterm-c0f7e6449f9028bc.dylib 0.0.0 %n (>= 1.18.0-1)
  %p/lib/libtest-6e494fd77ce56055.dylib 0.0.0 %n (>= 1.18.0-1)
<<
DocFiles: <<
  CONTRIBUTING.md COPYRIGHT LICENSE-APACHE LICENSE-MIT README.md RELEASES.md
<<

Homepage: http://www.rust-lang.org/
DescDetail: <<
Rust is a curly-brace, block-structured expression language. It visually
resembles the C language family, but differs significantly in syntactic
and semantic details. Its design is oriented toward concerns of
"programming in the large", that is, of creating and maintaining
boundaries - both abstract and operational - that preserve large-system
integrity, availability and concurrency.

It supports a mixture of imperative procedural, concurrent actor,
object-oriented and pure functional styles. Rust also supports generic
programming and metaprogramming, in both static and dynamic styles.
<<
