# Let Fink install the document files into the proper location instead
# of having rdiff-backup's setup.py do it, which also puts its version
# number in the document directory name.

diff -ru rdiff-backup-1.0.0-orig/setup.py rdiff-backup-1.0.0/setup.py
--- rdiff-backup-1.0.0-orig/setup.py	2004-01-31 20:31:34.000000000 -0800
+++ rdiff-backup-1.0.0/setup.py	2004-03-08 19:01:56.000000000 -0800
@@ -56,7 +56,4 @@
 							   libraries=libname,
 							   extra_link_args=lflags_arg)],
 	  scripts = ['rdiff-backup'],
-	  data_files = [('share/man/man1', ['rdiff-backup.1']),
-					('share/doc/rdiff-backup-%s' % (version_string,),
-					 ['CHANGELOG', 'COPYING', 'README', 'FAQ.html'])])
-
+	  data_files = [('share/man/man1', ['rdiff-backup.1'])])

# Backout the patch from 0.13.6 to 1.0.0 that uses lchown, which Mac OS
# X 10.3 does not have.  This reverts the 1.0.0 behavior to the 0.13.6
# behavior.

diff -ru rdiff-backup-1.0.0.orig/cmodule.c rdiff-backup-1.0.0/cmodule.c
--- rdiff-backup-1.0.0.orig/cmodule.c	2005-08-13 23:12:55.000000000 -0700
+++ rdiff-backup-1.0.0/cmodule.c	2005-08-31 20:01:59.000000000 -0700
@@ -368,36 +368,6 @@
   return Py_BuildValue("s", unquote(s));
 }
 
-/* ------------- lchown taken from Python's posixmodule.c -------------- */
-/* duplicate here to avoid v2.3 requirement */
-
-static PyObject *
-posix_error_with_allocated_filename(char* name)
-{
-	PyObject *rc = PyErr_SetFromErrnoWithFilename(PyExc_OSError, name);
-	PyMem_Free(name);
-	return rc;
-}
-
-static PyObject *
-posix_lchown(PyObject *self, PyObject *args)
-{
-	char *path = NULL;
-	int uid, gid;
-	int res;
-	if (!PyArg_ParseTuple(args, "etii:lchown",
-	                      Py_FileSystemDefaultEncoding, &path,
-	                      &uid, &gid))
-		return NULL;
-	Py_BEGIN_ALLOW_THREADS
-	res = lchown(path, (uid_t) uid, (gid_t) gid);
-	Py_END_ALLOW_THREADS
-	if (res < 0)
-		return posix_error_with_allocated_filename(path);
-	PyMem_Free(path);
-	Py_INCREF(Py_None);
-	return Py_None;
-}
 
 /* ------------- Python export lists -------------------------------- */
 
@@ -411,8 +381,6 @@
    "Quote string, escaping non-printables"},
   {"acl_unquote", acl_unquote, METH_VARARGS,
    "Unquote string, producing original input to quote"},
-  {"lchown", posix_lchown, METH_VARARGS,
-   "Like chown, but don't follow symlinks"},
   {NULL, NULL, 0, NULL}
 };
 
diff -ru rdiff-backup-1.0.0.orig/rdiff_backup/rpath.py rdiff-backup-1.0.0/rdiff_backup/rpath.py
--- rdiff-backup-1.0.0.orig/rdiff_backup/rpath.py	2005-08-13 23:12:55.000000000 -0700
+++ rdiff-backup-1.0.0/rdiff_backup/rpath.py	2005-08-31 20:01:38.000000000 -0700
@@ -777,7 +777,7 @@
 
 	def chown(self, uid, gid):
 		"""Set file's uid and gid"""
-		self.conn.C.lchown(self.path, uid, gid)
+		self.conn.os.chown(self.path, uid, gid)
 		self.data['uid'] = uid
 		self.data['gid'] = gid
 
