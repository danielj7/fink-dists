diff -Nurd -x'*~' gtk-doc-1.11.orig/gtkdoc-common.pl.in gtk-doc-1.11/gtkdoc-common.pl.in
--- gtk-doc-1.11.orig/gtkdoc-common.pl.in	2008-09-10 12:17:57.000000000 -0400
+++ gtk-doc-1.11/gtkdoc-common.pl.in	2009-05-11 21:31:05.000000000 -0400
@@ -51,7 +51,7 @@
     my $exit_code = 1;
 
     if (-e $old_file) {
-	`cmp -s $old_file $new_file`;
+	`cmp -s "$old_file" "$new_file"`;
 	$exit_code = $? >> 8;
 #	print "   cmp exit code: $exit_code ($?)\n";
     }
diff -Nurd -x'*~' gtk-doc-1.11.orig/gtkdoc-depscan.in gtk-doc-1.11/gtkdoc-depscan.in
--- gtk-doc-1.11.orig/gtkdoc-depscan.in	2007-12-20 09:09:16.000000000 -0500
+++ gtk-doc-1.11/gtkdoc-depscan.in	2009-04-07 12:50:54.000000000 -0400
@@ -260,7 +260,7 @@
     path = path and path.split(':') or []
 
     prefix = popen(
-        'pkg-config --variable=prefix glib-2.0'
+        '@prefix@'
         ).readline().rstrip()
 
     path.insert(0, prefix)
diff -Nurd -x'*~' gtk-doc-1.11.orig/gtkdoc-fixxref.in gtk-doc-1.11/gtkdoc-fixxref.in
--- gtk-doc-1.11.orig/gtkdoc-fixxref.in	2008-06-08 01:30:22.000000000 -0400
+++ gtk-doc-1.11/gtkdoc-fixxref.in	2009-04-07 12:23:39.000000000 -0400
@@ -80,7 +80,7 @@
 
 # We scan the directory containing GLib and any directories in GNOME2_PATH
 # first, but these will be overriden by any later scans.
-$dir = `pkg-config --variable=prefix glib-2.0`;
+$dir = '@prefix@';
 $dir =~ s/\s+$//;
 $dir = $dir . "/share/gtk-doc/html";
 if (-d $dir && $dir ne $HTML_DIR) {
diff -Nurd -x'*~' gtk-doc-1.11.orig/gtkdoc-rebase.in gtk-doc-1.11/gtkdoc-rebase.in
--- gtk-doc-1.11.orig/gtkdoc-rebase.in	2008-06-03 16:40:35.000000000 -0400
+++ gtk-doc-1.11/gtkdoc-rebase.in	2009-04-07 12:23:19.000000000 -0400
@@ -105,7 +105,7 @@
     }
 }
 
-$dir = `pkg-config --variable=prefix glib-2.0`;
+$dir = '@prefix@';
 $dir =~ s/^\s*(\S*)\s*$/$1/;
 $dir = $dir . "/share/gtk-doc/html";
 print "Prepending GLib directory $dir\n" if $VERBOSE;
diff -Nurd -x'*~' gtk-doc-1.11.orig/gtkdoc-scangobj.in gtk-doc-1.11/gtkdoc-scangobj.in
--- gtk-doc-1.11.orig/gtkdoc-scangobj.in	2008-10-27 15:30:18.000000000 -0400
+++ gtk-doc-1.11/gtkdoc-scangobj.in	2009-04-24 22:18:01.000000000 -0400
@@ -1528,6 +1528,7 @@
 $LD = $ENV{LD} ? $ENV{LD} : $CC;
 $CFLAGS = $ENV{CFLAGS} ? $ENV{CFLAGS} : "";
 $LDFLAGS = $ENV{LDFLAGS} ? $ENV{LDFLAGS} : "";
+$RUN = $ENV{RUN} ? $ENV{RUN} : "";
 
 my $o_file;
 if ($CC =~ /libtool/) {
@@ -1545,7 +1546,8 @@
 system($command) == 0 or die "Linking of scanner failed: $!\n";
 
 print "gtk-doc: Running scanner $MODULE-scan\n";
-system("$ENV{RUN} ./$MODULE-scan") == 0 or die "Scan failed: $!\n";
+# use sh -c to avoid terminating the whole run without seeing the error
+system("sh -c \"$RUN ./$MODULE-scan\"") == 0 or die "Scan failed: $!\n";
 
 unlink "./$MODULE-scan.c", "./$MODULE-scan.o", "./$MODULE-scan.lo", "./$MODULE-scan";
 
diff -Nurd -x'*~' gtk-doc-1.11.orig/gtkdoc-scanobj.in gtk-doc-1.11/gtkdoc-scanobj.in
--- gtk-doc-1.11.orig/gtkdoc-scanobj.in	2008-06-08 01:36:02.000000000 -0400
+++ gtk-doc-1.11/gtkdoc-scanobj.in	2009-04-24 22:18:19.000000000 -0400
@@ -803,6 +803,7 @@
 $LD = $ENV{LD} ? $ENV{LD} : $CC;
 $CFLAGS = $ENV{CFLAGS} ? $ENV{CFLAGS} : "";
 $LDFLAGS = $ENV{LDFLAGS} ? $ENV{LDFLAGS} : "";
+$RUN = $ENV{RUN} ? $ENV{RUN} : "";
 
 my $o_file;
 if ($CC =~ /libtool/) {
@@ -820,7 +821,8 @@
 system($command) == 0 or die "Linking of scanner failed: $!\n";
 
 print "gtk-doc: Running scanner $MODULE-scan\n";
-system("sh -c ./$MODULE-scan") == 0 or die "Scan failed: $!\n";
+# use sh -c to avoid terminating the whole run without seeing the error
+system("sh -c \"$RUN ./$MODULE-scan\"") == 0 or die "Scan failed: $!\n";
 
 unlink "./$MODULE-scan.c", "./$MODULE-scan.o", "./$MODULE-scan.lo", "./$MODULE-scan";
 
