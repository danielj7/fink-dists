#this first patch fixes:
#libtool-disable-static: line 3664: Mach-O dynamically linked shared library: command not found
--- flac-1.1.1/ltmain.sh.orig	Sat Nov  6 14:12:46 2004
+++ flac-1.1.1/ltmain.sh	Sat Nov  6 14:14:23 2004
@@ -24,6 +24,10 @@
 # configuration script generated by Autoconf, you may include it under
 # the same distribution terms that you use for the rest of that program.
 
+SED=sed
+EGREP=egrep
+max_cmd_len=4096
+
 # Check that we have a working $echo.
 if test "X$1" = X--no-reexec; then
   # Discard the --no-reexec flag, and continue.
@@ -2280,7 +2280,7 @@
 
 	  if test "$installed" = no; then
 	    notinst_deplibs="$notinst_deplibs $lib"
-	    need_relink=yes
+	   # need_relink=yes
 	  fi
 
 	  if test -n "$old_archive_from_expsyms_cmds"; then
@@ -3883,6 +3883,11 @@
 	  if test -n "$export_symbols" && test -n "$archive_expsym_cmds"; then
 	    cmds=$archive_expsym_cmds
 	  else
+	    if test "x$verstring" = "x0.0"; then
+	      tmp_verstring=
+	    else
+	      tmp_verstring="$verstring"
+	    fi
 	    cmds=$archive_cmds
 	    fi
 	  fi

--- flac-1.1.0/configure.orig	Sun Nov  2 23:33:50 2003
+++ flac-1.1.0/configure	Sun Nov  2 23:38:30 2003
@@ -5850,13 +5850,13 @@
       allow_undefined_flag='-undefined suppress'
       ;;
     *) # Darwin 1.3 on
-      allow_undefined_flag='-flat_namespace -undefined suppress'
+      allow_undefined_flag='-flat_namespace -undefined dynamic_lookup'
       ;;
     esac
     # FIXME: Relying on posixy $() will cause problems for
     #        cross-compilation, but unfortunately the echo tests do not
     #        yet detect zsh echo's removal of \ escapes.
-    archive_cmds='$nonopt $(test "x$module" = xyes && echo -bundle || echo -dynamiclib) $allow_undefined_flag -o $lib $libobjs $deplibs$linker_flags -install_name $rpath/$soname $verstring'
+    archive_cmds='$nonopt $(test x$module = xyes && echo -bundle || echo -dynamiclib) $allow_undefined_flag -o $lib $libobjs $deplibs$linker_flags $(test .$module != .yes && echo -install_name $rpath/$soname $tmp_verstring)'
     # We need to add '_' to the symbols in $export_symbols first
     #archive_expsym_cmds="$archive_cmds"' && strip -s $export_symbols'
     hardcode_direct=yes
--- flac-1.1.1/src/Makefile.in.orig	Sat Nov  6 14:54:39 2004
+++ flac-1.1.1/src/Makefile.in	Sat Nov  6 14:54:48 2004
@@ -219,7 +219,6 @@
 sharedstatedir = @sharedstatedir@
 sysconfdir = @sysconfdir@
 target_alias = @target_alias@
-@FLaC__HAS_XMMS_TRUE@XMMS_DIRS = plugin_xmms
 @FLaC__HAS_OGG_TRUE@OGGFLAC_DIRS = libOggFLAC libOggFLAC++
 @FLaC__HAS_OGG_TRUE@OGGFLAC_TEST_DIRS = test_libOggFLAC test_libOggFLAC++
 SUBDIRS = \
