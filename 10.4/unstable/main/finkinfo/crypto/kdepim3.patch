diff -Nurd kdepim-3.5.10/akregator/src/Makefile.am kdepim-3.5.10-new/akregator/src/Makefile.am
--- kdepim-3.5.10/akregator/src/Makefile.am	2006-10-01 13:30:25.000000000 -0400
+++ kdepim-3.5.10-new/akregator/src/Makefile.am	2009-04-17 16:23:32.000000000 -0400
@@ -16,12 +16,13 @@
 #########################################################################
 # this is the program that gets installed.  it's name is used for all
 # of the other Makefile.am variables
-bin_PROGRAMS = akregator
+bin_PROGRAMS = 
+kdeinit_LTLIBRARIES = akregator.la
 
 # the application source, library search path, and link libraries
-akregator_SOURCES = main.cpp mainwindow.cpp
-akregator_LDFLAGS = $(KDE_RPATH) $(all_libraries)
-akregator_LDADD = $(LIB_KPARTS) libakregatorprivate.la
+akregator_la_SOURCES = main.cpp mainwindow.cpp
+akregator_la_LDFLAGS = $(KDE_PLUGIN) $(all_libraries) -module
+akregator_la_LIBADD = $(LIB_KPARTS) libakregatorprivate.la
 #akregator_LDADD = $(LIB_KPARTS) libakregatorprivate.la $(top_builddir)/libkdepim/libkdepim.la
 
 # this is where the desktop file will go
@@ -76,7 +77,7 @@
                                 dragobjects.cpp \
                                 utils.cpp
 				
-libakregatorprivate_la_LDFLAGS = $(all_libraries) -avoid-version -no-undefined 
+libakregatorprivate_la_LDFLAGS = $(all_libraries) -no-undefined 
 libakregatorprivate_la_LIBADD =	$(top_builddir)/libkdepim/libkdepim.la \
 	$(top_builddir)/akregator/src/librss/librsslocal.la $(LIB_KHTML)
 
diff -Nurd kdepim-3.5.10/akregator/src/main.cpp kdepim-3.5.10-new/akregator/src/main.cpp
--- kdepim-3.5.10/akregator/src/main.cpp	2007-01-15 06:28:31.000000000 -0500
+++ kdepim-3.5.10-new/akregator/src/main.cpp	2009-04-17 16:23:32.000000000 -0400
@@ -85,7 +85,7 @@
 
 } // namespace Akregator
 
-int main(int argc, char **argv)
+extern "C" KDE_EXPORT int kdemain(int argc, char **argv)
 {
     Akregator::AboutData about;
     KCmdLineArgs::init(argc, argv, &about);
diff -Nurd kdepim-3.5.10/certmanager/Makefile.am kdepim-3.5.10-new/certmanager/Makefile.am
--- kdepim-3.5.10/certmanager/Makefile.am	2005-09-10 04:23:51.000000000 -0400
+++ kdepim-3.5.10-new/certmanager/Makefile.am	2009-04-17 16:23:32.000000000 -0400
@@ -4,9 +4,11 @@
 
 INCLUDES = -I$(srcdir)/lib -I$(top_srcdir)/libkdenetwork $(GPGME_CFLAGS) $(all_includes)
 
-bin_PROGRAMS = kleopatra
+bin_PROGRAMS = 
+lib_LTLIBRARIES =
+kdeinit_LTLIBRARIES = kleopatra.la
 
-kleopatra_SOURCES = \
+kleopatra_la_SOURCES = \
 	customactions.cpp \
 	aboutdata.cpp \
 	main.cpp certmanager.cpp \
@@ -17,8 +19,8 @@
 
 METASOURCES = AUTO
 
-kleopatra_LDFLAGS = $(all_libraries) $(KDE_RPATH)
-kleopatra_LDADD   = conf/libconf.la lib/libkleopatra.la $(LIB_KUTILS) $(LIB_KABC)
+kleopatra_la_LDFLAGS = $(all_libraries) $(KDE_PLUGIN)
+kleopatra_la_LIBADD  = conf/libconf.la lib/libkleopatra.la $(LIB_KUTILS) $(LIB_KABC)
 
 rcdir = $(kde_datadir)/kleopatra
 rc_DATA = kleopatraui.rc
diff -Nurd kdepim-3.5.10/certmanager/conf/Makefile.am kdepim-3.5.10-new/certmanager/conf/Makefile.am
--- kdepim-3.5.10/certmanager/conf/Makefile.am	2005-10-10 11:02:19.000000000 -0400
+++ kdepim-3.5.10-new/certmanager/conf/Makefile.am	2009-04-17 16:23:32.000000000 -0400
@@ -15,7 +15,7 @@
 	appearanceconfigwidget.cpp \
 	dnorderconfigpage.cpp
 
-kcm_kleopatra_la_LDFLAGS = $(all_libraries) -module -avoid-version -no-undefined
+kcm_kleopatra_la_LDFLAGS = $(all_libraries) $(KDE_PLUGIN)
 kcm_kleopatra_la_LIBADD = ../lib/libkleopatra.la $(LIB_KDEUI)
 
 kde_services_DATA = \
diff -Nurd kdepim-3.5.10/certmanager/kwatchgnupg/Makefile.am kdepim-3.5.10-new/certmanager/kwatchgnupg/Makefile.am
--- kdepim-3.5.10/certmanager/kwatchgnupg/Makefile.am	2005-09-10 04:23:49.000000000 -0400
+++ kdepim-3.5.10-new/certmanager/kwatchgnupg/Makefile.am	2009-04-17 16:23:32.000000000 -0400
@@ -2,9 +2,11 @@
 
 INCLUDES = -I$(top_srcdir)/certmanager/lib -I$(top_srcdir)/libkdenetwork $(GPGME_CFLAGS) $(all_includes)
 
-bin_PROGRAMS = kwatchgnupg
+bin_PROGRAMS = 
+lib_LTLIBRARIES =
+kdeinit_LTLIBRARIES = kwatchgnupg.la
 
-kwatchgnupg_SOURCES = \
+kwatchgnupg_la_SOURCES = \
 	kwatchgnupgmainwin.cpp \
 	kwatchgnupgconfig.cpp \
 	aboutdata.cpp \
@@ -13,8 +15,8 @@
 
 METASOURCES = AUTO
 
-kwatchgnupg_LDFLAGS = $(all_libraries) $(KDE_RPATH)
-kwatchgnupg_LDADD   = ../conf/libconf.la ../lib/libkleopatra.la $(LIB_KUTILS) $(LIB_KABC)
+kwatchgnupg_la_LDFLAGS = $(all_libraries) $(KDE_PLUGIN)
+kwatchgnupg_la_LIBADD  = ../conf/libconf.la ../lib/libkleopatra.la $(LIB_KUTILS) $(LIB_KABC)
 
 rcdir = $(kde_datadir)/kwatchgnupg
 rc_DATA = kwatchgnupgui.rc
diff -Nurd kdepim-3.5.10/certmanager/kwatchgnupg/main.cpp kdepim-3.5.10-new/certmanager/kwatchgnupg/main.cpp
--- kdepim-3.5.10/certmanager/kwatchgnupg/main.cpp	2005-09-10 04:23:49.000000000 -0400
+++ kdepim-3.5.10-new/certmanager/kwatchgnupg/main.cpp	2009-04-17 16:23:32.000000000 -0400
@@ -74,7 +74,7 @@
   return KUniqueApplication::newInstance();
 }
 
-int main( int argc, char** argv )
+extern "C" KDE_EXPORT int kdemain( int argc, char** argv )
 {
   AboutData aboutData;
 
diff -Nurd kdepim-3.5.10/certmanager/main.cpp kdepim-3.5.10-new/certmanager/main.cpp
--- kdepim-3.5.10/certmanager/main.cpp	2005-09-10 04:23:51.000000000 -0400
+++ kdepim-3.5.10-new/certmanager/main.cpp	2009-04-17 16:23:32.000000000 -0400
@@ -46,7 +46,7 @@
 #include <kglobal.h>
 #include <kiconloader.h>
 
-int main( int argc, char** argv )
+extern "C" KDE_EXPORT int kdemain( int argc, char** argv )
 {
   AboutData aboutData;
 
diff -Nurd kdepim-3.5.10/kabc/frontend/Makefile.am kdepim-3.5.10-new/kabc/frontend/Makefile.am
--- kdepim-3.5.10/kabc/frontend/Makefile.am	2005-09-10 04:24:24.000000000 -0400
+++ kdepim-3.5.10-new/kabc/frontend/Makefile.am	2009-04-17 16:23:32.000000000 -0400
@@ -2,9 +2,11 @@
 
 METASOURCES = AUTO
 
-bin_PROGRAMS = kabcfrontend
+bin_PROGRAMS = 
+lib_LTLIBRARIES =
+kdeinit_LTLIBRARIES = kabcfrontend.la
 
-kabcfrontend_LDFLAGS = $(all_libraries) $(KDE_RPATH)
-kabcfrontend_LDADD = -lkabc $(LIB_KDECORE)
-kabcfrontend_SOURCES = main.cpp mainWindow.ui
+kabcfrontend_la_LDFLAGS = $(all_libraries) $(KDE_PLUGIN)
+kabcfrontend_la_LIBADD = -lkabc $(LIB_KDECORE)
+kabcfrontend_la_SOURCES = main.cpp mainWindow.ui
 
diff -Nurd kdepim-3.5.10/kabc/frontend/main.cpp kdepim-3.5.10-new/kabc/frontend/main.cpp
--- kdepim-3.5.10/kabc/frontend/main.cpp	2005-09-10 04:24:24.000000000 -0400
+++ kdepim-3.5.10-new/kabc/frontend/main.cpp	2009-04-17 16:23:32.000000000 -0400
@@ -6,7 +6,7 @@
 
 #include "mainWindow.h"
 
-int main( int argc, char ** argv )
+extern "C" KDE_EXPORT int kdemain( int argc, char ** argv )
 {
   KAboutData aboutData("testkabc",I18N_NOOP("TestKabc"),"0.1");
   KCmdLineArgs::init(argc,argv,&aboutData);
diff -Nurd kdepim-3.5.10/kabc/kabc2mutt/Makefile.am kdepim-3.5.10-new/kabc/kabc2mutt/Makefile.am
--- kdepim-3.5.10/kabc/kabc2mutt/Makefile.am	2005-09-10 04:24:24.000000000 -0400
+++ kdepim-3.5.10-new/kabc/kabc2mutt/Makefile.am	2009-04-17 16:23:32.000000000 -0400
@@ -2,11 +2,13 @@
 
 METASOURCES = AUTO
 
-bin_PROGRAMS = kabc2mutt
+bin_PROGRAMS = 
+lib_LTLIBRARIES =
+kdeinit_LTLIBRARIES = kabc2mutt.la
 
-kabc2mutt_LDFLAGS = $(all_libraries) $(KDE_RPATH)
-kabc2mutt_LDADD = -lkabc $(LIB_KDECORE)
-kabc2mutt_SOURCES = kabc2mutt.cpp main.cpp
+kabc2mutt_la_LDFLAGS = $(all_libraries) $(KDE_RPATH) -module -avoid-version
+kabc2mutt_la_LIBADD = -lkabc $(LIB_KDECORE)
+kabc2mutt_la_SOURCES = kabc2mutt.cpp main.cpp
 
 messages: rc.cpp
 	$(XGETTEXT) *.cpp -o $(podir)/kabc2mutt.pot
diff -Nurd kdepim-3.5.10/kabc/kabc2mutt/main.cpp kdepim-3.5.10-new/kabc/kabc2mutt/main.cpp
--- kdepim-3.5.10/kabc/kabc2mutt/main.cpp	2005-09-10 04:24:24.000000000 -0400
+++ kdepim-3.5.10-new/kabc/kabc2mutt/main.cpp	2009-04-17 16:23:32.000000000 -0400
@@ -41,7 +41,7 @@
 };
 
 
-int main( int argc, char **argv )
+extern "C" KDE_EXPORT int kdemain( int argc, char **argv )
 {
   KApplication::disableAutoDcopRegistration();
   KCmdLineArgs::init( argc, argv, appName, programName, description, version );
diff -Nurd kdepim-3.5.10/kaddressbook/Makefile.am kdepim-3.5.10-new/kaddressbook/Makefile.am
--- kdepim-3.5.10/kaddressbook/Makefile.am	2008-02-13 04:39:43.000000000 -0500
+++ kdepim-3.5.10-new/kaddressbook/Makefile.am	2009-04-17 16:23:32.000000000 -0400
@@ -14,11 +14,12 @@
           -I$(top_buildir)/kaddressbook/editors \
           $(all_includes)
 
-bin_PROGRAMS = kaddressbook
+bin_PROGRAMS = 
+kdeinit_LTLIBRARIES = kaddressbook.la
 
-kaddressbook_SOURCES = main.cpp kaddressbookmain.cpp
-kaddressbook_LDFLAGS = $(all_libraries) $(KDE_RPATH)
-kaddressbook_LDADD = libkaddressbook.la
+kaddressbook_la_SOURCES = main.cpp kaddressbookmain.cpp
+kaddressbook_la_LDFLAGS = $(all_libraries) $(KDE_RPATH) -module -avoid-version
+kaddressbook_la_LIBADD = libkaddressbook.la
 
 kde_module_LTLIBRARIES = libkaddressbookpart.la
 
@@ -66,7 +67,7 @@
     viewconfigurefilterpage.h viewconfigurewidget.h viewmanager.h xxportmanager.h \
     xxportselectdialog.h advancedcustomfields.h imeditwidget.h
 
-kaddressbook_METASOURCES = AUTO
+kaddressbook_la_METASOURCES = AUTO
 
 rcdir = $(kde_datadir)/kaddressbook
 rc_DATA = kaddressbookui.rc kaddressbook_part.rc
diff -Nurd kdepim-3.5.10/kaddressbook/features/Makefile.am kdepim-3.5.10-new/kaddressbook/features/Makefile.am
--- kdepim-3.5.10/kaddressbook/features/Makefile.am	2008-08-19 14:15:52.000000000 -0400
+++ kdepim-3.5.10-new/kaddressbook/features/Makefile.am	2009-04-17 16:29:07.000000000 -0400
@@ -16,16 +16,16 @@
 
 if compile_newdistrlists
 libkaddrbk_distributionlistng_la_SOURCES = distributionlistngwidget.cpp
-libkaddrbk_distributionlistng_la_LDFLAGS = -module $(KDE_PLUGIN) $(KDE_RPATH) $(all_libraries) -no-undefined
+libkaddrbk_distributionlistng_la_LDFLAGS = $(all_libraries) $(KDE_PLUGIN)
 libkaddrbk_distributionlistng_la_LIBADD = $(XXLIBS)
 else
 libkaddrbk_distributionlist_la_SOURCES = distributionlistwidget.cpp
-libkaddrbk_distributionlist_la_LDFLAGS = -module $(KDE_PLUGIN) $(KDE_RPATH) $(all_libraries) -no-undefined
+libkaddrbk_distributionlist_la_LDFLAGS = $(all_libraries) $(KDE_PLUGIN)
 libkaddrbk_distributionlist_la_LIBADD = $(XXLIBS)
 endif
 
 libkaddrbk_resourceselection_la_SOURCES = resourceselection.cpp
-libkaddrbk_resourceselection_la_LDFLAGS = -module $(KDE_PLUGIN) $(KDE_RPATH) $(all_libraries) -no-undefined
+libkaddrbk_resourceselection_la_LDFLAGS = $(all_libraries) $(KDE_PLUGIN)
 libkaddrbk_resourceselection_la_LIBADD = $(XXLIBS)
 
 noinst_HEADERS = distributionlistwidget.h distributionlistngwidget.h resourceselection.h
diff -Nurd kdepim-3.5.10/kaddressbook/main.cpp kdepim-3.5.10-new/kaddressbook/main.cpp
--- kdepim-3.5.10/kaddressbook/main.cpp	2005-11-08 17:33:33.000000000 -0500
+++ kdepim-3.5.10-new/kaddressbook/main.cpp	2009-04-17 16:23:32.000000000 -0400
@@ -109,7 +109,7 @@
   return 0;
 }
 
-int main( int argc, char *argv[] )
+extern "C" KDE_EXPORT int kdemain( int argc, char *argv[] )
 {
   KLocale::setMainCatalogue( "kaddressbook" );
 
diff -Nurd kdepim-3.5.10/kandy/src/Makefile.am kdepim-3.5.10-new/kandy/src/Makefile.am
--- kdepim-3.5.10/kandy/src/Makefile.am	2005-09-10 04:24:42.000000000 -0400
+++ kdepim-3.5.10-new/kandy/src/Makefile.am	2009-04-17 16:23:32.000000000 -0400
@@ -1,10 +1,12 @@
-bin_PROGRAMS = kandy kandy_client
+bin_PROGRAMS = 
+lib_LTLIBRARIES =
+kdeinit_LTLIBRARIES = kandy.la kandy_client.la
 
 INCLUDES = -I$(top_srcdir) $(all_includes)
 
-kandy_LDFLAGS = $(KDE_RPATH) $(all_libraries)
-kandy_LDADD   = $(KANDY_LIBLOCKDEV) $(LIB_KFILE) -lkabc $(top_builddir)/libkdepim/libkdepim.la
-kandy_SOURCES =	main.cpp kandy.cpp \
+kandy_la_LDFLAGS = $(all_libraries) $(KDE_PLUGIN)
+kandy_la_LIBADD  = $(KANDY_LIBLOCKDEV) $(LIB_KFILE) -lkabc $(top_builddir)/libkdepim/libkdepim.la
+kandy_la_SOURCES =	main.cpp kandy.cpp \
                 cmdpropertiesdialog_base.ui cmdpropertiesdialog.cpp \
                 kandyview.cpp \
 		kandyiface.skel \
@@ -17,9 +19,9 @@
 noinst_HEADERS   = kandy.h kandyview.h modem.h atcommand.h \
                    commanditem.h mobilegui.h commandscheduler.h
 
-kandy_client_LDFLAGS = $(KDE_RPATH) $(all_libraries)
-kandy_client_LDADD   = $(LIB_KDECORE)
-kandy_client_SOURCES = kandy_client.cpp
+kandy_client_la_LDFLAGS = $(all_libraries) $(KDE_PLUGIN)
+kandy_client_la_LIBADD  = $(LIB_KDECORE)
+kandy_client_la_SOURCES = kandy_client.cpp
 
 METASOURCES = AUTO
 
diff -Nurd kdepim-3.5.10/kandy/src/kandy_client.cpp kdepim-3.5.10-new/kandy/src/kandy_client.cpp
--- kdepim-3.5.10/kandy/src/kandy_client.cpp	2005-09-10 04:24:42.000000000 -0400
+++ kdepim-3.5.10-new/kandy/src/kandy_client.cpp	2009-04-17 16:23:32.000000000 -0400
@@ -27,7 +27,7 @@
 #include <qdatastream.h>
 #include <qstring.h>
 
-int main(int argc, char **argv)
+extern "C" KDE_EXPORT int kdemain(int argc, char **argv)
 {
     KApplication app(argc, argv, "kandy_client", false);
 
diff -Nurd kdepim-3.5.10/kandy/src/main.cpp kdepim-3.5.10-new/kandy/src/main.cpp
--- kdepim-3.5.10/kandy/src/main.cpp	2005-09-10 04:24:42.000000000 -0400
+++ kdepim-3.5.10-new/kandy/src/main.cpp	2009-04-17 16:23:32.000000000 -0400
@@ -85,7 +85,7 @@
 #endif
 }
 
-int main(int argc, char **argv)
+extern "C" KDE_EXPORT int kdemain(int argc, char **argv)
 {
   KAboutData about("kandy", I18N_NOOP("Kandy"), version, description,
                    KAboutData::License_GPL, "(C) 2001 Cornelius Schumacher",0,
diff -Nurd kdepim-3.5.10/kitchensync/src/Makefile.am kdepim-3.5.10-new/kitchensync/src/Makefile.am
--- kdepim-3.5.10/kitchensync/src/Makefile.am	2007-10-08 05:50:47.000000000 -0400
+++ kdepim-3.5.10-new/kitchensync/src/Makefile.am	2009-04-17 16:23:32.000000000 -0400
@@ -7,11 +7,13 @@
             $(all_includes)
 
 # Application
-bin_PROGRAMS = kitchensync
+bin_PROGRAMS = 
 
-kitchensync_SOURCES = main.cpp mainwindow.cpp
-kitchensync_LDFLAGS = $(KDE_RPATH) $(all_libraries)
-kitchensync_LDADD = libkitchensync.la
+kdeinit_LTLIBRARIES = kitchensync.la
+
+kitchensync_la_SOURCES = main.cpp mainwindow.cpp
+kitchensync_la_LDFLAGS = $(all_libraries) $(KDE_PLUGIN)
+kitchensync_la_LIBADD = libkitchensync.la
 
 xdg_apps_DATA = kitchensync.desktop
 
@@ -39,7 +41,7 @@
 kde_module_LTLIBRARIES = libkitchensyncpart.la
 
 libkitchensyncpart_la_SOURCES = part.cpp
-libkitchensyncpart_la_LDFLAGS = -module $(KDE_PLUGIN) $(KDE_RPATH) $(all_libraries) -no-undefined
+libkitchensyncpart_la_LDFLAGS = $(KDE_PLUGIN) $(all_libraries)
 libkitchensyncpart_la_LIBADD = $(LIB_KPARTS) libkitchensync.la
 
 # Resources
diff -Nurd kdepim-3.5.10/kitchensync/src/main.cpp kdepim-3.5.10-new/kitchensync/src/main.cpp
--- kdepim-3.5.10/kitchensync/src/main.cpp	2007-05-14 03:54:46.000000000 -0400
+++ kdepim-3.5.10-new/kitchensync/src/main.cpp	2009-04-17 16:23:32.000000000 -0400
@@ -32,7 +32,7 @@
   KCmdLineLastOption
 };
 
-int main( int argc, char **argv )
+extern "C" KDE_EXPORT int kdemain( int argc, char **argv )
 {
   KAboutData *about = MainWidget::aboutData();
 
diff -Nurd kdepim-3.5.10/kmail/Makefile.am kdepim-3.5.10-new/kmail/Makefile.am
--- kdepim-3.5.10/kmail/Makefile.am	2008-08-19 14:15:47.000000000 -0400
+++ kdepim-3.5.10-new/kmail/Makefile.am	2009-04-17 16:23:32.000000000 -0400
@@ -25,32 +25,34 @@
 endif
 
 lib_LTLIBRARIES = libkmailprivate.la
-libkmailprivate_la_LDFLAGS = $(all_libraries) -avoid-version -no-undefined
+libkmailprivate_la_LDFLAGS = $(all_libraries) -no-undefined
 libkmailprivate_la_LIBADD  = \
         ../libkmime/libkmime.la ../libkpgp/libkpgp.la ../libkdepim/libkdepim.la \
         ../libkpimidentities/libkpimidentities.la ../mimelib/libmimelib.la \
         ../libksieve/libksieve.la ../libemailfunctions/libemailfunctions.la \
         ../certmanager/lib/libkleopatra.la $(INDEXLIB) \
         ../libkcal/libkcal.la \
-        $(LIB_KHTML) $(LIB_KSPELL) $(LIB_KABC)
+        $(LIB_KHTML) $(LIB_KSPELL) $(LIB_KABC) $(LIBZ)
 
 kde_module_LTLIBRARIES = kcm_kmail.la libkmailpart.la libkmail_bodypartformatter_application_octetstream.la
-libkmailpart_la_LDFLAGS = $(all_libraries) $(KDE_RPATH) -module -avoid-version -no-undefined
-libkmailpart_la_LIBADD  = libkmailprivate.la
+libkmailpart_la_LDFLAGS = $(all_libraries) $(KDE_PLUGIN)
+libkmailpart_la_LIBADD  = libkmailprivate.la $(LIBZ)
 
 kcm_kmail_la_SOURCES = kcm_kmail.cpp
-kcm_kmail_la_LDFLAGS = $(all_libraries) -module -avoid-version -no-undefined
-kcm_kmail_la_LIBADD = libkmailprivate.la $(LIB_KDECORE)
+kcm_kmail_la_LDFLAGS = $(all_libraries) $(KDE_PLUGIN)
+kcm_kmail_la_LIBADD = libkmailprivate.la $(LIB_KDECORE) $(LIBZ)
 
 libkmail_bodypartformatter_application_octetstream_la_SOURCES = app_octetstream.cpp
-libkmail_bodypartformatter_application_octetstream_la_LDFLAGS = $(all_libraries) -module $(KDE_PLUGIN)
+libkmail_bodypartformatter_application_octetstream_la_LDFLAGS = $(all_libraries) $(KDE_PLUGIN)
 
 linkdir = $(kde_datadir)/kmail/plugins/bodypartformatter
 link_DATA = application_octetstream.desktop
 
-bin_PROGRAMS = kmail
-kmail_LDFLAGS = $(all_libraries) $(KDE_RPATH)
-kmail_LDADD   = libkmailprivate.la
+bin_PROGRAMS = 
+kdeinit_LTLIBRARIES = kmail.la
+
+kmail_la_LDFLAGS = $(all_libraries) $(KDE_PLUGIN) $(LIBZ)
+kmail_la_LIBADD  = libkmailprivate.la $(LIBZ)
 
 libkmailprivate_la_SOURCES = kmmessage.cpp kmmainwin.cpp configuredialog.cpp \
                 configuredialog_p.cpp klistviewindexedsearchline.cpp \
@@ -154,7 +156,7 @@
 
 libkmailprivate_la_COMPILE_FIRST = globalsettings_base.h customtemplates_base.h templatesconfiguration_base.h
 
-kmail_SOURCES = main.cpp
+kmail_la_SOURCES = main.cpp
 
 kmail_COMPILE_FIRST = globalsettings_base.h customtemplates_base.h templatesconfiguration_base.h
 
diff -Nurd kdepim-3.5.10/kmail/main.cpp kdepim-3.5.10-new/kmail/main.cpp
--- kdepim-3.5.10/kmail/main.cpp	2005-09-10 04:24:02.000000000 -0400
+++ kdepim-3.5.10-new/kmail/main.cpp	2009-04-17 16:23:32.000000000 -0400
@@ -64,7 +64,7 @@
   return 0;
 }
 
-int main(int argc, char *argv[])
+extern "C" KDE_EXPORT int kdemain(int argc, char *argv[])
 {
   // WABA: KMail is a KUniqueApplication. Unfortunately this makes debugging
   // a bit harder: You should pass --nofork as commandline argument when using
diff -Nurd kdepim-3.5.10/kmailcvt/Makefile.am kdepim-3.5.10-new/kmailcvt/Makefile.am
--- kdepim-3.5.10/kmailcvt/Makefile.am	2005-09-10 04:24:16.000000000 -0400
+++ kdepim-3.5.10-new/kmailcvt/Makefile.am	2009-04-17 16:23:32.000000000 -0400
@@ -1,6 +1,9 @@
 
-bin_PROGRAMS = kmailcvt
-kmailcvt_SOURCES = kimportpagedlg.ui kimportpage.cpp kselfilterpagedlg.ui \
+bin_PROGRAMS = 
+lib_LTLIBRARIES =
+kdeinit_LTLIBRARIES = kmailcvt.la
+
+kmailcvt_la_SOURCES = kimportpagedlg.ui kimportpage.cpp kselfilterpagedlg.ui \
                    kselfilterpage.cpp filters.cxx filter_oe.cxx kmailcvt.cpp \
                    main.cpp filter_pmail.cxx filter_plain.cxx filter_outlook.cxx \
                    filter_mbox.cxx filter_evolution.cxx filter_mailapp.cxx \
@@ -8,7 +11,7 @@
                    filter_kmail_maildir.cxx filter_sylpheed.cxx filter_thebat.cxx \
                    filter_lnotes.cxx
                 
-kmailcvt_LDADD   = $(LIB_KFILE)
+kmailcvt_la_LIBADD   = $(LIB_KFILE)
 
 EXTRA_DIST = main.cpp kmailcvt.cpp kimportpage.cpp kimportpage.h \
              kselfilterpage.cpp kselfilterpage.h kmailcvt.h \
@@ -36,10 +39,10 @@
 # set the include path for X, qt and KDE
 INCLUDES= $(all_includes)
 
-kmailcvt_METASOURCES = AUTO
+kmailcvt_la_METASOURCES = AUTO
 
 # the library search path. 
-kmailcvt_LDFLAGS = $(all_libraries) $(KDE_RPATH)
+kmailcvt_la_LDFLAGS = $(all_libraries) $(KDE_PLUGIN)
 
 KDE_ICON=AUTO
 
diff -Nurd kdepim-3.5.10/kmailcvt/main.cpp kdepim-3.5.10-new/kmailcvt/main.cpp
--- kdepim-3.5.10/kmailcvt/main.cpp	2005-09-10 04:24:16.000000000 -0400
+++ kdepim-3.5.10-new/kmailcvt/main.cpp	2009-04-17 16:23:32.000000000 -0400
@@ -26,7 +26,7 @@
   KCmdLineLastOption
 };
 
-int main(int argc, char *argv[])
+extern "C" KDE_EXPORT int kdemain(int argc, char *argv[])
 {
   KLocale::setMainCatalogue("kmailcvt");
 
diff -Nurd kdepim-3.5.10/kmobile/Makefile.am kdepim-3.5.10-new/kmobile/Makefile.am
--- kdepim-3.5.10/kmobile/Makefile.am	2005-09-10 04:23:39.000000000 -0400
+++ kdepim-3.5.10-new/kmobile/Makefile.am	2009-04-17 16:23:32.000000000 -0400
@@ -2,15 +2,16 @@
 
 SUBDIRS = . devices		# kioslave
 
-bin_PROGRAMS = kmobile 
+kdeinit_LTLIBRARIES = kmobile.la
+bin_PROGRAMS = 
 
 lib_LTLIBRARIES = libkmobiledevice.la libkmobileclient.la
 
 INCLUDES         = $(all_includes)
 
-kmobile_LDFLAGS = $(KDE_RPATH) $(all_libraries)
-kmobile_LDADD   = $(LIB_KFILE) $(LIB_KABC) libkmobiledevice.la
-kmobile_SOURCES = main.cpp kmobile.cpp kmobileview.cpp kmobileitem.cpp\
+kmobile_la_LDFLAGS = $(all_libraries) $(KDE_PLUGIN)
+kmobile_la_LIBADD  = $(LIB_KFILE) $(LIB_KABC) libkmobiledevice.la
+kmobile_la_SOURCES = main.cpp kmobile.cpp kmobileview.cpp kmobileitem.cpp\
 			pref.cpp kmobileiface.skel kmobile_selectiondialog.ui \
 			systemtray.cpp
 
diff -Nurd kdepim-3.5.10/kmobile/main.cpp kdepim-3.5.10-new/kmobile/main.cpp
--- kdepim-3.5.10/kmobile/main.cpp	2005-09-10 04:23:39.000000000 -0400
+++ kdepim-3.5.10-new/kmobile/main.cpp	2009-04-17 16:23:32.000000000 -0400
@@ -35,7 +35,7 @@
     KCmdLineLastOption
 };
 
-int main(int argc, char **argv)
+extern "C" KDE_EXPORT int kdemain(int argc, char **argv)
 {
     KAboutData about("kmobile", I18N_NOOP("KMobile"), version, description,
                      KAboutData::License_GPL, "(C) 2003-2005 Helge Deller", 0, 0, "deller@kde.org");
diff -Nurd kdepim-3.5.10/knode/Makefile.am kdepim-3.5.10-new/knode/Makefile.am
--- kdepim-3.5.10/knode/Makefile.am	2008-02-13 04:39:38.000000000 -0500
+++ kdepim-3.5.10-new/knode/Makefile.am	2009-04-17 16:23:32.000000000 -0400
@@ -10,22 +10,23 @@
 lib_LTLIBRARIES = libknodecommon.la
 
 kde_module_LTLIBRARIES = kcm_knode.la libknodepart.la
-libknodepart_la_LDFLAGS = -module -avoid-version -no-undefined $(all_libraries) $(KDE_RPATH) $(KDE_PLUGIN)
+libknodepart_la_LDFLAGS = $(all_libraries) $(KDE_PLUGIN)
 libknodepart_la_LIBADD	= libknodecommon.la
 
 SUBDIRS = pics filters
 
-bin_PROGRAMS = knode
+bin_PROGRAMS = 
+kdeinit_LTLIBRARIES = knode.la
 
-knode_LDFLAGS = $(all_libraries) $(KDE_RPATH)
-knode_LDADD   = libknodecommon.la
+knode_la_LDFLAGS = $(all_libraries) $(KDE_PLUGIN)
+knode_la_LIBADD  = libknodecommon.la
 
 kcm_knode_la_SOURCES = knconfigpages.cpp
-kcm_knode_la_LDFLAGS = $(all_libraries) -module -avoid-version -no-undefined
+kcm_knode_la_LDFLAGS = $(all_libraries) $(KDE_PLUGIN)
 kcm_knode_la_LIBADD = libknodecommon.la $(LIB_KDECORE)
 knconfigpages.lo: smtpaccountwidget_base.h
 
-libknodecommon_la_LDFLAGS = -version-info 3:0:0 -no-undefined $(all_libraries)
+libknodecommon_la_LDFLAGS = -no-undefined $(all_libraries)
 libknodecommon_la_LIBADD = $(top_builddir)/libkmime/libkmime.la $(top_builddir)/libkpgp/libkpgp.la $(top_builddir)/libkdepim/libkdepim.la $(LIB_KSPELL) $(LIB_KABC) $(LIB_KFILE) $(LIB_KUTILS) $(LIBRESOLV) $(LIB_KHTML)
 libknodecommon_la_SOURCES =   knconfigmanager.cpp \
                   knconfig.cpp \
@@ -93,7 +94,7 @@
                   smtpaccountwidget_base.ui
 libknodecommon_la_COMPILE_FIRST = smtpaccountwidget_base.h
 
-knode_SOURCES = knode.cpp knapplication.cpp main.cpp
+knode_la_SOURCES = knode.cpp knapplication.cpp main.cpp
 
 libknodepart_la_SOURCES = knode_part.cpp
 
@@ -164,7 +165,7 @@
                   csshelper.h
 
 
-knode_METASOURCES = AUTO
+knode_la_METASOURCES = AUTO
 
 xdg_apps_DATA = KNode.desktop
 
diff -Nurd kdepim-3.5.10/knode/main.cpp kdepim-3.5.10-new/knode/main.cpp
--- kdepim-3.5.10/knode/main.cpp	2006-01-19 11:55:48.000000000 -0500
+++ kdepim-3.5.10-new/knode/main.cpp	2009-04-17 16:23:32.000000000 -0400
@@ -25,7 +25,7 @@
 #include "knode_options.h"
 using KNode::AboutData;
 
-int main(int argc, char* argv[])
+extern "C" KDE_EXPORT int kdemain(int argc, char* argv[])
 {
   AboutData aboutData;
 
diff -Nurd kdepim-3.5.10/knotes/Makefile.am kdepim-3.5.10-new/knotes/Makefile.am
--- kdepim-3.5.10/knotes/Makefile.am	2008-02-13 04:39:52.000000000 -0500
+++ kdepim-3.5.10-new/knotes/Makefile.am	2009-04-17 16:23:32.000000000 -0400
@@ -2,7 +2,9 @@
 
 SUBDIRS         = . pics icons
 
-bin_PROGRAMS    = knotes
+bin_PROGRAMS    = 
+lib_LTLIBRARIES =
+kdeinit_LTLIBRARIES = knotes.la
 
 include_HEADERS = KNotesIface.h KNotesAppIface.h
 noinst_HEADERS  = knotesapp.h knote.h knoteedit.h knotebutton.h \
@@ -24,16 +26,16 @@
 libknote_la_SOURCES = knote.cpp knotebutton.cpp knoteconfigdlg.cpp knotehostdlg.cpp \
 							 knotealarmdlg.cpp knotesalarm.cpp
 
-knotes_SOURCES  = main.cpp knotesapp.cpp KNotesAppIface.skel
-knotes_LDADD    = libknote.la libknoteseditor.la libknotesnetwork.la libknotesresources.la \
+knotes_la_SOURCES  = main.cpp knotesapp.cpp KNotesAppIface.skel
+knotes_la_LIBADD    = libknote.la libknoteseditor.la libknotesnetwork.la libknotesresources.la \
                   libknoteslegacy.la libknotesconfig.la libknotesprinting.la $(top_builddir)/libkcal/libkcal.la \
                   $(top_builddir)/libkdepim/libkdepim.la $(LIB_KIO) -lkresources -lkdeprint -lkutils
-knotes_LDFLAGS  = $(all_libraries) $(KDE_RPATH)
-knotes_COMPILE_FIRST = knoteconfig.h
+knotes_la_LDFLAGS  = $(all_libraries) $(KDE_PLUGIN)
+knotes_la_COMPILE_FIRST = knoteconfig.h
 
 kde_module_LTLIBRARIES  = knotes_local.la
 knotes_local_la_SOURCES = resourcelocal_plugin.cpp
-knotes_local_la_LDFLAGS = $(KDE_LDFLAGS) $(all_libraries) -module $(KDE_PLUGIN)
+knotes_local_la_LDFLAGS = $(KDE_LDFLAGS) $(all_libraries) $(KDE_PLUGIN)
 knotes_local_la_LIBADD  = libknotesresources.la libknotesconfig.la libknotesprinting.la \
                           $(top_builddir)/libkcal/libkcal.la -lkdeprint
 
diff -Nurd kdepim-3.5.10/knotes/main.cpp kdepim-3.5.10-new/knotes/main.cpp
--- kdepim-3.5.10/knotes/main.cpp	2006-03-17 05:16:01.000000000 -0500
+++ kdepim-3.5.10-new/knotes/main.cpp	2009-04-17 16:23:32.000000000 -0400
@@ -86,7 +86,7 @@
     return KUniqueApplication::newInstance();
 }
 
-int main( int argc, char* argv[] )
+extern "C" KDE_EXPORT int kdemain( int argc, char* argv[] )
 {
     QString version = QString::number( KNOTES_VERSION );
 
diff -Nurd kdepim-3.5.10/kode/Makefile.am kdepim-3.5.10-new/kode/Makefile.am
--- kdepim-3.5.10/kode/Makefile.am	2005-09-10 04:23:43.000000000 -0400
+++ kdepim-3.5.10-new/kode/Makefile.am	2009-04-17 16:23:32.000000000 -0400
@@ -12,10 +12,11 @@
                      -version-info 1:0:0 -no-undefined
 libkode_la_LIBADD = -lkdecore
 
-bin_PROGRAMS = kode
+bin_PROGRAMS = 
+kdeinit_LTLIBRARIES = kode.la
 
-kode_LDFLAGS = $(all_libraries) $(KDE_RPATH)
-kode_LDADD   = libkode.la -lkabc
-kode_SOURCES = kodemain.cpp
+kode_la_LDFLAGS = $(all_libraries) $(KDE_PLUGIN)
+kode_la_LIBADD  = libkode.la -lkabc
+kode_la_SOURCES = kodemain.cpp
 
 METASOURCES = AUTO
diff -Nurd kdepim-3.5.10/kode/kodemain.cpp kdepim-3.5.10-new/kode/kodemain.cpp
--- kdepim-3.5.10/kode/kodemain.cpp	2005-09-10 04:23:43.000000000 -0400
+++ kdepim-3.5.10-new/kode/kodemain.cpp	2009-04-17 16:23:32.000000000 -0400
@@ -607,7 +607,7 @@
   return 0;
 }
 
-int main(int argc,char **argv)
+extern "C" KDE_EXPORT int kdemain(int argc,char **argv)
 {
   KAboutData aboutData( "kode", I18N_NOOP("KDE Code Generator"), "0.1" );
   aboutData.addAuthor( "Cornelius Schumacher", 0, "schumacher@kde.org" );
diff -Nurd kdepim-3.5.10/kode/kxml_compiler/Makefile.am kdepim-3.5.10-new/kode/kxml_compiler/Makefile.am
--- kdepim-3.5.10/kode/kxml_compiler/Makefile.am	2005-09-10 04:23:43.000000000 -0400
+++ kdepim-3.5.10-new/kode/kxml_compiler/Makefile.am	2009-04-17 16:23:32.000000000 -0400
@@ -3,7 +3,7 @@
 bin_PROGRAMS = kxml_compiler
 
 kxml_compiler_LDFLAGS = $(all_libraries) $(KDE_RPATH)
-kxml_compiler_LDADD   = ../libkode.la -lkdecore
+kxml_compiler_LDADD  = ../libkode.la -lkdecore
 kxml_compiler_SOURCES = parser.cpp creator.cpp kxml_compiler.cpp
 
 METASOURCES = AUTO
diff -Nurd kdepim-3.5.10/konsolekalendar/Makefile.am kdepim-3.5.10-new/konsolekalendar/Makefile.am
--- kdepim-3.5.10/konsolekalendar/Makefile.am	2005-11-08 17:33:45.000000000 -0500
+++ kdepim-3.5.10-new/konsolekalendar/Makefile.am	2009-04-17 16:23:32.000000000 -0400
@@ -6,14 +6,16 @@
 
 METASOURCES = AUTO
 
-bin_PROGRAMS = konsolekalendar
+bin_PROGRAMS = 
+lib_LTLIBRARIES =
+kdeinit_LTLIBRARIES = konsolekalendar.la
 
-konsolekalendar_SOURCES = konsolekalendarepoch.cpp konsolekalendardelete.cpp \
+konsolekalendar_la_SOURCES = konsolekalendarepoch.cpp konsolekalendardelete.cpp \
   konsolekalendarchange.cpp konsolekalendarvariables.cpp \
   konsolekalendaradd.cpp konsolekalendarexports.cpp konsolekalendar.cpp \
   stdcalendar.cpp main.cpp 
-konsolekalendar_LDADD = $(top_builddir)/libkcal/libkcal.la $(top_builddir)/libkdepim/libkdepim.la
-konsolekalendar_LDFLAGS = $(all_libraries) $(KDE_RPATH)
+konsolekalendar_la_LIBADD = $(top_builddir)/libkcal/libkcal.la $(top_builddir)/libkdepim/libkdepim.la
+konsolekalendar_la_LDFLAGS = $(all_libraries) $(KDE_PLUGIN)
 
 appsdir = $(kde_appsdir)/Utilities
 xdg_apps_DATA = konsolekalendar.desktop
diff -Nurd kdepim-3.5.10/konsolekalendar/main.cpp kdepim-3.5.10-new/konsolekalendar/main.cpp
--- kdepim-3.5.10/konsolekalendar/main.cpp	2008-02-13 04:39:54.000000000 -0500
+++ kdepim-3.5.10-new/konsolekalendar/main.cpp	2009-04-17 16:23:32.000000000 -0400
@@ -165,7 +165,7 @@
   KCmdLineLastOption
 };
 
-int main( int argc, char *argv[] )
+extern "C" KDE_EXPORT int kdemain( int argc, char *argv[] )
 {
   KAboutData aboutData(
     progName,                        // internal program name
diff -Nurd kdepim-3.5.10/kontact/src/Makefile.am kdepim-3.5.10-new/kontact/src/Makefile.am
--- kdepim-3.5.10/kontact/src/Makefile.am	2008-02-13 04:39:52.000000000 -0500
+++ kdepim-3.5.10-new/kontact/src/Makefile.am	2009-04-17 16:23:32.000000000 -0400
@@ -5,24 +5,30 @@
 lib_LTLIBRARIES = libkontact.la
 libkontact_la_LDFLAGS = $(all_libraries) $(KDE_RPATH) -version-info 1:0
 libkontact_la_LIBADD = $(LIB_KDECORE)
-libkontact_la_SOURCES = prefs.kcfgc
+libkontact_la_SOURCES = prefs.kcfgc dummy.cpp
 
-bin_PROGRAMS = kontact
+DISTCLEANFILES = dummy.cpp
 
-kontact_METASOURCES = AUTO
-kontact_LDFLAGS = $(all_libraries) $(KDE_RPATH)
-kontact_LDADD = $(top_builddir)/libkdepim/libkdepim.la \
+dummy.cpp:
+	echo > dummy.cpp
+
+bin_PROGRAMS = 
+kdeinit_LTLIBRARIES = kontact.la
+
+kontact_la_METASOURCES = AUTO
+kontact_la_LDFLAGS = $(all_libraries) $(KDE_PLUGIN)
+kontact_la_LIBADD = $(top_builddir)/libkdepim/libkdepim.la \
   $(top_builddir)/kontact/interfaces/libkpinterfaces.la libkontact.la \
   $(LIB_KPARTS) $(LIB_KUTILS) $(LIB_KHTML)
-kontact_SOURCES = main.cpp mainwindow.cpp sidepanebase.cpp \
+kontact_la_SOURCES = main.cpp mainwindow.cpp sidepanebase.cpp \
   iconsidepane.cpp aboutdialog.cpp profilemanager.cpp profiledialog.cpp \
   kontactiface.skel
-kontact_COMPILE_FIRST = prefs.h
+kontact_la_COMPILE_FIRST = prefs.h
 
 kde_module_LTLIBRARIES = kcm_kontact.la
 
 kcm_kontact_la_SOURCES = kcmkontact.cpp
-kcm_kontact_la_LDFLAGS = $(all_libraries) -module -avoid-version -no-undefined
+kcm_kontact_la_LDFLAGS = $(all_libraries) $(KDE_PLUGIN)
 kcm_kontact_la_LIBADD = libkontact.la $(top_builddir)/libkdepim/libkdepim.la
 kcm_kontact_la_COMPILE_FIRST = prefs.h
 
diff -Nurd kdepim-3.5.10/kontact/src/main.cpp kdepim-3.5.10-new/kontact/src/main.cpp
--- kdepim-3.5.10/kontact/src/main.cpp	2008-08-19 14:16:02.000000000 -0400
+++ kdepim-3.5.10-new/kontact/src/main.cpp	2009-04-17 16:23:32.000000000 -0400
@@ -120,7 +120,7 @@
   return KUniqueApplication::newInstance();
 }
 
-int main( int argc, char **argv )
+extern "C" KDE_EXPORT int kdemain( int argc, char **argv )
 {
   KAboutData about( "kontact", I18N_NOOP( "Kontact" ), version, description,
                     KAboutData::License_GPL, I18N_NOOP("(C) 2001-2008 The Kontact developers"), 0, "http://kontact.org" );
diff -Nurd kdepim-3.5.10/korganizer/Makefile.am kdepim-3.5.10-new/korganizer/Makefile.am
--- kdepim-3.5.10/korganizer/Makefile.am	2008-08-19 14:16:05.000000000 -0400
+++ kdepim-3.5.10-new/korganizer/Makefile.am	2009-04-17 16:23:32.000000000 -0400
@@ -12,23 +12,24 @@
   -I$(top_builddir) \
   $(all_includes)
 
-bin_PROGRAMS = korganizer
+bin_PROGRAMS =
+kdeinit_LTLIBRARIES = korganizer.la
 
-korganizer_LDFLAGS = $(all_libraries) $(KDE_RPATH)
-korganizer_LDADD   = libkorganizer.la
-korganizer_SOURCES = main.cpp korganizer.cpp koapp.cpp
-korganizer_COMPILE_FIRST = koprefs_base.h
+korganizer_la_LDFLAGS = $(all_libraries) $(KDE_PLUGIN)
+korganizer_la_LIBADD  = libkorganizer.la
+korganizer_la_SOURCES = main.cpp koapp.cpp
+korganizer_la_COMPILE_FIRST = koprefs_base.h
 
 
 kde_module_LTLIBRARIES = kcm_korganizer.la libkorganizerpart.la
 
 kcm_korganizer_la_SOURCES = koprefsdialog.cpp
-kcm_korganizer_la_LDFLAGS = $(all_libraries) -module -avoid-version -no-undefined
+kcm_korganizer_la_LDFLAGS = $(all_libraries) $(KDE_PLUGIN)
 kcm_korganizer_la_LIBADD = libkorganizer.la $(top_builddir)/libkdepim/libkdepim.la \
   $(LIB_KDECORE)
 kcm_korganizer_la_COMPILE_FIRST = koprefs_base.h 	kogroupwareprefspage.h
 
-libkorganizerpart_la_LDFLAGS = -module $(KDE_PLUGIN) $(all_libraries)
+libkorganizerpart_la_LDFLAGS = $(all_libraries) $(KDE_PLUGIN)
 libkorganizerpart_la_LIBADD  = libkorganizer.la
 libkorganizerpart_la_SOURCES = korganizer_part.cpp
 libkorganizerpart_la_COMPILE_FIRST = publishdialog_base.h koprefs_base.h
@@ -68,7 +69,7 @@
 libkorganizer_la_COMPILE_FIRST = \
 	kogroupwareprefspage.ui \
 	$(top_srcdir)/libkdepim/categoryselectdialog.h
-libkorganizer_la_SOURCES = komessagebox.cpp \
+libkorganizer_la_SOURCES = korganizer.cpp komessagebox.cpp \
 	koagendaview.cpp koagenda.cpp koagendaitem.cpp \
 	datenavigator.cpp kdatenavigator.cpp datenavigatorcontainer.cpp \
 	datechecker.cpp \
diff -Nurd kdepim-3.5.10/korganizer/korgac/Makefile.am kdepim-3.5.10-new/korganizer/korgac/Makefile.am
--- kdepim-3.5.10/korganizer/korgac/Makefile.am	2005-09-10 04:24:44.000000000 -0400
+++ kdepim-3.5.10-new/korganizer/korgac/Makefile.am	2009-04-17 16:23:32.000000000 -0400
@@ -1,11 +1,13 @@
 INCLUDES= -I$(top_srcdir) -I$(top_srcdir)/korganizer $(all_includes)
 
-bin_PROGRAMS = korgac
+bin_PROGRAMS = 
+lib_LTLIBRARIES =
+kdeinit_LTLIBRARIES = korgac.la
 
-korgac_LDFLAGS = $(all_libraries) $(KDE_RPATH)
-korgac_LDADD   = $(LIB_KDEUI) \
+korgac_la_LDFLAGS = $(all_libraries) $(KDE_PLUGIN)
+korgac_la_LIBADD  = $(LIB_KDEUI) \
                  $(top_builddir)/korganizer/libkorganizer_eventviewer.la
-korgac_SOURCES = korgacmain.cpp alarmdialog.cpp \
+korgac_la_SOURCES = korgacmain.cpp alarmdialog.cpp \
 	         alarmdockwindow.cpp koalarmclient.cpp \
                  alarmclientiface.skel
 
@@ -13,8 +15,8 @@
 
 testalarmdlg_LDFLAGS = $(all_libraries) $(KDE_RPATH)
 testalarmdlg_LDADD = $(LIB_KDEUI) $(top_builddir)/libkcal/libkcal.la \
-                     $(top_builddir)/korganizer/libkorganizer_eventviewer.la
-testalarmdlg_SOURCES = testalarmdlg.cpp alarmdialog.cpp
+                     $(top_builddir)/korganizer/libkorganizer_eventviewer.la libkdeinit_korgac.la
+testalarmdlg_SOURCES = testalarmdlg.cpp
 
 noinst_HEADERS = alarmclientiface.h alarmdialog.h \
                  alarmdockwindow.h koalarmclient.h
diff -Nurd kdepim-3.5.10/korganizer/korgac/korgacmain.cpp kdepim-3.5.10-new/korganizer/korgac/korgacmain.cpp
--- kdepim-3.5.10/korganizer/korgac/korgacmain.cpp	2006-01-19 11:56:25.000000000 -0500
+++ kdepim-3.5.10-new/korganizer/korgac/korgacmain.cpp	2009-04-17 16:23:32.000000000 -0400
@@ -59,7 +59,7 @@
   { 0, 0, 0 }
 };
 
-int main( int argc, char **argv )
+extern "C" KDE_EXPORT int kdemain( int argc, char **argv )
 {
   KLocale::setMainCatalogue( "korganizer" );
   KAboutData aboutData( "korgac", I18N_NOOP("KOrganizer Reminder Daemon"),
diff -Nurd kdepim-3.5.10/korganizer/korgplugins.cpp kdepim-3.5.10-new/korganizer/korgplugins.cpp
--- kdepim-3.5.10/korganizer/korgplugins.cpp	2005-09-10 04:24:47.000000000 -0400
+++ kdepim-3.5.10-new/korganizer/korgplugins.cpp	2009-04-17 16:23:32.000000000 -0400
@@ -32,7 +32,7 @@
 
 #include "kocore.h"
 
-int main(int argc,char **argv)
+extern "C" KDE_EXPORT int kdemain(int argc,char **argv)
 {
   KAboutData aboutData("korgplugins",I18N_NOOP("KOrgPlugins"),"0.1");
   KCmdLineArgs::init(argc,argv,&aboutData);
diff -Nurd kdepim-3.5.10/korganizer/main.cpp kdepim-3.5.10-new/korganizer/main.cpp
--- kdepim-3.5.10/korganizer/main.cpp	2005-09-10 04:24:47.000000000 -0400
+++ kdepim-3.5.10-new/korganizer/main.cpp	2009-04-17 16:23:32.000000000 -0400
@@ -35,7 +35,7 @@
 #include "korganizer.h"
 #include "korganizer_options.h"
 
-int main ( int argc, char **argv )
+extern "C" KDE_EXPORT int kdemain ( int argc, char **argv )
 {
   KOrg::AboutData aboutData;
 
diff -Nurd kdepim-3.5.10/korganizer/timezone.cpp kdepim-3.5.10-new/korganizer/timezone.cpp
--- kdepim-3.5.10/korganizer/timezone.cpp	2005-09-10 04:24:47.000000000 -0400
+++ kdepim-3.5.10-new/korganizer/timezone.cpp	2009-04-17 16:23:32.000000000 -0400
@@ -34,7 +34,7 @@
 
 #include "koprefs.h"
 
-int main(int argc,char **argv)
+extern "C" KDE_EXPORT int kdemain(int argc,char **argv)
 {
   KAboutData aboutData("timezone",I18N_NOOP("KOrganizer Timezone Test"),"0.1");
   KCmdLineArgs::init(argc,argv,&aboutData);
diff -Nurd kdepim-3.5.10/korn/Makefile.am kdepim-3.5.10-new/korn/Makefile.am
--- kdepim-3.5.10/korn/Makefile.am	2007-10-08 05:50:45.000000000 -0400
+++ kdepim-3.5.10-new/korn/Makefile.am	2009-04-17 16:23:32.000000000 -0400
@@ -7,11 +7,14 @@
 
 METASOURCES = AUTO
 
-bin_PROGRAMS = korn
-korn_LDADD = $(LIB_KIO) $(top_builddir)/libkmime/libkmime.la
-#korn_LDADD = $(top_builddir)/mimelib/libmimelib.la $(LIB_KFILE) $(LIBSOCKET) $(top_builddir)/libkmime/libkmime.la
+lib_LTLIBRARIES = 
+bin_PROGRAMS =
+kdeinit_LTLIBRARIES = korn.la
 
-korn_SOURCES = \
+korn_la_LDFLAGS = $(all_libraries) $(KDE_PLUGIN)
+korn_la_LIBADD = $(LIB_KIO) $(top_builddir)/libkmime/libkmime.la
+
+korn_la_SOURCES = \
   accountmanager.cpp \
   account_input.cpp \
   boxcontainer.cpp \
diff -Nurd kdepim-3.5.10/korn/main.cpp kdepim-3.5.10-new/korn/main.cpp
--- kdepim-3.5.10/korn/main.cpp	2006-07-22 04:14:20.000000000 -0400
+++ kdepim-3.5.10-new/korn/main.cpp	2009-04-17 16:23:32.000000000 -0400
@@ -14,7 +14,7 @@
 static const char version[] = "0.4";
 
 
-int main(int argc, char *argv[])
+extern "C" KDE_EXPORT int kdemain(int argc, char *argv[])
 {
 	KAboutData aboutData(argv[0], I18N_NOOP("Korn"),
 		version, description, KAboutData::License_GPL,
diff -Nurd kdepim-3.5.10/kpilot/conduits/Makefile.am kdepim-3.5.10-new/kpilot/conduits/Makefile.am
--- kdepim-3.5.10/kpilot/conduits/Makefile.am	2007-05-14 03:54:52.000000000 -0400
+++ kdepim-3.5.10-new/kpilot/conduits/Makefile.am	2009-04-17 16:23:32.000000000 -0400
@@ -7,6 +7,8 @@
 MAL_SUBDIR = malconduit
 else
 MAL_SUBDIR = 
+else
+MAL_SUBDIR =
 endif
 
 SUBDIRS = \
@@ -14,6 +16,7 @@
 	  docconduit \
 	  knotes \
 	  $(MAL_SUBDIR) \
+	  $(MAL_SUBDIR) \
 	  memofileconduit \
 	  notepadconduit \
 	  popmail \
diff -Nurd kdepim-3.5.10/kpilot/conduits/docconduit/Makefile.am kdepim-3.5.10-new/kpilot/conduits/docconduit/Makefile.am
--- kdepim-3.5.10/kpilot/conduits/docconduit/Makefile.am	2005-11-08 17:33:38.000000000 -0500
+++ kdepim-3.5.10-new/kpilot/conduits/docconduit/Makefile.am	2009-04-17 16:23:32.000000000 -0400
@@ -14,20 +14,22 @@
 
 noinst_LTLIBRARIES = libpalmdoc_shared.la
 kde_module_LTLIBRARIES = conduit_doc.la
-bin_PROGRAMS = kpalmdoc
+bin_PROGRAMS = 
+lib_LTLIBRARIES =
+kdeinit_LTLIBRARIES = kpalmdoc.la
 
 libpalmdoc_shared_la_SOURCES = makedoc9.cc pilotDOCHead.cc pilotDOCEntry.cc pilotDOCBookmark.cc DOC-converter.cc
 
 conduit_doc_la_SOURCES = docconduitSettings.kcfgc doc-factory.cc doc-setup.cc doc-conduit.cc doc-setupdialog.ui doc-conflictdialog.cc
-conduit_doc_la_LDFLAGS = -module $(KDE_PLUGIN) $(all_libraries)
+conduit_doc_la_LDFLAGS = $(all_libraries) $(KDE_PLUGIN)
 conduit_doc_la_LIBADD = ../../lib/libkpilot.la libpalmdoc_shared.la \
 	$(LIB_KDEUI) $(LIB_KFILE)
 
 ##libpalmdoc_shared.la
 
-kpalmdoc_SOURCES = kpalmdocSettings.kcfgc kpalmdoc_dlgbase.ui kpalmdoc_dlg.cc kpalmdoc.cpp
-kpalmdoc_LDFLAGS = $(PISOCK_LDFLAGS) $(all_libraries) $(KDE_RPATH)
-kpalmdoc_LDADD = $(LIB_KFILE) $(PISOCK_LIB) ../../lib/libkpilot.la libpalmdoc_shared.la
+kpalmdoc_la_SOURCES = kpalmdocSettings.kcfgc kpalmdoc_dlgbase.ui kpalmdoc_dlg.cc kpalmdoc.cpp
+kpalmdoc_la_LDFLAGS = $(PISOCK_LDFLAGS) $(all_libraries) $(KDE_PLUGIN)
+kpalmdoc_la_LIBADD = $(LIB_KFILE) $(PISOCK_LIB) ../../lib/libkpilot.la libpalmdoc_shared.la
 
 xdg_apps_DATA = kpalmdoc.desktop
 servicetypedir = $(kde_servicetypesdir)
diff -Nurd kdepim-3.5.10/kpilot/conduits/docconduit/kpalmdoc.cpp kdepim-3.5.10-new/kpilot/conduits/docconduit/kpalmdoc.cpp
--- kdepim-3.5.10/kpilot/conduits/docconduit/kpalmdoc.cpp	2005-09-10 04:24:37.000000000 -0400
+++ kdepim-3.5.10-new/kpilot/conduits/docconduit/kpalmdoc.cpp	2009-04-17 16:23:32.000000000 -0400
@@ -36,7 +36,7 @@
 
 
 
-int main(int argc, char *argv[])
+extern "C" KDE_EXPORT int kdemain(int argc, char *argv[])
 {
 
 	KAboutData about("converter", I18N_NOOP("KPalmDOC"), "-0.0.1",
diff -Nurd kdepim-3.5.10/kpilot/conduits/malconduit/mal-conduit.cc kdepim-3.5.10-new/kpilot/conduits/malconduit/mal-conduit.cc
--- kdepim-3.5.10/kpilot/conduits/malconduit/mal-conduit.cc	2007-05-14 03:54:51.000000000 -0400
+++ kdepim-3.5.10-new/kpilot/conduits/malconduit/mal-conduit.cc	2009-04-17 16:23:32.000000000 -0400
@@ -34,6 +34,7 @@
 
 #include "options.h"
 
+#include <stdarg.h>
 #include <qregexp.h>
 #include <kconfig.h>
 #include <kdebug.h>
diff -Nurd kdepim-3.5.10/kpilot/kpilot/Makefile.am kdepim-3.5.10-new/kpilot/kpilot/Makefile.am
--- kdepim-3.5.10/kpilot/kpilot/Makefile.am	2007-05-14 03:54:52.000000000 -0400
+++ kdepim-3.5.10-new/kpilot/kpilot/Makefile.am	2009-04-17 16:23:32.000000000 -0400
@@ -9,9 +9,10 @@
 SUBDIRS = Icons
 
 noinst_LTLIBRARIES = libconfiguration.la
-noinst_PROGRAMS = kpilotTest
-bin_PROGRAMS = kpilot kpilotDaemon
+bin_PROGRAMS = 
 kde_module_LTLIBRARIES = kcm_kpilot.la
+lib_LTLIBRARIES = 
+kdeinit_LTLIBRARIES = kpilot.la kpilotDaemon.la
 
 METASOURCES = AUTO
 
@@ -35,13 +36,13 @@
 	kpilotConfigWizard_app.ui \
 	kpilotConfigWizard.cc \
 	dbSelectionDialog.cc dbSelection_base.ui
-kcm_kpilot_la_LDFLAGS = $(PISOCK_LDFLAGS) $(all_libraries) -module -avoid-version -no-undefined
+kcm_kpilot_la_LDFLAGS = $(PISOCK_LDFLAGS) $(all_libraries) $(KDE_PLUGIN)
 kcm_kpilot_la_LIBADD = $(LIB_KFILE) $(PISOCK_LIB) \
 	../lib/libkpilot.la \
 	libconfiguration.la
 
 
-kpilot_SOURCES	= \
+kpilot_la_SOURCES	= \
 	pilotDaemonDCOP.stub kpilotDCOP.skel loggerDCOP.skel \
 	kpilot.cc \
 	pilotComponent.cc logWidget.cc memoWidget.cc \
@@ -52,10 +53,10 @@
 	todoWidget.cc todoEditor.cc todoEditor_base.ui \
 	fileInstaller.cc fileInstallWidget.cc \
 	listItems.cc
-kpilot_COMPILE_FIRST = kpilotSettings.h
+kpilot_la_COMPILE_FIRST = kpilotSettings.h
 
 
-kpilotDaemon_SOURCES = \
+kpilotDaemon_la_SOURCES = \
 	pilotDaemonDCOP.skel kpilotDCOP.stub loggerDCOP.stub loggerDCOP.skel \
 	pilotDaemon.cc logFile.cc \
 	hotSync.cc internalEditorAction.cc \
@@ -68,16 +69,16 @@
 	main-test.cc
 
 
-kpilot_LDFLAGS = $(PISOCK_LDFLAGS) $(all_libraries) $(KDE_RPATH)
-kpilotDaemon_LDFLAGS = $(PISOCK_LDFLAGS) $(all_libraries) $(KDE_RPATH)
+kpilot_la_LDFLAGS = $(PISOCK_LDFLAGS) $(all_libraries) $(KDE_PLUGIN)
+kpilotDaemon_la_LDFLAGS = $(PISOCK_LDFLAGS) $(all_libraries) $(KDE_PLUGIN)
 kpilotTest_LDFLAGS = $(PISOCK_LDFLAGS) $(all_libraries) $(KDE_RPATH)
 
 
 # the libraries to link against. Be aware of the order. First the libraries,
 # that depend on the following ones.
-kpilot_LDADD		= $(LIB_KFILE) $(PISOCK_LIB) -lkutils \
+kpilot_la_LIBADD		= $(LIB_KFILE) $(PISOCK_LIB) -lkutils \
 	../lib/libkpilot.la  libconfiguration.la
-kpilotDaemon_LDADD	= $(LIB_KFILE) $(PISOCK_LIB) \
+kpilotDaemon_la_LIBADD	= $(LIB_KFILE) $(PISOCK_LIB) \
 	../lib/libkpilot.la libconfiguration.la
 kpilotTest_LDADD	= $(LIB_KFILE) $(PISOCK_LIB) \
 	../lib/libkpilot.la libconfiguration.la
diff -Nurd kdepim-3.5.10/kpilot/kpilot/kpilot.cc kdepim-3.5.10-new/kpilot/kpilot/kpilot.cc
--- kdepim-3.5.10/kpilot/kpilot/kpilot.cc	2007-05-14 03:54:52.000000000 -0400
+++ kdepim-3.5.10-new/kpilot/kpilot/kpilot.cc	2009-04-17 16:23:32.000000000 -0400
@@ -1008,7 +1008,7 @@
 
 
 
-int main(int argc, char **argv)
+extern "C" KDE_EXPORT int kdemain(int argc, char **argv)
 {
 	FUNCTIONSETUP;
 
diff -Nurd kdepim-3.5.10/kpilot/kpilot/pilotDaemon.cc kdepim-3.5.10-new/kpilot/kpilot/pilotDaemon.cc
--- kdepim-3.5.10/kpilot/kpilot/pilotDaemon.cc	2007-05-14 03:54:52.000000000 -0400
+++ kdepim-3.5.10-new/kpilot/kpilot/pilotDaemon.cc	2009-04-17 16:23:32.000000000 -0400
@@ -1301,7 +1301,7 @@
 } ;
 
 
-int main(int argc, char **argv)
+extern "C" KDE_EXPORT int kdemain(int argc, char **argv)
 {
 	FUNCTIONSETUP;
 
diff -Nurd kdepim-3.5.10/kresources/featureplan/benchmarkfeaturelist.cpp kdepim-3.5.10-new/kresources/featureplan/benchmarkfeaturelist.cpp
--- kdepim-3.5.10/kresources/featureplan/benchmarkfeaturelist.cpp	2008-02-13 04:39:29.000000000 -0500
+++ kdepim-3.5.10-new/kresources/featureplan/benchmarkfeaturelist.cpp	2009-04-17 16:23:32.000000000 -0400
@@ -67,7 +67,7 @@
   }
 }
 
-int main( int argc, char **argv )
+extern "C" KDE_EXPORT int kdemain( int argc, char **argv )
 {
   KAboutData aboutData( "benchmarkfeaturelist",
                         "Benchmark for feature list XML parser",
diff -Nurd kdepim-3.5.10/kresources/featureplan/dumpfeaturelist.cpp kdepim-3.5.10-new/kresources/featureplan/dumpfeaturelist.cpp
--- kdepim-3.5.10/kresources/featureplan/dumpfeaturelist.cpp	2006-05-22 14:10:46.000000000 -0400
+++ kdepim-3.5.10-new/kresources/featureplan/dumpfeaturelist.cpp	2009-04-17 16:23:32.000000000 -0400
@@ -67,7 +67,7 @@
   }
 }
 
-int main( int argc, char **argv )
+extern "C" KDE_EXPORT int kdemain( int argc, char **argv )
 {
   KAboutData aboutData( "dumpfeaturelist", "Dump XML feature list to stdout",
                         "0.1" );
diff -Nurd kdepim-3.5.10/kresources/groupwise/soap/soapdebug.cpp kdepim-3.5.10-new/kresources/groupwise/soap/soapdebug.cpp
--- kdepim-3.5.10/kresources/groupwise/soap/soapdebug.cpp	2005-09-10 04:23:46.000000000 -0400
+++ kdepim-3.5.10-new/kresources/groupwise/soap/soapdebug.cpp	2009-04-17 16:23:32.000000000 -0400
@@ -44,7 +44,7 @@
   KCmdLineLastOption
 };
 
-int main( int argc, char **argv )
+extern "C" KDE_EXPORT int kdemain( int argc, char **argv )
 {
   KAboutData aboutData( "soapdebug", I18N_NOOP("Groupwise Soap Debug"), "0.1" );
   aboutData.addAuthor( "Cornelius Schumacher", 0, "schumacher@kde.org" );
diff -Nurd kdepim-3.5.10/ktnef/gui/Makefile.am kdepim-3.5.10-new/ktnef/gui/Makefile.am
--- kdepim-3.5.10/ktnef/gui/Makefile.am	2005-09-10 04:24:43.000000000 -0400
+++ kdepim-3.5.10-new/ktnef/gui/Makefile.am	2009-04-17 16:23:32.000000000 -0400
@@ -2,14 +2,16 @@
 
 SUBDIRS = pics
 
-bin_PROGRAMS = ktnef
+bin_PROGRAMS = 
+lib_LTLIBRARIES = 
+kdeinit_LTLIBRARIES = ktnef.la
 
-ktnef_LDFLAGS = $(KDE_RPATH) $(all_libraries)
-ktnef_LDADD   = $(LIB_KFILE) $(top_builddir)/ktnef/lib/libktnef.la
-ktnef_SOURCES = ktnefmain.cpp ktnefview.cpp attachpropertydialogbase.ui \
+ktnef_la_LDFLAGS = $(all_libraries) $(KDE_PLUGIN)
+ktnef_la_LIBADD  = $(LIB_KFILE) $(top_builddir)/ktnef/lib/libktnef.la
+ktnef_la_SOURCES = ktnefmain.cpp ktnefview.cpp attachpropertydialogbase.ui \
                 attachpropertydialog.cpp messagepropertydialog.cpp \
                 qwmf.cpp main.cpp
-ktnef_METASOURCES = AUTO
+ktnef_la_METASOURCES = AUTO
 
 noinst_HEADERS = ktnefmain.h ktnefview.h attachpropertydialog.h \
                  qwmf.h wmfstruct.h metafuncs.h
diff -Nurd kdepim-3.5.10/ktnef/gui/main.cpp kdepim-3.5.10-new/ktnef/gui/main.cpp
--- kdepim-3.5.10/ktnef/gui/main.cpp	2005-09-10 04:24:43.000000000 -0400
+++ kdepim-3.5.10-new/ktnef/gui/main.cpp	2009-04-17 16:23:33.000000000 -0400
@@ -33,7 +33,7 @@
   // INSERT YOUR COMMANDLINE OPTIONS HERE
 };
 
-int main(int argc, char *argv[])
+extern "C" KDE_EXPORT int kdemain(int argc, char *argv[])
 {
 
   KAboutData aboutData( "ktnef", I18N_NOOP("KTnef"),
diff -Nurd kdepim-3.5.10/libkcal/convertqtopia.cpp kdepim-3.5.10-new/libkcal/convertqtopia.cpp
--- kdepim-3.5.10/libkcal/convertqtopia.cpp	2005-09-10 04:24:36.000000000 -0400
+++ kdepim-3.5.10-new/libkcal/convertqtopia.cpp	2009-04-17 16:23:33.000000000 -0400
@@ -48,7 +48,7 @@
   KCmdLineLastOption
 };
 
-int main(int argc,char **argv)
+extern "C" KDE_EXPORT int kdemain(int argc,char **argv)
 {
   KAboutData aboutData("convertqtopia",I18N_NOOP("Qtopia calendar file converter"),"0.1");
   aboutData.addAuthor("Cornelius Schumacher", 0, "schumacher@kde.org");
diff -Nurd kdepim-3.5.10/libkdepim/cfgc/autoexample.cpp kdepim-3.5.10-new/libkdepim/cfgc/autoexample.cpp
--- kdepim-3.5.10/libkdepim/cfgc/autoexample.cpp	2005-09-10 04:24:24.000000000 -0400
+++ kdepim-3.5.10-new/libkdepim/cfgc/autoexample.cpp	2009-04-17 16:23:33.000000000 -0400
@@ -36,7 +36,7 @@
 
 #include <qlabel.h>
 
-int main( int argc, char **argv )
+extern "C" KDE_EXPORT int kdemain( int argc, char **argv )
 {
   KAboutData aboutData( "example", I18N_NOOP("autoconfig example"), "0.1" );
   aboutData.addAuthor( "Cornelius Schumacher", 0, "schumacher@kde.org" );
diff -Nurd kdepim-3.5.10/libkdepim/cfgc/example.cpp kdepim-3.5.10-new/libkdepim/cfgc/example.cpp
--- kdepim-3.5.10/libkdepim/cfgc/example.cpp	2005-09-10 04:24:24.000000000 -0400
+++ kdepim-3.5.10-new/libkdepim/cfgc/example.cpp	2009-04-17 16:23:33.000000000 -0400
@@ -32,7 +32,7 @@
 
 #include <libkdepim/kprefsdialog.h>
 
-int main( int argc, char **argv )
+extern "C" KDE_EXPORT int kdemain( int argc, char **argv )
 {
   KAboutData aboutData( "example", I18N_NOOP("cfgc example"), "0.1" );
   aboutData.addAuthor( "Cornelius Schumacher", 0, "schumacher@kde.org" );
diff -Nurd kdepim-3.5.10/libkholidays/Makefile.am kdepim-3.5.10-new/libkholidays/Makefile.am
--- kdepim-3.5.10/libkholidays/Makefile.am	2006-07-22 04:14:21.000000000 -0400
+++ kdepim-3.5.10-new/libkholidays/Makefile.am	2009-04-17 16:23:33.000000000 -0400
@@ -7,7 +7,7 @@
 lib_LTLIBRARIES = libkholidays.la
 
 libkholidays_la_LDFLAGS = $(all_libraries) -no-undefined -version-info 1:0:0
-libkholidays_la_LIBADD = $(LIB_KIO)
+libkholidays_la_LIBADD = $(LIB_KIO) $(LIBZ)
 libkholidays_la_SOURCES = kholidays.cpp scanholiday.c parseholiday.h parseholiday.c lunarphase.cpp
 
 #the lex/flex and yacc/bison files are in CVS and NOT generated
diff -Nurd kdepim-3.5.10/libkholidays/parseholiday.c kdepim-3.5.10-new/libkholidays/parseholiday.c
--- kdepim-3.5.10/libkholidays/parseholiday.c	2007-10-08 05:50:46.000000000 -0400
+++ kdepim-3.5.10-new/libkholidays/parseholiday.c	2009-04-17 16:23:33.000000000 -0400
@@ -204,8 +204,8 @@
 			 int year, int off, int length);
 /*** Variables and structures ***/
 static int	 m, d, y;
-int              kcallineno;	       	/* current line # being parsed */
-FILE            *kcalin;                  /* file currently being processed */
+extern int              kcallineno;	       	/* current line # being parsed */
+extern FILE            *kcalin;                  /* file currently being processed */
 int	         yacc_small;		/* small string or on its own line? */
 int	         yacc_stringcolor;	/* color of holiday name text, 1..8 */
 char	        *yacc_string;		/* holiday name text */
diff -Nurd kdepim-3.5.10/libkholidays/scanholiday.c kdepim-3.5.10-new/libkholidays/scanholiday.c
--- kdepim-3.5.10/libkholidays/scanholiday.c	2007-05-14 03:54:44.000000000 -0400
+++ kdepim-3.5.10-new/libkholidays/scanholiday.c	2009-04-17 16:23:33.000000000 -0400
@@ -15,6 +15,8 @@
 #define yyrestart kcalrestart
 #define yytext kcaltext
 
+int kcallineno;
+
 #line 19 "scanholiday.c"
 /* A lexical scanner generated by flex*/
 
diff -Nurd kdepim-3.5.10/mimelib/dw_date.cpp kdepim-3.5.10-new/mimelib/dw_date.cpp
--- kdepim-3.5.10/mimelib/dw_date.cpp	2007-05-14 03:54:54.000000000 -0400
+++ kdepim-3.5.10-new/mimelib/dw_date.cpp	2009-04-17 16:23:33.000000000 -0400
@@ -656,7 +656,7 @@
     ""
 };
 
-int main()
+extern "C" KDE_EXPORT int kdemain()
 {
     struct tm *ptms, tms1, tms2;
     time_t tt;
diff -Nurd kdepim-3.5.10/mimelib/uuencode.cpp kdepim-3.5.10-new/mimelib/uuencode.cpp
--- kdepim-3.5.10/mimelib/uuencode.cpp	2007-05-14 03:54:54.000000000 -0400
+++ kdepim-3.5.10-new/mimelib/uuencode.cpp	2009-04-17 16:23:33.000000000 -0400
@@ -429,7 +429,7 @@
 
 // Test harness for DwUudecode
 
-int main(int argc, char** argv)
+extern "C" KDE_EXPORT int kdemain(int argc, char** argv)
 {
 	srand(time(0));
 	DwString binStr;
diff -Nurd kdepim-3.5.10/networkstatus/Makefile.am kdepim-3.5.10-new/networkstatus/Makefile.am
--- kdepim-3.5.10/networkstatus/Makefile.am	2005-09-10 04:24:02.000000000 -0400
+++ kdepim-3.5.10-new/networkstatus/Makefile.am	2009-04-17 16:23:33.000000000 -0400
@@ -19,7 +19,7 @@
 	clientiface.skel serviceiface.skel network.cpp
 #kclientiface.skel serviceiface.skel
 kded_networkstatus_la_LIBADD = $(LIB_KDECORE) $(LIB_KIO) ./libnetworkstatus.la
-kded_networkstatus_la_LDFLAGS = $(all_libraries) -module -avoid-version 
+kded_networkstatus_la_LDFLAGS = $(all_libraries) $(KDE_RPATH) -module -avoid-version
 
 servicesdir = $(kde_servicesdir)/kded
 services_DATA = networkstatus.desktop
@@ -27,9 +27,11 @@
 noinst_HEADERS = serviceiface.h networkstatuscommon.h serviceifaceimpl.h \
 	network.h clientifaceimpl.h provideriface.h testservice.h connectionmanager.h
 
-bin_PROGRAMS = networkstatustestservice
+bin_PROGRAMS = 
+lib_LTLIBRARIES =
+kdeinit_LTLIBRARIES = networkstatustestservice.la
 
-networkstatustestservice_LDFLAGS = $(all_libraries)
-networkstatustestservice_LDADD = libnetworkstatus.la
+networkstatustestservice_la_LDFLAGS = $(all_libraries) $(KDE_PLUGIN)
+networkstatustestservice_la_LIBADD = libnetworkstatus.la
 
-networkstatustestservice_SOURCES = testservice.cpp provideriface.skel serviceiface.stub
+networkstatustestservice_la_SOURCES = testservice.cpp provideriface.skel serviceiface.stub
diff -Nurd kdepim-3.5.10/networkstatus/testservice.cpp kdepim-3.5.10-new/networkstatus/testservice.cpp
--- kdepim-3.5.10/networkstatus/testservice.cpp	2005-09-10 04:24:02.000000000 -0400
+++ kdepim-3.5.10-new/networkstatus/testservice.cpp	2009-04-17 16:23:33.000000000 -0400
@@ -90,7 +90,7 @@
 	m_service->setNetworkStatus( "test_net", (int)m_status );
 }
 
-int main( int argc, char** argv )
+extern "C" KDE_EXPORT int kdemain( int argc, char** argv )
 {
 	KApplication app(argc, argv, "testdcop");
 	TestService * test = new TestService;
diff -Nurd kdepim-3.5.10/wizards/Makefile.am kdepim-3.5.10-new/wizards/Makefile.am
--- kdepim-3.5.10/wizards/Makefile.am	2008-02-13 04:39:28.000000000 -0500
+++ kdepim-3.5.10-new/wizards/Makefile.am	2009-04-17 16:23:33.000000000 -0400
@@ -12,7 +12,7 @@
 bin_PROGRAMS = groupwarewizard egroupwarewizard sloxwizard kolabwizard \
                groupwisewizard exchangewizard scalixwizard
 
-kde_module_LTLIBRARIES = libegroupwarewizard.la libsloxwizard.la \
+lib_LTLIBRARIES = libegroupwarewizard.la libsloxwizard.la \
                          libkolabwizard.la libgroupwisewizard.la \
                          libexchangewizard.la libscalixwizard.la
 
