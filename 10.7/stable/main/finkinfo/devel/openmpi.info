Package: openmpi
Version: 1.6.4
Revision: 2
GCC: 4.0
Description: MPI implementation for parallel computing
License: BSD
Maintainer: Jack Howarth <howarth@bromo.med.uc.edu>
Distribution: 10.7, 10.8
Depends: %N-shlibs (= %v-%r), gcc48-compiler
BuildDepends: gcc48-compiler, fink-package-precedence, flag-sort, fink (>= 0.28)
Conflicts: libotf
Source: http://www.open-mpi.org/software/ompi/v1.6/downloads/openmpi-%v.tar.bz2
Source-MD5: 62119579ab92b2592cd96b6a9d2a8cc3
ConfigureParams: --prefix=%p --datadir=%p/share/doc --sysconfdir=%p/etc/%n --sharedstatedir=%p/var/%n/shared --localstatedir=%p/var/%n/local --libdir=%p/lib/%n --includedir=%p/include --infodir=%p/share/info --mandir=%p/share/man --enable-shared --enable-static FFLAGS=-O3 --with-devel-headers F77=gfortran-fsf-4.8 FC=gfortran-fsf-4.8
SetCC: gcc-fsf-4.8
SetCXX: g++-fsf-4.8
NoSetMAKEFLAGS: true
NoSetCPPFLAGS: true
NoSetLDFLAGS: true
UseMaxBuildJobs: true
BuildDependsOnly: false
# avoid a race condition concerning lock files, see <http://thread.gmane.org/gmane.os.macosx.fink.user/34928/focus=34985>
PatchScript: <<
#!/bin/sh -ev
perl -pi -e 's|lock_old_archive_extraction=yes|lock_old_archive_extraction=no|' `find . -name configure`
<<
CompileScript: <<
  #!/bin/sh -ev
  ./configure %c
  export CC="flag-sort -v -r $CC"
  make CC="$CC" CPP="$CC -E"
  fink-package-precedence --prohibit-bdep=openmpi .
<<
InstallScript: <<
#!/bin/sh -ev
make install DESTDIR=%d
# case-sensitive hackery
mv %i/bin/mpicc %i/bin/mpicc_tmp
if [ -f %i/bin/mpiCC ]; then
  rm %i/bin/mpiCC
  rm %i/bin/mpiCC-vt
  rm %i/share/doc/openmpi/mpiCC-vt-wrapper-data.txt
  rm %i/share/doc/openmpi/mpiCC-wrapper-data.txt
  rm %i/share/man/man1/mpiCC.1
fi
mv %i/bin/mpicc_tmp %i/bin/mpicc
ln -s %p/lib/%N/libopen-pal.4.dylib %i/lib/%N/libopal.4.dylib
ln -s %p/lib/%N/libopen-pal.4.dylib %i/lib/%N/libopal.dylib
ln -s %p/lib/%N/libopen-rte.4.dylib %i/lib/%N/liborte.4.dylib
ln -s %p/lib/%N/libopen-rte.4.dylib %i/lib/%N/liborte.dylib
# remove published compiler flag that points to fink build dir.
perl -pi -e "s, \-L[^ ']*/opal/mca/hwloc/hwloc132/hwloc/src,,g" `find %i/lib/%N -name '*.la'`
perl -pi -e "s, \-L[^ ']*/ompi/contrib/vt/vt/../../../.libs,,g" `find %i/lib/%N -name '*.la'`
<<
PostInstScript: <<
 if [ ! -f %p/share/doc/openmpi/mpiCC-vt-wrapper-data.txt ]; then
    ln -s %p/share/doc/openmpi/mpicc-vt-wrapper-data.txt %p/share/doc/openmpi/mpiCC-vt-wrapper-data.txt
    ln -s %p/share/doc/openmpi/mpicc-wrapper-data.txt %p/share/doc/openmpi/mpiCC-wrapper-data.txt
    ln -s %p/share/man/man1/mpicc.1 %p/share/man/man1/mpiCC.1
 fi
 if [ ! -h %p/bin/mpiCC ]; then
    ln -s %p/bin/mpicc %p/bin/mpiCC
    ln -s %p/bin/mpicc-vt %p/bin/mpiCC-vt
 fi
<<
PreRmScript: <<
 if [ -h %p/share/doc/openmpi/mpiCC-vt-wrapper-data.txt ]; then
    rm -f %p/share/doc/openmpi/mpiCC-vt-wrapper-data.txt
    rm -f %p/share/doc/openmpi/mpiCC-wrapper-data.txt
    rm -f %p/share/man/man1/mpiCC.1
 fi
 if [ -h %p/bin/mpiCC ]; then
    rm -f %p/bin/mpiCC
    rm -f %p/bin/mpiCC-vt
 fi
<<
DocFiles: AUTHORS INSTALL LICENSE README VERSION
SplitOff: <<
 Package: %N-shlibs
 Depends: gcc48-shlibs
 Files: <<
   lib/%N/lib*.*.dylib
 <<
 Shlibs: <<
    !%p/lib/%N/libopen-pal.4.dylib
    %p/lib/%N/libmpi.1.dylib 2.0.0 %n (>= 1.5.3-1)
    !%p/lib/%N/libopen-rte.4.dylib
    %p/lib/%N/libmpi_cxx.1.dylib 2.0.0 %n (>= 1.5.3-1)
    %p/lib/%N/libmpi_f77.1.dylib 2.0.0 %n (>= 1.5.3-1)
    %p/lib/%N/libmpi_f90.1.dylib 5.0.0 %n (>= 1.5.4-1)
    !%p/lib/%N/libompitrace.0.dylib
    !%p/lib/%N/libotf.1.dylib
    !%p/lib/%N/libotfaux.0.dylib
    !%p/lib/%N/libvt-hyb.0.dylib
    !%p/lib/%N/libvt-mpi.0.dylib
    !%p/lib/%N/libvt-mt.0.dylib
    !%p/lib/%N/libvt.0.dylib
    !%p/lib/%N/libvt-mpi-unify.0.dylib
    !%p/lib/openmpi/libopen-trace-format.1.dylib
 <<
 DocFiles: AUTHORS INSTALL LICENSE README VERSION
 Description: Shared libraries for openmpi package
<<
DescDetail: <<
Open MPI is a project combining technologies and resources from
several other projects (FT-MPI, LA-MPI, LAM/MPI, and PACX-MPI) in
order to build the best MPI library available.
<< 
DescPackaging: <<
Limit to Distribution: 10.7 to allow refactoring of the package into
openmpi2/openmpi-shlibs. No need to rename any files as 10.7 has no
openmpi.
<<
DescUsage: <<
The Open-MPI system is started with the command...
    orted --seed --persistent --scope public
<<
Homepage: http://www.open-mpi.org
