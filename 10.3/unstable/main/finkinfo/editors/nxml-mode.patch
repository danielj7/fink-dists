diff -Naur nxml-mode-20040908/fink/emacsen-install nxml-mode-20040908.fink/fink/emacsen-install
--- nxml-mode-20040908/fink/emacsen-install	Thu Jan  1 10:00:00 1970
+++ nxml-mode-20040908.fink/fink/emacsen-install	Wed Sep  8 22:24:18 2004
@@ -0,0 +1,38 @@
+#! /bin/sh
+# @PREFIX@/lib/emacsen-common/packages/install/nxml-mode
+set -e
+
+FLAVOR=$1
+PACKAGE=nxml-mode
+
+if [ ${FLAVOR} != emacs21 ]; then exit 0; fi
+
+echo install/${PACKAGE}: Handling install for emacsen flavor ${FLAVOR}
+
+FLAGS="-no-site-file -q -batch -l path.el -f batch-byte-compile"
+
+ELDIR=@PREFIX@/share/emacs/site-lisp/${PACKAGE}
+ELCDIR=@PREFIX@/share/${FLAVOR}/site-lisp/${PACKAGE}
+
+/usr/bin/install -m 755 -d ${ELCDIR}
+cd ${ELDIR}
+FILES=`echo *.el`
+/bin/cp ${FILES} ${ELCDIR}
+cd ${ELCDIR}
+
+/bin/cat << EOF > path.el
+(setq load-path (cons "." load-path) byte-compile-warnings nil)
+EOF
+
+${FLAVOR} ${FLAGS} ${FILES}
+/bin/rm -f *.el path.el
+
+/usr/bin/install -m 755 -d ${ELCDIR}/char-name/unicode
+ln ${ELDIR}/char-name/unicode/*.el ${ELCDIR}/char-name/unicode
+
+/bin/cat << EOF > @PREFIX@/etc/${FLAVOR}/site-start.d/50${PACKAGE}.el
+(load "@PREFIX@/share/${FLAVOR}/site-lisp/${PACKAGE}/rng-auto.elc")
+EOF
+
+exit 0
+
diff -Naur nxml-mode-20040908/fink/emacsen-remove nxml-mode-20040908.fink/fink/emacsen-remove
--- nxml-mode-20040908/fink/emacsen-remove	Thu Jan  1 10:00:00 1970
+++ nxml-mode-20040908.fink/fink/emacsen-remove	Wed Sep  8 22:24:18 2004
@@ -0,0 +1,13 @@
+#! /bin/sh
+# @PREFIX@/lib/emacsen-common/packages/remove/nxml-mode
+
+FLAVOR=$1
+PACKAGE=nxml-mode
+if [ ${FLAVOR} != emacs ]; then
+
+    echo remove/${PACKAGE}: purging byte-compiled files for ${FLAVOR}
+    /bin/rm -rf @PREFIX@/share/${FLAVOR}/site-lisp/${PACKAGE}
+
+    /bin/rm -f @PREFIX@/etc/${FLAVOR}/site-start.d/??${PACKAGE}.el
+fi
+
diff -Naur nxml-mode-20040908/nxml-mode.el nxml-mode-20040908.fink/nxml-mode.el
--- nxml-mode-20040908/nxml-mode.el	Wed Sep  8 19:46:29 2004
+++ nxml-mode-20040908.fink/nxml-mode.el	Wed Sep  8 23:25:59 2004
@@ -1677,12 +1677,13 @@
       (cond ((<= (point) xmltok-start)
 	     (goto-char xmltok-start)
 	     (setq off nxml-attribute-indent)
-	     (when xmltok-attributes
-	       (let* ((att (car xmltok-attributes))
-		      (start (xmltok-attribute-name-start att)))
-		 (when (< start pos)
-		   (goto-char start)
-		   (setq off 0)))))
+	     (let ((atts (xmltok-merge-attributes)))
+	       (when atts
+		 (let* ((att (car atts))
+			(start (xmltok-attribute-name-start att)))
+		   (when (< start pos)
+		     (goto-char start)
+		     (setq off 0))))))
 	    (t
 	     (back-to-indentation))))
     (+ (current-column) off)))
@@ -1692,7 +1693,7 @@
 Otherwise return nil.  START and END are the positions of the start
 and end of the attribute value containing POS.  This expects the
 xmltok-* variables to be set up as by `xmltok-forward'."
-  (let ((atts xmltok-attributes)
+  (let ((atts (xmltok-merge-attributes))
 	att value-start value-end value-boundary)
     (while atts
       (setq att (car atts))
diff -Naur nxml-mode-20040908/nxml-mode.info nxml-mode-20040908.fink/nxml-mode.info
--- nxml-mode-20040908/nxml-mode.info	Wed Sep  8 19:56:37 2004
+++ nxml-mode-20040908.fink/nxml-mode.info	Wed Sep  8 22:24:17 2004
@@ -3,7 +3,7 @@
 
 INFO-DIR-SECTION Emacs
 START-INFO-DIR-ENTRY
-* nXML Mode: (nxml-mode.info).
+* nXML Mode: (nxml-mode.info).     Emacs major mode for editing XML
 END-INFO-DIR-ENTRY
 
 
diff -Naur nxml-mode-20040908/rng-auto.el nxml-mode-20040908.fink/rng-auto.el
--- nxml-mode-20040908/rng-auto.el	Wed Sep  8 19:51:09 2004
+++ nxml-mode-20040908.fink/rng-auto.el	Wed Sep  8 22:24:17 2004
@@ -55,7 +55,7 @@
 		 (append Info-default-directory-list (list dir)))))))
 
 (let* ((dir (file-name-directory load-file-name))
-       (schema-dir (concat dir "schema/")))
+       (schema-dir "@PREFIX@/share/schema/"))
   (unless (member dir load-path)
     (setq load-path (cons dir load-path)))
   (setq rng-schema-locating-files-default
diff -Naur nxml-mode-20040908/xmltok.el nxml-mode-20040908.fink/xmltok.el
--- nxml-mode-20040908/xmltok.el	Tue Aug 10 11:12:02 2004
+++ nxml-mode-20040908.fink/xmltok.el	Wed Sep  8 23:27:29 2004
@@ -1877,6 +1877,32 @@
 	(cons (vector type start end)
 	      xmltok-prolog-regions)))
 
+(defun xmltok-merge-attributes ()
+  "Return a list merging `xmltok-attributes' and 'xmltok-namespace-attributes'.
+The members of the merged list are in order of occurrence in the
+document.  The list may share list structure with `xmltok-attributes'
+and `xmltok-namespace-attributes'."
+  (cond ((not xmltok-namespace-attributes)
+	 xmltok-attributes)
+	((not xmltok-attributes)
+	 xmltok-namespace-attributes)
+	(t
+	 (let ((atts1 xmltok-attributes)
+	       (atts2 xmltok-namespace-attributes)
+	       merged)
+	   (while (and atts1 atts2)
+	     (cond ((< (xmltok-attribute-name-start (car atts1))
+		       (xmltok-attribute-name-start (car atts2)))
+		    (setq merged (cons (car atts1) merged))
+		    (setq atts1 (cdr atts1)))
+		   (t
+		    (setq merged (cons (car atts2) merged))
+		    (setq atts2 (cdr atts2)))))
+	   (setq merged (nreverse merged))
+	   (cond (atts1 (setq merged (nconc merged atts1)))
+		 (atts2 (setq merged (nconc merged atts2))))
+	   merged))))
+
 ;;; Testing
 
 (defun xmltok-forward-test ()
