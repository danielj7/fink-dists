Package: python27
Version: 2.7
Revision: 101
Epoch: 1
Distribution: 10.6
Maintainer: Daniel Johnson <daniel@daniel-johnson.org>
Depends: <<
	%N-shlibs (= %e:%v-%r),
	blt-shlibs,
	bzip2-shlibs,
	db48-aes-shlibs | db48-shlibs,
	gdbm3-shlibs,
	libgettext8-shlibs,
	libncursesw5-shlibs,
	readline5-shlibs,
	sqlite3-shlibs  (>= 3.2.8-1001),
	tcltk (>= 8.4.1-1),
	x11
<<
BuildConflicts: libquicktime0
BuildDepends: <<
	blt-dev (>= 2.4z-15),
	bzip2-dev,
	db48-aes | db48,
	fink (>= 0.24.12-1), 
	gdbm3,
	gettext-bin,
	gettext-tools,
	libgettext8-dev,
	libncursesw5,
	readline5,
	sqlite3-dev (>= 3.2.8-1001),
	system-openssl-dev,
	tcltk-dev (>= 8.4.1-1),
	x11-dev
<<
Source: http://python.org/ftp/python/%v/Python-%v.tar.bz2
Source-MD5: 0e8c9ec32abf5b732bea7d91b38c3339
Source2: http://www.python.org/ftp/python/doc/%v/python-%v-docs-html.tar.bz2
Source2-MD5: 16b736789e923bbefe74e7a2219031c6
PatchFile: %n-10.6.patch
PatchFile-MD5: 7edbd80668140016e47b8b250db9e017
PatchScript: sed 's|@PREFIX@|%p|g' < %{PatchFile} | patch -p1
SetLDFLAGS: -L%p/lib/system-openssl/lib
ConfigureParams: --enable-shared
#GCC: 4.0
CompileScript: <<
#!/bin/sh -ex
	if [ "%m" = "x86_64" ]; then
		perl -pi.bak -e 's|num_missing != 5:|num_missing != 7:|g; s|have 5 missing|have 7 missing|' ./setup.py
		# Architecture:x86_64 has tcltk-8.5.x, other arch have 8.4.x
                perl -pi.bak -e "s/8.4\'/8.5\'/" ./setup.py
		# Architecture:x86_64 can't build with toolbox-glue
		./configure %c --disable-toolbox-glue
	else
		./configure %c
	fi
	make
<<
InstallScript: <<
#!/bin/sh -ex
	make install DESTDIR=%d

	# don't propagate our hackery
	perl -pi -e 's|-L%p/lib/system-openssl/lib||' %i/lib/python2.7/config/Makefile

	# fix all main things to be python-versioned filenames with
	# unversioned symlinks to them
	pushd %i/bin
		for f in 2to3 idle pydoc smtpd.py; do
			mv ${f} ${f}2.7
			ln -s ${f}2.7 %i/bin/${f}
		done
	popd
	ln -s python2.7.1 %i/share/man/man1/python.1
	ln -s python2.7.1 %i/share/man/man1/python27.1

	# install some docs and other useful tidbits
	rm -rf Misc/RPM
	/bin/cp -R Misc Tools %i/lib/python2.7
	mkdir -p %i/share/doc/%n
	/bin/cp -R Demo Doc %i/share/doc/%n
	mkdir -p %i/share/doc/%n/html
	/bin/cp -R ../python-%v-docs-html/ %i/share/doc/%n/html
<<
SplitOff: <<
 Package: %N-shlibs
 Files: lib/python2.7/config/libpython2.7.dylib
 Shlibs: %p/lib/python2.7/config/libpython2.7.dylib 2.7.0 %n (>= 1:2.7-1)
 DocFiles: README LICENSE 
<<
SplitOff2: <<
 Package: python
 Depends: %N (>= %e:%v-%r)
 Conflicts: python-nox
 Replaces: python-nox, python25 (<< 1:2.5.1-3)
 Files: <<
		bin/2to3
		bin/idle
		bin/pydoc
		bin/python
		bin/python-config
		bin/smtpd.py
		lib/pkgconfig/python.pc
		share/man/man1/python.1
	<<
 DocFiles: README LICENSE
 Description: Generic "python" command that invokes python27
<<
DocFiles: README LICENSE 
Description: Interpreted, object-oriented language
DescDetail: <<
 Python is often compared to Tcl, Perl, Scheme or Java. 
 This package installs unix python - not the OSX Framework version.
 Builds a two-level namespace dynamic libpython (needed for koffice).

 The interpretter is installed as "python2.7", and all associated
 commands are similarly named with the python-version in them. To get
 the simple "python" command, install the fink package "python" (note:
 the "python" command there is not guaranteed to be python2.7!).
<<
DescUsage: <<
	python2.7 changes the compiler options used to compile
	third-party python modules. Please do not add 2.7 variants
	to them without actually testing that they build cleanly.
<<

DescPackaging: <<
	Patch a lot of things to impliment shared-lib support for
	non-Framework build on Darwin.

	Static libpython is installed in lib/pythonX.X/config/ but
	shared goes in %p/lib by default. Fink's packaging has always
	placed manually-built shared lib in config/ along side static,
	This gives consistency regardless of -search_paths_first.
	Continue this practice so that -pyXX varianted packages don't
	need special-casing for certain variants.

	Make sure all compiled modules link against libpython2.7 (and
	propagate this to third-party compiled modules) to ensure that
	all symbols resolved at compile-time to avoid packager
	mistakes and user runtime surprises.

	Should use --with-pth (fink's pth package)?

	Play lots of games to make sure we get expected support
	libraries. Also make sure -L/sw/lib/system-openssl is passed
	before -L/sw (build system seems to confuse standard meanings
	and uses of CFLAGS vs CPPFLAGS vs LDFLAGS) but avoid
	propagating into modules that compile using distutils.

	Adjust "python" unversioned link to be a symlink not a hard link.

	Must remain Epoch'ed so that this "python" pkg to be newer
	than the one from lower %v pkgs.

	Shared lib is buried next to static one instead of being in
	%p/lib because that's where it's always been in the fink
	package series. Why would they be in different places? Patch
	-config script to continue this tradition (bug in previous
	versions accidentally did the Right Thing here).
<<
DescPort: <<
	Import apple's patch to fix 10.6 getgroups implementaion.
	http://www.opensource.apple.com/source/python/python-44/2.6/fix/posixmodule.c.ed
	Not broken on 10.[45] so not bothering to see if can be
	backported to give unified %n pkg.

	Patch setup.py to find ncursesw headers and drop libncurses5 dep.

	platform.mac_ver fails on 64bit (returns blanks) because it
	requires uses the MacOS module when reading gestalt and MacOS
	is not available on 64bit. Add fallback implementation using
	posix.uname.
<<
License: OSI-Approved
Homepage: http://www.python.org
