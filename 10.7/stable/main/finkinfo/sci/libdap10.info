Package: libdap10
Version: 3.9.3
Revision: 3
BuildDependsOnly: true
GCC: 4.0
Description: DAP 3.9.3 C++ SDK
License: LGPL
Maintainer: Alexander Hansen <alexkhansen@users.sourceforge.net>
Depends: %N-shlibs (= %v-%r), pkgconfig
BuildDepends: libcurl4 (>= 7.19.3-2), libxml2, libiconv-dev, fink-package-precedence, fink (>=0.24.12)
Conflicts: aplus-fsf-dev, libdap9
Replaces: aplus-fsf-dev, libdap9

# Unpack Phase:
Source: http://www.opendap.org/pub/source/libdap-%v.tar.gz
Source-MD5: 597bf7aeb023186c65e1be4da868e75b

# Patch Phase:
PatchFile: %n.patch
PatchFile-MD5: 479e22eb4a63eec9235a3b1feab4cc36
PatchScript:  sed -e 's,@FINKPREFIX@,%p', -e 's,@DAPVERS@,10,' %{PatchFile} | patch -p1 

# Compile Phase
SetLDFLAGS: -Wl,-dead_strip_dylibs
ConfigureParams:  --libdir=%p/opt/%N/lib --includedir=%p/opt/%N/include
CompileScript: <<
 #!/bin/sh -ev
 ./configure %c
 # for some reason, the allow_undefined_flag doesn't get set right by configure.
 perl -pi.BAK -e 's|-single_module |-single_module -undefined dynamic_lookup |' libtool
 make
 fink-package-precedence .
<<

# Install Phase:
DocFiles: COPYING COPYRIGHT_* README README.* NEWS
InstallScript: <<
	make -j1 install DESTDIR=%d
<<

SplitOff: <<
	Package: %N-shlibs
	Files: opt/%N/lib/libdap*.*.dylib
	Depends: libcurl4-shlibs (>= 7.19.3-2), libxml2-shlibs
	Shlibs: <<
	%p/opt/%N/lib/libdap.10.dylib 11.0.0 %n (>= 3.9.3-1)
	%p/opt/%N/lib/libdapclient.3.dylib 4.0.0 %n (>= 3.9.3-1)
	%p/opt/%N/lib/libdapserver.7.dylib 8.0.0 %n (>= 3.9.3-1)
	<<
	DocFiles: COPYING COPYRIGHT_* README README.* NEWS
<<

DescDetail: <<
	A C++ SDK which contains an implementation of DAP 2.0,
	Client- and Server-side support classes and a prototype
	implementation of the AIS.
<<
DescPackaging: <<
	Patch dap-config.in and dap-config-pkgconfig so that they actually point
	dependent packages to the actual include directory and lib directory, and
	.pc file, respectively.

	Needed by the last version of libnc-dap3.  libdap >= 3.10 breaks API (but 
	kept the libversion) and libnc-dap3 won't build against it any more.  Any
	libdap package based on the current upstream 3.10.x series will have to 
	have a new libversion.
<<
Homepage:  http://www.opendap.org/libdap
