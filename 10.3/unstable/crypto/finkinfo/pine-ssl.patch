--- pine/pine/osdep/os-osx.h.orig	Wed Nov 21 13:28:51 2001
+++ pine/pine/osdep/os-osx.h	Wed Nov 21 13:30:51 2001
@@ -178,10 +178,10 @@
 
 /*----- System-wide config file ----------------------------------------*/
 #ifndef SYSTEM_PINERC
-#define SYSTEM_PINERC             "/usr/local/lib/pine.conf"
+#define SYSTEM_PINERC             "@PREFIX@/lib/pine.conf"
 #endif
 #ifndef SYSTEM_PINERC_FIXED
-#define SYSTEM_PINERC_FIXED       "/usr/local/lib/pine.conf.fixed"
+#define SYSTEM_PINERC_FIXED       "@PREFIX@/lib/pine.conf.fixed"
 #endif
 
 
--- pine/pine-ssl.csh	Thu May  9 05:55:35 2002
+++ pine/pine-ssl.csh	Thu May  9 05:50:37 2002
@@ -0,0 +1,3 @@
+# pine-ssl.csh
+
+setenv  PINECONF   @PREFIX@/etc/pine.conf
--- pine/pine-ssl.sh	Thu May  9 05:55:35 2002
+++ pine/pine-ssl.sh	Thu May  9 05:50:37 2002
@@ -0,0 +1,4 @@
+# pine-ssl.sh
+
+PINECONF=@PREFIX@/etc/pine.conf
+export PINECONF
diff -Naur pine4.53-orig/contrib/krb5-setup pine4.53/contrib/krb5-setup
--- pine4.53-orig/contrib/krb5-setup	Fri Feb  4 12:06:29 2000
+++ pine4.53/contrib/krb5-setup	Tue Nov 26 11:03:40 2002
@@ -74,11 +74,11 @@
 
 
 # This is where c-client expects the libraries to be.
-if [ \( -f krb5/lib/libgssapi_krb5.a -o -f krb5/lib/libgssapi_krb5.so \) -a \
-     \( -f krb5/lib/libkrb5.a        -o -f krb5/lib/libkrb5.so \)        -a \
+if [ \( -f krb5/lib/libgssapi_krb5.a -o -f krb5/lib/libgssapi_krb5.dylib \) -a \
+     \( -f krb5/lib/libkrb5.a        -o -f krb5/lib/libkrb5.dylib \)        -a \
      \( -f krb5/lib/libcrypto.a      -o -f krb5/lib/libk5crypto.a    -o \
-        -f krb5/lib/libcrypto.so     -o -f krb5/lib/libk5crypto.so \)    -a \
-     \( -f krb5/lib/libcom_err.a     -o -f krb5/lib/libcom_err.so \) ]
+        -f krb5/lib/libcrypto.dylib     -o -f krb5/lib/libk5crypto.dylib \)    -a \
+     \( -f krb5/lib/libcom_err.a     -o -f krb5/lib/libcom_err.dylib \) ]
 then
     exit 0
 fi
diff -rc pine4.60/pine/mailcmd.c pine4.60.altrolebug/pine/mailcmd.c
*** pine4.60/pine/mailcmd.c	Thu May  6 10:47:21 2004
--- pine4.60.altrolebug/pine/mailcmd.c	Tue May 25 09:38:02 2004
***************
*** 2898,2904 ****
  {
      int action;
  
!     if(F_ON(F_ALT_ROLE_MENU, state)){
  	PAT_STATE  pstate;
  
  	if(nonempty_patterns(ROLE_DO_ROLES, &pstate) && first_pattern(&pstate)){
--- 2898,2905 ----
  {
      int action;
  
!     if(state->mail_stream && state->mail_stream->nmsgs > 0
! 	&& F_ON(F_ALT_ROLE_MENU, state)){
  	PAT_STATE  pstate;
  
  	if(nonempty_patterns(ROLE_DO_ROLES, &pstate) && first_pattern(&pstate)){
diff -rc pine4.60/pine/strings.c pine4.60.blank/pine/strings.c
*** pine4.60/pine/strings.c	Thu May  6 10:47:29 2004
--- pine4.60.blank/pine/strings.c	Mon May 10 18:49:19 2004
***************
*** 1831,1837 ****
  	if(*p == '\\' && *(p+1) == '"')		/* escaped quote? */
  	  p++;					/* skip it... */
  
! 	if(isspace((unsigned char)*p) && !quoted){	/* if space,  */
  	    while(*++p && isspace((unsigned char)*p))	/* move past it */
  	      ;
  
--- 1831,1837 ----
  	if(*p == '\\' && *(p+1) == '"')		/* escaped quote? */
  	  p++;					/* skip it... */
  
! 	if(!token && isspace((unsigned char)*p) && !quoted){	/* if space,  */
  	    while(*++p && isspace((unsigned char)*p))	/* move past it */
  	      ;
  
diff -rc pine4.60/pine/folder.c pine4.60.lessbug/pine/folder.c
*** pine4.60/pine/folder.c	Wed Apr 21 16:36:58 2004
--- pine4.60.lessbug/pine/folder.c	Tue May 11 08:24:50 2004
***************
*** 442,448 ****
  static struct key folder_keys[] =
         {HELP_MENU,
    	OTHER_MENU,
! 	{"<", NULL, {MC_EXIT,2,{'<',','}}, KS_NONE},
          {">", NULL, {MC_CHOICE,2,{'>','.'}}, KS_NONE},
  	PREVF_MENU,
  	NEXTF_MENU,
--- 442,448 ----
  static struct key folder_keys[] =
         {HELP_MENU,
    	OTHER_MENU,
! 	{"<", NULL, {MC_EXIT,3,{0,'<',','}}, KS_NONE},
          {">", NULL, {MC_CHOICE,2,{'>','.'}}, KS_NONE},
  	PREVF_MENU,
  	NEXTF_MENU,
diff -rc pine4.60/pine/mailindx.c pine4.60.muttlikebug/pine/mailindx.c
*** pine4.60/pine/mailindx.c	Thu May  6 10:47:23 2004
--- pine4.60.muttlikebug/pine/mailindx.c	Wed May 26 22:45:14 2004
***************
*** 3795,3802 ****
  		     * that the alloc below is too big, so we just
  		     * don't care.
  		     */
! 		    if(thrd = fetch_thread(stream, rawno))
! 		      count += mark_msgs_in_thread(stream, thrd, msgmap);
  		    else if(rawno > 0L && rawno <= stream->nmsgs
  			    && (mc = mail_elt(stream,rawno))
  			    && !mc->private.msg.env){
--- 3795,3807 ----
  		     * that the alloc below is too big, so we just
  		     * don't care.
  		     */
! 		    if(thrd = fetch_thread(stream, rawno)){
! 		      PINETHRD_S   *topthrd;
! 		      topthrd =  ps_global->thread_disp_style == THREAD_MUTTLIKE
! 			      ? fetch_thread(stream, thrd->top)
! 			      : thrd;
! 		      count += mark_msgs_in_thread(stream, topthrd, msgmap);
! 		    }
  		    else if(rawno > 0L && rawno <= stream->nmsgs
  			    && (mc = mail_elt(stream,rawno))
  			    && !mc->private.msg.env){
***************
*** 6695,6701 ****
  			    env = pine_mail_fetchenvelope(idata->stream,
  							  thd->rawno);
  			    stripthis = (env && env->subject)
! 						    ? env->subject : "";
  
  			    mail_strip_subject(stripthis, &prev_orig);
  			    
--- 6700,6709 ----
  			    env = pine_mail_fetchenvelope(idata->stream,
  							  thd->rawno);
  			    stripthis = (env && env->subject)
! 					 ? env->subject 
! 					 : (idata && !idata->bogus
! 					    && idata->subject
! 					    ? idata->subject : "");
  
  			    mail_strip_subject(stripthis, &prev_orig);
  			    
diff -rc pine4.60/pine/folder.c pine4.60.resizebug/pine/folder.c
*** pine4.60/pine/folder.c	Wed Apr 21 16:36:58 2004
--- pine4.60.resizebug/pine/folder.c	Tue May 18 13:10:10 2004
***************
*** 1764,1770 ****
  
  		    fp = folder_entry(sargs.text.handles->h.f.index,
  				    FOLDERS(sargs.text.handles->h.f.context));
! 		    if(strlen(fp->name) < MAXFOLDER -1)
  		      strcpy(fs->first_folder, fp->name);
  
  		    fs->context = sargs.text.handles->h.f.context;
--- 1764,1770 ----
  
  		    fp = folder_entry(sargs.text.handles->h.f.index,
  				    FOLDERS(sargs.text.handles->h.f.context));
! 		    if(fp && strlen(fp->name) < MAXFOLDER -1)
  		      strcpy(fs->first_folder, fp->name);
  
  		    fs->context = sargs.text.handles->h.f.context;
diff -rc pine4.60/imap/src/osdep/unix/tcp_unix.c pine4.60.tcpopenbug/imap/src/osdep/unix/tcp_unix.c
*** pine4.60/imap/src/osdep/unix/tcp_unix.c	Mon Mar 15 10:33:26 2004
--- pine4.60.tcpopenbug/imap/src/osdep/unix/tcp_unix.c	Tue May 11 12:33:26 2004
***************
*** 144,150 ****
    size_t adrlen;
    struct servent *sv = NIL;
    blocknotify_t bn = (blocknotify_t) mail_parameters (NIL,GET_BLOCKNOTIFY,NIL);
!   void *data,*next;
    port &= 0xffff;		/* erase flags */
  				/* lookup service */
    if (service && (sv = getservbyname (service,"tcp")))
--- 144,150 ----
    size_t adrlen;
    struct servent *sv = NIL;
    blocknotify_t bn = (blocknotify_t) mail_parameters (NIL,GET_BLOCKNOTIFY,NIL);
!   void *data,*next = NIL;
    port &= 0xffff;		/* erase flags */
  				/* lookup service */
    if (service && (sv = getservbyname (service,"tcp")))
diff -rc pine4.60/imap/src/c-client/imap4r1.c pine4.60.unverified/imap/src/c-client/imap4r1.c
*** pine4.60/imap/src/c-client/imap4r1.c	Tue May  4 18:37:11 2004
--- pine4.60.unverified/imap/src/c-client/imap4r1.c	Mon May 10 18:49:21 2004
***************
*** 4376,4381 ****
--- 4376,4382 ----
    if (*env) {			/* need to merge this header into envelope? */
      if (!(*env)->newsgroups) {	/* need Newsgroups? */
        (*env)->newsgroups = nenv->newsgroups;
+       (*env)->ngbogus = nenv->ngbogus;
        nenv->newsgroups = NIL;
      }
      if (!(*env)->followup_to) {	/* need Followup-To? */
***************
*** 4430,4435 ****
--- 4431,4437 ----
      if (oenv) {			/* need to merge old envelope? */
        (*env)->newsgroups = oenv->newsgroups;
        oenv->newsgroups = NIL;
+       (*env)->ngbogus = oenv->ngbogus;
        (*env)->followup_to = oenv->followup_to;
        oenv->followup_to = NIL;
        (*env)->references = oenv->references;
diff -rc pine4.60/imap/src/c-client/mail.h pine4.60.unverified/imap/src/c-client/mail.h
*** pine4.60/imap/src/c-client/mail.h	Tue May  4 12:09:45 2004
--- pine4.60.unverified/imap/src/c-client/mail.h	Mon May 10 18:49:21 2004
***************
*** 612,617 ****
--- 612,618 ----
  /* Message envelope */
  
  typedef struct mail_envelope {
+   unsigned int ngbogus : 1;	/* newsgroups may be bogus */
    unsigned int incomplete : 1;	/* envelope may be incomplete */
    unsigned int imapenvonly : 1;	/* envelope only has IMAP envelope */
    char *remail;			/* remail header if any */
diff -rc pine4.60/imap/src/c-client/rfc822.c pine4.60.unverified/imap/src/c-client/rfc822.c
*** pine4.60/imap/src/c-client/rfc822.c	Tue Apr 27 17:21:48 2004
--- pine4.60.unverified/imap/src/c-client/rfc822.c	Mon May 10 18:49:21 2004
***************
*** 374,379 ****
--- 374,380 ----
    ENVELOPE *env = (*en = mail_newenvelope ());
    BODY *body = bdy ? (*bdy = mail_newbody ()) : NIL;
    long MIMEp = -1;		/* flag that MIME semantics are in effect */
+   long PathP = NIL;             /* flag that a Path: was seen */
    parseline_t pl = (parseline_t) mail_parameters (NIL,GET_PARSELINE,NIL);
    if (!host) host = BADHOST;	/* make sure that host is non-null */
    while (i && *s != '\n') {	/* until end of header */
***************
*** 463,468 ****
--- 464,472 ----
  	  *t++ = '\0';
  	}
  	break;
+       case 'P':                 /* possible Path: */
+ 	if (!strcmp (tmp+1,"ATH")) PathP = T;
+ 	break;
        case 'R':			/* possible Reply-To: */
  	if (!strcmp (tmp+1,"EPLY-TO"))
  	  rfc822_parse_adrlist (&env->reply_to,d,host);
***************
*** 483,488 ****
--- 487,498 ----
        }
      }
    }
+   if (env->newsgroups && !PathP && env->message_id &&
+        strncmp (env->message_id,"<Pine.",6) &&
+        strncmp (env->message_id,"<MS-C.",6) &&
+        strncmp (env->message_id,"<MailManager.",13) &&
+        strncmp (env->message_id,"<EasyMail.",11) &&
+        strncmp (env->message_id,"<ML-",4)) env->ngbogus = T;
    fs_give ((void **) &tmp);	/* done with scratch buffer */
  				/* default Sender: and Reply-To: to From: */
    if (!env->sender) env->sender = rfc822_cpy_adr (env->from);
diff -rc pine4.60/pine/mailview.c pine4.60.unverified/pine/mailview.c
*** pine4.60/pine/mailview.c	Thu May  6 10:47:25 2004
--- pine4.60.unverified/pine/mailview.c	Mon May 10 18:49:21 2004
***************
*** 5858,5865 ****
        format_addr_string(s, n, sect, "Return-Path: ", e->return_path,
  			 flags, pc);
  
!     if((which & FE_NEWSGROUPS) && e->newsgroups)
        format_newsgroup_string("Newsgroups: ", e->newsgroups, flags, pc);
  
      if((which & FE_FOLLOWUPTO) && e->followup_to)
        format_newsgroup_string("Followup-To: ", e->followup_to, flags, pc);
--- 5858,5869 ----
        format_addr_string(s, n, sect, "Return-Path: ", e->return_path,
  			 flags, pc);
  
!     if((which & FE_NEWSGROUPS) && e->newsgroups){
        format_newsgroup_string("Newsgroups: ", e->newsgroups, flags, pc);
+ 	if(e->ngbogus)
+ 	  q_status_message(SM_ORDER, 0, 3,
+      "Unverified Newsgroup header -- Message MAY or MAY NOT have been posted");
+     }
  
      if((which & FE_FOLLOWUPTO) && e->followup_to)
        format_newsgroup_string("Followup-To: ", e->followup_to, flags, pc);
diff -rc pine4.60/pine/reply.c pine4.60.unverified/pine/reply.c
*** pine4.60/pine/reply.c	Thu May  6 10:47:26 2004
--- pine4.60.unverified/pine/reply.c	Mon May 10 18:49:22 2004
***************
*** 2952,2960 ****
  	}
  	else if(!outgoing->newsgroups)
  	  outgoing->newsgroups = cpystr(env->newsgroups);
- 	if(!IS_NEWS(ps_global->mail_stream))
- 	  q_status_message(SM_ORDER, 2, 3,
-  "Replying to message that MAY or MAY NOT have been posted to newsgroup");
      }
  
      return(ret);
--- 2952,2957 ----
