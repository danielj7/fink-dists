diff -ruN ruby-1.6.6/config.cache ruby-1.6.5-patched/config.cache
--- ruby-1.6.6/config.cache	Thu Jan  1 01:00:00 1970
+++ ruby-1.6.6-patched/config.cache	Fri Apr 27 15:44:26 2001
@@ -0,0 +1,2 @@
+ac_cv_func_dlopen=${ac_cv_func_dlopen=no}
+ac_cv_lib_dl_dlopen=${ac_cv_lib_dl_dlopen=no}
--- ruby-1.6.6/ext/extmk.rb.in	Fri Jul 27 01:52:19 2001
+++ ruby-1.6.6/ext/extmk.rb.in	Wed Jan 23 02:13:38 2002
@@ -26,6 +26,7 @@
 $extlist = []
 
-$includedir = "@includedir@".gsub(/\$\{prefix\}|\$\(prefix\)/,'@prefix@')
+$includedir = "@PREFIX@/include"
+$libdir = "@PREFIX@/lib"
 
 $top_srcdir = "@top_srcdir@"
 if $top_srcdir !~ "^/"
@@ -68,8 +69,8 @@
 else
   CFLAGS = "@CFLAGS@"
 end
-LINK = "@CC@ -o conftest -I#$topdir -I#$top_srcdir #{CFLAGS} -I#$includedir @LDFLAGS@ %s %s %s conftest.c %s %s @LIBS@"
-CPP = "@CPP@ @CPPFLAGS@ -I#$topdir -I#$top_srcdir #{CFLAGS} -I#$includedir %s %s %s conftest.c"
+LINK = "@CC@ -o conftest -I#$topdir -I#$top_srcdir #{CFLAGS} -I#$includedir -L#$libdir @LDFLAGS@ %s %s %s conftest.c %s %s @LIBS@"
+CPP = "@CPP@ @CPPFLAGS@ -I#$topdir -I#$top_srcdir #{CFLAGS} -I#$includedir -L#$libdir %s %s %s conftest.c"
 
 $log = open('extmk.log', 'w')
 
@@ -442,7 +443,7 @@
 
 "
   mfile.printf "LOCAL_LIBS = %s %s\n", $LOCAL_LIBS, $local_flags
-  mfile.printf "LIBS = %s\n", $libs
+  mfile.printf "LIBS = -L%s %s\n", $libdir, $libs
   mfile.printf "OBJS = "
   if !$objs then
     $objs = []
--- ruby-1.6.6/configure.orig	Thu Jan 24 10:24:31 2002
+++ ruby-1.6.6/configure	Thu Jan 24 10:25:03 2002
@@ -5262,7 +5262,7 @@
     darwin*)
 	LIBRUBY_SO='lib$(RUBY_INSTALL_NAME).$(MAJOR).$(MINOR).$(TEENY).dylib'
 	LIBRUBY_LDSHARED='cc -dynamiclib -undefined suppress -flat_namespace'
-	LIBRUBY_DLDFLAGS='-install_name lib$(RUBY_INSTALL_NAME).dylib -current_version $(MAJOR).$(MINOR).$(TEENY) -compatibility_version $(MAJOR).$(MINOR)'
+	LIBRUBY_DLDFLAGS='-install_name ${prefix}/lib/lib$(RUBY_INSTALL_NAME).dylib -current_version $(MAJOR).$(MINOR).$(TEENY) -compatibility_version $(MAJOR).$(MINOR)'
 	LIBRUBY_ALIASES='lib$(RUBY_INSTALL_NAME).$(MAJOR).$(MINOR).dylib lib$(RUBY_INSTALL_NAME).dylib'
 	;;
     *)
--- ruby-1.6.6/ext/tcltklib/extconf.rb.orig	Thu Jan 24 12:30:28 2002
+++ ruby-1.6.6/ext/tcltklib/extconf.rb	Thu Jan 24 12:31:27 2002
@@ -11,14 +11,14 @@
 
 dir_config("tk")
 dir_config("tcl")
-dir_config("X11")
+dir_config("X11", "/usr/X11R6/include", "/usr/X11R6/lib")
 
 tklib = with_config("tklib")
 tcllib = with_config("tcllib")
 stubs = enable_config("tcltk_stubs") || with_config("tcltk_stubs")
 
 def find_tcl(tcllib, stubs)
-  paths = ["/usr/local/lib", "/usr/pkg", "/usr/lib"]
+  paths = ["@PREFIX@/lib", "/usr/local/lib", "/usr/pkg", "/usr/lib"]
   func = stubs ? "Tcl_InitStubs" : "Tcl_FindExecutable"
   if tcllib
     find_library(tcllib, func, *paths)
@@ -40,7 +40,7 @@
 end
 
 def find_tk(tklib, stubs)
-  paths = ["/usr/local/lib", "/usr/pkg", "/usr/lib"]
+  paths = ["@PREFIX@/lib", "/usr/local/lib", "/usr/pkg", "/usr/lib"]
   func = stubs ? "Tk_InitStubs" : "Tk_Init"
   if tklib
     find_library(tklib, func, *paths)
--- ruby-1.6.6/error.c.old	2002-08-04 15:55:46.000000000 -0700
+++ ruby-1.6.6/error.c	2002-08-04 15:56:36.000000000 -0700
@@ -468,7 +468,7 @@
 static VALUE *syserr_list;
 #endif
 
-#if !defined(NT) && !defined(__FreeBSD__) && !defined(__NetBSD__) && !defined(__OpenBSD__) && !defined(sys_nerr)
+#if !defined(NT) && !defined(__APPLE__) && !defined(__FreeBSD__) && !defined(__NetBSD__) && !defined(__OpenBSD__) && !defined(sys_nerr)
 extern int sys_nerr;
 #endif
 
