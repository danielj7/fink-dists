diff -Nurd -x'*~' metacity-2.24.0.orig/configure.in metacity-2.24.0/configure.in
--- metacity-2.24.0.orig/configure.in	2008-09-22 14:31:19.000000000 -0400
+++ metacity-2.24.0/configure.in	2008-11-26 01:18:56.000000000 -0500
@@ -211,17 +211,8 @@
 have_xrender=no
 
 XCOMPOSITE_VERSION=0.2
-AC_MSG_CHECKING([Xcomposite >= $XCOMPOSITE_VERSION])
-if $PKG_CONFIG --atleast-version $XCOMPOSITE_VERSION xcomposite; then
-   have_xcomposite=yes
-else
-   have_xcomposite=no
-fi
-AC_MSG_RESULT($have_xcomposite)
-
 if test x$enable_compositor = xyes; then
    have_xcomposite=yes
-   echo "CompositeExt support forced on"
 elif test x$enable_compositor = xauto; then
    echo "Building compositing manager by default now."
    have_xcomposite=yes
@@ -230,15 +221,25 @@
 fi
 
 if test x$have_xcomposite = xyes; then
-  echo "Building with CompositeExt"
+   AC_MSG_CHECKING([Xcomposite >= $XCOMPOSITE_VERSION])
+   if $PKG_CONFIG --atleast-version $XCOMPOSITE_VERSION xcomposite; then
+      AC_MSG_RESULT([yes])
+   else
+      AC_MSG_ERROR([no. Use --disable-compositor to disable.])
+   fi
+fi
+
+if test x$have_xcomposite = xyes; then
   METACITY_PC_MODULES="$METACITY_PC_MODULES xcomposite >= $XCOMPOSITE_VERSION xfixes xrender xdamage"
   AC_DEFINE(HAVE_COMPOSITE_EXTENSIONS, , [Building with compositing manager support])
+  echo "Building with compositing manager"
 
   ## force on render also
   have_xrender=yes
 else
   echo "Building without compositing manager"
 fi
+AM_CONDITIONAL([USE_COMPOSITOR_EXTENSIONS], [test x$have_xcomposite != xno])
 
 ## if no compositor, still possibly enable render
 if test x$have_xcomposite = xno; then
diff -Nurd -x'*~' metacity-2.24.0.orig/src/Makefile.am metacity-2.24.0/src/Makefile.am
--- metacity-2.24.0.orig/src/Makefile.am	2008-09-09 10:31:35.000000000 -0400
+++ metacity-2.24.0/src/Makefile.am	2008-11-26 01:17:11.000000000 -0500
@@ -2,7 +2,15 @@
 
 SUBDIRS=wm-tester tools themes
 
-INCLUDES=@METACITY_CFLAGS@ -I $(srcdir)/include -DMETACITY_LIBEXECDIR=\"$(libexecdir)\" -DHOST_ALIAS=\"@HOST_ALIAS@\" -DMETACITY_LOCALEDIR=\"$(prefix)/@DATADIRNAME@/locale\" -DMETACITY_PKGDATADIR=\"$(pkgdatadir)\" -DMETACITY_DATADIR=\"$(datadir)\" -DG_LOG_DOMAIN=\"metacity\" -DSN_API_NOT_YET_FROZEN=1
+INCLUDES=-I$(srcdir)/include -DMETACITY_LIBEXECDIR=\"$(libexecdir)\" -DHOST_ALIAS=\"@HOST_ALIAS@\" -DMETACITY_LOCALEDIR=\"$(prefix)/@DATADIRNAME@/locale\" -DMETACITY_PKGDATADIR=\"$(pkgdatadir)\" -DMETACITY_DATADIR=\"$(datadir)\" -DG_LOG_DOMAIN=\"metacity\" -DSN_API_NOT_YET_FROZEN=1 @METACITY_CFLAGS@
+
+if USE_COMPOSITOR_EXTENSIONS
+compositor_ext_sources = \
+	compositor/compositor-xrender.c		\
+	compositor/compositor-xrender.h
+else
+compositor_ext_sources =
+endif
 
 metacity_SOURCES= 				\
 	core/async-getprop.c			\
@@ -14,8 +22,7 @@
 	include/boxes.h				\
 	compositor/compositor.c			\
 	compositor/compositor-private.h		\
-	compositor/compositor-xrender.c		\
-	compositor/compositor-xrender.h		\
+	$(compositor_ext_sources)		\
 	include/compositor.h			\
 	core/constraints.c			\
 	core/constraints.h			\
diff -Nurd -x'*~' metacity-2.24.0.orig/src/core/util.c metacity-2.24.0/src/core/util.c
--- metacity-2.24.0.orig/src/core/util.c	2008-08-18 08:29:06.000000000 -0400
+++ metacity-2.24.0/src/core/util.c	2008-11-26 01:13:19.000000000 -0500
@@ -23,7 +23,7 @@
  */
 
 #define _GNU_SOURCE
-#define _POSIX_C_SOURCE /* for fdopen() */
+#define _POSIX_C_SOURCE 200112L /* for fdopen() */
 
 #include <config.h>
 #include "util.h"
