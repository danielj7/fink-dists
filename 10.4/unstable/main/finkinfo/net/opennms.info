Package: opennms
Version: 1.5.97
Revision: 1

Source: mirror:sourceforge:%n/%n-source-%v-1.tar.gz
Source-MD5: 738ab4d93b0d306eeea00c8430862e70
SourceDirectory: %n-%v-1/source
Source2: mirror:sourceforge:%n/%n-maven-dependencies-%v-1.tar.bz2
Source2-MD5: 44a3f1c5515fcb939d957197bcd9e21d

Distribution: 10.4, 10.5
Recommends: mib2opennms
PatchScript: <<
	sed -e 's,@FINKPREFIX@,%p,g' %a/%n.patch | patch -p2
	sed -e 's,@PREFIX@,%p,g' tools/packages/fink/README.Darwin > README.Darwin
<<

Type: java(1.5)
BuildDepends: <<
	maven (>= 2.0.6-1),
	passwd (>= 20030202-1)
<<
Depends: <<
	daemonic,
	jicmp,
	opennms-pgsql,
	passwd (>= 20030202-1),
	postgresql-server,
	rrdtool (>= 1.2.0-1),
	rrdtool-java
<<
ConfFiles: <<
	%p/var/opennms/etc/AvailabilityReports.xsl
	%p/var/opennms/etc/PDFAvailReport.xsl
	%p/var/opennms/etc/SVGAvailReport.xsl
	%p/var/opennms/etc/actiond-configuration.xml
	%p/var/opennms/etc/c3p0.properties
	%p/var/opennms/etc/capsd-configuration.xml
	%p/var/opennms/etc/categories.xml
	%p/var/opennms/etc/chart-configuration.xml
	%p/var/opennms/etc/collectd-configuration.xml
	%p/var/opennms/etc/create.sql
	%p/var/opennms/etc/database-schema.xml
	%p/var/opennms/etc/datacollection-config.xml
	%p/var/opennms/etc/destinationPaths.xml
	%p/var/opennms/etc/dhcpd-configuration.xml
	%p/var/opennms/etc/discovery-configuration.xml
	%p/var/opennms/etc/eventconf.xml
	%p/var/opennms/etc/eventd-configuration.xml
	%p/var/opennms/etc/events-archiver-configuration.xml
	%p/var/opennms/etc/events.archiver.properties
	%p/var/opennms/etc/events/3Com.events.xml
	%p/var/opennms/etc/events/ADIC-v2.events.xml
	%p/var/opennms/etc/events/APC.Best.events.xml
	%p/var/opennms/etc/events/APC.Exide.events.xml
	%p/var/opennms/etc/events/APC.events.xml
	%p/var/opennms/etc/events/AdaptecRaid.events.xml
	%p/var/opennms/etc/events/Adtran.Atlas.events.xml
	%p/var/opennms/etc/events/Adtran.events.xml
	%p/var/opennms/etc/events/Aedilis.events.xml
	%p/var/opennms/etc/events/AirDefense.events.xml
	%p/var/opennms/etc/events/Alteon.events.xml
	%p/var/opennms/etc/events/Altiga.events.xml
	%p/var/opennms/etc/events/Audiocodes.events.xml
	%p/var/opennms/etc/events/BEA.events.xml
	%p/var/opennms/etc/events/BGP4.events.xml
	%p/var/opennms/etc/events/BackupExec.events.xml
	%p/var/opennms/etc/events/BlackBerryServer.events.xml
	%p/var/opennms/etc/events/Brocade.events.xml
	%p/var/opennms/etc/events/CA.ArcServe.events.xml
	%p/var/opennms/etc/events/CPQHPIM.README.txt
	%p/var/opennms/etc/events/CPQHPIM.events.xml
	%p/var/opennms/etc/events/Cisco.5300dchan.events.xml
	%p/var/opennms/etc/events/Cisco.airespace.xml
	%p/var/opennms/etc/events/Cisco.events.xml
	%p/var/opennms/etc/events/Cisco2.events.xml
	%p/var/opennms/etc/events/Clarent.events.xml
	%p/var/opennms/etc/events/Clarinet.events.xml
	%p/var/opennms/etc/events/Colubris.events.xml
	%p/var/opennms/etc/events/Covergence.events.xml
	%p/var/opennms/etc/events/Cricket.events.xml
	%p/var/opennms/etc/events/Crossbeam.events.xml
	%p/var/opennms/etc/events/DPS.events.xml
	%p/var/opennms/etc/events/Dell-DRAC2.events.xml
	%p/var/opennms/etc/events/Dell.events.xml
	%p/var/opennms/etc/events/DellArrayManager.events.xml
	%p/var/opennms/etc/events/DellOpenManage.events.xml
	%p/var/opennms/etc/events/DellRacHost.events.xml
	%p/var/opennms/etc/events/DellStorageManagement.events.xml
	%p/var/opennms/etc/events/F5.events.xml
	%p/var/opennms/etc/events/Fore.events.xml
	%p/var/opennms/etc/events/FoundryNetworks.events.xml
	%p/var/opennms/etc/events/FujitsuSiemens.events.xml
	%p/var/opennms/etc/events/Groupwise.events.xml
	%p/var/opennms/etc/events/HP.events.xml
	%p/var/opennms/etc/events/Hyperic.events.xml
	%p/var/opennms/etc/events/IBM-UMS.events.xml
	%p/var/opennms/etc/events/IBM.events.xml
	%p/var/opennms/etc/events/IBMRSA2.events.xml
	%p/var/opennms/etc/events/IEEE802dot11.events.xml
	%p/var/opennms/etc/events/IPUnity-SES-MIB.events.xml
	%p/var/opennms/etc/events/ISS.events.xml
	%p/var/opennms/etc/events/Intel.events.xml
	%p/var/opennms/etc/events/IronPort.events.xml
	%p/var/opennms/etc/events/Juniper.events.xml
	%p/var/opennms/etc/events/K5Systems.events.xml
	%p/var/opennms/etc/events/Liebert.600SM.events.xml
	%p/var/opennms/etc/events/Liebert.events.xml
	%p/var/opennms/etc/events/Linksys.events.xml
	%p/var/opennms/etc/events/MGE-UPS.events.xml
	%p/var/opennms/etc/events/MRV.events.xml
	%p/var/opennms/etc/events/McAfee.events.xml
	%p/var/opennms/etc/events/Microsoft.events.xml
	%p/var/opennms/etc/events/Mylex.events.xml
	%p/var/opennms/etc/events/NORTEL.Contivity.events.xml
	%p/var/opennms/etc/events/NetApp.events.xml
	%p/var/opennms/etc/events/NetSNMP.events.xml
	%p/var/opennms/etc/events/Netbotz.events.xml
	%p/var/opennms/etc/events/Netgear.events.xml
	%p/var/opennms/etc/events/Netscalar.events.xml
	%p/var/opennms/etc/events/Netscreen.events.xml
	%p/var/opennms/etc/events/Nokia.events.xml
	%p/var/opennms/etc/events/Novell.events.xml
	%p/var/opennms/etc/events/OSPF.events.xml
	%p/var/opennms/etc/events/Oracle.events.xml
	%p/var/opennms/etc/events/Overland.events.xml
	%p/var/opennms/etc/events/Patrol.events.xml
	%p/var/opennms/etc/events/Pixelmetrix.events.xml
	%p/var/opennms/etc/events/Polycom.events.xml
	%p/var/opennms/etc/events/Primecluster.events.xml
	%p/var/opennms/etc/events/Quintum.events.xml
	%p/var/opennms/etc/events/RADLAN-MIB.events.xml
	%p/var/opennms/etc/events/RFC1628.events.xml
	%p/var/opennms/etc/events/Redline.events.xml
	%p/var/opennms/etc/events/Rightfax.events.xml
	%p/var/opennms/etc/events/Sensaphone.events.xml
	%p/var/opennms/etc/events/Snort.events.xml
	%p/var/opennms/etc/events/SonicWall.events.xml
	%p/var/opennms/etc/events/Sonus.events.xml
	%p/var/opennms/etc/events/Standard.events.xml
	%p/var/opennms/etc/events/Symbol.events.xml
	%p/var/opennms/etc/events/Syslogd.events.xml
	%p/var/opennms/etc/events/SystemEdge.events.xml
	%p/var/opennms/etc/events/TUT.events.xml
	%p/var/opennms/etc/events/TrippLite.events.xml
	%p/var/opennms/etc/events/UPS-MIB.events.xml
	%p/var/opennms/etc/events/Uptime.events.xml
	%p/var/opennms/etc/events/VMWare.events.xml
	%p/var/opennms/etc/events/Veraz.events.xml
	%p/var/opennms/etc/events/Waverider.3000.events.xml
	%p/var/opennms/etc/events/Xerox-V2.events.xml
	%p/var/opennms/etc/events/Xerox.events.xml
	%p/var/opennms/etc/events/default.events.xml
	%p/var/opennms/etc/events/ia.events.xml
	%p/var/opennms/etc/exclude-ueis.properties
	%p/var/opennms/etc/getManagePercentAvailIntfWindow.sql
	%p/var/opennms/etc/getManagePercentAvailNodeWindow.sql
	%p/var/opennms/etc/getManagedOutageForIntfInWindow.sql
	%p/var/opennms/etc/getManagedOutageForNodeInWindow.sql
	%p/var/opennms/etc/getManagedServiceCountForIntf.sql
	%p/var/opennms/etc/getManagedServiceCountForNode.sql
	%p/var/opennms/etc/getOutageTimeInWindow.sql
	%p/var/opennms/etc/getPercentAvailabilityInWindow.sql
	%p/var/opennms/etc/groups.xml
	%p/var/opennms/etc/http-datacollection-config.xml
	%p/var/opennms/etc/java.conf
	%p/var/opennms/etc/javamail-configuration.properties
	%p/var/opennms/etc/jcifs.properties
	%p/var/opennms/etc/jmx-datacollection-config.xml
	%p/var/opennms/etc/ksc-performance-reports.xml
	%p/var/opennms/etc/linkd-configuration.xml
	%p/var/opennms/etc/log4j-controller.properties
	%p/var/opennms/etc/log4j.properties
	%p/var/opennms/etc/magic-users.properties
	%p/var/opennms/etc/map.disable
	%p/var/opennms/etc/map.properties
	%p/var/opennms/etc/model-importer.properties
	%p/var/opennms/etc/monitoring-locations.xml
	%p/var/opennms/etc/notifd-configuration.xml
	%p/var/opennms/etc/notificationCommands.xml
	%p/var/opennms/etc/notifications.xml
	%p/var/opennms/etc/nsclient-config.xml
	%p/var/opennms/etc/nsclient-datacollection-config.xml
	%p/var/opennms/etc/opennms-datasources.xml
	%p/var/opennms/etc/opennms-server.xml
	%p/var/opennms/etc/opennms.properties
	%p/var/opennms/etc/otrs.properties
	%p/var/opennms/etc/poll-outages.xml
	%p/var/opennms/etc/poller-config.properties
	%p/var/opennms/etc/poller-configuration.xml
	%p/var/opennms/etc/response-adhoc-graph.properties
	%p/var/opennms/etc/response-graph.properties
	%p/var/opennms/etc/rrd-configuration.properties
	%p/var/opennms/etc/rtc-configuration.xml
	%p/var/opennms/etc/scriptd-configuration.xml
	%p/var/opennms/etc/service-configuration.xml
	%p/var/opennms/etc/setIfServiceKeysOnInsertTrigger.sql
	%p/var/opennms/etc/setIfServiceKeysOnUpdateTrigger.sql
	%p/var/opennms/etc/setIpInterfaceKeysOnInsertTrigger.sql
	%p/var/opennms/etc/setIpInterfaceKeysOnUpdateTrigger.sql
	%p/var/opennms/etc/setSnmpInterfaceKeysOnInsertTrigger.sql
	%p/var/opennms/etc/setSnmpInterfaceKeysOnUpdateTrigger.sql
	%p/var/opennms/etc/site-status-views.xml
	%p/var/opennms/etc/snmp-adhoc-graph.properties
	%p/var/opennms/etc/snmp-config.xml
	%p/var/opennms/etc/snmp-graph.properties
	%p/var/opennms/etc/statsd-configuration.xml
	%p/var/opennms/etc/surveillance-views.xml
	%p/var/opennms/etc/syslogd-configuration.xml
	%p/var/opennms/etc/threshd-configuration.xml
	%p/var/opennms/etc/thresholds.xml
	%p/var/opennms/etc/tl1d-configuration.xml
	%p/var/opennms/etc/translator-configuration.xml
	%p/var/opennms/etc/trapd-configuration.xml
	%p/var/opennms/etc/users.xml
	%p/var/opennms/etc/vacuumd-configuration.xml
	%p/var/opennms/etc/viewsdisplay.xml
	%p/var/opennms/etc/vulnscand-configuration.xml
	%p/var/opennms/etc/xmlrpcd-configuration.xml
	%p/var/opennms/etc/xmpp-configuration.properties
<<
CompileScript: echo "none needed"
InstallScript: <<
#!/bin/sh -ex

	# set up local maven repo
	cat <<END >settings.xml
<settings xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/settings-1.0.0.xsd">
  <localRepository>`pwd`/../../repository</localRepository>
  <offline>true</offline>
</settings>
END

	# main install
	sh ./build.sh -e -s `pwd`/settings.xml -Ddist.name=opennms -Ddist.dir=%i/var -Dopennms.home=%p/var/opennms install assembly:directory-inline

	# some convenience symlinks
	/usr/bin/install -d -m 755 %i/bin %i/etc %i/var/log
	/bin/ln -sf %p/var/opennms/etc %i/etc/opennms
	/bin/ln -sf %p/var/opennms/bin/opennms %i/bin/
	/bin/ln -sf %p/var/opennms/logs %i/var/log/opennms

	# put in the symlinks so tomcat can find classes
	/usr/bin/install -d -m 755 %i/var/tomcat5/server/lib

	# the opennms webapp
	/usr/bin/install -d -m 755 %i/var/tomcat5/webapps
	ln -sf %p/var/opennms/webapps/opennms %i/var/tomcat5/webapps/

	/usr/bin/install -d -m 755 %i/var/opennms/share/reports
	touch %i/var/opennms/share/reports/.turd

	/usr/bin/install -d -m 755 "%i/var/run"
	perl -pi -e 's,/var/lock/subsys/opennms,%p/var/run/opennms.lock,g' %i/var/opennms/bin/opennms

	# the path to the JVM
	which java > %i/var/opennms/etc/java.conf 2>/dev/null

	# make a config to add to tomcat for startup
	/usr/bin/install -d -m 755 "%i/var/tomcat5/conf"
	cat <<END > "%i/var/tomcat5/conf/opennms.conf"
CLASSPATH="%p/var/opennms/etc:$CLASSPATH" export CLASSPATH
DYLD_LIBRARY_PATH="%p/var/opennms/lib:$DYLD_LIBRARY_PATH" export DYLD_LIBRARY_PATH
JAVA_OPTS="$JAVA_OPTS -Djava.awt.headless=true" export JAVA_OPTS
umask 002
END

	/usr/sbin/chown -R opennms:opennms "%i/var/opennms" "%i/var/tomcat5/webapps/opennms" "%i/var/tomcat5/conf"/*
	/bin/chmod -R g+w "%i/var/opennms/etc" "%i/var/opennms/logs" "%i/var/tomcat5/conf"/*
	/bin/chmod g+s "%i/var/opennms/logs" "%i/var/opennms/etc"
	/usr/bin/install -d -m 755 "%i/etc/profile.d"
	/bin/chmod 755 "%i/var/opennms/bin"/*

	install -d -m 0755 %i/share
	mv %i/var/tomcat5/webapps %i/share/

	for file in %i/var/opennms/etc/*.xml; do
		/usr/bin/xmllint --format "$file" >xmllint-out.$$
		mv xmllint-out.$$ "$file"
	done

	# contrib directory
	install -d -m 755 %i/share/doc/%N
	mv %i/var/opennms/contrib %i/share/doc/%N/
<<
DaemonicFile: <<
<service>
	<description>OpenNMS</description>
	<message>OpenNMS Network Management</message>
	<daemon name="opennms">
		<executable background="no">/usr/bin/sudo</executable>
		<parameters>%p/bin/opennms start</parameters>
	</daemon>
</service>
<<

PostInstScript: <<
# update daemonic init script if necessary
daemonic install opennms

%p/var/opennms/bin/runjava -q -s

# let the user do this themselves for now
#echo -e "- running the OpenNMS installer... \c"
#%p/var/opennms/bin/install -r -disU >> /tmp/opennms-install.log 2>&1
#if [ $? -ne 0 ]; then
#	echo "Error running installer, see /tmp/opennms-install.log for details." >&2
#	exit 1
#fi
#echo "done"


cat <<END
*** NOTE ***

This package will not work until you follow the post-installation
instructions in %p/share/doc/%n/README.Darwin
END
<<
PreInstScript: <<
if [ -e %p/var/opennms/bin/xml.reader.pl ]; then
	for file in %p/var/opennms/etc/*.xml; do
		perl "%p/var/opennms/bin/xml.reader.pl" -w "$file" >/dev/null 2>&1 || :
	done
fi
<<
PreRmScript: <<
# clean up
if [ $1 != "upgrade" ]; then
	daemonic remove opennms
	rm -rf %p/var/log/opennms/*
fi
<<

RuntimeVars: OPENNMS_HOME: %p/var/opennms
Homepage: http://www.opennms.org/
Maintainer: Benjamin Reed <opennms@fink.racoonfink.com>
Description: Network Management System
DocFiles: README*
DescDetail: <<
OpenNMS is an open-source, enterprise-level network management system
along the lines of HP's OpenView line of network management tools, or
IBM's Tivoli.

*** NOTE ***

This package will not work until you follow the post-installation
instructions in /sw/share/doc/opennms/README.Darwin
<<
DescUsage: <<
To start, stop, or restart OpenNMS, do:

  sudo %p/bin/opennms <command>

To enable OpenNMS to start upon bootup, issue the command:

  sudo daemonic enable opennms

Note that for this to work properly, you must also enable PostgreSQL.
<<
License: GPL
