Package: ccp4
Version: 6.0
Revision: 1002
GCC: 4
Architecture: powerpc
Source: ftp://ftp.%n.ac.uk/%n/%v.0/packed/%n-%v.0-core-src.tar.gz
Source2: ftp://ftp.%n.ac.uk/%n/%v.0/packed/phaser-1.3.2-cctbx-src.tar.gz
Source-MD5: 00fe64b4600c9602aef56af0135f3016  
Source2-MD5: e4eee45ca8a299242a1089e35e63c7a0
SourceDirectory: %n-%v
Source3: http://chemistry.ucsc.edu/~wgscott/xtal/xtalfink/XCCPJiffy-custom.gz
Source3-MD5: 21568dd2475505929573a3fd452c538f
Depends: x11, tcltk, blt, ccp4-shlibs (>= %v-%r), fftw-shlibs | fftw-mpi-shlibs, clipper-bin
BuildDepends: g77 (>= 3.4.0-2), f2c, fort77, tcltk-dev, fftw | fftw-mpi
Replaces: mosflm (<= 6.2.3-2), mosflm-small (<= 6.2.3-2), refmac (<= 5.1999-3), ccp4lib, ccp4lib-shlibs, ccp4 (<= 5.99.5-9999), ccp4-gfortran
Conflicts: ccp4lib, ccp4lib-shlibs, ccp4 (<= 5.99.5-9999 ), ccp4-gfortran
NoSetCPPFLAGS: true
NoSetLDFLAGS: true
#
################################################################################
Patch: %n.patch
PatchScript: <<
#!/bin/zsh -ef
umask 0022
#
# setup script for tcsh, zsh and bash users
export TEMPXTAL=$PWD:h
#
perl -pi.bak -e 's|/xtal|\$TEMPXTAL|g' include/ccp4.setup*   # build prefix (changed in install)
perl -pi.bak -e 's|/prefix|%p|g' include/ccp4.setup*            # location of tcktk, blt
perl -pi.bak -e 's|/usr/local/bin|%p/bin|g' include/ccp4.setup*   # same
#
perl -pi.bak -e 's|SW_PREFIX|%p|g' **/configure            # location of tcktk, blt  
cp include/%n.setup-dist include/%n.setup
rm -f include/%n.setup-bash **/configure.bak include/ccp4.setup*.bak
#
# Set up XCCPJiffy wrapper scripts in $CCP4/etc
# These are small wrapper scripts for xplot84driver and xloggraph generated by the patch
 chmod a+x etc/x*
# Try to fix the dylib install path in configure
perl -pi.bak -e 's|\$rpath|%p/lib/%n-%v|g' **/configure
<<
################################################################################
CompileScript: <<
#!/bin/zsh -ef
umask 0022
# These are required for the build environment
export TEMPXTAL=$PWD:h
source include/%n.setup-zsh
export DYLD_LIBRARY_PATH=$CLIB
export rpath=%p/lib/%n-%v
export RPATH=%p/lib/%n-%v
 # The cctbx sub-package requires us to use the system's own Python
export PATH=/System/Library/Frameworks/Python.framework/Versions/Current/bin:$PATH
export PYTHONHOME="/System/Library/Frameworks/Python.framework/Versions/Current"
export PYTHONPATH="/System/Library/Frameworks/Python.framework/Versions/Current/lib/python2.3"
# Force configure to use fink's g77 Fortran compiler.  gfortran is not good enough yet
FC="g77" ./configure --with-x --with-shared-libs --with-fftw=%p Darwin
#  fix some post-configure bugs by getting rid of -lg2c
perl -pi.bak -e 's|-lg2c||g' **/*akefile*
#
make -i
make -i install
#
# Make wrappers for xplot84driver and xloggraph, so rename the executables
cd  x-windows/XCCPJIFFY
cp xplot84driver  $CBIN/xplot84driver.exe
rm -f $CBIN/xplot84driver
#
# Manually link xloggraph with g77 (fails in make)
echo ""
echo "**********************************************************************"
echo "Re-linking xloggraph with g77.  Ignore previous error messages."
echo "**********************************************************************"
echo ""
#
g77 -fno-second-underscore -o xloggraph -L/usr/lib msg_box.o ZDr2d.o EditString.o hardcopy_ctrl.o xloggraph.o log_file.o tom_fortran_interface.o bits_and_pieces.o graphics.o -g -Os -I/usr/include/X11R6 -L/usr/X11R6/lib -lXaw -lXmu -lXt -lSM -lICE -lXpm -lXext -lX11 -lm -lgcc -lSystemStubs
#
sleep 10
#
cp xloggraph $CBIN/xloggraph.exe
cd ../..
#
# make realclean
/bin/rm -f **/*.o
echo "Compile Phase Completed!"
echo "There are $(command ls -1 $CBIN | wc -l) programs in $CBIN; there should be 200"
<<
################################################################################
InstallScript: <<
#!/bin/zsh -ef
umask 0022
export TEMPXTAL=$PWD:h
source include/%n.setup-zsh
export DYLD_LIBRARY_PATH=$CLIB
ORIGDIR=$(dirname $PWD)
# Change environment scripts to match final installation
perl -pi.bak -e 's|\$TEMPXTAL|%p/share/xtal|g' include/%n.setup*      # install prefix
# perl -pi.bak -e 's|\$TEMPXTAL|%p/share/xtal|g' lib/cctbx/cctbx_build/setpaths* 
#
#
 cp ../XCCPJiffy-custom.gz  XCCPJiffy.gz ; gunzip XCCPJiffy.gz; chmod a+x XCCPJiffy
 perl -pi.bak -e 's|5.0.1|%v|g' XCCPJiffy
 mv -f  XCCPJiffy lib/X11/app-defaults/XCCPJiffy
#  
 perl -pi.bak -e 's|/src/fink.build/%n-%v-%r|/share/xtal|g' bin/clipper-config
 rm -f bin/clipper-config.bak
 perl -pi.bak -e 's|lclipper |lclipper-core |g' bin/clipper-config
 rm -f bin/clipper-config.bak                                
 perl -pi.bak -e 's|lib/lib -lrfftw -lfftw |lib/ccp4-%v -lsrfftw -lsfftw |g' bin/clipper-config
 rm -f bin/clipper-config.bak                                
#
# Fix path in libfoo.la libtool files:
#  
 perl -pi.bak -e 's|/src/fink.build/%n-%v-%r/%n-%v/lib|/lib/%n-%v|g' lib/**/*.la
 rm -f lib/**/*.la.bak
#
# Now install:
#
 mkdir -p %i/lib
 cp -R lib %i/lib/%n-%v
 mkdir -p %i/bin
#
 mkdir -p %i/share/xtal/%n-%v/help
 mkdir -p %i/share/man/man1
# set up man pages in a fink-compliant manner
 cd $PWD/doc
 mv rasmol.doc eightbit_rasmol.doc
 foreach docfilepage ( *.doc )
     cp ${docfilepage}  %i/share/man/man1/${docfilepage:r}.1
     cp ${docfilepage}  %i/share/xtal/%n-%v/help/${docfilepage:r}
end
# back to build directory
 cd ..
#                                
/bin/rm -rf lib 
#/bin/mv  lib lib-save

 cp -R * %i/share/xtal/%n-%v/.
 ln -s   %p/lib/%n-%v      %i/share/xtal/%n-%v/lib
#
# making scripts for %p/etc/profile.d  
 mkdir -p %i/etc/profile.d
#
 echo "source %p/share/xtal/%n-%v/include/%n.setup"                     > %i/etc/profile.d/%n.csh
 echo "setenv CLIB %p/lib/ccp4-%v "                                    >> %i/etc/profile.d/%n.csh
#

echo "if [ -z \$ZSH_NAME ];then                           "                        > %i/etc/profile.d/%n.sh 
echo "    source %p/share/xtal/%n-%v/include/%n.setup-sh "                       >> %i/etc/profile.d/%n.sh    
echo "else                                               "                       >> %i/etc/profile.d/%n.sh
echo "    source %p/share/xtal/%n-%v/include/%n.setup-zsh"                       >> %i/etc/profile.d/%n.sh
echo "fi                                                 "                       >> %i/etc/profile.d/%n.sh
echo "export CLIB=%p/lib/ccp4-%v "                                    >> %i/etc/profile.d/%n.sh
#
 chmod a+x %i/etc/profile.d/%n.*
#
 chmod a+x  %i/share/xtal/%n-%v/ccp4i/etc/osx_ccp4_mail
#
# chmod a+x %i/share/xtal/%n-%v/etc/ccp4help 
#
 ranlib %i/lib/%n-%v/*.a
 ranlib %i/lib/%n-%v/**/*.a
#
<<
################################################################################
PostInstScript: <<
# Make the user read the license conditions
more %p/share/xtal/%n-%v/conditions.txt
<<
################################################################################
SplitOff: <<
Package: %N-shlibs
Depends: fftw-shlibs | fftw-mpi-shlibs
Replaces: ccp4lib, ccp4lib-shlibs
  Files: <<
lib/ccp4-6.0/libccif.dylib
lib/ccp4-6.0/libccp4c.dylib
lib/ccp4-6.0/libjwc_c.0.1.1.dylib
lib/ccp4-6.0/libjwc_c.0.dylib
lib/ccp4-6.0/libjwc_c.dylib
lib/ccp4-6.0/libssm.0.0.0.dylib
lib/ccp4-6.0/libssm.0.dylib
lib/ccp4-6.0/libssm.dylib
lib/ccp4-6.0/libxdl_view.2.0.0.dylib
lib/ccp4-6.0/libxdl_view.2.dylib
lib/ccp4-6.0/libxdl_view.dylib
lib/ccp4-6.0/libxdl_viewextra.0.0.0.dylib
lib/ccp4-6.0/libxdl_viewextra.0.dylib
lib/ccp4-6.0/libxdl_viewextra.dylib
<<
#lib/ccp4-6.0/libmmdb.dylib
Shlibs: <<
   %p/lib/ccp4-6.0/libccif.dylib 0.0.0 ccp4lib-shlibs (>= 6.0-1002)
   %p/lib/ccp4-6.0/libccp4c.dylib 0.0.0 ccp4lib-shlibs (>= 6.0-1002)
   %p/lib/ccp4-6.0/libjwc_c.0.dylib 2.0.0 ccp4lib-shlibs (>= 6.0-1002)
   %p/lib/ccp4-6.0/libjwc_c.0.1.1.dylib 2.0.0 ccp4lib-shlibs (>= 6.0-1002)
   %p/lib/ccp4-6.0/libjwc_c.dylib 2.0.0 ccp4lib-shlibs (>= 6.0-1002)
   %p/lib/ccp4-6.0/libxdl_view.2.dylib 3.0.0 ccp4lib-shlibs (>= 6.0-1002)
   %p/lib/ccp4-6.0/libxdl_view.2.0.0.dylib 2.0.0 ccp4lib-shlibs (>= 6.0-1002)
   %p/lib/ccp4-6.0/libxdl_view.dylib 2.0.0 ccp4lib-shlibs (>= 6.0-1002)
   %p/lib/ccp4-6.0/libxdl_viewextra.0.dylib 1.0.0 ccp4lib-shlibs (>= 6.0-1002)
   %p/lib/ccp4-6.0/libxdl_viewextra.0.0.0.dylib 1.0.0 ccp4lib-shlibs (>= 6.0-1002)
   %p/lib/ccp4-6.0/libxdl_viewextra.dylib 1.0.0 ccp4lib-shlibs (>= 6.0-1002)
   %p/lib/ccp4-6.0/libssm.0.0.0.dylib 1.0.0 ccp4lib-shlibs (>= 6.0-1002)
   %p/lib/ccp4-6.0/libssm.0.dylib 1.0.0 ccp4lib-shlibs (>= 6.0-1002)
   %p/lib/ccp4-6.0/libssm.dylib 1.0.0 ccp4lib-shlibs (>= 6.0-1002)
  << 
  DocFiles: CHANGES COPYING INSTALL INSTALL.html INSTALL.ps README PROBLEMS academic_software_licence.pdf
Description: Essential dynamic libraries for CCP4
DescDetail: <<
The package ccp4-shlibs contains all of the essential (non-clipper) libraries
for ccp4. It excludes the clipper dynamic libraries, which may be buggy.
<<
<<  
#   %p/lib/ccp4-6.0/libmmdb.dylib 1.0.0 ccp4lib-shlibs (>= 6.0-1002)
#
################################################################################
SplitOff2: <<
Package: %N-clipper-shlibs
Description: Currently buggy clipper dynamic libraries
DescDetail: <<
CCP4-clipper-shlibs contains all of the non-essential clipper dynamic 
libraries that are built by ccp4.  There appear to be problems with  this  
specific to g++-4.0.1.  Until these are addressed, use the static clipper 
libraries in fink's  ccp4-onlylibs-dev package instead
<<
Depends: fftw-shlibs | fftw-mpi-shlibs
Replaces: ccp4lib, ccp4lib-shlibs
  Files: <<
lib/ccp4-6.0/libclipper-ccp4.0.0.0.dylib
lib/ccp4-6.0/libclipper-ccp4.0.dylib
lib/ccp4-6.0/libclipper-ccp4.dylib
lib/ccp4-6.0/libclipper-cif.0.0.0.dylib
lib/ccp4-6.0/libclipper-cif.0.dylib
lib/ccp4-6.0/libclipper-cif.dylib
lib/ccp4-6.0/libclipper-contrib.0.0.0.dylib
lib/ccp4-6.0/libclipper-contrib.0.dylib
lib/ccp4-6.0/libclipper-contrib.dylib
lib/ccp4-6.0/libclipper-core.0.0.0.dylib
lib/ccp4-6.0/libclipper-core.0.dylib
lib/ccp4-6.0/libclipper-core.dylib
lib/ccp4-6.0/libclipper-minimol.0.0.0.dylib
lib/ccp4-6.0/libclipper-minimol.0.dylib
lib/ccp4-6.0/libclipper-minimol.dylib
lib/ccp4-6.0/libclipper-mmdb.0.0.0.dylib
lib/ccp4-6.0/libclipper-mmdb.0.dylib
lib/ccp4-6.0/libclipper-mmdb.dylib
lib/ccp4-6.0/libclipper-phs.0.0.0.dylib
lib/ccp4-6.0/libclipper-phs.0.dylib
lib/ccp4-6.0/libclipper-phs.dylib
<<
Shlibs: <<
   %p/lib/ccp4-6.0/libclipper-ccp4.0.dylib 1.0.0 ccp4lib-shlibs (>= 6.0-1002)
   %p/lib/ccp4-6.0/libclipper-ccp4.0.0.0.dylib 1.0.0 ccp4lib-shlibs (>= 6.0-1002)
   %p/lib/ccp4-6.0/libclipper-ccp4.dylib 1.0.0 ccp4lib-shlibs (>= 6.0-1002)
   %p/lib/ccp4-6.0/libclipper-cif.0.0.0.dylib 1.0.0 ccp4lib-shlibs (>= 6.0-1002)
   %p/lib/ccp4-6.0/libclipper-cif.0.dylib 1.0.0 ccp4lib-shlibs (>= 6.0-1002)
   %p/lib/ccp4-6.0/libclipper-cif.dylib 1.0.0 ccp4lib-shlibs (>= 6.0-1002)
   %p/lib/ccp4-6.0/libclipper-contrib.0.dylib 1.0.0 ccp4lib-shlibs (>= 6.0-1002)
   %p/lib/ccp4-6.0/libclipper-contrib.0.0.0.dylib 1.0.0 ccp4lib-shlibs (>= 6.0-1002)
   %p/lib/ccp4-6.0/libclipper-contrib.dylib 1.0.0 ccp4lib-shlibs (>= 6.0-1002)
   %p/lib/ccp4-6.0/libclipper-core.0.0.0.dylib 1.0.0 ccp4lib-shlibs (>= 6.0-1002)
   %p/lib/ccp4-6.0/libclipper-core.0.dylib 1.0.0 ccp4lib-shlibs (>= 6.0-1002)
   %p/lib/ccp4-6.0/libclipper-core.dylib 1.0.0 ccp4lib-shlibs (>= 6.0-1002)
   %p/lib/ccp4-6.0/libclipper-minimol.0.dylib 1.0.0 ccp4lib-shlibs (>= 6.0-1002)
   %p/lib/ccp4-6.0/libclipper-minimol.0.0.0.dylib 1.0.0 ccp4lib-shlibs (>= 6.0-1002)
   %p/lib/ccp4-6.0/libclipper-minimol.dylib 1.0.0 ccp4lib-shlibs (>= 6.0-1002)
   %p/lib/ccp4-6.0/libclipper-mmdb.0.dylib 1.0.0 ccp4lib-shlibs (>= 6.0-1002)
   %p/lib/ccp4-6.0/libclipper-mmdb.0.0.0.dylib 1.0.0 ccp4lib-shlibs (>= 6.0-1002)
   %p/lib/ccp4-6.0/libclipper-mmdb.dylib 1.0.0 ccp4lib-shlibs (>= 6.0-1002)
   %p/lib/ccp4-6.0/libclipper-phs.0.dylib 1.0.0 ccp4lib-shlibs (>= 6.0-1002)
   %p/lib/ccp4-6.0/libclipper-phs.0.0.0.dylib 1.0.0 ccp4lib-shlibs (>= 6.0-1002)
   %p/lib/ccp4-6.0/libclipper-phs.dylib 1.0.0 ccp4lib-shlibs (>= 6.0-1002)
  << 
  DocFiles: CHANGES COPYING INSTALL INSTALL.html INSTALL.ps README PROBLEMS academic_software_licence.pdf
<< 
################################################################################
SplitOff3: <<
Package: %N-clipper-bin
Description: Broken! Install clipper-bin instead.
DescDetail:<<
CCP4-clipper-bin contains all of the currently broken clipper executables, as
there appear to be problems with these that are specific to g++-4.0.1 and  
the clipper dynamic libraries.  Until these are addressed, use the statically
linked binaries in fink's clipper-bin package instead.
<<
Files: <<   
share/xtal/ccp4-6.0/bin/clipper-config
share/xtal/ccp4-6.0/bin/cecalc
share/xtal/ccp4-6.0/bin/cfft
share/xtal/ccp4-6.0/bin/chltofom
share/xtal/ccp4-6.0/bin/cinvfft
share/xtal/ccp4-6.0/bin/cmakereference
share/xtal/ccp4-6.0/bin/cpatterson
share/xtal/ccp4-6.0/bin/cphasecombine
share/xtal/ccp4-6.0/bin/cphasematch
share/xtal/ccp4-6.0/bin/cpirate
share/xtal/ccp4-6.0/bin/csfcalc
share/xtal/ccp4-6.0/bin/csigmaa
share/xtal/ccp4-6.0/bin/superpose
<<
BuildDependsOnly: false
DocFiles:  CHANGES COPYING INSTALL INSTALL.html INSTALL.ps README PROBLEMS academic_software_licence.pdf
<<
################################################################################
SplitOff4: <<
Package: %N-dev
BuildDependsOnly: true
Description: CCP4 static libraries and libtool files
Files:<<
lib/ccp4-6.0/*.a  
lib/ccp4-6.0/*.la
<<
DocFiles:  CHANGES COPYING INSTALL INSTALL.html INSTALL.ps README PROBLEMS academic_software_licence.pdf
<<
################################################################################
Description:  Macromolecular crystallography package
DescDetail: <<
The package ccp4 and ccp4-shlibs are installed by default,
and the package clipper-bin that provides clipper statically
linked executables will also be installed.

Dynamically linked clipper executables and clipper dynamic 
libraries are not installed by default in the 10.4 g++4.0
tree, as they appear to be problematic.  These are contained in
the ccp4-clipper-shlibs and ccp4-clipper-bin packages.

CCP4 macromolecular crystallography suite has approximately
200 programs and utilities. This version included Clipper
libraries, and ccif and phaser. If you need cctbx, please
install the cctbx fink package separately.

Type "ccp4help" for a summary listing of all ccp4 programs.
Type "ccp4help foo" for a detailed description of program "foo."

Invoke optional ccp4i gui for the first run using: sudo ccp4i
Thereafter, invoke without sudo.

This version compiles with the Apple Lapack/Blas framework
License agreement is part of configure file -- print out form and mail in,
additional comments at http://chemistry.ucsc.edu/~wgscott/xtal/ccp4.html
CCP4 files will be installed under /sw/share/xtal/ccp4-6.0
This revision includes all available CCP4 patches as of Feb 26, 2006. 
and new bash and zsh command completions specific to ccp4.
<<
DocFiles: README CHANGES COPYING PROBLEMS INSTALL INSTALL.html INSTALL.ps ccp4i_installation.html academic_software_licence.pdf  academic_software_licence.ps.gz  academic_software_licence.rtf
Homepage: http://www.ccp4.ac.uk  
License: Commercial
Maintainer: W. G. Scott <wgscott@users.sourceforge.net>
