--- bidwatcher-1.3.5/netstuff.cpp.orig	2002-09-10 17:22:36.000000000 -0700
+++ bidwatcher-1.3.5/netstuff.cpp	2002-09-10 17:25:12.000000000 -0700
@@ -240,7 +240,7 @@
    int    buffLength,recerr;
    int    socketID;
    char   lineBuff[1024];
-   char   htmlBuff[HUGEBUFF];
+   char   *htmlBuff;;
 
    struct    sockaddr_in soc_in;
    int	  err;
@@ -249,6 +249,7 @@
 
    *Buff = NULL;
 
+   htmlBuff = (char *) malloc(HUGEBUFF);
    GTimer * time_since_start=g_timer_new();
    g_timer_start(time_since_start);
 
@@ -263,6 +264,7 @@
    if (hostinfo==NULL) {
      // DNS error
      g_free(time_since_start);
+     free(htmlBuff);
      return NET_NETERROR;
    }
    soc_in.sin_addr=*(struct in_addr*)hostinfo->h_addr;
@@ -271,6 +273,7 @@
    socketID = socket(AF_INET, SOCK_STREAM, 0);
    if (socketID < 0) {
      g_free(time_since_start);
+     free(htmlBuff);
      return NET_NETERROR;
    }
 
@@ -291,6 +294,7 @@
 #endif
 	       CloseSocket(socketID);
 	       g_free(time_since_start);
+	       free(htmlBuff);
 	       return NET_TIMEOUT;
 	   }
        }
@@ -302,6 +306,7 @@
 #endif
 	   CloseSocket(socketID);
 	   g_free(time_since_start);
+	   free(htmlBuff);
 	   return NET_NETERROR;
        }
    }
@@ -328,6 +333,7 @@
 #endif
      CloseSocket(socketID);
      g_free(time_since_start);
+     free(htmlBuff);
      return NET_NETERROR;
    }
 
@@ -343,6 +349,7 @@
 #endif
        CloseSocket(socketID);
        g_free(time_since_start);
+       free(htmlBuff);
        return NET_NETERROR;
    }
 
@@ -357,6 +364,7 @@
       if (cancelPressed) {
 	g_free(time_since_pkt);
 	g_free(time_since_start);
+        free(htmlBuff);
 	return NET_USERCANCEL;
       }
       if (counter == 5) {
@@ -366,6 +374,7 @@
 	  CloseSocket(socketID);
 	  g_free(time_since_pkt);
 	  g_free(time_since_start);
+          free(htmlBuff);
 	  return NET_TIMEOUT;
 	}
 
@@ -373,6 +382,7 @@
 	  CloseSocket(socketID);
 	  g_free(time_since_pkt);
 	  g_free(time_since_start);
+          free(htmlBuff);
 	  return NET_TIMEOUT;
 	}
       }
@@ -406,11 +416,13 @@
    if (checkredir(url,htmlBuff)) {
      g_free(time_since_pkt);
      g_free(time_since_start);
+     free(htmlBuff);
      return fetchURL(url, Buff, timeOut);
    } else {
      if (!goodcall) {
        g_free(time_since_pkt);
        g_free(time_since_start);
+       free(htmlBuff);
        return NET_NETERROR;
      } 
      /* make and copy buffer */
@@ -420,6 +432,7 @@
 
      g_free(time_since_start);
      g_free(time_since_pkt);
+     free(htmlBuff);
      return NET_SUCCESS; 
    }
 } 
