
--- postgresql-7.3.18/configure	2007-02-01 19:15:59.000000000 -0500
+++ postgresql-7.3.18-new/configure	2007-02-05 11:07:20.000000000 -0500
@@ -4222,7 +4222,7 @@
 
 
 # Extract the first word of "perl", so it can be a program name with args.
-set dummy perl; ac_word=$2
+set dummy perl; ac_word=perl5.6.0
 echo "$as_me:$LINENO: checking for $ac_word" >&5
 echo $ECHO_N "checking for $ac_word... $ECHO_C" >&6
 if test "${ac_cv_path_PERL+set}" = set; then
@@ -4289,7 +4289,7 @@
 
 if test "$with_python" = yes; then
   # Extract the first word of "python", so it can be a program name with args.
-set dummy python; ac_word=$2
+set dummy python; ac_word=python2.1
 echo "$as_me:$LINENO: checking for $ac_word" >&5
 echo $ECHO_N "checking for $ac_word... $ECHO_C" >&6
 if test "${ac_cv_path_PYTHON+set}" = set; then
@@ -8397,8 +8397,8 @@
 
 if test "$with_pam" = yes ; then
   if test "${ac_cv_header_security_pam_appl_h+set}" = set; then
-  echo "$as_me:$LINENO: checking for security/pam_appl.h" >&5
-echo $ECHO_N "checking for security/pam_appl.h... $ECHO_C" >&6
+  echo "$as_me:$LINENO: checking for pam/pam_appl.h" >&5
+echo $ECHO_N "checking for pam/pam_appl.h... $ECHO_C" >&6
 if test "${ac_cv_header_security_pam_appl_h+set}" = set; then
   echo $ECHO_N "(cached) $ECHO_C" >&6
 fi
@@ -8406,13 +8406,13 @@
 echo "${ECHO_T}$ac_cv_header_security_pam_appl_h" >&6
 else
   # Is the header compilable?
-echo "$as_me:$LINENO: checking security/pam_appl.h usability" >&5
-echo $ECHO_N "checking security/pam_appl.h usability... $ECHO_C" >&6
+echo "$as_me:$LINENO: checking pam/pam_appl.h usability" >&5
+echo $ECHO_N "checking pam/pam_appl.h usability... $ECHO_C" >&6
 cat >conftest.$ac_ext <<_ACEOF
 #line $LINENO "configure"
 #include "confdefs.h"
 $ac_includes_default
-#include <security/pam_appl.h>
+#include <pam/pam_appl.h>
 _ACEOF
 rm -f conftest.$ac_objext
 if { (eval echo "$as_me:$LINENO: \"$ac_compile\"") >&5
@@ -8437,12 +8437,12 @@
 echo "${ECHO_T}$ac_header_compiler" >&6
 
 # Is the header present?
-echo "$as_me:$LINENO: checking security/pam_appl.h presence" >&5
-echo $ECHO_N "checking security/pam_appl.h presence... $ECHO_C" >&6
+echo "$as_me:$LINENO: checking pam/pam_appl.h presence" >&5
+echo $ECHO_N "checking pam/pam_appl.h presence... $ECHO_C" >&6
 cat >conftest.$ac_ext <<_ACEOF
 #line $LINENO "configure"
 #include "confdefs.h"
-#include <security/pam_appl.h>
+#include <pam/pam_appl.h>
 _ACEOF
 if { (eval echo "$as_me:$LINENO: \"$ac_cpp conftest.$ac_ext\"") >&5
   (eval $ac_cpp conftest.$ac_ext) 2>conftest.er1
@@ -8474,20 +8474,20 @@
 # So?  What about this header?
 case $ac_header_compiler:$ac_header_preproc in
   yes:no )
-    { echo "$as_me:$LINENO: WARNING: security/pam_appl.h: accepted by the compiler, rejected by the preprocessor!" >&5
-echo "$as_me: WARNING: security/pam_appl.h: accepted by the compiler, rejected by the preprocessor!" >&2;}
-    { echo "$as_me:$LINENO: WARNING: security/pam_appl.h: proceeding with the preprocessor's result" >&5
-echo "$as_me: WARNING: security/pam_appl.h: proceeding with the preprocessor's result" >&2;};;
+    { echo "$as_me:$LINENO: WARNING: pam/pam_appl.h: accepted by the compiler, rejected by the preprocessor!" >&5
+echo "$as_me: WARNING: pam/pam_appl.h: accepted by the compiler, rejected by the preprocessor!" >&2;}
+    { echo "$as_me:$LINENO: WARNING: pam/pam_appl.h: proceeding with the preprocessor's result" >&5
+echo "$as_me: WARNING: pam/pam_appl.h: proceeding with the preprocessor's result" >&2;};;
   no:yes )
-    { echo "$as_me:$LINENO: WARNING: security/pam_appl.h: present but cannot be compiled" >&5
-echo "$as_me: WARNING: security/pam_appl.h: present but cannot be compiled" >&2;}
-    { echo "$as_me:$LINENO: WARNING: security/pam_appl.h: check for missing prerequisite headers?" >&5
-echo "$as_me: WARNING: security/pam_appl.h: check for missing prerequisite headers?" >&2;}
-    { echo "$as_me:$LINENO: WARNING: security/pam_appl.h: proceeding with the preprocessor's result" >&5
-echo "$as_me: WARNING: security/pam_appl.h: proceeding with the preprocessor's result" >&2;};;
+    { echo "$as_me:$LINENO: WARNING: pam/pam_appl.h: present but cannot be compiled" >&5
+echo "$as_me: WARNING: pam/pam_appl.h: present but cannot be compiled" >&2;}
+    { echo "$as_me:$LINENO: WARNING: pam/pam_appl.h: check for missing prerequisite headers?" >&5
+echo "$as_me: WARNING: pam/pam_appl.h: check for missing prerequisite headers?" >&2;}
+    { echo "$as_me:$LINENO: WARNING: pam/pam_appl.h: proceeding with the preprocessor's result" >&5
+echo "$as_me: WARNING: pam/pam_appl.h: proceeding with the preprocessor's result" >&2;};;
 esac
-echo "$as_me:$LINENO: checking for security/pam_appl.h" >&5
-echo $ECHO_N "checking for security/pam_appl.h... $ECHO_C" >&6
+echo "$as_me:$LINENO: checking for pam/pam_appl.h" >&5
+echo $ECHO_N "checking for pam/pam_appl.h... $ECHO_C" >&6
 if test "${ac_cv_header_security_pam_appl_h+set}" = set; then
   echo $ECHO_N "(cached) $ECHO_C" >&6
 else
@@ -8500,8 +8500,8 @@
 if test $ac_cv_header_security_pam_appl_h = yes; then
   :
 else
-  { { echo "$as_me:$LINENO: error: header file <security/pam_appl.h> is required for PAM" >&5
-echo "$as_me: error: header file <security/pam_appl.h> is required for PAM" >&2;}
+  { { echo "$as_me:$LINENO: error: header file <pam/pam_appl.h> is required for PAM" >&5
+echo "$as_me: error: header file <pam/pam_appl.h> is required for PAM" >&2;}
    { (exit 1); exit 1; }; }
 fi
 
--- postgresql-7.3.18/configure.in	2007-02-01 19:16:01.000000000 -0500
+++ postgresql-7.3.18-new/configure.in	2007-02-05 11:07:20.000000000 -0500
@@ -729,7 +729,12 @@
 fi
 
 if test "$with_pam" = yes ; then
-  AC_CHECK_HEADER([security/pam_appl.h], [], [AC_MSG_ERROR([header file <security/pam_appl.h> is required for PAM])])
+  AC_CHECK_HEADERS([security/pam_appl.h], [], [
+    AC_CHECK_HEADERS([pam/pam_appl.h], [
+      AC_DEFINE([HAVE_PAM_PAM_APPL_H], 1, [Define if pam_appl.h is in pam/ instead of security/])
+      ], [AC_MSG_ERROR([header file <security/pam_appl.h> or <pam/pam_appl.h> is required for PAM])]
+    )
+  ])
 fi
 
 
--- postgresql-7.3.18/contrib/Makefile	2002-10-20 20:12:46.000000000 -0400
+++ postgresql-7.3.18-new/contrib/Makefile	2007-02-05 11:07:20.000000000 -0500
@@ -37,7 +37,6 @@
 		string		\
 		tablefunc	\
 		tips		\
-		tsearch		\
 		userlock	\
 		vacuumlo
 
--- postgresql-7.3.18/contrib/array/Makefile	2001-09-06 06:49:29.000000000 -0400
+++ postgresql-7.3.18-new/contrib/array/Makefile	2007-02-05 11:07:20.000000000 -0500
@@ -1,5 +1,7 @@
 # $Header: /cvsroot/pgsql/contrib/array/Attic/Makefile,v 1.16 2001/09/06 10:49:29 petere Exp $
 
+DLTYPE = bundle
+
 subdir = contrib/array
 top_builddir = ../..
 include $(top_builddir)/src/Makefile.global
--- postgresql-7.3.18/contrib/btree_gist/Makefile	2001-09-06 06:49:29.000000000 -0400
+++ postgresql-7.3.18-new/contrib/btree_gist/Makefile	2007-02-05 11:07:20.000000000 -0500
@@ -1,5 +1,7 @@
 # $Header: /cvsroot/pgsql/contrib/btree_gist/Makefile,v 1.3 2001/09/06 10:49:29 petere Exp $
 
+DLTYPE = bundle
+
 subdir = contrib/btree_gist
 top_builddir = ../..
 include $(top_builddir)/src/Makefile.global
--- postgresql-7.3.18/contrib/chkpass/Makefile	2002-10-21 14:55:10.000000000 -0400
+++ postgresql-7.3.18-new/contrib/chkpass/Makefile	2007-02-05 11:07:20.000000000 -0500
@@ -1,5 +1,7 @@
 # $Header: /cvsroot/pgsql/contrib/chkpass/Makefile,v 1.4 2002/10/21 18:55:10 petere Exp $
 
+DLTYPE = bundle
+
 subdir = contrib/chkpass
 top_builddir = ../..
 include $(top_builddir)/src/Makefile.global
--- postgresql-7.3.18/contrib/contrib-global.mk	2002-11-01 19:16:21.000000000 -0500
+++ postgresql-7.3.18-new/contrib/contrib-global.mk	2007-02-05 11:07:20.000000000 -0500
@@ -42,6 +42,9 @@
 #
 # Better look at some of the existing uses for examples...
 
+ifeq ($(DLTYPE), bundle)
+override DARWIN_LINKFLAGS := $(DARWIN_LINKFLAGS) -bundle_loader $(top_srcdir)/src/backend/postgres
+endif
 
 override CPPFLAGS := -I$(srcdir) $(CPPFLAGS)
 
--- postgresql-7.3.18/contrib/cube/Makefile	2003-01-31 15:58:28.000000000 -0500
+++ postgresql-7.3.18-new/contrib/cube/Makefile	2007-02-05 11:07:20.000000000 -0500
@@ -1,5 +1,7 @@
 # $Header: /cvsroot/pgsql/contrib/cube/Makefile,v 1.7.2.1 2003/01/31 20:58:28 tgl Exp $
 
+DLTYPE = bundle
+
 subdir = contrib/cube
 top_builddir = ../..
 include $(top_builddir)/src/Makefile.global
--- postgresql-7.3.18/contrib/dblink/Makefile	2002-09-14 16:28:54.000000000 -0400
+++ postgresql-7.3.18-new/contrib/dblink/Makefile	2007-02-05 11:07:20.000000000 -0500
@@ -1,5 +1,7 @@
 # $Header: /cvsroot/pgsql/contrib/dblink/Makefile,v 1.7 2002/09/14 20:28:54 tgl Exp $
 
+DLTYPE = bundle
+
 subdir = contrib/dblink
 top_builddir = ../..
 include $(top_builddir)/src/Makefile.global
--- postgresql-7.3.18/contrib/dbmirror/Makefile	2002-06-23 17:58:07.000000000 -0400
+++ postgresql-7.3.18-new/contrib/dbmirror/Makefile	2007-02-05 11:07:20.000000000 -0500
@@ -1,5 +1,7 @@
 # $Header: /cvsroot/pgsql/contrib/dbmirror/Attic/Makefile,v 1.1 2002/06/23 21:58:07 momjian Exp $
 
+DLTYPE = bundle
+
 subdir = contrib/dbmirror
 top_builddir = ../..
 include $(top_builddir)/src/Makefile.global
--- postgresql-7.3.18/contrib/dbsize/Makefile	2002-02-22 18:05:35.000000000 -0500
+++ postgresql-7.3.18-new/contrib/dbsize/Makefile	2007-02-05 11:07:20.000000000 -0500
@@ -1,3 +1,5 @@
+DLTYPE = bundle
+
 subdir = contrib/dbsize
 top_builddir = ../..
 include $(top_builddir)/src/Makefile.global
--- postgresql-7.3.18/contrib/earthdistance/Makefile	2002-09-19 23:47:22.000000000 -0400
+++ postgresql-7.3.18-new/contrib/earthdistance/Makefile	2007-02-05 11:07:20.000000000 -0500
@@ -1,5 +1,7 @@
 # $Header: /cvsroot/pgsql/contrib/earthdistance/Makefile,v 1.12 2002/09/20 03:47:22 momjian Exp $
 
+DLTYPE = bundle
+
 subdir = contrib/earthdistance
 top_builddir = ../..
 include $(top_builddir)/src/Makefile.global
--- postgresql-7.3.18/contrib/fulltextindex/Makefile	2001-09-06 06:49:29.000000000 -0400
+++ postgresql-7.3.18-new/contrib/fulltextindex/Makefile	2007-02-05 11:07:20.000000000 -0500
@@ -1,5 +1,7 @@
 # $Header: /cvsroot/pgsql/contrib/fulltextindex/Attic/Makefile,v 1.11 2001/09/06 10:49:29 petere Exp $
 
+DLTYPE = bundle
+
 subdir = contrib/fulltextindex
 top_builddir = ../..
 include $(top_builddir)/src/Makefile.global
--- postgresql-7.3.18/contrib/fuzzystrmatch/Makefile	2001-09-06 06:49:29.000000000 -0400
+++ postgresql-7.3.18-new/contrib/fuzzystrmatch/Makefile	2007-02-05 11:07:20.000000000 -0500
@@ -1,5 +1,7 @@
 # $Header: /cvsroot/pgsql/contrib/fuzzystrmatch/Makefile,v 1.2 2001/09/06 10:49:29 petere Exp $
 
+DLTYPE = bundle
+
 subdir = contrib/fuzzystrmatch
 top_builddir = ../..
 include $(top_builddir)/src/Makefile.global
--- postgresql-7.3.18/contrib/intagg/Makefile	2002-02-24 23:16:58.000000000 -0500
+++ postgresql-7.3.18-new/contrib/intagg/Makefile	2007-02-05 11:07:20.000000000 -0500
@@ -4,6 +4,8 @@
 # by Mark L. Woodward
 # $Header: /cvsroot/pgsql/contrib/intagg/Makefile,v 1.3 2002/02/25 04:16:58 tgl Exp $
 
+DLTYPE = bundle
+
 subdir = contrib/intagg
 top_builddir = ../..
 include $(top_builddir)/src/Makefile.global
--- postgresql-7.3.18/contrib/intarray/Makefile	2001-09-06 06:49:29.000000000 -0400
+++ postgresql-7.3.18-new/contrib/intarray/Makefile	2007-02-05 11:07:20.000000000 -0500
@@ -1,5 +1,7 @@
 # $Header: /cvsroot/pgsql/contrib/intarray/Makefile,v 1.8 2001/09/06 10:49:29 petere Exp $
 
+DLTYPE = bundle
+
 subdir = contrib/intarray
 top_builddir = ../..
 include $(top_builddir)/src/Makefile.global
--- postgresql-7.3.18/contrib/isbn_issn/Makefile	2001-09-06 06:49:29.000000000 -0400
+++ postgresql-7.3.18-new/contrib/isbn_issn/Makefile	2007-02-05 11:07:20.000000000 -0500
@@ -1,5 +1,7 @@
 # $Header: /cvsroot/pgsql/contrib/isbn_issn/Attic/Makefile,v 1.11 2001/09/06 10:49:29 petere Exp $
 
+DLTYPE = bundle
+
 subdir = contrib/isbn_issn
 top_builddir = ../..
 include $(top_builddir)/src/Makefile.global
--- postgresql-7.3.18/contrib/lo/Makefile	2001-09-06 06:49:29.000000000 -0400
+++ postgresql-7.3.18-new/contrib/lo/Makefile	2007-02-05 11:07:20.000000000 -0500
@@ -1,5 +1,7 @@
 # $Header: /cvsroot/pgsql/contrib/lo/Makefile,v 1.11 2001/09/06 10:49:29 petere Exp $
 
+DLTYPE = bundle
+
 subdir = contrib/lo
 top_builddir = ../..
 include $(top_builddir)/src/Makefile.global
--- postgresql-7.3.18/contrib/ltree/Makefile	2002-11-01 18:16:52.000000000 -0500
+++ postgresql-7.3.18-new/contrib/ltree/Makefile	2007-02-05 11:07:20.000000000 -0500
@@ -1,3 +1,5 @@
+DLTYPE = bundle
+
 subdir = contrib/ltree
 top_builddir = ../..
 include $(top_builddir)/src/Makefile.global
--- postgresql-7.3.18/contrib/miscutil/Makefile	2001-09-06 06:49:29.000000000 -0400
+++ postgresql-7.3.18-new/contrib/miscutil/Makefile	2007-02-05 11:07:20.000000000 -0500
@@ -1,5 +1,7 @@
 # $Header: /cvsroot/pgsql/contrib/miscutil/Attic/Makefile,v 1.16 2001/09/06 10:49:29 petere Exp $
 
+DLTYPE = bundle
+
 subdir = contrib/miscutil
 top_builddir = ../..
 include $(top_builddir)/src/Makefile.global
--- postgresql-7.3.18/contrib/noupdate/Makefile	2001-09-06 06:49:29.000000000 -0400
+++ postgresql-7.3.18-new/contrib/noupdate/Makefile	2007-02-05 11:07:20.000000000 -0500
@@ -1,5 +1,7 @@
 # $Header: /cvsroot/pgsql/contrib/noupdate/Attic/Makefile,v 1.9 2001/09/06 10:49:29 petere Exp $
 
+DLTYPE = bundle
+
 subdir = contrib/noupdate
 top_builddir = ../..
 include $(top_builddir)/src/Makefile.global
--- postgresql-7.3.18/contrib/pgcrypto/Makefile	2001-09-30 18:18:29.000000000 -0400
+++ postgresql-7.3.18-new/contrib/pgcrypto/Makefile	2007-02-05 11:07:20.000000000 -0500
@@ -2,6 +2,9 @@
 # $Header: /cvsroot/pgsql/contrib/pgcrypto/Makefile,v 1.9 2001/09/30 22:18:29 momjian Exp $
 #
 
+DLTYPE = bundle
+
+
 subdir = contrib/pgcrypto
 top_builddir = ../..
 include $(top_builddir)/src/Makefile.global
--- postgresql-7.3.18/contrib/pgstattuple/Makefile	2001-09-30 21:52:38.000000000 -0400
+++ postgresql-7.3.18-new/contrib/pgstattuple/Makefile	2007-02-05 11:07:21.000000000 -0500
@@ -6,6 +6,8 @@
 #
 #-------------------------------------------------------------------------
 
+DLTYPE = bundle
+
 subdir = contrib/pgstattuple
 top_builddir = ../..
 include $(top_builddir)/src/Makefile.global
--- postgresql-7.3.18/contrib/rserv/Makefile	2002-11-01 18:45:37.000000000 -0500
+++ postgresql-7.3.18-new/contrib/rserv/Makefile	2007-02-05 11:07:21.000000000 -0500
@@ -1,6 +1,8 @@
 # Makefile for erServer demonstration implementation
 # (c) 2000 Vadim Mikheev, PostgreSQL Inc.
 
+DLTYPE = bundle
+
 subdir = contrib/rserv
 top_builddir = ../..
 include $(top_builddir)/src/Makefile.global
--- postgresql-7.3.18/contrib/rtree_gist/Makefile	2001-09-06 06:49:30.000000000 -0400
+++ postgresql-7.3.18-new/contrib/rtree_gist/Makefile	2007-02-05 11:07:21.000000000 -0500
@@ -1,5 +1,7 @@
 # $Header: /cvsroot/pgsql/contrib/rtree_gist/Attic/Makefile,v 1.3 2001/09/06 10:49:30 petere Exp $
 
+DLTYPE = bundle
+
 subdir = contrib/rtree_gist
 top_builddir = ../..
 include $(top_builddir)/src/Makefile.global
--- postgresql-7.3.18/contrib/seg/Makefile	2003-01-31 15:58:28.000000000 -0500
+++ postgresql-7.3.18-new/contrib/seg/Makefile	2007-02-05 11:07:21.000000000 -0500
@@ -1,5 +1,7 @@
 # $Header: /cvsroot/pgsql/contrib/seg/Makefile,v 1.7.2.1 2003/01/31 20:58:28 tgl Exp $
 
+DLTYPE = bundle
+
 subdir = contrib/seg
 top_builddir = ../..
 include $(top_builddir)/src/Makefile.global
--- postgresql-7.3.18/contrib/spi/Makefile	2002-10-03 14:40:02.000000000 -0400
+++ postgresql-7.3.18-new/contrib/spi/Makefile	2007-02-05 11:07:21.000000000 -0500
@@ -1,5 +1,7 @@
 # $Header: /cvsroot/pgsql/contrib/spi/Makefile,v 1.22 2002/10/03 18:40:02 tgl Exp $
 
+DLTYPE = bundle
+
 subdir = contrib/spi
 top_builddir = ../..
 include $(top_builddir)/src/Makefile.global
--- postgresql-7.3.18/contrib/string/Makefile	2001-09-06 06:49:30.000000000 -0400
+++ postgresql-7.3.18-new/contrib/string/Makefile	2007-02-05 11:07:21.000000000 -0500
@@ -1,5 +1,7 @@
 # $Header: /cvsroot/pgsql/contrib/string/Attic/Makefile,v 1.16 2001/09/06 10:49:30 petere Exp $
 
+DLTYPE = bundle
+
 subdir = contrib/string
 top_builddir = ../..
 include $(top_builddir)/src/Makefile.global
--- postgresql-7.3.18/contrib/tablefunc/Makefile	2002-09-11 20:14:40.000000000 -0400
+++ postgresql-7.3.18-new/contrib/tablefunc/Makefile	2007-02-05 11:07:21.000000000 -0500
@@ -1,3 +1,5 @@
+DLTYPE = bundle
+
 subdir = contrib/tablefunc
 top_builddir = ../..
 include $(top_builddir)/src/Makefile.global
--- postgresql-7.3.18/contrib/tsearch/Makefile	2002-11-01 18:23:29.000000000 -0500
+++ postgresql-7.3.18-new/contrib/tsearch/Makefile	2007-02-05 11:07:21.000000000 -0500
@@ -1,5 +1,7 @@
 # $Header: /cvsroot/pgsql/contrib/tsearch/Attic/Makefile,v 1.3 2002/11/01 23:23:29 tgl Exp $
 
+DLTYPE = bundle
+
 subdir = contrib/tsearch
 top_builddir = ../..
 include $(top_builddir)/src/Makefile.global
--- postgresql-7.3.18/contrib/userlock/Makefile	2001-09-06 06:49:30.000000000 -0400
+++ postgresql-7.3.18-new/contrib/userlock/Makefile	2007-02-05 11:07:21.000000000 -0500
@@ -1,5 +1,7 @@
 # $Header: /cvsroot/pgsql/contrib/userlock/Attic/Makefile,v 1.16 2001/09/06 10:49:30 petere Exp $
 
+DLTYPE = bundle
+
 subdir = contrib/userlock
 top_builddir = ../..
 include $(top_builddir)/src/Makefile.global
--- postgresql-7.3.18/contrib/xml/Makefile	2002-10-22 16:03:09.000000000 -0400
+++ postgresql-7.3.18-new/contrib/xml/Makefile	2007-02-05 11:07:21.000000000 -0500
@@ -1,5 +1,7 @@
 # $Header: /cvsroot/pgsql/contrib/xml/Attic/Makefile,v 1.3 2002/10/22 20:03:09 petere Exp $
 
+DLTYPE = bundle
+
 subdir = contrib/xml
 top_builddir = ../..
 include $(top_builddir)/src/Makefile.global
--- postgresql-7.3.18/pgsql.sh	1969-12-31 19:00:00.000000000 -0500
+++ postgresql-7.3.18-new/pgsql.sh	2007-02-05 11:07:21.000000000 -0500
@@ -0,0 +1,65 @@
+#!/bin/sh
+
+die () {
+	echo "failed"
+	echo ""
+	echo "*** bailing because an error ocurred:"
+	echo ""
+	echo "$*"
+	exit 1
+}
+
+PREFIX="@INSTPREFIX@"
+DATADIR="${PREFIX}/var/postgresql/data"
+LOGFILE="${PREFIX}/var/postgresql/pgsql.log"
+
+export LANG=C
+unset LC_ALL
+
+SHMMAX=`sysctl kern.sysv.shmmax | cut -d' ' -f2-`
+SHMMNI=`sysctl kern.sysv.shmmni | cut -d' ' -f2-`
+SHMALL=`sysctl kern.sysv.shmall | cut -d' ' -f2-`
+
+if [ "$SHMMAX" -lt "8388608" ] || [ "$SHMMNI" -lt "64" ] || [ "$SHMALL" -lt "32768" ]; then
+	echo "ERROR: You must set your shared memory resources higher for PostgreSQL to function."
+	if [ -f /etc/sysctl.conf ]; then
+		echo "       You already have an /etc/sysctl.conf so I'm assuming you know what you're"
+		echo "       doing.  Please update your shared memory settings to something higher and"
+		echo "       give it another shot."
+	else
+		echo "       I am creating a default configuration in /etc/sysctl.conf that should let"
+		echo "       you start PostgreSQL, but it's probably best if you tune it yourself when"
+		echo "       I'm done.  You will have to reboot before it will take effect."
+		cat <<END >/etc/sysctl.conf
+kern.sysv.shmmax=8388608
+kern.sysv.shmmin=1
+kern.sysv.shmmni=64
+kern.sysv.shmseg=8
+kern.sysv.shmall=32768
+END
+	fi
+#	exit 1
+fi
+
+if [ ! -d "$DATADIR" ]; then
+	echo -e "- making postgresql directories: \c"
+	sudo mkdir -p "$DATADIR"
+	sudo chown -R postgres "$DATADIR/.."
+	echo "ok"
+
+	echo -e "- initializing database in $DATADIR: \c"
+	sudo -u postgres ${PREFIX}/bin/initdb-7.3 -D "$DATADIR" >/tmp/pgsql-init-7.3.log 2>&1 || die "couldn't initialize database"
+	echo "ok"
+fi
+
+case "$1" in
+	start)
+		unset LC_ALL; LANG=C sudo -u postgres "${PREFIX}/bin/pg_ctl-7.3" start -D "$DATADIR" -l "$LOGFILE"
+		;;
+	restart)
+		unset LC_ALL; LANG=C sudo -u postgres "${PREFIX}/bin/pg_ctl-7.3" restart -D "$DATADIR" -m fast
+		;;
+	stop)
+		unset LC_ALL; LANG=C sudo -u postgres "${PREFIX}/bin/pg_ctl-7.3" stop -D "$DATADIR" -m fast
+		;;
+esac
--- postgresql-7.3.18/src/Makefile.shlib	2003-01-11 12:22:34.000000000 -0500
+++ postgresql-7.3.18-new/src/Makefile.shlib	2007-02-05 11:07:21.000000000 -0500
@@ -81,8 +81,24 @@
 endif
 
 ifeq ($(PORTNAME), darwin)
-  shlib			:= lib$(NAME)$(DLSUFFIX).$(SO_MAJOR_VERSION).$(SO_MINOR_VERSION)
-  LINK.shared		= $(COMPILER) $(DARWIN_NAMESPACE_SPEC) -bundle -undefined suppress
+  ifeq (,$(filter $(host_os), darwin1.0 darwin1.1 darwin1.2))
+     DARWIN_LINKFLAGS	=
+  else
+     DARWIN_LINKFLAGS	= -multiply_defined suppress
+  endif
+
+  shlib			:= lib$(NAME).$(SO_MAJOR_VERSION).$(SO_MINOR_VERSION)$(DLSUFFIX)
+  ifneq ($(SO_MAJOR_VERSION), 0)
+    version_link	:= -compatibility_version $(SO_MAJOR_VERSION) -current_version $(SO_MAJOR_VERSION).$(SO_MINOR_VERSION)
+  endif
+  ifeq ($(DLTYPE), bundle)
+    DLSUFFIX		:= .so
+    LINK.shared		= $(COMPILER) $(DARWIN_NAMESPACE_SPEC) -bundle -undefined suppress -flat_namespace
+  else
+    DLSUFFIX		:= .dylib
+    LINK.shared		= $(COMPILER) $(DARWIN_NAMESPACE_SPEC) -install_name $(libdir)/lib$(NAME).$(SO_MAJOR_VERSION)$(DLSUFFIX) $(version_link) -dynamiclib $(DARWIN_LINKFLAGS)
+  endif
+  SHLIB_LINK		:= -L$(libpq_builddir) $(SHLIB_LINK)
 endif
 
 ifeq ($(PORTNAME), openbsd)
@@ -246,6 +262,7 @@
 ifneq ($(PORTNAME), beos)
 ifneq ($(PORTNAME), win)
 ifneq ($(PORTNAME), aix)
+ifneq ($(PORTNAME), darwin)
 
 # Normal case
 $(shlib): $(OBJS)
@@ -261,6 +278,25 @@
 	$(LN_S) $(shlib) lib$(NAME)$(DLSUFFIX)
 endif
 
+else # PORTNAME == darwin
+
+# Darwin case
+# (same as normal case, but libfoo.version.suffix)
+
+$(shlib): $(OBJS)
+	$(LINK.shared) $(OBJS) $(SHLIB_LINK) -o $@
+ifneq ($(shlib), lib$(NAME).$(SO_MAJOR_VERSION)$(DLSUFFIX))
+	rm -f lib$(NAME).$(SO_MAJOR_VERSION)$(DLSUFFIX)
+	$(LN_S) $(shlib) lib$(NAME).$(SO_MAJOR_VERSION)$(DLSUFFIX)
+endif
+
+ifneq ($(shlib), lib$(NAME)$(DLSUFFIX))
+	rm -f lib$(NAME)$(DLSUFFIX)
+	$(LN_S) $(shlib) lib$(NAME)$(DLSUFFIX)
+endif
+
+endif # PORTNAME == darwin
+
 else # PORTNAME == aix
 
 # AIX case
@@ -308,7 +344,10 @@
 ifeq ($(enable_shared), yes)
 install-lib-shared: $(shlib)
 	$(INSTALL_SHLIB) $< $(DESTDIR)$(libdir)/$(shlib)
+
 ifneq ($(PORTNAME), win)
+ifneq ($(PORTNAME), darwin)
+
 ifneq ($(shlib), lib$(NAME)$(DLSUFFIX).$(SO_MAJOR_VERSION))
 	cd $(DESTDIR)$(libdir) && \
 	rm -f lib$(NAME)$(DLSUFFIX).$(SO_MAJOR_VERSION) && \
@@ -320,7 +359,23 @@
 	$(LN_S) $(shlib) lib$(NAME)$(DLSUFFIX)
 endif
 
-endif # not win
+else # PORTNAME == darwin
+
+ifneq ($(shlib), lib$(NAME).$(SO_MAJOR_VERSION)$(DLSUFFIX))
+	cd $(DESTDIR)$(libdir) && \
+	rm -f lib$(NAME).$(SO_MAJOR_VERSION)$(DLSUFFIX) && \
+	$(LN_S) $(shlib) lib$(NAME).$(SO_MAJOR_VERSION)$(DLSUFFIX)
+endif
+ifneq ($(shlib), lib$(NAME)$(DLSUFFIX))
+	cd $(DESTDIR)$(libdir) && \
+	rm -f lib$(NAME)$(DLSUFFIX) && \
+	$(LN_S) $(shlib) lib$(NAME)$(DLSUFFIX)
+endif
+
+endif # PORTNAME == darwin
+
+endif # PORTNAME == win
+
 endif # enable_shared
 
 
@@ -334,7 +389,9 @@
 ifeq ($(enable_shared), yes)
 	rm -f $(DESTDIR)$(libdir)/lib$(NAME)$(DLSUFFIX) \
 	  $(DESTDIR)$(libdir)/lib$(NAME)$(DLSUFFIX).$(SO_MAJOR_VERSION) \
-	  $(DESTDIR)$(libdir)/lib$(NAME)$(DLSUFFIX).$(SO_MAJOR_VERSION).$(SO_MINOR_VERSION)
+	  $(DESTDIR)$(libdir)/lib$(NAME)$(DLSUFFIX).$(SO_MAJOR_VERSION).$(SO_MINOR_VERSION) \
+	  $(DESTDIR)$(libdir)/lib$(NAME).$(SO_MAJOR_VERSION)$(DLSUFFIX) \
+	  $(DESTDIR)$(libdir)/lib$(NAME).$(SO_MAJOR_VERSION).$(SO_MINOR_VERSION)$(DLSUFFIX)
 endif # enable_shared
 
 
@@ -346,7 +403,7 @@
 clean-lib:
 	rm -f lib$(NAME).a
 ifeq ($(enable_shared), yes)
-	rm -f lib$(NAME)$(DLSUFFIX) lib$(NAME)$(DLSUFFIX).$(SO_MAJOR_VERSION) lib$(NAME)$(DLSUFFIX).$(SO_MAJOR_VERSION).$(SO_MINOR_VERSION)
+	rm -f lib$(NAME)$(DLSUFFIX) lib$(NAME)$(DLSUFFIX).$(SO_MAJOR_VERSION) lib$(NAME)$(DLSUFFIX).$(SO_MAJOR_VERSION).$(SO_MINOR_VERSION) lib$(NAME).$(SO_MAJOR_VERSION)$(DLSUFFIX) lib$(NAME).$(SO_MAJOR_VERSION).$(SO_MINOR_VERSION)$(DLSUFFIX)
 ifdef EXPSUFF
 	rm -f lib$(NAME)$(EXPSUFF)
 endif
--- postgresql-7.3.18/src/backend/libpq/auth.c	2002-09-04 19:31:34.000000000 -0400
+++ postgresql-7.3.18-new/src/backend/libpq/auth.c	2007-02-05 11:07:21.000000000 -0500
@@ -42,7 +42,12 @@
 char	   *pg_krb_server_keyfile;
 
 #ifdef USE_PAM
+
+#ifdef HAVE_PAM_PAM_APPL_H
+#include <pam/pam_appl.h>
+#else
 #include <security/pam_appl.h>
+#endif
 
 #define PGSQL_PAM_SERVICE "postgresql"	/* Service name passed to PAM */
 
--- postgresql-7.3.18/src/backend/main/main.c	2006-01-04 19:55:36.000000000 -0500
+++ postgresql-7.3.18-new/src/backend/main/main.c	2007-02-05 11:07:21.000000000 -0500
@@ -51,6 +51,7 @@
 	int			len;
 	struct passwd *pw;
 	char	   *pw_name_persist;
+	char	   *progname;
 
 	/*
 	 * Place platform-specific startup hacks here.	This is the right
@@ -210,9 +211,27 @@
 	 * argument) we were called with.  The lack of consistency here is
 	 * historical.
 	 */
-	len = strlen(new_argv[0]);
 
-	if (len >= 10 && strcmp(new_argv[0] + len - 10, "postmaster") == 0)
+	/*
+	 * Find the program name, which is after the final slash in the
+	 * program argument.
+	 */
+	progname = strrchr(new_argv[0], '/');
+	if (progname != NULL)
+	{
+		progname = progname + 1;
+        } 
+	else 
+	{
+		progname = new_argv[0];
+	}
+
+	/*
+	 * Now check if the program name starts with the
+	 * word "postmaster", in which case PostmasterMain is called.
+	 */
+	len = strlen(progname);
+	if (len >= 10 && strncmp(progname, "postmaster", 10) == 0)
 	{
 		/* Called as "postmaster" */
 		exit(PostmasterMain(argc, new_argv));
--- postgresql-7.3.18/src/backend/postmaster/postmaster.c	2003-02-22 23:48:38.000000000 -0500
+++ postgresql-7.3.18-new/src/backend/postmaster/postmaster.c	2007-02-05 11:07:21.000000000 -0500
@@ -85,6 +85,10 @@
 #include <getopt.h>
 #endif
 
+#ifdef HAVE_RENDEZVOUS
+#include <DNSServiceDiscovery/DNSServiceDiscovery.h>
+#endif
+
 #include "catalog/pg_database.h"
 #include "commands/async.h"
 #include "lib/dllist.h"
@@ -203,6 +207,10 @@
 bool		Log_connections = false;
 bool		Db_user_namespace = false;
 
+#ifdef HAVE_RENDEZVOUS
+/* service name */
+char		*service_name = NULL;
+#endif
 
 /* Startup/shutdown state */
 static pid_t StartupPID = 0,
@@ -354,6 +362,17 @@
 }
 
 
+#ifdef HAVE_RENDEZVOUS
+
+/* reg_reply -- empty callback function for DNSServiceRegistrationCreate() */
+static void
+reg_reply(DNSServiceRegistrationReplyErrorType errorCode, void *context)
+{
+
+}
+
+#endif
+
 int
 PostmasterMain(int argc, char *argv[])
 {
@@ -684,6 +703,21 @@
 		{
 			postmaster_error("cannot create INET stream port");
 			ExitPostmaster(1);
+                } else {
+#ifdef HAVE_RENDEZVOUS
+                    /* Rendezvous, baby! */
+                    
+                    if (service_name != NULL)
+                    {
+                        DNSServiceRegistrationCreate(service_name,
+                                "_pgsql._tcp.",
+                                "",
+                                htonl(PostPortNumber),
+                                "",
+                                (DNSServiceRegistrationReply)reg_reply,
+                                NULL);
+                    }
+#endif
 		}
 	}
 
--- postgresql-7.3.18/src/backend/utils/fmgr/dfmgr.c	2002-09-01 22:47:05.000000000 -0400
+++ postgresql-7.3.18-new/src/backend/utils/fmgr/dfmgr.c	2007-02-05 11:07:21.000000000 -0500
@@ -287,6 +287,26 @@
 		pfree(full);
 	}
 
+	new = palloc(strlen(name) + strlen(".so") + 1);
+	strcpy(new, name);
+	strcat(new, ".so");
+
+	if (!have_slash)
+	{
+		full = find_in_dynamic_libpath(new);
+		pfree(new);
+		if (full)
+			return full;
+	}
+	else
+	{
+		full = substitute_libpath_macro(new);
+		pfree(new);
+		if (file_exists(full))
+			return full;
+		pfree(full);
+	}
+
 	new = palloc(strlen(name) + strlen(DLSUFFIX) + 1);
 	strcpy(new, name);
 	strcat(new, DLSUFFIX);
--- postgresql-7.3.18/src/backend/utils/mb/conversion_procs/ascii_and_mic/Makefile	2002-08-21 22:18:45.000000000 -0400
+++ postgresql-7.3.18-new/src/backend/utils/mb/conversion_procs/ascii_and_mic/Makefile	2007-02-05 11:07:21.000000000 -0500
@@ -3,6 +3,9 @@
 # $Id: Makefile,v 1.3 2002/08/22 02:18:45 momjian Exp $
 #
 #-------------------------------------------------------------------------
+
+DLTYPE = bundle
+
 subdir = src/backend/utils/mb/conversion_procs/ascii_and_mic
 top_builddir = ../../../../../..
 include $(top_builddir)/src/Makefile.global
--- postgresql-7.3.18/src/backend/utils/mb/conversion_procs/cyrillic_and_mic/Makefile	2002-08-21 17:33:55.000000000 -0400
+++ postgresql-7.3.18-new/src/backend/utils/mb/conversion_procs/cyrillic_and_mic/Makefile	2007-02-05 11:07:21.000000000 -0500
@@ -3,6 +3,9 @@
 # $Id: Makefile,v 1.2 2002/08/21 21:33:55 momjian Exp $
 #
 #-------------------------------------------------------------------------
+
+DLTYPE = bundle
+
 subdir = src/backend/utils/mb/conversion_procs/cyrillic_and_mic
 top_builddir = ../../../../../..
 include $(top_builddir)/src/Makefile.global
--- postgresql-7.3.18/src/backend/utils/mb/conversion_procs/euc_cn_and_mic/Makefile	2002-08-21 17:33:55.000000000 -0400
+++ postgresql-7.3.18-new/src/backend/utils/mb/conversion_procs/euc_cn_and_mic/Makefile	2007-02-05 11:07:22.000000000 -0500
@@ -3,6 +3,9 @@
 # $Id: Makefile,v 1.2 2002/08/21 21:33:55 momjian Exp $
 #
 #-------------------------------------------------------------------------
+
+DLTYPE = bundle
+
 subdir = src/backend/utils/mb/conversion_procs/euc_cn_and_mic
 top_builddir = ../../../../../..
 include $(top_builddir)/src/Makefile.global
--- postgresql-7.3.18/src/backend/utils/mb/conversion_procs/euc_jp_and_sjis/Makefile	2002-08-21 17:33:55.000000000 -0400
+++ postgresql-7.3.18-new/src/backend/utils/mb/conversion_procs/euc_jp_and_sjis/Makefile	2007-02-05 11:07:22.000000000 -0500
@@ -3,6 +3,9 @@
 # $Id: Makefile,v 1.2 2002/08/21 21:33:55 momjian Exp $
 #
 #-------------------------------------------------------------------------
+
+DLTYPE = bundle
+
 subdir = src/backend/utils/mb/conversion_procs/euc_jp_and_sjis
 top_builddir = ../../../../../..
 include $(top_builddir)/src/Makefile.global
--- postgresql-7.3.18/src/backend/utils/mb/conversion_procs/euc_kr_and_mic/Makefile	2002-08-21 17:33:55.000000000 -0400
+++ postgresql-7.3.18-new/src/backend/utils/mb/conversion_procs/euc_kr_and_mic/Makefile	2007-02-05 11:07:22.000000000 -0500
@@ -3,6 +3,9 @@
 # $Id: Makefile,v 1.2 2002/08/21 21:33:55 momjian Exp $
 #
 #-------------------------------------------------------------------------
+
+DLTYPE = bundle
+
 subdir = src/backend/utils/mb/conversion_procs/euc_kr_and_mic
 top_builddir = ../../../../../..
 include $(top_builddir)/src/Makefile.global
--- postgresql-7.3.18/src/backend/utils/mb/conversion_procs/euc_tw_and_big5/Makefile	2002-08-21 17:33:55.000000000 -0400
+++ postgresql-7.3.18-new/src/backend/utils/mb/conversion_procs/euc_tw_and_big5/Makefile	2007-02-05 11:07:22.000000000 -0500
@@ -3,6 +3,9 @@
 # $Id: Makefile,v 1.2 2002/08/21 21:33:55 momjian Exp $
 #
 #-------------------------------------------------------------------------
+
+DLTYPE = bundle
+
 subdir = src/backend/utils/mb/conversion_procs/euc_tw_and_big5
 top_builddir = ../../../../../..
 include $(top_builddir)/src/Makefile.global
--- postgresql-7.3.18/src/backend/utils/mb/conversion_procs/latin2_and_win1250/Makefile	2002-08-21 17:33:55.000000000 -0400
+++ postgresql-7.3.18-new/src/backend/utils/mb/conversion_procs/latin2_and_win1250/Makefile	2007-02-05 11:07:22.000000000 -0500
@@ -3,6 +3,9 @@
 # $Id: Makefile,v 1.2 2002/08/21 21:33:55 momjian Exp $
 #
 #-------------------------------------------------------------------------
+
+DLTYPE = bundle
+
 subdir = src/backend/utils/mb/conversion_procs/latin2_and_win1250
 top_builddir = ../../../../../..
 include $(top_builddir)/src/Makefile.global
--- postgresql-7.3.18/src/backend/utils/mb/conversion_procs/latin_and_mic/Makefile	2002-08-21 17:33:55.000000000 -0400
+++ postgresql-7.3.18-new/src/backend/utils/mb/conversion_procs/latin_and_mic/Makefile	2007-02-05 11:07:22.000000000 -0500
@@ -3,6 +3,9 @@
 # $Id: Makefile,v 1.2 2002/08/21 21:33:55 momjian Exp $
 #
 #-------------------------------------------------------------------------
+
+DLTYPE = bundle
+
 subdir = src/backend/utils/mb/conversion_procs/latin_and_mic
 top_builddir = ../../../../../..
 include $(top_builddir)/src/Makefile.global
--- postgresql-7.3.18/src/backend/utils/mb/conversion_procs/proc.mk	2002-09-05 14:28:46.000000000 -0400
+++ postgresql-7.3.18-new/src/backend/utils/mb/conversion_procs/proc.mk	2007-02-05 11:07:22.000000000 -0500
@@ -1,6 +1,7 @@
 SRCS		+= $(NAME).c
 OBJS		+= $(NAME).o
 
+DLTYPE		= bundle
 SHLIB_LINK 	:= $(BE_DLLLIBS)
 
 SO_MAJOR_VERSION := 0
--- postgresql-7.3.18/src/backend/utils/mb/conversion_procs/utf8_and_ascii/Makefile	2002-08-21 17:33:55.000000000 -0400
+++ postgresql-7.3.18-new/src/backend/utils/mb/conversion_procs/utf8_and_ascii/Makefile	2007-02-05 11:07:22.000000000 -0500
@@ -3,6 +3,9 @@
 # $Id: Makefile,v 1.2 2002/08/21 21:33:55 momjian Exp $
 #
 #-------------------------------------------------------------------------
+
+DLTYPE = bundle
+
 subdir = src/backend/utils/mb/conversion_procs/utf8_and_ascii
 top_builddir = ../../../../../..
 include $(top_builddir)/src/Makefile.global
--- postgresql-7.3.18/src/backend/utils/mb/conversion_procs/utf8_and_big5/Makefile	2002-08-21 17:33:55.000000000 -0400
+++ postgresql-7.3.18-new/src/backend/utils/mb/conversion_procs/utf8_and_big5/Makefile	2007-02-05 11:07:22.000000000 -0500
@@ -3,6 +3,9 @@
 # $Id: Makefile,v 1.2 2002/08/21 21:33:55 momjian Exp $
 #
 #-------------------------------------------------------------------------
+
+DLTYPE = bundle
+
 subdir = src/backend/utils/mb/conversion_procs/utf8_and_big5
 top_builddir = ../../../../../..
 include $(top_builddir)/src/Makefile.global
--- postgresql-7.3.18/src/backend/utils/mb/conversion_procs/utf8_and_cyrillic/Makefile	2002-08-21 17:33:55.000000000 -0400
+++ postgresql-7.3.18-new/src/backend/utils/mb/conversion_procs/utf8_and_cyrillic/Makefile	2007-02-05 11:07:22.000000000 -0500
@@ -3,6 +3,9 @@
 # $Id: Makefile,v 1.2 2002/08/21 21:33:55 momjian Exp $
 #
 #-------------------------------------------------------------------------
+
+DLTYPE = bundle
+
 subdir = src/backend/utils/mb/conversion_procs/utf8_and_cyrillic
 top_builddir = ../../../../../..
 include $(top_builddir)/src/Makefile.global
--- postgresql-7.3.18/src/backend/utils/mb/conversion_procs/utf8_and_euc_cn/Makefile	2002-08-21 17:33:55.000000000 -0400
+++ postgresql-7.3.18-new/src/backend/utils/mb/conversion_procs/utf8_and_euc_cn/Makefile	2007-02-05 11:07:22.000000000 -0500
@@ -3,6 +3,9 @@
 # $Id: Makefile,v 1.2 2002/08/21 21:33:55 momjian Exp $
 #
 #-------------------------------------------------------------------------
+
+DLTYPE = bundle
+
 subdir = src/backend/utils/mb/conversion_procs/utf8_and_euc_cn
 top_builddir = ../../../../../..
 include $(top_builddir)/src/Makefile.global
--- postgresql-7.3.18/src/backend/utils/mb/conversion_procs/utf8_and_euc_jp/Makefile	2002-08-21 17:33:55.000000000 -0400
+++ postgresql-7.3.18-new/src/backend/utils/mb/conversion_procs/utf8_and_euc_jp/Makefile	2007-02-05 11:07:22.000000000 -0500
@@ -3,6 +3,9 @@
 # $Id: Makefile,v 1.2 2002/08/21 21:33:55 momjian Exp $
 #
 #-------------------------------------------------------------------------
+
+DLTYPE = bundle
+
 subdir = src/backend/utils/mb/conversion_procs/utf8_and_euc_jp
 top_builddir = ../../../../../..
 include $(top_builddir)/src/Makefile.global
--- postgresql-7.3.18/src/backend/utils/mb/conversion_procs/utf8_and_euc_kr/Makefile	2002-08-21 17:33:55.000000000 -0400
+++ postgresql-7.3.18-new/src/backend/utils/mb/conversion_procs/utf8_and_euc_kr/Makefile	2007-02-05 11:07:22.000000000 -0500
@@ -3,6 +3,9 @@
 # $Id: Makefile,v 1.2 2002/08/21 21:33:55 momjian Exp $
 #
 #-------------------------------------------------------------------------
+
+DLTYPE = bundle
+
 subdir = src/backend/utils/mb/conversion_procs/utf8_and_euc_kr
 top_builddir = ../../../../../..
 include $(top_builddir)/src/Makefile.global
--- postgresql-7.3.18/src/backend/utils/mb/conversion_procs/utf8_and_euc_tw/Makefile	2002-08-21 17:33:55.000000000 -0400
+++ postgresql-7.3.18-new/src/backend/utils/mb/conversion_procs/utf8_and_euc_tw/Makefile	2007-02-05 11:07:22.000000000 -0500
@@ -3,6 +3,9 @@
 # $Id: Makefile,v 1.2 2002/08/21 21:33:55 momjian Exp $
 #
 #-------------------------------------------------------------------------
+
+DLTYPE = bundle
+
 subdir = src/backend/utils/mb/conversion_procs/utf8_and_euc_tw
 top_builddir = ../../../../../..
 include $(top_builddir)/src/Makefile.global
--- postgresql-7.3.18/src/backend/utils/mb/conversion_procs/utf8_and_gb18030/Makefile	2002-08-21 17:33:55.000000000 -0400
+++ postgresql-7.3.18-new/src/backend/utils/mb/conversion_procs/utf8_and_gb18030/Makefile	2007-02-05 11:07:22.000000000 -0500
@@ -3,6 +3,9 @@
 # $Id: Makefile,v 1.2 2002/08/21 21:33:55 momjian Exp $
 #
 #-------------------------------------------------------------------------
+
+DLTYPE = bundle
+
 subdir = src/backend/utils/mb/conversion_procs/utf8_and_gb18030
 top_builddir = ../../../../../..
 include $(top_builddir)/src/Makefile.global
--- postgresql-7.3.18/src/backend/utils/mb/conversion_procs/utf8_and_gbk/Makefile	2002-08-21 17:33:55.000000000 -0400
+++ postgresql-7.3.18-new/src/backend/utils/mb/conversion_procs/utf8_and_gbk/Makefile	2007-02-05 11:07:22.000000000 -0500
@@ -3,6 +3,9 @@
 # $Id: Makefile,v 1.2 2002/08/21 21:33:55 momjian Exp $
 #
 #-------------------------------------------------------------------------
+
+DLTYPE = bundle
+
 subdir = src/backend/utils/mb/conversion_procs/utf8_and_gbk
 top_builddir = ../../../../../..
 include $(top_builddir)/src/Makefile.global
--- postgresql-7.3.18/src/backend/utils/mb/conversion_procs/utf8_and_iso8859/Makefile	2002-08-21 17:33:55.000000000 -0400
+++ postgresql-7.3.18-new/src/backend/utils/mb/conversion_procs/utf8_and_iso8859/Makefile	2007-02-05 11:07:22.000000000 -0500
@@ -3,6 +3,9 @@
 # $Id: Makefile,v 1.2 2002/08/21 21:33:55 momjian Exp $
 #
 #-------------------------------------------------------------------------
+
+DLTYPE = bundle
+
 subdir = src/backend/utils/mb/conversion_procs/utf8_and_iso8859
 top_builddir = ../../../../../..
 include $(top_builddir)/src/Makefile.global
--- postgresql-7.3.18/src/backend/utils/mb/conversion_procs/utf8_and_iso8859_1/Makefile	2002-08-21 17:33:55.000000000 -0400
+++ postgresql-7.3.18-new/src/backend/utils/mb/conversion_procs/utf8_and_iso8859_1/Makefile	2007-02-05 11:07:22.000000000 -0500
@@ -3,6 +3,9 @@
 # $Id: Makefile,v 1.2 2002/08/21 21:33:55 momjian Exp $
 #
 #-------------------------------------------------------------------------
+
+DLTYPE = bundle
+
 subdir = src/backend/utils/mb/conversion_procs/utf8_and_iso8859_1
 top_builddir = ../../../../../..
 include $(top_builddir)/src/Makefile.global
--- postgresql-7.3.18/src/backend/utils/mb/conversion_procs/utf8_and_johab/Makefile	2002-08-21 17:33:55.000000000 -0400
+++ postgresql-7.3.18-new/src/backend/utils/mb/conversion_procs/utf8_and_johab/Makefile	2007-02-05 11:07:22.000000000 -0500
@@ -3,6 +3,9 @@
 # $Id: Makefile,v 1.2 2002/08/21 21:33:55 momjian Exp $
 #
 #-------------------------------------------------------------------------
+
+DLTYPE = bundle
+
 subdir = src/backend/utils/mb/conversion_procs/utf8_and_johab
 top_builddir = ../../../../../..
 include $(top_builddir)/src/Makefile.global
--- postgresql-7.3.18/src/backend/utils/mb/conversion_procs/utf8_and_sjis/Makefile	2002-08-21 17:33:55.000000000 -0400
+++ postgresql-7.3.18-new/src/backend/utils/mb/conversion_procs/utf8_and_sjis/Makefile	2007-02-05 11:07:22.000000000 -0500
@@ -3,6 +3,9 @@
 # $Id: Makefile,v 1.2 2002/08/21 21:33:55 momjian Exp $
 #
 #-------------------------------------------------------------------------
+
+DLTYPE = bundle
+
 subdir = src/backend/utils/mb/conversion_procs/utf8_and_sjis
 top_builddir = ../../../../../..
 include $(top_builddir)/src/Makefile.global
--- postgresql-7.3.18/src/backend/utils/mb/conversion_procs/utf8_and_tcvn/Makefile	2002-08-21 17:33:55.000000000 -0400
+++ postgresql-7.3.18-new/src/backend/utils/mb/conversion_procs/utf8_and_tcvn/Makefile	2007-02-05 11:07:22.000000000 -0500
@@ -3,6 +3,9 @@
 # $Id: Makefile,v 1.2 2002/08/21 21:33:55 momjian Exp $
 #
 #-------------------------------------------------------------------------
+
+DLTYPE = bundle
+
 subdir = src/backend/utils/mb/conversion_procs/utf8_and_tcvn
 top_builddir = ../../../../../..
 include $(top_builddir)/src/Makefile.global
--- postgresql-7.3.18/src/backend/utils/mb/conversion_procs/utf8_and_uhc/Makefile	2002-08-21 17:33:55.000000000 -0400
+++ postgresql-7.3.18-new/src/backend/utils/mb/conversion_procs/utf8_and_uhc/Makefile	2007-02-05 11:07:22.000000000 -0500
@@ -3,6 +3,9 @@
 # $Id: Makefile,v 1.2 2002/08/21 21:33:55 momjian Exp $
 #
 #-------------------------------------------------------------------------
+
+DLTYPE = bundle
+
 subdir = src/backend/utils/mb/conversion_procs/utf8_and_uhc
 top_builddir = ../../../../../..
 include $(top_builddir)/src/Makefile.global
--- postgresql-7.3.18/src/backend/utils/mb/conversion_procs/utf8_and_win1250/Makefile	2002-08-21 17:33:55.000000000 -0400
+++ postgresql-7.3.18-new/src/backend/utils/mb/conversion_procs/utf8_and_win1250/Makefile	2007-02-05 11:07:22.000000000 -0500
@@ -3,6 +3,9 @@
 # $Id: Makefile,v 1.2 2002/08/21 21:33:55 momjian Exp $
 #
 #-------------------------------------------------------------------------
+
+DLTYPE = bundle
+
 subdir = src/backend/utils/mb/conversion_procs/utf8_and_win1250
 top_builddir = ../../../../../..
 include $(top_builddir)/src/Makefile.global
--- postgresql-7.3.18/src/backend/utils/mb/conversion_procs/utf8_and_win1256/Makefile	2002-08-21 17:33:55.000000000 -0400
+++ postgresql-7.3.18-new/src/backend/utils/mb/conversion_procs/utf8_and_win1256/Makefile	2007-02-05 11:07:22.000000000 -0500
@@ -3,6 +3,9 @@
 # $Id: Makefile,v 1.2 2002/08/21 21:33:55 momjian Exp $
 #
 #-------------------------------------------------------------------------
+
+DLTYPE = bundle
+
 subdir = src/backend/utils/mb/conversion_procs/utf8_and_win1256
 top_builddir = ../../../../../..
 include $(top_builddir)/src/Makefile.global
--- postgresql-7.3.18/src/backend/utils/mb/conversion_procs/utf8_and_win874/Makefile	2002-08-21 17:33:55.000000000 -0400
+++ postgresql-7.3.18-new/src/backend/utils/mb/conversion_procs/utf8_and_win874/Makefile	2007-02-05 11:07:22.000000000 -0500
@@ -3,6 +3,9 @@
 # $Id: Makefile,v 1.2 2002/08/21 21:33:55 momjian Exp $
 #
 #-------------------------------------------------------------------------
+
+DLTYPE = bundle
+
 subdir = src/backend/utils/mb/conversion_procs/utf8_and_win874
 top_builddir = ../../../../../..
 include $(top_builddir)/src/Makefile.global
--- postgresql-7.3.18/src/backend/utils/misc/guc.c	2006-05-21 16:12:20.000000000 -0400
+++ postgresql-7.3.18-new/src/backend/utils/misc/guc.c	2007-02-05 11:07:22.000000000 -0500
@@ -797,6 +797,13 @@
 		"C", locale_numeric_assign, NULL
 	},
 
+#ifdef HAVE_RENDEZVOUS
+	{
+		{"service_name", PGC_POSTMASTER}, &service_name,
+		NULL, NULL, NULL
+	},
+#endif
+
 	{
 		{"lc_time", PGC_USERSET}, &locale_time,
 		"C", locale_time_assign, NULL
@@ -848,12 +855,12 @@
 
 	{
 		{"unix_socket_group", PGC_POSTMASTER}, &Unix_socket_group,
-		"", NULL, NULL
+		"postgres", NULL, NULL
 	},
 
 	{
 		{"unix_socket_directory", PGC_POSTMASTER}, &UnixSocketDir,
-		"", NULL, NULL
+		"/tmp", NULL, NULL
 	},
 
 	{
--- postgresql-7.3.18/src/backend/utils/misc/postgresql.conf.sample	2006-05-21 16:12:20.000000000 -0400
+++ postgresql-7.3.18-new/src/backend/utils/misc/postgresql.conf.sample	2007-02-05 11:07:22.000000000 -0500
@@ -27,10 +27,10 @@
 #
 #	Connection Parameters
 #
-#tcpip_socket = false
-#ssl = false
+tcpip_socket = true
+ssl = false
 
-#max_connections = 32
+max_connections = 96
 #superuser_reserved_connections = 2
 
 #port = 5432 
@@ -49,7 +49,7 @@
 #
 #	Shared Memory Size
 #
-#shared_buffers = 64		# min max_connections*2 or 16, 8KB each
+shared_buffers = 192		# min max_connections*2 or 16, 8KB each
 #max_fsm_relations = 1000	# min 10, fsm is free space map, ~40 bytes
 #max_fsm_pages = 10000		# min 1000, fsm is free space map, ~6 bytes
 #max_locks_per_transaction = 64	# min 10
--- postgresql-7.3.18/src/bin/initdb/initdb.sh	2002-11-25 16:42:11.000000000 -0500
+++ postgresql-7.3.18-new/src/bin/initdb/initdb.sh	2007-02-05 11:07:22.000000000 -0500
@@ -122,20 +122,20 @@
 # their trees to backup places, so $bindir might be inaccurate.
 
 if [ x"$self_path" != x"" ] \
-  && [ -x "$self_path/postgres" ] \
-  && [ x"`$self_path/postgres -V 2>/dev/null`" = x"postgres (PostgreSQL) $VERSION" ]
+  && [ -x "$self_path/postgres-7.3" ] \
+  && [ x"`$self_path/postgres-7.3 -V 2>/dev/null`" = x"postgres (PostgreSQL) $VERSION" ]
 then
     PGPATH=$self_path
-elif [ -x "$bindir/postgres" ]; then
-    if [ x"`$bindir/postgres -V 2>/dev/null`" = x"postgres (PostgreSQL) $VERSION" ]
+elif [ -x "$bindir/postgres-7.3" ]; then
+    if [ x"`$bindir/postgres-7.3 -V 2>/dev/null`" = x"postgres (PostgreSQL) $VERSION" ]
     then
         PGPATH=$bindir
     else
         # Maybe there was an error message?
-        errormsg=`$bindir/postgres -V 2>&1 >/dev/null`
+        errormsg=`$bindir/postgres-7.3 -V 2>&1 >/dev/null`
       (
         echo "The program "
-        echo "    '$bindir/postgres'"
+        echo "    '$bindir/postgres-7.3'"
         echo "needed by $CMDNAME does not belong to PostgreSQL version $VERSION, or"
         echo "there may be a configuration problem."
         if test x"$errormsg" != x""; then
@@ -147,7 +147,7 @@
         exit 1
     fi
 else
-    echo "The program 'postgres' is needed by $CMDNAME but was not found in" 1>&2
+    echo "The program 'postgres-7.3' is needed by $CMDNAME but was not found in" 1>&2
     echo "the directory '$bindir'.  Check your installation." 1>&2
     exit 1
 fi
@@ -155,20 +155,20 @@
 
 # Now we can assume that 'pg_id' belongs to the same version as the
 # verified 'postgres' in the same directory.
-if [ ! -x "$PGPATH/pg_id" ]; then
-    echo "The program 'pg_id' is needed by $CMDNAME but was not found in" 1>&2
+if [ ! -x "$PGPATH/pg_id-7.3" ]; then
+    echo "The program 'pg_id-7.3' is needed by $CMDNAME but was not found in" 1>&2
     echo "the directory '$PGPATH'.  Check your installation." 1>&2
     exit 1
 fi
 
 
-EffectiveUser=`$PGPATH/pg_id -n -u`
+EffectiveUser=`$PGPATH/pg_id-7.3 -n -u`
 if [ -z "$EffectiveUser" ]; then
     echo "$CMDNAME: could not determine current user name" 1>&2
     exit 1
 fi
 
-if [ `$PGPATH/pg_id -u` -eq 0 ]
+if [ `$PGPATH/pg_id-7.3 -u` -eq 0 ]
 then
     echo "You cannot run $CMDNAME as root. Please log in (using, e.g., 'su')" 1>&2
     echo "as the (unprivileged) user that will own the server process." 1>&2
@@ -370,7 +370,7 @@
 
 if [ "$ENCODING" ]
 then
-	ENCODINGID=`$PGPATH/pg_encoding -b $ENCODING`
+	ENCODINGID=`$PGPATH/pg_encoding-7.3 -b $ENCODING`
 	if [ "$?" -ne 0 ]
 	then
               (
@@ -577,7 +577,7 @@
   export LC_COLLATE
   export LC_CTYPE
   unset LC_ALL
-  "$PGPATH"/postgres -boot -x1 $PGSQL_OPT $BACKEND_TALK_ARG template1
+  "$PGPATH"/postgres-7.3 -boot -x1 $PGSQL_OPT $BACKEND_TALK_ARG template1
 ) \
 || exit_nicely
 
@@ -625,7 +625,7 @@
 
 $ECHO_N "initializing pg_shadow... "$ECHO_C
 
-"$PGPATH"/postgres $PGSQL_OPT template1 >/dev/null <<EOF
+"$PGPATH"/postgres-7.3 $PGSQL_OPT template1 >/dev/null <<EOF
 -- Create a trigger so that direct updates to pg_shadow will be written
 -- to the flat password/group files pg_pwd and pg_group
 CREATE TRIGGER pg_sync_pg_pwd AFTER INSERT OR UPDATE OR DELETE ON pg_shadow \
@@ -658,7 +658,7 @@
         exit_nicely
     fi
     $ECHO_N "setting password... "$ECHO_C
-    "$PGPATH"/postgres $PGSQL_OPT template1 >/dev/null <<EOF
+    "$PGPATH"/postgres-7.3 $PGSQL_OPT template1 >/dev/null <<EOF
 	ALTER USER "$POSTGRES_SUPERUSERNAME" WITH PASSWORD '$FirstPw';
 EOF
     if [ "$?" -ne 0 ]; then
@@ -674,7 +674,7 @@
 
 $ECHO_N "enabling unlimited row size for system tables... "$ECHO_C
 
-"$PGPATH"/postgres $PGSQL_OPT template1 >/dev/null <<EOF
+"$PGPATH"/postgres-7.3 $PGSQL_OPT template1 >/dev/null <<EOF
 ALTER TABLE pg_attrdef CREATE TOAST TABLE;
 ALTER TABLE pg_constraint CREATE TOAST TABLE;
 ALTER TABLE pg_database CREATE TOAST TABLE;
@@ -693,7 +693,7 @@
 
 $ECHO_N "initializing pg_depend... "$ECHO_C
 
-"$PGPATH"/postgres $PGSQL_OPT template1 >/dev/null <<EOF
+"$PGPATH"/postgres-7.3 $PGSQL_OPT template1 >/dev/null <<EOF
 -- Make PIN entries in pg_depend for all objects made so far in the tables
 -- that the dependency code handles.  This is overkill (the system doesn't
 -- really depend on having every last weird datatype, for instance)
@@ -725,7 +725,7 @@
 
 $ECHO_N "creating system views... "$ECHO_C
 
-"$PGPATH"/postgres $PGSQL_OPT template1 >/dev/null <<EOF
+"$PGPATH"/postgres-7.3 $PGSQL_OPT template1 >/dev/null <<EOF
 
 CREATE VIEW pg_user AS \
     SELECT \
@@ -1014,12 +1014,12 @@
     FROM tmp_pg_description t, pg_class c WHERE c.relname = t.classname;
 EOF
 ) \
-	| "$PGPATH"/postgres $PGSQL_OPT template1 > /dev/null || exit_nicely
+	| "$PGPATH"/postgres-7.3 $PGSQL_OPT template1 > /dev/null || exit_nicely
 echo "ok"
 
 # Create pg_conversion and support functions
 $ECHO_N "creating conversions... "$ECHO_C
-grep -v '^DROP CONVERSION' $datadir/conversion_create.sql | "$PGPATH"/postgres $PGSQL_OPT template1 > /dev/null || exit_nicely
+grep -v '^DROP CONVERSION' $datadir/conversion_create.sql | "$PGPATH"/postgres-7.3 $PGSQL_OPT template1 > /dev/null || exit_nicely
 echo "ok"
 
 # Set most system catalogs and built-in functions as world-accessible.
@@ -1039,12 +1039,12 @@
         WHERE NOT lanpltrusted;
 EOF
 ) \
-	| "$PGPATH"/postgres $PGSQL_OPT template1 > /dev/null || exit_nicely
+	| "$PGPATH"/postgres-7.3 $PGSQL_OPT template1 > /dev/null || exit_nicely
 echo "ok"
 
 $ECHO_N "vacuuming database template1... "$ECHO_C
 
-"$PGPATH"/postgres $PGSQL_OPT template1 >/dev/null <<EOF
+"$PGPATH"/postgres-7.3 $PGSQL_OPT template1 >/dev/null <<EOF
 ANALYZE;
 VACUUM FULL FREEZE;
 EOF
@@ -1055,7 +1055,7 @@
 
 $ECHO_N "copying template1 to template0... "$ECHO_C
 
-"$PGPATH"/postgres $PGSQL_OPT template1 >/dev/null <<EOF
+"$PGPATH"/postgres-7.3 $PGSQL_OPT template1 >/dev/null <<EOF
 CREATE DATABASE template0;
 
 UPDATE pg_database SET \
@@ -1091,11 +1091,8 @@
 echo
 echo "Success. You can now start the database server using:"
 echo ""
-echo "    $PGPATH/postmaster -D $PGDATA"
-echo "or"
-# (Advertise -l option here, otherwise we have a background
-#  process writing to the terminal.)
-echo "    $PGPATH/pg_ctl -D $PGDATA -l logfile start"
-echo
+echo "    sudo -u root sudo -u postgres $PGPATH/pg_ctl-7.3 \\"
+echo "        -D $PGDATA -l @INSTPREFIX@/var/postgresql/pgsql.log start"
+echo ""
 
 exit 0
--- postgresql-7.3.18/src/bin/initlocation/initlocation.sh	2002-10-18 18:05:35.000000000 -0400
+++ postgresql-7.3.18-new/src/bin/initlocation/initlocation.sh	2007-02-05 11:07:22.000000000 -0500
@@ -162,7 +162,7 @@
     echo "You can now create a database using"
     echo "  CREATE DATABASE <name> WITH LOCATION = '$Location'"
     echo "in SQL, or"
-    echo "  createdb -D '$Location' <name>"
+    echo "  createdb-7.3 -D '$Location' <name>"
     echo "from the shell."
 fi
 echo
--- postgresql-7.3.18/src/bin/pg_ctl/pg_ctl.sh	2004-10-21 20:24:33.000000000 -0400
+++ postgresql-7.3.18-new/src/bin/pg_ctl/pg_ctl.sh	2007-02-05 11:07:22.000000000 -0500
@@ -14,6 +14,10 @@
 
 CMDNAME=`basename $0`
 
+ulimit -d 24000 >/dev/null 2>&1
+ulimit -n 512   >/dev/null 2>&1
+ulimit -s 4096  >/dev/null 2>&1
+
 help="\
 $CMDNAME is a utility to start, stop, restart, reload configuration files,
 or report the status of a PostgreSQL server.
@@ -97,20 +101,20 @@
 fi
 
 # Check if needed programs actually exist in path
-if [ -x "$self_path/postmaster" ] && [ -x "$self_path/psql" ]; then
+if [ -x "$self_path/postmaster-7.3" ] && [ -x "$self_path/psql-7.3" ]; then
     PGPATH="$self_path"
-elif [ -x "$bindir/postmaster" ] && [ -x "$bindir/psql" ]; then
+elif [ -x "$bindir/postmaster-7.3" ] && [ -x "$bindir/psql-7.3" ]; then
     PGPATH="$bindir"
 else
-    echo "The programs 'postmaster' and 'psql' are needed by $CMDNAME but" 1>&2
+    echo "The programs 'postmaster-7.3' and 'psql-7.3' are needed by $CMDNAME but" 1>&2
     echo "were not found in the directory '$bindir'." 1>&2
     echo "Check your installation." 1>&2
     exit 1
 fi
 
-po_path="$PGPATH/postmaster"
+po_path="$PGPATH/postmaster-7.3"
 
-if [ `$PGPATH/pg_id -u` -eq 0 ]
+if [ `$PGPATH/pg_id-7.3 -u` -eq 0 ]
 then
     echo "$CMDNAME: cannot be run as root" 1>&2
     echo "Please log in (using, e.g., \"su\") as the (unprivileged) user that will" 1>&2
@@ -251,15 +255,15 @@
 	PID=`sed -n 1p $PIDFILE`
 	if [ "$PID" -lt 0 ];then
 	    PID=`expr 0 - $PID`
-	    echo "$CMDNAME: postgres is running (pid: $PID)"
+	    echo "$CMDNAME: postgres-7.3 is running (pid: $PID)"
 	else
-	    echo "$CMDNAME: postmaster is running (pid: $PID)"
+	    echo "$CMDNAME: postmaster-7.3 is running (pid: $PID)"
 	    echo "Command line was:"
 	    cat "$POSTOPTSFILE"
 	fi
 	exit 0
     else
-	echo "$CMDNAME: postmaster or postgres is not running"
+	echo "$CMDNAME: postmaster-7.3 or postgres-7.3 is not running"
 	exit 1
     fi
 fi
@@ -269,8 +273,8 @@
 	PID=`sed -n 1p $PIDFILE`
 	if [ "$PID" -lt 0 ];then
 	    PID=`expr 0 - $PID`
-	    echo "$CMDNAME: Cannot restart postmaster.  postgres is running (pid: $PID)" 1>&2
-	    echo "Please terminate postgres and try again." 1>&2
+	    echo "$CMDNAME: Cannot restart postmaster-7.3.  postgres-7.3 is running (pid: $PID)" 1>&2
+	    echo "Please terminate postgres-7.3 and try again." 1>&2
 	    exit 1
 	fi
 
@@ -279,7 +283,7 @@
 	# wait for postmaster to shut down
 	if [ "$wait" = yes -o "$op" = restart ];then
 	    cnt=0
-	    $silence_echo $ECHO_N "waiting for postmaster to shut down..."$ECHO_C
+	    $silence_echo $ECHO_N "waiting for postmaster-7.3 to shut down..."$ECHO_C
 
 	    while :
 	    do
@@ -288,7 +292,7 @@
 		    cnt=`expr $cnt + 1`
 		    if [ "$cnt" -gt "$wait_seconds" ];then
 			$silence_echo echo " failed"
-			echo "$CMDNAME: postmaster does not shut down" 1>&2
+			echo "$CMDNAME: postmaster-7.3 does not shut down" 1>&2
 			exit 1
 		    fi
 		else
@@ -300,16 +304,16 @@
 	fi
 
 	if [ "$op" = "reload" ];then
-	    $silence_echo echo "postmaster successfully signaled"
+	    $silence_echo echo "postmaster-7.3 successfully signaled"
 	else
-	    $silence_echo echo "postmaster successfully shut down"
+	    $silence_echo echo "postmaster-7.3 successfully shut down"
 	fi
 
     else # ! -f $PIDFILE
 	echo "$CMDNAME: cannot find $PIDFILE" 1>&2
-	echo "Is postmaster running?" 1>&2
+	echo "Is postmaster-7.3 running?" 1>&2
 	if [ "$op" = "restart" ];then
-	    echo "starting postmaster anyway" 1>&2
+	    echo "starting postmaster-7.3 anyway" 1>&2
 	else
 	    exit 1
 	fi
@@ -319,7 +323,7 @@
 if [ "$op" = "start" -o "$op" = "restart" ];then
     oldpid=""
     if [ -f "$PIDFILE" ];then
-	echo "$CMDNAME: Another postmaster may be running.  Trying to start postmaster anyway." 1>&2
+	echo "$CMDNAME: Another postmaster-7.3 may be running.  Trying to start postmaster-7.3 anyway." 1>&2
 	oldpid=`sed -n 1p $PIDFILE`
     fi
 
@@ -354,7 +358,7 @@
 	sleep 1
 	if [ -f "$PIDFILE" ];then
 	    if [ "`sed -n 1p $PIDFILE`" = "$oldpid" ];then
-		echo "$CMDNAME: cannot start postmaster" 1>&2
+		echo "$CMDNAME: cannot start postmaster-7.3" 1>&2
 		echo "Examine the log output." 1>&2
 		exit 1
 	    fi
@@ -364,7 +368,7 @@
     # wait for postmaster to start
     if [ "$wait" = yes ];then
 	cnt=0
-	$silence_echo $ECHO_N "waiting for postmaster to start..."$ECHO_C
+	$silence_echo $ECHO_N "waiting for postmaster-7.3 to start..."$ECHO_C
 	while :
 	do
 # FIXME:  This is horribly misconceived.
@@ -379,7 +383,7 @@
 # 6) If the dynamic loader is not set up correctly (for this user/at
 #    this time), psql will fail (to find libpq).
 # 7) If psql is misconfigured, this may fail.
-	    if "$PGPATH/psql" -l >/dev/null 2>&1
+	    if "$PGPATH/psql-7.3" -l >/dev/null 2>&1
 	    then
 		break;
 	    else
@@ -387,7 +391,7 @@
 		cnt=`expr $cnt + 1`
 		if [ "$cnt" -gt "$wait_seconds" ];then
 		    $silence_echo echo "failed"
-		    echo "$CMDNAME: postmaster does not start" 1>&2
+		    echo "$CMDNAME: postmaster-7.3 does not start" 1>&2
 		    exit 1
 		fi
 		sleep 1
@@ -395,7 +399,7 @@
 	done
 	$silence_echo echo "done"
     fi
-    $silence_echo echo "postmaster successfully started"
+    $silence_echo echo "postmaster-7.3 successfully started"
 fi # start or restart
 
 exit 0
--- postgresql-7.3.18/src/bin/scripts/clusterdb	2003-09-29 14:53:08.000000000 -0400
+++ postgresql-7.3.18-new/src/bin/scripts/clusterdb	2007-02-05 11:07:22.000000000 -0500
@@ -140,7 +140,7 @@
 		echo "$CMDNAME: cannot cluster all databases and a specific one at the same time" 1>&2
 		exit 1
 	fi
-	dbname=`${PATHNAME}psql $PSQLOPT -q -t -A -d template1 -c 'SELECT datname FROM pg_database WHERE datallowconn'`
+	dbname=`${PATHNAME}psql-7.3 $PSQLOPT -q -t -A -d template1 -c 'SELECT datname FROM pg_database WHERE datallowconn'`
 	[ "$?" -ne 0 ] && exit 1
 
 elif [ -z "$dbname" ]; then
@@ -149,7 +149,7 @@
 	elif [ "$PGUSER" ]; then
 		dbname="$PGUSER"
 	else
-		dbname=`${PATHNAME}pg_id -u -n`
+		dbname=`${PATHNAME}pg_id-7.3 -u -n`
 	fi
 	[ "$?" -ne 0 ] && exit 1
 fi
@@ -161,7 +161,7 @@
 	query="SELECT nspname, pg_class.relname, pg_class_2.relname FROM pg_class, pg_class AS pg_class_2 JOIN pg_namespace ON (pg_namespace.oid=relnamespace), pg_index WHERE pg_class.oid=pg_index.indrelid AND pg_class_2.oid=pg_index.indexrelid AND pg_index.indisclustered AND pg_class.relowner=(SELECT usesysid FROM pg_user WHERE usename=current_user)"
 
 	if [ -z "$table" ]; then
-		tables=`${PATHNAME}psql $PSQLOPT -F: -P format=unaligned -t -c "$query" $db`
+		tables=`${PATHNAME}psql-7.3 $PSQLOPT -F: -P format=unaligned -t -c "$query" $db`
 		[ "$?" -ne 0 ] && exit 1
 	else
 		# if tablename has a dot, use it as namespace separator
@@ -169,10 +169,10 @@
 		then
 			tbl=`echo $table | cut -d. -f2`
 			nspc=`echo $table | cut -d. -f1`
-			tables=`${PATHNAME}psql $PSQLOPT -F: -P format=unaligned -t -c "$query AND pg_class.relname='$tbl' AND nspname='$nspc'" $db`
+			tables=`${PATHNAME}psql-7.3 $PSQLOPT -F: -P format=unaligned -t -c "$query AND pg_class.relname='$tbl' AND nspname='$nspc'" $db`
 			echo $tables
 		else
-			tables=`${PATHNAME}psql $PSQLOPT -F: -P format=unaligned -t -c "$query AND pg_class.relname='$table'" $db`
+			tables=`${PATHNAME}psql-7.3 $PSQLOPT -F: -P format=unaligned -t -c "$query AND pg_class.relname='$table'" $db`
 		fi
 	fi
 	query=
@@ -183,7 +183,7 @@
 		idx=`echo $tabs | cut -d: -f3`
 		query="$query CLUSTER $idx ON $nspc.$tab;"
 	done
-	${PATHNAME}psql $PSQLOPT $ECHOOPT -c "SET autocommit TO 'on';$query" -d $db
+	${PATHNAME}psql-7.3 $PSQLOPT $ECHOOPT -c "SET autocommit TO 'on';$query" -d $db
 	if [ "$?" -ne 0 ]
 	then
 		echo "$CMDNAME: While clustering $db, the following failed: $query" 1>&2
--- postgresql-7.3.18/src/bin/scripts/createdb	2006-05-21 15:56:41.000000000 -0400
+++ postgresql-7.3.18-new/src/bin/scripts/createdb	2007-02-05 11:07:22.000000000 -0500
@@ -160,7 +160,7 @@
 
 if [ -n "$MB" ]
 then
-        mbcode=`${PATHNAME}pg_encoding "$MB"`
+        mbcode=`${PATHNAME}pg_encoding-7.3 "$MB"`
         if [ -z "$mbcode" ]
 	then
 		echo "$CMDNAME: \"$MB\" is not a valid encoding name" 1>&2
@@ -174,7 +174,7 @@
         elif [ "$PGUSER" ]; then
                 dbname="$PGUSER"
         else
-                dbname=`${PATHNAME}pg_id -u -n`
+                dbname=`${PATHNAME}pg_id-7.3 -u -n`
         fi
         [ "$?" -ne 0 ] && exit 1
 fi
@@ -192,7 +192,7 @@
 [ "$TEMPLATE" ] &&   withstring="$withstring TEMPLATE = \"$TEMPLATE\""
 [ "$withstring" ] && withstring=" WITH$withstring"
 
-${PATHNAME}psql $PSQLOPT -d template1 -c "SET autocommit TO 'on';CREATE DATABASE \"$dbname\"$withstring"
+${PATHNAME}psql-7.3 $PSQLOPT -d template1 -c "SET autocommit TO 'on';CREATE DATABASE \"$dbname\"$withstring"
 if [ "$?" -ne 0 ]; then
 	echo "$CMDNAME: database creation failed" 1>&2
 	exit 1
@@ -203,7 +203,7 @@
 
 dbcomment=`echo "$dbcomment" | sed "s/'/\'\'/g"`
 
-${PATHNAME}psql $PSQLOPT -d "$dbname" -c "SET autocommit TO 'on';COMMENT ON DATABASE \"$dbname\" IS '$dbcomment'"
+${PATHNAME}psql-7.3 $PSQLOPT -d "$dbname" -c "SET autocommit TO 'on';COMMENT ON DATABASE \"$dbname\" IS '$dbcomment'"
 if [ "$?" -ne 0 ]; then
 	echo "$CMDNAME: comment creation failed (database was created)" 1>&2
 	exit 1
--- postgresql-7.3.18/src/bin/scripts/createlang.sh	2003-04-26 11:19:05.000000000 -0400
+++ postgresql-7.3.18-new/src/bin/scripts/createlang.sh	2007-02-05 11:07:22.000000000 -0500
@@ -153,7 +153,7 @@
         elif [ "$PGUSER" ]; then
                 dbname="$PGUSER"
         else
-                dbname=`${PATHNAME}pg_id -u -n`
+                dbname=`${PATHNAME}pg_id-7.3 -u -n`
         fi
         [ "$?" -ne 0 ] && exit 1
 fi
@@ -167,7 +167,7 @@
 	if [ "$showsql" = yes ]; then
 		echo "$sqlcmd"
 	fi
-        ${PATHNAME}psql $PSQLOPT -d "$dbname" -P 'title=Procedural languages' -c "$sqlcmd"
+        ${PATHNAME}psql-7.3 $PSQLOPT -d "$dbname" -P 'title=Procedural languages' -c "$sqlcmd"
         exit $?
 fi
 
@@ -233,7 +233,7 @@
 esac
 
 
-PSQL="${PATHNAME}psql -A -t -q $PSQLOPT -d $dbname -c"
+PSQL="${PATHNAME}psql-7.3 -A -t -q $PSQLOPT -d $dbname -c"
 
 # ----------
 # Make sure the language isn't already installed
--- postgresql-7.3.18/src/bin/scripts/createuser	2003-05-16 11:17:02.000000000 -0400
+++ postgresql-7.3.18-new/src/bin/scripts/createuser	2007-02-05 11:07:22.000000000 -0500
@@ -256,7 +256,7 @@
 [ "$CanAddUser" = t ] &&  QUERY="$QUERY CREATEUSER"
 [ "$CanAddUser" = f ] &&  QUERY="$QUERY NOCREATEUSER"
 
-${PATHNAME}psql -c "SET autocommit TO 'on';$QUERY" -d template1 $PSQLOPT
+${PATHNAME}psql-7.3 -c "SET autocommit TO 'on';$QUERY" -d template1 $PSQLOPT
 if [ "$?" -ne 0 ]; then
 	echo "$CMDNAME: creation of user \"$NewUser\" failed" 1>&2
 	exit 1
--- postgresql-7.3.18/src/bin/scripts/dropdb	2002-10-18 18:05:36.000000000 -0400
+++ postgresql-7.3.18-new/src/bin/scripts/dropdb	2007-02-05 11:07:22.000000000 -0500
@@ -139,7 +139,7 @@
 
 dbname=`echo "$dbname" | sed 's/\"/\\\"/g'`
 
-${PATHNAME}psql $PSQLOPT -d template1 -c "SET autocommit TO 'on';DROP DATABASE \"$dbname\""
+${PATHNAME}psql-7.3 $PSQLOPT -d template1 -c "SET autocommit TO 'on';DROP DATABASE \"$dbname\""
 if [ "$?" -ne 0 ]; then
 	echo "$CMDNAME: database removal failed" 1>&2
 	exit 1
--- postgresql-7.3.18/src/bin/scripts/droplang	2002-10-18 18:05:36.000000000 -0400
+++ postgresql-7.3.18-new/src/bin/scripts/droplang	2007-02-05 11:07:22.000000000 -0500
@@ -142,7 +142,7 @@
         elif [ "$PGUSER" ]; then
                 dbname="$PGUSER"
         else
-                dbname=`${PATHNAME}pg_id -u -n`
+                dbname=`${PATHNAME}pg_id-7.3 -u -n`
         fi
         [ "$?" -ne 0 ] && exit 1
 fi
@@ -156,7 +156,7 @@
 	if [ "$showsql" = yes ]; then
 		echo "$sqlcmd"
 	fi
-        ${PATHNAME}psql $PSQLOPT -d "$dbname" -P 'title=Procedural languages' -c "$sqlcmd"
+        ${PATHNAME}psql-7.3 $PSQLOPT -d "$dbname" -P 'title=Procedural languages' -c "$sqlcmd"
         exit $?
 fi
 
@@ -170,7 +170,7 @@
 	exit 1
 fi
 
-PSQL="${PATHNAME}psql -A -t -q $PSQLOPT -d $dbname -c"
+PSQL="${PATHNAME}psql-7.3 -A -t -q $PSQLOPT -d $dbname -c"
 
 
 # ----------
--- postgresql-7.3.18/src/bin/scripts/dropuser	2002-10-18 18:05:36.000000000 -0400
+++ postgresql-7.3.18-new/src/bin/scripts/dropuser	2007-02-05 11:07:22.000000000 -0500
@@ -149,7 +149,7 @@
 
 DelUser=`echo "$DelUser" | sed 's/\"/\\\"/g'`
 
-${PATHNAME}psql $PSQLOPT -d template1 -c "SET autocommit TO 'on';DROP USER \"$DelUser\""
+${PATHNAME}psql-7.3 $PSQLOPT -d template1 -c "SET autocommit TO 'on';DROP USER \"$DelUser\""
 
 if [ "$?" -ne 0 ]; then
 	echo "$CMDNAME: deletion of user \"$DelUser\" failed" 1>&2
--- postgresql-7.3.18/src/bin/scripts/vacuumdb	2002-10-18 18:05:36.000000000 -0400
+++ postgresql-7.3.18-new/src/bin/scripts/vacuumdb	2007-02-05 11:07:22.000000000 -0500
@@ -156,7 +156,7 @@
                 echo "$CMDNAME: cannot vacuum all databases and a specific one at the same time" 1>&2
                 exit 1
         fi
-	dbname=`${PATHNAME}psql $PSQLOPT -q -t -A -d template1 -c 'SELECT datname FROM pg_database WHERE datallowconn'`
+	dbname=`${PATHNAME}psql-7.3 $PSQLOPT -q -t -A -d template1 -c 'SELECT datname FROM pg_database WHERE datallowconn'`
 
 elif [ -z "$dbname" ]; then
         if [ "$PGDATABASE" ]; then
@@ -164,7 +164,7 @@
         elif [ "$PGUSER" ]; then
                 dbname="$PGUSER"
         else
-                dbname=`${PATHNAME}pg_id -u -n`
+                dbname=`${PATHNAME}pg_id-7.3 -u -n`
         fi
         [ "$?" -ne 0 ] && exit 1
 fi
@@ -172,7 +172,7 @@
 for db in $dbname
 do
         [ "$alldb" -a "$quiet" -ne 1 ] && echo "Vacuuming $db"
-	${PATHNAME}psql $PSQLOPT $ECHOOPT -c "SET autocommit TO 'on';VACUUM $full $verbose $analyze $table" -d $db
+	${PATHNAME}psql-7.3 $PSQLOPT $ECHOOPT -c "SET autocommit TO 'on';VACUUM $full $verbose $analyze $table" -d $db
 	if [ "$?" -ne 0 ]; then
 	    echo "$CMDNAME: vacuum $table $db failed" 1>&2
 	    exit 1
--- postgresql-7.3.18/src/include/miscadmin.h	2002-10-03 13:07:53.000000000 -0400
+++ postgresql-7.3.18-new/src/include/miscadmin.h	2007-02-05 11:07:23.000000000 -0500
@@ -182,6 +182,7 @@
 extern char *Unix_socket_group;
 extern char *UnixSocketDir;
 extern char *VirtualHost;
+extern char *service_name;
 
 
 /*****************************************************************************
--- postgresql-7.3.18/src/include/pg_config.h.in	2006-01-04 19:51:52.000000000 -0500
+++ postgresql-7.3.18-new/src/include/pg_config.h.in	2007-02-05 11:07:23.000000000 -0500
@@ -57,6 +57,9 @@
 /* Define to build with PAM Support */
 #undef USE_PAM
 
+/* Define if pam_appl.h is in pam/ instead of security/ */
+#undef HAVE_PAM_PAM_APPL_H
+
 /* 
  * DEF_PGPORT is the TCP port number on which the Postmaster listens and
  * which clients will try to connect to.  This is just a default value;
--- postgresql-7.3.18/src/include/port/darwin.h	2001-10-28 01:26:08.000000000 -0500
+++ postgresql-7.3.18-new/src/include/port/darwin.h	2007-02-05 11:07:23.000000000 -0500
@@ -1,5 +1,7 @@
 #define __darwin__	1
 
+#define HAVE_RENDEZVOUS
+
 #if defined(__ppc__)
 #define HAS_TEST_AND_SET
 #endif
--- postgresql-7.3.18/src/interfaces/libpgtcl/Makefile	2002-12-10 23:08:05.000000000 -0500
+++ postgresql-7.3.18-new/src/interfaces/libpgtcl/Makefile	2007-02-05 11:07:23.000000000 -0500
@@ -20,7 +20,7 @@
 
 OBJS= pgtcl.o pgtclCmds.o pgtclId.o
 
-SHLIB_LINK = $(libpq)
+SHLIB_LINK = $(libpq) $(TCL_LIB_SPEC)
 
 # If crypt is a separate library, rather than part of libc, it may need
 # to be referenced separately to keep (broken) linkers happy.  (This is
--- postgresql-7.3.18/src/interfaces/python/GNUmakefile	2001-12-13 13:39:04.000000000 -0500
+++ postgresql-7.3.18-new/src/interfaces/python/GNUmakefile	2007-02-05 11:07:23.000000000 -0500
@@ -1,5 +1,7 @@
 # $Header: /cvsroot/pgsql/src/interfaces/python/Attic/GNUmakefile,v 1.13 2001/12/13 18:39:04 petere Exp $
 
+DLTYPE = bundle
+
 subdir = src/interfaces/python
 top_builddir = ../../..
 include $(top_builddir)/src/Makefile.global
@@ -13,7 +15,9 @@
 override CPPFLAGS += -DUSE_DL_IMPORT
 SHLIB_LINK += $(python_libspec)
 endif
-
+ifeq ($(PORTNAME), darwin)
+SHLIB_LINK += -bundle_loader @INSTPREFIX@/bin/python2.1
+endif
 
 include $(top_srcdir)/src/Makefile.shlib
 
--- postgresql-7.3.18/src/makefiles/Makefile.darwin	2001-10-05 17:15:38.000000000 -0400
+++ postgresql-7.3.18-new/src/makefiles/Makefile.darwin	2007-02-05 11:07:23.000000000 -0500
@@ -1,13 +1,23 @@
 AROPT = cr
 AWK= awk
  
-DLSUFFIX = .so
+ifeq ($(DLTYPE), bundle)
+	DLSUFFIX := .so
+else
+	DLSUFFIX := .dylib
+endif
+
 CFLAGS_SL =
+CFLAGS += -fno-common
 ifeq (,$(filter $(host_os), darwin1.0 darwin1.1 darwin1.2))
-DARWIN_NAMESPACE_SPEC = -flat_namespace
+  DARWIN_LINKFLAGS=
+else
+  DARWIN_LINKFLAGS=-multiply_defined suppress
 endif
  
 %.so: %.o
-	$(CC) $(DARWIN_NAMESPACE_SPEC) -bundle -undefined suppress -o $@ $<
+	$(CC) -bundle $(DARWIN_LINKFLAGS) -o $@ $<
+%.dylib: %.o
+	$(CC) -dynamiclib $(DARWIN_LINKFLAGS) -o $@ $<
 
 sqlmansect = 7
--- postgresql-7.3.18/src/pl/plperl/GNUmakefile	2002-05-28 12:57:53.000000000 -0400
+++ postgresql-7.3.18-new/src/pl/plperl/GNUmakefile	2007-02-05 11:07:23.000000000 -0500
@@ -20,10 +20,10 @@
 
 override CPPFLAGS := -I$(srcdir) -I$(perl_archlibexp)/CORE $(CPPFLAGS)
 
-
 NAME = plperl
 SO_MAJOR_VERSION = 0
 SO_MINOR_VERSION = 0
+DLTYPE = bundle
 
 OBJS = plperl.o eloglvl.o SPI.o
 SHLIB_LINK = $(perl_embed_ldflags) $(BE_DLLLIBS)
--- postgresql-7.3.18/src/pl/plpgsql/src/Makefile	2002-11-01 17:52:34.000000000 -0500
+++ postgresql-7.3.18-new/src/pl/plpgsql/src/Makefile	2007-02-05 11:07:23.000000000 -0500
@@ -6,6 +6,8 @@
 #
 #-------------------------------------------------------------------------
 
+DLTYPE = bundle
+
 subdir = src/pl/plpgsql/src
 top_builddir = ../../../..
 include $(top_builddir)/src/Makefile.global
--- postgresql-7.3.18/src/pl/plpython/Makefile	2002-09-05 14:28:46.000000000 -0400
+++ postgresql-7.3.18-new/src/pl/plpython/Makefile	2007-02-05 11:07:23.000000000 -0500
@@ -1,5 +1,7 @@
 # $Header: /cvsroot/pgsql/src/pl/plpython/Makefile,v 1.11 2002/09/05 18:28:46 petere Exp $
 
+DLTYPE = bundle
+
 subdir = src/pl/plpython
 top_builddir = ../../..
 include $(top_builddir)/src/Makefile.global
@@ -8,7 +10,7 @@
 # On some platforms we can only build PL/Python if libpython is a
 # shared library.  Since there is no official way to determine this,
 # we see if there is a file that is named like a shared library.
-ifneq (,$(wildcard $(python_configdir)/libpython*$(DLSUFFIX)*))
+ifneq (,$(wildcard $(python_configdir)/libpython*.a*))
 shared_libpython = yes
 endif
 
@@ -24,7 +26,7 @@
 SO_MINOR_VERSION = 0
 OBJS = plpython.o
 
-SHLIB_LINK = $(BE_DLLLIBS) $(python_libspec)
+SHLIB_LINK = $(BE_DLLLIBS) -bundle_loader @INSTPREFIX@/bin/python2.1
 
 include $(top_srcdir)/src/Makefile.shlib
 
--- postgresql-7.3.18/src/pl/tcl/Makefile	2002-05-24 14:10:17.000000000 -0400
+++ postgresql-7.3.18-new/src/pl/tcl/Makefile	2007-02-05 11:07:23.000000000 -0500
@@ -25,7 +25,6 @@
 endif
 endif
 
-
 # The following attempts to figure out what libraries need to be
 # linked with pltcl.  The information comes from the tclConfig.sh
 # file, but it's mostly bogus.  This just might work.
@@ -48,6 +47,7 @@
 NAME = pltcl
 SO_MAJOR_VERSION = 2
 SO_MINOR_VERSION = 0
+DLTYPE = bundle
 OBJS = pltcl.o
 
 include $(top_srcdir)/src/Makefile.shlib
--- postgresql-7.3.18/src/template/darwin	2002-05-04 20:03:29.000000000 -0400
+++ postgresql-7.3.18-new/src/template/darwin	2007-02-05 11:07:23.000000000 -0500
@@ -1,6 +1,6 @@
 # -traditional-cpp means "don't use apple's cpp-precomp" on darwin
 # this should change to -no-cpp-precomp when that flag is implemented
-CC="$CC -traditional-cpp"
+CC="$CC"
 
 # Select appropriate semaphore support
 USE_NAMED_POSIX_SEMAPHORES=1
