Package: libhal1-shlibs
Version: 0.5.10
Revision: 2

Source: http://hal.freedesktop.org/releases/hal-%v.tar.gz
Source-MD5: fce852c428e7cda0b937087c79eec63f

BuildDepends: <<
	dbus-dev (>= 1.0.2-1),
	expat1,
	fink (>= 0.24.12-1),
	gettext-bin, 
	gettext-tools, 
	glib2-dev (>= 2.14.0-1),
	gtk-doc,
	libgettext3-dev,
	libiconv-dev,
	libusb,
	pkgconfig (>= 0.21-1)
<<
Depends: <<
	dbus-shlibs (>= 1.0.2-1),
	expat1-shlibs,
	glib2-shlibs (>= 2.14.0-1),
	libgettext3-shlibs,
	libiconv,
	libusb-shlibs
<<

PatchFile: %n.patch
PatchFile-MD5: 2dc472dd2c5b71dceca55a6e2aa842ad
PatchScript: <<
	%{default_script}
	perl -pi -e 's/\@HAVE_GPERF_TRUE\@/#/' tools/Makefile.in
<<

ConfigureParams: <<
	--libexecdir=%p/sbin \
	--with-hal-user=root --with-hal-group=root \
	--disable-pci-ids --disable-usb-ids --disable-pnp-ids \
	--disable-pmu \
	--disable-dependency-tracking
<<
CompileScript: <<
	./configure %c
	make
<<

InstallScript: make install DESTDIR=%d
DocFiles: AUTHORS COPYING ChangeLog HACKING NEWS README doc/TODO

Shlibs: <<
	%p/lib/libhal.1.dylib 2.0.0 %n (>= 0.5.10-1)
	%p/lib/libhal-storage.1.dylib 2.0.0 %n (>= 0.5.10-1)
<<

SplitOff: <<
	Package: libhal1-dev
	Depends: libhal1-shlibs (= %v-%r)
	BuildDependsOnly: true
	Files: <<
		include
		lib/libhal.{a,la,dylib}
		lib/libhal-storage.{a,la,dylib}
		lib/pkgconfig
		share/gtk-doc
	<<
	DocFiles: AUTHORS COPYING ChangeLog HACKING NEWS README doc/TODO
<<

SplitOff2: <<
	Package: hal
	Depends: <<
		dbus (>= 1.0.2-1),
		libhal1-shlibs (= %v-%r)
	<<
	Files: <<
		bin
		sbin
		lib/hal
		share/man
	<<
	DocFiles: AUTHORS COPYING ChangeLog HACKING NEWS README doc/TODO
<<

DescPort: <<
	Disable the *-ids because I don't see such a file in OS X.

	Don't have pmu, so disable it.

	Remove --as-needed because it's not available on OS X linker.

	Don't have libvolume_id in fink, so don't bother trying to
	detect it. Detection is omitted on Solaris, so maybe it's not
	mandatory for darwin either?

	Implement some dummy functions for the hald/dummy back-end:
		http://gitweb.freedesktop.org/?p=hal.git;a=commitdiff;h=cb204ce0b7c7bd83b0b185b404a00f33800282c5
		http://gitweb.freedesktop.org/?p=hal.git;a=commitdiff_plain;h=71e114164819eaf0f9259236cc4ee9bae177b931;hp=75965fdc42620f57bdf9c9138f9d30f0af5b284d

	Hack around weird propagation of detection of gperf into
	tools that causes build to fail. Maybe solved by:
		http://gitweb.freedesktop.org/?p=hal.git;a=commitdiff;h=e7b7241a92149429a9e74a01f83c7fcce585f5ce

	Need stdlib.h in hal-disable-polling.c for realpath()

	darwin isn't known by tools and the default implementations of
	filesystem handling fail because darwin doesn't have getmnt
	and friends, so hack the tools to use the FreeBSD
	implementation.
<<
DescPackaging: <<
	Don't have user/group "haldaemon" in passwd or know what to
	use instead, so leaving hald as root for now. FIXME!
<<

Description: Hardware Abstraction Layer
Homepage: http://www.freedesktop.org/wiki/Software/hal
License: GPL
Maintainer: Daniel Macks <dmacks@netspace.org>
