Info2: <<
Package: svn-swig-rb%type_pkg[ruby]
Version: 1.4.0
Revision: 10
Description: Subversion - Swig Ruby %type_raw[ruby] bindings
Type: ruby (1.8)
License: BSD
Maintainer: Christian Schaffner <chris01@users.sourceforge.net>

# Dependencies:
Depends: ruby%type_pkg[ruby]-shlibs, ruby%type_pkg[ruby], %{Ni}-shlibs
BuildDepends: fink (>= 0.21.1-1), svn-dev (>= 1.4.0-1), apr-dev (>= 0.9.12-10), aprutil-dev (>= 0.9.12-10), db44-aes, expat (>= 1.95.6-2), libxml2 (>= 2.5.10-12), neon25, openldap23-dev (>= 2.3.24-10), cyrus-sasl2-dev (>= 2.1.15-23), system-openssl-dev, libiconv-dev (>= 1.9.1-11), gettext-bin, gettext-tools, libgettext3-dev, io-string-pm, libtool14 (>= 1.5.10-1), autoconf (>= 2.60-1), automake1.9, ruby%type_pkg[ruby]-dev
Conflicts: %{Ni}23, %{Ni}24
Replaces: %{Ni}23, %{Ni}24, svn-shlibs (<< 1.0.4-11)

# Unpack Phase:
Source: http://subversion.tigris.org/downloads/subversion-%v.tar.bz2
Source-MD5: f0c5fef69fccfb12ef6c8598f484ed0e

# Patch Phase:
Patch: svn.patch

# Compile Phase:
SetCPPFLAGS: -no-cpp-precomp
NoSetLDFLAGS: true
NoSetLIBS: true
SetLDFLAGS: -L%p/lib/system-openssl/lib -L%p/lib
GCC: 4.0
CompileScript: <<
#! /bin/sh -ev
 # recreate configure with libtool 1.5
 ./autogen.sh

 ### Recreate build-outputs.mk to not include already installed libs
 ./gen-make.py --installed-libs libsvn_client,libsvn_delta,libsvn_diff,libsvn_fs,libsvn_fs_base,libsvn_fs_fs,libsvn_ra,libsvn_ra_dav,libsvn_ra_local,libsvn_ra_svn,libsvn_repos,libsvn_subr,libsvn_wc

 ### Configure shared
 export F77=no; ./configure --prefix=%p --libexecdir='${prefix}/lib/svn' --mandir='${prefix}/share/man' --infodir='${prefix}/share/info' --with-neon=%p --with-apr=%p --with-apr-util=%p --enable-shared --without-apxs --without-apache --disable-mod-activation --without-jdk --disable-javahl --with-jikes=no --enable-swig-bindings=ruby --without-python --without-perl --with-ruby=%p/bin/ruby%type_raw[ruby] RUBY=%p/bin/ruby%type_raw[ruby]

 ### Fix problem with libtool
 perl -pi.bak -e 's/-multiply_defined suppress/-Wl,-multiply_defined,suppress/g' Makefile

 ### Build swig ruby bindings
 make swig-rb

 ### Check swig perl bindings
# make check-swig-rb
<<

# Install Phase:
DocFiles: COPYING HACKING INSTALL.swig NOTES.swig
InstallScript: <<
 ### Install swig ruby bindings
 make install-swig-rb DESTDIR=%d
 cp subversion/bindings/swig/INSTALL INSTALL.swig
 cp subversion/bindings/swig/NOTES NOTES.swig

 ### Remove unneeded archives
 rm %i/lib/*.a
 rm %i/lib/*.la
 rm %i/lib/ruby/site_ruby/%type_raw[ruby]/powerpc-darwin/svn/ext/*.a
 rm %i/lib/ruby/site_ruby/%type_raw[ruby]/powerpc-darwin/svn/ext/*.la
<<
SplitOff: <<
  Description: Subversion - Swig Ruby Shared libraries
  Package: %N-shlibs
  Depends: svn-shlibs (>= 1.4.0-1)
  Replaces: %{Ni}23-shlibs, %{Ni}24-shlibs
  Provides: %{Ni}-shlibs
  Files: <<
    lib/libsvn_swig_ruby-1.0.0.0.dylib
    lib/libsvn_swig_ruby-1.0.dylib
    lib/libsvn_swig_ruby-1.dylib
  <<
  Shlibs: <<
    %p/lib/libsvn_swig_ruby-1.0.dylib 1.0.0 %n (>= 1.4.0-1)
  <<
  DocFiles: COPYING HACKING INSTALL.swig NOTES.swig
<<

# Additional Info
DescDetail: <<
  Bindings to call svn functions from ruby.
<<
DescUsage: <<
  Please read the files in '%p/share/doc/svn-swig-rb%type_pkg[ruby]/'.
<<
DescPort: <<
 Patches applied to be able to not rebuild already installed libraries
 from the svn-shlibs package. Borrowed from the netbsd 
 pkgsrc/devel/subversion/ package

 Added 'export F77=no;' to configure in order not to fail if the 
 fort77 package is installed.
<<
DescPackaging: <<
 The svn ruby bindings don't support ruby older than 1.8.2
 
 The Makefile ist patched since ruby packages older than 1.8.5 give 
 back linking flags incompatible with libtool. 
<<
Homepage: http://subversion.tigris.org/
<<
