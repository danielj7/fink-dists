diff -Nurd lensfun-0.2.3/build/mak/compiler/gcc.mak lensfun-0.2.3-patched/build/mak/compiler/gcc.mak
--- lensfun-0.2.3/build/mak/compiler/gcc.mak	2008-05-11 11:50:15.000000000 -0400
+++ lensfun-0.2.3-patched/build/mak/compiler/gcc.mak	2009-03-18 16:55:53.000000000 -0400
@@ -72,8 +72,14 @@
 
 LINK.GCC.AR = $(GCC.AR) $(GCC.ARFLAGS) $@ $^
 LINK.GCC.EXEC = $(GCC.LD) -o $@ $(GCC.LDFLAGS) $(LDFLAGS) $1 $^ $(GCC.LDFLAGS.LIBS) $(LDFLAGS.LIBS) $2
+
+ifeq ($(TARGET),mac)
+else
+RPATH.SONAME = -Wl,"-soname=$(notdir $@).$(basename $(basename $(SHARED.$3)))"
+endif
+
 define LINK.GCC.SO
-	$(GCC.LD) -o $@.$(SHARED.$3) -Wl,"-soname=$(notdir $@).$(basename $(basename $(SHARED.$3)))" $(GCC.LDFLAGS.SHARED) $(GCC.LDFLAGS) $(LDFLAGS) $1 $^ $(GCC.LDFLAGS.LIBS) $(LDFLAGS.LIBS) $2
+	$(GCC.LD) -o $@.$(SHARED.$3) $(RPATH.SONAME) $(GCC.LDFLAGS.SHARED) $(GCC.LDFLAGS) $(LDFLAGS) $1 $^ $(GCC.LDFLAGS.LIBS) $(LDFLAGS.LIBS) $2
 	ln -fs $(notdir $@.$(SHARED.$3)) $@.$(basename $(basename $(SHARED.$3)))
 	ln -fs $(notdir $@.$(basename $(basename $(SHARED.$3)))) $@
 endef
diff -Nurd lensfun-0.2.3/build/mak/host/mac.mak lensfun-0.2.3-patched/build/mak/host/mac.mak
--- lensfun-0.2.3/build/mak/host/mac.mak	2008-07-14 15:23:30.000000000 -0400
+++ lensfun-0.2.3-patched/build/mak/host/mac.mak	2009-03-18 16:58:42.000000000 -0400
@@ -5,12 +5,12 @@
 # $1 - file, $2 - target dir, $3 - mode
 define SINGLE.INSTALL
 	if [ ! -d $2 ]; then install -m 0755 -d $2; fi
-	if [ -L $1 ]; then cp -d $1 $2$(notdir $1); else install -m $3 $1 $2$(notdir $1); fi
+	if [ -L $1 ]; then cp -RP $1 $2$(notdir $1); else install -m $3 $1 $2$(notdir $1); fi
 endef
 
 # $1 - directory, $2 - target dir, $3 - mode for files
 define SINGLE.INSTALLDIR
 	if [ ! -d $2 ]; then install -m 0755 -d $2; fi
-	cp -drP $1* $2
+	cp -RP $1* $2
 	find $2 -type f -print0 | xargs -0 chmod $3
 endef
diff -Nurd lensfun-0.2.3/libs/auxfun/image.cpp lensfun-0.2.3-patched/libs/auxfun/image.cpp
--- lensfun-0.2.3/libs/auxfun/image.cpp	2008-05-02 02:56:04.000000000 -0400
+++ lensfun-0.2.3-patched/libs/auxfun/image.cpp	2012-09-18 01:20:27.000000000 -0400
@@ -94,7 +94,7 @@
 
     png_init_io (png, file);
 
-    if (setjmp (png->jmpbuf))
+    if (setjmp (png_jmpbuf(png)))
         // If we get here, we had a problem reading the file
         goto nomem;
 
@@ -157,7 +157,7 @@
     row_pointers = new png_bytep [Height];
 
     if (!row_pointers
-        || setjmp (png->jmpbuf))             // Set a new exception handler
+        || setjmp (png_jmpbuf(png)))         // Set a new exception handler
     {
         delete [] row_pointers;
     nomem:
@@ -214,7 +214,7 @@
     }
 
     /* Catch processing errors */
-    if (setjmp(png->jmpbuf))
+    if (setjmp(png_jmpbuf(png)))
         /* If we get here, we had a problem writing the file */
         goto error2;
 
@@ -273,10 +273,6 @@
     /* It is REQUIRED to call this to finish writing the rest of the file */
     png_write_end (png, info);
 
-    /* if you malloced the palette, free it here */
-    if (info->palette)
-        free (info->palette);
-
     /* clean up after the write, and free any memory allocated */
     png_destroy_write_struct (&png, &info);
 
